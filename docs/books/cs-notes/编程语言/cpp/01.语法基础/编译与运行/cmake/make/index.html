<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="Make Make 这个词，英语的意思是&#34;制作&#34;。Make 命令直接用了这个意思，就是要做出某个文件。比如，要做出文件 a.txt，就可以执行下面的命令。 $ make a.txt 但是，如果你真的输入这条命令，它并不会起"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/cs-notes/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/cpp/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E7%BC%96%E8%AF%91%E4%B8%8E%E8%BF%90%E8%A1%8C/cmake/make/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/cs-notes/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/cpp/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E7%BC%96%E8%AF%91%E4%B8%8E%E8%BF%90%E8%A1%8C/cmake/make/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/cs-notes/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/cpp/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E7%BC%96%E8%AF%91%E4%B8%8E%E8%BF%90%E8%A1%8C/cmake/make/"><meta property="og:title" content="Make | Next-gen Tech Edu"><meta property="og:description" content="Make Make 这个词，英语的意思是&#34;制作&#34;。Make 命令直接用了这个意思，就是要做出某个文件。比如，要做出文件 a.txt，就可以执行下面的命令。 $ make a.txt 但是，如果你真的输入这条命令，它并不会起"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>Make | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=6d4f1db26f3b53dd42a0a9b41fa246a6><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">CMake</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id4bba0c2d6a79e39c4996619194c7c3e7")' href=#id4bba0c2d6a79e39c4996619194c7c3e7 aria-expanded=false aria-controls=id4bba0c2d6a79e39c4996619194c7c3e7 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/cs-notes/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/cpp/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E7%BC%96%E8%AF%91%E4%B8%8E%E8%BF%90%E8%A1%8C/>编译与运行</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id4bba0c2d6a79e39c4996619194c7c3e7 aria-expanded=false aria-controls=id4bba0c2d6a79e39c4996619194c7c3e7><i class="fa-solid fa-angle-down" id=caret-id4bba0c2d6a79e39c4996619194c7c3e7></i></a></div><ul class="nav docs-sidenav collapse show" id=id4bba0c2d6a79e39c4996619194c7c3e7><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id275db81c8c32f1f1247cc8e211cba475")' href=#id275db81c8c32f1f1247cc8e211cba475 aria-expanded=false aria-controls=id275db81c8c32f1f1247cc8e211cba475 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/cs-notes/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/cpp/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E7%BC%96%E8%AF%91%E4%B8%8E%E8%BF%90%E8%A1%8C/01.%E7%A8%8B%E5%BA%8F%E7%BC%96%E8%AF%91/>01.程序编译</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id275db81c8c32f1f1247cc8e211cba475 aria-expanded=false aria-controls=id275db81c8c32f1f1247cc8e211cba475><i class="fa-solid fa-angle-right" id=caret-id275db81c8c32f1f1247cc8e211cba475></i></a></div><ul class="nav docs-sidenav collapse" id=id275db81c8c32f1f1247cc8e211cba475><li class="child level"><a href=/books/cs-notes/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/cpp/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E7%BC%96%E8%AF%91%E4%B8%8E%E8%BF%90%E8%A1%8C/01.%E7%A8%8B%E5%BA%8F%E7%BC%96%E8%AF%91/%E4%B8%8D%E5%90%8C%E7%9A%84%E7%BC%96%E8%AF%91%E5%B7%A5%E5%85%B7/>不同的编译工具</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id6bc684231c4aaac52f462c8649fa86b5")' href=#id6bc684231c4aaac52f462c8649fa86b5 aria-expanded=false aria-controls=id6bc684231c4aaac52f462c8649fa86b5 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/cs-notes/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/cpp/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E7%BC%96%E8%AF%91%E4%B8%8E%E8%BF%90%E8%A1%8C/clang/>clang</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id6bc684231c4aaac52f462c8649fa86b5 aria-expanded=false aria-controls=id6bc684231c4aaac52f462c8649fa86b5><i class="fa-solid fa-angle-right" id=caret-id6bc684231c4aaac52f462c8649fa86b5></i></a></div><ul class="nav docs-sidenav collapse" id=id6bc684231c4aaac52f462c8649fa86b5><li class="child level"><a href=/books/cs-notes/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/cpp/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E7%BC%96%E8%AF%91%E4%B8%8E%E8%BF%90%E8%A1%8C/clang/%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/>常用指令</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id21723428a22c1097beaa8051e45a3314")' href=#id21723428a22c1097beaa8051e45a3314 aria-expanded=false aria-controls=id21723428a22c1097beaa8051e45a3314 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/cs-notes/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/cpp/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E7%BC%96%E8%AF%91%E4%B8%8E%E8%BF%90%E8%A1%8C/cmake/>CMake</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id21723428a22c1097beaa8051e45a3314 aria-expanded=false aria-controls=id21723428a22c1097beaa8051e45a3314><i class="fa-solid fa-angle-down" id=caret-id21723428a22c1097beaa8051e45a3314></i></a></div><ul class="nav docs-sidenav collapse show" id=id21723428a22c1097beaa8051e45a3314><li class="child level"><a href=/books/cs-notes/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/cpp/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E7%BC%96%E8%AF%91%E4%B8%8E%E8%BF%90%E8%A1%8C/cmake/cmake-%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B/>CMake 简单示例</a></li><li class="child level"><a href=/books/cs-notes/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/cpp/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E7%BC%96%E8%AF%91%E4%B8%8E%E8%BF%90%E8%A1%8C/cmake/cmakelists.txt/>CMakeLists.txt</a></li><li class="child level active"><a href=/books/cs-notes/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/cpp/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E7%BC%96%E8%AF%91%E4%B8%8E%E8%BF%90%E8%A1%8C/cmake/make/>Make</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id32a4272bb4a37ca2391f2f6abf603147")' href=#id32a4272bb4a37ca2391f2f6abf603147 aria-expanded=false aria-controls=id32a4272bb4a37ca2391f2f6abf603147 aria-hidden=false data-toggle=collapse></div></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id883150a436d7253fdfed67685d7087ac")' href=#id883150a436d7253fdfed67685d7087ac aria-expanded=false aria-controls=id883150a436d7253fdfed67685d7087ac aria-hidden=false data-toggle=collapse></div></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#目标target>目标（target）</a></li><li><a href=#前置条件prerequisites>前置条件（prerequisites）</a></li><li><a href=#命令commands>命令（commands）</a></li></ul><ul><li><a href=#注释>注释</a></li><li><a href=#回声echoing>回声（echoing）</a></li><li><a href=#通配符>通配符</a></li><li><a href=#模式匹配>模式匹配</a></li><li><a href=#变量和赋值符>变量和赋值符</a></li><li><a href=#内置变量implicit-variables>内置变量（Implicit Variables）</a></li><li><a href=#自动变量automatic-variables>自动变量（Automatic Variables）</a></li><li><a href=#判断和循环>判断和循环</a></li><li><a href=#函数>函数</a></li></ul><ul><li><a href=#执行多个目标>执行多个目标</a></li><li><a href=#编译-c-语言项目>编译 C 语言项目</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>Make</h1><div class=article-style><h1 id=make>Make</h1><p>Make 这个词，英语的意思是"制作"。Make 命令直接用了这个意思，就是要做出某个文件。比如，要做出文件 a.txt，就可以执行下面的命令。</p><pre tabindex=0><code>$ make a.txt
</code></pre><p>但是，如果你真的输入这条命令，它并不会起作用。因为 Make 命令本身并不知道，如何做出 a.txt，需要有人告诉它，如何调用其他命令完成这个目标。比如，假设文件 a.txt 依赖于 b.txt 和 c.txt，是后面两个文件连接（cat 命令）的产物。那么，make 需要知道下面的规则。</p><pre tabindex=0><code> a.txt: b.txt c.txt
     cat b.txt c.txt &gt; a.txt
</code></pre><p>也就是说，make a.txt 这条命令的背后，实际上分成两步：第一步，确认 b.txt 和 c.txt 必须已经存在，第二步使用 cat 命令 将这个两个文件合并，输出为新文件。像这样的规则，都写在一个叫做 Makefile 的文件中，Make 命令依赖这个文件进行构建。Makefile 文件也可以写为 makefile，或者用命令行参数指定为其他文件名。</p><pre tabindex=0><code>$ make -f rules.txt
# 或者
$ make --file=rules.txt
</code></pre><p>上面代码指定 make 命令依据 rules.txt 文件中的规则，进行构建。总之，make 只是一个根据指定的 Shell 命令进行构建的工具。它的规则很简单，你规定要构建哪个文件、它依赖哪些源文件，当那些文件有变动时，如何重新构建它。</p><h1 id=make-文件格式>Make 文件格式</h1><p>Makefile 文件由一系列规则（rules）构成。每条规则的形式如下。</p><pre tabindex=0><code>&lt;target&gt; : &lt;prerequisites&gt;
[tab]  &lt;commands&gt;
</code></pre><p>上面第一行冒号前面的部分，叫做"目标"（target），冒号后面的部分叫做"前置条件"（prerequisites）；第二行必须由一个 tab 键起首，后面跟着"命令"（commands）。&ldquo;目标"是必需的，不可省略；&ldquo;前置条件"和"命令"都是可选的，但是两者之中必须至少存在一个。每条规则就明确两件事：构建目标的前置条件是什么，以及如何构建。下面就详细讲解，每条规则的这三个组成部分。</p><h2 id=目标target>目标（target）</h2><p>一个目标（target）就构成一条规则。目标通常是文件名，指明 Make 命令所要构建的对象，比如上文的 a.txt 。目标可以是一个文件名，也可以是多个文件名，之间用空格分隔。</p><p>除了文件名，目标还可以是某个操作的名字，这称为"伪目标&rdquo;（phony target）。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-s data-lang=s><span class=line><span class=cl><span class=n>clean</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=n>rm</span> <span class=o>*</span><span class=n>.o</span>
</span></span></code></pre></div><p>上面代码的目标是 clean，它不是文件名，而是一个操作的名字，属于"伪目标 &ldquo;，作用是删除对象文件。</p><pre tabindex=0><code>$ make  clean
</code></pre><p>但是，如果当前目录中，正好有一个文件叫做 clean，那么这个命令不会执行。因为 Make 发现 clean 文件已经存在，就认为没有必要重新构建了，就不会执行指定的 rm 命令。为了避免这种情况，可以明确声明 clean 是"伪目标&rdquo;，写法如下。</p><pre tabindex=0><code>.PHONY: clean
clean:
        rm *.o temp
</code></pre><p>声明 clean 是"伪目标"之后，make 就不会去检查是否存在一个叫做 clean 的文件，而是每次运行都执行对应的命令。像.PHONY 这样的内置目标名还有不少，可以查看<a href=http://www.gnu.org/software/make/manual/html_node/Special-Targets.html#Special-Targets target=_blank rel=noopener>手册</a>。如果 Make 命令运行时没有指定目标，默认会执行 Makefile 文件的第一个目标。</p><pre tabindex=0><code>$ make
</code></pre><p>上面代码执行 Makefile 文件的第一个目标。</p><h2 id=前置条件prerequisites>前置条件（prerequisites）</h2><p>前置条件通常是一组文件名，之间用空格分隔。它指定了"目标"是否重新构建的判断标准：只要有一个前置文件不存在，或者有过更新（前置文件的 last-modification 时间戳比目标的时间戳新），&ldquo;目标"就需要重新构建。</p><pre tabindex=0><code>result.txt: source.txt
    cp source.txt result.txt
</code></pre><p>上面代码中，构建 result.txt 的前置条件是 source.txt 。如果当前目录中，source.txt 已经存在，那么 <code>make result.txt</code> 可以正常运行，否则必须再写一条规则，来生成 source.txt 。</p><pre tabindex=0><code>source.txt:
    echo &#34;this is the source&#34; &gt; source.txt
</code></pre><p>上面代码中，source.txt 后面没有前置条件，就意味着它跟其他文件都无关，只要这个文件还不存在，每次调用<code>make source.txt</code>，它都会生成。</p><pre tabindex=0><code>$ make result.txt
$ make result.txt
</code></pre><p>上面命令连续执行两次 <code>make result.txt</code>。第一次执行会先新建 source.txt，然后再新建 result.txt。第二次执行，Make 发现 source.txt 没有变动（时间戳晚于 result.txt），就不会执行任何操作，result.txt 也不会重新生成。如果需要生成多个文件，往往采用下面的写法。</p><pre tabindex=0><code>source: file1 file2 file3
</code></pre><p>上面代码中，source 是一个伪目标，只有三个前置文件，没有任何对应的命令。</p><pre tabindex=0><code>$ make source
</code></pre><p>执行 <code>make source</code> 命令后，就会一次性生成 file1，file2，file3 三个文件。这比下面的写法要方便很多。</p><pre tabindex=0><code>$ make file1
$ make file2
$ make file3
</code></pre><h2 id=命令commands>命令（commands）</h2><p>命令（commands）表示如何更新目标文件，由一行或多行的 Shell 命令组成。它是构建"目标"的具体指令，它的运行结果通常就是生成目标文件。每行命令之前必须有一个 tab 键。如果想用其他键，可以用内置变量.RECIPEPREFIX 声明。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-s data-lang=s><span class=line><span class=cl><span class=n>.RECIPEPREFIX</span> <span class=o>=</span> <span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>all</span><span class=o>:</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=n>echo</span> <span class=n>Hello</span><span class=p>,</span> <span class=n>world</span>
</span></span></code></pre></div><p>上面代码用.RECIPEPREFIX 指定，大于号（>）替代 tab 键。所以，每一行命令的起首变成了大于号，而不是 tab 键。</p><p>需要注意的是，每行命令在一个单独的 shell 中执行。这些 Shell 之间没有继承关系。</p><pre tabindex=0><code>var-lost:
    export foo=bar
    echo &#34;foo=[$$foo]&#34;
</code></pre><p>上面代码执行后（<code>make var-lost</code>），取不到 foo 的值。因为两行命令在两个不同的进程执行。一个解决办法是将两行命令写在一行，中间用分号分隔。</p><pre tabindex=0><code>var-kept:
    export foo=bar; echo &#34;foo=[$$foo]&#34;
</code></pre><p>另一个解决办法是在换行符前加反斜杠转义。</p><pre tabindex=0><code>var-kept:
    export foo=bar; \
    echo &#34;foo=[$$foo]&#34;
</code></pre><p>最后一个方法是加上<code>.ONESHELL:</code>命令。</p><pre tabindex=0><code>.ONESHELL:
var-kept:
    export foo=bar;
    echo &#34;foo=[$$foo]&#34;
</code></pre><h1 id=文件格式>文件格式</h1><h2 id=注释>注释</h2><p>井号（#）在 Makefile 中表示注释。</p><pre tabindex=0><code># 这是注释
result.txt: source.txt
    # 这是注释
    cp source.txt result.txt # 这也是注释
</code></pre><h2 id=回声echoing>回声（echoing）</h2><p>正常情况下，make 会打印每条命令，然后再执行，这就叫做回声（echoing）。</p><pre tabindex=0><code>test:
    # 这是测试
</code></pre><p>执行上面的规则，会得到下面的结果。</p><pre tabindex=0><code>$ make test
# 这是测试
</code></pre><p>在命令的前面加上@，就可以关闭回声。</p><pre tabindex=0><code>test:
    @# 这是测试
</code></pre><p>现在再执行 <code>make test</code>，就不会有任何输出。由于在构建过程中，需要了解当前在执行哪条命令，所以通常只在注释和纯显示的 echo 命令前面加上@。</p><pre tabindex=0><code>test:
    @# 这是测试
    @echo TODO
</code></pre><h2 id=通配符>通配符</h2><p>通配符（wildcard）用来指定一组符合条件的文件名。Makefile 的通配符与 Bash 一致，主要有星号（<em>）、问号（？）和 [&mldr;] 。比如，</em>.o 表示所有后缀名为 o 的文件。</p><pre tabindex=0><code>clean:
        rm -f *.o
</code></pre><h2 id=模式匹配>模式匹配</h2><p>Make 命令允许对文件名，进行类似正则运算的匹配，主要用到的匹配符是%。比如，假定当前目录下有 f1.c 和 f2.c 两个源码文件，需要将它们编译为对应的对象文件。</p><pre tabindex=0><code>%.o: %.c
</code></pre><p>等同于下面的写法。</p><pre tabindex=0><code>f1.o: f1.c
f2.o: f2.c
</code></pre><p>使用匹配符%，可以将大量同类型的文件，只用一条规则就完成构建。</p><h2 id=变量和赋值符>变量和赋值符</h2><p>Makefile 允许使用等号自定义变量。</p><pre tabindex=0><code>txt = Hello World
test:
    @echo $(txt)
</code></pre><p>上面代码中，变量 txt 等于 Hello World。调用时，变量需要放在 $( ) 之中。</p><p>调用 Shell 变量，需要在美元符号前，再加一个美元符号，这是因为 Make 命令会对美元符号转义。</p><pre tabindex=0><code>test:
    @echo $$HOME
</code></pre><p>有时，变量的值可能指向另一个变量。</p><pre tabindex=0><code>v1 = $(v2)
</code></pre><p>上面代码中，变量 v1 的值是另一个变量 v2。这时会产生一个问题，v1 的值到底在定义时扩展（静态扩展），还是在运行时扩展（动态扩展）？如果 v2 的值是动态的，这两种扩展方式的结果可能会差异很大。为了解决类似问题，Makefile 一共提供了四个赋值运算符（=、:=、？=、+=），它们的区别请看 <a href=http://stackoverflow.com/questions/448910/makefile-variable-assignment target=_blank rel=noopener>StackOverflow</a>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-s data-lang=s><span class=line><span class=cl><span class=c1># 在执行时扩展，允许递归扩展。</span>
</span></span><span class=line><span class=cl><span class=n>VARIABLE</span> <span class=o>=</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 在定义时扩展。</span>
</span></span><span class=line><span class=cl><span class=n>VARIABLE</span> <span class=o>:=</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 只有在该变量为空时才设置值。</span>
</span></span><span class=line><span class=cl><span class=n>VARIABLE</span> <span class=o>?=</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 将值追加到变量的尾端。</span>
</span></span><span class=line><span class=cl><span class=n>VARIABLE</span> <span class=o>+=</span> <span class=n>value</span>
</span></span></code></pre></div><h2 id=内置变量implicit-variables>内置变量（Implicit Variables）</h2><p>Make 命令提供一系列内置变量，比如，$(CC) 指向当前使用的编译器，$(MAKE) 指向当前使用的 Make 工具。这主要是为了跨平台的兼容性，详细的内置变量清单见<a href=https://www.gnu.org/software/make/manual/html_node/Implicit-Variables.html target=_blank rel=noopener>手册</a>。</p><pre tabindex=0><code>output:
    $(CC) -o output input.c
</code></pre><h2 id=自动变量automatic-variables>自动变量（Automatic Variables）</h2><p>Make 命令还提供一些自动变量，它们的值与当前规则有关。主要有以下几个。</p><p><strong>（1）$@</strong></p><p>$@指代当前目标，就是 Make 命令当前构建的那个目标。比如，<code>make foo</code>的 $@ 就指代 foo。</p><pre tabindex=0><code>a.txt b.txt:
    touch $@
</code></pre><p>等同于下面的写法。</p><pre tabindex=0><code>a.txt:
    touch a.txt
b.txt:
    touch b.txt
</code></pre><p><strong>（2）$&lt;</strong></p><p>$&lt; 指代第一个前置条件。比如，规则为 t: p1 p2，那么$&lt; 就指代 p1。</p><pre tabindex=0><code>a.txt: b.txt c.txt
    cp $&lt; $@
</code></pre><p>等同于下面的写法。</p><pre tabindex=0><code>a.txt: b.txt c.txt
    cp b.txt a.txt
</code></pre><p><strong>（3）$?</strong></p><p>$? 指代比目标更新的所有前置条件，之间以空格分隔。比如，规则为 t: p1 p2，其中 p2 的时间戳比 t 新，$?就指代 p2。</p><p><strong>（4）$^</strong></p><p>$^ 指代所有前置条件，之间以空格分隔。比如，规则为 t: p1 p2，那么 $^ 就指代 p1 p2 。</p><p><strong>（5）$*</strong></p><p>$* 指代匹配符 % 匹配的部分，比如% 匹配 f1.txt 中的f1，$* 就表示 f1。</p><p><strong>（6）$(@D) 和 $(@F)</strong></p><p>$(@D) 和 $(@F) 分别指向 $@ 的目录名和文件名。比如，$@是 src/input.c，那么$(@D) 的值为 src，$(@F) 的值为 input.c。</p><p><strong>`（7）$(</strong></p><p>`$( 分别指向 $&lt; 的目录名和文件名。</p><p>所有的自动变量清单，请看<a href=https://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html target=_blank rel=noopener>手册</a>。下面是自动变量的一个例子。</p><pre tabindex=0><code>dest/%.txt: src/%.txt
    @[ -d dest ] || mkdir dest
    cp $&lt; $@
</code></pre><p>上面代码将 src 目录下的 txt 文件，拷贝到 dest 目录下。首先判断 dest 目录是否存在，如果不存在就新建，然后，$&lt; 指代前置文件（src/%.txt），$@ 指代目标文件（dest/%.txt）。</p><h2 id=判断和循环>判断和循环</h2><p>Makefile 使用 Bash 语法，完成判断和循环。</p><pre tabindex=0><code>ifeq ($(CC),gcc)
  libs=$(libs_for_gcc)
else
  libs=$(normal_libs)
endif
</code></pre><p>上面代码判断当前编译器是否 gcc，然后指定不同的库文件。</p><pre tabindex=0><code>LIST = one two three
all:
    for i in $(LIST); do \
        echo $$i; \
     done

# 等同于

all:
    for i in one two three; do \
        echo $i; \
    done
</code></pre><p>上面代码的运行结果。</p><pre tabindex=0><code>one
two
three
</code></pre><h2 id=函数>函数</h2><p>Makefile 还可以使用函数，格式如下。</p><pre tabindex=0><code>$(function arguments)
# 或者
${function arguments}
</code></pre><p>Makefile 提供了许多<a href=http://www.gnu.org/software/make/manual/html_node/Functions.html target=_blank rel=noopener>内置函数</a>，可供调用。下面是几个常用的内置函数。</p><p><strong>（1）shell 函数</strong></p><p>shell 函数用来执行 shell 命令</p><pre tabindex=0><code>srcfiles := $(shell echo src/{00..99}.txt)
</code></pre><p><strong>（2）wildcard 函数</strong></p><p>wildcard 函数用来在 Makefile 中，替换 Bash 的通配符。</p><pre tabindex=0><code>srcfiles := $(wildcard src/*.txt)
</code></pre><p><strong>（3）subst 函数</strong></p><p>subst 函数用来文本替换，格式如下。</p><pre tabindex=0><code>$(subst from,to,text)
</code></pre><p>下面的例子将字符串"feet on the street"替换成"fEEt on the strEEt&rdquo;。</p><pre tabindex=0><code>$(subst ee,EE,feet on the street)
</code></pre><p>下面是一个稍微复杂的例子。</p><pre tabindex=0><code>comma:= ,
empty:=
# space变量用两个空变量作为标识符，当中是一个空格
space:= $(empty) $(empty)
foo:= a b c
bar:= $(subst $(space),$(comma),$(foo))
# bar is now `a,b,c&#39;.
</code></pre><p><strong>（4）patsubst 函数</strong></p><p>patsubst 函数用于模式匹配的替换，格式如下。</p><pre tabindex=0><code>$(patsubst pattern,replacement,text)
</code></pre><p>下面的例子将文件名"x.c.c bar.c&rdquo;，替换成"x.c.o bar.o"。</p><pre tabindex=0><code>$(patsubst %.c,%.o,x.c.c bar.c)
</code></pre><p><strong>（5）替换后缀名</strong></p><p>替换后缀名函数的写法是：变量名 + 冒号 + 后缀名替换规则。它实际上 patsubst 函数的一种简写形式。</p><pre tabindex=0><code>min: $(OUTPUT:.js=.min.js)
</code></pre><p>上面代码的意思是，将变量 OUTPUT 中的后缀名 .js 全部替换成 .min.js 。</p><h1 id=案例>案例</h1><h2 id=执行多个目标>执行多个目标</h2><pre tabindex=0><code>.PHONY: cleanall cleanobj cleandiff

cleanall : cleanobj cleandiff
        rm program

cleanobj
        rm *.o

cleandiff
        rm *.diff
</code></pre><p>上面代码可以调用不同目标，删除不同后缀名的文件，也可以调用一个目标（cleanall），删除所有指定类型的文件。</p><h2 id=编译-c-语言项目>编译 C 语言项目</h2><pre tabindex=0><code>edit : main.o kbd.o command.o display.o
    cc -o edit main.o kbd.o command.o display.o

main.o : main.c defs.h
    cc -c main.c
kbd.o : kbd.c defs.h command.h
    cc -c kbd.c
command.o : command.c defs.h command.h
    cc -c command.c
display.o : display.c defs.h
    cc -c display.c

clean
     rm edit main.o kbd.o command.o display.o

.PHONY: edit clean
</code></pre><p>更完整的案例参考如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-s data-lang=s><span class=line><span class=cl><span class=c1># Makefile for the C code in concurrent-servers.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># This code is in the public domain.</span>
</span></span><span class=line><span class=cl><span class=n>CC</span> <span class=o>=</span> <span class=n>gcc</span>
</span></span><span class=line><span class=cl><span class=n>CCFLAGS</span> <span class=o>=</span> <span class=o>-</span><span class=n>std</span><span class=o>=</span><span class=n>gnu99</span> <span class=o>-</span><span class=n>Wall</span> <span class=o>-</span><span class=n>O3</span> <span class=o>-</span><span class=n>g</span> <span class=o>-</span><span class=n>DNDEBUG</span> <span class=o>-</span><span class=n>pthread</span>
</span></span><span class=line><span class=cl><span class=n>LDFLAGS</span> <span class=o>=</span> <span class=o>-</span><span class=n>lpthread</span> <span class=o>-</span><span class=n>pthread</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># It&#39;s possible to compile uv-server after installing libuv. The full</span>
</span></span><span class=line><span class=cl><span class=c1># instructions for installation I used (including `make install`) are from:</span>
</span></span><span class=line><span class=cl><span class=c1># https://github.com/libuv/libuv/blob/master/README.md.</span>
</span></span><span class=line><span class=cl><span class=c1># libuv compiles into a shared library which is placed alongside the .a in the</span>
</span></span><span class=line><span class=cl><span class=c1># installation directory.</span>
</span></span><span class=line><span class=cl><span class=n>LDLIBUV</span> <span class=o>=</span> <span class=o>-</span><span class=n>luv</span> <span class=o>-</span><span class=n>Wl</span><span class=p>,</span><span class=o>-</span><span class=n>rpath</span><span class=o>=/</span><span class=n>usr</span><span class=o>/</span><span class=n>local</span><span class=o>/</span><span class=n>lib</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>EXECUTABLES</span> <span class=o>=</span> <span class=n>\</span>
</span></span><span class=line><span class=cl>	<span class=n>sequential</span><span class=o>-</span><span class=n>server</span> <span class=n>\</span>
</span></span><span class=line><span class=cl>	<span class=n>select</span><span class=o>-</span><span class=n>server</span> <span class=n>\</span>
</span></span><span class=line><span class=cl>	<span class=n>epoll</span><span class=o>-</span><span class=n>server</span> <span class=n>\</span>
</span></span><span class=line><span class=cl>	<span class=n>uv</span><span class=o>-</span><span class=n>server</span> <span class=n>\</span>
</span></span><span class=line><span class=cl>	<span class=n>uv</span><span class=o>-</span><span class=n>timer</span><span class=o>-</span><span class=n>sleep</span><span class=o>-</span><span class=n>demo</span> <span class=n>\</span>
</span></span><span class=line><span class=cl>	<span class=n>uv</span><span class=o>-</span><span class=n>timer</span><span class=o>-</span><span class=n>work</span><span class=o>-</span><span class=n>demo</span> <span class=n>\</span>
</span></span><span class=line><span class=cl>	<span class=n>uv</span><span class=o>-</span><span class=n>isprime</span><span class=o>-</span><span class=n>server</span> <span class=n>\</span>
</span></span><span class=line><span class=cl>	<span class=n>threadspammer</span> <span class=n>\</span>
</span></span><span class=line><span class=cl>	<span class=n>blocking</span><span class=o>-</span><span class=n>listener</span> <span class=n>\</span>
</span></span><span class=line><span class=cl>	<span class=n>nonblocking</span><span class=o>-</span><span class=n>listener</span> <span class=n>\</span>
</span></span><span class=line><span class=cl>	<span class=n>threaded</span><span class=o>-</span><span class=n>server</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>all</span><span class=o>:</span> <span class=o>$</span><span class=p>(</span><span class=n>EXECUTABLES</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sequential</span><span class=o>-</span><span class=n>server</span><span class=o>:</span> <span class=n>utils.c</span> <span class=n>sequential</span><span class=o>-</span><span class=n>server.c</span>
</span></span><span class=line><span class=cl>	<span class=o>$</span><span class=p>(</span><span class=n>CC</span><span class=p>)</span> <span class=o>$</span><span class=p>(</span><span class=n>CCFLAGS</span><span class=p>)</span> <span class=o>$</span><span class=n>^</span> <span class=o>-</span><span class=n>o</span> <span class=o>$@</span> <span class=o>$</span><span class=p>(</span><span class=n>LDFLAGS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>select</span><span class=o>-</span><span class=n>server</span><span class=o>:</span> <span class=n>utils.c</span> <span class=n>select</span><span class=o>-</span><span class=n>server.c</span>
</span></span><span class=line><span class=cl>	<span class=o>$</span><span class=p>(</span><span class=n>CC</span><span class=p>)</span> <span class=o>$</span><span class=p>(</span><span class=n>CCFLAGS</span><span class=p>)</span> <span class=o>$</span><span class=n>^</span> <span class=o>-</span><span class=n>o</span> <span class=o>$@</span> <span class=o>$</span><span class=p>(</span><span class=n>LDFLAGS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>threaded</span><span class=o>-</span><span class=n>server</span><span class=o>:</span> <span class=n>utils.c</span> <span class=n>threaded</span><span class=o>-</span><span class=n>server.c</span>
</span></span><span class=line><span class=cl>	<span class=o>$</span><span class=p>(</span><span class=n>CC</span><span class=p>)</span> <span class=o>$</span><span class=p>(</span><span class=n>CCFLAGS</span><span class=p>)</span> <span class=o>$</span><span class=n>^</span> <span class=o>-</span><span class=n>o</span> <span class=o>$@</span> <span class=o>$</span><span class=p>(</span><span class=n>LDFLAGS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>epoll</span><span class=o>-</span><span class=n>server</span><span class=o>:</span> <span class=n>utils.c</span> <span class=n>epoll</span><span class=o>-</span><span class=n>server.c</span>
</span></span><span class=line><span class=cl>	<span class=o>$</span><span class=p>(</span><span class=n>CC</span><span class=p>)</span> <span class=o>$</span><span class=p>(</span><span class=n>CCFLAGS</span><span class=p>)</span> <span class=o>$</span><span class=n>^</span> <span class=o>-</span><span class=n>o</span> <span class=o>$@</span> <span class=o>$</span><span class=p>(</span><span class=n>LDFLAGS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>uv</span><span class=o>-</span><span class=n>server</span><span class=o>:</span> <span class=n>utils.c</span> <span class=n>uv</span><span class=o>-</span><span class=n>server.c</span>
</span></span><span class=line><span class=cl>	<span class=o>$</span><span class=p>(</span><span class=n>CC</span><span class=p>)</span> <span class=o>$</span><span class=p>(</span><span class=n>CCFLAGS</span><span class=p>)</span> <span class=o>$</span><span class=n>^</span> <span class=o>-</span><span class=n>o</span> <span class=o>$@</span> <span class=o>$</span><span class=p>(</span><span class=n>LDFLAGS</span><span class=p>)</span> <span class=o>$</span><span class=p>(</span><span class=n>LDLIBUV</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>uv</span><span class=o>-</span><span class=n>timer</span><span class=o>-</span><span class=n>sleep</span><span class=o>-</span><span class=n>demo</span><span class=o>:</span> <span class=n>utils.c</span> <span class=n>uv</span><span class=o>-</span><span class=n>timer</span><span class=o>-</span><span class=n>sleep</span><span class=o>-</span><span class=n>demo.c</span>
</span></span><span class=line><span class=cl>	<span class=o>$</span><span class=p>(</span><span class=n>CC</span><span class=p>)</span> <span class=o>$</span><span class=p>(</span><span class=n>CCFLAGS</span><span class=p>)</span> <span class=o>$</span><span class=n>^</span> <span class=o>-</span><span class=n>o</span> <span class=o>$@</span> <span class=o>$</span><span class=p>(</span><span class=n>LDFLAGS</span><span class=p>)</span> <span class=o>$</span><span class=p>(</span><span class=n>LDLIBUV</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>uv</span><span class=o>-</span><span class=n>timer</span><span class=o>-</span><span class=n>work</span><span class=o>-</span><span class=n>demo</span><span class=o>:</span> <span class=n>utils.c</span> <span class=n>uv</span><span class=o>-</span><span class=n>timer</span><span class=o>-</span><span class=n>work</span><span class=o>-</span><span class=n>demo.c</span>
</span></span><span class=line><span class=cl>	<span class=o>$</span><span class=p>(</span><span class=n>CC</span><span class=p>)</span> <span class=o>$</span><span class=p>(</span><span class=n>CCFLAGS</span><span class=p>)</span> <span class=o>$</span><span class=n>^</span> <span class=o>-</span><span class=n>o</span> <span class=o>$@</span> <span class=o>$</span><span class=p>(</span><span class=n>LDFLAGS</span><span class=p>)</span> <span class=o>$</span><span class=p>(</span><span class=n>LDLIBUV</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>uv</span><span class=o>-</span><span class=n>isprime</span><span class=o>-</span><span class=n>server</span><span class=o>:</span> <span class=n>utils.c</span> <span class=n>uv</span><span class=o>-</span><span class=n>isprime</span><span class=o>-</span><span class=n>server.c</span>
</span></span><span class=line><span class=cl>	<span class=o>$</span><span class=p>(</span><span class=n>CC</span><span class=p>)</span> <span class=o>$</span><span class=p>(</span><span class=n>CCFLAGS</span><span class=p>)</span> <span class=o>$</span><span class=n>^</span> <span class=o>-</span><span class=n>o</span> <span class=o>$@</span> <span class=o>$</span><span class=p>(</span><span class=n>LDFLAGS</span><span class=p>)</span> <span class=o>$</span><span class=p>(</span><span class=n>LDLIBUV</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>threadspammer</span><span class=o>:</span> <span class=n>threadspammer.c</span>
</span></span><span class=line><span class=cl>	<span class=o>$</span><span class=p>(</span><span class=n>CC</span><span class=p>)</span> <span class=o>$</span><span class=p>(</span><span class=n>CCFLAGS</span><span class=p>)</span> <span class=o>$</span><span class=n>^</span> <span class=o>-</span><span class=n>o</span> <span class=o>$@</span> <span class=o>$</span><span class=p>(</span><span class=n>LDFLAGS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>blocking</span><span class=o>-</span><span class=n>listener</span><span class=o>:</span> <span class=n>utils.c</span> <span class=n>blocking</span><span class=o>-</span><span class=n>listener.c</span>
</span></span><span class=line><span class=cl>	<span class=o>$</span><span class=p>(</span><span class=n>CC</span><span class=p>)</span> <span class=o>$</span><span class=p>(</span><span class=n>CCFLAGS</span><span class=p>)</span> <span class=o>$</span><span class=n>^</span> <span class=o>-</span><span class=n>o</span> <span class=o>$@</span> <span class=o>$</span><span class=p>(</span><span class=n>LDFLAGS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>nonblocking</span><span class=o>-</span><span class=n>listener</span><span class=o>:</span> <span class=n>utils.c</span> <span class=n>nonblocking</span><span class=o>-</span><span class=n>listener.c</span>
</span></span><span class=line><span class=cl>	<span class=o>$</span><span class=p>(</span><span class=n>CC</span><span class=p>)</span> <span class=o>$</span><span class=p>(</span><span class=n>CCFLAGS</span><span class=p>)</span> <span class=o>$</span><span class=n>^</span> <span class=o>-</span><span class=n>o</span> <span class=o>$@</span> <span class=o>$</span><span class=p>(</span><span class=n>LDFLAGS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>.PHONY</span><span class=o>:</span> <span class=n>clean</span> <span class=n>format</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>clean</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=n>rm</span> <span class=o>-</span><span class=n>f</span> <span class=o>$</span><span class=p>(</span><span class=n>EXECUTABLES</span><span class=p>)</span> <span class=o>*</span><span class=n>.o</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>format</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=n>clang</span><span class=o>-</span><span class=n>format</span> <span class=o>-</span><span class=n>style</span><span class=o>=</span><span class=n>file</span> <span class=o>-</span><span class=n>i</span> <span class=o>*</span><span class=n>.c</span> <span class=o>*</span><span class=n>.h</span>
</span></span></code></pre></div></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>上一页</div><a href=/books/cs-notes/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/cpp/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E7%BC%96%E8%AF%91%E4%B8%8E%E8%BF%90%E8%A1%8C/cmake/cmakelists.txt/ rel=next>CMakeLists.txt</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div><script type=text/javascript id=clstr_globe async src="//clustrmaps.com/globe.js?d=kgpJG5sWZQpKujBmD-uW1B54-WBPol-DuDtrB2KFjKs"></script></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>