<!DOCTYPE html><html lang="zh" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.5.0 for Hugo" />
  

  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
    <meta name="google-site-verification" content="google69a5cccb61297807" />
    <meta name="baidu-site-verification" content="cqmZHEleVh" />
  
  
  
  
  

  

  
  
  
    
  
  <meta name="description" content="为了满足客户个性化的需求，Hive 被设计成一个很开放的系统，很多内容都支持用户定制，包括： 文件格式：Text File，Sequence File 内存中的数据格式: Java Integer/String, Hadoop IntWritable/Text 用户提供的 map/reduce 脚本：不管什么语言，利用 stdin/stdout" />

  
  <link rel="alternate" hreflang="zh" href="https://ng-tech.icu/books/dataengineering-notes/10.olap/03.rolap/hive/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0/" />

  
  
  
    <meta name="theme-color" content="#0a55a7" />
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css" media="print" onload="this.media='all'">

  
  
  
    
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    

    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css" integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin="anonymous">
    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.0d97305106da5efa530e28b021b4c580.css" />

  




<script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', "G-40NYXJ8823");
</script>


  


  


  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://ng-tech.icu/books/dataengineering-notes/10.olap/03.rolap/hive/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@wx-chevalier" />
    <meta property="twitter:creator" content="@wx-chevalier" />
  
  <meta property="og:site_name" content="Next-gen Tech Edu" />
  <meta property="og:url" content="https://ng-tech.icu/books/dataengineering-notes/10.olap/03.rolap/hive/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0/" />
  <meta property="og:title" content="自定义函数 | Next-gen Tech Edu" />
  <meta property="og:description" content="为了满足客户个性化的需求，Hive 被设计成一个很开放的系统，很多内容都支持用户定制，包括： 文件格式：Text File，Sequence File 内存中的数据格式: Java Integer/String, Hadoop IntWritable/Text 用户提供的 map/reduce 脚本：不管什么语言，利用 stdin/stdout" /><meta property="og:image" content="https://ng-tech.icu/media/sharing.png" />
    <meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png" /><meta property="og:locale" content="zh" />
  
    
    
  

  



  

  

  





  <title>自定义函数 | Next-gen Tech Edu</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="8371b8bbe724fb812c5330fe59267ae1" >
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden="true"></i></button>
  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6 search-title">
          <p>搜索</p>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="关闭"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        
        
      </div>

      
      

      
    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

      <div id="search-common-queries">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    












<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/">Next-gen Tech Edu</a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="切换导航">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/">Next-gen Tech Edu</a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/books-gallery"><span>笔记（万篇）</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#knowledge-map"><span>知识图谱</span></a>
          </li>

          
          

          
          <style>
            .dropdown-item{
              display: inline-flex;
            }
          </style>
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>实验室</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/galaxy-home/gh-craft"><span>Craft 方块世界</span></a>
              
                <a class="dropdown-item" href="/galaxy-home/glossary-cards"><span>3D 知识卡牌</span></a>
              
            </div>
          </li>

          
          

          
          <style>
            .dropdown-item{
              display: inline-flex;
            }
          </style>
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>其他阅读渠道</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="https://zhuanlan.zhihu.com/wxyyxc1992"><img style="width:16px;height:16px;display:inline-block;margin-right:8px" src="https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png"></img><span>知乎</span></a>
              
                <a class="dropdown-item" href="https://segmentfault.com/blog/wxyyxc1992"><img style="width:16px;height:16px;display:inline-block;margin-right:8px" src="https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png"></img><span>SegmentFault</span></a>
              
                <a class="dropdown-item" href="https://zhuanlan.zhihu.com/wxyyxc1992"><img style="width:16px;height:16px;display:inline-block;margin-right:8px" src="https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png"></img><span>掘金</span></a>
              
            </div>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
        
        <li class="nav-item">
          <a class="nav-link js-search" href="#" aria-label="搜索"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item">
            <a class="nav-link" href="https://github.com/wx-chevalier" aria-label="GitHub"><i class="fa-brands fa-github" aria-hidden="true"></i></a>
        </li>
        

        
        
        

        
        
        
        <div></div>
        
        <style>
        @media only screen and (max-width: 600px) {
          .jimmysong-template {
            display: none!important;
          }
        }
        </style>
        
        <li class="jimmysong-template" style="color: white;font-size: 12px;">
          <a href="https://jimmysong.io" style="color: white">By Jimmy Song's Template</a>
        </li>
      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    




<link rel="stylesheet" href="//unpkg.com/heti/umd/heti.min.css">
<div class="container-xl docs">
  <div class="row flex-xl-nowrap">
    <div class="docs-sidebar">
      <form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <div class="d-flex">
      <span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">
        
          Hive
        
      </span>
      <span><i class="fas fa-chevron-down"></i></span>
    </div>
  </button>

  
  <button class="form-control sidebar-search js-search d-none d-md-flex">
    <i class="fas fa-search pr-2"></i>
    <span class="sidebar-search-text">搜索...</span>
    <span class="sidebar-search-shortcut">/</span>
  </button>
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  
  
  
  

  
  
    

    
      

      <ul class="nav docs-sidenav">
        <li style="display: inline-flex">
          <a style="cursor: pointer;" onclick="window.history.back()">
            <i class="fas fa-arrow-left pr-1"></i>
            Back
          </a>
          <span>|</span>
          <a href="/books/">
            <i class="fa-solid fa-house" style="margin-right: 4px"></i>
            Books
          </a>
        </li>
      </ul>

      
      
        
          
        
      



  
    
    
    
    
      
    
    

    
    
    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id4e0f8c3faf84cfed417b34a5336cc2fe&#34;)" href="#id4e0f8c3faf84cfed417b34a5336cc2fe" aria-expanded="false" aria-controls="id4e0f8c3faf84cfed417b34a5336cc2fe" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/books/dataengineering-notes/10.olap/03.rolap/">03.ROLAP</a>
    <a class="nav-toogle d-inline level" aria-hidden="false" data-toggle="collapse" href="#id4e0f8c3faf84cfed417b34a5336cc2fe" aria-expanded="false" aria-controls="id4e0f8c3faf84cfed417b34a5336cc2fe">
    
    <i class="fa-solid fa-angle-down" id="caret-id4e0f8c3faf84cfed417b34a5336cc2fe"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  show " id="id4e0f8c3faf84cfed417b34a5336cc2fe">
      



  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id5f707115acabd1a5f4bfafe105311d53&#34;)" href="#id5f707115acabd1a5f4bfafe105311d53" aria-expanded="false" aria-controls="id5f707115acabd1a5f4bfafe105311d53" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/books/dataengineering-notes/10.olap/03.rolap/clickhouse/">ClickHouse</a>
    <a class="nav-toogle d-inline level" aria-hidden="false" data-toggle="collapse" href="#id5f707115acabd1a5f4bfafe105311d53" aria-expanded="false" aria-controls="id5f707115acabd1a5f4bfafe105311d53">
    
        <i class="fa-solid fa-angle-right" id="caret-id5f707115acabd1a5f4bfafe105311d53"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id5f707115acabd1a5f4bfafe105311d53">
      



  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id6e63ef1a29b922c59103f5dfbb442c93&#34;)" href="#id6e63ef1a29b922c59103f5dfbb442c93" aria-expanded="false" aria-controls="id6e63ef1a29b922c59103f5dfbb442c93" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/books/dataengineering-notes/10.olap/03.rolap/clickhouse/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/">99.参考资料</a>
    <a class="nav-toogle d-inline level" aria-hidden="false" data-toggle="collapse" href="#id6e63ef1a29b922c59103f5dfbb442c93" aria-expanded="false" aria-controls="id6e63ef1a29b922c59103f5dfbb442c93">
    
        <i class="fa-solid fa-angle-right" id="caret-id6e63ef1a29b922c59103f5dfbb442c93"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id6e63ef1a29b922c59103f5dfbb442c93">
      



  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id2630ac5ddfb74af865dc1b0d5966e10a&#34;)" href="#id2630ac5ddfb74af865dc1b0d5966e10a" aria-expanded="false" aria-controls="id2630ac5ddfb74af865dc1b0d5966e10a" aria-hidden="false" data-toggle="collapse">
    
    </div>
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id771b063e80bd392ca5330c93e50ea251&#34;)" href="#id771b063e80bd392ca5330c93e50ea251" aria-expanded="false" aria-controls="id771b063e80bd392ca5330c93e50ea251" aria-hidden="false" data-toggle="collapse">
    
    </div>
    

    
      </div>
    

      
        </ul>
      
    

    
      </div>
    

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-idf8d11d6dbd12ce5067f78a19792265e4&#34;)" href="#idf8d11d6dbd12ce5067f78a19792265e4" aria-expanded="false" aria-controls="idf8d11d6dbd12ce5067f78a19792265e4" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/books/dataengineering-notes/10.olap/03.rolap/hive/">Hive</a>
    <a class="nav-toogle d-inline level" aria-hidden="false" data-toggle="collapse" href="#idf8d11d6dbd12ce5067f78a19792265e4" aria-expanded="false" aria-controls="idf8d11d6dbd12ce5067f78a19792265e4">
    
    <i class="fa-solid fa-angle-down" id="caret-idf8d11d6dbd12ce5067f78a19792265e4"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  show " id="idf8d11d6dbd12ce5067f78a19792265e4">
      



  <li class="child level "><a href="/books/dataengineering-notes/10.olap/03.rolap/hive/hiveql/">HiveQL</a></li>




  <li class="child level "><a href="/books/dataengineering-notes/10.olap/03.rolap/hive/%E8%A1%A8%E6%93%8D%E4%BD%9C/">表操作</a></li>




  <li class="child level "><a href="/books/dataengineering-notes/10.olap/03.rolap/hive/%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/">介绍与部署</a></li>




  <li class="child level "><a href="/books/dataengineering-notes/10.olap/03.rolap/hive/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/">数据类型</a></li>




  <li class="child level "><a href="/books/dataengineering-notes/10.olap/03.rolap/hive/%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B%E4%B8%8E%E5%AD%98%E5%82%A8%E6%A0%BC%E5%BC%8F/">文件类型与存储格式</a></li>




  <li class="child level active"><a href="/books/dataengineering-notes/10.olap/03.rolap/hive/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0/">自定义函数</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-idbbe68fcc47bbfc051ab9251b2ef13b92&#34;)" href="#idbbe68fcc47bbfc051ab9251b2ef13b92" aria-expanded="false" aria-controls="idbbe68fcc47bbfc051ab9251b2ef13b92" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/books/dataengineering-notes/10.olap/03.rolap/presto/">Presto</a>
    <a class="nav-toogle d-inline level" aria-hidden="false" data-toggle="collapse" href="#idbbe68fcc47bbfc051ab9251b2ef13b92" aria-expanded="false" aria-controls="idbbe68fcc47bbfc051ab9251b2ef13b92">
    
        <i class="fa-solid fa-angle-right" id="caret-idbbe68fcc47bbfc051ab9251b2ef13b92"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="idbbe68fcc47bbfc051ab9251b2ef13b92">
      



  <li class="child level "><a href="/books/dataengineering-notes/10.olap/03.rolap/presto/%E9%83%A8%E7%BD%B2%E4%B8%8E%E6%8E%A7%E5%88%B6/">部署与控制</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id0f89ab3614f39722bcd4326f1698d670&#34;)" href="#id0f89ab3614f39722bcd4326f1698d670" aria-expanded="false" aria-controls="id0f89ab3614f39722bcd4326f1698d670" aria-hidden="false" data-toggle="collapse">
    
    </div>
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-ide3ab29b0052c1917e6915904166ac2cb&#34;)" href="#ide3ab29b0052c1917e6915904166ac2cb" aria-expanded="false" aria-controls="ide3ab29b0052c1917e6915904166ac2cb" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/books/dataengineering-notes/10.olap/03.rolap/sqoop/">Sqoop</a>
    <a class="nav-toogle d-inline level" aria-hidden="false" data-toggle="collapse" href="#ide3ab29b0052c1917e6915904166ac2cb" aria-expanded="false" aria-controls="ide3ab29b0052c1917e6915904166ac2cb">
    
        <i class="fa-solid fa-angle-right" id="caret-ide3ab29b0052c1917e6915904166ac2cb"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="ide3ab29b0052c1917e6915904166ac2cb">
      



  <li class="child level "><a href="/books/dataengineering-notes/10.olap/03.rolap/sqoop/%E4%BB%8B%E7%BB%8D%E4%B8%8E%E9%83%A8%E7%BD%B2/">介绍与部署</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-idb64e26988625777ae4ba0761eb90c628&#34;)" href="#idb64e26988625777ae4ba0761eb90c628" aria-expanded="false" aria-controls="idb64e26988625777ae4ba0761eb90c628" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/books/dataengineering-notes/10.olap/03.rolap/starrocks/">StarRocks</a>
    <a class="nav-toogle d-inline level" aria-hidden="false" data-toggle="collapse" href="#idb64e26988625777ae4ba0761eb90c628" aria-expanded="false" aria-controls="idb64e26988625777ae4ba0761eb90c628">
    
        <i class="fa-solid fa-angle-right" id="caret-idb64e26988625777ae4ba0761eb90c628"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="idb64e26988625777ae4ba0761eb90c628">
      



  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id6624660e0521018885e67cb121612415&#34;)" href="#id6624660e0521018885e67cb121612415" aria-expanded="false" aria-controls="id6624660e0521018885e67cb121612415" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/books/dataengineering-notes/10.olap/03.rolap/starrocks/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/">99.参考资料</a>
    <a class="nav-toogle d-inline level" aria-hidden="false" data-toggle="collapse" href="#id6624660e0521018885e67cb121612415" aria-expanded="false" aria-controls="id6624660e0521018885e67cb121612415">
    
        <i class="fa-solid fa-angle-right" id="caret-id6624660e0521018885e67cb121612415"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id6624660e0521018885e67cb121612415">
      



  <li class="child level "><a href="/books/dataengineering-notes/10.olap/03.rolap/starrocks/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2022-10-%E5%88%86%E9%92%9F%E5%B8%A6%E4%BD%A0%E5%85%A8%E9%9D%A2%E4%BA%86%E8%A7%A3-starrocks/">2022-10 分钟带你全面了解 StarRocks！</a></li>

      
        </ul>
      
    

    
      </div>
    

      
        </ul>
      
    

    
      </div>
    

      
        </ul>
      
    

    
      </div>
    

    
  
</nav>

    </div>

    
    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      
     
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">目录</a></li>
      </ul>
     

      <nav id="TableOfContents">
  <ul>
    <li><a href="#definition">Definition</a>
      <ul>
        <li><a href="#extends-udf">Extends UDF</a></li>
        <li><a href="#extends-genericudf">Extends GenericUDF</a></li>
      </ul>
    </li>
    <li><a href="#usage">Usage</a>
      <ul>
        <li><a href="#临时添加-udf">临时添加 UDF</a></li>
        <li><a href="#进入会话前自动创建">进入会话前自动创建</a></li>
        <li><a href="#注册为内部函数">注册为内部函数</a></li>
      </ul>
    </li>
  </ul>
</nav>

      
<div class="subscribe-module col-24 mt-1">
    <img src="https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png" alt="image" title="王下邀月熊的微信公众号"/>
</div>



    </div>
    

    <main class="py-md-3 pl-md-3 docs-content col-xl-8" role="main">

      <article class="article">

          

          <h1>自定义函数</h1>

          <div class="article-style">
            <p>为了满足客户个性化的需求，Hive 被设计成一个很开放的系统，很多内容都支持用户定制，包括：</p>
<ul>
<li>文件格式：Text File，Sequence File</li>
<li>内存中的数据格式: Java Integer/String, Hadoop IntWritable/Text</li>
<li>用户提供的 map/reduce 脚本：不管什么语言，利用 stdin/stdout 传输数据</li>
<li>用户自定义函数</li>
</ul>
<h1 id="user-defined-function">User Defined Function</h1>
<blockquote>
<ul>
<li><a href="http://blog.csdn.net/bitcarmanlee/article/details/51249260" target="_blank" rel="noopener">hive udf 开发超详细手把手教程 </a></li>
</ul>
</blockquote>
<p>用户可以使用‘show functions’ 查看 function list，可以使用&rsquo;describe function function-name&rsquo;查看函数说明。</p>
<pre tabindex="0"><code>hive&gt; show functions;
OK
!
!=
......
Time taken: 0.275 seconds
hive&gt; desc function substr;
OK
substr(str, pos[, len]) - returns the substring of str that starts at pos and is of length len orsubstr(bin, pos[, len]) - returns the slice of byte array that starts at pos and is of length len
Time taken: 0.095 seconds
</code></pre><p>hive 提供的 build-in 函数包括以下几类：</p>
<ol>
<li>关系操作符：包括 =、&lt;&gt;、&lt;=、&gt;=等</li>
<li>算数操作符：包括 +、-、*、／等</li>
<li>逻辑操作符：包括 AND、&amp;&amp;、OR、|| 等</li>
<li>复杂类型构造函数：包括 map、struct、create_union 等</li>
<li>复杂类型操作符：包括 A[n]、Map[key]、S.x</li>
<li>数学操作符：包括 ln(double a)、sqrt(double a)等</li>
<li>集合操作符：包括 size(Array<T>)、sort_array(Array<T>)等</li>
<li>类型转换函数: binary(string|binary)、cast(expr as <type>)</li>
<li>日期函数：包括 from_unixtime(bigint unixtime[, string format])、unix_timestamp()等 10.条件函数：包括 if(boolean testCondition, T valueTrue, T valueFalseOrNull)等</li>
<li>字符串函数：包括 acat(string|binary A, string|binary B&hellip;)等</li>
<li>其他：xpath、get_json_objectscii(string str)、con</li>
</ol>
<h2 id="definition">Definition</h2>
<p>编写 Hive UDF 有两种方式：</p>
<ol>
<li>extends UDF，重写 evaluate 方法</li>
<li>extends GenericUDF，重写 initialize、getDisplayString、evaluate 方法</li>
</ol>
<h3 id="extends-udf">Extends UDF</h3>
<p>如下的用法是将大写转化为小写</p>
<pre tabindex="0"><code>    package test.udf;

    import org.apache.hadoop.hive.ql.exec.UDF;
    import org.apache.hadoop.io.Text;

    public class ToLowerCase extends UDF {
        public Text evaluate(final Text s) {
            if (s == null) { return null; }
            return new Text(s.toString().toLowerCase());
        }
    }
</code></pre><h3 id="extends-genericudf">Extends GenericUDF</h3>
<p>计算 array 中去重后元素个数</p>
<pre tabindex="0"><code>    package test.udf;
    import org.apache.hadoop.hive.ql.exec.Description;
    import org.apache.hadoop.hive.ql.exec.UDFArgumentException;
    import org.apache.hadoop.hive.ql.exec.UDFArgumentTypeException;
    import org.apache.hadoop.hive.ql.metadata.HiveException;
    import org.apache.hadoop.hive.ql.udf.generic.GenericUDF;
    import org.apache.hadoop.hive.serde2.objectinspector.ListObjectInspector;
    import org.apache.hadoop.hive.serde2.objectinspector.ObjectInspector;
    import org.apache.hadoop.hive.serde2.objectinspector.ObjectInspectorUtils;
    import org.apache.hadoop.hive.serde2.objectinspector.ObjectInspector.Category;
    import org.apache.hadoop.hive.serde2.objectinspector.primitive.PrimitiveObjectInspectorFactory;
    import org.apache.hadoop.io.IntWritable;

    /**
     * UDF:
     * Get nubmer of objects with duplicate elements eliminated

     */
    @Description(name = &#34;array_uniq_element_number&#34;, value = &#34;_FUNC_(array) - Returns nubmer of objects with duplicate elements eliminated.&#34;, extended = &#34;Example:\n&#34;
                    + &#34;  &gt; SELECT _FUNC_(array(1, 2, 2, 3, 3)) FROM src LIMIT 1;\n&#34; + &#34;  3&#34;)
    public class UDFArrayUniqElementNumber extends GenericUDF {

            private static final int ARRAY_IDX = 0;
            private static final int ARG_COUNT = 1; // Number of arguments to this UDF
            private static final String FUNC_NAME = &#34;ARRAY_UNIQ_ELEMENT_NUMBER&#34;; // External Name

            private ListObjectInspector arrayOI;
            private ObjectInspector arrayElementOI;
            private final IntWritable result = new IntWritable(-1);

            public ObjectInspector initialize(ObjectInspector[] arguments)
                            throws UDFArgumentException {

                    // Check if two arguments were passed
                    if (arguments.length != ARG_COUNT) {
                            throw new UDFArgumentException(&#34;The function &#34; + FUNC_NAME
                                            + &#34; accepts &#34; + ARG_COUNT + &#34; arguments.&#34;);
                    }

                    // Check if ARRAY_IDX argument is of category LIST
                    if (!arguments[ARRAY_IDX].getCategory().equals(Category.LIST)) {
                            throw new UDFArgumentTypeException(ARRAY_IDX, &#34;\&#34;&#34;
                                            + org.apache.hadoop.hive.serde.Constants.LIST_TYPE_NAME
                                            + &#34;\&#34; &#34; + &#34;expected at function ARRAY_CONTAINS, but &#34;
                                            + &#34;\&#34;&#34; + arguments[ARRAY_IDX].getTypeName() + &#34;\&#34; &#34;
                                            + &#34;is found&#34;);
                    }

                    arrayOI = (ListObjectInspector) arguments[ARRAY_IDX];
                    arrayElementOI = arrayOI.getListElementObjectInspector();

                    return PrimitiveObjectInspectorFactory.writableIntObjectInspector;
            }

            public IntWritable evaluate(DeferredObject[] arguments)
                            throws HiveException {

                    result.set(0);

                    Object array = arguments[ARRAY_IDX].get();
                    int arrayLength = arrayOI.getListLength(array);
                    if (arrayLength &lt;= 1) {
                            result.set(arrayLength);
                            return result;
                    }

                    //element compare; Algorithm complexity: O(N^2)
                    int num = 1;
                    int i, j;
                    for(i = 1; i &lt; arrayLength; i++)
                    {
                            Object listElement = arrayOI.getListElement(array, i);
                            for(j = i - 1; j &gt;= 0; j--)
                            {
                                    if (listElement != null) {
                                            Object tmp = arrayOI.getListElement(array, j);
                                            if (ObjectInspectorUtils.compare(tmp, arrayElementOI, listElement,
                                                            arrayElementOI) == 0) {
                                                    break;
                                            }
                                    }
                            }
                            if(-1 == j)
                            {
                                    num++;
                            }
                    }

                    result.set(num);
                    return result;
            }

            public String getDisplayString(String[] children) {
                    assert (children.length == ARG_COUNT);
                    return &#34;array_uniq_element_number(&#34; + children[ARRAY_IDX]+ &#34;)&#34;;
            }
    }
</code></pre><h2 id="usage">Usage</h2>
<h3 id="临时添加-udf">临时添加 UDF</h3>
<pre tabindex="0"><code>hive&gt; select * from test;
OK
Hello
wORLD
ZXM
ljz
Time taken: 13.76 seconds
hive&gt; add jar /home/work/udf.jar;
Added /home/work/udf.jar to class path
Added resource: /home/work/udf.jar
hive&gt; create temporary function mytest as &#39;test.udf.ToLowerCase&#39;;
OK
Time taken: 0.103 seconds
hive&gt; show functions;
......
mytest
......
hive&gt; select mytest(test.name) from test;
......
OK
hello
world
zxm
ljz
Time taken: 38.218 seconds
</code></pre><p>这种方式在会话结束后，函数自动销毁，因此每次打开新的会话，都需要重新 add jar 并且 create temporary function。</p>
<h3 id="进入会话前自动创建">进入会话前自动创建</h3>
<p>使用 hive -i 参数在进入 hive 时自动初始化</p>
<pre tabindex="0"><code>    $ cat hive_init
    add jar /home/work/udf.jar;
    create temporary function mytest as &#39;test.udf.ToLowerCase&#39;;
    $ hive -i hive_init
    Logging initialized using configuration in file:/home/work/hive/hive-0.8.1/conf/hive-log4j.properties
    Hive history file=/tmp/work/hive_job_log_work_201209200147_1951517527.txt
    hive&gt; show functions;
    ......
    mytest
    ......
    hive&gt; select mytest(test.name) from test;
    ......
    OK
    hello
    world
    zxm
    ljz
</code></pre><p>方法 2 和方法 1 本质上是相同的，区别在于方法 2 在会话初始化时自动完成</p>
<h3 id="注册为内部函数">注册为内部函数</h3>
<blockquote>
<ul>
<li><a href="http://my.oschina.net/wangjiankui/blog/64230" target="_blank" rel="noopener">自定义 UDF+重编译 Hive</a></li>
</ul>
</blockquote>
<p>和前两者相比，第三种方式直接将用户的自定义函数作为注册为内置函数，未来使用起来非常简单，但这种方式也非常危险，一旦出错，将是灾难性的，因此，建议如果不是特别通用，并且固化下来的函数，还是使用前两种方式比较靠谱。</p>
<h1 id="udaf">UDAF</h1>
<p>Hive 查询数据时，有些聚类函数在 HQL 没有自带，需要用户自定义实现
•用户自定义聚合函数: Sum, Average…… n – 1
•UDAF(User- Defined Aggregation Funcation)
用法
•一下两个包是必须的 import org.apache.hadoop.hive.ql.exec.UDAF 和 org.apache.hadoop.hive.ql.exec.UDAFEvaluator
开发步骤
•函数类需要继承 UDAF 类，内部类 Evaluator 实 UDAFEvaluator 接口
•Evaluator 需要实现 init、iterate、terminatePartial、merge、terminate 这几个函数
a)init 函数实现接口 UDAFEvaluator 的 init 函数。
b)iterate 接收传入的参数，并进行内部的轮转。其返回类型为 boolean。
c)terminatePartial 无参数，其为 iterate 函数轮转结束后，返回轮转数据，terminatePartial 类似于 hadoop 的 Combiner。
d)merge 接收 terminatePartial 的返回结果，进行数据 merge 操作，其返回类型为 boolean。
e)terminate 返回最终的聚集函数结果。
执行步骤
•执行求平均数函数的步骤
a)将 java 文件编译成 Avg_test.jar。
b)进入 hive 客户端添加 jar 包：
hive&gt;add jar /run/jar/Avg_test.jar。
c)创建临时函数：
hive&gt;create temporary function avg_test &lsquo;hive.udaf.Avg&rsquo;;
d)查询语句：
hive&gt;select avg_test(scores.math) from scores;
e)销毁临时函数：
hive&gt;drop temporary function avg_test;</p>
<p>UDAF 代码示例
public class MyAvg extends UDAF {</p>
<p>public static class AvgEvaluator implements UDAFEvaluator {
}
public void init() {}
public boolean iterate(Double o) {}
public AvgState terminatePartial() {}
public boolean terminatePartial(Double o) { }
public Double terminate() {}</p>
<p>}</p>
<h1 id="udtf">UDTF</h1>
<p>UDTF(User-Defined Table-Generating Functions) 用来解决 输入一行输出多行(On-to-many maping) 的需求。
开发步骤
•UDTF 步骤：
•必须继承 org.apache.Hadoop.hive.ql.udf.generic.GenericUDTF
•实现 initialize, process, close 三个方法
•UDTF 首先会
•调用 initialize 方法，此方法返回 UDTF 的返回行的信息(返回个数，类型)
初始化完成后，会调用 process 方法，对传入的参数进行处理，可以通过 forword()方法把结果返回
•最后 close()方法调用，对需要清理的方法进行清理
使用方法
•UDTF 有两种使用方法，一种直接放到 select 后面，一种和 lateral view 一起使用
•直接 select 中使用：select explode<em>map(properties) as (col1,col2) from src;
•不可以添加其他字段使用：select a, explode_map(properties) as (col1,col2) from src
•不可以嵌套调用：select explode_map(explode_map(properties)) from src
•不可以和 group by/cluster by/distribute by/sort by 一起使用：select explode_map(properties) as (col1,col2) from src group by col1, col2
•和 lateral view 一起使用：select src.id, mytable.col1, mytable.col2 from src lateral view explode_map(properties) mytable as col1, col2;
此方法更为方便日常使用。执行过程相当于单独执行了两次抽取，然后 union 到一个表里。
lateral view
• Lateral View 语法
•lateralView: LATERAL VIEW udtf(expression) tableAlias AS columnAlias (&rsquo;,&rsquo; columnAlias)</em> fromClause: FROM baseTable (lateralView)_</p>
<p>•Lateral View 用于 UDTF(user-defined table generating functions)中将行转成列，例如 explode().
•目前 Lateral View 不支持有上而下的优化。如果使用 Where 子句，查询可能将不被编译。解决方法见：
此时，在查询之前执行 set hive.optimize.ppd=false;
• 例子
•pageAds。它有两个列
string pageid
Array<int> adid_list
&quot; front_page&quot;
[1, 2, 3]
&ldquo;contact_page &quot;
[ 3, 4, 5]
•SELECT pageid, adid FROM pageAds LATERAL VIEW explode(adid_list) adTable AS adid;
•将输出如下结果
string pageid int adid
&ldquo;front_page&rdquo; 1
…….
“contact_page&rdquo; 3</p>
<p>代码示例
public class MyUDTF extends GenericUDTF{
public StructObjectInspector initialize(ObjectInspector[] args) {}
public void process(Object[] args) throws HiveException { }
}</p>

          </div>

          



          
          
          <div class="article-widget">
            
<div class="container-xl row post-nav">
  
  
  
  <div class="col-6 post-nav-item">
    <div class="meta-nav">上一页</div>
    <a href="/books/dataengineering-notes/10.olap/03.rolap/hive/%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B%E4%B8%8E%E5%AD%98%E5%82%A8%E6%A0%BC%E5%BC%8F/" rel="next">文件类型与存储格式</a>
  </div>
  
  
</div>

          </div>
          

        <div class="body-footer">
          <p>最近更新于 0001-01-01</p>

          



          


  
  
  

  

  
  <section id="comments" class="mb-3 pt-0">
    
<div id="disqus_thread"></div>
<script>
  var disqus_config = function () {
    
    
    
  };
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
      return;
    }
    var d = document, s = d.createElement('script'); 
    s.async = true;
    s.src = 'https://' + "ngte" + '.disqus.com/embed.js';
    
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  </section>
  



          


        </div>

      </article>

      <footer class="site-footer">

  



  

  
  <div class="copyright py-4 bg-footer">
      <div class="row justify-content-center">
        <div class="text-center footer-color">
          <p class="mb-0">© 2017-2022 NGTE all rights reserved</p>
        </div>
    </div>
  </div>

  <script type="text/javascript" id="clstr_globe" async src="//clustrmaps.com/globe.js?d=kgpJG5sWZQpKujBmD-uW1B54-WBPol-DuDtrB2KFjKs"></script>
  
</footer>


    </main>
  </div>
</div>
<script src="//unpkg.com/heti/umd/heti-addon.min.js"></script>
<script>
  const heti = new Heti('.article');
  heti.autoSpacing();
</script>
<script type="text/javascript">
  window.$crisp = [];
  window.CRISP_WEBSITE_ID = "12adcc35-9621-4313-8262-62dc654b29d8";
  (function () {
    setTimeout(function() {
      d = document;
      s = d.createElement("script");
      s.src = "https://client.crisp.chat/l.js";
      s.async = 1;
      d.getElementsByTagName("head")[0].appendChild(s);
    }, 2500);
  })();
</script>
  </div>

  <div class="page-footer">
    
    
  </div>

      

    
    <script src="/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js"></script>

    
    
    
      

      
      

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
        
        
      

    

    
    
    

    
    
    
      
      <script id="search-hit-algolia-template" type="text/html">
        <div class="search-hit">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a>
            </div>
            <div class="article-metadata search-hit-type">{{type}}</div>
            <p class="search-hit-description">{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p>
          </div>
        </div>
      </script>
      
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js" crossorigin="anonymous"></script>
      
      
    

    
    

    
    
    
    
      <script id="dsq-count-scr" src="https://ngte.disqus.com/count.js" async></script>
      
    

    
    
      
      
      
      
      
      
      
    

    
    <script src="/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js" type="module"></script>
    

    
    
    
    <script id="page-data" type="application/json">{"use_headroom":false}</script>

    
    
    
    
    
    
    
    
    
    
    <script src="/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js"></script>

    
    
    
    
    
    
    <script>

var mybutton = document.getElementById("backTopBtn");


window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}


function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>


    

    
    
    <script src="https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    <script>



(function() {
  'use strict';

  if(!document.queryCommandSupported('copy')) {
    return;
  }

  function flashCopyMessage(el, msg) {
    el.className = "highlight-copy-btn";
    el.textContent = msg;
    setTimeout(function() {
      el.textContent = "";
      el.className = "highlight-copy-btn fa fa-copy";
    }, 1000);
  }

  function selectText(node) {
    var selection = window.getSelection();
    var range = document.createRange();
    range.selectNodeContents(node);
    selection.removeAllRanges();
    selection.addRange(range);
    return selection;
  }

  function addCopyButton(containerEl) {
    var copyBtn = document.createElement("button");
    copyBtn.className = "highlight-copy-btn fa fa-copy";
    copyBtn.textContent = "";

    var codeEl = containerEl.firstElementChild;
    copyBtn.addEventListener('click', function() {
      try {
        var selection = selectText(codeEl);
        document.execCommand('copy');
        selection.removeAllRanges();
        
        flashCopyMessage(copyBtn, '已复制')
        
      } catch(e) {
        console && console.log(e);
        flashCopyMessage(copyBtn, 'Failed :\'(')
      }
    });

    containerEl.appendChild(copyBtn);
  }

  
  var highlightBlocks = document.getElementsByClassName('highlight');
  Array.prototype.forEach.call(highlightBlocks, addCopyButton);
})();
</script>

    


</body>
</html>
