<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="YUV YUV 是一种颜色编码方方式，通常由彩色摄像机进行取像，然后把取得的彩色图像信号经过分色、分别放大校正后得到 RGB，再经过矩阵变换得到亮度信号 Y 和两个色差信号 B-Y（即 U）、R-Y（即 V），最后将亮度和色"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/cg-series/10.%E5%9B%BE%E5%83%8F%E4%B8%8E%E5%AA%92%E4%BD%93/%E5%9B%BE%E5%83%8F%E6%95%B0%E5%AD%97%E5%8C%96/%E5%BD%A9%E8%89%B2%E5%9B%BE%E5%83%8F/yuv/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/cg-series/10.%E5%9B%BE%E5%83%8F%E4%B8%8E%E5%AA%92%E4%BD%93/%E5%9B%BE%E5%83%8F%E6%95%B0%E5%AD%97%E5%8C%96/%E5%BD%A9%E8%89%B2%E5%9B%BE%E5%83%8F/yuv/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/cg-series/10.%E5%9B%BE%E5%83%8F%E4%B8%8E%E5%AA%92%E4%BD%93/%E5%9B%BE%E5%83%8F%E6%95%B0%E5%AD%97%E5%8C%96/%E5%BD%A9%E8%89%B2%E5%9B%BE%E5%83%8F/yuv/"><meta property="og:title" content="YUV | Next-gen Tech Edu"><meta property="og:description" content="YUV YUV 是一种颜色编码方方式，通常由彩色摄像机进行取像，然后把取得的彩色图像信号经过分色、分别放大校正后得到 RGB，再经过矩阵变换得到亮度信号 Y 和两个色差信号 B-Y（即 U）、R-Y（即 V），最后将亮度和色"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>YUV | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=d5ff30ea68d57e354a4987c28d9241eb><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">彩色图像</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ide59ee2baf24f1a99c7e2e4fa97b566fd")' href=#ide59ee2baf24f1a99c7e2e4fa97b566fd aria-expanded=false aria-controls=ide59ee2baf24f1a99c7e2e4fa97b566fd aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/cg-series/10.%E5%9B%BE%E5%83%8F%E4%B8%8E%E5%AA%92%E4%BD%93/%E5%9B%BE%E5%83%8F%E6%95%B0%E5%AD%97%E5%8C%96/>图像数字化</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ide59ee2baf24f1a99c7e2e4fa97b566fd aria-expanded=false aria-controls=ide59ee2baf24f1a99c7e2e4fa97b566fd><i class="fa-solid fa-angle-down" id=caret-ide59ee2baf24f1a99c7e2e4fa97b566fd></i></a></div><ul class="nav docs-sidenav collapse show" id=ide59ee2baf24f1a99c7e2e4fa97b566fd><li class="child level"><a href=/books/cg-series/10.%E5%9B%BE%E5%83%8F%E4%B8%8E%E5%AA%92%E4%BD%93/%E5%9B%BE%E5%83%8F%E6%95%B0%E5%AD%97%E5%8C%96/%E9%87%87%E6%A0%B7%E4%B8%8E%E9%87%8F%E5%8C%96/>采样与量化</a></li><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id0ebe913f00ab3fb2155b47b1397d7417")' href=#id0ebe913f00ab3fb2155b47b1397d7417 aria-expanded=false aria-controls=id0ebe913f00ab3fb2155b47b1397d7417 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/cg-series/10.%E5%9B%BE%E5%83%8F%E4%B8%8E%E5%AA%92%E4%BD%93/%E5%9B%BE%E5%83%8F%E6%95%B0%E5%AD%97%E5%8C%96/%E5%BD%A9%E8%89%B2%E5%9B%BE%E5%83%8F/>彩色图像</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id0ebe913f00ab3fb2155b47b1397d7417 aria-expanded=false aria-controls=id0ebe913f00ab3fb2155b47b1397d7417><i class="fa-solid fa-angle-down" id=caret-id0ebe913f00ab3fb2155b47b1397d7417></i></a></div><ul class="nav docs-sidenav collapse show" id=id0ebe913f00ab3fb2155b47b1397d7417><li class="child level active"><a href=/books/cg-series/10.%E5%9B%BE%E5%83%8F%E4%B8%8E%E5%AA%92%E4%BD%93/%E5%9B%BE%E5%83%8F%E6%95%B0%E5%AD%97%E5%8C%96/%E5%BD%A9%E8%89%B2%E5%9B%BE%E5%83%8F/yuv/>YUV</a></li></ul></div><li class="child level"><a href=/books/cg-series/10.%E5%9B%BE%E5%83%8F%E4%B8%8E%E5%AA%92%E4%BD%93/%E5%9B%BE%E5%83%8F%E6%95%B0%E5%AD%97%E5%8C%96/%E5%93%81%E8%B4%A8%E4%B8%8E%E5%99%AA%E5%A3%B0/>品质与噪声</a></li><li class="child level"><a href=/books/cg-series/10.%E5%9B%BE%E5%83%8F%E4%B8%8E%E5%AA%92%E4%BD%93/%E5%9B%BE%E5%83%8F%E6%95%B0%E5%AD%97%E5%8C%96/%E8%A7%86%E8%A7%89%E6%84%9F%E7%9F%A5/>视觉感知</a></li></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#yuvy-格式属于-yuv422>YUVY 格式（属于 YUV422）</a></li><li><a href=#uyvy-格式属于-yuv422>UYVY 格式（属于 YUV422）</a></li><li><a href=#yuv422p属于-yuv422>YUV422P（属于 YUV422）</a></li><li><a href=#yv12yu12-格式属于-yuv420>YV12，YU12 格式（属于 YUV420）</a></li><li><a href=#nv12nv21属于-yuv420>NV12、NV21（属于 YUV420）</a></li><li><a href=#yuv420p-和-yuv420-的区别>yuv420p 和 yuv420 的区别</a></li></ul><ul><li><a href=#ffmpeg-中对-yuv420p-像素格式大小计算>ffmpeg 中对 yuv420p 像素格式大小计算</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>YUV</h1><div class=article-style><h1 id=yuv>YUV</h1><p>YUV 是一种颜色编码方方式，通常由彩色摄像机进行取像，然后把取得的彩色图像信号经过分色、分别放大校正后得到 RGB，再经过矩阵变换得到亮度信号 Y 和两个色差信号 B-Y（即 U）、R-Y（即 V），最后将亮度和色差三个信号分别编码，用同一信道发送出去。这种色彩的表示方法就是所谓的 YUV 色彩空间表示。采用 YUV 色彩空间的重要性就是它的亮度信号 Y 和色度信号 U、V 是分离的。</p><p>相对于 RGB 颜色空间，设计 YUV 的目的就是为了编码、传输的方便，减少带宽占用和信息出错。人眼的视觉特点是对亮度更铭感，对位置、色彩相对来说不铭感。在视频编码系统中为了降低带宽，可以保存更多的亮度信息(luma)，保存较少的色差信息(chroma)。Y’UV、YUV、YCbCr、YPbPr 几个概念其实是一回事儿。由于历史关系，Y’UV、YUV 主要是用在彩色电视中，用于模拟信号表示。YCbCr 是用在数字视频、图像的压缩和传输，如 MPEG、JPEG。今天大家所讲的 YUV 其实就是指 YCbCr。Y 表示亮度（luma），CbCr 表示色度（chroma）。</p><p>YUV 中“Y”表示明亮度（Luminance 或 Luma），也就是灰阶值；而“U”和“V” 表示的则是色度（Chrominance 或 Chroma），作用是描述影像色彩及饱和度，用于指定像素的颜色。“亮度”是透过 RGB 输入信号来建立的，方法是将 RGB 信号的特定部分叠加到一起。“色度”则定义了颜色的两个方面 ─ 色调与饱和度，分别用 Cr 和 Cb 来表示。其中，Cr 反映了 RGB 输入信号红色部分与 RGB 信号亮度值之间的差异。而 Cb 反映的是 RGB 输入信号蓝色部分与 RGB 信号亮度值之间的差异。</p><h1 id=yuv-采样>YUV 采样</h1><p>对于一个 w 宽、h 高的像素图，在水平方向，一行有 w 个像素；在垂直方向，一列有 h 个像素，整个图形有 <code>w * h</code> 个像素。我们把这个像素叫做图形像素。如果用 YCbCr 像素格式来表示像素图，那么要搞清楚亮度和图形像素的关系，色度和图形像素的关系。</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://s3.ax1x.com/2020/11/13/D9BMnS.png alt="yuv 数字解释" loading=lazy data-zoomable></div></div></figure></p><p>如上图中所示，左侧一列，每一个小矩形是图形像素表示，黑框矩形是色度像素表示，小黑点是表示色度像素值(Cb+Cr)，表示图形像素和色度像素在水平和垂直方向的比例关系。比如，</p><ul><li>4:4:0 水平方向是 1/1，垂直方向是 1/2，表示一个色度像素对应了两个图形像素。</li><li>4:2:2 水平方向是 1/2，垂直方向是 1/1，表示一个色度像素对应了两个图形像素。</li><li>4:2:0 水平方向是 1/2，垂直方向是 1/2，表示一个色度像素对应了四个图形像素。</li></ul><p>右侧一列是二次采样模式记号表示, 是 J：a：b 模式，实心黑色圆圈表示包含色度像素(Cb+Cr），空心圆圈表示不包含色度像素。对于 J:a:b 模式，主要是围绕参考块的概念定义的，这个参考块是一个 J x 2 的矩形，J 通常是 4。这样，此参考块就是宽度有 4 个像素、高度有 2 个像素的矩形。a 表示参考块的第一行包含的色度像素样本数，b 表示在参考块的第二行包含的色度像素样本数。</p><ul><li>4：4：0 参考块第一行包含四个色度样本，第二行没有包含色度样本。</li><li>4：2：2 参考块第一行包含两个色度样本，第二行也包含两个色度样本，他们是交替出现。</li><li>4：2：0 参考块第一行包含两个色度样本，第二行没有包含色度样本。</li></ul><p>现在我们发现 yuv444，yuv422，yuv420 yuv 等像素格式的本质是：每个图形像素都会包含亮度值，但是某几个图形像素会共用一个色度值，这个比例关系就是通过 4 x 2 的矩形参考块来定的。这样很容易理解类似 yuv440，yuv420 这样的格式了。</p><ul><li>4：4：4 表示没有对色度通道进行缩减采样。</li><li>4：2：2 意味着 2：1 的水平缩减采样，没有垂直下采样。每扫描一行，每两个 U 或 V 采样包含四个 Y 采样。</li><li>4：2：0 表示 2：1 水平缩减采样，2：1 垂直缩减采样。</li><li>4：1：1 表示 4：1 水平缩减采样，没有垂直下采样。每个扫描线对于每个 U 或 V 采样包含四个 Y 采样。4：1：1 采样比其他格式少见。</li></ul><p>换句话说来说，可以理解为：</p><ul><li>YUV 4:4:4 采样，每一个 Y 对应一组 UV 分量。</li><li>YUV 4:2:2 采样，每两个 Y 共用一组 UV 分量。</li><li>YUV 4:2:0 采样，每四个 Y 共用一组 UV 分量。</li></ul><p>下面三个图分别是各自的采集方式：</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://s3.ax1x.com/2020/11/15/DFVtcq.png alt="YUV 采集方式" loading=lazy data-zoomable></div></div></figure></p><h1 id=yuv-存储>YUV 存储</h1><p>下面的图给出了常见的 YUV 码流的存储方式，并在存储方式后面附有取样每个像素点的 YUV 数据的方法，其中，Cb、Cr 的含义等同于 U、V。</p><h2 id=yuvy-格式属于-yuv422>YUVY 格式（属于 YUV422）</h2><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://images2017.cnblogs.com/blog/682616/201802/682616-20180209155346982-258986689.png alt=img loading=lazy data-zoomable></div></div></figure></p><p>YUYV 为 YUV422 采样的存储格式中的一种，相邻的两个 Y 共用其相邻的两个 Cb、Cr，分析，对于像素点 Y'00、Y'01 而言，其 Cb、Cr 的值均为 Cb00、Cr00，其他的像素点的 YUV 取值依次类推。</p><h2 id=uyvy-格式属于-yuv422>UYVY 格式（属于 YUV422）</h2><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://images2017.cnblogs.com/blog/682616/201802/682616-20180209155417170-837281930.png alt=img loading=lazy data-zoomable></div></div></figure></p><p>UYVY 格式也是 YUV422 采样的存储格式中的一种，只不过与 YUYV 不同的是 UV 的排列顺序不一样而已，还原其每个像素点的 YUV 值的方法与上面一样。</p><h2 id=yuv422p属于-yuv422>YUV422P（属于 YUV422）</h2><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://images2017.cnblogs.com/blog/682616/201802/682616-20180209155457982-968223311.png alt=img loading=lazy data-zoomable></div></div></figure></p><p>YUV422P 也属于 YUV422 的一种，它是一种 Plane 模式，即打包模式，并不是将 YUV 数据交错存储，而是先存放所有的 Y 分量，然后存储所有的 U（Cb）分量，最后存储所有的 V（Cr）分量，如上图所示。其每一个像素点的 YUV 值提取方法也是遵循 YUV422 格式的最基本提取方法，即两个 Y 共用一个 UV。比如，对于像素点 Y'00、Y'01 而言，其 Cb、Cr 的值均为 Cb00、Cr00。</p><p>平面格式是指用三个不同的数组来表示 YCbCr 的三个 Component，每一个 Component 都是通过不同的平面表示。为此，每一个 Component 会对应一个 plane。yuv420p 也叫 i420 就是 yuv420 planar 表示。yuv420p 一共有三个平面分别是 Y，U，V，每一个平面都是用 8 bit 二进制数字表示，我们把 8 bit 称作位深度。</p><p>如果用 yuv420p 来表示分辨率为 <code>1280 * 720</code> 的图片，需要占用多少存储空间呢？</p><ul><li>每一个像素都需要一个 luma 值，即 y。那么总共需要 <code>1280 * 720 = 921600 bytes</code>。</li><li>每四个像素需要一个 chroma u 值，那么总共需要 <code>1280 * 720 / 4 = 230400 bytes</code>。</li><li>每四个像素需要一个 chroma v 值，那么总共需要 <code>1280 * 720 / 4 = 230400 bytes</code>。</li></ul><p>把 y、u、v 三个 plane 加起来就是：921600 + 230400 + 230400 = 1382400 bytes。</p><h2 id=yv12yu12-格式属于-yuv420>YV12，YU12 格式（属于 YUV420）</h2><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://images2017.cnblogs.com/blog/682616/201802/682616-20180209155537466-578129036.png alt=img loading=lazy data-zoomable></div></div></figure></p><h2 id=nv12nv21属于-yuv420>NV12、NV21（属于 YUV420）</h2><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://images2017.cnblogs.com/blog/682616/201802/682616-20180209155555263-1405762791.png alt=img loading=lazy data-zoomable></div></div></figure></p><p>NV12 和 NV21 属于 YUV420 格式，是一种 two-plane 模式，即 Y 和 UV 分为两个 Plane，但是 UV（CbCr）为交错存储，而不是分为三个 plane。其提取方式与上一种类似，即 Y'00、Y'01、Y'10、Y'11 共用 Cr00、Cb00</p><h2 id=yuv420p-和-yuv420-的区别>yuv420p 和 yuv420 的区别</h2><p>二者在存储格式上有区别：</p><ul><li>yuv420p：yyyyyyyy uuuuuuuu vvvvv</li><li>yuv420：yuv yuv yuv</li></ul><p>yuv420P，Y，U，V 三个分量都是平面格式，分为 I420 和 YV12。I420 格式和 YV12 格式的不同处在 U 平面和 V 平面的位置不同。在 I420 格式中，U 平面紧跟在 Y 平面之后，然后才是 V 平面（即：YUV）；但 YV12 则是相反（即：YVU）。YUV420SP, Y 分量平面格式，UV 打包格式, 即 NV12。NV12 与 NV21 类似，U 和 V 交错排列,不同在于 UV 顺序。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-s data-lang=s><span class=line><span class=cl><span class=n>I420</span><span class=o>:</span> <span class=n>YYYYYYYY</span> <span class=n>UU</span> <span class=n>VV</span> <span class=o>=&gt;</span><span class=n>YUV420P</span>
</span></span><span class=line><span class=cl><span class=n>YV12</span><span class=o>:</span> <span class=n>YYYYYYYY</span> <span class=n>VV</span> <span class=n>UU</span> <span class=o>=&gt;</span><span class=n>YUV420P</span>
</span></span><span class=line><span class=cl><span class=n>NV12</span><span class=o>:</span> <span class=n>YYYYYYYY</span> <span class=n>UVUV</span> <span class=o>=&gt;</span><span class=n>YUV420SP</span>
</span></span><span class=line><span class=cl><span class=n>NV21</span><span class=o>:</span> <span class=n>YYYYYYYY</span> <span class=n>VUVU</span> <span class=o>=&gt;</span><span class=n>YUV420SP</span>
</span></span></code></pre></div><h1 id=yuv-格式与-rgb-格式的换算>YUV 格式与 RGB 格式的换算</h1><ul><li>RGB 转换成 YUV</li></ul><pre tabindex=0><code>Y = (0.257 * R) + (0.504 * G) + (0.098 * B) + 16
Cr = V = (0.439 * R) - (0.368 * G) - (0.071 * B) + 128
Cb = U = -( 0.148 * R) - (0.291 * G) + (0.439 * B) + 128
</code></pre><ul><li>YUV 转换成 RGB</li></ul><pre tabindex=0><code>B = 1.164(Y - 16) + 2.018(U - 128)
G = 1.164(Y - 16) - 0.813(V - 128) - 0.391(U - 128)
R = 1.164(Y - 16) + 1.596(V - 128)
</code></pre><p>RGB 取值范围均为 0255,Y=0255,U=-122+122,V=-157+157，简化后的换算公式</p><ul><li>RGB 转 YUV</li></ul><pre tabindex=0><code>Y = 0.299R + 0.587G + 0.114B
U&#39;= (BY)*0.565
V&#39;= (RY)*0.713
</code></pre><ul><li>YUV 转 RGB</li></ul><pre tabindex=0><code>R = Y + 1.403V&#39;
G = Y - 0.344U&#39; - 0.714V&#39;
B = Y + 1.770U&#39;
</code></pre><h1 id=压缩格式packed-formats>压缩格式（Packed formats）</h1><p>压缩格式是指用一个数组表示 YCbCr，每一个 component 是交替出现的。</p><h2 id=ffmpeg-中对-yuv420p-像素格式大小计算>ffmpeg 中对 yuv420p 像素格式大小计算</h2><p>yuv420p 的格式描述在 libavutil/pixdesc.c 的 173 行。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>173 static const AVPixFmtDescriptor av_pix_fmt_descriptors[AV_PIX_FMT_NB] = {
</span></span><span class=line><span class=cl>174     [AV_PIX_FMT_YUV420P] = {
</span></span><span class=line><span class=cl>175         .name = &#34;yuv420p&#34;, // 像素格式名称
</span></span><span class=line><span class=cl>176         .nb_components = 3, // 表示有三个 component，也是三个 plane
</span></span><span class=line><span class=cl>177         .log2_chroma_w = 1, // 表示色度(chroma) 像素和图形像素的水平比例关系
</span></span><span class=line><span class=cl>178         .log2_chroma_h = 1, // 表示色度(chroma) 像素和图形像素的垂直比例关系
</span></span><span class=line><span class=cl>179         .comp = {
</span></span><span class=line><span class=cl>180             { 0, 1, 0, 0, 8, 0, 7, 1 },        /* Y 平面，step 是 1，位深度是8 bit */
</span></span><span class=line><span class=cl>181             { 1, 1, 0, 0, 8, 0, 7, 1 },        /* U 平面，step 是 1，位深度是8 bit */
</span></span><span class=line><span class=cl>182             { 2, 1, 0, 0, 8, 0, 7, 1 },        /* V 平面，step 是 1，位深度是8 bit */
</span></span><span class=line><span class=cl>183         },
</span></span><span class=line><span class=cl>184         .flags = AV_PIX_FMT_FLAG_PLANAR,
</span></span><span class=line><span class=cl>185     },
</span></span></code></pre></div><p>所有的 YUV 像素格式表示都在 av_pix_fmt_descriptors 表中完成，我可以把这叫做像素格式描述表。</p><p>yuv420p 像素格式在水平方向(行)大小计算在 libavutil/imgutils.c 的 54 行。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>53 static inline
</span></span><span class=line><span class=cl>54 int image_get_linesize(int width, int plane,
</span></span><span class=line><span class=cl>55                        int max_step, int max_step_comp,
</span></span><span class=line><span class=cl>56                        const AVPixFmtDescriptor *desc)
</span></span><span class=line><span class=cl>57 {
</span></span><span class=line><span class=cl>58     int s, shifted_w, linesize;
</span></span><span class=line><span class=cl>59
</span></span><span class=line><span class=cl>60     if (!desc)
</span></span><span class=line><span class=cl>61         return AVERROR(EINVAL);
</span></span><span class=line><span class=cl>62
</span></span><span class=line><span class=cl>63     if (width &lt; 0)
</span></span><span class=line><span class=cl>64         return AVERROR(EINVAL);
</span></span><span class=line><span class=cl>    // max_step_comp 的取值：0：y，1：u，2：v。对于 y 平面，每一个图形像素需要一个亮度值，
</span></span><span class=line><span class=cl>    // 所以这里比例因子是 0；对于 u、v 平面来说，色度像素和图形像素在水平和垂直方向都是 2/1 的关系，
</span></span><span class=line><span class=cl>    // 所以计算行的时候，比例因子取像素格式描述表中的 log2_chroma_w。对于 yuv420p 来说，取值是 1，
</span></span><span class=line><span class=cl>    // 因为是通过移位运算完成的，右移 1 位，相当于是除以 2。
</span></span><span class=line><span class=cl>65     s = (max_step_comp == 1 || max_step_comp == 2) ? desc-&gt;log2_chroma_w : 0;
</span></span><span class=line><span class=cl>66     shifted_w = ((width + (1 &lt;&lt; s) - 1)) &gt;&gt; s;
</span></span><span class=line><span class=cl>67     if (shifted_w &amp;&amp; max_step &gt; INT_MAX / shifted_w)
</span></span><span class=line><span class=cl>68         return AVERROR(EINVAL);
</span></span><span class=line><span class=cl>69     linesize = max_step * shifted_w;
</span></span><span class=line><span class=cl>70
</span></span><span class=line><span class=cl>    // 如果像素描述表中的单位是 bit，那么这里转换成 bytes，右移 3 位，就是除以 8。
</span></span><span class=line><span class=cl>71     if (desc-&gt;flags &amp; AV_PIX_FMT_FLAG_BITSTREAM)
</span></span><span class=line><span class=cl>72         linesize = (linesize + 7) &gt;&gt; 3;
</span></span><span class=line><span class=cl>73     return linesize;
</span></span><span class=line><span class=cl>74 }
</span></span></code></pre></div><p>yuv420p 像素格式在垂直方向(列)大小计算在 libavutil/imgutils.c 的 111 行。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>111 int av_image_fill_pointers(uint8_t *data[4], enum AVPixelFormat pix_fmt, int height,
</span></span><span class=line><span class=cl>112                            uint8_t *ptr, const int linesizes[4])
</span></span><span class=line><span class=cl>113 {
</span></span><span class=line><span class=cl>114     int i, total_size, size[4] = { 0 }, has_plane[4] = { 0 };
</span></span><span class=line><span class=cl>115
</span></span><span class=line><span class=cl>116     const AVPixFmtDescriptor *desc = av_pix_fmt_desc_get(pix_fmt);
</span></span><span class=line><span class=cl>117     memset(data    , 0, sizeof(data[0])*4);
</span></span><span class=line><span class=cl>118
</span></span><span class=line><span class=cl>119     if (!desc || desc-&gt;flags &amp; AV_PIX_FMT_FLAG_HWACCEL)
</span></span><span class=line><span class=cl>120         return AVERROR(EINVAL);
</span></span><span class=line><span class=cl>121
</span></span><span class=line><span class=cl>122     data[0] = ptr;
</span></span><span class=line><span class=cl>123     if (linesizes[0] &gt; (INT_MAX - 1024) / height)
</span></span><span class=line><span class=cl>124         return AVERROR(EINVAL);
</span></span><span class=line><span class=cl>125     size[0] = linesizes[0] * height;
</span></span><span class=line><span class=cl>126
</span></span><span class=line><span class=cl>127     if (desc-&gt;flags &amp; AV_PIX_FMT_FLAG_PAL ||
</span></span><span class=line><span class=cl>128         desc-&gt;flags &amp; FF_PSEUDOPAL) {
</span></span><span class=line><span class=cl>129         data[1] = ptr + size[0]; /* palette is stored here as 256 32 bits words */
</span></span><span class=line><span class=cl>130         return size[0] + 256 * 4;
</span></span><span class=line><span class=cl>131     }
</span></span><span class=line><span class=cl>132
</span></span><span class=line><span class=cl>133     for (i = 0; i &lt; 4; i++)
</span></span><span class=line><span class=cl>134         has_plane[desc-&gt;comp[i].plane] = 1;
</span></span><span class=line><span class=cl>135
</span></span><span class=line><span class=cl>136     total_size = size[0];
</span></span><span class=line><span class=cl>137     for (i = 1; i &lt; 4 &amp;&amp; has_plane[i]; i++) {
</span></span><span class=line><span class=cl>        // i 的取值：0：y，1：u，2：v。对于 y 平面，每一个图形像素需要一个亮度值，
</span></span><span class=line><span class=cl>        // 所以这里比例因子是 0；对于 u、v 平面来说，色度像素和图形像素在水平和垂直方向都是 2/1 的关系，
</span></span><span class=line><span class=cl>        // 所以计算列的时候，比例因子取像素格式描述表中的 log2_chroma_h。对于 yuv420p 来说，取值是 1，
</span></span><span class=line><span class=cl>        // 因为是通过移位运算完成的，右移 1 位，相当于是除以 2。
</span></span><span class=line><span class=cl>138         int h, s = (i == 1 || i == 2) ? desc-&gt;log2_chroma_h : 0;
</span></span><span class=line><span class=cl>139         data[i] = data[i-1] + size[i-1];
</span></span><span class=line><span class=cl>140         h = (height + (1 &lt;&lt; s) - 1) &gt;&gt; s;
</span></span><span class=line><span class=cl>141         if (linesizes[i] &gt; INT_MAX / h)
</span></span><span class=line><span class=cl>142             return AVERROR(EINVAL);
</span></span><span class=line><span class=cl>        // 每一平面的行和列做乘法，就是像素总数。
</span></span><span class=line><span class=cl>143         size[i] = h * linesizes[i];
</span></span><span class=line><span class=cl>144         if (total_size &gt; INT_MAX - size[i])
</span></span><span class=line><span class=cl>145             return AVERROR(EINVAL);
</span></span><span class=line><span class=cl>        // 每一个平面的像素数相加，就是图片占用的像素总数。
</span></span><span class=line><span class=cl>146         total_size += size[i];
</span></span><span class=line><span class=cl>147     }
</span></span><span class=line><span class=cl>148
</span></span><span class=line><span class=cl>149     return total_size;
</span></span><span class=line><span class=cl>150 }
</span></span></code></pre></div></div><div class=article-widget><div class="container-xl row post-nav"></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte-website.oss-accelerate.aliyuncs.com/disqus/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte-website.oss-accelerate.aliyuncs.com/disqus/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>