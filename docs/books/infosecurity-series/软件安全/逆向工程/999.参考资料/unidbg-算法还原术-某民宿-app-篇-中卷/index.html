<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="本文由 简悦 SimpRead 转码， 原文地址 mp.weixin.qq.com 上回说到 EncodeHTTP 函数 伪代码又臭又长，看不懂没关系，从下往上看；找关键的函数； 而且之前猜测是 sha1 算法，那我们找找 sha1 的特征； 伪代码虽然很长，但是函数还是没几个的，都点进去看看 tjtxtutf8 看上去很"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/unidbg-%E7%AE%97%E6%B3%95%E8%BF%98%E5%8E%9F%E6%9C%AF-%E6%9F%90%E6%B0%91%E5%AE%BF-app-%E7%AF%87-%E4%B8%AD%E5%8D%B7/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/unidbg-%E7%AE%97%E6%B3%95%E8%BF%98%E5%8E%9F%E6%9C%AF-%E6%9F%90%E6%B0%91%E5%AE%BF-app-%E7%AF%87-%E4%B8%AD%E5%8D%B7/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/unidbg-%E7%AE%97%E6%B3%95%E8%BF%98%E5%8E%9F%E6%9C%AF-%E6%9F%90%E6%B0%91%E5%AE%BF-app-%E7%AF%87-%E4%B8%AD%E5%8D%B7/"><meta property="og:title" content="unidbg 算法还原术 · 某民宿 app 篇 · 中卷 | Next-gen Tech Edu"><meta property="og:description" content="本文由 简悦 SimpRead 转码， 原文地址 mp.weixin.qq.com 上回说到 EncodeHTTP 函数 伪代码又臭又长，看不懂没关系，从下往上看；找关键的函数； 而且之前猜测是 sha1 算法，那我们找找 sha1 的特征； 伪代码虽然很长，但是函数还是没几个的，都点进去看看 tjtxtutf8 看上去很"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>unidbg 算法还原术 · 某民宿 app 篇 · 中卷 | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=4c7cf597e012f569e98e0ac144f521f2><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">999.参考资料</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ida13f9287bee731f41102d5bd6b06508c")' href=#ida13f9287bee731f41102d5bd6b06508c aria-expanded=false aria-controls=ida13f9287bee731f41102d5bd6b06508c aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/>逆向工程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ida13f9287bee731f41102d5bd6b06508c aria-expanded=false aria-controls=ida13f9287bee731f41102d5bd6b06508c><i class="fa-solid fa-angle-down" id=caret-ida13f9287bee731f41102d5bd6b06508c></i></a></div><ul class="nav docs-sidenav collapse show" id=ida13f9287bee731f41102d5bd6b06508c><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id86bfc41c09c9dc360469558f7d6c003b")' href=#id86bfc41c09c9dc360469558f7d6c003b aria-expanded=false aria-controls=id86bfc41c09c9dc360469558f7d6c003b aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/>99.参考资料</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id86bfc41c09c9dc360469558f7d6c003b aria-expanded=false aria-controls=id86bfc41c09c9dc360469558f7d6c003b><i class="fa-solid fa-angle-right" id=caret-id86bfc41c09c9dc360469558f7d6c003b></i></a></div><ul class="nav docs-sidenav collapse" id=id86bfc41c09c9dc360469558f7d6c003b><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2021-%E6%98%A5%E8%8A%82%E5%AE%89%E5%8D%93%E4%B8%AD%E7%BA%A7%E9%A2%98%E9%80%86%E5%90%91%E6%80%BB%E7%BB%93/>【2021 春节】安卓中级题逆向总结</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/%E8%BD%AC%E8%BD%BDunidbg-hook-%E5%A4%A7%E5%85%A8-seeflowerx/>【转载】Unidbg Hook 大全 - SeeFlowerX</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2022-%E6%9F%90%E5%AE%89%E5%8D%93-crackme-%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/>2022 某安卓 Crackme 流程分析</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/app-%E9%80%86%E5%90%91-%E5%B9%B3%E5%A4%B4%E5%93%A5%E5%AE%9E%E6%88%98%E6%9F%90%E5%86%9C%E4%BA%A7%E5%93%81-app/>app 逆向 平头哥实战（某农产品 app）</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/frida-android-hook-_-sakura-%E3%81%AE-blog/>Frida Android hook _ Sakura の blog</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/frida-%E5%85%8D-root-hook/>frida 免 root hook</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/getbyte-%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90%E4%B8%8E%E8%BF%98%E5%8E%9F-seeflowerx/>getByte 算法分析与还原 - SeeFlowerX</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/js-ast-%E4%BA%8C%E9%83%A8%E6%9B%B2%E6%9F%90-v5-%E7%BB%9D%E5%AF%B9%E4%B8%8D%E5%8F%AF%E9%80%86%E5%8A%A0%E5%AF%86-%E4%B8%80%E6%8E%A2%E7%A9%B6%E7%AB%9F/>Js Ast 二部曲：某 V5 “绝对不可逆加密” 一探究竟</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/js-ast-%E4%B8%80%E9%83%A8%E6%9B%B2%E9%AB%98%E5%AE%8C%E6%95%B4%E5%BA%A6%E8%BF%98%E5%8E%9F%E6%9F%90-v5-%E7%9A%84%E5%8A%A0%E5%AF%86/>Js Ast 一部曲：高完整度还原某 V5 的加密</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/js-%E7%A0%B4%E8%A7%A3%E4%B9%8B%E8%A1%A5%E6%B5%8F%E8%A7%88%E5%99%A8%E7%8E%AF%E5%A2%83%E7%9A%84%E4%B8%A4%E7%A7%8D%E7%9B%91%E6%8E%A7%E6%96%B9%E5%BC%8F/>js 破解之补浏览器环境的两种监控方式</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/mtgsig2.1-%E7%89%88%E6%9C%AC%E4%B9%8B-a5-%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90/>mtgsig2.1 版本之 a5 算法分析</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/protobuf-%E5%8D%8F%E8%AE%AE%E9%80%86%E5%90%91%E8%A7%A3%E6%9E%90-app-%E7%88%AC%E8%99%AB-/>Protobuf 协议逆向解析 - APP 爬虫</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/proxy-%E4%BB%A3%E7%90%86%E4%BA%8C%E6%AC%A1%E4%BF%AE%E6%94%B9/>Proxy 代理（二次修改）</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/python-%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6%E5%BF%85%E5%A4%87-_-js-%E9%80%86%E5%90%91%E4%B9%8B%E8%A1%A5%E7%8E%AF%E5%A2%83%E5%88%B0%E5%BA%95%E6%98%AF%E5%9C%A8%E8%A1%A5%E4%BB%80%E4%B9%88/>Python 爬虫进阶必备 _ Js 逆向之补环境到底是在补什么？</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/unidbg-%E7%AE%97%E6%B3%95%E8%BF%98%E5%8E%9F%E6%9C%AF-%E6%9F%90%E6%B0%91%E5%AE%BF-app-%E7%AF%87-%E4%B8%8A%E5%8D%B7/>unidbg 算法还原术 · 某民宿 app 篇 · 上卷</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/unidbg-%E7%AE%97%E6%B3%95%E8%BF%98%E5%8E%9F%E6%9C%AF-%E6%9F%90%E6%B0%91%E5%AE%BF-app-%E7%AF%87-%E4%B8%8B%E5%8D%B7/>unidbg 算法还原术 · 某民宿 app 篇 · 下卷</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/unidbg-%E7%AE%97%E6%B3%95%E8%BF%98%E5%8E%9F%E6%9C%AF-%E6%9F%90%E6%B0%91%E5%AE%BF-app-%E7%AF%87-%E4%B8%AD%E5%8D%B7/>unidbg 算法还原术 · 某民宿 app 篇 · 中卷</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/%E5%A4%A7%E7%8C%BF%E6%90%9C%E9%A2%98-sign-so-%E5%8A%A0%E5%AF%86%E5%8F%82%E6%95%B0%E5%88%86%E6%9E%90unidbg/>大猿搜题 sign so 加密参数分析｜unidbg</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/%E5%88%86%E4%BA%AB%E4%B8%80%E4%B8%AA-android-%E9%80%9A%E7%94%A8-svc-%E8%B7%9F%E8%B8%AA%E4%BB%A5%E5%8F%8A-hook-%E6%96%B9%E6%A1%88frida-seccomp/>分享一个 Android 通用 svc 跟踪以及 hook 方案——Frida-Seccomp</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/%E6%9F%90%E4%B9%8E%E8%AF%B7%E6%B1%82%E5%A4%B4%E7%AD%BE%E5%90%8D%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90/>某乎请求头签名算法分析</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/%E6%9F%90%E5%92%96%E5%95%A1-app-%E5%8A%A0%E5%AF%86%E5%8F%82%E6%95%B0%E5%88%86%E6%9E%90%E8%BF%9B%E9%98%B6%E7%89%88/>某咖啡 app 加密参数分析进阶版</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/%E9%80%86%E5%90%91%E5%88%86%E6%9E%90%E5%8F%8D%E8%B0%83%E8%AF%95-+-ollvm-%E6%B7%B7%E6%B7%86%E7%9A%84-crackme/>逆向分析反调试 + ollvm 混淆的 Crackme</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/%E7%88%AC%E8%99%AB%E4%B9%8B-%E6%9F%90%E7%94%9F%E9%B2%9C-app-%E5%8A%A0%E5%AF%86%E5%8F%82%E6%95%B0%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/>爬虫之 - 某生鲜 APP 加密参数逆向分析</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/%E6%B7%B1%E5%BA%A6%E5%89%96%E6%9E%90-ja3-%E6%8C%87%E7%BA%B9%E5%8F%8A%E7%AA%81%E7%A0%B4/>深度剖析 ja3 指纹及突破</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idebb5db8060bce97b3f0cd1ac08912ddf")' href=#idebb5db8060bce97b3f0cd1ac08912ddf aria-expanded=false aria-controls=idebb5db8060bce97b3f0cd1ac08912ddf aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/>999.参考资料</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idebb5db8060bce97b3f0cd1ac08912ddf aria-expanded=false aria-controls=idebb5db8060bce97b3f0cd1ac08912ddf><i class="fa-solid fa-angle-down" id=caret-idebb5db8060bce97b3f0cd1ac08912ddf></i></a></div><ul class="nav docs-sidenav collapse show" id=idebb5db8060bce97b3f0cd1ac08912ddf><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2021-%E6%98%A5%E8%8A%82%E5%AE%89%E5%8D%93%E4%B8%AD%E7%BA%A7%E9%A2%98%E9%80%86%E5%90%91%E6%80%BB%E7%BB%93/>【2021 春节】安卓中级题逆向总结</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/%E8%BD%AC%E8%BD%BDunidbg-hook-%E5%A4%A7%E5%85%A8-seeflowerx/>【转载】Unidbg Hook 大全 - SeeFlowerX</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2022-%E6%9F%90%E5%AE%89%E5%8D%93-crackme-%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90/>2022 某安卓 Crackme 流程分析</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/app-%E9%80%86%E5%90%91-%E5%B9%B3%E5%A4%B4%E5%93%A5%E5%AE%9E%E6%88%98%E6%9F%90%E5%86%9C%E4%BA%A7%E5%93%81-app/>app 逆向 平头哥实战（某农产品 app）</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/frida-android-hook-_-sakura-%E3%81%AE-blog/>Frida Android hook _ Sakura の blog</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/frida-%E5%85%8D-root-hook/>frida 免 root hook</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/getbyte-%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90%E4%B8%8E%E8%BF%98%E5%8E%9F-seeflowerx/>getByte 算法分析与还原 - SeeFlowerX</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/js-ast-%E4%BA%8C%E9%83%A8%E6%9B%B2%E6%9F%90-v5-%E7%BB%9D%E5%AF%B9%E4%B8%8D%E5%8F%AF%E9%80%86%E5%8A%A0%E5%AF%86-%E4%B8%80%E6%8E%A2%E7%A9%B6%E7%AB%9F/>Js Ast 二部曲：某 V5 “绝对不可逆加密” 一探究竟</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/js-ast-%E4%B8%80%E9%83%A8%E6%9B%B2%E9%AB%98%E5%AE%8C%E6%95%B4%E5%BA%A6%E8%BF%98%E5%8E%9F%E6%9F%90-v5-%E7%9A%84%E5%8A%A0%E5%AF%86/>Js Ast 一部曲：高完整度还原某 V5 的加密</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/js-%E7%A0%B4%E8%A7%A3%E4%B9%8B%E8%A1%A5%E6%B5%8F%E8%A7%88%E5%99%A8%E7%8E%AF%E5%A2%83%E7%9A%84%E4%B8%A4%E7%A7%8D%E7%9B%91%E6%8E%A7%E6%96%B9%E5%BC%8F/>js 破解之补浏览器环境的两种监控方式</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/mtgsig2.1-%E7%89%88%E6%9C%AC%E4%B9%8B-a5-%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90/>mtgsig2.1 版本之 a5 算法分析</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/protobuf-%E5%8D%8F%E8%AE%AE%E9%80%86%E5%90%91%E8%A7%A3%E6%9E%90-app-%E7%88%AC%E8%99%AB-/>Protobuf 协议逆向解析 - APP 爬虫</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/proxy-%E4%BB%A3%E7%90%86%E4%BA%8C%E6%AC%A1%E4%BF%AE%E6%94%B9/>Proxy 代理（二次修改）</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/python-%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6%E5%BF%85%E5%A4%87-_-js-%E9%80%86%E5%90%91%E4%B9%8B%E8%A1%A5%E7%8E%AF%E5%A2%83%E5%88%B0%E5%BA%95%E6%98%AF%E5%9C%A8%E8%A1%A5%E4%BB%80%E4%B9%88/>Python 爬虫进阶必备 _ Js 逆向之补环境到底是在补什么？</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/unidbg-%E7%AE%97%E6%B3%95%E8%BF%98%E5%8E%9F%E6%9C%AF-%E6%9F%90%E6%B0%91%E5%AE%BF-app-%E7%AF%87-%E4%B8%8A%E5%8D%B7/>unidbg 算法还原术 · 某民宿 app 篇 · 上卷</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/unidbg-%E7%AE%97%E6%B3%95%E8%BF%98%E5%8E%9F%E6%9C%AF-%E6%9F%90%E6%B0%91%E5%AE%BF-app-%E7%AF%87-%E4%B8%8B%E5%8D%B7/>unidbg 算法还原术 · 某民宿 app 篇 · 下卷</a></li><li class="child level active"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/unidbg-%E7%AE%97%E6%B3%95%E8%BF%98%E5%8E%9F%E6%9C%AF-%E6%9F%90%E6%B0%91%E5%AE%BF-app-%E7%AF%87-%E4%B8%AD%E5%8D%B7/>unidbg 算法还原术 · 某民宿 app 篇 · 中卷</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/%E5%A4%A7%E7%8C%BF%E6%90%9C%E9%A2%98-sign-so-%E5%8A%A0%E5%AF%86%E5%8F%82%E6%95%B0%E5%88%86%E6%9E%90unidbg/>大猿搜题 sign so 加密参数分析｜unidbg</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/%E5%88%86%E4%BA%AB%E4%B8%80%E4%B8%AA-android-%E9%80%9A%E7%94%A8-svc-%E8%B7%9F%E8%B8%AA%E4%BB%A5%E5%8F%8A-hook-%E6%96%B9%E6%A1%88frida-seccomp/>分享一个 Android 通用 svc 跟踪以及 hook 方案——Frida-Seccomp</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/%E6%9F%90%E4%B9%8E%E8%AF%B7%E6%B1%82%E5%A4%B4%E7%AD%BE%E5%90%8D%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90/>某乎请求头签名算法分析</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/%E6%9F%90%E5%92%96%E5%95%A1-app-%E5%8A%A0%E5%AF%86%E5%8F%82%E6%95%B0%E5%88%86%E6%9E%90%E8%BF%9B%E9%98%B6%E7%89%88/>某咖啡 app 加密参数分析进阶版</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/%E9%80%86%E5%90%91%E5%88%86%E6%9E%90%E5%8F%8D%E8%B0%83%E8%AF%95-+-ollvm-%E6%B7%B7%E6%B7%86%E7%9A%84-crackme/>逆向分析反调试 + ollvm 混淆的 Crackme</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/%E7%88%AC%E8%99%AB%E4%B9%8B-%E6%9F%90%E7%94%9F%E9%B2%9C-app-%E5%8A%A0%E5%AF%86%E5%8F%82%E6%95%B0%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/>爬虫之 - 某生鲜 APP 加密参数逆向分析</a></li><li class="child level"><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/%E6%B7%B1%E5%BA%A6%E5%89%96%E6%9E%90-ja3-%E6%8C%87%E7%BA%B9%E5%8F%8A%E7%AA%81%E7%A0%B4/>深度剖析 ja3 指纹及突破</a></li></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>unidbg 算法还原术 · 某民宿 app 篇 · 中卷</h1><div class=article-style><blockquote><p>本文由 <a href=http://ksria.com/simpread/ target=_blank rel=noopener>简悦 SimpRead</a> 转码， 原文地址 <a href="https://mp.weixin.qq.com/s?__biz=MzA4MjA5NDE1OQ==&mid=2247485004&idx=1&sn=069bc22bc51804156ae4195d85cc83fc&chksm=9f8bb76ca8fc3e7ac35ead494f6365f5d34d7b4775e627b5b3aa339b275f62d7e690873f7e96&mpshare=1&scene=1&srcid=10131nsND0h4vAvW6oFb8k7g&sharer_sharetime=1634055434006&sharer_shareid=56da189f782ce62249ab4f6494feca50&version=3.1.20.90367&platform=mac#rd" target=_blank rel=noopener>mp.weixin.qq.com</a></p></blockquote><p>上回说到 EncodeHTTP 函数</p><p>伪代码又臭又长，看不懂没关系，从下往上看；找关键的函数；</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH7Gwg06nY3t8zv0Pz9icqpy3HYOh1bIyDDFvNq4dWRWpVPD0xvE5geBD8rtzcW6T6zK4XTJTAQJDGg/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>而且之前猜测是 sha1 算法，那我们找找 sha1 的特征；</p><p>伪代码虽然很长，但是函数还是没几个的，都点进去看看</p><p>tjtxtutf8 看上去很像 base64，后边验证</p><p>tjcreate 函数里面有点东西</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH7Gwg06nY3t8zv0Pz9icqpy33wDQAenUUrtM4s3U8pGkamNQCXPHKHoqu9oKeeawbgbfJk4Qo75t0Q/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>有个 sha1 的特征，为什么？</p><p>哈希算法最明显的特征就是初始化链接常量 (幻数) 和固定常数 K 值</p><p><strong>初始化链接常量 (幻数)</strong></p><p>md5 算法有 4 个初始化链接常量</p><pre tabindex=0><code>A=0x01234567，B=0x89abcdef，C=0xfedcba98，D=0x76543210
</code></pre><p>但考虑到内存数据存储大小端的问题我们将其赋值为：</p><pre tabindex=0><code>A=0x67452301，B=0xefcdab89，C=0x98badcfe，D=0x10325476
</code></pre><p>sha1 是 md5 的亲兄弟，比 md5 多了一个初始化链接常量;</p><pre tabindex=0><code>A=0x67452301，B=0xefcdab89，C=0x98badcfe，D=0x10325476，E=0xCA62C1D6
</code></pre><p><strong>k 值</strong></p><p>md5 k 值取值 （64 个，对应 64 步运算）</p><pre tabindex=0><code>constTable=[
0xd76aa478, 0xe8c7b756, 0x242070db, 0xc1bdceee, 0xf57c0faf,
0x4787c62a, 0xa8304613, 0xfd469501, 0x698098d8, 0x8b44f7af,
0xffff5bb1, 0x895cd7be, 0x6b901122, 0xfd987193, 0xa679438e,
0x49b40821, 0xf61e2562, 0xc040b340, 0x265e5a51, 0xe9b6c7aa,
0xd62f105d, 0x2441453, 0xd8a1e681, 0xe7d3fbc8, 0x21e1cde6,
0xc33707d6, 0xf4d50d87, 0x455a14ed, 0xa9e3e905, 0xfcefa3f8,
0x676f02d9, 0x8d2a4c8a, 0xfffa3942, 0x8771f681, 0x6d9d6122,
0xfde5380c, 0xa4beea44, 0x4bdecfa9, 0xf6bb4b60, 0xbebfbc70,
0x289b7ec6, 0xeaa127fa, 0xd4ef3085, 0x4881d05, 0xd9d4d039,
0xe6db99e5, 0x1fa27cf8, 0xc4ac5665, 0xf4292244, 0x432aff97,
0xab9423a7, 0xfc93a039, 0x655b59c3, 0x8f0ccc92, 0xffeff47d,
0x85845dd1, 0x6fa87e4f, 0xfe2ce6e0, 0xa3014314, 0x4e0811a1,
0xf7537e82, 0xbd3af235, 0x2ad7d2bb, 0xeb86d391]
</code></pre><p>sha1 k 值取值（4 个 k 值，每个 k 值对应 20 步运算）</p><pre tabindex=0><code>第1轮 0≤t≤19步  Kt=0x5A827999 
第2轮 20≤t≤39步 Kt=0x6ED9EBA1
第3轮 40≤t≤59步 Kt=0x8F188CDC  
第4轮 60≤t≤7步  Kt=0xCA62C1D6 
</code></pre><p>回到 ida</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH42GylcEhBjdBbp7pLyu7kLfOW5HtibXLPLiaxWx5Ls4Qr8zIqbpEwq3ibXQed08ZG2PjNDdZ51RgsMA/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>这个 0xCA62C1D6 就是 sha1 的 k 值之一，所以说这个函数有 sha1 的特征</p><p>而在工程标准化中，哈希加密一般分为 Init、Update、Final 三步</p><p>简单来说：</p><ol><li><p>Init 是一个初始化函数，初始化核心变量</p></li><li><p>Update 是主计算过程</p></li><li><p>Final 整理和填写输出结果</p></li></ol><p>tjcreate 函数可以看作是第一步的 Init; 但是其他四个常量哪去了呢？</p><p>看汇编就知道了 (这些汇编划到最下面有解释)</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH42GylcEhBjdBbp7pLyu7kLIny2iaicBhWdI77HNkia94awdgFmLUqb2J1gYSC00tRXQgyRDTl03hwBQ/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>为啥还是少了一个幻数</p><p>因为 ida 把 2C70 识别成函数了，我们手动修改它的数据类型</p><p>鼠标移到 sub_2C70 处，按 d</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH42GylcEhBjdBbp7pLyu7kLEolSjsvklEPujaiaqAxWfpgibQeSgf7BTfIicfzicHJaEhNIUg8NXwqatQ/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>再按 d 转成 word</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH42GylcEhBjdBbp7pLyu7kLSLKcibRY7RwDS1nb8tVEd34HE7V5yibzrnD0vqXMOYZOaDJ7yEdTRteA/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>再按 d 转成 dword</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH42GylcEhBjdBbp7pLyu7kLMsoBqjS1iavTX851aptIlyywfSLDBJJG5EovyjPkOqJoUJOicNSHlbjg/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>然后找下面的 Update 和 Final</p><p>tjreset 函数可以看作是第二步的 Update</p><pre tabindex=0><code>int __fastcall tjreset(signed __int64 a1, int a2)
{
  int v2; // r4
  _BYTE *v3; // r5
  int v4; // r6
  v2 = a2;
  v3 = (_BYTE *)HIDWORD(a1);
  v4 = a1;
  while ( v2 )
  {
    *(_BYTE *)(v4 + *(_DWORD *)(v4 + 64)) = *v3;
    *(_BYTE *)(v4 + *(_DWORD *)(v4 + 64)) ^= 0x21u;
    LODWORD(a1) = *(_DWORD *)(v4 + 64) + 1;
    *(_DWORD *)(v4 + 64) = a1;
    if ( (_DWORD)a1 == 64 )
    {
      j_tjupdate(v4, v4);
      *(_DWORD *)(v4 + 64) = 0;
      a1 = *(_QWORD *)(v4 + 72) + 512LL;
      *(_QWORD *)(v4 + 72) = a1;
    }
    ++v3;
    --v2;
  }
  return a1;
}
</code></pre><p>一般来说只要 hook 这个函数，拿到入参，就能拿到明文</p><p>我们先用 frida 来试试，</p><pre tabindex=0><code>function myhexdump(name, hexdump_obj, len_obj){
    console.log(&#34;-------------------&#34;+ name.toString()+&#34;-------------------\\n&#34;);
    console.log(hexdump(hexdump_obj,{
        length:len_obj
    }) );
    console.log(&#34;-------------------ENDEND-------------------\\n&#34;)
}
function tjreset() {
      var pointer = Module.findBaseAddress(&#34;libtujia_encrypt.so&#34;).add(0x2C94 + 1);
      Interceptor.attach(pointer,
          {
              onEnter: function (args) {
                  myhexdump(&#34;tjreset arg0:&#34;, args[0], 128)
                  this.buffer = args[0];
                  myhexdump(&#39;tjreset arg1:&#39;, args[1], parseInt(args[2]))
                  console.log(&#39;tjreset arg2:&#39; + parseInt(args[2]));
              },
              onLeave: function (retval) {
                  myhexdump(&#34;tjreset ret:&#34;, this.buffer, 16)
              }
          }
      );
  }
</code></pre><p>注意：这里 ida 识别函数参数个数错了，实际应该是三个参数，看汇编就知道了</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IVdrFxIibnRdm38WZ8U6ib6YQbwYkCfDoBhLxKibVC5OGmGRmSGs7GkrUA/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>R0、R1、R2 分别对应参数 1、2、3</p><p>开始 hook</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IuVm1cciaibUpqbVqop3URGmqVpFicnibkwrHE9B6ic89PK3o15PuI657kNg/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>unidbg hook:</p><pre tabindex=0><code>public void hook2c94(){
        IHookZz hookZz = HookZz.getInstance(emulator); // 加载HookZz
        hookZz.wrap(module.base + 0x2C94 + 1, new WrapCallback&lt;HookZzArm32RegisterContext&gt;() {
            @Override
            // 方法执行前
            public void preCall(Emulator&lt;?&gt; emulator, HookZzArm32RegisterContext ctx, HookEntryInfo info) {
                Pointer arg1 = ctx.getPointerArg(1);
                int length = ctx.getIntArg(2);
                Pointer out = ctx.getPointerArg(0);
                ctx.push(out);
                ctx.push(length);
                Inspector.inspect(arg1.getByteArray(0, length),&#34;tjreset arg1&#34;);
            };
            @Override
            // 方法执行后
            public void postCall(Emulator&lt;?&gt; emulator, HookZzArm32RegisterContext ctx, HookEntryInfo info) {
                int length =ctx.pop();
                Pointer output = ctx.pop();
                byte[] outputhex = output.getByteArray(0, length);
                Inspector.inspect(outputhex, &#34;tjreset ret&#34;);
            }
        });
        hookZz.disable_arm_arm64_b_branch();
    }
public static void main(String[] args) throws FileNotFoundException {
    Test test = new Test();
    test.hook2c94();//要在函数调用之前hook，不然hook个p
    test.call_encrypt();
  // test.get_bodyencrypt();
    }
</code></pre><p>unidbg 的输出跟 frida 是一样的：</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IOC3yZyyDLWemsoNPiaktB6bQHtB1qo9xJ6ib967ZjNXLWdVGF7UgWApA/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>一般情况来说 tjreset arg1 的值就是明文</p><p>打开逆向之友，去碰碰运气</p><pre tabindex=0><code>https://gchq.github.io/CyberChef/
</code></pre><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8Ie9CdD076acjSwMEhpL1Se8mBVgTLl9p5KsUaBwHR10nyr0uESHich2A/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>结果对不上，难道 sha1 魔改了？？</p><p>莫急，冷静分析，再看下伪代码，和标准的有没有啥区别</p><p>发现 13 行有个异或不对劲，标准算法没这一步</p><pre tabindex=0><code>*(_BYTE *)(v4 + *(_DWORD *)(v4 + 64)) ^= 0x21u;
</code></pre><p>这是把 tjreset arg1 先异或了 0x21 再进行下面的计算</p><p>那我们再用 CyberChef 试试</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8ImaC0IdKnKH2ceVoAHptfZ9ltROoUVSSw4upQeicPRHqd8iaInK8MmibtA/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_jpg/icBZkwGO7uH7AOnSA7XXltmdUNPcicEzTQXhtLXzpMia52PAPiaP3UicE9Vr7yNY3YG8mAaZHaYALibQRXIvCdBIroxA/640?wx_fmt=jpeg" alt loading=lazy data-zoomable></div></div></figure></p><p>看看明文是啥呢</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IGiacbRnfXHAaWJ8tT8kmLSzD56W9HjqenKGTsfI1AWCaD4XXnGF0hHA/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>看着是 base64 编码，结合之前猜测 tjtxtutf8 就是 base64，那就解码看看吧</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8I0VSMTTuA0LefqB6RAEOfC9rZzfNFbUHKa4OqWPj9HsCicwicLmcL75gw/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>哦？明文出来了，茅塞顿开</p><p>所以这个明文组成就是：</p><p>1.#arg1_str#arg5# 固定字符串 #arg2_str#arg3_str 的字符串排序</p><ol start=2><li>字符串反转</li></ol><p>3.base64 编码</p><p>不过</p><p>有人说了，我就是看不出这有个异或 0x21，你就说咋办吧。。而且这样逆向出来明文好像是靠蒙的，没有成就感啊</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_jpg/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IGWMByiaXezfYkCuoB1aDwU9rrnrU54NcKCNSdiaHHHygKGp6wbwib6KPg/640?wx_fmt=jpeg" alt loading=lazy data-zoomable></div></div></figure></p><p>行，再露一手</p><p>来看看 18 行的 j_tjupdate 函数</p><pre tabindex=0><code>int __fastcall tjupdate(int a1, int a2)
{
  int i; // r3
  int v3; // r1
  char *v4; // r5
  int v5; // r2
  int v6; // r3
  int v7; // r5
  int v8; // r10
  int v9; // r1
  int v10; // r6
  int v11; // r11
  int v12; // r3
  int v13; // r0
  int v14; // r2
  int v15; // r4
  int v16; // r3
  int v17; // r5
  int v18; // r0
  int v19; // r6
  int v20; // r1
  int v21; // r8
  int v22; // r0
  int v23; // r2
  int v24; // r6
  int v25; // r2
  int v26; // r12
  int v27; // r3
  int v28; // r0
  int v29; // r4
  int v30; // r5
  int v31; // r3
  int v32; // r0
  int v33; // r1
  __int64 v34; // r3
  int v36; // [sp+4h] [bp-17Ch]
  int v37; // [sp+8h] [bp-178h]
  int v38; // [sp+Ch] [bp-174h]
  int v39; // [sp+10h] [bp-170h]
  int v40; // [sp+14h] [bp-16Ch]
  int v41; // [sp+1Ch] [bp-164h]
  char v42[320]; // [sp+20h] [bp-160h]
  char _70[320]; // [sp+70h] [bp-110h]
  char _C0[320]; // [sp+C0h] [bp-C0h]
  char _110[320]; // [sp+110h] [bp-70h]
  int v46; // [sp+160h] [bp-20h]
  for ( i = 0; i != 64; i += 4 )
    *(_DWORD *)&amp;v42[i] = bswap32(*(_DWORD *)(a2 + i));
  v3 = 0;
  while ( v3 != 256 )
  {
    v4 = &amp;v42[v3];
    v5 = *(_DWORD *)&amp;v42[v3 + 8] ^ *(_DWORD *)&amp;v42[v3 + 32] ^ *(_DWORD *)&amp;v42[v3 + 52];
    v6 = *(_DWORD *)&amp;v42[v3];
    v3 += 4;
    *((_DWORD *)v4 + 16) = __ROR4__(v5 ^ v6, 31);
  }
  v8 = *(_QWORD *)(a1 + 80) &gt;&gt; 32;
  v7 = *(_QWORD *)(a1 + 80);
  v9 = *(_DWORD *)(a1 + 100);
  v10 = 0;
  v12 = *(_DWORD *)(a1 + 92);
  v11 = *(_DWORD *)(a1 + 96);
  v41 = a1;
  v38 = *(_DWORD *)(a1 + 88);
  v13 = *(_DWORD *)(a1 + 88);
  v14 = v12;
  v37 = v12;
  v40 = v7;
  v39 = v8;
  v36 = v11;
  while ( 1 )
  {
    v15 = v14;
    v14 = v13;
    v16 = v7;
    if ( v10 == 20 )
      break;
    v17 = *(_DWORD *)&amp;v42[4 * v10];
    v18 = (v13 &amp; v8 | v15 &amp; ~v8) + v11 + __ROR4__(v16, 27) + v9;
    ++v10;
    v11 = v15;
    v7 = v17 + v18;
    v13 = __ROR4__(v8, 2);
    v8 = v16;
  }
  v19 = 0;
  while ( 1 )
  {
    v20 = v15;
    v15 = v14;
    v21 = v16;
    if ( v19 == 20 )
      break;
    v22 = *(_DWORD *)&amp;_70[4 * v19++];
    v23 = (v14 ^ v8 ^ v20) + __ROR4__(v16, 27) + v11;
    v11 = v20;
    v16 = v23 + *(_DWORD *)(v41 + 104) + v22;
    v14 = __ROR4__(v8, 2);
    v8 = v21;
  }
  v24 = 0;
  while ( 1 )
  {
    v25 = v20;
    v20 = v15;
    v26 = v21;
    if ( v24 == 20 )
      break;
    v15 = __ROR4__(v8, 2);
    v27 = *(_DWORD *)&amp;_C0[4 * v24];
    v28 = (v25 &amp; v20 ^ (v25 ^ v20) &amp; v8) + v11 + __ROR4__(v21, 27) + *(_DWORD *)(v41 + 108);
    ++v24;
    v8 = v21;
    v21 = v28 + v27;
    v11 = v25;
  }
  v29 = 0;
  while ( 1 )
  {
    v30 = v25;
    v25 = v20;
    v31 = v26;
    if ( v29 == 20 )
      break;
    v32 = *(_DWORD *)&amp;_110[4 * v29++];
    v33 = (v20 ^ v8 ^ v30) + __ROR4__(v26, 27) + v11;
    v11 = v30;
    v26 = v33 + *(_DWORD *)(v41 + 112) + v32;
    v20 = __ROR4__(v8, 2);
    v8 = v31;
  }
  LODWORD(v34) = v26 + v40;
  HIDWORD(v34) = v39 + v8;
  *(_QWORD *)(v41 + 80) = v34;
  *(_DWORD *)(v41 + 88) = v20 + v38;
  *(_DWORD *)(v41 + 92) = v37 + v30;
  *(_DWORD *)(v41 + 96) = v36 + v11;
  return _stack_chk_guard - v46;
}
</code></pre><p>这个函数就是 sha1 的一个明文分组计算过程，啥是明文分组呢，简单来说就是你要加密的明文如果很长很长，就要把明文分组，每一组是 512bit，也就是 64 字节长度，不足的要填充，填充规则如下</p><pre tabindex=0><code>1 在信息的后面填充一个1和无数个0，直到满足上面的条件时才停止用0对信息的填充。
2 在这个结果后面附加一个以64位二进制表示的填充前信息长度（单位为Bit），如果二
进制表示的填充前信息长度超过64位，则取低64位。
经过这两步的处理，信息的位长=N*512+448+64=(N+1）*512，即长度恰好是512的整数倍。
这样做的原因是为满足后面处理中对信息长度的要求。
</code></pre><p>要讲明白还是有点难（为了不误人子弟）大家感兴趣的自己搜资料研究；</p><p>回到 tjupdate 函数</p><p>每一个分组进行 4 轮变换，每一轮计算 20 步，伪代码也很明显（78 行、94 行、109 行、125 行）</p><p>我们 hook 这个函数，就能知道每一轮的明文；</p><pre tabindex=0><code>function tjupdate() {
      var pointer = Module.findBaseAddress(&#34;libtujia_encrypt.so&#34;).add(0x2AB4 + 1);
      Interceptor.attach(pointer,
          {
              onEnter: function (args) {
                  myhexdump(&#34;update arg0:&#34;, args[1], 64)
                  console.log(&#34;update arg0:&#34;+Memory.readUtf8String(args[1]))
            },
              onLeave: function (retval) {
              }
          }
      );
</code></pre><p>unidbg hook：</p><pre tabindex=0><code>public void hook_2AB4(){
        IHookZz hookZz = HookZz.getInstance(emulator); 
        hookZz.enable_arm_arm64_b_branch(); 
        hookZz.wrap(module.base + 0x2AB4 + 1, new WrapCallback&lt;HookZzArm32RegisterContext&gt;() {
            @Override
            // 方法执行前
            public void preCall(Emulator&lt;?&gt; emulator, HookZzArm32RegisterContext ctx, HookEntryInfo info) {
                Pointer text = ctx.getPointerArg(1);
                byte[] texthex = text.getByteArray(0, 64);
                Inspector.inspect(texthex, &#34;block&#34;);
            };
            @Override
            // 方法执行后
            public void postCall(Emulator&lt;?&gt; emulator, HookZzArm32RegisterContext ctx, HookEntryInfo info) {
            }
        });
        hookZz.disable_arm_arm64_b_branch();
    };
</code></pre><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IoKVOVJzuQpxbjHOGicCZeopT3w8GQ7wSujKBibT9J0ibyjkJP4kg14rCA/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>然后把每次的明文拼接起来，就是整个的明文</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IVsov6JbDlCkNGHiazE7Ce12SOh7yibgaJ6zGOEYqR4QVCBwokhsQ4l8A/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>然后再 sha1，是不是一样？</p><p>话说回来，Final 还没看呢，Final 是最后整理输出的，</p><p>有些情况不参与计算，有些情况参与计算，也就是 tjget 函数了, 在这个案例里是参与了计算的</p><p>hook 一个</p><pre tabindex=0><code>function tjget() {
      var pointer = Module.findExportByName(&#34;libtujia_encrypt.so&#34;,&#39;tjget&#39;);
      console.log(&#39;case tjget:&#39; + pointer);
      Interceptor.attach(pointer,
          {
              onEnter: function (args) {
                  this.buffer = args[1];
              },
              onLeave: function (retval) {
                  myhexdump(&#34;tjget 结果：&#34;, this.buffer, 20)
              }
          }
      );
  }
</code></pre><p>unidbg hook：</p><pre tabindex=0><code>    public void hook_2CEA(){
        IHookZz hookZz = HookZz.getInstance(emulator); // 加载HookZz
        hookZz.wrap(module.base + 0x2CEA + 1, new WrapCallback&lt;HookZzArm32RegisterContext&gt;() {
            @Override
            // 方法执行前
            public void preCall(Emulator&lt;?&gt; emulator, HookZzArm32RegisterContext ctx, HookEntryInfo info) {
                Pointer arg1 = ctx.getPointerArg(1);
                ctx.push(arg1);
            };
            @Override
            // 方法执行后
            public void postCall(Emulator&lt;?&gt; emulator, HookZzArm32RegisterContext ctx, HookEntryInfo info) {
                Pointer output = ctx.pop();
                byte[] outputhex = output.getByteArray(0, 20);
                Inspector.inspect(outputhex, &#34;tjget ret&#34;);
            }
        });
        hookZz.disable_arm_arm64_b_branch();
    }
</code></pre><p>hook 结果：</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IAia8hIC7rLZ6GLmZorrtVicxdCRerEkvkUB482WY9QmevFYkmJecOyGw/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p><strong>明文的生成</strong></p><p>分析完最后一步的标准算法，回过头来分析明文的生成</p><p>看看具体实现的代码：</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IQibsia3NlKY42jUwbKNSc9QUW5eC268YxrOwiceohLcicUeGo4ypU8G8Rw/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>首先这里生成了固定的 key，</p><p>这里用 unidbg 的另一种 hook 方式</p><p>在这个地方下个断点</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IficjSEPrSf94gVbJWIZmHuC9pJTwh0wdng8DZnMx0evtGmMdTicUic1XQ/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>代码如下：</p><pre tabindex=0><code>    public void HookByConsoleDebugger() {
        Debugger debugger = emulator.attach();
        //在module.base+0x3108地址处添加一个断点
        debugger.addBreakPoint(module.base+0x3108);
    }
    public static void main(String[] args) throws FileNotFoundException {
        Test test = new Test();
        //test.hook2c94();
       // test.hook_2AB4();
        test.HookByConsoleDebugger();
        test.call_encrypt();
       // test.get_bodyencrypt();
    }
</code></pre><p>运行，程序会断下</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IiconIbURy6ozHUKhqxgfMxMkKjgVyhyfw0SsEqic92jYMelACFPvre6w/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>这里的 r0 寄存器存放的是参数 1 的值，r1 是参数 2，r3 是参数 3</p><p>怎么查看 r0 的值呢</p><p>输入：mr0</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8I8z5t3iboojjJN3unuX8Wo1mKxu1xemIvXWro7JGoJEjrOUX6sE8pr5w/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>也可以输入地址：m0xbffff65c</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IIDQLZhHam42GM83GSHqt8JiafLhmypW1Gwk1wGichiacESAFGiclPHULJA/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>默认 size 是 112，可以指定长度</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IIglibS7jgiboV8iajOd9qOuV9jnWq34hKwKWbhucqyEdCrJxOe9y3axlw/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>所以这里的参数 1 是 tjhchk</p><p>返回值怎么看呢，根据 arm 汇编的约定，返回值会放到 r0</p><p>这下面几个地址都可以</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8Ij1uC6kicPeFXkuvogFS5fLibNfqiaX9nVDrZwTPPczaElHWEoRc3zy7Mg/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>在 0x310C 加个断点，命令：b0x310C</p><p>然后按 c（跳到下一个断点）</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8ItibhAmS6zMvXq3xrwl7icjAfF2LPDhahxOV4wxcLicHX7rsv7WMkCRuiaw/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>然后查看 r0 的值</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IZ4NxdiaD9qwNX4quZIPlicgsESfEGexiag493VquichpQRCK5rMFcsMqPQ/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>验证后发现是标准的 base64</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8ILE41sQahfzt48xT4K18NmgBJUqcXl23DhwVK7qicSqrLUzCL4jVwr2A/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>还有一种方法能获取返回值</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8I3Uzbn1MtEFl0KYNFXdjib9eiaBNk4RPTseuKNsP6b3WXnOJRwmnasMqg/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>0x291C 下个断点 (函数具体实现的地址)</p><pre tabindex=0><code>debugger.addBreakPoint(module.base+0x291C);
</code></pre><p>重新运行程序</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IgPfiaAsRBqBmskyFOXUwyjVuFzv1wQUpWFOibevSN1PblS1mwuDV4Ffg/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>这时 r0 一样是 tjhchk</p><p>然后输入命令 blr，blr 会在函数返回的地方下一个断点</p><p>c（跳到一下个断点）</p><p>查看 r0 的值</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IoWwXy7O7Qdj6Wuew5PKjUQLibG9ia7c8o9AzesoMmygICPPd3Cuoz89A/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>生成了 key；然后往下看</p><p>可以看到很多地方都在异或 0x21</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8Iys1HVKfWPASYPx9iblmsVTnvNkskScQHbhTEricZFnBzIBhNhcq29ZDQ/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>这些都是把各个参数先异或 0x21，再拼接，最后是在 j_tjsplittxt 函数做字符串翻转</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IHoZKq1JnpzyPXGIZdAJgh0AX5qDBCZgV7ibYXUwlGUdaicUQberPASdQ/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>来打个断点瞧瞧</p><pre tabindex=0><code>debugger.addBreakPoint(module.base+0x2DEC);
</code></pre><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IDl6QpE4nOH0tHreDkpjafNfq6icxtKwKibjnBrpgFEd1K55yyLAEsqJw/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>这个参数 1 是乱码，我们把他异或 0x21 试试呢</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IdVb87jC2ruYWWxlZXndgL9cZibGxe7H9bDwoYrKJicFyMIl7WgZrzx1g/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>这里就已经拼接好了嘛</p><p>看看返回值，blr，c</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IicibZYub2z5MxA3tuwsFNYWEDllOqZrwbtKHx6YDldrgFr2X0aOwe4KQ/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>这里的返回值在 r8，我猜是因为在 Thumb 程序中，只能使用 r4~r7 来保存局部变量</p><p>直接 mr8 是不行的，</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8Izhw5aIH48OO6laLbXpAQIdrLpprmAKEfxOqZhxAAExSwfw4KhtAXCw/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>所以我们 m0x40223180</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IOUzMZnBd7jqCiceMXhhUKzicfw2icnjdax1b8aEkB0ZjWh4cZWMeybaFA/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>或者输入 s，单步调试，让它把 r8 赋值到 r0</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IibXVFvtKrm6VfBqZ1TQsI6xKShI9YlFe47L3uR4Z8gw0uXDS6u1tp7A/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8Ic26v1gaDF9KQ4xEIEibpURtBQnfLg2xYTFagHUjneUNj6zPhoYQLJZA/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>然后把这个值异或 0x21</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IX58JCuWibnLGwDIETCzOibMONPfQLtZ1yhVk1pFbr7lxlrX7UoHgs7pA/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>然后又是 base64</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8IbY8icH8VWwcQtGian8AGiaqzW6pgdGQGQSQITlz5OnaylwhGNOVJicCQXA/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>上面那个调用第三个参数是 10，这里是 30，有何大咪咪呢？</p><p>进去看看</p><p>编码之前参数 3 不等于 10 的时候编码之前把明文异或 0x21</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8I2fQLeTBOaZg5xJasP3w6jvZGCvibP3DBkCONhoqnWK0orxLCxvnTq7A/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>编码之后参数 3 不等于 10 的时候把明文异或 0x21</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8Iw4yIzEO71Xx88siaicv4r4aH8lna5zpkxC0qxXssiaX6ia20FhdbIAeT9A/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>所以总结下来就是，</p><ol><li><p>每个参数和固定的 key 分别异或 0x21（有个参数要排序）</p></li><li><p>拼接</p></li><li><p>翻转（j_tjsplittxt）</p></li><li><p>异或 0x21（tjtxtutf8）</p></li><li><p>base64 编码（tjtxtutf8）</p></li><li><p>异或 0x21（tjtxtutf8）</p></li><li><p>异或 0x21（j_tjreset）</p></li><li><p>sha1（j_tjreset）</p></li></ol><p>发现没有，4 次异或 0x21，等于就是没有异或。。所以可以简化成 3 步</p><ol><li><p>参数拼接（有个参数要排序）</p></li><li><p>翻转</p></li><li><p>sha1</p></li></ol><p>剩下就是写代码了。。</p><p>下篇 body 分析再见</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_jpg/icBZkwGO7uH4CSjdGEGiabI6rw0gJY5e8I3qibNB54S5D95gqNibiaqWgibgFQ8GFkKrktyLzrBica2X00YMSFJJ0294g/640?wx_fmt=jpeg" alt loading=lazy data-zoomable></div></div></figure></p><p><strong>彩蛋</strong></p><p>初始化链接常数加载汇编指令解析</p><p>0x2C48 下个断点  blr  c  查看 r0</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH42GylcEhBjdBbp7pLyu7kLsOEvIgmm516UKMJywsBDea11jxic8MJUueVZVA4UwicjJcq24h11ianIg/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>上面说了转成小端就是 sha1 五个幻数</p><pre tabindex=0><code>0x67452301 0xEFCDAB89 0x98BADCFE  0x10325476 0xC3DEE1F0
</code></pre><p>看看汇编是怎么加载的</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH42GylcEhBjdBbp7pLyu7kLlwFTTYUODtGibt5YbAM6qKUfv8OWB2Q9LlShRC4ibaaEiaeFrHXF4kGzw/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><pre tabindex=0><code>ADR  R1, dword_2C80
</code></pre><p>adr 用来加载地址，而且是相对地址寻址</p><p>dword 修饰一个操作数为 Double Word，即 4 字节</p><p>即 0x2C80 地址放到 R1</p><p>看看内存中的值</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH5EUJXagGDvgbWxZEhwib58o5bofiaQqtdXdlUsT6tVMNXO4TyxJyJLBM3JsZAsMIHhicCx5M6ETmcbg/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>然后就是下面的两行</p><pre tabindex=0><code>VLD1.64   {D16-D17}, [R1]
VST1.64   {D16-D17}, [R0]
</code></pre><p>V 开头表示是 NEON 指令</p><p>什么是 NEON（抄的）</p><pre tabindex=0><code>Arm NEON 技术是针对 Arm Cortex-A 系列和 Cortex-R52 处理器的高级 SIMD（单指令多数据）架构扩展。
具有NEON技术的处理器都会配备了32个64位的寄存器和16个128位的寄存器,它们分别被标识为(D0-D31),(Q0-Q15)
</code></pre><pre tabindex=0><code>vld1.64 {d16, d17}, [r1]
将r1内存中的数据映射到d16, d17寄存器上面。这样就可以直接通过d16, d17寄存器来操作数据,64表示一个寄存器有64位(8个16进制)
</code></pre><p>在这里就是把 r1 中的 01 23 45 67 89 AB CD EF 放到 d16 寄存器，FE DC BA 98 76 54 32 10 放到 d17 寄存器</p><pre tabindex=0><code>vst1.64 {d16, d17}, [r0]
将d16, d17寄存器中的数据映射回r0内存中，这样就可以通过打印r0来看到结果
</code></pre><p>在这里就是把 d16(01 23 45 67 89 AB CD EF) 放到 r0 寄存器，d17(FE DC BA 98 76 54 32 10) 放到 r0 寄存器</p><p>之后呢在 tjupdate 函数里，加载出来使用</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH5EUJXagGDvgbWxZEhwib58ojm7RI8TdiaOCsXcNZGexHKmicoSWnGYJL5iaHQaF1sQvducaib33CEx6icA/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>汇编</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH5EUJXagGDvgbWxZEhwib58obiaNM13OH2EqZiafxIbo0oLjibvSjibcGqgmlVW1wuIbRicxvIicibQBCCZrA/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>重点说下这个地方</p><pre tabindex=0><code>LDMIA.W R11, {R2,R3,R11}
LDMIA指令，IA表示每次传送后地址加4,W修饰一个操作数为Double Word，即4字节
</code></pre><p>R11 在 unidbg 中是 sp</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH5EUJXagGDvgbWxZEhwib58oxLPWQGEIDwib5yf3sZGqGf1Pib01ZbXOl3GbYq8ibAV7jNuQRJl5uTSOg/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH5EUJXagGDvgbWxZEhwib58ogNvrO98yoPLfTeTtto9Md3yw0B8JbicvMqWm2F2OHm65qdVVareKlRQ/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>依次把 FE DC BA 98 放到 R2; 76 54 32 10 放到 R3</p><p>按 s</p><p>可以看到 R2、R3 已经被重新赋值 (小端)</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://mmbiz.qpic.cn/mmbiz_png/icBZkwGO7uH5EUJXagGDvgbWxZEhwib58o1GlwIzUmhGpahGHsFky7qBdTInDrg3v8W16AmuIIZj9Zg2ukYuaJ4w/640?wx_fmt=png" alt loading=lazy data-zoomable></div></div></figure></p><p>其他的地方可以自己动态调试看看</p></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>上一页</div><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/unidbg-%E7%AE%97%E6%B3%95%E8%BF%98%E5%8E%9F%E6%9C%AF-%E6%9F%90%E6%B0%91%E5%AE%BF-app-%E7%AF%87-%E4%B8%8B%E5%8D%B7/ rel=next>unidbg 算法还原术 · 某民宿 app 篇 · 下卷</a></div><div class="col-6 post-nav-item"><div class=meta-nav>下一页</div><a href=/books/infosecurity-series/%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/%E5%A4%A7%E7%8C%BF%E6%90%9C%E9%A2%98-sign-so-%E5%8A%A0%E5%AF%86%E5%8F%82%E6%95%B0%E5%88%86%E6%9E%90unidbg/ rel=prev>大猿搜题 sign so 加密参数分析｜unidbg</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>