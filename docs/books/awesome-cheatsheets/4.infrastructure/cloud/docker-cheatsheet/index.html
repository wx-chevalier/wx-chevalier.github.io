<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="ğŸ“– èŠ‚é€‰è‡ª Awesome CheatSheet/Docker CheatSheetï¼Œå¯¹æ¥è‡ªå®˜æ–¹æ–‡æ¡£åŠ Docker Links ä¸­é“¾æ¥å†…å®¹çš„å½’æ¡£æ•´ç†ï¼ŒåŒ…å«äº†æ—¥å¸¸å·¥ä½œä¸­å¸¸ç”¨çš„ Docker æ¦‚å¿µä¸å‘½ä»¤ï¼Œå¦‚æœå¯¹äº Linux å¸¸ç”¨æ“ä½œå°šä¸ç†Ÿæ‚‰çš„å¯ä»¥å‚è€ƒ Linux Commands CheatSheetã€‚ Docker CheatSheet | Docker é…ç½®ä¸å®è·µæ¸…å• å®¹å™¨"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/awesome-cheatsheets/4.infrastructure/cloud/docker-cheatsheet/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/awesome-cheatsheets/4.infrastructure/cloud/docker-cheatsheet/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/awesome-cheatsheets/4.infrastructure/cloud/docker-cheatsheet/"><meta property="og:title" content="Docker-Cheatsheet | Next-gen Tech Edu"><meta property="og:description" content="ğŸ“– èŠ‚é€‰è‡ª Awesome CheatSheet/Docker CheatSheetï¼Œå¯¹æ¥è‡ªå®˜æ–¹æ–‡æ¡£åŠ Docker Links ä¸­é“¾æ¥å†…å®¹çš„å½’æ¡£æ•´ç†ï¼ŒåŒ…å«äº†æ—¥å¸¸å·¥ä½œä¸­å¸¸ç”¨çš„ Docker æ¦‚å¿µä¸å‘½ä»¤ï¼Œå¦‚æœå¯¹äº Linux å¸¸ç”¨æ“ä½œå°šä¸ç†Ÿæ‚‰çš„å¯ä»¥å‚è€ƒ Linux Commands CheatSheetã€‚ Docker CheatSheet | Docker é…ç½®ä¸å®è·µæ¸…å• å®¹å™¨"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><meta property="article:modified_time" content="2023-04-16T20:01:58+08:00"><title>Docker-Cheatsheet | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=b18ff93fa0e9711b67c3fcb3d7e907dd><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>æœç´¢</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=å…³é—­><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=åˆ‡æ¢å¯¼èˆª>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>ç¬”è®°ï¼ˆä¸‡ç¯‡ï¼‰</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>çŸ¥è¯†å›¾è°±</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>å®éªŒå®¤</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft æ–¹å—ä¸–ç•Œ</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D çŸ¥è¯†å¡ç‰Œ</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>å…¶ä»–é˜…è¯»æ¸ é“</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>çŸ¥ä¹</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>æ˜é‡‘</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=æœç´¢><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">Cloud</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>æœç´¢...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id0ec61351a690292b4038fdf8847a1a69")' href=#id0ec61351a690292b4038fdf8847a1a69 aria-expanded=false aria-controls=id0ec61351a690292b4038fdf8847a1a69 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/4.infrastructure/>4.Infrastructure</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id0ec61351a690292b4038fdf8847a1a69 aria-expanded=false aria-controls=id0ec61351a690292b4038fdf8847a1a69><i class="fa-solid fa-angle-down" id=caret-id0ec61351a690292b4038fdf8847a1a69></i></a></div><ul class="nav docs-sidenav collapse show" id=id0ec61351a690292b4038fdf8847a1a69><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idfcc42c0f835b56cc6b0714a3567894bd")' href=#idfcc42c0f835b56cc6b0714a3567894bd aria-expanded=false aria-controls=idfcc42c0f835b56cc6b0714a3567894bd aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/4.infrastructure/cloud/>Cloud</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idfcc42c0f835b56cc6b0714a3567894bd aria-expanded=false aria-controls=idfcc42c0f835b56cc6b0714a3567894bd><i class="fa-solid fa-angle-down" id=caret-idfcc42c0f835b56cc6b0714a3567894bd></i></a></div><ul class="nav docs-sidenav collapse show" id=idfcc42c0f835b56cc6b0714a3567894bd><li class="child level active"><a href=/books/awesome-cheatsheets/4.infrastructure/cloud/docker-cheatsheet/>Docker-Cheatsheet</a></li><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id5370d4ccf91142356bddfd79d787fbdc")' href=#id5370d4ccf91142356bddfd79d787fbdc aria-expanded=false aria-controls=id5370d4ccf91142356bddfd79d787fbdc aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/4.infrastructure/cloud/k8s/>K8s</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id5370d4ccf91142356bddfd79d787fbdc aria-expanded=false aria-controls=id5370d4ccf91142356bddfd79d787fbdc><i class="fa-solid fa-angle-right" id=caret-id5370d4ccf91142356bddfd79d787fbdc></i></a></div><ul class="nav docs-sidenav collapse" id=id5370d4ccf91142356bddfd79d787fbdc><li class="child level"><a href=/books/awesome-cheatsheets/4.infrastructure/cloud/k8s/kubectl-cheatsheet/>Kubectl-CheatSheet</a></li></ul></div></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id36b7d77cc42c5a1135a68a2701dcde7f")' href=#id36b7d77cc42c5a1135a68a2701dcde7f aria-expanded=false aria-controls=id36b7d77cc42c5a1135a68a2701dcde7f aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/4.infrastructure/dataengineering/>DataEngineering</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id36b7d77cc42c5a1135a68a2701dcde7f aria-expanded=false aria-controls=id36b7d77cc42c5a1135a68a2701dcde7f><i class="fa-solid fa-angle-right" id=caret-id36b7d77cc42c5a1135a68a2701dcde7f></i></a></div><ul class="nav docs-sidenav collapse" id=id36b7d77cc42c5a1135a68a2701dcde7f><li class="child level"><a href=/books/awesome-cheatsheets/4.infrastructure/dataengineering/datavis-cheatsheet/>DataVis-CheatSheet</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idf149a3607b88a5be72f1a1682cd40ed4")' href=#idf149a3607b88a5be72f1a1682cd40ed4 aria-expanded=false aria-controls=idf149a3607b88a5be72f1a1682cd40ed4 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/4.infrastructure/distributed/>Distributed</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idf149a3607b88a5be72f1a1682cd40ed4 aria-expanded=false aria-controls=idf149a3607b88a5be72f1a1682cd40ed4><i class="fa-solid fa-angle-right" id=caret-idf149a3607b88a5be72f1a1682cd40ed4></i></a></div><ul class="nav docs-sidenav collapse" id=idf149a3607b88a5be72f1a1682cd40ed4><li class="child level"><a href=/books/awesome-cheatsheets/4.infrastructure/distributed/blockchain-cheatsheet/>Blockchain-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/4.infrastructure/distributed/concurrentprogramming-cheatsheet/>ConcurrentProgramming-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/4.infrastructure/distributed/distributedsystem-cheatsheet/>DistributedSystem-CheatSheet</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ide7931dd59e0902d9791c5564dd53c0ce")' href=#ide7931dd59e0902d9791c5564dd53c0ce aria-expanded=false aria-controls=ide7931dd59e0902d9791c5564dd53c0ce aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/4.infrastructure/infosecurity/>InfoSecurity</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ide7931dd59e0902d9791c5564dd53c0ce aria-expanded=false aria-controls=ide7931dd59e0902d9791c5564dd53c0ce><i class="fa-solid fa-angle-right" id=caret-ide7931dd59e0902d9791c5564dd53c0ce></i></a></div><ul class="nav docs-sidenav collapse" id=ide7931dd59e0902d9791c5564dd53c0ce><li class="child level"><a href=/books/awesome-cheatsheets/4.infrastructure/infosecurity/codec-cheatsheet/>Codec-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/4.infrastructure/infosecurity/websecurity-cheatsheet/>WebSecurity-CheatSheet</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id7d89ef7c82ef0628fa28b2c38d26a60f")' href=#id7d89ef7c82ef0628fa28b2c38d26a60f aria-expanded=false aria-controls=id7d89ef7c82ef0628fa28b2c38d26a60f aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/4.infrastructure/messagequeue/>MessageQueue</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id7d89ef7c82ef0628fa28b2c38d26a60f aria-expanded=false aria-controls=id7d89ef7c82ef0628fa28b2c38d26a60f><i class="fa-solid fa-angle-right" id=caret-id7d89ef7c82ef0628fa28b2c38d26a60f></i></a></div><ul class="nav docs-sidenav collapse" id=id7d89ef7c82ef0628fa28b2c38d26a60f><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ida974d8f14b774f2bfe535909bbe67434")' href=#ida974d8f14b774f2bfe535909bbe67434 aria-expanded=false aria-controls=ida974d8f14b774f2bfe535909bbe67434 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/4.infrastructure/messagequeue/kafka/>Kafka</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ida974d8f14b774f2bfe535909bbe67434 aria-expanded=false aria-controls=ida974d8f14b774f2bfe535909bbe67434><i class="fa-solid fa-angle-right" id=caret-ida974d8f14b774f2bfe535909bbe67434></i></a></div><ul class="nav docs-sidenav collapse" id=ida974d8f14b774f2bfe535909bbe67434><li class="child level"><a href=/books/awesome-cheatsheets/4.infrastructure/messagequeue/kafka/kafka-cheatsheet/>Kafka-CheatSheet</a></li></ul></div><li class="child level"><a href=/books/awesome-cheatsheets/4.infrastructure/messagequeue/pulsar-cheatsheet/>Pulsar-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/4.infrastructure/messagequeue/rabbitmq-cheatsheet/>RabbitMQ-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/4.infrastructure/messagequeue/rocketmq-cheatsheet/>RocketMQ-CheatSheet</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idd676629d51d89d19a18158ae64594497")' href=#idd676629d51d89d19a18158ae64594497 aria-expanded=false aria-controls=idd676629d51d89d19a18158ae64594497 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/4.infrastructure/network/>Network</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idd676629d51d89d19a18158ae64594497 aria-expanded=false aria-controls=idd676629d51d89d19a18158ae64594497><i class="fa-solid fa-angle-right" id=caret-idd676629d51d89d19a18158ae64594497></i></a></div><ul class="nav docs-sidenav collapse" id=idd676629d51d89d19a18158ae64594497><li class="child level"><a href=/books/awesome-cheatsheets/4.infrastructure/network/network-cheatsheet/>Network-CheatSheet</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id34b2bda25b80a5bd1f6cc7ede017f582")' href=#id34b2bda25b80a5bd1f6cc7ede017f582 aria-expanded=false aria-controls=id34b2bda25b80a5bd1f6cc7ede017f582 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/4.infrastructure/os/>OS</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id34b2bda25b80a5bd1f6cc7ede017f582 aria-expanded=false aria-controls=id34b2bda25b80a5bd1f6cc7ede017f582><i class="fa-solid fa-angle-right" id=caret-id34b2bda25b80a5bd1f6cc7ede017f582></i></a></div><ul class="nav docs-sidenav collapse" id=id34b2bda25b80a5bd1f6cc7ede017f582><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idb622a5bd9b9ce63653a8d111c70d3f00")' href=#idb622a5bd9b9ce63653a8d111c70d3f00 aria-expanded=false aria-controls=idb622a5bd9b9ce63653a8d111c70d3f00 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/4.infrastructure/os/linux/>Linux</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idb622a5bd9b9ce63653a8d111c70d3f00 aria-expanded=false aria-controls=idb622a5bd9b9ce63653a8d111c70d3f00><i class="fa-solid fa-angle-right" id=caret-idb622a5bd9b9ce63653a8d111c70d3f00></i></a></div><ul class="nav docs-sidenav collapse" id=idb622a5bd9b9ce63653a8d111c70d3f00><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id8e2f2cf5a05961e3380a95da2127d054")' href=#id8e2f2cf5a05961e3380a95da2127d054 aria-expanded=false aria-controls=id8e2f2cf5a05961e3380a95da2127d054 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/4.infrastructure/os/linux/commands/>Commands</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id8e2f2cf5a05961e3380a95da2127d054 aria-expanded=false aria-controls=id8e2f2cf5a05961e3380a95da2127d054><i class="fa-solid fa-angle-right" id=caret-id8e2f2cf5a05961e3380a95da2127d054></i></a></div><ul class="nav docs-sidenav collapse" id=id8e2f2cf5a05961e3380a95da2127d054><li class="child level"><a href=/books/awesome-cheatsheets/4.infrastructure/os/linux/commands/bash-pitfalls/>Bash Pitfalls</a></li><li class="child level"><a href=/books/awesome-cheatsheets/4.infrastructure/os/linux/commands/heibaiying-linux-commands-cheatsheet/>Heibaiying-Linux-Commands-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/4.infrastructure/os/linux/commands/trinib-linux-commands-cheatsheet/>Trinib-Linux-Commands-CheatSheet</a></li></ul></div><li class="child level"><a href=/books/awesome-cheatsheets/4.infrastructure/os/linux/linux-cheatsheet/>Linux-CheatSheet</a></li><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ideee592579f4f926ed062ab4c30116231")' href=#ideee592579f4f926ed062ab4c30116231 aria-expanded=false aria-controls=ideee592579f4f926ed062ab4c30116231 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/4.infrastructure/os/linux/shell/>Shell</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ideee592579f4f926ed062ab4c30116231 aria-expanded=false aria-controls=ideee592579f4f926ed062ab4c30116231><i class="fa-solid fa-angle-right" id=caret-ideee592579f4f926ed062ab4c30116231></i></a></div><ul class="nav docs-sidenav collapse" id=ideee592579f4f926ed062ab4c30116231><li class="child level"><a href=/books/awesome-cheatsheets/4.infrastructure/os/linux/shell/linux-shell-cheatsheet/>Linux-Shell-CheatSheet</a></li></ul></div></ul></div><li class="child level"><a href=/books/awesome-cheatsheets/4.infrastructure/os/raspberry-cheatsheet/>Raspberry-CheatSheet</a></li></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>ç›®å½•</a></li></ul><nav id=TableOfContents><ul><li><a href=#docker-ce>Docker CE</a></li><li><a href=#daemon-configuration>Daemon Configuration</a></li><li><a href=#docker-swarm>Docker Swarm</a></li><li><a href=#å¸¸ç”¨é…ç½®>å¸¸ç”¨é…ç½®</a><ul><li><a href=#ä»£ç†>ä»£ç†</a></li><li><a href=#å­˜å‚¨ä¸æ—¥å¿—>å­˜å‚¨ä¸æ—¥å¿—</a></li></ul></li></ul><ul><li><a href=#æ„å»ºä¸æ‹‰å–>æ„å»ºä¸æ‹‰å–</a></li><li><a href=#é•œåƒç®¡ç†>é•œåƒç®¡ç†</a></li><li><a href=#dockfile>Dockfile</a></li><li><a href=#registry>Registry</a></li><li><a href=#å¤šé˜¶æ®µæ„å»º>å¤šé˜¶æ®µæ„å»º</a></li></ul><ul><li><a href=#å¯åœæ§åˆ¶>å¯åœæ§åˆ¶</a></li><li><a href=#çŠ¶æ€æŸ¥è¯¢>çŠ¶æ€æŸ¥è¯¢</a></li><li><a href=#ç®¡ç†é…ç½®>ç®¡ç†é…ç½®</a></li><li><a href=#èµ„æºé…é¢>èµ„æºé…é¢</a><ul><li><a href=#memory>Memory</a></li><li><a href=#cpu>CPU</a></li><li><a href=#storage>Storage</a></li></ul></li></ul><ul><li><a href=#volume--æ•°æ®å·>Volume | æ•°æ®å·</a></li><li><a href=#network--ç½‘ç»œ>Network | ç½‘ç»œ</a><ul><li><a href=#dns>DNS</a></li></ul></li><li><a href=#ç©ºé—´æ¸…ç†>ç©ºé—´æ¸…ç†</a></li></ul><ul><li><a href=#docker-compose>Docker Compose</a></li><li><a href=#docker-swarm-1>Docker Swarm</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=ç‹ä¸‹é‚€æœˆç†Šçš„å¾®ä¿¡å…¬ä¼—å·></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>Docker-Cheatsheet</h1><div class=article-style><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://user-images.githubusercontent.com/5803001/45699770-5d0a0f00-bb9d-11e8-8ce7-82650bfcbb39.png alt=image loading=lazy data-zoomable></div></div></figure></p><blockquote><p>ğŸ“– èŠ‚é€‰è‡ª <a href=https://parg.co/o9d target=_blank rel=noopener>Awesome CheatSheet/Docker CheatSheet</a>ï¼Œå¯¹æ¥è‡ª<a href=https://docs.docker.com/ target=_blank rel=noopener>å®˜æ–¹æ–‡æ¡£</a>åŠ <a href=https://parg.co/o90 target=_blank rel=noopener>Docker Links</a> ä¸­é“¾æ¥å†…å®¹çš„å½’æ¡£æ•´ç†ï¼ŒåŒ…å«äº†æ—¥å¸¸å·¥ä½œä¸­å¸¸ç”¨çš„ Docker æ¦‚å¿µä¸å‘½ä»¤ï¼Œå¦‚æœå¯¹äº Linux å¸¸ç”¨æ“ä½œå°šä¸ç†Ÿæ‚‰çš„å¯ä»¥å‚è€ƒ <a href=https://parg.co/oiT target=_blank rel=noopener>Linux Commands CheatSheet</a>ã€‚</p></blockquote><h1 id=docker-cheatsheet--docker-é…ç½®ä¸å®è·µæ¸…å•>Docker CheatSheet | Docker é…ç½®ä¸å®è·µæ¸…å•</h1><p>å®¹å™¨æ˜¯åœ¨æ“ä½œç³»ç»Ÿä¸­å»ºç«‹éš”ç¦»ä¸Šä¸‹æ–‡çš„ä¸€ç§æ–¹æ³•ã€‚å®é™…ä¸Šï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä¸­çš„æ¯ä¸€ä¸ªéƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„åŒ…å«äº†ä¸€ç»„å·²å®‰è£…çš„è½¯ä»¶å’Œç›¸å…³é…ç½®çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿã€‚ç”±äºå®ƒä»¬æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œå› æ­¤ä»»ä½•å®¹å™¨éƒ½ä¸èƒ½ç›´æ¥è®¿é—®æˆ–å½±å“å…¶ä»–å®¹å™¨æˆ–åº•å±‚å®¿ä¸»æ“ä½œç³»ç»Ÿã€‚Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼ŒåŸºäº Go è¯­è¨€ å¹¶éµä» Apache2.0 åè®®å¼€æºã€‚Docker å¯ä»¥è®©å¼€å‘è€…æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªè½»é‡çº§ã€å¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æœºå™¨ä¸Šã€‚</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://user-images.githubusercontent.com/5803001/43813144-f630ba5c-9af6-11e8-8443-175666d4615a.png alt=image loading=lazy data-zoomable></div></div></figure></p><p>è™šæ‹Ÿæœºæœ€å¤§çš„ç“¶é¢ˆåœ¨äºå…¶éœ€è¦ç‰¹æ®Šç¡¬ä»¶è™šæ‹ŸåŒ–æŠ€æœ¯æ”¯æŒï¼Œå¹¶ä¸”æºå¸¦å®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼›è€Œ Docker æ²¡æœ‰ç¡¬ä»¶è™šæ‹ŸåŒ–ï¼Œå¯ä»¥è¿è¡Œåœ¨ç‰©ç†æœºã€è™šæ‹Ÿæœº, ç”šè‡³åµŒå¥—è¿è¡Œåœ¨ Docker å®¹å™¨å†…ï¼Œå¹¶ä¸”å…¶ä¸æºå¸¦æ“ä½œç³»ç»Ÿçš„ï¼Œä¼šè½»å·§å¾ˆå¤šã€‚åœ¨è°ƒç”¨å®¿ä¸»æœºçš„å†…å­˜ã€CPUã€ç£ç›˜ç­‰ç­‰èµ„æºæ—¶ï¼Œè™šæ‹Ÿæœºæ˜¯åˆ©ç”¨ Hypervisor å»è™šæ‹ŸåŒ–å†…å­˜ï¼Œæ•´ä¸ªè°ƒç”¨è¿‡ç¨‹æ˜¯è™šæ‹Ÿå†…å­˜->è™šæ‹Ÿç‰©ç†å†…å­˜->çœŸæ­£ç‰©ç†å†…å­˜ï¼Œä½†æ˜¯ Docker æ˜¯åˆ©ç”¨ Docker Engine å»è°ƒç”¨å®¿ä¸»çš„çš„èµ„æºï¼Œè¿™æ—¶å€™è¿‡ç¨‹æ˜¯è™šæ‹Ÿå†…å­˜->çœŸæ­£ç‰©ç†å†…å­˜ã€‚</p><p>Docker ç»¼åˆè¿ç”¨äº† Cgroup, Linux Namespaceï¼ŒSecomp capability, Selinux ç­‰æœºåˆ¶ï¼Œåœ¨ <a href=./Docker-Internals-CheatSheet>Docker Internals CheatSheet</a> ä¸­æˆ‘ä»¬ä¼šæœ‰è¯¦ç»†çš„è®¨è®ºï¼Œæˆ–è€…å‰å¾€ <a href=https://github.com/wx-chevalier/Backend-Boilerplate/tree/master/docker target=_blank rel=noopener>Backend Boilerplate/docker</a> æµè§ˆå¸¸è§æœåŠ¡/åº”ç”¨çš„ Docker é…ç½®æ¡ˆä¾‹ã€‚</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://user-images.githubusercontent.com/5803001/44158672-dec2d480-a0e7-11e8-9f50-ce83c9638853.png alt=image loading=lazy data-zoomable></div></div></figure></p><h1 id=å®‰è£…ä¸é…ç½®>å®‰è£…ä¸é…ç½®</h1><h2 id=docker-ce>Docker CE</h2><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨<a href=https://mirrors.ustc.edu.cn/help/docker-ce.html target=_blank rel=noopener>ç§‘å¤§çš„ Docker CE æº</a>è¿›è¡Œå®‰è£…ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># æ›´æ”¹ Ubuntu é»˜è®¤æºåœ°å€</span>
</span></span><span class=line><span class=cl>$ sudo sed -i <span class=s1>&#39;s/archive.ubuntu.com/mirrors.ustc.edu.cn/g&#39;</span> /etc/apt/sources.list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å®‰è£…å¿…å¤‡çš„ç³»ç»Ÿå‘½ä»¤</span>
</span></span><span class=line><span class=cl>$ sudo apt-get install -y python-software-properties
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ curl -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/gpg <span class=p>|</span> sudo apt-key add -
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ sudo add-apt-repository <span class=s2>&#34;deb [arch=amd64] https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu </span><span class=k>$(</span>lsb_release -cs<span class=k>)</span><span class=s2> stable&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ sudo apt-get update
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ apt-cache policy docker-ce <span class=c1># åˆ—ä¸¾ docker-ce ç‰ˆæœ¬</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ apt-get install docker-ce<span class=o>=</span>17.03.2-ce....
</span></span></code></pre></div><h2 id=daemon-configuration>Daemon Configuration</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># é…ç½®å¼€æœºè‡ªå¯åŠ¨</span>
</span></span><span class=line><span class=cl>$ sudo systemctl <span class=nb>enable</span> docker
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å–æ¶ˆå¼€æœºè‡ªå¯åŠ¨</span>
</span></span><span class=line><span class=cl>$ sudo systemctl disable docker
</span></span></code></pre></div><p>æˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹å­˜å‚¨è·¯å¾„ï¼ŒæŒ‡å®šé•œåƒå­˜å‚¨åœ°å€ï¼Œå…è®¸è¿œç¨‹è®¿é—®ï¼›æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ systemd ä¸­çš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ <code>/etc/docker/daemon.json</code>ï¼Œæ­¤å¤„ä»¥ä¿®æ”¹æœåŠ¡ä¸ºä¾‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># ä½¿ç”¨ systemctl å‘½ä»¤è¡Œä¿®æ”¹</span>
</span></span><span class=line><span class=cl>$ sudo systemctl edit docker.service
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æˆ–è€…æŸ¥æ‰¾é…ç½®åœ°å€å¹¶ä½¿ç”¨ Vim ä¿®æ”¹</span>
</span></span><span class=line><span class=cl>$ systemctl status docker
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¿®æ”¹æ–‡ä»¶å†…å®¹</span>
</span></span><span class=line><span class=cl><span class=o>[</span>Service<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>ExecStart</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=nv>ExecStart</span><span class=o>=</span>/usr/bin/dockerd -H fd:// -H tcp://127.0.0.1:2375 -H unix:///var/run/docker.sock --insecure-registry 10.196.108.176:5000 --dns 114.114.114.114 --dns 8.8.8.8 --dns 8.8.4.4 -g /mnt
</span></span></code></pre></div><p>ç„¶åé‡å¯æœåŠ¡ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># é‡æ–°è½½å…¥æœåŠ¡é…ç½®</span>
</span></span><span class=line><span class=cl>$ sudo systemctl daemon-reload
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># é‡å¯ Docker</span>
</span></span><span class=line><span class=cl>$ sudo systemctl restart docker.service
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ¤æ–­æ˜¯å¦é…ç½®æˆåŠŸ</span>
</span></span><span class=line><span class=cl>$ sudo netstat -lntp <span class=p>|</span> grep dockerd
</span></span></code></pre></div><h2 id=docker-swarm>Docker Swarm</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># åœ¨ä¸»èŠ‚ç‚¹å¯åŠ¨ Swarm</span>
</span></span><span class=line><span class=cl>$ docker swarm init
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹ Swarm å¯†é’¥</span>
</span></span><span class=line><span class=cl>$ docker swarm join-token -q worker
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åœ¨ä¸»èŠ‚ç‚¹å¯åŠ¨ Procontainer</span>
</span></span><span class=line><span class=cl>$ docker run -it -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åœ¨ä¸»èŠ‚ç‚¹å¯åŠ¨ Registry</span>
</span></span><span class=line><span class=cl>$ docker run -d -p 5000:5000 --restart<span class=o>=</span>always --name registry registry:2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å°†å­èŠ‚ç‚¹åŠ å…¥åˆ° Swarm</span>
</span></span><span class=line><span class=cl>$ docker swarm join <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--token <span class=si>${</span><span class=nv>TOKEN</span><span class=si>}</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>10.196.108.176:2377
</span></span></code></pre></div><h2 id=å¸¸ç”¨é…ç½®>å¸¸ç”¨é…ç½®</h2><h3 id=ä»£ç†>ä»£ç†</h3><p>é‰´äº gcr åŸŸåçš„ä¸å¯ç”¨ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨ <a href=https://hub.docker.com/r/bluebu/shadowsocks-privoxy/ target=_blank rel=noopener>ss-privoxy</a> ç­‰å·¥å…·æ­å»º Docker æºä»£ç†ï¼Œä¹Ÿå¯ä»¥å‚è€ƒ<a href=https://www.jianshu.com/p/13f4b23824d8 target=_blank rel=noopener>è¿™é‡Œ</a>æ‰‹åŠ¨é…ç½®å®¢æˆ·ç«¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ docker run -i -t -e <span class=nv>SERVER_ADDR</span><span class=o>=</span>ss.server.ip -e <span class=nv>SERVER_PORT</span><span class=o>=</span>port -e <span class=nv>PASSWORD</span><span class=o>=</span><span class=m>123456</span> bluebu/shadowsocks-privoxy
</span></span></code></pre></div><p>å¦‚æœéœ€è¦æ‰‹åŠ¨å®‰è£…ï¼Œéœ€è¦å…ˆå®‰è£… sslocal å‘½ä»¤ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ apt install python3-pip
</span></span><span class=line><span class=cl>$ pip3 install https://github.com/shadowsocks/shadowsocks/archive/master.zip -U
</span></span></code></pre></div><p>å†™å…¥ä½ çš„é…ç½®æ–‡ä»¶åˆ°ä¾‹å¦‚ <code>config.json</code>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;server&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;server_port&#34;</span><span class=p>:</span> <span class=err>...</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;local_port&#34;</span><span class=p>:</span> <span class=mi>1080</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;password&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;method&#34;</span><span class=p>:</span> <span class=s2>&#34;chacha20-ietf-poly1305&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;timeout&#34;</span><span class=p>:</span> <span class=mi>600</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>å¯åŠ¨ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ sslocal -c config.json
</span></span></code></pre></div><p>è¿™æ—¶ä¸€ä¸ª socks5 ä»£ç†åœ¨ä½ æœ¬æœºå°±å¯åŠ¨äº†ã€‚ä¸‹é¢å®‰è£…é…ç½® privoxy æŠŠä»–è½¬æˆ http/https ä»£ç†ã€‚å®‰è£…ç•¥ã€‚ä¿®æ”¹/æ·»åŠ ä¸¤ä¸ª privoxy çš„é…ç½®(å¯¹äº ubuntu, åœ¨ /etc/privoxy/config)ï¼š</p><pre tabindex=0><code>listen-address 0.0.0.0:8118        # æ‰€æœ‰ interface ä¸Šç›‘å¬æµé‡
forward-socks5 / 127.0.0.1:1080 .  # æµé‡å¯¼å‘æœ¬æœºä¸Šçš„ ss ä»£ç†
</code></pre><p>è¿™æ—¶å¯ä»¥è®¿é—®ä¸€ä¸‹ä¸å­˜åœ¨çš„ç½‘ç«™æµ‹è¯•ä¸€ä¸‹ï¼š</p><pre tabindex=0><code>HTTP_PROXY=127.0.0.1:8118 HTTPS_PROXY=127.0.0.1:8118 curl https://www.google.com
</code></pre><p>ä¸‹é¢ä¿®æ”¹å„å°æœºå™¨çš„ docker é…ç½®(å‡å®šæˆ‘ä»¬çš„ master å†…ç½‘åœ°å€ <code>1.1.1.2</code>, å…¶ä»–ä¸¤å°æœºå™¨åœ°å€ä¸º <code>1.1.1.3</code> å’Œ <code>1.1.1.4</code>)ï¼š</p><pre tabindex=0><code>[Environment]
Environment=&#34;HTTP_PROXY=127.0.0.1:8118&#34; &#34;HTTPS_PROXY=127.0.0.1:8118&#34; &#34;NO_PROXY=localhost,127.0.0.1,1.1.1.2,1.1.1.3,1.1.1.4&#34;

...
</code></pre><p>ç¯å¢ƒå˜é‡ <code>NO_PROXY</code> é¡¾åæ€ä¹‰ï¼Œå®ƒä¸æ”¯æŒ CIDR åº”è¯¥ï¼Œæ‰€ä»¥éœ€è¦ä½ æšä¸¾ä¸€ä¸‹é›†ç¾¤ä¸»æœºåœ°å€ã€‚</p><h3 id=å­˜å‚¨ä¸æ—¥å¿—>å­˜å‚¨ä¸æ—¥å¿—</h3><p>çº¿ä¸Šç³»ç»Ÿä¸­æˆ‘ä»¬å¾€å¾€ä¹Ÿéœ€è¦å¯¹äº Docker äº§ç”Ÿçš„</p><h1 id=é•œåƒ>é•œåƒ</h1><p>é•œåƒæè¿°äº† Docker å®¹å™¨è¿è¡Œçš„åˆå§‹æ–‡ä»¶ç³»ç»Ÿ, åŒ…å«è¿è¡Œåº”ç”¨æ‰€éœ€çš„æ‰€æœ‰ä¾èµ–ã€‚å³å¯ä»¥æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿ, ä¹Ÿå¯ä»¥ä»…åŒ…å«åº”ç”¨æ‰€éœ€çš„æœ€å° bin/lib æ–‡ä»¶é›†åˆã€‚Docker é•œåƒå’Œå®¹å™¨é‡‡ç”¨åˆ†å±‚æ–‡ä»¶ç³»ç»Ÿç»“æ„, æ¯ä¸ªå®¹å™¨åŒ…å«ä¸€å±‚è–„è–„çš„å¯å†™å±‚, åªè¯»éƒ¨åˆ†æ˜¯å…±äº«çš„ï¼Œè¿™ç§æœºåˆ¶ä¿è¯äº†èµ„æºçš„å¯å¤ç”¨æ€§ï¼Œå‡å°‘äº†é•œåƒä¸å®¹å™¨çš„ç©ºé—´å ç”¨ã€‚Docker é•œåƒå­˜å‚¨å¼•æ“æœ‰ aufs, devicemapper, overlay ç­‰å¤šç§å®ç°ã€‚</p><h2 id=æ„å»ºä¸æ‹‰å–>æ„å»ºä¸æ‹‰å–</h2><p>ç¼–å†™å®Œæˆ Dockerfile ä¹‹åï¼Œå¯ä»¥é€šè¿‡ <code>docker build</code> å‘½ä»¤æ¥åˆ›å»ºé•œåƒï¼›å…³äº Dockfile çš„å…·ä½“è¯­æ³•ï¼Œå¯ä»¥æŸ¥çœ‹ä¸‹æ–‡ã€‚Dockfile åŸºæœ¬çš„æ ¼å¼ä¸º <code>docker build [ é€‰é¡¹ ] è·¯å¾„</code>ï¼Œè¯¥å‘½ä»¤å°†è¯»å–æŒ‡å®šè·¯å¾„ä¸‹(åŒ…æ‹¬å­ç›®å½•)çš„ Dockerfileï¼Œå¹¶å°†è¯¥è·¯å¾„ä¸‹æ‰€æœ‰å†…å®¹å‘é€ç»™ Docker æœåŠ¡ç«¯ï¼Œç”±æœåŠ¡ç«¯æ¥åˆ›å»ºé•œåƒã€‚å› æ­¤ä¸€èˆ¬å»ºè®®æ”¾ç½® Dockerfile çš„ç›®å½•ä¸ºç©ºç›®å½•ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ <code>.dockerignore</code> æ–‡ä»¶(æ¯ä¸€è¡Œæ·»åŠ ä¸€æ¡åŒ¹é…æ¨¡å¼)æ¥è®© Docker å¿½ç•¥è·¯å¾„ä¸‹çš„ç›®å½•å’Œæ–‡ä»¶ã€‚</p><p>é•œåƒçš„å®Œæ•´ tag ä¸ä»…åŒ…å«é•œåƒåå­—, è¿˜æŒ‡æ˜äº†é•œåƒä»å“ªé‡Œæ¥, è¦åˆ°å“ªé‡Œå», å°±åƒä¸€ä¸ª URLã€‚å¯ä»¥é€šè¿‡ <code>-t</code> é€‰é¡¹æŒ‡å®šé•œåƒçš„æ ‡ç­¾ä¿¡æ¯ï¼Œè­¬å¦‚ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ sudo docker build -t myrepo/myapp /tmp/test1/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ docker build -t username/image_name:tag_name .
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ docker tag SOURCE_IMAGE<span class=o>[</span>:TAG<span class=o>]</span> TARGET_IMAGE<span class=o>[</span>:TAG<span class=o>]</span>
</span></span></code></pre></div><p>Docker æ”¯æŒä» Registry æ‹‰å–é•œåƒï¼Œæˆ–è€…å°†æŸä¸ªå®¹å™¨ä¿å­˜ä¸ºé•œåƒï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># æ‹‰å–é•œåƒ</span>
</span></span><span class=line><span class=cl>$ docker pull image_name
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å°†æŸä¸ªå®¹å™¨ä¿å­˜ä¸ºé•œåƒ</span>
</span></span><span class=line><span class=cl>$ docker commit -m â€œcommit messageâ€ -a â€œauthorâ€  container_name username/image_name:tag
</span></span></code></pre></div><p>Docker æ”¯æŒå°†é•œåƒä¿å­˜ä¸ºæ–‡ä»¶ï¼Œä»¥æ–¹ä¾¿é•œåƒçš„å¯¼å‡ºä¸åŠ è½½ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># ä¿å­˜é•œåƒ</span>
</span></span><span class=line><span class=cl>$ docker save --output saved-image.tar my-image:1.0.0
</span></span><span class=line><span class=cl>$ docker save my-image:1.0.0 &gt; saved-image.tar
</span></span><span class=line><span class=cl>$ docker save my_image:my_tag <span class=p>|</span> gzip &gt; my_image.tar.gz
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å¯¼å…¥é•œåƒ</span>
</span></span><span class=line><span class=cl>$ docker load --input saved-image.tar
</span></span><span class=line><span class=cl>$ docker load &lt; saved-image.tar
</span></span></code></pre></div><h2 id=é•œåƒç®¡ç†>é•œåƒç®¡ç†</h2><p><code>docker images</code> å‘½ä»¤ä¼šåˆ—ä¸¾å‡ºå…¨éƒ¨çš„é•œåƒ:</p><pre tabindex=0><code>$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
mynewimage          latest              4d2eab1c0b9a        5 minutes ago       278.1 MB
ubuntu              14.04               ad892dd21d60        11 days ago         275.5 MB
&lt;none&gt;              &lt;none&gt;              6b0a59aa7c48        11 days ago         169.4 MB
&lt;none&gt;              &lt;none&gt;              6cfa4d1f33fb        7 weeks ago         0 B
</code></pre><p>Docker ä¸­é•œåƒä¸»è¦åˆ†ä¸ºä¸‰ç§çŠ¶æ€:</p><ul><li>å·²ä½¿ç”¨é•œåƒ(used image): æŒ‡æ‰€æœ‰å·²è¢«å®¹å™¨ï¼ˆåŒ…æ‹¬å·²åœæ­¢çš„ï¼‰å…³è”çš„é•œåƒã€‚å³ docker ps -a çœ‹åˆ°çš„æ‰€æœ‰å®¹å™¨ä½¿ç”¨çš„é•œåƒã€‚</li><li>æœªå¼•ç”¨é•œåƒ(unreferenced image): æ²¡æœ‰è¢«åˆ†é…æˆ–ä½¿ç”¨åœ¨å®¹å™¨ä¸­çš„é•œåƒï¼Œä½†å®ƒæœ‰ Tag ä¿¡æ¯ã€‚</li><li>æ‚¬ç©ºé•œåƒ(dangling image): æœªé…ç½®ä»»ä½• Tagï¼ˆä¹Ÿå°±æ— æ³•è¢«å¼•ç”¨ï¼‰çš„é•œåƒï¼Œæ‰€ä»¥æ‚¬ç©ºã€‚è¿™é€šå¸¸æ˜¯ç”±äºé•œåƒ build çš„æ—¶å€™æ²¡æœ‰æŒ‡å®š -t å‚æ•°é…ç½® Tag å¯¼è‡´çš„ã€‚</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># åˆ—ä¸¾æœªä½¿ç”¨çš„</span>
</span></span><span class=line><span class=cl>$ docker images --filter <span class=s2>&#34;dangling=true&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ é™¤æ‰€æœ‰æ— ç”¨çš„é•œåƒ</span>
</span></span><span class=line><span class=cl>$ docker rmi <span class=k>$(</span>docker images -q -f <span class=nv>dangling</span><span class=o>=</span><span class=nb>true</span><span class=k>)</span>
</span></span></code></pre></div><h2 id=dockfile>Dockfile</h2><p>Dockerfile ç”±ä¸€è¡Œè¡Œå‘½ä»¤è¯­å¥ç»„æˆï¼Œå¹¶ä¸”æ”¯æŒä»¥ <code>#</code> å¼€å¤´çš„æ³¨é‡Šè¡Œã€‚ä¸€èˆ¬çš„ï¼ŒDockerfile åˆ†ä¸ºå››éƒ¨åˆ†ï¼šåŸºç¡€é•œåƒä¿¡æ¯ã€ç»´æŠ¤è€…ä¿¡æ¯ã€é•œåƒæ“ä½œæŒ‡ä»¤å’Œå®¹å™¨å¯åŠ¨æ—¶æ‰§è¡ŒæŒ‡ä»¤ï¼›æŒ‡ä»¤çš„ä¸€èˆ¬æ ¼å¼ä¸º <code>INSTRUCTION arguments</code>ï¼ŒæŒ‡ä»¤åŒ…æ‹¬ <code>FROM</code>ã€<code>MAINTAINER</code>ã€<code>RUN</code> ç­‰ã€‚ä¾‹å¦‚ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># MongoDB Dockerfile</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># https://github.com/dockerfile/mongodb</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Pull base image.</span>
</span></span><span class=line><span class=cl>FROM dockerfile/ubuntu
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ENV SOURCE http://downloads-distro.mongodb.org/repo/ubuntu-upstart
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Install MongoDB.</span>
</span></span><span class=line><span class=cl>RUN <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 7F0CEB10 <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  <span class=nb>echo</span> <span class=s1>&#39;deb $SOURCE dist 10gen&#39;</span> &gt; /etc/apt/sources.list.d/mongodb.list <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  apt-get update <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  apt-get install -y mongodb-org <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  rm -rf /var/lib/apt/lists/*
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ENV PATH /usr/local/mongo/bin:<span class=nv>$PATH</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Define mountable directories.</span>
</span></span><span class=line><span class=cl>VOLUME <span class=o>[</span><span class=s2>&#34;/data/db&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Define working directory.</span>
</span></span><span class=line><span class=cl>WORKDIR /data
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Define default command.</span>
</span></span><span class=line><span class=cl>CMD <span class=o>[</span><span class=s2>&#34;mongod&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Expose ports.</span>
</span></span><span class=line><span class=cl><span class=c1>#   - 27017: process</span>
</span></span><span class=line><span class=cl><span class=c1>#   - 28017: http</span>
</span></span><span class=line><span class=cl>EXPOSE <span class=m>27017</span>
</span></span><span class=line><span class=cl>EXPOSE <span class=m>28017</span>
</span></span></code></pre></div><p>å…¶ä¸­ï¼Œä¸€å¼€å§‹å¿…é¡»æŒ‡æ˜æ‰€åŸºäºçš„é•œåƒåç§°ï¼Œæ¥ä¸‹æ¥æ¨èè¯´æ˜ç»´æŠ¤è€…ä¿¡æ¯ã€‚åé¢åˆ™æ˜¯é•œåƒæ“ä½œæŒ‡ä»¤ï¼Œä¾‹å¦‚ <code>RUN</code> æŒ‡ä»¤ï¼Œ<code>RUN</code> æŒ‡ä»¤å°†å¯¹é•œåƒæ‰§è¡Œè·Ÿéšçš„å‘½ä»¤ã€‚æ¯è¿è¡Œä¸€æ¡ <code>RUN</code> æŒ‡ä»¤ï¼Œé•œåƒæ·»åŠ æ–°çš„ä¸€å±‚ï¼Œå¹¶æäº¤ã€‚æœ€åæ˜¯ <code>CMD</code> æŒ‡ä»¤ï¼Œæ¥æŒ‡å®šè¿è¡Œå®¹å™¨æ—¶çš„æ“ä½œå‘½ä»¤ã€‚</p><table><thead><tr><th>æŒ‡ä»¤å</th><th>æ ¼å¼</th><th>æè¿°</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>FROM</td><td>æ ¼å¼ä¸º <code>FROM &lt;image></code>æˆ–<code>FROM &lt;image>:&lt;tag></code></td><td>ç¬¬ä¸€æ¡æŒ‡ä»¤å¿…é¡»ä¸º <code>FROM</code> æŒ‡ä»¤</td><td>å¦‚æœåœ¨åŒä¸€ä¸ª Dockerfile ä¸­åˆ›å»ºå¤šä¸ªé•œåƒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ª <code>FROM</code> æŒ‡ä»¤(æ¯ä¸ªé•œåƒä¸€æ¬¡)</td></tr><tr><td>MAINTAINER</td><td>æ ¼å¼ä¸º <code>MAINTAINER &lt;name></code></td><td>æŒ‡å®šç»´æŠ¤è€…ä¿¡æ¯ï¼Œ</td><td></td></tr><tr><td>RUN</td><td><code>RUN &lt;command></code>æˆ–<code>RUN ["executable", "param1", "param2"]</code></td><td>å‰è€…å°†åœ¨ shell ç»ˆç«¯ä¸­è¿è¡Œå‘½ä»¤ï¼Œå³ <code>/bin/sh -c</code>ï¼›åè€…åˆ™ä½¿ç”¨ <code>exec</code> æ‰§è¡Œã€‚æŒ‡å®šä½¿ç”¨å…¶å®ƒç»ˆç«¯å¯ä»¥é€šè¿‡ç¬¬äºŒç§æ–¹å¼å®ç°ï¼Œä¾‹å¦‚ <code>RUN ["/bin/bash", "-c", "echo hello"]</code></td><td>æ¯æ¡ <code>RUN</code> æŒ‡ä»¤å°†åœ¨å½“å‰é•œåƒåŸºç¡€ä¸Šæ‰§è¡ŒæŒ‡å®šå‘½ä»¤ï¼Œå¹¶æäº¤ä¸ºæ–°çš„é•œåƒã€‚å½“å‘½ä»¤è¾ƒé•¿æ—¶å¯ä»¥ä½¿ç”¨ <code>\</code> æ¥æ¢è¡Œï¼Œ</td></tr><tr><td>CMD</td><td>æ”¯æŒä¸‰ç§æ ¼å¼,<code>CMD ["executable","param1","param2"]</code> ä½¿ç”¨ <code>exec</code> æ‰§è¡Œï¼Œæ¨èæ–¹å¼ï¼›<code>CMD command param1 param2</code> åœ¨ <code>/bin/sh</code> ä¸­æ‰§è¡Œï¼Œæä¾›ç»™éœ€è¦äº¤äº’çš„åº”ç”¨ï¼›<code>CMD ["param1","param2"]</code> æä¾›ç»™ <code>ENTRYPOINT</code> çš„é»˜è®¤å‚æ•°ï¼›</td><td>æŒ‡å®šå¯åŠ¨å®¹å™¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ¯ä¸ª Dockerfile åªèƒ½æœ‰ä¸€æ¡ <code>CMD</code> å‘½ä»¤ã€‚å¦‚æœæŒ‡å®šäº†å¤šæ¡å‘½ä»¤ï¼Œåªæœ‰æœ€åä¸€æ¡ä¼šè¢«æ‰§è¡Œã€‚å¦‚æœç”¨æˆ·å¯åŠ¨å®¹å™¨æ—¶å€™æŒ‡å®šäº†è¿è¡Œçš„å‘½ä»¤ï¼Œåˆ™ä¼šè¦†ç›–æ‰ <code>CMD</code> æŒ‡å®šçš„å‘½ä»¤</td><td></td></tr><tr><td>EXPOSE</td><td><code>EXPOSE &lt;port> [&lt;port>...]</code></td><td>å‘Šè¯‰ Docker æœåŠ¡ç«¯å®¹å™¨æš´éœ²çš„ç«¯å£å·ï¼Œä¾›äº’è”ç³»ç»Ÿä½¿ç”¨</td><td>åœ¨å¯åŠ¨å®¹å™¨æ—¶éœ€è¦é€šè¿‡ -p æ¥æŒ‡å®šç«¯å£æ˜ å°„ï¼ŒDocker ä¸»æœºä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç«¯å£è½¬å‘åˆ°æŒ‡å®šçš„ç«¯å£</td></tr><tr><td>ENV</td><td><code>ENV&lt;key>&lt;value></code>ã€‚æŒ‡å®šä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œä¼šè¢«åç»­ <code>RUN</code> æŒ‡ä»¤ä½¿ç”¨ï¼Œå¹¶åœ¨å®¹å™¨è¿è¡Œæ—¶ä¿æŒ</td><td></td><td></td></tr><tr><td>ADD</td><td><code>ADD&lt;src>&lt;dest></code></td><td>è¯¥å‘½ä»¤å°†å¤åˆ¶æŒ‡å®šçš„ <code>&lt;src></code> åˆ°å®¹å™¨ä¸­çš„ <code>&lt;dest></code>ï¼Œ</td><td><code>&lt;src></code> å¯ä»¥æ˜¯ Dockerfile æ‰€åœ¨ç›®å½•çš„ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼›ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª URLï¼›è¿˜å¯ä»¥æ˜¯ä¸€ä¸ª tar æ–‡ä»¶(è‡ªåŠ¨è§£å‹ä¸ºç›®å½•)</td></tr><tr><td>COPY</td><td><code>COPY &lt;src>&lt;dest></code></td><td>å¤åˆ¶æœ¬åœ°ä¸»æœºçš„ <code>&lt;src></code>(ä¸º Dockerfile æ‰€åœ¨ç›®å½•çš„ç›¸å¯¹è·¯å¾„)åˆ°å®¹å™¨ä¸­çš„ <code>dest</code></td><td>å½“ä½¿ç”¨æœ¬åœ°ç›®å½•ä¸ºæºç›®å½•æ—¶ï¼Œæ¨èä½¿ç”¨ <code>COPY</code></td></tr><tr><td>ENTRYPOINT</td><td><code>ENTRYPOINT ["executable", "param1", "param2"]</code>ï¼Œä½¿ç”¨æŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶æ‰§è¡Œï¼›<code>ENTRYPOINT command param1 param2</code>ï¼Œä¼šåœ¨ Shell ä¸­æ‰§è¡Œ</td><td>é…ç½®å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤ï¼Œå¹¶ä¸”ä¸å¯è¢« <code>docker run</code> æä¾›çš„å‚æ•°è¦†ç›–ã€‚æ¯ä¸ª Dockerfile ä¸­åªèƒ½æœ‰ä¸€ä¸ª <code>ENTRYPOINT</code>ï¼Œå½“æŒ‡å®šå¤šä¸ªæ—¶ï¼Œåªæœ‰æœ€åä¸€ä¸ªèµ·æ•ˆï¼Œ</td><td></td></tr><tr><td>VOLUME</td><td><code>VOLUME ["/data"]</code></td><td>åˆ›å»ºä¸€ä¸ªå¯ä»¥ä»æœ¬åœ°ä¸»æœºæˆ–å…¶ä»–å®¹å™¨æŒ‚è½½çš„æŒ‚è½½ç‚¹ï¼Œä¸€èˆ¬ç”¨æ¥å­˜æ”¾æ•°æ®åº“å’Œéœ€è¦ä¿æŒçš„æ•°æ®ç­‰</td><td></td></tr><tr><td>USER</td><td><code>USER daemon</code></td><td>æŒ‡å®šè¿è¡Œå®¹å™¨æ—¶çš„ç”¨æˆ·åæˆ– UIDï¼Œåç»­çš„ <code>RUN</code> ä¹Ÿä¼šä½¿ç”¨æŒ‡å®šç”¨æˆ·</td><td></td></tr><tr><td>WORKDIR</td><td><code>WORKDIR /path/to/workdir</code></td><td>ä¸ºåç»­çš„ <code>RUN</code>ã€<code>CMD</code>ã€<code>ENTRYPOINT</code> æŒ‡ä»¤é…ç½®å·¥ä½œç›®å½•</td><td>å¯ä»¥ä½¿ç”¨å¤šä¸ª <code>WORKDIR</code> æŒ‡ä»¤ï¼Œåç»­å‘½ä»¤å¦‚æœå‚æ•°æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™ä¼šåŸºäºä¹‹å‰å‘½ä»¤æŒ‡å®šçš„è·¯å¾„</td></tr></tbody></table><p>å½“æœåŠ¡ä¸éœ€è¦ç®¡ç†å‘˜æƒé™æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æŒ‡å®šè¿è¡Œç”¨æˆ·ã€‚å¹¶ä¸”å¯ä»¥åœ¨ä¹‹å‰åˆ›å»ºæ‰€éœ€è¦çš„ç”¨æˆ·ï¼Œä¾‹å¦‚ï¼š<code>RUN groupadd -r postgres && useradd -r -g postgres postgres</code>ï¼›è¦ä¸´æ—¶è·å–ç®¡ç†å‘˜æƒé™å¯ä»¥ä½¿ç”¨ <code>gosu</code>ï¼Œè€Œä¸æ¨è <code>sudo</code>ã€‚</p><p>RUNã€CMD å’Œ ENTRYPOINT è¿™ä¸‰ä¸ª Dockerfile æŒ‡ä»¤çœ‹ä¸Šå»å¾ˆç±»ä¼¼ï¼Œå¾ˆå®¹æ˜“æ··æ·†ã€‚RUN æ‰§è¡Œå‘½ä»¤å¹¶åˆ›å»ºæ–°çš„é•œåƒå±‚ï¼ŒRUN ç»å¸¸ç”¨äºå®‰è£…è½¯ä»¶åŒ…ã€‚CMD è®¾ç½®å®¹å™¨å¯åŠ¨åé»˜è®¤æ‰§è¡Œçš„å‘½ä»¤åŠå…¶å‚æ•°ï¼Œä½† CMD èƒ½å¤Ÿè¢« docker run åé¢è·Ÿçš„å‘½ä»¤è¡Œå‚æ•°æ›¿æ¢ã€‚ENTRYPOINT é…ç½®å®¹å™¨å¯åŠ¨æ—¶è¿è¡Œçš„å‘½ä»¤ã€‚æˆ‘ä»¬ç»å¸¸å¯ä»¥ä½¿ç”¨ ENTRYPOINT æŒ‡å®šå›ºå®šå‘½ä»¤ï¼Œä½¿ç”¨ CMD åŠ¨æ€ä¼ å…¥å‚æ•°ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;/bin/echo&#34;</span><span class=p>,</span> <span class=s2>&#34;Hello&#34;</span><span class=p>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;world&#34;</span><span class=p>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># docker run -it &lt;image&gt;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Hello world</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># docker run -it &lt;image&gt; John</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Hello John</span><span class=err>
</span></span></span></code></pre></div><p>Docker æ¨èçš„æ˜¯å•ä¸ªå®¹å™¨æ‰§è¡Œå•ä¸ªä»»åŠ¡çš„å…³æ³¨ç‚¹åˆ†ç¦»ç­–ç•¥ï¼Œå®¹å™¨çš„ä¸»è¿›ç¨‹ä¼šè´Ÿè´£ç®¡ç†æ‰€æœ‰çš„å­è¿›ç¨‹ã€‚å¦‚æœæˆ‘ä»¬æœªåœ¨è‡ªå®šä¹‰åˆå§‹åŒ–è„šæœ¬ä¸­è€ƒè™‘å¤ªå¤šå­è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„æ“ä½œï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>--init</code> å‚æ•°æ¥å…è®¸ Docker è‡ªåŠ¨æ³¨å…¥ init è¿›ç¨‹ä½œä¸ºä¸»è¿›ç¨‹ï¼Œå…¶ä¼šåœ¨å®¹å™¨å…³é—­æ—¶å€™è‡ªåŠ¨å¤„ç†æ‰€æœ‰çš„æ´¾ç”Ÿçš„å­è¿›ç¨‹ï¼Œå¹¶ä¸”ç›¸å¯¹äºå®Œæ•´çš„ sysvinit æˆ–è€… systemd æ›´ä¸ºè½»é‡çº§ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨å•ä¸ªå®¹å™¨ä¸­è¿è¡Œå¤šä¸ªè¿›ç¨‹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ supervisord æˆ–è€…<a href=https://docs.docker.com/config/containers/multi-service_container/ target=_blank rel=noopener>è‡ªå®šä¹‰è„šæœ¬</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> ubuntu:latest</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apt-get update <span class=o>&amp;&amp;</span> apt-get install -y supervisor<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> mkdir -p /var/log/supervisor<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> supervisord.conf /etc/supervisor/conf.d/supervisord.conf<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> my_first_process my_first_process<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> my_second_process my_second_process<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;/usr/bin/supervisord&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></div><h2 id=registry>Registry</h2><p>Docker å…è®¸æˆ‘ä»¬å»ºç«‹ç§æœ‰çš„ Registry æ¥å­˜æ”¾äºç®¡ç†é•œåƒï¼Œç›´æ¥è¿è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯åˆ›å»ºç§æœ‰ Registryï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ docker run -d -p 5000:5000 --restart<span class=o>=</span>always --name registry registry:2
</span></span></code></pre></div><p>å‚è€ƒä¸Šæ–‡æè¿°æˆ‘ä»¬å¯çŸ¥ï¼Œé•œåƒåçš„å‰ç¼€å³è¡¨ç¤ºè¯¥é•œåƒæ‰€å±çš„ Registry åœ°å€ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ tag æ–¹å¼å°†æŸä¸ªé•œåƒæ¨é€åˆ°ç§æœ‰ä»“åº“ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># æ‹‰å–å…¬å…±é•œåƒ</span>
</span></span><span class=line><span class=cl>$ docker pull ubuntu:16.04
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¸ºé•œåƒæ·»åŠ  Registry ä¿¡æ¯</span>
</span></span><span class=line><span class=cl>$ docker tag ubuntu:16.04 custom-domain:5000/my-ubuntu
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å°†å…¶æ¨é€åˆ°ç§æœ‰é•œåƒåº“</span>
</span></span><span class=line><span class=cl>$ docker push custom-domain:5000/my-ubuntu
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä»ç§æœ‰é•œåƒåº“ä¸­æ‹‰å–é•œåƒ</span>
</span></span><span class=line><span class=cl>$ docker pull custom-domain:5000/my-ubuntu
</span></span></code></pre></div><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šé•œåƒåº“çš„å­˜æ”¾åœ°å€ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>-v /mnt/registry:/var/lib/registry
</span></span></code></pre></div><p>å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬çš„å†…éƒ¨ä»“åº“å¹¶ä¸ä¼šé…ç½® HTTPSï¼Œå¦‚æœå¸Œæœ›ä»¥ HTTP æ–¹å¼è®¿é—®ï¼Œé‚£ä¹ˆéœ€è¦åœ¨ä»»ä½•éœ€è¦æ¨é€/æ‹‰å–é•œåƒçš„æœºå™¨ä¸Šé…ç½®éå®‰å…¨åŸŸåï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span> <span class=nt>&#34;insecure-registries&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;myregistry.example.com:5000&#34;</span><span class=p>]</span> <span class=p>}</span>
</span></span></code></pre></div><p>æœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸ºç§æœ‰ä»“åº“é…ç½®æƒé™è®¤è¯ï¼Œé‚£ä¹ˆé¦–å…ˆéœ€è¦æ·»åŠ  TLS æ”¯æŒï¼Œå¹¶ä¸”é…ç½®è®¤è¯æ–‡ä»¶ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ mkdir auth
</span></span><span class=line><span class=cl>$ docker run <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --entrypoint htpasswd <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  registry:2 -Bbn cscan cscancscan &gt; ~/auth/htpasswd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ openssl req -new -newkey rsa:4096 -days <span class=m>365</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                -subj <span class=s2>&#34;/CN=localhost&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                -nodes -x509  <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                -keyout ~/certs/domain.key <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>                -out ~/certs/domain.crt
</span></span></code></pre></div><p>ç„¶åå¯ä»¥ä½¿ç”¨ Compose æ–‡ä»¶æ¥æè¿°æ‰€éœ€è¦çš„ TLS ä»¥åŠ AUTH å‚æ•°ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>registry-srv</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>registry:2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>5000</span><span class=p>:</span><span class=m>5000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>REGISTRY_HTTP_TLS_CERTIFICATE</span><span class=p>:</span><span class=w> </span><span class=l>/certs/domain.crt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>REGISTRY_HTTP_TLS_KEY</span><span class=p>:</span><span class=w> </span><span class=l>/certs/domain.key</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>REGISTRY_AUTH</span><span class=p>:</span><span class=w> </span><span class=l>htpasswd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>REGISTRY_AUTH_HTPASSWD_PATH</span><span class=p>:</span><span class=w> </span><span class=l>/auth/htpasswd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>REGISTRY_AUTH_HTPASSWD_REALM</span><span class=p>:</span><span class=w> </span><span class=l>Registry Realm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>/opt/registry:/var/lib/registry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>~/certs:/certs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>~/auth:/auth</span><span class=w>
</span></span></span></code></pre></div><p>æ¥ä¸‹æ¥ä½¿ç”¨ Docker Compose å‘½ä»¤å¯åŠ¨æœåŠ¡ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ docker-compose up -d
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç™»å½•åˆ°é•œåƒæœåŠ¡å™¨</span>
</span></span><span class=line><span class=cl>$ docker login myregistrydomain.com:5000
</span></span></code></pre></div><h2 id=å¤šé˜¶æ®µæ„å»º>å¤šé˜¶æ®µæ„å»º</h2><p>éšç€ 17.05 ç‰ˆæœ¬çš„å‘å¸ƒï¼ŒDocker å¯¹äºé•œåƒæ„å»ºè¿™å—ä¹Ÿä½œäº†ä¸€é¡¹é‡è¦æ›´æ–°ï¼Œé‚£å°±æ˜¯ multi-stage buildï¼ˆå¤šé˜¶æ®µæ„å»ºï¼‰ï¼Œè¿™æœ‰åŠ©äºæ–¹ä¾¿æºä»£ç æ§åˆ¶ï¼Œå‡å°é•œåƒä½“ç§¯ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=c># First stage: complete build environment</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> maven:3.5.0-jdk-8-alpine AS builder</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># add pom.xml and source code</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ADD</span> ./pom.xml pom.xml<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ADD</span> ./src src/<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># package jar</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> mvn clean package<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Second stage: minimal runtime environment</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>From</span><span class=s> openjdk:8-jre-alpine</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># copy jar from the first stage</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>builder target/msb-1.0.jar msb.jar<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># run jar</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;java&#34;</span><span class=p>,</span> <span class=s2>&#34;-jar&#34;</span><span class=p>,</span> <span class=s2>&#34;msb.jar&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></div><p>å¯¹äº multi-stage buildï¼Œå…¶å…³é”®ç‚¹ä¸»è¦æœ‰ä¸¤ç‚¹ï¼š</p><p>åœ¨å‰é¢é˜¶æ®µçš„ FROM æŒ‡ä»¤åé¢å¢åŠ äº†ä¸€ä¸ª AS å‚æ•°ï¼Œå¯ä¸ºè¯¥æ„å»ºé˜¶æ®µå‘½åï¼Œä¾¿äºåç»­æ„å»ºé˜¶æ®µå¼•ç”¨ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><pre tabindex=0><code>FROM image[:tag | @digest] AS stage
</code></pre><p>åœ¨åç»­é˜¶æ®µçš„ COPY æŒ‡ä»¤åé¢å¢åŠ äº†&ndash;from å‚æ•°ï¼ŒæŒ‡æ˜å¼•ç”¨å‰é¢å“ªä¸€ä¸ªæ„å»ºé˜¶æ®µçš„æˆæœï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><pre tabindex=0><code>COPY --from=stage ...
</code></pre><p>åŒç†ï¼Œå¤šé˜¶æ®µæ„å»ºåŒæ ·å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å°†å¤šä¸ªå½¼æ­¤ä¾èµ–çš„é¡¹ç›®é€šè¿‡ä¸€ä¸ª Dockerfile å°±å¯è½»æ¾æ„å»ºå‡ºæœŸæœ›çš„å®¹å™¨é•œåƒï¼Œè€Œä¸ç”¨æ‹…å¿ƒé•œåƒå¤ªå¤§ã€æºç æ³„éœ²ç­‰é£é™©ã€‚</p><h1 id=å®¹å™¨>å®¹å™¨</h1><p>Docker ä¸­é•œåƒæ˜¯åªè¯»çš„, åˆ›å»ºå®¹å™¨æ—¶åªæ˜¯åœ¨é•œåƒä¸Šé¢æ–°å»ºä¸€ä¸ªå¯å†™å±‚, ä¸éœ€è¦å¤åˆ¶æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿ, å› è€Œå¯ä»¥å®ç°æ¯«ç§’çº§åˆ›å»ºã€‚</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://user-images.githubusercontent.com/5803001/45262735-4f42e400-b44f-11e8-96a0-79c305006be8.png alt=image loading=lazy data-zoomable></div></div></figure></p><h2 id=å¯åœæ§åˆ¶>å¯åœæ§åˆ¶</h2><ul><li><code>docker create</code>: åˆ›å»ºä¸€ä¸ªå®¹å™¨ä½†æ˜¯ä¸å¯åŠ¨ã€‚</li><li><code>docker rename</code>: å…è®¸é‡å‘½åå®¹å™¨ã€‚</li><li><code>docker run</code>: åœ¨åŒä¸€ä¸ªæ“ä½œä¸­åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨ã€‚</li><li><code>docker rm</code>: åˆ é™¤å®¹å™¨ã€‚</li><li><code>docker update</code>: æ›´æ–°å®¹å™¨çš„èµ„æºé™åˆ¶ã€‚</li></ul><p>å®¹å™¨ä¼šåœ¨ç»“æŸå‘½ä»¤ä¹‹åè‡ªåŠ¨é€€å‡ºï¼Œä½¿ç”¨ä»¥ä¸‹çš„å‘½ä»¤é€‰é¡¹å¯ä»¥å°†å®¹å™¨ä¿æŒåœ¨æ¿€æ´»çŠ¶æ€ï¼š</p><ul><li><p><code>-i</code> å³ä½¿åœ¨æ²¡æœ‰é™„ç€çš„æƒ…å†µä¸‹ä¾ç„¶ä¿æŒ STDIN å¤„äºå¼€å¯ã€‚å•çº¯ä½¿ç”¨ -i å‘½ä»¤æ˜¯ä¸ä¼šå‡ºç° <code>root@689d580b6416:/</code> è¿™ç§å‰ç¼€</p></li><li><p><code>-t</code> åˆ†é…ä¸€ä¸ªä¼ª TTY æ§åˆ¶å°</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># åˆ›å»ºï¼Œå¹¶ä¸”å¯åŠ¨æŸä¸ªå®¹å™¨ä»¥æ‰§è¡ŒæŸä¸ªå‘½ä»¤</span>
</span></span><span class=line><span class=cl>$ docker run -ti --name container_name image_name <span class=nb>command</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ›å»ºï¼Œå¯åŠ¨å®¹å™¨æ‰§è¡ŒæŸä¸ªå‘½ä»¤ç„¶ååˆ é™¤è¯¥å®¹å™¨</span>
</span></span><span class=line><span class=cl>$ docker run --rm -ti image_name <span class=nb>command</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ›å»ºï¼Œå¯åŠ¨å®¹å™¨ï¼Œå¹¶ä¸”æ˜ å°„å·ä¸ç«¯å£ï¼ŒåŒæ—¶è®¾ç½®ç¯å¢ƒå˜é‡</span>
</span></span><span class=line><span class=cl>$ docker run -it --rm -p 8080:8080 -v /path/to/agent.jar:/agent.jar -e <span class=nv>JAVA_OPTS</span><span class=o>=</span>â€-javaagent:/agent.jarâ€ tomcat:8.0.29-jre8
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ›å»ºå®¹å™¨ï¼ŒæŒ‡å®šç½‘ç»œ</span>
</span></span><span class=line><span class=cl>$ docker run --network<span class=o>=</span>&lt;NETWORK&gt;
</span></span><span class=line><span class=cl><span class=c1># ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„ç½‘ç»œ</span>
</span></span><span class=line><span class=cl>$ docker run --rm -d --network host --name my_nginx nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŒ‡å®šæ ‡ç­¾</span>
</span></span><span class=line><span class=cl>$ docker run -l my-label --label com.example.foo<span class=o>=</span>bar ubuntu bash
</span></span></code></pre></div><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆ›å»ºå®¹å™¨æ—¶ï¼Œå®ƒä¸ä¼šå°†å…¶ä»»ä½•ç«¯å£å‘å¸ƒåˆ°å¤–éƒ¨ä¸–ç•Œã€‚è¦ä½¿ç«¯å£å¯ç”¨äº Docker ä¹‹å¤–çš„æœåŠ¡æˆ–æœªè¿æ¥åˆ°å®¹å™¨ç½‘ç»œçš„ Docker å®¹å™¨ï¼Œè¯·ä½¿ç”¨ &ndash;publish æˆ–-p æ ‡å¿—ã€‚è¿™ä¼šåˆ›å»ºä¸€ä¸ªé˜²ç«å¢™è§„åˆ™ï¼Œå°†å®¹å™¨ç«¯å£æ˜ å°„åˆ° Docker ä¸»æœºä¸Šçš„ç«¯å£ã€‚</p><table><thead><tr><th>æ ‡å¿—å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>-p 8080:80</code></td><td>å°†å®¹å™¨çš„ 80 ç«¯å£æ˜ å°„åˆ° Docker ä¸»æœºçš„ 8080 ç«¯å£(TCP)</td></tr><tr><td><code>-p 8080:80/udp</code></td><td>å°†å®¹å™¨çš„ 80 ç«¯å£æ˜ å°„åˆ° Docker ä¸»æœºçš„ 8080 ç«¯å£(UDP)</td></tr><tr><td><code>-p 8080:80/tcp -p 8080:80/udp</code></td><td>å°†å®¹å™¨çš„ 80 ç«¯å£æ˜ å°„åˆ° Docker ä¸»æœºçš„ 8080 ç«¯å£(TCP å’Œ UDP)</td></tr></tbody></table><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># å¯åŠ¨/åœæ­¢æŸä¸ªå®¹å™¨</span>
</span></span><span class=line><span class=cl>$ docker <span class=o>[</span>start<span class=p>|</span>stop<span class=o>]</span> container_name
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åœ¨æŸä¸ªå®¹å™¨å†…æ‰§è¡ŒæŸæ¡å‘½ä»¤</span>
</span></span><span class=line><span class=cl>$ docker <span class=nb>exec</span> -ti container_name command.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹æŸä¸ªå®¹å™¨çš„è¾“å‡ºæ—¥å¿—</span>
</span></span><span class=line><span class=cl>$ docker logs -ft container_name
</span></span></code></pre></div><h2 id=çŠ¶æ€æŸ¥è¯¢>çŠ¶æ€æŸ¥è¯¢</h2><ul><li>docker ps æŸ¥çœ‹è¿è¡Œä¸­çš„æ‰€æœ‰å®¹å™¨ã€‚</li><li>docker logs ä»å®¹å™¨ä¸­è·å–æ—¥å¿—ã€‚(ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰æ—¥å¿—é©±åŠ¨ï¼Œä¸è¿‡åœ¨ 1.10 ä¸­ï¼Œå®ƒåªæ”¯æŒ json-file å’Œ journald)</li><li>docker inspect æŸ¥çœ‹æŸä¸ªå®¹å™¨çš„æ‰€æœ‰ä¿¡æ¯(åŒ…æ‹¬ IP åœ°å€)ã€‚</li><li>docker events ä»å®¹å™¨ä¸­è·å–äº‹ä»¶(events)ã€‚</li><li>docker port æŸ¥çœ‹å®¹å™¨çš„å…¬å¼€ç«¯å£ã€‚</li><li>docker top æŸ¥çœ‹å®¹å™¨ä¸­æ´»åŠ¨è¿›ç¨‹ã€‚</li><li>docker stats æŸ¥çœ‹å®¹å™¨çš„èµ„æºä½¿ç”¨æƒ…å†µç»Ÿè®¡ä¿¡æ¯ã€‚</li><li>docker diff æŸ¥çœ‹å®¹å™¨çš„ FS ä¸­æœ‰å˜åŒ–æ–‡ä»¶ä¿¡æ¯ã€‚</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># æ ¹æ®æ¡ä»¶è¿‡æ»¤æŸ¥è¯¢</span>
</span></span><span class=line><span class=cl>$ docker ps --filter <span class=s2>&#34;name=nostalgic&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„å®¹å™¨åˆ—è¡¨</span>
</span></span><span class=line><span class=cl>$ docker stats --all
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ‰¹é‡æŸ¥çœ‹æ—¥å¿—</span>
</span></span><span class=line><span class=cl><span class=k>for</span> i in <span class=k>$(</span>docker ps -qf <span class=nv>name</span><span class=o>=</span>wsat_slave*<span class=k>)</span><span class=p>;</span> <span class=k>do</span> <span class=nb>echo</span> <span class=s2>&#34;==================</span><span class=nv>$i</span><span class=s2>&#34;</span> <span class=o>&amp;&amp;</span> docker logs <span class=nv>$i</span>  <span class=p>|</span> grep aisec<span class=p>;</span> <span class=k>done</span>
</span></span></code></pre></div><h2 id=ç®¡ç†é…ç½®>ç®¡ç†é…ç½®</h2><p>åˆ›å»ºå®¹å™¨æ—¶ä¹Ÿå¯ä»¥å®¹å™¨çš„é‡å¯ç­–ç•¥ï¼Œå³æ˜¯å½“å®¹å™¨å‡ºé”™é€€å‡ºæˆ–è€…å®¿ä¸»æœºé‡å¯æ—¶å€™ï¼Œå®¹å™¨çš„åº”å¯¹ç­–ç•¥ï¼›é‡å¯ç­–ç•¥åŒæ ·ä¼šä¿è¯ç›¸å…³è”çš„å®¹å™¨ä»¥æ­£ç¡®çš„é¡ºåºé‡å¯ï¼Œé¿å…æ„å¤–çš„é”™è¯¯ã€‚</p><ul><li>no: ä¸è¿›è¡Œé‡å¯</li><li>on-failure: å½“å®¹å™¨ä»¥éé›¶çŠ¶æ€ç é€€å‡ºæ—¶é‡å¯å®¹å™¨</li><li>unless-stopped: å½“æŸä¸ªå®¹å™¨è¢«æ˜¾æ€§å…³é—­æˆ–è€… Docker æœ¬èº«å…³é—­æˆ–é‡å¯æ—¶é‡å¯</li><li>always: æ— è®ºå‡ºç°ä»»ä½•æƒ…å†µéƒ½é‡å¯å®¹å™¨</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># è®¾ç½®é‡å¯ç­–ç•¥</span>
</span></span><span class=line><span class=cl><span class=c1>#â€ŠOff, On-failure, Unless-stopped, Always</span>
</span></span><span class=line><span class=cl>$ docker run -dit â€” restart unless-stopped <span class=o>[</span>CONTAINER<span class=o>]</span>
</span></span></code></pre></div><p>å¯ä»¥é€šè¿‡å¤šç§è¿‡æ»¤æ¡ä»¶æ¥è¿›è¡Œå®¹å™¨çš„ç§»é™¤ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># å…³é—­æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span>
</span></span><span class=line><span class=cl>$ docker <span class=nb>kill</span> <span class=k>$(</span>docker ps -q<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ‰¹é‡é‡å¯å®¹å™¨</span>
</span></span><span class=line><span class=cl>$ docker restart <span class=k>$(</span>docker ps -a -q<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ ¹æ® IDæˆ–Name ç§»é™¤</span>
</span></span><span class=line><span class=cl>$ docker rm idOrName
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç§»é™¤æ‰€æœ‰åœæ­¢çš„å®¹å™¨</span>
</span></span><span class=line><span class=cl>$ docker rm <span class=k>$(</span>docker ps -a -q<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ ¹æ®çŠ¶æ€ç§»é™¤</span>
</span></span><span class=line><span class=cl>$ docker rm <span class=k>$(</span>docker ps -q -f <span class=s1>&#39;status=exited&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ ¹æ®æ ‡ç­¾ç§»é™¤</span>
</span></span><span class=line><span class=cl>$ docker rm <span class=k>$(</span>docker ps -a <span class=p>|</span> grep rabbitmq <span class=p>|</span> awk <span class=s1>&#39;{print $1}&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>$ docker rm <span class=k>$(</span>docker ps -a <span class=p>|</span> grep <span class=s2>&#34;46 hours ago&#34;</span><span class=k>)</span>
</span></span></code></pre></div><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹å®¹å™¨ä¸­çš„æ–‡ä»¶è¿›è¡Œå¯¼å…¥å¯¼å‡ºæ“ä½œ:</p><ul><li>docker cp åœ¨å®¹å™¨å’Œæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¹‹é—´å¤åˆ¶æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ã€‚</li><li>docker export å°†å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿåˆ‡æ¢ä¸ºå‹ç¼©åŒ…(tarball archive stream)è¾“å‡ºåˆ° STDOUTã€‚</li></ul><h2 id=èµ„æºé…é¢>èµ„æºé…é¢</h2><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>docker stats</code> å‘½ä»¤æ¥æŸ¥çœ‹ Docker å®¹å™¨çš„æ€§èƒ½çŠ¶æ€ä¸èµ„æºå ç”¨:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ docker stats redis1 redis2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>CONTAINER           CPU %               MEM USAGE / LIMIT     MEM %               NET IO             BLOCK IO
</span></span><span class=line><span class=cl>redis1              0.07%               <span class=m>796</span> KB / <span class=m>64</span> MB        1.21%               <span class=m>788</span> B / <span class=m>648</span> B       3.568 MB / <span class=m>512</span> KB
</span></span></code></pre></div><h3 id=memory>Memory</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ docker run -it -m 300M ubuntu:14.04 /bin/bash
</span></span></code></pre></div><h3 id=cpu>CPU</h3><p>åœ¨çº¿ä¸Šç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å³å¸Œæœ›èƒ½å¤Ÿå°½é‡é¿å… CPU ç©ºé—´æ—¶é—´ç‰‡ï¼Œæœ€å¤§åŒ–èµ„æºåˆ©ç”¨ç‡ï¼Œä¹Ÿè¦ä¿éšœé‡ç‚¹ä¸šåŠ¡çš„èµ„æºå ç”¨ï¼Œé¿å…å› æŸä¸ªå¼‚å¸¸å®¹å™¨å ç”¨æˆ–ä¸åˆç†ä½¿ç”¨æ•´æœº CPU èµ„æºï¼Œé€ æˆå®¿ä¸»æœºä¸Šå¤§é‡å®¹å™¨å¼‚å¸¸ï¼›æ­¤æ—¶å•å®¹å™¨çš„ CPU èµ„æºçº¦æŸåŠä¸Šé™å°†å˜å¾—éå¸¸é‡è¦ï¼Œæ—¢ä¸èƒ½é™å¾—å¤ªæ­»ï¼Œåˆä¸èƒ½é™ä¸ä½ï¼Œå°†é€šè¿‡å†…æ ¸å’Œè°ƒåº¦ç³»ç»Ÿçš„é™åˆ¶æœºåˆ¶æ¥ä¿éšœèµ„æºç¨³å®šæ€§ã€‚Docker å…è®¸ä½¿ç”¨ cpus, cpuset-cpus, cpu-shares ç­‰æ¥é™åˆ¶å®¹å™¨çš„è®¡ç®—èµ„æºå ç”¨ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># æŒ‡å®šå®¹å™¨å¯å ç”¨çš„ CPU æ ¸ç¼–å·ï¼Œ0-3 è¡¨ç¤ºå ç”¨å››ä¸ªæ ¸ï¼Œ1,3 è¡¨ç¤ºå ç”¨ä¸¤ä¸ªæ ¸</span>
</span></span><span class=line><span class=cl>$ docker run -it --cpuset-cpus<span class=o>=</span><span class=s2>&#34;1,3&#34;</span> ubuntu /bin/bash
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æœ€å¤šå…è®¸å ç”¨å• CPU 50% çš„è®¡ç®—èµ„æºï¼Œå¦‚æœåŒæ ¸ CPUï¼Œåˆ™å¯ä»¥è®¾ç½®ä¸º 1.5 ç­‰</span>
</span></span><span class=line><span class=cl>$ docker run -it --cpus<span class=o>=</span><span class=s2>&#34;.5&#34;</span> ubuntu /bin/bash
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¸åŒçš„å€¼èƒ½å¤ŸæŒ‡å®šä¸åŒçš„å®¹å™¨æƒé‡ï¼Œç”¨äºåŠ¨æ€åˆ†é… CPU èµ„æº</span>
</span></span><span class=line><span class=cl>$ docker run -it --cpu-shares<span class=o>=</span><span class=s2>&#34;512&#34;</span> ubuntu /bin/bash
</span></span></code></pre></div><ul><li><p>CPU Set ä¿éšœäº†å®¹å™¨çš„ CPU æ ¸æ•°ï¼Œå®‰å…¨æ€§è¾ƒå¼ºï¼Œä½†æ˜¯æ•´ä½“èµ„æºåˆ©ç”¨ç‡ä½ã€‚å¦‚æœå®¹å™¨å®é™…å¹¶ä¸éœ€è¦å¦‚æ­¤å¤šæ ¸çš„ CPU èµ„æºæ¥å¤„ç†ä»»åŠ¡åˆ™ä¼šé€ æˆèµ„æºæµªè´¹ï¼Œå¹¶ä¸”å¯¼è‡´å…¶ä»–å®¹å™¨ä¸Šçš„ä»»åŠ¡æ— æ³•åˆ©ç”¨è¯¥å®¹å™¨ä¸Šçš„ CPU ç©ºé—²æ—¶é—´ç‰‡ï¼Œäººä¸ºé˜»æ–­äº† CPU é—²æ—¶å¤ç”¨çš„èƒ½åŠ›ã€‚</p></li><li><p>CPU Share å…è®¸é€šè¿‡å…±äº«çš„æ–¹å¼è·å¾— CPU èµ„æºï¼Œä¸åŒçš„å®¹å™¨å…±äº«ä¸€å®šæ€»é‡çš„ CPU è®¡ç®—èƒ½åŠ›ï¼Œæ¯ä¸ªå®¹å™¨éƒ½ç»‘å®šå…¨é‡æ ¸ï¼Œè€Œæ¯ä¸ªå®¹å™¨è·å–ä¸€å®šä»½é¢çš„ CPU è®¡ç®—åŠ›ã€‚è¯¥æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªå®¹å™¨çš„ CPU èµ„æºåˆ†é…ä¸å†ä»¥æ•´æ ¸åˆ†é…ï¼Œè€Œæ˜¯å¯ç²¾ç»†åˆ° CPU æ—¶é—´ç‰‡ä»½é¢çš„ç²’åº¦ï¼Œå¹¶ä¸”æ˜¯è¿ç»­çš„ CPU æ ¸èƒ½åŠ›å€¼ã€‚å½“æ•´æœºé—²æ—¶ï¼Œå¯ä»¥è®©è¾ƒä¸ºç¹å¿™çš„ä¸šåŠ¡è·å¾—æ•´æœºç©ºé—²ã€‚é‡‡ç”¨ CPU èµ„æºå…±äº«çš„æœºåˆ¶ï¼Œå…¶èµ„æºéš”ç¦»æ€§æ²¡æœ‰ set æ¨¡å¼å¼ºï¼Œå¯¹äºæä¸ªåˆ« CPU èµ„æºæ•æ„Ÿå‹ä¸šåŠ¡ï¼Œæœ‰å¯èƒ½å‡ºç°å¶å°”ç­‰å¾… CPU æ—¶é—´ç‰‡çš„æƒ…å†µï¼Œè€Œå½±å“ä¸šåŠ¡ç¨³å®šæ€§ã€‚å¯¹äºæå°‘æ•°çš„è¿™ç±»ä¸šåŠ¡ï¼Œæˆ‘ä»¬å®¹è®¸ç»§ç»­ä½¿ç”¨ CPU set æ¨¡å¼ã€‚</p></li></ul><h3 id=storage>Storage</h3><p>å¦‚æœä½¿ç”¨ Device Mapper ä½œä¸ºåº•å±‚å­˜å‚¨é©±åŠ¨ï¼Œåˆ™å¯ä»¥é€šè¿‡ Docker daemon çš„å¦‚ä¸‹å‚æ•°æ¥å…¨å±€é™åˆ¶å•ä¸ªå®¹å™¨å ç”¨ç©ºé—´çš„å¤§å°:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># é™åˆ¶å•ä¸ªå®¹å™¨æœ€å¤šå ç”¨ 20G ç©ºé—´ï¼Œå°†åº”ç”¨äºä»»ä½•æ–°å»ºå®¹å™¨ã€‚</span>
</span></span><span class=line><span class=cl>$ --storage-opt dm.basesize<span class=o>=</span>20G
</span></span></code></pre></div><p>å¦‚æœæ˜¯ btrfs å­˜å‚¨é©±åŠ¨ï¼Œå¯ä½¿ç”¨å…¶æä¾›çš„ subvolume åŠŸèƒ½æ¥å®ç°ã€‚ä¸€ä¸ªå®¹å™¨ä¼šå¯¹åº”ä¸€ä¸ª subvolumeã€‚é’ˆå¯¹å®¹å™¨å¯¹åº”çš„ subvolume å¯ç”¨å¹¶é…ç½® quota å³å¯é™åˆ¶å…¶ç£ç›˜ç©ºé—´:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ btrfs qgroup limit -e 50G /var/lib/docker/btrfs/subvolumes/&lt;CONTAINER_ID&gt;
</span></span></code></pre></div><p>æˆäºˆå¯¹å•ä¸ªè®¾å¤‡è®¿é—®æƒé™:</p><pre tabindex=0><code>docker run -it --device=/dev/ttyUSB0 debian bash
</code></pre><p>æˆäºˆæ‰€æœ‰è®¾å¤‡è®¿é—®æƒé™:</p><pre tabindex=0><code>docker run -it --privileged -v /dev/bus/usb:/dev/bus/usb debian bash
</code></pre><h1 id=èµ„æºé…ç½®>èµ„æºé…ç½®</h1><h2 id=volume--æ•°æ®å·>Volume | æ•°æ®å·</h2><p>å®¹å™¨è¿è¡Œæ—¶åº”è¯¥å°½é‡ä¿æŒå®¹å™¨å­˜å‚¨å±‚ä¸å‘ç”Ÿå†™æ“ä½œï¼Œå¯¹äºæ•°æ®åº“ç±»éœ€è¦ä¿å­˜åŠ¨æ€æ•°æ®çš„åº”ç”¨ï¼Œå…¶æ•°æ®åº“æ–‡ä»¶åº”è¯¥ä¿å­˜äºå·(Volume)ä¸­ã€‚ä¸ºäº†é˜²æ­¢è¿è¡Œæ—¶ç”¨æˆ·å¿˜è®°å°†åŠ¨æ€æ–‡ä»¶æ‰€ä¿å­˜ç›®å½•æŒ‚è½½ä¸ºå·ï¼Œåœ¨ Dockerfile ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥äº‹å…ˆæŒ‡å®šæŸäº›ç›®å½•æŒ‚è½½ä¸ºåŒ¿åå·ï¼Œè¿™æ ·åœ¨è¿è¡Œæ—¶å¦‚æœç”¨æˆ·ä¸æŒ‡å®šæŒ‚è½½ï¼Œå…¶åº”ç”¨ä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä¸ä¼šå‘å®¹å™¨å­˜å‚¨å±‚å†™å…¥å¤§é‡æ•°æ®ã€‚</p><p>æ•°æ®å·æ˜¯ä¸€ä¸ªå¯ä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä½¿ç”¨çš„ç‰¹æ®Šç›®å½•ï¼Œå®ƒç»•è¿‡ UFSï¼Œå¯ä»¥æä¾›å¾ˆå¤šæœ‰ç”¨çš„ç‰¹æ€§ï¼š</p><ul><li><p>æ•°æ®å·å¯ä»¥åœ¨å®¹å™¨ä¹‹é—´å…±äº«å’Œé‡ç”¨</p></li><li><p>å¯¹æ•°æ®å·çš„ä¿®æ”¹ä¼šç«‹é©¬ç”Ÿæ•ˆ</p></li><li><p>å¯¹æ•°æ®å·çš„æ›´æ–°ï¼Œä¸ä¼šå½±å“é•œåƒ</p></li><li><p>å·ä¼šä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°æ²¡æœ‰å®¹å™¨ä½¿ç”¨</p></li><li><p>æ•°æ®å·çš„ä½¿ç”¨ï¼Œç±»ä¼¼äº Linux ä¸‹å¯¹ç›®å½•æˆ–æ–‡ä»¶è¿›è¡Œ mountã€‚</p></li></ul><p>For example,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># the following creates a tmpfs volume called foo with a size of 100 megabyte and uid of 1000.</span>
</span></span><span class=line><span class=cl>$ docker volume create --driver <span class=nb>local</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --opt <span class=nv>type</span><span class=o>=</span>tmpfs <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --opt <span class=nv>device</span><span class=o>=</span>tmpfs <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --opt <span class=nv>o</span><span class=o>=</span><span class=nv>size</span><span class=o>=</span>100m,uid<span class=o>=</span><span class=m>1000</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    foo
</span></span></code></pre></div><p>nother example that uses nfs to mount the /path/to/dir in rw mode from 192.168.1.1:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ docker volume create --driver <span class=nb>local</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --opt <span class=nv>type</span><span class=o>=</span>nfs <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --opt <span class=nv>o</span><span class=o>=</span><span class=nv>addr</span><span class=o>=</span>192.168.1.1,rw <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --opt <span class=nv>device</span><span class=o>=</span>:/path/to/dir <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    foo
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ docker run -d <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -it <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --name devtest <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -v myvol2:/app <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  nginx:latest
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=s2>&#34;Mounts&#34;</span><span class=err>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Type&#34;</span><span class=p>:</span> <span class=s2>&#34;volume&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Name&#34;</span><span class=p>:</span> <span class=s2>&#34;myvol2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Source&#34;</span><span class=p>:</span> <span class=s2>&#34;/var/lib/docker/volumes/myvol2/_data&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Destination&#34;</span><span class=p>:</span> <span class=s2>&#34;/app&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Driver&#34;</span><span class=p>:</span> <span class=s2>&#34;local&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Mode&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;RW&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Propagation&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>]</span><span class=err>,</span>
</span></span></code></pre></div><p>Docker <code>-v</code> æ ‡è®°ä¹Ÿå¯ä»¥æŒ‡å®šæŒ‚è½½ä¸€ä¸ªæœ¬åœ°ä¸»æœºçš„ç›®å½• / æ–‡ä»¶åˆ°å®¹å™¨ä¸­å»ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># æŒ‚è½½ç›®å½•</span>
</span></span><span class=line><span class=cl>$ sudo docker run -d -P --name web -v /src/webapp:/opt/webapp training/webapp python app.py
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŒ‚è½½æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>$ sudo docker run --rm -it -v ~/.bash_history:/.bash_history ubuntu /bin/bash
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Docker æŒ‚è½½æ•°æ®å·çš„é»˜è®¤æƒé™æ˜¯è¯»å†™ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡ `:ro` æŒ‡å®šä¸ºåªè¯»ã€‚</span>
</span></span><span class=line><span class=cl>$ sudo docker run -d -P --name web -v /src/webapp:/opt/webapp:ro
</span></span><span class=line><span class=cl>training/webapp python app.py
</span></span></code></pre></div><p>æ³¨æ„ï¼šDockerfile ä¸­ä¸æ”¯æŒè¿™ç§ç”¨æ³•ï¼Œè¿™æ˜¯å› ä¸º Dockerfile æ˜¯ä¸ºäº†ç§»æ¤å’Œåˆ†äº«ç”¨çš„ã€‚ç„¶è€Œï¼Œä¸åŒæ“ä½œç³»ç»Ÿçš„è·¯å¾„æ ¼å¼ä¸ä¸€æ ·ï¼Œæ‰€ä»¥ç›®å‰è¿˜ä¸èƒ½æ”¯æŒã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>VOLUME /data</span><span class=w>
</span></span></span></code></pre></div><h2 id=network--ç½‘ç»œ>Network | ç½‘ç»œ</h2><p>Linux åœ¨ç½‘ç»œæ ˆä¸­å¼•å…¥ç½‘ç»œå‘½åç©ºé—´ï¼Œå°†ç‹¬ç«‹çš„ç½‘ç»œåè®®æ ˆéš”ç¦»åˆ°ä¸åŒçš„å‘½ä»¤ç©ºé—´ä¸­ï¼Œå½¼æ­¤é—´æ— æ³•é€šä¿¡ï¼›Docker åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œå®ç°ä¸å®¹å™¨é—´çš„ç½‘ç»œéš”ç¦»ï¼Œå¹¶ä¸”å¼•å…¥ Veth è®¾å¤‡å¯¹æ¥å®ç°åœ¨ä¸åŒç½‘ç»œå‘½åç©ºé—´çš„é€šä¿¡ã€‚Linux ç³»ç»ŸåŒ…å«ä¸€ä¸ªå®Œæ•´çš„è·¯ç”±åŠŸèƒ½ï¼Œå½“ IP å±‚åœ¨å¤„ç†æ•°æ®å‘é€æˆ–è½¬å‘çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨è·¯ç”±è¡¨æ¥å†³å®šå‘å¾€å“ªé‡Œã€‚Netfilter è´Ÿè´£åœ¨å†…æ ¸ä¸­æ‰§è¡Œå„ç§æŒ‚æ¥çš„è§„åˆ™(è¿‡æ»¤ã€ä¿®æ”¹ã€ä¸¢å¼ƒç­‰)ï¼Œè¿è¡Œåœ¨å†…æ ¸æ¨¡å¼ä¸­ï¼›Iptables æ¨¡å¼æ˜¯åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹è¿è¡Œçš„è¿›ç¨‹ï¼Œè´Ÿè´£ååŠ©ç»´æŠ¤å†…æ ¸ä¸­ Netfilter çš„å„ç§è§„åˆ™è¡¨ï¼›é€šè¿‡äºŒè€…çš„é…åˆæ¥å®ç°æ•´ä¸ª Linux ç½‘ç»œåè®®æ ˆä¸­çµæ´»çš„æ•°æ®åŒ…å¤„ç†æœºåˆ¶ã€‚Docker çš„ç½‘ç»œå­ç³»ç»Ÿé‡‡ç”¨äº†åŸºäºé©±åŠ¨çš„å¯æ’æ‹”æœºåˆ¶ï¼Œå…¶é»˜è®¤åŒ…å«äº†å¦‚ä¸‹é©±åŠ¨æ¨¡å¼ï¼š</p><ul><li><code>bridge</code>: é»˜è®¤çš„ç½‘ç»œé©±åŠ¨ï¼Œå¸¸ç”¨äºå¤šä¸ªåº”ç”¨è¿è¡Œä¸ç‹¬ç«‹å®¹å™¨ä¸­å¹¶ä¸”éœ€è¦ç›¸äº’é€šè®¯çš„æ—¶å€™ã€‚</li><li><code>host</code>: ç§»é™¤å®¹å™¨ä¸ Docker ä¸»æœºä¹‹é—´çš„ç½‘ç»œéš”ç¦»ï¼Œç›´æ¥ä½¿ç”¨å®¿ä¸»æœºæ‰€åœ¨çš„ç½‘ç»œã€‚åº•å±‚ä¸å®¿ä¸»æœºå…±ç”¨ä¸€ä¸ª Network Namespaceï¼Œå®¹å™¨å°†ä¸ä¼šè™šæ‹Ÿå‡ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„ IP ç­‰ï¼Œè€Œæ˜¯ä½¿ç”¨å®¿ä¸»æœºçš„ IP å’Œç«¯å£ã€‚</li><li><code>overlay</code>: Overlay ç½‘ç»œç”¨è¯­è¿æ¥å¤šä¸ª Docker Daemonï¼Œä¿è¯ Docker Swarm æœåŠ¡çš„æ­£å¸¸è¿è¡Œï¼›ç‹¬ç«‹çš„å®¹å™¨ä¸ Swarm æœåŠ¡ï¼Œæˆ–è€…ä¸åŒå®¿ä¸»æœºä¸Šçš„å®¹å™¨åŒæ ·èƒ½å¤Ÿé€šè¿‡ Overlay è¿›è¡Œé€šä¿¡ã€‚</li><li><code>none</code>: å¯¹äºæŒ‡å®šå®¹å™¨ç¦æ­¢æ‰€æœ‰çš„ç½‘ç»œé€šä¿¡ã€‚</li><li><code>macvlan</code>: Macvlan ç½‘ç»œä¼šå…è®¸ç›´æ¥ä¸ºå®¹å™¨åˆ†é… MAC åœ°å€ï¼Œä½¿å…¶ä½œä¸ºçœŸæ­£çš„ç‰©ç†è®¾å¤‡æ¥å…¥åˆ°å®¿ä¸»æœºæ‰€åœ¨çš„ç½‘ç»œä¸­ã€‚</li></ul><p>æˆ‘ä»¬ä½¿ç”¨ network å‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ°é»˜è®¤çš„ç½‘ç»œï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ docker network ls
</span></span><span class=line><span class=cl>NETWORK ID          NAME                DRIVER              SCOPE
</span></span><span class=line><span class=cl>f707aa0ef50d        bridge              bridge              <span class=nb>local</span>
</span></span><span class=line><span class=cl>97dd7a032d96        host                host                <span class=nb>local</span>
</span></span><span class=line><span class=cl>d5a1bed0b12d        none                null                <span class=nb>local</span>
</span></span></code></pre></div><p>æ¡¥æ¥æ¨¡å¼ä¸‹ï¼Œå½“ Docker å¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ª docker0 è™šæ‹Ÿç½‘æ¡¥ï¼Œå³è½¯ä»¶äº¤æ¢æœºï¼Œåœ¨æŒ‚è½½åˆ°å®ƒçš„ç½‘å£ä¹‹é—´è¿›è¡Œè½¬å‘ã€‚åŒæ—¶ï¼ŒDocker éšæœºåˆ†é…ä¸€ä¸ªæœ¬åœ°æœªå ç”¨çš„ç§æœ‰ç½‘æ®µ(åœ¨ RFC1918 ä¸­å®šä¹‰)ä¸­çš„ä¸€ä¸ªåœ°å€ç»™ docker0 æ¥å£ã€‚æ¯”å¦‚å…¸å‹çš„ 172.17.42.1ï¼Œæ©ç ä¸º 255.255.0.0ã€‚æ­¤åå¯åŠ¨çš„å®¹å™¨å†…çš„ç½‘å£ä¹Ÿä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªåŒä¸€ç½‘æ®µ(172.17.0.0/16)çš„åœ°å€ã€‚</p><p>æ¡¥æ¥æ¨¡å¼ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ª Docker å®¹å™¨çš„æ—¶å€™ï¼ŒåŒæ—¶ä¼šåˆ›å»ºäº†ä¸€å¯¹ veth pair æ¥å£(å½“æ•°æ®åŒ…å‘é€åˆ°ä¸€ä¸ªæ¥å£æ—¶ï¼Œå¦å¤–ä¸€ä¸ªæ¥å£ä¹Ÿå¯ä»¥æ”¶åˆ°ç›¸åŒçš„æ•°æ®åŒ…)ã€‚è¿™å¯¹æ¥å£ä¸€ç«¯åœ¨å®¹å™¨å†…ï¼Œå³ eth0ï¼›å¦ä¸€ç«¯åœ¨æœ¬åœ°å¹¶è¢«æŒ‚è½½åˆ° docker0 ç½‘æ¡¥ï¼Œåç§°ä»¥ veth å¼€å¤´(ä¾‹å¦‚ vethAQI2QT)ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä¸»æœºå¯ä»¥è·Ÿå®¹å™¨é€šä¿¡ï¼Œå®¹å™¨ä¹‹é—´ä¹Ÿå¯ä»¥ç›¸äº’é€šä¿¡ã€‚Docker å°±åˆ›å»ºäº†åœ¨ä¸»æœºå’Œæ‰€æœ‰å®¹å™¨ä¹‹é—´ä¸€ä¸ªè™šæ‹Ÿå…±äº«ç½‘ç»œã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># åˆ›å»ºæ–°çš„ç½‘ç»œ</span>
</span></span><span class=line><span class=cl>$ docker network create --driver bridge isolated
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŒ‡å®šç½‘æ®µï¼Œå®¿ä¸»æœºä¼šä½œä¸ºé»˜è®¤ç½‘å…³</span>
</span></span><span class=line><span class=cl>$ docker network create --driver<span class=o>=</span>bridge --subnet<span class=o>=</span>192.168.2.0/24 --gateway<span class=o>=</span>192.168.2.10 new_subnet
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ›å»ºæ—¶å°†æŸä¸ªå®¹å™¨è¿æ¥åˆ°ç½‘ç»œ</span>
</span></span><span class=line><span class=cl>$ docker run --network<span class=o>=</span>isolated -itd --name<span class=o>=</span>docker-nginx nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å°†æŸä¸ªè¿è¡Œä¸­å®¹å™¨è¿æ¥åˆ°æŸä¸ªç½‘ç»œï¼Œåœ¨è¯¥ç½‘ç»œå†…å¯ä»¥é€šè¿‡å®¹å™¨åè‡ªç”±è®¿é—®</span>
</span></span><span class=line><span class=cl>$ docker network connect multi-host-network container1
</span></span></code></pre></div><h3 id=dns>DNS</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨ä» Docker å®ˆæŠ¤è¿›ç¨‹ç»§æ‰¿ DNS è®¾ç½®ï¼ŒåŒ…æ‹¬ /etc/hosts å’Œ /etc/resolv.confã€‚å¯ä»¥åŸºäºæ¯ä¸ªå®¹å™¨è¦†ç›–è¿™äº›è®¾ç½®ã€‚</p><ul><li>-h HOSTNAME or &ndash;hostname=HOSTNAME è®¾å®šå®¹å™¨çš„ä¸»æœºåï¼Œå®ƒä¼šè¢«å†™åˆ°å®¹å™¨å†…çš„ /etc/hostname å’Œ /etc/hostsã€‚ä½†å®ƒåœ¨å®¹å™¨å¤–éƒ¨çœ‹ä¸åˆ°ï¼Œæ—¢ä¸ä¼šåœ¨ docker ps ä¸­æ˜¾ç¤ºï¼Œä¹Ÿä¸ä¼šåœ¨å…¶ä»–çš„å®¹å™¨çš„ /etc/hosts çœ‹åˆ°ã€‚</li><li>&ndash;link=CONTAINER_NAME:ALIAS é€‰é¡¹ä¼šåœ¨åˆ›å»ºå®¹å™¨çš„æ—¶å€™ï¼Œæ·»åŠ ä¸€ä¸ªå…¶ä»–å®¹å™¨çš„ä¸»æœºååˆ° /etc/hosts æ–‡ä»¶ä¸­ï¼Œè®©æ–°å®¹å™¨çš„è¿›ç¨‹å¯ä»¥ä½¿ç”¨ä¸»æœºå ALIAS å°±å¯ä»¥è¿æ¥å®ƒã€‚</li><li>&ndash;dns=IP_ADDRESS æ·»åŠ  DNS æœåŠ¡å™¨åˆ°å®¹å™¨çš„ /etc/resolv.conf ä¸­ï¼Œè®©å®¹å™¨ç”¨è¿™ä¸ªæœåŠ¡å™¨æ¥è§£ææ‰€æœ‰ä¸åœ¨ /etc/hosts ä¸­çš„ä¸»æœºåã€‚</li><li>&ndash;dns-search=DOMAIN è®¾å®šå®¹å™¨çš„æœç´¢åŸŸï¼Œå½“è®¾å®šæœç´¢åŸŸä¸º .example.com æ—¶ï¼Œåœ¨æœç´¢ä¸€ä¸ªåä¸º host çš„ ä¸»æœºæ—¶ï¼ŒDNS ä¸ä»…æœç´¢ hostï¼Œè¿˜ä¼šæœç´¢ host.example.comã€‚æ³¨æ„ï¼šå¦‚æœæ²¡æœ‰ä¸Šè¿°æœ€å 2 ä¸ªé€‰é¡¹ï¼ŒDocker ä¼šé»˜è®¤ç”¨ä¸»æœºä¸Šçš„ /etc/resolv.conf æ¥é…ç½®å®¹å™¨ã€‚</li></ul><h2 id=ç©ºé—´æ¸…ç†>ç©ºé—´æ¸…ç†</h2><p>Docker ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‘ç°å®¿ä¸»èŠ‚ç‚¹çš„ç£ç›˜å®¹é‡æŒç»­å¢é•¿ï¼Œè­¬å¦‚ volume æˆ–è€… overlay2 ç›®å½•å ç”¨äº†å¤§é‡çš„ç©ºé—´ï¼›å¦‚æœä»»å…¶å‘å±•ï¼Œå¯èƒ½å°†ç£ç›˜ç©ºé—´è€—å°½è¿›è€Œå¼•å‘å®¿ä¸»æœºå¼‚å¸¸ï¼Œè¿›è€Œå¯¹ä¸šåŠ¡é€ æˆå½±å“ã€‚Docker çš„å†…ç½® df æŒ‡ä»¤å¯ç”¨äºæŸ¥è¯¢é•œåƒ(Images)ã€å®¹å™¨(Containers)å’Œæœ¬åœ°å·(Local Volumes)ç­‰ç©ºé—´ä½¿ç”¨å¤§æˆ·çš„ç©ºé—´å ç”¨æƒ…å†µã€‚è€Œå®¹å™¨çš„å ç”¨çš„æ€»ç©ºé—´ï¼ŒåŒ…å«å…¶æœ€é¡¶å±‚çš„è¯»å†™å±‚(writable layer)å’Œåº•éƒ¨çš„åªè¯»é•œåƒå±‚(base image layerï¼Œread-only)ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>ps -s</code> å‚æ•°æ¥æ˜¾ç¤ºäºŒè€…çš„ç©ºé—´å ç”¨æƒ…å†µ:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ç©ºé—´å ç”¨</span>
</span></span><span class=line><span class=cl>$ du -h --max-depth<span class=o>=</span><span class=m>1</span> <span class=p>|</span> sort
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç©ºé—´å ç”¨æ€»ä½“åˆ†æ</span>
</span></span><span class=line><span class=cl>$ docker system df
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è¾“å‡ºç©ºé—´å ç”¨ç»†èŠ‚</span>
</span></span><span class=line><span class=cl>$ docker system df -v
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è¾“å‡ºå®¹å™¨çš„ç©ºé—´å ç”¨</span>
</span></span><span class=line><span class=cl>$ docker ps -s
</span></span></code></pre></div><p><code>docker system prune</code> æŒ‡ä»¤èƒ½å¤Ÿè¿›è¡Œè‡ªåŠ¨åœ°ç©ºé—´æ¸…ç†ï¼Œå…¶é»˜è®¤ä¼šæ¸…é™¤å·²åœæ­¢çš„å®¹å™¨ã€æœªè¢«ä»»ä½•å®¹å™¨æ‰€ä½¿ç”¨çš„å·ã€æœªè¢«ä»»ä½•å®¹å™¨æ‰€å…³è”çš„ç½‘ç»œã€æ‰€æœ‰æ‚¬ç©ºé•œåƒ:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># ä¸€å¹¶æ¸…é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒå’Œæ‚¬ç©ºé•œåƒ</span>
</span></span><span class=line><span class=cl>$ docker system prune --all
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ—ä¸¾æ‚¬ç©ºé•œåƒ</span>
</span></span><span class=line><span class=cl>$ docker images -f <span class=nv>dangling</span><span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ é™¤å…¨éƒ¨æ‚¬ç©ºé•œåƒ</span>
</span></span><span class=line><span class=cl>$ docker image prune
</span></span><span class=line><span class=cl><span class=c1># åˆ é™¤æ‰€æœ‰æœªè¢«ä½¿ç”¨çš„é•œåƒ</span>
</span></span><span class=line><span class=cl>$ docker image prune -a
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ é™¤æŒ‡å®šæ¨¡å¼çš„é•œåƒ</span>
</span></span><span class=line><span class=cl>$ docker images -a <span class=p>|</span> grep <span class=s2>&#34;pattern&#34;</span> <span class=p>|</span> awk <span class=s1>&#39;{print $3}&#39;</span> <span class=p>|</span> xargs docker rmi
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ é™¤å…¨éƒ¨é•œåƒ</span>
</span></span><span class=line><span class=cl>$ docker rmi <span class=k>$(</span>docker images -a -q<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ é™¤å…¨éƒ¨åœæ­¢çš„å®¹å™¨</span>
</span></span><span class=line><span class=cl>$ docker rm <span class=k>$(</span>docker ps -a -f <span class=nv>status</span><span class=o>=</span>exited -q<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ ¹æ®æŒ‡å®šæ¨¡å¼åˆ é™¤å®¹å™¨</span>
</span></span><span class=line><span class=cl>$ docker rm <span class=k>$(</span>docker ps -a -f <span class=nv>status</span><span class=o>=</span>exited -f <span class=nv>status</span><span class=o>=</span>created -q<span class=k>)</span>
</span></span><span class=line><span class=cl>$ docker rm <span class=k>$(</span>docker ps -a <span class=p>|</span> grep rabbitmq <span class=p>|</span> awk <span class=s1>&#39;{print $1}&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ é™¤å…¨éƒ¨å®¹å™¨</span>
</span></span><span class=line><span class=cl>$ docker stop <span class=k>$(</span>docker ps -a -q<span class=k>)</span>
</span></span><span class=line><span class=cl>$ docker rm <span class=k>$(</span>docker ps -a -q<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ—ä¸¾å¹¶åˆ é™¤æœªè¢«ä½¿ç”¨çš„å·</span>
</span></span><span class=line><span class=cl>$ docker volume ls -f <span class=nv>dangling</span><span class=o>=</span><span class=nb>true</span>
</span></span><span class=line><span class=cl>$ docker volume prune
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ ¹æ®æŒ‡å®šçš„æ¨¡å¼åˆ é™¤å·</span>
</span></span><span class=line><span class=cl>$ docker volume prune --filter <span class=s2>&#34;label!=keep&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ é™¤æœªè¢«å…³è”çš„ç½‘ç»œ</span>
</span></span><span class=line><span class=cl>$ docker network prune
</span></span><span class=line><span class=cl>$ docker network prune --filter <span class=s2>&#34;until=24h&#34;</span>
</span></span></code></pre></div><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„å°ºå¯¸æˆ–è€…æ¸…ç©ºæ—¥å¿—æ–‡ä»¶:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># è®¾ç½®æ—¥å¿—æ–‡ä»¶æœ€å¤§å°ºå¯¸</span>
</span></span><span class=line><span class=cl>$ dockerd ... --log-opt max-size<span class=o>=</span>10m --log-opt max-file<span class=o>=</span><span class=m>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ¸…ç©ºå½“å‰æ—¥å¿—æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>truncate -s <span class=m>0</span> /var/lib/docker/containers/*/*-json.log
</span></span></code></pre></div><h1 id=æœåŠ¡æ²»ç†>æœåŠ¡æ²»ç†</h1><h2 id=docker-compose>Docker Compose</h2><p>Docker Compose æ˜¯ç”¨äºå®šä¹‰å’Œè¿è¡Œå¤æ‚ Docker åº”ç”¨çš„å·¥å…·ã€‚ä½ å¯ä»¥åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ªå¤šå®¹å™¨çš„åº”ç”¨ï¼Œç„¶åä½¿ç”¨ä¸€æ¡å‘½ä»¤æ¥å¯åŠ¨ä½ çš„åº”ç”¨ï¼Œç„¶åæ‰€æœ‰ç›¸å…³çš„æ“ä½œéƒ½ä¼šè¢«è‡ªåŠ¨å®Œæˆï¼›ç®€å•çš„ Compose æ–‡ä»¶å®šä¹‰å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># æŒ‡å®š Docker Compose æ–‡ä»¶ç‰ˆæœ¬</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>web</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># æŒ‡å®šä»æœ¬åœ°ç›®å½•è¿›è¡Œç¼–è¯‘</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># æŒ‡å®šå¯¼å‡ºç«¯å£</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;5000:5000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># æ›¿æ¢é»˜è®¤çš„ CMD å‘½ä»¤</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=l>python app.py</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># å°†æœ¬åœ°ç›®å½•ç»‘å®šåˆ°å®¹å™¨å†…ç›®å½•</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>.:/code</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>redis</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># é•œåƒçš„ ID</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;redis:alpine&#34;</span><span class=w>
</span></span></span></code></pre></div><p>è¿™é‡Œç”¨åˆ°çš„ Python Web åº”ç”¨çš„ Dockerfile å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> python:3.4-alpine</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ADD</span> . /code<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /code</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip install -r requirements.txt<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;python&#34;</span><span class=p>,</span> <span class=s2>&#34;app.py&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></div><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨æœåŠ¡åä½œä¸ºè¿æ¥åœ°å€ï¼Œå³å¯è®¿é—®åˆ° Redis æ•°æ®åº“ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=n>cache</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;redis&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>)</span>
</span></span></code></pre></div><p>ç„¶åä½¿ç”¨ docker-compose å‘½ä»¤å¯åŠ¨ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># äº¤äº’å¼å¯åŠ¨</span>
</span></span><span class=line><span class=cl>$ docker-compose up
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å®ˆæŠ¤è¿›ç¨‹å¼å¯åŠ¨</span>
</span></span><span class=line><span class=cl>$ docker-compose up -d
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹è¿è¡Œæƒ…å†µ</span>
</span></span><span class=line><span class=cl>$ docker-compose ps
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å…³é—­</span>
</span></span><span class=line><span class=cl>$ docker-compose stop
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç§»é™¤å†…éƒ¨å·</span>
</span></span><span class=line><span class=cl>$ docker-compose down --volumes
</span></span></code></pre></div><p>åœ¨æ¶‰åŠåˆ°æ•°æ®å­˜å‚¨çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥æŒ‡å®š docker-compose åˆ›å»ºå‘½åæ•°æ®å·ï¼Œå¹¶å°†å…¶æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3.2&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>web</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>volume</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>source</span><span class=p>:</span><span class=w> </span><span class=l>mydata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>target</span><span class=p>:</span><span class=w> </span><span class=l>/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volume</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>nocopy</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>bind</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>source</span><span class=p>:</span><span class=w> </span><span class=l>./static</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>target</span><span class=p>:</span><span class=w> </span><span class=l>/opt/app/static</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>db</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;/var/run/postgres/postgres.sock:/var/run/postgres/postgres.sock&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;dbdata:/var/lib/postgresql/data&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>mydata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dbdata</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></div><p>å¦‚æœæŸä¸ªæ•°æ®å·å¤©ç„¶éœ€è¦æ˜ å°„åˆ°æœ¬åœ°æ–‡ä»¶ï¼Œåˆ™å¯ä»¥æŒ‡å®š driver çš„ç±»å‹ä¸º local:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>wsat_etc</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class=l>local</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>driver_opts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>o</span><span class=p>:</span><span class=w> </span><span class=l>bind</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>none</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>device</span><span class=p>:</span><span class=w> </span><span class=l>/etc/wsat/</span><span class=w>
</span></span></span></code></pre></div><h2 id=docker-swarm-1>Docker Swarm</h2><p>Swarm æ˜¯ Docker å…¬å¸åœ¨ 2014 å¹´ 12 æœˆåˆå‘å¸ƒçš„ä¸€å¥—è¾ƒä¸ºç®€å•çš„å·¥å…·ï¼Œç”¨æ¥ç®¡ç† Docker é›†ç¾¤ï¼Œå®ƒå°†ä¸€ç¾¤ Docker å®¿ä¸»æœºå˜æˆä¸€ä¸ªå•ä¸€çš„ï¼Œè™šæ‹Ÿçš„ä¸»æœºã€‚Swarm ä½¿ç”¨æ ‡å‡†çš„ Docker API æ¥å£ä½œä¸ºå…¶å‰ç«¯è®¿é—®å…¥å£ï¼Œæ¢è¨€ä¹‹ï¼Œå„ç§å½¢å¼çš„ Docker Client(dockerclient in go, docker_py, docker ç­‰)å‡å¯ä»¥ç›´æ¥ä¸ Swarm é€šä¿¡ã€‚</p><p>Swarm Deamon åªæ˜¯ä¸€ä¸ªè°ƒåº¦å™¨(Scheduler)å’Œè·¯ç”±å™¨(Router)ï¼ŒSwarm è‡ªå·±ä¸è¿è¡Œå®¹å™¨ï¼Œå®ƒåªæ˜¯æ¥å— Docker å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ï¼Œè°ƒåº¦é€‚åˆçš„èŠ‚ç‚¹æ¥è¿è¡Œå®¹å™¨ï¼Œè¿™æ„å‘³ç€ï¼Œå³ä½¿ Swarm ç”±äºæŸäº›åŸå› æŒ‚æ‰äº†ï¼Œé›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¹Ÿä¼šç…§å¸¸è¿è¡Œï¼Œå½“ Swarm é‡æ–°æ¢å¤è¿è¡Œä¹‹åï¼Œå®ƒä¼šæ”¶é›†é‡å»ºé›†ç¾¤ä¿¡æ¯ã€‚å¹¶ä¸” Swarm æä¾›çš„è·¯ç”±åŒ¹é…(æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€è·¨å®¹å™¨é€šè®¯)éå¸¸å¯é ã€‚åœ¨å•ä¸ªç«¯å£ä¸Šè¿è¡Œä¸€ä¸ªæœåŠ¡ï¼ŒSwarm èŠ‚ç‚¹çš„ä»»æ„ä¸»æœºéƒ½å¯ä»¥è®¿é—®ï¼Œè´Ÿè½½å‡è¡¡å®Œå…¨åœ¨åå°å®ç°ã€‚</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://user-images.githubusercontent.com/5803001/44953944-dfbc7a00-aecd-11e8-93dc-1fe6258aafd0.png alt=image loading=lazy data-zoomable></div></div></figure></p><p>Swarm åœ¨ Scheduler èŠ‚ç‚¹è¿è¡Œå®¹å™¨çš„æ—¶å€™ï¼Œä¼šæ ¹æ®æŒ‡å®šçš„ç­–ç•¥æ¥è®¡ç®—æœ€é€‚åˆè¿è¡Œå®¹å™¨çš„èŠ‚ç‚¹ï¼Œç›®å‰æ”¯æŒçš„ç­–ç•¥æœ‰ï¼šRandom, Binpack, Spreadã€‚</p><p>Random é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯éšæœºé€‰æ‹©ä¸€ä¸ª Node æ¥è¿è¡Œå®¹å™¨ï¼Œä¸€èˆ¬ç”¨ä½œè°ƒè¯•ç”¨ã€‚Spread å’Œ Binpack ç­–ç•¥ä¼šæ ¹æ®å„ä¸ªèŠ‚ç‚¹çš„å¯ç”¨çš„ CPU, RAM ä»¥åŠæ­£åœ¨è¿è¡Œçš„å®¹å™¨çš„æ•°é‡æ¥è®¡ç®—åº”è¯¥è¿è¡Œå®¹å™¨çš„èŠ‚ç‚¹ã€‚åœ¨åŒç­‰æ¡ä»¶ä¸‹ï¼ŒSpread ç­–ç•¥ä¼šé€‰æ‹©è¿è¡Œå®¹å™¨æœ€å°‘çš„é‚£å°èŠ‚ç‚¹æ¥è¿è¡Œæ–°çš„å®¹å™¨ï¼ŒBinpack ç­–ç•¥ä¼šé€‰æ‹©è¿è¡Œå®¹å™¨æœ€é›†ä¸­çš„é‚£å°æœºå™¨æ¥è¿è¡Œæ–°çš„èŠ‚ç‚¹ã€‚</p><p>ä½¿ç”¨ Spread ç­–ç•¥ä¼šä½¿å¾—å®¹å™¨ä¼šå‡è¡¡çš„åˆ†å¸ƒåœ¨é›†ç¾¤ä¸­çš„å„ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œä¸€æ—¦ä¸€ä¸ªèŠ‚ç‚¹æŒ‚æ‰äº†åªä¼šæŸå¤±å°‘éƒ¨åˆ†çš„å®¹å™¨ã€‚Binpack ç­–ç•¥æœ€å¤§åŒ–çš„é¿å…å®¹å™¨ç¢ç‰‡åŒ–ï¼Œå°±æ˜¯è¯´ Binpack ç­–ç•¥å°½å¯èƒ½çš„æŠŠè¿˜æœªä½¿ç”¨çš„èŠ‚ç‚¹ç•™ç»™éœ€è¦æ›´å¤§ç©ºé—´çš„å®¹å™¨è¿è¡Œï¼Œå°½å¯èƒ½çš„æŠŠå®¹å™¨è¿è¡Œåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šé¢ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># åˆ›å»ºä¸€ä¸ªæ–°çš„æœåŠ¡</span>
</span></span><span class=line><span class=cl>$ docker service create <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--image nginx <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--replicas <span class=m>2</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ›´æ–°æœåŠ¡</span>
</span></span><span class=line><span class=cl>$ docker service update <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--image nginx:alpine <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ é™¤æœåŠ¡</span>
</span></span><span class=line><span class=cl>$ docker service rm nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç¼©å®¹ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ é™¤æœåŠ¡</span>
</span></span><span class=line><span class=cl>$ docker service scale <span class=nv>nginx</span><span class=o>=</span><span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ‰©å®¹</span>
</span></span><span class=line><span class=cl>$ docker service scale <span class=nv>nginx</span><span class=o>=</span><span class=m>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ—å‡ºæ‰€æœ‰çš„æœåŠ¡</span>
</span></span><span class=line><span class=cl>$ docker service ls
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ—å‡ºä¸€ä¸ªæœåŠ¡çš„æ‰€æœ‰å®ä¾‹(åŒ…æ‹¬æœåŠ¡çš„å¥åº·çŠ¶å†µ)</span>
</span></span><span class=line><span class=cl>$ docker service ps nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æœåŠ¡çš„è¯¦ç»†ä¿¡æ¯</span>
</span></span><span class=line><span class=cl>$ docker service inspect nginx
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å¢åŠ å’Œåˆ é™¤DNS</span>
</span></span><span class=line><span class=cl>$ docker service update --dns-add 222.222.222.222 tender_hofstadter
</span></span><span class=line><span class=cl>$ docker service update --dns-rm 222.222.222.222 tender_hofstadter
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å¢åŠ å’Œåˆ é™¤ç«¯å£æ˜ å°„</span>
</span></span><span class=line><span class=cl>$ docker service update --publish-add 80:80 xenodochial_ritchie
</span></span><span class=line><span class=cl>$ docker service update --publish-rm 80:80 xenodochial_ritchie
</span></span></code></pre></div><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ Docker Compose çš„è„šæœ¬æ¥è¿›è¡Œæ‰¹æ¬¡éƒ¨ç½²ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ docker stack deploy application
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>web</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>registry.gitlab.com/example/example</span><span class=w> </span><span class=c># you need to use external image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=l>npm run prod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>80</span><span class=p>:</span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>6</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>update_config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>parallelism</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>delay</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>restart_policy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=kc>on</span>-<span class=l>failure</span><span class=w>
</span></span></span></code></pre></div></div><div class=article-widget><div class="container-xl row post-nav"></div></div><div class=body-footer><p>æœ€è¿‘æ›´æ–°äº 2023-04-16</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>Â© 2017-2022 NGTE all rights reserved</p></div></div></div><script type=text/javascript id=clstr_globe async src="//clustrmaps.com/globe.js?d=kgpJG5sWZQpKujBmD-uW1B54-WBPol-DuDtrB2KFjKs"></script></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"å·²å¤åˆ¶")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>