<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Cloud | Next-gen Tech Edu</title><link>https://ng-tech.icu/books/awesome-cheatsheets/04.infrastructure/cloud/</link><atom:link href="https://ng-tech.icu/books/awesome-cheatsheets/04.infrastructure/cloud/index.xml" rel="self" type="application/rss+xml"/><description>Cloud</description><generator>Wowchemy (https://wowchemy.com)</generator><language>zh</language><image><url>https://ng-tech.icu/media/sharing.png</url><title>Cloud</title><link>https://ng-tech.icu/books/awesome-cheatsheets/04.infrastructure/cloud/</link></image><item><title>Docker-Cheatsheet</title><link>https://ng-tech.icu/books/awesome-cheatsheets/04.infrastructure/cloud/docker-cheatsheet/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://ng-tech.icu/books/awesome-cheatsheets/04.infrastructure/cloud/docker-cheatsheet/</guid><description>&lt;p>
&lt;figure >
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="https://user-images.githubusercontent.com/5803001/45699770-5d0a0f00-bb9d-11e8-8ce7-82650bfcbb39.png" alt="image" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;/figure>&lt;/p>
&lt;blockquote>
&lt;p>ðŸ“– èŠ‚é€‰è‡ª &lt;a href="https://parg.co/o9d" target="_blank" rel="noopener">Awesome CheatSheet/Docker CheatSheet&lt;/a>ï¼Œå¯¹æ¥è‡ª&lt;a href="https://docs.docker.com/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£&lt;/a>åŠ &lt;a href="https://parg.co/o90" target="_blank" rel="noopener">Docker Links&lt;/a> ä¸­é“¾æŽ¥å†…å®¹çš„å½’æ¡£æ•´ç†ï¼ŒåŒ…å«äº†æ—¥å¸¸å·¥ä½œä¸­å¸¸ç”¨çš„ Docker æ¦‚å¿µä¸Žå‘½ä»¤ï¼Œå¦‚æžœå¯¹äºŽ Linux å¸¸ç”¨æ“ä½œå°šä¸ç†Ÿæ‚‰çš„å¯ä»¥å‚è€ƒ &lt;a href="https://parg.co/oiT" target="_blank" rel="noopener">Linux Commands CheatSheet&lt;/a>ã€‚&lt;/p>
&lt;/blockquote>
&lt;h1 id="docker-cheatsheet--docker-é…ç½®ä¸Žå®žè·µæ¸…å•">Docker CheatSheet | Docker é…ç½®ä¸Žå®žè·µæ¸…å•&lt;/h1>
&lt;p>å®¹å™¨æ˜¯åœ¨æ“ä½œç³»ç»Ÿä¸­å»ºç«‹éš”ç¦»ä¸Šä¸‹æ–‡çš„ä¸€ç§æ–¹æ³•ã€‚å®žé™…ä¸Šï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä¸­çš„æ¯ä¸€ä¸ªéƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„åŒ…å«äº†ä¸€ç»„å·²å®‰è£…çš„è½¯ä»¶å’Œç›¸å…³é…ç½®çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿã€‚ç”±äºŽå®ƒä»¬æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œå› æ­¤ä»»ä½•å®¹å™¨éƒ½ä¸èƒ½ç›´æŽ¥è®¿é—®æˆ–å½±å“å…¶ä»–å®¹å™¨æˆ–åº•å±‚å®¿ä¸»æ“ä½œç³»ç»Ÿã€‚Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“Žï¼ŒåŸºäºŽ Go è¯­è¨€ å¹¶éµä»Ž Apache2.0 åè®®å¼€æºã€‚Docker å¯ä»¥è®©å¼€å‘è€…æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªè½»é‡çº§ã€å¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åŽå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linux æœºå™¨ä¸Šã€‚&lt;/p>
&lt;p>
&lt;figure >
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="https://user-images.githubusercontent.com/5803001/43813144-f630ba5c-9af6-11e8-8443-175666d4615a.png" alt="image" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;/figure>&lt;/p>
&lt;p>è™šæ‹Ÿæœºæœ€å¤§çš„ç“¶é¢ˆåœ¨äºŽå…¶éœ€è¦ç‰¹æ®Šç¡¬ä»¶è™šæ‹ŸåŒ–æŠ€æœ¯æ”¯æŒï¼Œå¹¶ä¸”æºå¸¦å®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼›è€Œ Docker æ²¡æœ‰ç¡¬ä»¶è™šæ‹ŸåŒ–ï¼Œå¯ä»¥è¿è¡Œåœ¨ç‰©ç†æœºã€è™šæ‹Ÿæœº, ç”šè‡³åµŒå¥—è¿è¡Œåœ¨ Docker å®¹å™¨å†…ï¼Œå¹¶ä¸”å…¶ä¸æºå¸¦æ“ä½œç³»ç»Ÿçš„ï¼Œä¼šè½»å·§å¾ˆå¤šã€‚åœ¨è°ƒç”¨å®¿ä¸»æœºçš„å†…å­˜ã€CPUã€ç£ç›˜ç­‰ç­‰èµ„æºæ—¶ï¼Œè™šæ‹Ÿæœºæ˜¯åˆ©ç”¨ Hypervisor åŽ»è™šæ‹ŸåŒ–å†…å­˜ï¼Œæ•´ä¸ªè°ƒç”¨è¿‡ç¨‹æ˜¯è™šæ‹Ÿå†…å­˜-&amp;gt;è™šæ‹Ÿç‰©ç†å†…å­˜-&amp;gt;çœŸæ­£ç‰©ç†å†…å­˜ï¼Œä½†æ˜¯ Docker æ˜¯åˆ©ç”¨ Docker Engine åŽ»è°ƒç”¨å®¿ä¸»çš„çš„èµ„æºï¼Œè¿™æ—¶å€™è¿‡ç¨‹æ˜¯è™šæ‹Ÿå†…å­˜-&amp;gt;çœŸæ­£ç‰©ç†å†…å­˜ã€‚&lt;/p>
&lt;p>Docker ç»¼åˆè¿ç”¨äº† Cgroup, Linux Namespaceï¼ŒSecomp capability, Selinux ç­‰æœºåˆ¶ï¼Œåœ¨ &lt;a href="./Docker-Internals-CheatSheet">Docker Internals CheatSheet&lt;/a> ä¸­æˆ‘ä»¬ä¼šæœ‰è¯¦ç»†çš„è®¨è®ºï¼Œæˆ–è€…å‰å¾€ &lt;a href="https://github.com/wx-chevalier/Backend-Boilerplate/tree/master/docker" target="_blank" rel="noopener">Backend Boilerplate/docker&lt;/a> æµè§ˆå¸¸è§æœåŠ¡/åº”ç”¨çš„ Docker é…ç½®æ¡ˆä¾‹ã€‚&lt;/p>
&lt;p>
&lt;figure >
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="https://user-images.githubusercontent.com/5803001/44158672-dec2d480-a0e7-11e8-9f50-ce83c9638853.png" alt="image" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;/figure>&lt;/p>
&lt;h1 id="å®‰è£…ä¸Žé…ç½®">å®‰è£…ä¸Žé…ç½®&lt;/h1>
&lt;h2 id="docker-ce">Docker CE&lt;/h2>
&lt;p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨&lt;a href="https://mirrors.ustc.edu.cn/help/docker-ce.html" target="_blank" rel="noopener">ç§‘å¤§çš„ Docker CE æº&lt;/a>è¿›è¡Œå®‰è£…ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ›´æ”¹ Ubuntu é»˜è®¤æºåœ°å€&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo sed -i &lt;span class="s1">&amp;#39;s/archive.ubuntu.com/mirrors.ustc.edu.cn/g&amp;#39;&lt;/span> /etc/apt/sources.list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å®‰è£…å¿…å¤‡çš„ç³»ç»Ÿå‘½ä»¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo apt-get install -y python-software-properties
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ curl -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/gpg &lt;span class="p">|&lt;/span> sudo apt-key add -
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo add-apt-repository &lt;span class="s2">&amp;#34;deb [arch=amd64] https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu &lt;/span>&lt;span class="k">$(&lt;/span>lsb_release -cs&lt;span class="k">)&lt;/span>&lt;span class="s2"> stable&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo apt-get update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ apt-cache policy docker-ce &lt;span class="c1"># åˆ—ä¸¾ docker-ce ç‰ˆæœ¬&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ apt-get install docker-ce&lt;span class="o">=&lt;/span>17.03.2-ce....
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="daemon-configuration">Daemon Configuration&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># é…ç½®å¼€æœºè‡ªå¯åŠ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo systemctl &lt;span class="nb">enable&lt;/span> docker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å–æ¶ˆå¼€æœºè‡ªå¯åŠ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo systemctl disable docker
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹å­˜å‚¨è·¯å¾„ï¼ŒæŒ‡å®šé•œåƒå­˜å‚¨åœ°å€ï¼Œå…è®¸è¿œç¨‹è®¿é—®ï¼›æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ systemd ä¸­çš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ &lt;code>/etc/docker/daemon.json&lt;/code>ï¼Œæ­¤å¤„ä»¥ä¿®æ”¹æœåŠ¡ä¸ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä½¿ç”¨ systemctl å‘½ä»¤è¡Œä¿®æ”¹&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo systemctl edit docker.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æˆ–è€…æŸ¥æ‰¾é…ç½®åœ°å€å¹¶ä½¿ç”¨ Vim ä¿®æ”¹&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ systemctl status docker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¿®æ”¹æ–‡ä»¶å†…å®¹&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Service&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ExecStart&lt;/span>&lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ExecStart&lt;/span>&lt;span class="o">=&lt;/span>/usr/bin/dockerd -H fd:// -H tcp://127.0.0.1:2375 -H unix:///var/run/docker.sock --insecure-registry 10.196.108.176:5000 --dns 114.114.114.114 --dns 8.8.8.8 --dns 8.8.4.4 -g /mnt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åŽé‡å¯æœåŠ¡ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># é‡æ–°è½½å…¥æœåŠ¡é…ç½®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># é‡å¯ Docker&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo systemctl restart docker.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ¤æ–­æ˜¯å¦é…ç½®æˆåŠŸ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo netstat -lntp &lt;span class="p">|&lt;/span> grep dockerd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="docker-swarm">Docker Swarm&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åœ¨ä¸»èŠ‚ç‚¹å¯åŠ¨ Swarm&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker swarm init
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŸ¥çœ‹ Swarm å¯†é’¥&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker swarm join-token -q worker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åœ¨ä¸»èŠ‚ç‚¹å¯åŠ¨ Procontainer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker run -it -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åœ¨ä¸»èŠ‚ç‚¹å¯åŠ¨ Registry&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker run -d -p 5000:5000 --restart&lt;span class="o">=&lt;/span>always --name registry registry:2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å°†å­èŠ‚ç‚¹åŠ å…¥åˆ° Swarm&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker swarm join &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--token &lt;span class="si">${&lt;/span>&lt;span class="nv">TOKEN&lt;/span>&lt;span class="si">}&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>10.196.108.176:2377
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å¸¸ç”¨é…ç½®">å¸¸ç”¨é…ç½®&lt;/h2>
&lt;h3 id="ä»£ç†">ä»£ç†&lt;/h3>
&lt;p>é‰´äºŽ gcr åŸŸåçš„ä¸å¯ç”¨ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨ &lt;a href="https://hub.docker.com/r/bluebu/shadowsocks-privoxy/" target="_blank" rel="noopener">ss-privoxy&lt;/a> ç­‰å·¥å…·æ­å»º Docker æºä»£ç†ï¼Œä¹Ÿå¯ä»¥å‚è€ƒ&lt;a href="https://www.jianshu.com/p/13f4b23824d8" target="_blank" rel="noopener">è¿™é‡Œ&lt;/a>æ‰‹åŠ¨é…ç½®å®¢æˆ·ç«¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ docker run -i -t -e &lt;span class="nv">SERVER_ADDR&lt;/span>&lt;span class="o">=&lt;/span>ss.server.ip -e &lt;span class="nv">SERVER_PORT&lt;/span>&lt;span class="o">=&lt;/span>port -e &lt;span class="nv">PASSWORD&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">123456&lt;/span> bluebu/shadowsocks-privoxy
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æžœéœ€è¦æ‰‹åŠ¨å®‰è£…ï¼Œéœ€è¦å…ˆå®‰è£… sslocal å‘½ä»¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ apt install python3-pip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ pip3 install https://github.com/shadowsocks/shadowsocks/archive/master.zip -U
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å†™å…¥ä½ çš„é…ç½®æ–‡ä»¶åˆ°ä¾‹å¦‚ &lt;code>config.json&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;server&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;...&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;server_port&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="err">...&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;local_port&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1080&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;password&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;...&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;method&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;chacha20-ietf-poly1305&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;timeout&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">600&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯åŠ¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ sslocal -c config.json
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™æ—¶ä¸€ä¸ª socks5 ä»£ç†åœ¨ä½ æœ¬æœºå°±å¯åŠ¨äº†ã€‚ä¸‹é¢å®‰è£…é…ç½® privoxy æŠŠä»–è½¬æˆ http/https ä»£ç†ã€‚å®‰è£…ç•¥ã€‚ä¿®æ”¹/æ·»åŠ ä¸¤ä¸ª privoxy çš„é…ç½®(å¯¹äºŽ ubuntu, åœ¨ /etc/privoxy/config)ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>listen-address 0.0.0.0:8118 # æ‰€æœ‰ interface ä¸Šç›‘å¬æµé‡
forward-socks5 / 127.0.0.1:1080 . # æµé‡å¯¼å‘æœ¬æœºä¸Šçš„ ss ä»£ç†
&lt;/code>&lt;/pre>&lt;p>è¿™æ—¶å¯ä»¥è®¿é—®ä¸€ä¸‹ä¸å­˜åœ¨çš„ç½‘ç«™æµ‹è¯•ä¸€ä¸‹ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>HTTP_PROXY=127.0.0.1:8118 HTTPS_PROXY=127.0.0.1:8118 curl https://www.google.com
&lt;/code>&lt;/pre>&lt;p>ä¸‹é¢ä¿®æ”¹å„å°æœºå™¨çš„ docker é…ç½®(å‡å®šæˆ‘ä»¬çš„ master å†…ç½‘åœ°å€ &lt;code>1.1.1.2&lt;/code>, å…¶ä»–ä¸¤å°æœºå™¨åœ°å€ä¸º &lt;code>1.1.1.3&lt;/code> å’Œ &lt;code>1.1.1.4&lt;/code>)ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>[Environment]
Environment=&amp;#34;HTTP_PROXY=127.0.0.1:8118&amp;#34; &amp;#34;HTTPS_PROXY=127.0.0.1:8118&amp;#34; &amp;#34;NO_PROXY=localhost,127.0.0.1,1.1.1.2,1.1.1.3,1.1.1.4&amp;#34;
...
&lt;/code>&lt;/pre>&lt;p>çŽ¯å¢ƒå˜é‡ &lt;code>NO_PROXY&lt;/code> é¡¾åæ€ä¹‰ï¼Œå®ƒä¸æ”¯æŒ CIDR åº”è¯¥ï¼Œæ‰€ä»¥éœ€è¦ä½ æžšä¸¾ä¸€ä¸‹é›†ç¾¤ä¸»æœºåœ°å€ã€‚&lt;/p>
&lt;h3 id="å­˜å‚¨ä¸Žæ—¥å¿—">å­˜å‚¨ä¸Žæ—¥å¿—&lt;/h3>
&lt;p>çº¿ä¸Šç³»ç»Ÿä¸­æˆ‘ä»¬å¾€å¾€ä¹Ÿéœ€è¦å¯¹äºŽ Docker äº§ç”Ÿçš„&lt;/p>
&lt;h1 id="é•œåƒ">é•œåƒ&lt;/h1>
&lt;p>é•œåƒæè¿°äº† Docker å®¹å™¨è¿è¡Œçš„åˆå§‹æ–‡ä»¶ç³»ç»Ÿ, åŒ…å«è¿è¡Œåº”ç”¨æ‰€éœ€çš„æ‰€æœ‰ä¾èµ–ã€‚å³å¯ä»¥æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿ, ä¹Ÿå¯ä»¥ä»…åŒ…å«åº”ç”¨æ‰€éœ€çš„æœ€å° bin/lib æ–‡ä»¶é›†åˆã€‚Docker é•œåƒå’Œå®¹å™¨é‡‡ç”¨åˆ†å±‚æ–‡ä»¶ç³»ç»Ÿç»“æž„, æ¯ä¸ªå®¹å™¨åŒ…å«ä¸€å±‚è–„è–„çš„å¯å†™å±‚, åªè¯»éƒ¨åˆ†æ˜¯å…±äº«çš„ï¼Œè¿™ç§æœºåˆ¶ä¿è¯äº†èµ„æºçš„å¯å¤ç”¨æ€§ï¼Œå‡å°‘äº†é•œåƒä¸Žå®¹å™¨çš„ç©ºé—´å ç”¨ã€‚Docker é•œåƒå­˜å‚¨å¼•æ“Žæœ‰ aufs, devicemapper, overlay ç­‰å¤šç§å®žçŽ°ã€‚&lt;/p>
&lt;h2 id="æž„å»ºä¸Žæ‹‰å–">æž„å»ºä¸Žæ‹‰å–&lt;/h2>
&lt;p>ç¼–å†™å®Œæˆ Dockerfile ä¹‹åŽï¼Œå¯ä»¥é€šè¿‡ &lt;code>docker build&lt;/code> å‘½ä»¤æ¥åˆ›å»ºé•œåƒï¼›å…³äºŽ Dockfile çš„å…·ä½“è¯­æ³•ï¼Œå¯ä»¥æŸ¥çœ‹ä¸‹æ–‡ã€‚Dockfile åŸºæœ¬çš„æ ¼å¼ä¸º &lt;code>docker build [ é€‰é¡¹ ] è·¯å¾„&lt;/code>ï¼Œè¯¥å‘½ä»¤å°†è¯»å–æŒ‡å®šè·¯å¾„ä¸‹(åŒ…æ‹¬å­ç›®å½•)çš„ Dockerfileï¼Œå¹¶å°†è¯¥è·¯å¾„ä¸‹æ‰€æœ‰å†…å®¹å‘é€ç»™ Docker æœåŠ¡ç«¯ï¼Œç”±æœåŠ¡ç«¯æ¥åˆ›å»ºé•œåƒã€‚å› æ­¤ä¸€èˆ¬å»ºè®®æ”¾ç½® Dockerfile çš„ç›®å½•ä¸ºç©ºç›®å½•ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ &lt;code>.dockerignore&lt;/code> æ–‡ä»¶(æ¯ä¸€è¡Œæ·»åŠ ä¸€æ¡åŒ¹é…æ¨¡å¼)æ¥è®© Docker å¿½ç•¥è·¯å¾„ä¸‹çš„ç›®å½•å’Œæ–‡ä»¶ã€‚&lt;/p>
&lt;p>é•œåƒçš„å®Œæ•´ tag ä¸ä»…åŒ…å«é•œåƒåå­—, è¿˜æŒ‡æ˜Žäº†é•œåƒä»Žå“ªé‡Œæ¥, è¦åˆ°å“ªé‡ŒåŽ», å°±åƒä¸€ä¸ª URLã€‚å¯ä»¥é€šè¿‡ &lt;code>-t&lt;/code> é€‰é¡¹æŒ‡å®šé•œåƒçš„æ ‡ç­¾ä¿¡æ¯ï¼Œè­¬å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ sudo docker build -t myrepo/myapp /tmp/test1/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker build -t username/image_name:tag_name .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker tag SOURCE_IMAGE&lt;span class="o">[&lt;/span>:TAG&lt;span class="o">]&lt;/span> TARGET_IMAGE&lt;span class="o">[&lt;/span>:TAG&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Docker æ”¯æŒä»Ž Registry æ‹‰å–é•œåƒï¼Œæˆ–è€…å°†æŸä¸ªå®¹å™¨ä¿å­˜ä¸ºé•œåƒï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ‹‰å–é•œåƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker pull image_name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å°†æŸä¸ªå®¹å™¨ä¿å­˜ä¸ºé•œåƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker commit -m â€œcommit messageâ€ -a â€œauthorâ€ container_name username/image_name:tag
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Docker æ”¯æŒå°†é•œåƒä¿å­˜ä¸ºæ–‡ä»¶ï¼Œä»¥æ–¹ä¾¿é•œåƒçš„å¯¼å‡ºä¸ŽåŠ è½½ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¿å­˜é•œåƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker save --output saved-image.tar my-image:1.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker save my-image:1.0.0 &amp;gt; saved-image.tar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker save my_image:my_tag &lt;span class="p">|&lt;/span> gzip &amp;gt; my_image.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¯¼å…¥é•œåƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker load --input saved-image.tar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker load &amp;lt; saved-image.tar
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="é•œåƒç®¡ç†">é•œåƒç®¡ç†&lt;/h2>
&lt;p>&lt;code>docker images&lt;/code> å‘½ä»¤ä¼šåˆ—ä¸¾å‡ºå…¨éƒ¨çš„é•œåƒ:&lt;/p>
&lt;pre tabindex="0">&lt;code>$ docker images
REPOSITORY TAG IMAGE ID CREATED VIRTUAL SIZE
mynewimage latest 4d2eab1c0b9a 5 minutes ago 278.1 MB
ubuntu 14.04 ad892dd21d60 11 days ago 275.5 MB
&amp;lt;none&amp;gt; &amp;lt;none&amp;gt; 6b0a59aa7c48 11 days ago 169.4 MB
&amp;lt;none&amp;gt; &amp;lt;none&amp;gt; 6cfa4d1f33fb 7 weeks ago 0 B
&lt;/code>&lt;/pre>&lt;p>Docker ä¸­é•œåƒä¸»è¦åˆ†ä¸ºä¸‰ç§çŠ¶æ€:&lt;/p>
&lt;ul>
&lt;li>å·²ä½¿ç”¨é•œåƒ(used image): æŒ‡æ‰€æœ‰å·²è¢«å®¹å™¨ï¼ˆåŒ…æ‹¬å·²åœæ­¢çš„ï¼‰å…³è”çš„é•œåƒã€‚å³ docker ps -a çœ‹åˆ°çš„æ‰€æœ‰å®¹å™¨ä½¿ç”¨çš„é•œåƒã€‚&lt;/li>
&lt;li>æœªå¼•ç”¨é•œåƒ(unreferenced image): æ²¡æœ‰è¢«åˆ†é…æˆ–ä½¿ç”¨åœ¨å®¹å™¨ä¸­çš„é•œåƒï¼Œä½†å®ƒæœ‰ Tag ä¿¡æ¯ã€‚&lt;/li>
&lt;li>æ‚¬ç©ºé•œåƒ(dangling image): æœªé…ç½®ä»»ä½• Tagï¼ˆä¹Ÿå°±æ— æ³•è¢«å¼•ç”¨ï¼‰çš„é•œåƒï¼Œæ‰€ä»¥æ‚¬ç©ºã€‚è¿™é€šå¸¸æ˜¯ç”±äºŽé•œåƒ build çš„æ—¶å€™æ²¡æœ‰æŒ‡å®š -t å‚æ•°é…ç½® Tag å¯¼è‡´çš„ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ—ä¸¾æœªä½¿ç”¨çš„&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker images --filter &lt;span class="s2">&amp;#34;dangling=true&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ é™¤æ‰€æœ‰æ— ç”¨çš„é•œåƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker rmi &lt;span class="k">$(&lt;/span>docker images -q -f &lt;span class="nv">dangling&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="dockfile">Dockfile&lt;/h2>
&lt;p>Dockerfile ç”±ä¸€è¡Œè¡Œå‘½ä»¤è¯­å¥ç»„æˆï¼Œå¹¶ä¸”æ”¯æŒä»¥ &lt;code>#&lt;/code> å¼€å¤´çš„æ³¨é‡Šè¡Œã€‚ä¸€èˆ¬çš„ï¼ŒDockerfile åˆ†ä¸ºå››éƒ¨åˆ†ï¼šåŸºç¡€é•œåƒä¿¡æ¯ã€ç»´æŠ¤è€…ä¿¡æ¯ã€é•œåƒæ“ä½œæŒ‡ä»¤å’Œå®¹å™¨å¯åŠ¨æ—¶æ‰§è¡ŒæŒ‡ä»¤ï¼›æŒ‡ä»¤çš„ä¸€èˆ¬æ ¼å¼ä¸º &lt;code>INSTRUCTION arguments&lt;/code>ï¼ŒæŒ‡ä»¤åŒ…æ‹¬ &lt;code>FROM&lt;/code>ã€&lt;code>MAINTAINER&lt;/code>ã€&lt;code>RUN&lt;/code> ç­‰ã€‚ä¾‹å¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># MongoDB Dockerfile&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># https://github.com/dockerfile/mongodb&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Pull base image.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">FROM dockerfile/ubuntu
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ENV SOURCE http://downloads-distro.mongodb.org/repo/ubuntu-upstart
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Install MongoDB.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RUN &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 7F0CEB10 &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;deb $SOURCE dist 10gen&amp;#39;&lt;/span> &amp;gt; /etc/apt/sources.list.d/mongodb.list &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> apt-get update &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> apt-get install -y mongodb-org &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> rm -rf /var/lib/apt/lists/*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ENV PATH /usr/local/mongo/bin:&lt;span class="nv">$PATH&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Define mountable directories.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VOLUME &lt;span class="o">[&lt;/span>&lt;span class="s2">&amp;#34;/data/db&amp;#34;&lt;/span>&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Define working directory.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WORKDIR /data
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Define default command.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CMD &lt;span class="o">[&lt;/span>&lt;span class="s2">&amp;#34;mongod&amp;#34;&lt;/span>&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Expose ports.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># - 27017: process&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># - 28017: http&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">EXPOSE &lt;span class="m">27017&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">EXPOSE &lt;span class="m">28017&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å…¶ä¸­ï¼Œä¸€å¼€å§‹å¿…é¡»æŒ‡æ˜Žæ‰€åŸºäºŽçš„é•œåƒåç§°ï¼ŒæŽ¥ä¸‹æ¥æŽ¨èè¯´æ˜Žç»´æŠ¤è€…ä¿¡æ¯ã€‚åŽé¢åˆ™æ˜¯é•œåƒæ“ä½œæŒ‡ä»¤ï¼Œä¾‹å¦‚ &lt;code>RUN&lt;/code> æŒ‡ä»¤ï¼Œ&lt;code>RUN&lt;/code> æŒ‡ä»¤å°†å¯¹é•œåƒæ‰§è¡Œè·Ÿéšçš„å‘½ä»¤ã€‚æ¯è¿è¡Œä¸€æ¡ &lt;code>RUN&lt;/code> æŒ‡ä»¤ï¼Œé•œåƒæ·»åŠ æ–°çš„ä¸€å±‚ï¼Œå¹¶æäº¤ã€‚æœ€åŽæ˜¯ &lt;code>CMD&lt;/code> æŒ‡ä»¤ï¼Œæ¥æŒ‡å®šè¿è¡Œå®¹å™¨æ—¶çš„æ“ä½œå‘½ä»¤ã€‚&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æŒ‡ä»¤å&lt;/th>
&lt;th>æ ¼å¼&lt;/th>
&lt;th>æè¿°&lt;/th>
&lt;th>å¤‡æ³¨&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>FROM&lt;/td>
&lt;td>æ ¼å¼ä¸º &lt;code>FROM &amp;lt;image&amp;gt;&lt;/code>æˆ–&lt;code>FROM &amp;lt;image&amp;gt;:&amp;lt;tag&amp;gt;&lt;/code>&lt;/td>
&lt;td>ç¬¬ä¸€æ¡æŒ‡ä»¤å¿…é¡»ä¸º &lt;code>FROM&lt;/code> æŒ‡ä»¤&lt;/td>
&lt;td>å¦‚æžœåœ¨åŒä¸€ä¸ª Dockerfile ä¸­åˆ›å»ºå¤šä¸ªé•œåƒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ª &lt;code>FROM&lt;/code> æŒ‡ä»¤(æ¯ä¸ªé•œåƒä¸€æ¬¡)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>MAINTAINER&lt;/td>
&lt;td>æ ¼å¼ä¸º &lt;code>MAINTAINER &amp;lt;name&amp;gt;&lt;/code>&lt;/td>
&lt;td>æŒ‡å®šç»´æŠ¤è€…ä¿¡æ¯ï¼Œ&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>RUN&lt;/td>
&lt;td>&lt;code>RUN &amp;lt;command&amp;gt;&lt;/code>æˆ–&lt;code>RUN [&amp;quot;executable&amp;quot;, &amp;quot;param1&amp;quot;, &amp;quot;param2&amp;quot;]&lt;/code>&lt;/td>
&lt;td>å‰è€…å°†åœ¨ shell ç»ˆç«¯ä¸­è¿è¡Œå‘½ä»¤ï¼Œå³ &lt;code>/bin/sh -c&lt;/code>ï¼›åŽè€…åˆ™ä½¿ç”¨ &lt;code>exec&lt;/code> æ‰§è¡Œã€‚æŒ‡å®šä½¿ç”¨å…¶å®ƒç»ˆç«¯å¯ä»¥é€šè¿‡ç¬¬äºŒç§æ–¹å¼å®žçŽ°ï¼Œä¾‹å¦‚ &lt;code>RUN [&amp;quot;/bin/bash&amp;quot;, &amp;quot;-c&amp;quot;, &amp;quot;echo hello&amp;quot;]&lt;/code>&lt;/td>
&lt;td>æ¯æ¡ &lt;code>RUN&lt;/code> æŒ‡ä»¤å°†åœ¨å½“å‰é•œåƒåŸºç¡€ä¸Šæ‰§è¡ŒæŒ‡å®šå‘½ä»¤ï¼Œå¹¶æäº¤ä¸ºæ–°çš„é•œåƒã€‚å½“å‘½ä»¤è¾ƒé•¿æ—¶å¯ä»¥ä½¿ç”¨ &lt;code>\&lt;/code> æ¥æ¢è¡Œï¼Œ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>CMD&lt;/td>
&lt;td>æ”¯æŒä¸‰ç§æ ¼å¼,&lt;code>CMD [&amp;quot;executable&amp;quot;,&amp;quot;param1&amp;quot;,&amp;quot;param2&amp;quot;]&lt;/code> ä½¿ç”¨ &lt;code>exec&lt;/code> æ‰§è¡Œï¼ŒæŽ¨èæ–¹å¼ï¼›&lt;code>CMD command param1 param2&lt;/code> åœ¨ &lt;code>/bin/sh&lt;/code> ä¸­æ‰§è¡Œï¼Œæä¾›ç»™éœ€è¦äº¤äº’çš„åº”ç”¨ï¼›&lt;code>CMD [&amp;quot;param1&amp;quot;,&amp;quot;param2&amp;quot;]&lt;/code> æä¾›ç»™ &lt;code>ENTRYPOINT&lt;/code> çš„é»˜è®¤å‚æ•°ï¼›&lt;/td>
&lt;td>æŒ‡å®šå¯åŠ¨å®¹å™¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ¯ä¸ª Dockerfile åªèƒ½æœ‰ä¸€æ¡ &lt;code>CMD&lt;/code> å‘½ä»¤ã€‚å¦‚æžœæŒ‡å®šäº†å¤šæ¡å‘½ä»¤ï¼Œåªæœ‰æœ€åŽä¸€æ¡ä¼šè¢«æ‰§è¡Œã€‚å¦‚æžœç”¨æˆ·å¯åŠ¨å®¹å™¨æ—¶å€™æŒ‡å®šäº†è¿è¡Œçš„å‘½ä»¤ï¼Œåˆ™ä¼šè¦†ç›–æŽ‰ &lt;code>CMD&lt;/code> æŒ‡å®šçš„å‘½ä»¤&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>EXPOSE&lt;/td>
&lt;td>&lt;code>EXPOSE &amp;lt;port&amp;gt; [&amp;lt;port&amp;gt;...]&lt;/code>&lt;/td>
&lt;td>å‘Šè¯‰ Docker æœåŠ¡ç«¯å®¹å™¨æš´éœ²çš„ç«¯å£å·ï¼Œä¾›äº’è”ç³»ç»Ÿä½¿ç”¨&lt;/td>
&lt;td>åœ¨å¯åŠ¨å®¹å™¨æ—¶éœ€è¦é€šè¿‡ -p æ¥æŒ‡å®šç«¯å£æ˜ å°„ï¼ŒDocker ä¸»æœºä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç«¯å£è½¬å‘åˆ°æŒ‡å®šçš„ç«¯å£&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ENV&lt;/td>
&lt;td>&lt;code>ENV&amp;lt;key&amp;gt;&amp;lt;value&amp;gt;&lt;/code>ã€‚æŒ‡å®šä¸€ä¸ªçŽ¯å¢ƒå˜é‡ï¼Œä¼šè¢«åŽç»­ &lt;code>RUN&lt;/code> æŒ‡ä»¤ä½¿ç”¨ï¼Œå¹¶åœ¨å®¹å™¨è¿è¡Œæ—¶ä¿æŒ&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ADD&lt;/td>
&lt;td>&lt;code>ADD&amp;lt;src&amp;gt;&amp;lt;dest&amp;gt;&lt;/code>&lt;/td>
&lt;td>è¯¥å‘½ä»¤å°†å¤åˆ¶æŒ‡å®šçš„ &lt;code>&amp;lt;src&amp;gt;&lt;/code> åˆ°å®¹å™¨ä¸­çš„ &lt;code>&amp;lt;dest&amp;gt;&lt;/code>ï¼Œ&lt;/td>
&lt;td>&lt;code>&amp;lt;src&amp;gt;&lt;/code> å¯ä»¥æ˜¯ Dockerfile æ‰€åœ¨ç›®å½•çš„ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼›ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª URLï¼›è¿˜å¯ä»¥æ˜¯ä¸€ä¸ª tar æ–‡ä»¶(è‡ªåŠ¨è§£åŽ‹ä¸ºç›®å½•)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>COPY&lt;/td>
&lt;td>&lt;code>COPY &amp;lt;src&amp;gt;&amp;lt;dest&amp;gt;&lt;/code>&lt;/td>
&lt;td>å¤åˆ¶æœ¬åœ°ä¸»æœºçš„ &lt;code>&amp;lt;src&amp;gt;&lt;/code>(ä¸º Dockerfile æ‰€åœ¨ç›®å½•çš„ç›¸å¯¹è·¯å¾„)åˆ°å®¹å™¨ä¸­çš„ &lt;code>dest&lt;/code>&lt;/td>
&lt;td>å½“ä½¿ç”¨æœ¬åœ°ç›®å½•ä¸ºæºç›®å½•æ—¶ï¼ŒæŽ¨èä½¿ç”¨ &lt;code>COPY&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>ENTRYPOINT&lt;/td>
&lt;td>&lt;code>ENTRYPOINT [&amp;quot;executable&amp;quot;, &amp;quot;param1&amp;quot;, &amp;quot;param2&amp;quot;]&lt;/code>ï¼Œä½¿ç”¨æŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶æ‰§è¡Œï¼›&lt;code>ENTRYPOINT command param1 param2&lt;/code>ï¼Œä¼šåœ¨ Shell ä¸­æ‰§è¡Œ&lt;/td>
&lt;td>é…ç½®å®¹å™¨å¯åŠ¨åŽæ‰§è¡Œçš„å‘½ä»¤ï¼Œå¹¶ä¸”ä¸å¯è¢« &lt;code>docker run&lt;/code> æä¾›çš„å‚æ•°è¦†ç›–ã€‚æ¯ä¸ª Dockerfile ä¸­åªèƒ½æœ‰ä¸€ä¸ª &lt;code>ENTRYPOINT&lt;/code>ï¼Œå½“æŒ‡å®šå¤šä¸ªæ—¶ï¼Œåªæœ‰æœ€åŽä¸€ä¸ªèµ·æ•ˆï¼Œ&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>VOLUME&lt;/td>
&lt;td>&lt;code>VOLUME [&amp;quot;/data&amp;quot;]&lt;/code>&lt;/td>
&lt;td>åˆ›å»ºä¸€ä¸ªå¯ä»¥ä»Žæœ¬åœ°ä¸»æœºæˆ–å…¶ä»–å®¹å™¨æŒ‚è½½çš„æŒ‚è½½ç‚¹ï¼Œä¸€èˆ¬ç”¨æ¥å­˜æ”¾æ•°æ®åº“å’Œéœ€è¦ä¿æŒçš„æ•°æ®ç­‰&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>USER&lt;/td>
&lt;td>&lt;code>USER daemon&lt;/code>&lt;/td>
&lt;td>æŒ‡å®šè¿è¡Œå®¹å™¨æ—¶çš„ç”¨æˆ·åæˆ– UIDï¼ŒåŽç»­çš„ &lt;code>RUN&lt;/code> ä¹Ÿä¼šä½¿ç”¨æŒ‡å®šç”¨æˆ·&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>WORKDIR&lt;/td>
&lt;td>&lt;code>WORKDIR /path/to/workdir&lt;/code>&lt;/td>
&lt;td>ä¸ºåŽç»­çš„ &lt;code>RUN&lt;/code>ã€&lt;code>CMD&lt;/code>ã€&lt;code>ENTRYPOINT&lt;/code> æŒ‡ä»¤é…ç½®å·¥ä½œç›®å½•&lt;/td>
&lt;td>å¯ä»¥ä½¿ç”¨å¤šä¸ª &lt;code>WORKDIR&lt;/code> æŒ‡ä»¤ï¼ŒåŽç»­å‘½ä»¤å¦‚æžœå‚æ•°æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåˆ™ä¼šåŸºäºŽä¹‹å‰å‘½ä»¤æŒ‡å®šçš„è·¯å¾„&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>å½“æœåŠ¡ä¸éœ€è¦ç®¡ç†å‘˜æƒé™æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æŒ‡å®šè¿è¡Œç”¨æˆ·ã€‚å¹¶ä¸”å¯ä»¥åœ¨ä¹‹å‰åˆ›å»ºæ‰€éœ€è¦çš„ç”¨æˆ·ï¼Œä¾‹å¦‚ï¼š&lt;code>RUN groupadd -r postgres &amp;amp;&amp;amp; useradd -r -g postgres postgres&lt;/code>ï¼›è¦ä¸´æ—¶èŽ·å–ç®¡ç†å‘˜æƒé™å¯ä»¥ä½¿ç”¨ &lt;code>gosu&lt;/code>ï¼Œè€Œä¸æŽ¨è &lt;code>sudo&lt;/code>ã€‚&lt;/p>
&lt;p>RUNã€CMD å’Œ ENTRYPOINT è¿™ä¸‰ä¸ª Dockerfile æŒ‡ä»¤çœ‹ä¸ŠåŽ»å¾ˆç±»ä¼¼ï¼Œå¾ˆå®¹æ˜“æ··æ·†ã€‚RUN æ‰§è¡Œå‘½ä»¤å¹¶åˆ›å»ºæ–°çš„é•œåƒå±‚ï¼ŒRUN ç»å¸¸ç”¨äºŽå®‰è£…è½¯ä»¶åŒ…ã€‚CMD è®¾ç½®å®¹å™¨å¯åŠ¨åŽé»˜è®¤æ‰§è¡Œçš„å‘½ä»¤åŠå…¶å‚æ•°ï¼Œä½† CMD èƒ½å¤Ÿè¢« docker run åŽé¢è·Ÿçš„å‘½ä»¤è¡Œå‚æ•°æ›¿æ¢ã€‚ENTRYPOINT é…ç½®å®¹å™¨å¯åŠ¨æ—¶è¿è¡Œçš„å‘½ä»¤ã€‚æˆ‘ä»¬ç»å¸¸å¯ä»¥ä½¿ç”¨ ENTRYPOINT æŒ‡å®šå›ºå®šå‘½ä»¤ï¼Œä½¿ç”¨ CMD åŠ¨æ€ä¼ å…¥å‚æ•°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-Dockerfile" data-lang="Dockerfile">&lt;span class="line">&lt;span class="cl">&lt;span class="k">ENTRYPOINT&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;/bin/echo&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Hello&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">CMD&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;world&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="c"># docker run -it &amp;lt;image&amp;gt;&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="c"># Hello world&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="c"># docker run -it &amp;lt;image&amp;gt; John&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="c"># Hello John&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Docker æŽ¨èçš„æ˜¯å•ä¸ªå®¹å™¨æ‰§è¡Œå•ä¸ªä»»åŠ¡çš„å…³æ³¨ç‚¹åˆ†ç¦»ç­–ç•¥ï¼Œå®¹å™¨çš„ä¸»è¿›ç¨‹ä¼šè´Ÿè´£ç®¡ç†æ‰€æœ‰çš„å­è¿›ç¨‹ã€‚å¦‚æžœæˆ‘ä»¬æœªåœ¨è‡ªå®šä¹‰åˆå§‹åŒ–è„šæœ¬ä¸­è€ƒè™‘å¤ªå¤šå­è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„æ“ä½œï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ &lt;code>--init&lt;/code> å‚æ•°æ¥å…è®¸ Docker è‡ªåŠ¨æ³¨å…¥ init è¿›ç¨‹ä½œä¸ºä¸»è¿›ç¨‹ï¼Œå…¶ä¼šåœ¨å®¹å™¨å…³é—­æ—¶å€™è‡ªåŠ¨å¤„ç†æ‰€æœ‰çš„æ´¾ç”Ÿçš„å­è¿›ç¨‹ï¼Œå¹¶ä¸”ç›¸å¯¹äºŽå®Œæ•´çš„ sysvinit æˆ–è€… systemd æ›´ä¸ºè½»é‡çº§ã€‚å¦‚æžœæˆ‘ä»¬å¸Œæœ›åœ¨å•ä¸ªå®¹å™¨ä¸­è¿è¡Œå¤šä¸ªè¿›ç¨‹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ supervisord æˆ–è€…&lt;a href="https://docs.docker.com/config/containers/multi-service_container/" target="_blank" rel="noopener">è‡ªå®šä¹‰è„šæœ¬&lt;/a>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-Dockerfile" data-lang="Dockerfile">&lt;span class="line">&lt;span class="cl">&lt;span class="k">FROM&lt;/span>&lt;span class="s"> ubuntu:latest&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> apt-get update &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> apt-get install -y supervisor&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> mkdir -p /var/log/supervisor&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">COPY&lt;/span> supervisord.conf /etc/supervisor/conf.d/supervisord.conf&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">COPY&lt;/span> my_first_process my_first_process&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">COPY&lt;/span> my_second_process my_second_process&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">CMD&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;/usr/bin/supervisord&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="registry">Registry&lt;/h2>
&lt;p>Docker å…è®¸æˆ‘ä»¬å»ºç«‹ç§æœ‰çš„ Registry æ¥å­˜æ”¾äºŽç®¡ç†é•œåƒï¼Œç›´æŽ¥è¿è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯åˆ›å»ºç§æœ‰ Registryï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ docker run -d -p 5000:5000 --restart&lt;span class="o">=&lt;/span>always --name registry registry:2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å‚è€ƒä¸Šæ–‡æè¿°æˆ‘ä»¬å¯çŸ¥ï¼Œé•œåƒåçš„å‰ç¼€å³è¡¨ç¤ºè¯¥é•œåƒæ‰€å±žçš„ Registry åœ°å€ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ tag æ–¹å¼å°†æŸä¸ªé•œåƒæŽ¨é€åˆ°ç§æœ‰ä»“åº“ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ‹‰å–å…¬å…±é•œåƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker pull ubuntu:16.04
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¸ºé•œåƒæ·»åŠ  Registry ä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker tag ubuntu:16.04 custom-domain:5000/my-ubuntu
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å°†å…¶æŽ¨é€åˆ°ç§æœ‰é•œåƒåº“&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker push custom-domain:5000/my-ubuntu
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä»Žç§æœ‰é•œåƒåº“ä¸­æ‹‰å–é•œåƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker pull custom-domain:5000/my-ubuntu
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®šé•œåƒåº“çš„å­˜æ”¾åœ°å€ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">-v /mnt/registry:/var/lib/registry
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬çš„å†…éƒ¨ä»“åº“å¹¶ä¸ä¼šé…ç½® HTTPSï¼Œå¦‚æžœå¸Œæœ›ä»¥ HTTP æ–¹å¼è®¿é—®ï¼Œé‚£ä¹ˆéœ€è¦åœ¨ä»»ä½•éœ€è¦æŽ¨é€/æ‹‰å–é•œåƒçš„æœºå™¨ä¸Šé…ç½®éžå®‰å…¨åŸŸåï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span> &lt;span class="nt">&amp;#34;insecure-registries&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;myregistry.example.com:5000&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸ºç§æœ‰ä»“åº“é…ç½®æƒé™è®¤è¯ï¼Œé‚£ä¹ˆé¦–å…ˆéœ€è¦æ·»åŠ  TLS æ”¯æŒï¼Œå¹¶ä¸”é…ç½®è®¤è¯æ–‡ä»¶ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ mkdir auth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker run &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --entrypoint htpasswd &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> registry:2 -Bbn cscan cscancscan &amp;gt; ~/auth/htpasswd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ openssl req -new -newkey rsa:4096 -days &lt;span class="m">365&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -subj &lt;span class="s2">&amp;#34;/CN=localhost&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -nodes -x509 &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -keyout ~/certs/domain.key &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -out ~/certs/domain.crt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åŽå¯ä»¥ä½¿ç”¨ Compose æ–‡ä»¶æ¥æè¿°æ‰€éœ€è¦çš„ TLS ä»¥åŠ AUTH å‚æ•°ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">registry-srv&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">restart&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">always&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">registry:2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="m">5000&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">5000&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">environment&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">REGISTRY_HTTP_TLS_CERTIFICATE&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/certs/domain.crt&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">REGISTRY_HTTP_TLS_KEY&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/certs/domain.key&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">REGISTRY_AUTH&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">htpasswd&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">REGISTRY_AUTH_HTPASSWD_PATH&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/auth/htpasswd&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">REGISTRY_AUTH_HTPASSWD_REALM&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Registry Realm&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">/opt/registry:/var/lib/registry&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">~/certs:/certs&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">~/auth:/auth&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŽ¥ä¸‹æ¥ä½¿ç”¨ Docker Compose å‘½ä»¤å¯åŠ¨æœåŠ¡ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ docker-compose up -d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç™»å½•åˆ°é•œåƒæœåŠ¡å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker login myregistrydomain.com:5000
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="å¤šé˜¶æ®µæž„å»º">å¤šé˜¶æ®µæž„å»º&lt;/h2>
&lt;p>éšç€ 17.05 ç‰ˆæœ¬çš„å‘å¸ƒï¼ŒDocker å¯¹äºŽé•œåƒæž„å»ºè¿™å—ä¹Ÿä½œäº†ä¸€é¡¹é‡è¦æ›´æ–°ï¼Œé‚£å°±æ˜¯ multi-stage buildï¼ˆå¤šé˜¶æ®µæž„å»ºï¼‰ï¼Œè¿™æœ‰åŠ©äºŽæ–¹ä¾¿æºä»£ç æŽ§åˆ¶ï¼Œå‡å°é•œåƒä½“ç§¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-Dockerfile" data-lang="Dockerfile">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># First stage: complete build environment&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="s"> maven:3.5.0-jdk-8-alpine AS builder&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="c"># add pom.xml and source code&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">ADD&lt;/span> ./pom.xml pom.xml&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">ADD&lt;/span> ./src src/&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="c"># package jar&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> mvn clean package&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="c"># Second stage: minimal runtime environment&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">From&lt;/span>&lt;span class="s"> openjdk:8-jre-alpine&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="c"># copy jar from the first stage&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">COPY&lt;/span> --from&lt;span class="o">=&lt;/span>builder target/msb-1.0.jar msb.jar&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="c"># run jar&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">CMD&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;java&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;-jar&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;msb.jar&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯¹äºŽ multi-stage buildï¼Œå…¶å…³é”®ç‚¹ä¸»è¦æœ‰ä¸¤ç‚¹ï¼š&lt;/p>
&lt;p>åœ¨å‰é¢é˜¶æ®µçš„ FROM æŒ‡ä»¤åŽé¢å¢žåŠ äº†ä¸€ä¸ª AS å‚æ•°ï¼Œå¯ä¸ºè¯¥æž„å»ºé˜¶æ®µå‘½åï¼Œä¾¿äºŽåŽç»­æž„å»ºé˜¶æ®µå¼•ç”¨ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>FROM image[:tag | @digest] AS stage
&lt;/code>&lt;/pre>&lt;p>åœ¨åŽç»­é˜¶æ®µçš„ COPY æŒ‡ä»¤åŽé¢å¢žåŠ äº†&amp;ndash;from å‚æ•°ï¼ŒæŒ‡æ˜Žå¼•ç”¨å‰é¢å“ªä¸€ä¸ªæž„å»ºé˜¶æ®µçš„æˆæžœï¼Œæ ¼å¼å¦‚ä¸‹ï¼š&lt;/p>
&lt;pre tabindex="0">&lt;code>COPY --from=stage ...
&lt;/code>&lt;/pre>&lt;p>åŒç†ï¼Œå¤šé˜¶æ®µæž„å»ºåŒæ ·å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å°†å¤šä¸ªå½¼æ­¤ä¾èµ–çš„é¡¹ç›®é€šè¿‡ä¸€ä¸ª Dockerfile å°±å¯è½»æ¾æž„å»ºå‡ºæœŸæœ›çš„å®¹å™¨é•œåƒï¼Œè€Œä¸ç”¨æ‹…å¿ƒé•œåƒå¤ªå¤§ã€æºç æ³„éœ²ç­‰é£Žé™©ã€‚&lt;/p>
&lt;h1 id="å®¹å™¨">å®¹å™¨&lt;/h1>
&lt;p>Docker ä¸­é•œåƒæ˜¯åªè¯»çš„, åˆ›å»ºå®¹å™¨æ—¶åªæ˜¯åœ¨é•œåƒä¸Šé¢æ–°å»ºä¸€ä¸ªå¯å†™å±‚, ä¸éœ€è¦å¤åˆ¶æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿ, å› è€Œå¯ä»¥å®žçŽ°æ¯«ç§’çº§åˆ›å»ºã€‚&lt;/p>
&lt;p>
&lt;figure >
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="https://user-images.githubusercontent.com/5803001/45262735-4f42e400-b44f-11e8-96a0-79c305006be8.png" alt="image" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;/figure>&lt;/p>
&lt;h2 id="å¯åœæŽ§åˆ¶">å¯åœæŽ§åˆ¶&lt;/h2>
&lt;ul>
&lt;li>&lt;code>docker create&lt;/code>: åˆ›å»ºä¸€ä¸ªå®¹å™¨ä½†æ˜¯ä¸å¯åŠ¨ã€‚&lt;/li>
&lt;li>&lt;code>docker rename&lt;/code>: å…è®¸é‡å‘½åå®¹å™¨ã€‚&lt;/li>
&lt;li>&lt;code>docker run&lt;/code>: åœ¨åŒä¸€ä¸ªæ“ä½œä¸­åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨ã€‚&lt;/li>
&lt;li>&lt;code>docker rm&lt;/code>: åˆ é™¤å®¹å™¨ã€‚&lt;/li>
&lt;li>&lt;code>docker update&lt;/code>: æ›´æ–°å®¹å™¨çš„èµ„æºé™åˆ¶ã€‚&lt;/li>
&lt;/ul>
&lt;p>å®¹å™¨ä¼šåœ¨ç»“æŸå‘½ä»¤ä¹‹åŽè‡ªåŠ¨é€€å‡ºï¼Œä½¿ç”¨ä»¥ä¸‹çš„å‘½ä»¤é€‰é¡¹å¯ä»¥å°†å®¹å™¨ä¿æŒåœ¨æ¿€æ´»çŠ¶æ€ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;code>-i&lt;/code> å³ä½¿åœ¨æ²¡æœ‰é™„ç€çš„æƒ…å†µä¸‹ä¾ç„¶ä¿æŒ STDIN å¤„äºŽå¼€å¯ã€‚å•çº¯ä½¿ç”¨ -i å‘½ä»¤æ˜¯ä¸ä¼šå‡ºçŽ° &lt;code>root@689d580b6416:/&lt;/code> è¿™ç§å‰ç¼€&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>-t&lt;/code> åˆ†é…ä¸€ä¸ªä¼ª TTY æŽ§åˆ¶å°&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ›å»ºï¼Œå¹¶ä¸”å¯åŠ¨æŸä¸ªå®¹å™¨ä»¥æ‰§è¡ŒæŸä¸ªå‘½ä»¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker run -ti --name container_name image_name &lt;span class="nb">command&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ›å»ºï¼Œå¯åŠ¨å®¹å™¨æ‰§è¡ŒæŸä¸ªå‘½ä»¤ç„¶åŽåˆ é™¤è¯¥å®¹å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker run --rm -ti image_name &lt;span class="nb">command&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ›å»ºï¼Œå¯åŠ¨å®¹å™¨ï¼Œå¹¶ä¸”æ˜ å°„å·ä¸Žç«¯å£ï¼ŒåŒæ—¶è®¾ç½®çŽ¯å¢ƒå˜é‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker run -it --rm -p 8080:8080 -v /path/to/agent.jar:/agent.jar -e &lt;span class="nv">JAVA_OPTS&lt;/span>&lt;span class="o">=&lt;/span>â€-javaagent:/agent.jarâ€ tomcat:8.0.29-jre8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ›å»ºå®¹å™¨ï¼ŒæŒ‡å®šç½‘ç»œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker run --network&lt;span class="o">=&lt;/span>&amp;lt;NETWORK&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç›´æŽ¥ä½¿ç”¨å®¿ä¸»æœºçš„ç½‘ç»œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker run --rm -d --network host --name my_nginx nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŒ‡å®šæ ‡ç­¾&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker run -l my-label --label com.example.foo&lt;span class="o">=&lt;/span>bar ubuntu bash
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆ›å»ºå®¹å™¨æ—¶ï¼Œå®ƒä¸ä¼šå°†å…¶ä»»ä½•ç«¯å£å‘å¸ƒåˆ°å¤–éƒ¨ä¸–ç•Œã€‚è¦ä½¿ç«¯å£å¯ç”¨äºŽ Docker ä¹‹å¤–çš„æœåŠ¡æˆ–æœªè¿žæŽ¥åˆ°å®¹å™¨ç½‘ç»œçš„ Docker å®¹å™¨ï¼Œè¯·ä½¿ç”¨ &amp;ndash;publish æˆ–-p æ ‡å¿—ã€‚è¿™ä¼šåˆ›å»ºä¸€ä¸ªé˜²ç«å¢™è§„åˆ™ï¼Œå°†å®¹å™¨ç«¯å£æ˜ å°„åˆ° Docker ä¸»æœºä¸Šçš„ç«¯å£ã€‚&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æ ‡å¿—å€¼&lt;/th>
&lt;th>æè¿°&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>-p 8080:80&lt;/code>&lt;/td>
&lt;td>å°†å®¹å™¨çš„ 80 ç«¯å£æ˜ å°„åˆ° Docker ä¸»æœºçš„ 8080 ç«¯å£(TCP)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>-p 8080:80/udp&lt;/code>&lt;/td>
&lt;td>å°†å®¹å™¨çš„ 80 ç«¯å£æ˜ å°„åˆ° Docker ä¸»æœºçš„ 8080 ç«¯å£(UDP)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>-p 8080:80/tcp -p 8080:80/udp&lt;/code>&lt;/td>
&lt;td>å°†å®¹å™¨çš„ 80 ç«¯å£æ˜ å°„åˆ° Docker ä¸»æœºçš„ 8080 ç«¯å£(TCP å’Œ UDP)&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¯åŠ¨/åœæ­¢æŸä¸ªå®¹å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker &lt;span class="o">[&lt;/span>start&lt;span class="p">|&lt;/span>stop&lt;span class="o">]&lt;/span> container_name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åœ¨æŸä¸ªå®¹å™¨å†…æ‰§è¡ŒæŸæ¡å‘½ä»¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker &lt;span class="nb">exec&lt;/span> -ti container_name command.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŸ¥çœ‹æŸä¸ªå®¹å™¨çš„è¾“å‡ºæ—¥å¿—&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker logs -ft container_name
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="çŠ¶æ€æŸ¥è¯¢">çŠ¶æ€æŸ¥è¯¢&lt;/h2>
&lt;ul>
&lt;li>docker ps æŸ¥çœ‹è¿è¡Œä¸­çš„æ‰€æœ‰å®¹å™¨ã€‚&lt;/li>
&lt;li>docker logs ä»Žå®¹å™¨ä¸­èŽ·å–æ—¥å¿—ã€‚(ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰æ—¥å¿—é©±åŠ¨ï¼Œä¸è¿‡åœ¨ 1.10 ä¸­ï¼Œå®ƒåªæ”¯æŒ json-file å’Œ journald)&lt;/li>
&lt;li>docker inspect æŸ¥çœ‹æŸä¸ªå®¹å™¨çš„æ‰€æœ‰ä¿¡æ¯(åŒ…æ‹¬ IP åœ°å€)ã€‚&lt;/li>
&lt;li>docker events ä»Žå®¹å™¨ä¸­èŽ·å–äº‹ä»¶(events)ã€‚&lt;/li>
&lt;li>docker port æŸ¥çœ‹å®¹å™¨çš„å…¬å¼€ç«¯å£ã€‚&lt;/li>
&lt;li>docker top æŸ¥çœ‹å®¹å™¨ä¸­æ´»åŠ¨è¿›ç¨‹ã€‚&lt;/li>
&lt;li>docker stats æŸ¥çœ‹å®¹å™¨çš„èµ„æºä½¿ç”¨æƒ…å†µç»Ÿè®¡ä¿¡æ¯ã€‚&lt;/li>
&lt;li>docker diff æŸ¥çœ‹å®¹å™¨çš„ FS ä¸­æœ‰å˜åŒ–æ–‡ä»¶ä¿¡æ¯ã€‚&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ ¹æ®æ¡ä»¶è¿‡æ»¤æŸ¥è¯¢&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker ps --filter &lt;span class="s2">&amp;#34;name=nostalgic&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„å®¹å™¨åˆ—è¡¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker stats --all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ‰¹é‡æŸ¥çœ‹æ—¥å¿—&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> i in &lt;span class="k">$(&lt;/span>docker ps -qf &lt;span class="nv">name&lt;/span>&lt;span class="o">=&lt;/span>wsat_slave*&lt;span class="k">)&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;==================&lt;/span>&lt;span class="nv">$i&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> docker logs &lt;span class="nv">$i&lt;/span> &lt;span class="p">|&lt;/span> grep aisec&lt;span class="p">;&lt;/span> &lt;span class="k">done&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ç®¡ç†é…ç½®">ç®¡ç†é…ç½®&lt;/h2>
&lt;p>åˆ›å»ºå®¹å™¨æ—¶ä¹Ÿå¯ä»¥å®¹å™¨çš„é‡å¯ç­–ç•¥ï¼Œå³æ˜¯å½“å®¹å™¨å‡ºé”™é€€å‡ºæˆ–è€…å®¿ä¸»æœºé‡å¯æ—¶å€™ï¼Œå®¹å™¨çš„åº”å¯¹ç­–ç•¥ï¼›é‡å¯ç­–ç•¥åŒæ ·ä¼šä¿è¯ç›¸å…³è”çš„å®¹å™¨ä»¥æ­£ç¡®çš„é¡ºåºé‡å¯ï¼Œé¿å…æ„å¤–çš„é”™è¯¯ã€‚&lt;/p>
&lt;ul>
&lt;li>no: ä¸è¿›è¡Œé‡å¯&lt;/li>
&lt;li>on-failure: å½“å®¹å™¨ä»¥éžé›¶çŠ¶æ€ç é€€å‡ºæ—¶é‡å¯å®¹å™¨&lt;/li>
&lt;li>unless-stopped: å½“æŸä¸ªå®¹å™¨è¢«æ˜¾æ€§å…³é—­æˆ–è€… Docker æœ¬èº«å…³é—­æˆ–é‡å¯æ—¶é‡å¯&lt;/li>
&lt;li>always: æ— è®ºå‡ºçŽ°ä»»ä½•æƒ…å†µéƒ½é‡å¯å®¹å™¨&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è®¾ç½®é‡å¯ç­–ç•¥&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#â€ŠOff, On-failure, Unless-stopped, Always&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker run -dit â€” restart unless-stopped &lt;span class="o">[&lt;/span>CONTAINER&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¯ä»¥é€šè¿‡å¤šç§è¿‡æ»¤æ¡ä»¶æ¥è¿›è¡Œå®¹å™¨çš„ç§»é™¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å…³é—­æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker &lt;span class="nb">kill&lt;/span> &lt;span class="k">$(&lt;/span>docker ps -q&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ‰¹é‡é‡å¯å®¹å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker restart &lt;span class="k">$(&lt;/span>docker ps -a -q&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ ¹æ® IDæˆ–Name ç§»é™¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker rm idOrName
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç§»é™¤æ‰€æœ‰åœæ­¢çš„å®¹å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker rm &lt;span class="k">$(&lt;/span>docker ps -a -q&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ ¹æ®çŠ¶æ€ç§»é™¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker rm &lt;span class="k">$(&lt;/span>docker ps -q -f &lt;span class="s1">&amp;#39;status=exited&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ ¹æ®æ ‡ç­¾ç§»é™¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker rm &lt;span class="k">$(&lt;/span>docker ps -a &lt;span class="p">|&lt;/span> grep rabbitmq &lt;span class="p">|&lt;/span> awk &lt;span class="s1">&amp;#39;{print $1}&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker rm &lt;span class="k">$(&lt;/span>docker ps -a &lt;span class="p">|&lt;/span> grep &lt;span class="s2">&amp;#34;46 hours ago&amp;#34;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹å®¹å™¨ä¸­çš„æ–‡ä»¶è¿›è¡Œå¯¼å…¥å¯¼å‡ºæ“ä½œ:&lt;/p>
&lt;ul>
&lt;li>docker cp åœ¨å®¹å™¨å’Œæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¹‹é—´å¤åˆ¶æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ã€‚&lt;/li>
&lt;li>docker export å°†å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿåˆ‡æ¢ä¸ºåŽ‹ç¼©åŒ…(tarball archive stream)è¾“å‡ºåˆ° STDOUTã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="èµ„æºé…é¢">èµ„æºé…é¢&lt;/h2>
&lt;p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code>docker stats&lt;/code> å‘½ä»¤æ¥æŸ¥çœ‹ Docker å®¹å™¨çš„æ€§èƒ½çŠ¶æ€ä¸Žèµ„æºå ç”¨:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ docker stats redis1 redis2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONTAINER CPU % MEM USAGE / LIMIT MEM % NET IO BLOCK IO
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">redis1 0.07% &lt;span class="m">796&lt;/span> KB / &lt;span class="m">64&lt;/span> MB 1.21% &lt;span class="m">788&lt;/span> B / &lt;span class="m">648&lt;/span> B 3.568 MB / &lt;span class="m">512&lt;/span> KB
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="memory">Memory&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ docker run -it -m 300M ubuntu:14.04 /bin/bash
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="cpu">CPU&lt;/h3>
&lt;p>åœ¨çº¿ä¸ŠçŽ¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å³å¸Œæœ›èƒ½å¤Ÿå°½é‡é¿å… CPU ç©ºé—´æ—¶é—´ç‰‡ï¼Œæœ€å¤§åŒ–èµ„æºåˆ©ç”¨çŽ‡ï¼Œä¹Ÿè¦ä¿éšœé‡ç‚¹ä¸šåŠ¡çš„èµ„æºå ç”¨ï¼Œé¿å…å› æŸä¸ªå¼‚å¸¸å®¹å™¨å ç”¨æˆ–ä¸åˆç†ä½¿ç”¨æ•´æœº CPU èµ„æºï¼Œé€ æˆå®¿ä¸»æœºä¸Šå¤§é‡å®¹å™¨å¼‚å¸¸ï¼›æ­¤æ—¶å•å®¹å™¨çš„ CPU èµ„æºçº¦æŸåŠä¸Šé™å°†å˜å¾—éžå¸¸é‡è¦ï¼Œæ—¢ä¸èƒ½é™å¾—å¤ªæ­»ï¼Œåˆä¸èƒ½é™ä¸ä½ï¼Œå°†é€šè¿‡å†…æ ¸å’Œè°ƒåº¦ç³»ç»Ÿçš„é™åˆ¶æœºåˆ¶æ¥ä¿éšœèµ„æºç¨³å®šæ€§ã€‚Docker å…è®¸ä½¿ç”¨ cpus, cpuset-cpus, cpu-shares ç­‰æ¥é™åˆ¶å®¹å™¨çš„è®¡ç®—èµ„æºå ç”¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŒ‡å®šå®¹å™¨å¯å ç”¨çš„ CPU æ ¸ç¼–å·ï¼Œ0-3 è¡¨ç¤ºå ç”¨å››ä¸ªæ ¸ï¼Œ1,3 è¡¨ç¤ºå ç”¨ä¸¤ä¸ªæ ¸&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker run -it --cpuset-cpus&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;1,3&amp;#34;&lt;/span> ubuntu /bin/bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æœ€å¤šå…è®¸å ç”¨å• CPU 50% çš„è®¡ç®—èµ„æºï¼Œå¦‚æžœåŒæ ¸ CPUï¼Œåˆ™å¯ä»¥è®¾ç½®ä¸º 1.5 ç­‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker run -it --cpus&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;.5&amp;#34;&lt;/span> ubuntu /bin/bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¸åŒçš„å€¼èƒ½å¤ŸæŒ‡å®šä¸åŒçš„å®¹å™¨æƒé‡ï¼Œç”¨äºŽåŠ¨æ€åˆ†é… CPU èµ„æº&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker run -it --cpu-shares&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;512&amp;#34;&lt;/span> ubuntu /bin/bash
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>
&lt;p>CPU Set ä¿éšœäº†å®¹å™¨çš„ CPU æ ¸æ•°ï¼Œå®‰å…¨æ€§è¾ƒå¼ºï¼Œä½†æ˜¯æ•´ä½“èµ„æºåˆ©ç”¨çŽ‡ä½Žã€‚å¦‚æžœå®¹å™¨å®žé™…å¹¶ä¸éœ€è¦å¦‚æ­¤å¤šæ ¸çš„ CPU èµ„æºæ¥å¤„ç†ä»»åŠ¡åˆ™ä¼šé€ æˆèµ„æºæµªè´¹ï¼Œå¹¶ä¸”å¯¼è‡´å…¶ä»–å®¹å™¨ä¸Šçš„ä»»åŠ¡æ— æ³•åˆ©ç”¨è¯¥å®¹å™¨ä¸Šçš„ CPU ç©ºé—²æ—¶é—´ç‰‡ï¼Œäººä¸ºé˜»æ–­äº† CPU é—²æ—¶å¤ç”¨çš„èƒ½åŠ›ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>CPU Share å…è®¸é€šè¿‡å…±äº«çš„æ–¹å¼èŽ·å¾— CPU èµ„æºï¼Œä¸åŒçš„å®¹å™¨å…±äº«ä¸€å®šæ€»é‡çš„ CPU è®¡ç®—èƒ½åŠ›ï¼Œæ¯ä¸ªå®¹å™¨éƒ½ç»‘å®šå…¨é‡æ ¸ï¼Œè€Œæ¯ä¸ªå®¹å™¨èŽ·å–ä¸€å®šä»½é¢çš„ CPU è®¡ç®—åŠ›ã€‚è¯¥æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ªå®¹å™¨çš„ CPU èµ„æºåˆ†é…ä¸å†ä»¥æ•´æ ¸åˆ†é…ï¼Œè€Œæ˜¯å¯ç²¾ç»†åˆ° CPU æ—¶é—´ç‰‡ä»½é¢çš„ç²’åº¦ï¼Œå¹¶ä¸”æ˜¯è¿žç»­çš„ CPU æ ¸èƒ½åŠ›å€¼ã€‚å½“æ•´æœºé—²æ—¶ï¼Œå¯ä»¥è®©è¾ƒä¸ºç¹å¿™çš„ä¸šåŠ¡èŽ·å¾—æ•´æœºç©ºé—²ã€‚é‡‡ç”¨ CPU èµ„æºå…±äº«çš„æœºåˆ¶ï¼Œå…¶èµ„æºéš”ç¦»æ€§æ²¡æœ‰ set æ¨¡å¼å¼ºï¼Œå¯¹äºŽæžä¸ªåˆ« CPU èµ„æºæ•æ„Ÿåž‹ä¸šåŠ¡ï¼Œæœ‰å¯èƒ½å‡ºçŽ°å¶å°”ç­‰å¾… CPU æ—¶é—´ç‰‡çš„æƒ…å†µï¼Œè€Œå½±å“ä¸šåŠ¡ç¨³å®šæ€§ã€‚å¯¹äºŽæžå°‘æ•°çš„è¿™ç±»ä¸šåŠ¡ï¼Œæˆ‘ä»¬å®¹è®¸ç»§ç»­ä½¿ç”¨ CPU set æ¨¡å¼ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="storage">Storage&lt;/h3>
&lt;p>å¦‚æžœä½¿ç”¨ Device Mapper ä½œä¸ºåº•å±‚å­˜å‚¨é©±åŠ¨ï¼Œåˆ™å¯ä»¥é€šè¿‡ Docker daemon çš„å¦‚ä¸‹å‚æ•°æ¥å…¨å±€é™åˆ¶å•ä¸ªå®¹å™¨å ç”¨ç©ºé—´çš„å¤§å°:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># é™åˆ¶å•ä¸ªå®¹å™¨æœ€å¤šå ç”¨ 20G ç©ºé—´ï¼Œå°†åº”ç”¨äºŽä»»ä½•æ–°å»ºå®¹å™¨ã€‚&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ --storage-opt dm.basesize&lt;span class="o">=&lt;/span>20G
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æžœæ˜¯ btrfs å­˜å‚¨é©±åŠ¨ï¼Œå¯ä½¿ç”¨å…¶æä¾›çš„ subvolume åŠŸèƒ½æ¥å®žçŽ°ã€‚ä¸€ä¸ªå®¹å™¨ä¼šå¯¹åº”ä¸€ä¸ª subvolumeã€‚é’ˆå¯¹å®¹å™¨å¯¹åº”çš„ subvolume å¯ç”¨å¹¶é…ç½® quota å³å¯é™åˆ¶å…¶ç£ç›˜ç©ºé—´:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ btrfs qgroup limit -e 50G /var/lib/docker/btrfs/subvolumes/&amp;lt;CONTAINER_ID&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æŽˆäºˆå¯¹å•ä¸ªè®¾å¤‡è®¿é—®æƒé™:&lt;/p>
&lt;pre tabindex="0">&lt;code>docker run -it --device=/dev/ttyUSB0 debian bash
&lt;/code>&lt;/pre>&lt;p>æŽˆäºˆæ‰€æœ‰è®¾å¤‡è®¿é—®æƒé™:&lt;/p>
&lt;pre tabindex="0">&lt;code>docker run -it --privileged -v /dev/bus/usb:/dev/bus/usb debian bash
&lt;/code>&lt;/pre>&lt;h1 id="èµ„æºé…ç½®">èµ„æºé…ç½®&lt;/h1>
&lt;h2 id="volume--æ•°æ®å·">Volume | æ•°æ®å·&lt;/h2>
&lt;p>å®¹å™¨è¿è¡Œæ—¶åº”è¯¥å°½é‡ä¿æŒå®¹å™¨å­˜å‚¨å±‚ä¸å‘ç”Ÿå†™æ“ä½œï¼Œå¯¹äºŽæ•°æ®åº“ç±»éœ€è¦ä¿å­˜åŠ¨æ€æ•°æ®çš„åº”ç”¨ï¼Œå…¶æ•°æ®åº“æ–‡ä»¶åº”è¯¥ä¿å­˜äºŽå·(Volume)ä¸­ã€‚ä¸ºäº†é˜²æ­¢è¿è¡Œæ—¶ç”¨æˆ·å¿˜è®°å°†åŠ¨æ€æ–‡ä»¶æ‰€ä¿å­˜ç›®å½•æŒ‚è½½ä¸ºå·ï¼Œåœ¨ Dockerfile ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥äº‹å…ˆæŒ‡å®šæŸäº›ç›®å½•æŒ‚è½½ä¸ºåŒ¿åå·ï¼Œè¿™æ ·åœ¨è¿è¡Œæ—¶å¦‚æžœç”¨æˆ·ä¸æŒ‡å®šæŒ‚è½½ï¼Œå…¶åº”ç”¨ä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä¸ä¼šå‘å®¹å™¨å­˜å‚¨å±‚å†™å…¥å¤§é‡æ•°æ®ã€‚&lt;/p>
&lt;p>æ•°æ®å·æ˜¯ä¸€ä¸ªå¯ä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä½¿ç”¨çš„ç‰¹æ®Šç›®å½•ï¼Œå®ƒç»•è¿‡ UFSï¼Œå¯ä»¥æä¾›å¾ˆå¤šæœ‰ç”¨çš„ç‰¹æ€§ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>æ•°æ®å·å¯ä»¥åœ¨å®¹å™¨ä¹‹é—´å…±äº«å’Œé‡ç”¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯¹æ•°æ®å·çš„ä¿®æ”¹ä¼šç«‹é©¬ç”Ÿæ•ˆ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¯¹æ•°æ®å·çš„æ›´æ–°ï¼Œä¸ä¼šå½±å“é•œåƒ&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å·ä¼šä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°æ²¡æœ‰å®¹å™¨ä½¿ç”¨&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ•°æ®å·çš„ä½¿ç”¨ï¼Œç±»ä¼¼äºŽ Linux ä¸‹å¯¹ç›®å½•æˆ–æ–‡ä»¶è¿›è¡Œ mountã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>For example,&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># the following creates a tmpfs volume called foo with a size of 100 megabyte and uid of 1000.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker volume create --driver &lt;span class="nb">local&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --opt &lt;span class="nv">type&lt;/span>&lt;span class="o">=&lt;/span>tmpfs &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --opt &lt;span class="nv">device&lt;/span>&lt;span class="o">=&lt;/span>tmpfs &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --opt &lt;span class="nv">o&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">size&lt;/span>&lt;span class="o">=&lt;/span>100m,uid&lt;span class="o">=&lt;/span>&lt;span class="m">1000&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> foo
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>nother example that uses nfs to mount the /path/to/dir in rw mode from 192.168.1.1:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ docker volume create --driver &lt;span class="nb">local&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --opt &lt;span class="nv">type&lt;/span>&lt;span class="o">=&lt;/span>nfs &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --opt &lt;span class="nv">o&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">addr&lt;/span>&lt;span class="o">=&lt;/span>192.168.1.1,rw &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --opt &lt;span class="nv">device&lt;/span>&lt;span class="o">=&lt;/span>:/path/to/dir &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> foo
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ docker run -d &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -it &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --name devtest &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -v myvol2:/app &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> nginx:latest
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;Mounts&amp;#34;&lt;/span>&lt;span class="err">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Type&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;volume&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;myvol2&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Source&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;/var/lib/docker/volumes/myvol2/_data&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Destination&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;/app&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Driver&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;local&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Mode&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;RW&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;Propagation&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>&lt;span class="err">,&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Docker &lt;code>-v&lt;/code> æ ‡è®°ä¹Ÿå¯ä»¥æŒ‡å®šæŒ‚è½½ä¸€ä¸ªæœ¬åœ°ä¸»æœºçš„ç›®å½• / æ–‡ä»¶åˆ°å®¹å™¨ä¸­åŽ»ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŒ‚è½½ç›®å½•&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo docker run -d -P --name web -v /src/webapp:/opt/webapp training/webapp python app.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŒ‚è½½æ–‡ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo docker run --rm -it -v ~/.bash_history:/.bash_history ubuntu /bin/bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Docker æŒ‚è½½æ•°æ®å·çš„é»˜è®¤æƒé™æ˜¯è¯»å†™ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡ `:ro` æŒ‡å®šä¸ºåªè¯»ã€‚&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo docker run -d -P --name web -v /src/webapp:/opt/webapp:ro
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">training/webapp python app.py
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ³¨æ„ï¼šDockerfile ä¸­ä¸æ”¯æŒè¿™ç§ç”¨æ³•ï¼Œè¿™æ˜¯å› ä¸º Dockerfile æ˜¯ä¸ºäº†ç§»æ¤å’Œåˆ†äº«ç”¨çš„ã€‚ç„¶è€Œï¼Œä¸åŒæ“ä½œç³»ç»Ÿçš„è·¯å¾„æ ¼å¼ä¸ä¸€æ ·ï¼Œæ‰€ä»¥ç›®å‰è¿˜ä¸èƒ½æ”¯æŒã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="l">VOLUME /data&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="network--ç½‘ç»œ">Network | ç½‘ç»œ&lt;/h2>
&lt;p>Linux åœ¨ç½‘ç»œæ ˆä¸­å¼•å…¥ç½‘ç»œå‘½åç©ºé—´ï¼Œå°†ç‹¬ç«‹çš„ç½‘ç»œåè®®æ ˆéš”ç¦»åˆ°ä¸åŒçš„å‘½ä»¤ç©ºé—´ä¸­ï¼Œå½¼æ­¤é—´æ— æ³•é€šä¿¡ï¼›Docker åˆ©ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œå®žçŽ°ä¸å®¹å™¨é—´çš„ç½‘ç»œéš”ç¦»ï¼Œå¹¶ä¸”å¼•å…¥ Veth è®¾å¤‡å¯¹æ¥å®žçŽ°åœ¨ä¸åŒç½‘ç»œå‘½åç©ºé—´çš„é€šä¿¡ã€‚Linux ç³»ç»ŸåŒ…å«ä¸€ä¸ªå®Œæ•´çš„è·¯ç”±åŠŸèƒ½ï¼Œå½“ IP å±‚åœ¨å¤„ç†æ•°æ®å‘é€æˆ–è½¬å‘çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨è·¯ç”±è¡¨æ¥å†³å®šå‘å¾€å“ªé‡Œã€‚Netfilter è´Ÿè´£åœ¨å†…æ ¸ä¸­æ‰§è¡Œå„ç§æŒ‚æŽ¥çš„è§„åˆ™(è¿‡æ»¤ã€ä¿®æ”¹ã€ä¸¢å¼ƒç­‰)ï¼Œè¿è¡Œåœ¨å†…æ ¸æ¨¡å¼ä¸­ï¼›Iptables æ¨¡å¼æ˜¯åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹è¿è¡Œçš„è¿›ç¨‹ï¼Œè´Ÿè´£ååŠ©ç»´æŠ¤å†…æ ¸ä¸­ Netfilter çš„å„ç§è§„åˆ™è¡¨ï¼›é€šè¿‡äºŒè€…çš„é…åˆæ¥å®žçŽ°æ•´ä¸ª Linux ç½‘ç»œåè®®æ ˆä¸­çµæ´»çš„æ•°æ®åŒ…å¤„ç†æœºåˆ¶ã€‚Docker çš„ç½‘ç»œå­ç³»ç»Ÿé‡‡ç”¨äº†åŸºäºŽé©±åŠ¨çš„å¯æ’æ‹”æœºåˆ¶ï¼Œå…¶é»˜è®¤åŒ…å«äº†å¦‚ä¸‹é©±åŠ¨æ¨¡å¼ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>bridge&lt;/code>: é»˜è®¤çš„ç½‘ç»œé©±åŠ¨ï¼Œå¸¸ç”¨äºŽå¤šä¸ªåº”ç”¨è¿è¡Œä¸Žç‹¬ç«‹å®¹å™¨ä¸­å¹¶ä¸”éœ€è¦ç›¸äº’é€šè®¯çš„æ—¶å€™ã€‚&lt;/li>
&lt;li>&lt;code>host&lt;/code>: ç§»é™¤å®¹å™¨ä¸Ž Docker ä¸»æœºä¹‹é—´çš„ç½‘ç»œéš”ç¦»ï¼Œç›´æŽ¥ä½¿ç”¨å®¿ä¸»æœºæ‰€åœ¨çš„ç½‘ç»œã€‚åº•å±‚ä¸Žå®¿ä¸»æœºå…±ç”¨ä¸€ä¸ª Network Namespaceï¼Œå®¹å™¨å°†ä¸ä¼šè™šæ‹Ÿå‡ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„ IP ç­‰ï¼Œè€Œæ˜¯ä½¿ç”¨å®¿ä¸»æœºçš„ IP å’Œç«¯å£ã€‚&lt;/li>
&lt;li>&lt;code>overlay&lt;/code>: Overlay ç½‘ç»œç”¨è¯­è¿žæŽ¥å¤šä¸ª Docker Daemonï¼Œä¿è¯ Docker Swarm æœåŠ¡çš„æ­£å¸¸è¿è¡Œï¼›ç‹¬ç«‹çš„å®¹å™¨ä¸Ž Swarm æœåŠ¡ï¼Œæˆ–è€…ä¸åŒå®¿ä¸»æœºä¸Šçš„å®¹å™¨åŒæ ·èƒ½å¤Ÿé€šè¿‡ Overlay è¿›è¡Œé€šä¿¡ã€‚&lt;/li>
&lt;li>&lt;code>none&lt;/code>: å¯¹äºŽæŒ‡å®šå®¹å™¨ç¦æ­¢æ‰€æœ‰çš„ç½‘ç»œé€šä¿¡ã€‚&lt;/li>
&lt;li>&lt;code>macvlan&lt;/code>: Macvlan ç½‘ç»œä¼šå…è®¸ç›´æŽ¥ä¸ºå®¹å™¨åˆ†é… MAC åœ°å€ï¼Œä½¿å…¶ä½œä¸ºçœŸæ­£çš„ç‰©ç†è®¾å¤‡æŽ¥å…¥åˆ°å®¿ä¸»æœºæ‰€åœ¨çš„ç½‘ç»œä¸­ã€‚&lt;/li>
&lt;/ul>
&lt;p>æˆ‘ä»¬ä½¿ç”¨ network å‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ°é»˜è®¤çš„ç½‘ç»œï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ docker network ls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NETWORK ID NAME DRIVER SCOPE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">f707aa0ef50d bridge bridge &lt;span class="nb">local&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">97dd7a032d96 host host &lt;span class="nb">local&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">d5a1bed0b12d none null &lt;span class="nb">local&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æ¡¥æŽ¥æ¨¡å¼ä¸‹ï¼Œå½“ Docker å¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ª docker0 è™šæ‹Ÿç½‘æ¡¥ï¼Œå³è½¯ä»¶äº¤æ¢æœºï¼Œåœ¨æŒ‚è½½åˆ°å®ƒçš„ç½‘å£ä¹‹é—´è¿›è¡Œè½¬å‘ã€‚åŒæ—¶ï¼ŒDocker éšæœºåˆ†é…ä¸€ä¸ªæœ¬åœ°æœªå ç”¨çš„ç§æœ‰ç½‘æ®µ(åœ¨ RFC1918 ä¸­å®šä¹‰)ä¸­çš„ä¸€ä¸ªåœ°å€ç»™ docker0 æŽ¥å£ã€‚æ¯”å¦‚å…¸åž‹çš„ 172.17.42.1ï¼ŒæŽ©ç ä¸º 255.255.0.0ã€‚æ­¤åŽå¯åŠ¨çš„å®¹å™¨å†…çš„ç½‘å£ä¹Ÿä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªåŒä¸€ç½‘æ®µ(172.17.0.0/16)çš„åœ°å€ã€‚&lt;/p>
&lt;p>æ¡¥æŽ¥æ¨¡å¼ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ª Docker å®¹å™¨çš„æ—¶å€™ï¼ŒåŒæ—¶ä¼šåˆ›å»ºäº†ä¸€å¯¹ veth pair æŽ¥å£(å½“æ•°æ®åŒ…å‘é€åˆ°ä¸€ä¸ªæŽ¥å£æ—¶ï¼Œå¦å¤–ä¸€ä¸ªæŽ¥å£ä¹Ÿå¯ä»¥æ”¶åˆ°ç›¸åŒçš„æ•°æ®åŒ…)ã€‚è¿™å¯¹æŽ¥å£ä¸€ç«¯åœ¨å®¹å™¨å†…ï¼Œå³ eth0ï¼›å¦ä¸€ç«¯åœ¨æœ¬åœ°å¹¶è¢«æŒ‚è½½åˆ° docker0 ç½‘æ¡¥ï¼Œåç§°ä»¥ veth å¼€å¤´(ä¾‹å¦‚ vethAQI2QT)ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä¸»æœºå¯ä»¥è·Ÿå®¹å™¨é€šä¿¡ï¼Œå®¹å™¨ä¹‹é—´ä¹Ÿå¯ä»¥ç›¸äº’é€šä¿¡ã€‚Docker å°±åˆ›å»ºäº†åœ¨ä¸»æœºå’Œæ‰€æœ‰å®¹å™¨ä¹‹é—´ä¸€ä¸ªè™šæ‹Ÿå…±äº«ç½‘ç»œã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ›å»ºæ–°çš„ç½‘ç»œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker network create --driver bridge isolated
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŒ‡å®šç½‘æ®µï¼Œå®¿ä¸»æœºä¼šä½œä¸ºé»˜è®¤ç½‘å…³&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker network create --driver&lt;span class="o">=&lt;/span>bridge --subnet&lt;span class="o">=&lt;/span>192.168.2.0/24 --gateway&lt;span class="o">=&lt;/span>192.168.2.10 new_subnet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ›å»ºæ—¶å°†æŸä¸ªå®¹å™¨è¿žæŽ¥åˆ°ç½‘ç»œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker run --network&lt;span class="o">=&lt;/span>isolated -itd --name&lt;span class="o">=&lt;/span>docker-nginx nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å°†æŸä¸ªè¿è¡Œä¸­å®¹å™¨è¿žæŽ¥åˆ°æŸä¸ªç½‘ç»œï¼Œåœ¨è¯¥ç½‘ç»œå†…å¯ä»¥é€šè¿‡å®¹å™¨åè‡ªç”±è®¿é—®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker network connect multi-host-network container1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="dns">DNS&lt;/h3>
&lt;p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨ä»Ž Docker å®ˆæŠ¤è¿›ç¨‹ç»§æ‰¿ DNS è®¾ç½®ï¼ŒåŒ…æ‹¬ /etc/hosts å’Œ /etc/resolv.confã€‚å¯ä»¥åŸºäºŽæ¯ä¸ªå®¹å™¨è¦†ç›–è¿™äº›è®¾ç½®ã€‚&lt;/p>
&lt;ul>
&lt;li>-h HOSTNAME or &amp;ndash;hostname=HOSTNAME è®¾å®šå®¹å™¨çš„ä¸»æœºåï¼Œå®ƒä¼šè¢«å†™åˆ°å®¹å™¨å†…çš„ /etc/hostname å’Œ /etc/hostsã€‚ä½†å®ƒåœ¨å®¹å™¨å¤–éƒ¨çœ‹ä¸åˆ°ï¼Œæ—¢ä¸ä¼šåœ¨ docker ps ä¸­æ˜¾ç¤ºï¼Œä¹Ÿä¸ä¼šåœ¨å…¶ä»–çš„å®¹å™¨çš„ /etc/hosts çœ‹åˆ°ã€‚&lt;/li>
&lt;li>&amp;ndash;link=CONTAINER_NAME:ALIAS é€‰é¡¹ä¼šåœ¨åˆ›å»ºå®¹å™¨çš„æ—¶å€™ï¼Œæ·»åŠ ä¸€ä¸ªå…¶ä»–å®¹å™¨çš„ä¸»æœºååˆ° /etc/hosts æ–‡ä»¶ä¸­ï¼Œè®©æ–°å®¹å™¨çš„è¿›ç¨‹å¯ä»¥ä½¿ç”¨ä¸»æœºå ALIAS å°±å¯ä»¥è¿žæŽ¥å®ƒã€‚&lt;/li>
&lt;li>&amp;ndash;dns=IP_ADDRESS æ·»åŠ  DNS æœåŠ¡å™¨åˆ°å®¹å™¨çš„ /etc/resolv.conf ä¸­ï¼Œè®©å®¹å™¨ç”¨è¿™ä¸ªæœåŠ¡å™¨æ¥è§£æžæ‰€æœ‰ä¸åœ¨ /etc/hosts ä¸­çš„ä¸»æœºåã€‚&lt;/li>
&lt;li>&amp;ndash;dns-search=DOMAIN è®¾å®šå®¹å™¨çš„æœç´¢åŸŸï¼Œå½“è®¾å®šæœç´¢åŸŸä¸º .example.com æ—¶ï¼Œåœ¨æœç´¢ä¸€ä¸ªåä¸º host çš„ ä¸»æœºæ—¶ï¼ŒDNS ä¸ä»…æœç´¢ hostï¼Œè¿˜ä¼šæœç´¢ host.example.comã€‚æ³¨æ„ï¼šå¦‚æžœæ²¡æœ‰ä¸Šè¿°æœ€åŽ 2 ä¸ªé€‰é¡¹ï¼ŒDocker ä¼šé»˜è®¤ç”¨ä¸»æœºä¸Šçš„ /etc/resolv.conf æ¥é…ç½®å®¹å™¨ã€‚&lt;/li>
&lt;/ul>
&lt;h2 id="ç©ºé—´æ¸…ç†">ç©ºé—´æ¸…ç†&lt;/h2>
&lt;p>Docker ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‘çŽ°å®¿ä¸»èŠ‚ç‚¹çš„ç£ç›˜å®¹é‡æŒç»­å¢žé•¿ï¼Œè­¬å¦‚ volume æˆ–è€… overlay2 ç›®å½•å ç”¨äº†å¤§é‡çš„ç©ºé—´ï¼›å¦‚æžœä»»å…¶å‘å±•ï¼Œå¯èƒ½å°†ç£ç›˜ç©ºé—´è€—å°½è¿›è€Œå¼•å‘å®¿ä¸»æœºå¼‚å¸¸ï¼Œè¿›è€Œå¯¹ä¸šåŠ¡é€ æˆå½±å“ã€‚Docker çš„å†…ç½® df æŒ‡ä»¤å¯ç”¨äºŽæŸ¥è¯¢é•œåƒ(Images)ã€å®¹å™¨(Containers)å’Œæœ¬åœ°å·(Local Volumes)ç­‰ç©ºé—´ä½¿ç”¨å¤§æˆ·çš„ç©ºé—´å ç”¨æƒ…å†µã€‚è€Œå®¹å™¨çš„å ç”¨çš„æ€»ç©ºé—´ï¼ŒåŒ…å«å…¶æœ€é¡¶å±‚çš„è¯»å†™å±‚(writable layer)å’Œåº•éƒ¨çš„åªè¯»é•œåƒå±‚(base image layerï¼Œread-only)ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ &lt;code>ps -s&lt;/code> å‚æ•°æ¥æ˜¾ç¤ºäºŒè€…çš„ç©ºé—´å ç”¨æƒ…å†µ:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ç©ºé—´å ç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ du -h --max-depth&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="p">|&lt;/span> sort
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç©ºé—´å ç”¨æ€»ä½“åˆ†æž&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker system df
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è¾“å‡ºç©ºé—´å ç”¨ç»†èŠ‚&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker system df -v
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è¾“å‡ºå®¹å™¨çš„ç©ºé—´å ç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker ps -s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>docker system prune&lt;/code> æŒ‡ä»¤èƒ½å¤Ÿè¿›è¡Œè‡ªåŠ¨åœ°ç©ºé—´æ¸…ç†ï¼Œå…¶é»˜è®¤ä¼šæ¸…é™¤å·²åœæ­¢çš„å®¹å™¨ã€æœªè¢«ä»»ä½•å®¹å™¨æ‰€ä½¿ç”¨çš„å·ã€æœªè¢«ä»»ä½•å®¹å™¨æ‰€å…³è”çš„ç½‘ç»œã€æ‰€æœ‰æ‚¬ç©ºé•œåƒ:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¸€å¹¶æ¸…é™¤æ‰€æœ‰æœªä½¿ç”¨çš„é•œåƒå’Œæ‚¬ç©ºé•œåƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker system prune --all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ—ä¸¾æ‚¬ç©ºé•œåƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker images -f &lt;span class="nv">dangling&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ é™¤å…¨éƒ¨æ‚¬ç©ºé•œåƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker image prune
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ é™¤æ‰€æœ‰æœªè¢«ä½¿ç”¨çš„é•œåƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker image prune -a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ é™¤æŒ‡å®šæ¨¡å¼çš„é•œåƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker images -a &lt;span class="p">|&lt;/span> grep &lt;span class="s2">&amp;#34;pattern&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> awk &lt;span class="s1">&amp;#39;{print $3}&amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> xargs docker rmi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ é™¤å…¨éƒ¨é•œåƒ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker rmi &lt;span class="k">$(&lt;/span>docker images -a -q&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ é™¤å…¨éƒ¨åœæ­¢çš„å®¹å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker rm &lt;span class="k">$(&lt;/span>docker ps -a -f &lt;span class="nv">status&lt;/span>&lt;span class="o">=&lt;/span>exited -q&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ ¹æ®æŒ‡å®šæ¨¡å¼åˆ é™¤å®¹å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker rm &lt;span class="k">$(&lt;/span>docker ps -a -f &lt;span class="nv">status&lt;/span>&lt;span class="o">=&lt;/span>exited -f &lt;span class="nv">status&lt;/span>&lt;span class="o">=&lt;/span>created -q&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker rm &lt;span class="k">$(&lt;/span>docker ps -a &lt;span class="p">|&lt;/span> grep rabbitmq &lt;span class="p">|&lt;/span> awk &lt;span class="s1">&amp;#39;{print $1}&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ é™¤å…¨éƒ¨å®¹å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker stop &lt;span class="k">$(&lt;/span>docker ps -a -q&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker rm &lt;span class="k">$(&lt;/span>docker ps -a -q&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ—ä¸¾å¹¶åˆ é™¤æœªè¢«ä½¿ç”¨çš„å·&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker volume ls -f &lt;span class="nv">dangling&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker volume prune
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ ¹æ®æŒ‡å®šçš„æ¨¡å¼åˆ é™¤å·&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker volume prune --filter &lt;span class="s2">&amp;#34;label!=keep&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ é™¤æœªè¢«å…³è”çš„ç½‘ç»œ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker network prune
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker network prune --filter &lt;span class="s2">&amp;#34;until=24h&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„å°ºå¯¸æˆ–è€…æ¸…ç©ºæ—¥å¿—æ–‡ä»¶:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># è®¾ç½®æ—¥å¿—æ–‡ä»¶æœ€å¤§å°ºå¯¸&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ dockerd ... --log-opt max-size&lt;span class="o">=&lt;/span>10m --log-opt max-file&lt;span class="o">=&lt;/span>&lt;span class="m">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ¸…ç©ºå½“å‰æ—¥å¿—æ–‡ä»¶&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">truncate -s &lt;span class="m">0&lt;/span> /var/lib/docker/containers/*/*-json.log
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="æœåŠ¡æ²»ç†">æœåŠ¡æ²»ç†&lt;/h1>
&lt;h2 id="docker-compose">Docker Compose&lt;/h2>
&lt;p>Docker Compose æ˜¯ç”¨äºŽå®šä¹‰å’Œè¿è¡Œå¤æ‚ Docker åº”ç”¨çš„å·¥å…·ã€‚ä½ å¯ä»¥åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ªå¤šå®¹å™¨çš„åº”ç”¨ï¼Œç„¶åŽä½¿ç”¨ä¸€æ¡å‘½ä»¤æ¥å¯åŠ¨ä½ çš„åº”ç”¨ï¼Œç„¶åŽæ‰€æœ‰ç›¸å…³çš„æ“ä½œéƒ½ä¼šè¢«è‡ªåŠ¨å®Œæˆï¼›ç®€å•çš„ Compose æ–‡ä»¶å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># æŒ‡å®š Docker Compose æ–‡ä»¶ç‰ˆæœ¬&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;3&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">services&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">web&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># æŒ‡å®šä»Žæœ¬åœ°ç›®å½•è¿›è¡Œç¼–è¯‘&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">build&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># æŒ‡å®šå¯¼å‡ºç«¯å£&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;5000:5000&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># æ›¿æ¢é»˜è®¤çš„ CMD å‘½ä»¤&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">python app.py&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># å°†æœ¬åœ°ç›®å½•ç»‘å®šåˆ°å®¹å™¨å†…ç›®å½•&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">.:/code&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">redis&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># é•œåƒçš„ ID&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;redis:alpine&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œç”¨åˆ°çš„ Python Web åº”ç”¨çš„ Dockerfile å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-Dockerfile" data-lang="Dockerfile">&lt;span class="line">&lt;span class="cl">&lt;span class="k">FROM&lt;/span>&lt;span class="s"> python:3.4-alpine&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">ADD&lt;/span> . /code&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">WORKDIR&lt;/span>&lt;span class="s"> /code&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> pip install -r requirements.txt&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">CMD&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;python&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;app.py&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨ä»£ç ä¸­ç›´æŽ¥ä½¿ç”¨æœåŠ¡åä½œä¸ºè¿žæŽ¥åœ°å€ï¼Œå³å¯è®¿é—®åˆ° Redis æ•°æ®åº“ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-py" data-lang="py">&lt;span class="line">&lt;span class="cl">&lt;span class="n">cache&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">redis&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Redis&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;redis&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">port&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">6379&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åŽä½¿ç”¨ docker-compose å‘½ä»¤å¯åŠ¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># äº¤äº’å¼å¯åŠ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker-compose up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å®ˆæŠ¤è¿›ç¨‹å¼å¯åŠ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker-compose up -d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æŸ¥çœ‹è¿è¡Œæƒ…å†µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker-compose ps
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å…³é—­&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker-compose stop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç§»é™¤å†…éƒ¨å·&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker-compose down --volumes
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨æ¶‰åŠåˆ°æ•°æ®å­˜å‚¨çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥æŒ‡å®š docker-compose åˆ›å»ºå‘½åæ•°æ®å·ï¼Œå¹¶å°†å…¶æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;3.2&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">services&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">web&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">nginx:alpine&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">volume&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">source&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mydata&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">target&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/data&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volume&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">nocopy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bind&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">source&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">./static&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">target&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/opt/app/static&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">db&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">postgres:latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;/var/run/postgres/postgres.sock:/var/run/postgres/postgres.sock&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s2">&amp;#34;dbdata:/var/lib/postgresql/data&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">mydata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">dbdata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æžœæŸä¸ªæ•°æ®å·å¤©ç„¶éœ€è¦æ˜ å°„åˆ°æœ¬åœ°æ–‡ä»¶ï¼Œåˆ™å¯ä»¥æŒ‡å®š driver çš„ç±»åž‹ä¸º local:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">wsat_etc&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">driver&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">local&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">driver_opts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">o&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">bind&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">none&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">device&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/etc/wsat/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="docker-swarm-1">Docker Swarm&lt;/h2>
&lt;p>Swarm æ˜¯ Docker å…¬å¸åœ¨ 2014 å¹´ 12 æœˆåˆå‘å¸ƒçš„ä¸€å¥—è¾ƒä¸ºç®€å•çš„å·¥å…·ï¼Œç”¨æ¥ç®¡ç† Docker é›†ç¾¤ï¼Œå®ƒå°†ä¸€ç¾¤ Docker å®¿ä¸»æœºå˜æˆä¸€ä¸ªå•ä¸€çš„ï¼Œè™šæ‹Ÿçš„ä¸»æœºã€‚Swarm ä½¿ç”¨æ ‡å‡†çš„ Docker API æŽ¥å£ä½œä¸ºå…¶å‰ç«¯è®¿é—®å…¥å£ï¼Œæ¢è¨€ä¹‹ï¼Œå„ç§å½¢å¼çš„ Docker Client(dockerclient in go, docker_py, docker ç­‰)å‡å¯ä»¥ç›´æŽ¥ä¸Ž Swarm é€šä¿¡ã€‚&lt;/p>
&lt;p>Swarm Deamon åªæ˜¯ä¸€ä¸ªè°ƒåº¦å™¨(Scheduler)å’Œè·¯ç”±å™¨(Router)ï¼ŒSwarm è‡ªå·±ä¸è¿è¡Œå®¹å™¨ï¼Œå®ƒåªæ˜¯æŽ¥å— Docker å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚ï¼Œè°ƒåº¦é€‚åˆçš„èŠ‚ç‚¹æ¥è¿è¡Œå®¹å™¨ï¼Œè¿™æ„å‘³ç€ï¼Œå³ä½¿ Swarm ç”±äºŽæŸäº›åŽŸå› æŒ‚æŽ‰äº†ï¼Œé›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¹Ÿä¼šç…§å¸¸è¿è¡Œï¼Œå½“ Swarm é‡æ–°æ¢å¤è¿è¡Œä¹‹åŽï¼Œå®ƒä¼šæ”¶é›†é‡å»ºé›†ç¾¤ä¿¡æ¯ã€‚å¹¶ä¸” Swarm æä¾›çš„è·¯ç”±åŒ¹é…(æœåŠ¡å‘çŽ°ã€è´Ÿè½½å‡è¡¡ã€è·¨å®¹å™¨é€šè®¯)éžå¸¸å¯é ã€‚åœ¨å•ä¸ªç«¯å£ä¸Šè¿è¡Œä¸€ä¸ªæœåŠ¡ï¼ŒSwarm èŠ‚ç‚¹çš„ä»»æ„ä¸»æœºéƒ½å¯ä»¥è®¿é—®ï¼Œè´Ÿè½½å‡è¡¡å®Œå…¨åœ¨åŽå°å®žçŽ°ã€‚&lt;/p>
&lt;p>
&lt;figure >
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="https://user-images.githubusercontent.com/5803001/44953944-dfbc7a00-aecd-11e8-93dc-1fe6258aafd0.png" alt="image" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;/figure>&lt;/p>
&lt;p>Swarm åœ¨ Scheduler èŠ‚ç‚¹è¿è¡Œå®¹å™¨çš„æ—¶å€™ï¼Œä¼šæ ¹æ®æŒ‡å®šçš„ç­–ç•¥æ¥è®¡ç®—æœ€é€‚åˆè¿è¡Œå®¹å™¨çš„èŠ‚ç‚¹ï¼Œç›®å‰æ”¯æŒçš„ç­–ç•¥æœ‰ï¼šRandom, Binpack, Spreadã€‚&lt;/p>
&lt;p>Random é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯éšæœºé€‰æ‹©ä¸€ä¸ª Node æ¥è¿è¡Œå®¹å™¨ï¼Œä¸€èˆ¬ç”¨ä½œè°ƒè¯•ç”¨ã€‚Spread å’Œ Binpack ç­–ç•¥ä¼šæ ¹æ®å„ä¸ªèŠ‚ç‚¹çš„å¯ç”¨çš„ CPU, RAM ä»¥åŠæ­£åœ¨è¿è¡Œçš„å®¹å™¨çš„æ•°é‡æ¥è®¡ç®—åº”è¯¥è¿è¡Œå®¹å™¨çš„èŠ‚ç‚¹ã€‚åœ¨åŒç­‰æ¡ä»¶ä¸‹ï¼ŒSpread ç­–ç•¥ä¼šé€‰æ‹©è¿è¡Œå®¹å™¨æœ€å°‘çš„é‚£å°èŠ‚ç‚¹æ¥è¿è¡Œæ–°çš„å®¹å™¨ï¼ŒBinpack ç­–ç•¥ä¼šé€‰æ‹©è¿è¡Œå®¹å™¨æœ€é›†ä¸­çš„é‚£å°æœºå™¨æ¥è¿è¡Œæ–°çš„èŠ‚ç‚¹ã€‚&lt;/p>
&lt;p>ä½¿ç”¨ Spread ç­–ç•¥ä¼šä½¿å¾—å®¹å™¨ä¼šå‡è¡¡çš„åˆ†å¸ƒåœ¨é›†ç¾¤ä¸­çš„å„ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œä¸€æ—¦ä¸€ä¸ªèŠ‚ç‚¹æŒ‚æŽ‰äº†åªä¼šæŸå¤±å°‘éƒ¨åˆ†çš„å®¹å™¨ã€‚Binpack ç­–ç•¥æœ€å¤§åŒ–çš„é¿å…å®¹å™¨ç¢Žç‰‡åŒ–ï¼Œå°±æ˜¯è¯´ Binpack ç­–ç•¥å°½å¯èƒ½çš„æŠŠè¿˜æœªä½¿ç”¨çš„èŠ‚ç‚¹ç•™ç»™éœ€è¦æ›´å¤§ç©ºé—´çš„å®¹å™¨è¿è¡Œï¼Œå°½å¯èƒ½çš„æŠŠå®¹å™¨è¿è¡Œåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šé¢ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ›å»ºä¸€ä¸ªæ–°çš„æœåŠ¡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker service create &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--image nginx &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--replicas &lt;span class="m">2&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ›´æ–°æœåŠ¡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker service update &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>--image nginx:alpine &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span>nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ é™¤æœåŠ¡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker service rm nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ç¼©å®¹ï¼Œè€Œä¸æ˜¯ç›´æŽ¥åˆ é™¤æœåŠ¡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker service scale &lt;span class="nv">nginx&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ‰©å®¹&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker service scale &lt;span class="nv">nginx&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ—å‡ºæ‰€æœ‰çš„æœåŠ¡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker service ls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># åˆ—å‡ºä¸€ä¸ªæœåŠ¡çš„æ‰€æœ‰å®žä¾‹(åŒ…æ‹¬æœåŠ¡çš„å¥åº·çŠ¶å†µ)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker service ps nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æœåŠ¡çš„è¯¦ç»†ä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker service inspect nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¢žåŠ å’Œåˆ é™¤DNS&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker service update --dns-add 222.222.222.222 tender_hofstadter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker service update --dns-rm 222.222.222.222 tender_hofstadter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å¢žåŠ å’Œåˆ é™¤ç«¯å£æ˜ å°„&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker service update --publish-add 80:80 xenodochial_ritchie
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ docker service update --publish-rm 80:80 xenodochial_ritchie
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ Docker Compose çš„è„šæœ¬æ¥è¿›è¡Œæ‰¹æ¬¡éƒ¨ç½²ï¼š&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ docker stack deploy application
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;3&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">services&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">web&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">registry.gitlab.com/example/example&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># you need to use external image&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">npm run prod&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="m">80&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">deploy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">6&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">update_config&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">parallelism&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">delay&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">10s&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">restart_policy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">condition&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">on&lt;/span>-&lt;span class="l">failure&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>