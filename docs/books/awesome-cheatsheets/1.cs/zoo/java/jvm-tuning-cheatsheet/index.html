<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="JVM 调试与优化实践清单 本文着重于介绍 JVM 线上问题定位中常用的调试命令与工具，对于具体的应用案例请参考其他章节。 调试工具 常见的调试工具会提供慢调用自动监听、全局线程比对、热点方法分析等功能。 JVM 参数配置分析 基"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/awesome-cheatsheets/1.cs/zoo/java/jvm-tuning-cheatsheet/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/awesome-cheatsheets/1.cs/zoo/java/jvm-tuning-cheatsheet/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/awesome-cheatsheets/1.cs/zoo/java/jvm-tuning-cheatsheet/"><meta property="og:title" content="JVM-Tuning-CheatSheet | Next-gen Tech Edu"><meta property="og:description" content="JVM 调试与优化实践清单 本文着重于介绍 JVM 线上问题定位中常用的调试命令与工具，对于具体的应用案例请参考其他章节。 调试工具 常见的调试工具会提供慢调用自动监听、全局线程比对、热点方法分析等功能。 JVM 参数配置分析 基"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><meta property="article:modified_time" content="2023-03-05T15:38:23+08:00"><title>JVM-Tuning-CheatSheet | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=840fd55f69bd40f0bc090876d29d194c><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">Java</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id960cc797d2c07fa738ce5ae692b9c884")' href=#id960cc797d2c07fa738ce5ae692b9c884 aria-expanded=false aria-controls=id960cc797d2c07fa738ce5ae692b9c884 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/1.cs/zoo/>Zoo</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id960cc797d2c07fa738ce5ae692b9c884 aria-expanded=false aria-controls=id960cc797d2c07fa738ce5ae692b9c884><i class="fa-solid fa-angle-down" id=caret-id960cc797d2c07fa738ce5ae692b9c884></i></a></div><ul class="nav docs-sidenav collapse show" id=id960cc797d2c07fa738ce5ae692b9c884><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ide0fcb107315f95a304118261bafb0270")' href=#ide0fcb107315f95a304118261bafb0270 aria-expanded=false aria-controls=ide0fcb107315f95a304118261bafb0270 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/1.cs/zoo/c/>C</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ide0fcb107315f95a304118261bafb0270 aria-expanded=false aria-controls=ide0fcb107315f95a304118261bafb0270><i class="fa-solid fa-angle-right" id=caret-ide0fcb107315f95a304118261bafb0270></i></a></div><ul class="nav docs-sidenav collapse" id=ide0fcb107315f95a304118261bafb0270><li class="child level"><a href=/books/awesome-cheatsheets/1.cs/zoo/c/cpp-cheatsheet/>CPP-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/1.cs/zoo/c/morten-cpp-cheatsheet/>Morten-CPP-CheatSheet</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idb2edec274d6773aa2b745ae28d9c8e89")' href=#idb2edec274d6773aa2b745ae28d9c8e89 aria-expanded=false aria-controls=idb2edec274d6773aa2b745ae28d9c8e89 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/1.cs/zoo/go/>Go</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idb2edec274d6773aa2b745ae28d9c8e89 aria-expanded=false aria-controls=idb2edec274d6773aa2b745ae28d9c8e89><i class="fa-solid fa-angle-right" id=caret-idb2edec274d6773aa2b745ae28d9c8e89></i></a></div><ul class="nav docs-sidenav collapse" id=idb2edec274d6773aa2b745ae28d9c8e89><li class="child level"><a href=/books/awesome-cheatsheets/1.cs/zoo/go/go-cheatsheet/>Go-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/1.cs/zoo/go/go-concurrentprogramming-cheatsheet/>Go-ConcurrentProgramming-CheatSheet</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id097626e7138298cbf1117a47038e25b1")' href=#id097626e7138298cbf1117a47038e25b1 aria-expanded=false aria-controls=id097626e7138298cbf1117a47038e25b1 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/1.cs/zoo/java/>Java</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id097626e7138298cbf1117a47038e25b1 aria-expanded=false aria-controls=id097626e7138298cbf1117a47038e25b1><i class="fa-solid fa-angle-down" id=caret-id097626e7138298cbf1117a47038e25b1></i></a></div><ul class="nav docs-sidenav collapse show" id=id097626e7138298cbf1117a47038e25b1><li class="child level"><a href=/books/awesome-cheatsheets/1.cs/zoo/java/gradle-cheatsheet/>Gradle-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/1.cs/zoo/java/java-cheatsheet/>Java-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/1.cs/zoo/java/java-concurrentprogramming-cheatsheet/>Java-ConcurrentProgramming-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/1.cs/zoo/java/java-styleguide-cheatsheet/>Java-StyleGuide-CheatSheet</a></li><li class="child level active"><a href=/books/awesome-cheatsheets/1.cs/zoo/java/jvm-tuning-cheatsheet/>JVM-Tuning-CheatSheet</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id93c46847b7800ad06ded8d50d401f062")' href=#id93c46847b7800ad06ded8d50d401f062 aria-expanded=false aria-controls=id93c46847b7800ad06ded8d50d401f062 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/1.cs/zoo/javascript/>JavaScript</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id93c46847b7800ad06ded8d50d401f062 aria-expanded=false aria-controls=id93c46847b7800ad06ded8d50d401f062><i class="fa-solid fa-angle-right" id=caret-id93c46847b7800ad06ded8d50d401f062></i></a></div><ul class="nav docs-sidenav collapse" id=id93c46847b7800ad06ded8d50d401f062><li class="child level"><a href=/books/awesome-cheatsheets/1.cs/zoo/javascript/dart-cheatsheet/>Dart-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/1.cs/zoo/javascript/javascript-cheatsheet/>JavaScript-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/1.cs/zoo/javascript/javascript-cheatsheet-en/>JavaScript-CheatSheet-en</a></li><li class="child level"><a href=/books/awesome-cheatsheets/1.cs/zoo/javascript/typescript-cheatsheet/>TypeScript-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/1.cs/zoo/javascript/v8-cheatsheet/>V8-CheatSheet</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id4fdb6a9c1c59dd283b33aaac86f9823e")' href=#id4fdb6a9c1c59dd283b33aaac86f9823e aria-expanded=false aria-controls=id4fdb6a9c1c59dd283b33aaac86f9823e aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/1.cs/zoo/python/>Python</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id4fdb6a9c1c59dd283b33aaac86f9823e aria-expanded=false aria-controls=id4fdb6a9c1c59dd283b33aaac86f9823e><i class="fa-solid fa-angle-right" id=caret-id4fdb6a9c1c59dd283b33aaac86f9823e></i></a></div><ul class="nav docs-sidenav collapse" id=id4fdb6a9c1c59dd283b33aaac86f9823e><li class="child level"><a href=/books/awesome-cheatsheets/1.cs/zoo/python/python-cheatsheet/>Python-CheatSheet</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idca4491f13e9c41dd2694c1aaab8eb462")' href=#idca4491f13e9c41dd2694c1aaab8eb462 aria-expanded=false aria-controls=idca4491f13e9c41dd2694c1aaab8eb462 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/1.cs/zoo/ruby/>Ruby</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idca4491f13e9c41dd2694c1aaab8eb462 aria-expanded=false aria-controls=idca4491f13e9c41dd2694c1aaab8eb462><i class="fa-solid fa-angle-right" id=caret-idca4491f13e9c41dd2694c1aaab8eb462></i></a></div><ul class="nav docs-sidenav collapse" id=idca4491f13e9c41dd2694c1aaab8eb462><li class="child level"><a href=/books/awesome-cheatsheets/1.cs/zoo/ruby/ruby-cheatsheet/>Ruby-CheatSheet</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id678b4e35fbe5b1cd15f6595bf4a17b45")' href=#id678b4e35fbe5b1cd15f6595bf4a17b45 aria-expanded=false aria-controls=id678b4e35fbe5b1cd15f6595bf4a17b45 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/1.cs/zoo/rust/>Rust</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id678b4e35fbe5b1cd15f6595bf4a17b45 aria-expanded=false aria-controls=id678b4e35fbe5b1cd15f6595bf4a17b45><i class="fa-solid fa-angle-right" id=caret-id678b4e35fbe5b1cd15f6595bf4a17b45></i></a></div><ul class="nav docs-sidenav collapse" id=id678b4e35fbe5b1cd15f6595bf4a17b45><li class="child level"><a href=/books/awesome-cheatsheets/1.cs/zoo/rust/rust-cheatsheet/>Rust-CheatSheet</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id8df4b58de5c2496d1e3638c0ae21af1c")' href=#id8df4b58de5c2496d1e3638c0ae21af1c aria-expanded=false aria-controls=id8df4b58de5c2496d1e3638c0ae21af1c aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/1.cs/zoo/swift/>Swift</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id8df4b58de5c2496d1e3638c0ae21af1c aria-expanded=false aria-controls=id8df4b58de5c2496d1e3638c0ae21af1c><i class="fa-solid fa-angle-right" id=caret-id8df4b58de5c2496d1e3638c0ae21af1c></i></a></div><ul class="nav docs-sidenav collapse" id=id8df4b58de5c2496d1e3638c0ae21af1c><li class="child level"><a href=/books/awesome-cheatsheets/1.cs/zoo/swift/swift-cheatsheet/>Swift-CheatSheet</a></li></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#基础参数>基础参数</a></li><li><a href=#垃圾回收参数>垃圾回收参数</a></li><li><a href=#其他参数>其他参数</a></li><li><a href=#tomcat-jvm-配置>Tomcat JVM 配置</a></li></ul><ul><li><a href=#dump>Dump</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>JVM-Tuning-CheatSheet</h1><div class=article-style><h1 id=jvm-调试与优化实践清单>JVM 调试与优化实践清单</h1><p>本文着重于介绍 JVM 线上问题定位中常用的调试命令与工具，对于具体的应用案例请参考其他章节。</p><h1 id=调试工具>调试工具</h1><p>常见的调试工具会提供慢调用自动监听、全局线程比对、热点方法分析等功能。</p><h1 id=jvm-参数配置分析>JVM 参数配置分析</h1><h2 id=基础参数>基础参数</h2><ul><li><code>-Xms4g</code>: JVM 启动时，分配的最小堆大小 4G</li></ul><h2 id=垃圾回收参数>垃圾回收参数</h2><h2 id=其他参数>其他参数</h2><h2 id=tomcat-jvm-配置>Tomcat JVM 配置</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;-server&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>CATALINA_OPTS</span><span class=si>}</span><span class=s2> -Xms5120m -Xmx5120m&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>CATALINA_OPTS</span><span class=si>}</span><span class=s2> -XX:PermSize=256m -XX:MaxPermSize=256m&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>CATALINA_OPTS</span><span class=si>}</span><span class=s2> -Xmn2500m&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>CATALINA_OPTS</span><span class=si>}</span><span class=s2> -XX:MaxDirectMemorySize=1g&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>CATALINA_OPTS</span><span class=si>}</span><span class=s2> -XX:SurvivorRatio=10&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>CATALINA_OPTS</span><span class=si>}</span><span class=s2> -XX:+UseConcMarkSweepGC -XX:+UseCMSCompactAtFullCollection -XX:CMSMaxAbortablePrecleanTime=5000&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>CATALINA_OPTS</span><span class=si>}</span><span class=s2> -XX:+CMSClassUnloadingEnabled -XX:CMSInitiatingOccupancyFraction=80 -XX:+UseCMSInitiatingOccupancyOnly&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>CATALINA_OPTS</span><span class=si>}</span><span class=s2> -XX:+ExplicitGCInvokesConcurrent -Dsun.rmi.dgc.client.gcInterval=72000000&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>CATALINA_OPTS</span><span class=si>}</span><span class=s2> -XX:ParallelGCThreads=</span><span class=si>${</span><span class=nv>CPU_COUNT</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>CATALINA_OPTS</span><span class=si>}</span><span class=s2> -Xloggc:</span><span class=si>${</span><span class=nv>MIDDLEWARE_LOGS</span><span class=si>}</span><span class=s2>/gc.log -XX:+PrintGCDetails -XX:+PrintGCDateStamps&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>CATALINA_OPTS</span><span class=si>}</span><span class=s2> -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=</span><span class=si>${</span><span class=nv>MIDDLEWARE_LOGS</span><span class=si>}</span><span class=s2>/java.hprof&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>CATALINA_OPTS</span><span class=si>}</span><span class=s2> -Djava.awt.headless=true&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>CATALINA_OPTS</span><span class=si>}</span><span class=s2> -Dsun.net.client.defaultConnectTimeout=10000&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>CATALINA_OPTS</span><span class=si>}</span><span class=s2> -Dsun.net.client.defaultReadTimeout=30000&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>CATALINA_OPTS</span><span class=si>}</span><span class=s2> -DJM.LOG.PATH=</span><span class=si>${</span><span class=nv>MIDDLEWARE_LOGS</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>CATALINA_OPTS</span><span class=si>}</span><span class=s2> -Dfile.encoding=</span><span class=si>${</span><span class=nv>JAVA_FILE_ENCODING</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>CATALINA_OPTS</span><span class=si>}</span><span class=s2> -Djava.awt.headless=true -Dcom.sun.management.jmxremote.port=1090&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>CATALINA_OPTS</span><span class=si>}</span><span class=s2> -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.ssl=false&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CATALINA_OPTS</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>CATALINA_OPTS</span><span class=si>}</span><span class=s2> -Dcom.sun.management.jmxremote.authenticate=false -Djava.rmi.server.hostname=10.125.59.163&#34;</span>
</span></span></code></pre></div><table><thead><tr><th>参数</th><th>含义</th><th>扩展阅读</th></tr></thead><tbody><tr><td>-Xms4g</td><td></td><td></td></tr><tr><td>-Xmx4g</td><td>jvm 启动时，允许分配的最大的堆大小：4g</td><td></td></tr><tr><td>-XX:MetaspaceSize=256m</td><td>元数据区默认大小，从 JDK8 之后，没有 Perm 区了</td><td></td></tr><tr><td>-XX:MaxMetaspaceSize=256m</td><td>元数据的最大大小</td><td></td></tr><tr><td>-Xmn2g</td><td>分配的年轻代大小：2g</td><td></td></tr><tr><td>-XX:MaxDirectMemorySize=1g</td><td>配置最大的堆外内存</td><td><a href="http://hellojava.info/?tag=maxdirectmemorysize" target=_blank rel=noopener>http://hellojava.info/?tag=maxdirectmemorysize</a></td></tr><tr><td>-XX:SurvivorRatio=10</td><td>Eden 区与 Survivor 区的大小比值</td><td></td></tr><tr><td>-XX:+UseConcMarkSweepGC</td><td>使用 CMS 内存收集</td><td></td></tr><tr><td>-XX:+UseCMSCompactAtFullCollection</td><td>在 FULL GC 的时候，对年老代的压缩</td><td>CMS 是不会移动内存的，因此，这个非常容易产生碎片，导致内存不够用，因此，内存的压缩这个时候就会被启用。增加这个参数是个好习惯。可能会影响性能,但是可以消除碎片</td></tr><tr><td>-XX:CMSMaxAbortablePrecleanTime=5000</td><td>指定 CMS-concurrent-abortable-preclean 阶段执行的时间，该阶段主要是执行一些预清理，减少应用暂停的时间。但在 JDK 5.0+、6.0+的版本中有可能会由于 JDK 的 bug29 导致 CMS 在 remark 完毕后很久才触发 sweeping 动作。通过设置-XX: CMSMaxAbortablePrecleanTime=5（单位为 ms）来避免，</td><td><a href=http://shensy.iteye.com/blog/1915227 target=_blank rel=noopener>http://shensy.iteye.com/blog/1915227</a> <a href=http://www.blogjava.net/BlueDavy/archive/2009/10/09/297562.html target=_blank rel=noopener>http://www.blogjava.net/BlueDavy/archive/2009/10/09/297562.html</a></td></tr><tr><td>-XX:+CMSClassUnloadingEnabled</td><td>由于使用的框架是 Spring/Hibernate 大量采用 cglib，导致生成的 Proxy 会比较多，而这些是存放在 PermGen 区域，sun JDK 默认情况下不会去回收，必须加上-XX:+CMSClassUnloadingEnabled -XX:+CMSPermGenSweepingEnabled 参数，JDK 才会去回收这部分数据</td><td></td></tr><tr><td>-XX:CMSInitiatingOccupancyFraction=80</td><td>使用 cms 作为垃圾回收使用 80％后开始 CMS 收集</td><td></td></tr><tr><td>-XX:+UseCMSInitiatingOccupancyOnly</td><td>我们用-XX+UseCMSInitiatingOccupancyOnly 标志来命令 JVM 不基于运行时收集的数据来启动 CMS 垃圾收集周期。而是，当该标志被开启时，JVM 通过 CMSInitiatingOccupancyFraction 的值进行每一次 CMS 收集，而不仅仅是第一次。然而，请记住大多数情况下，JVM 比我们自己能作出更好的垃圾收集决策。因此，只有当我们充足的理由(比如测试)并且对应用程序产生的对象的生命周期有深刻的认知时，才应该使用该标志</td><td></td></tr><tr><td>-XX:+ExplicitGCInvokesConcurrent</td><td>如今,被广泛接受的最佳实践是避免显式地调用 GC(所谓的“系统 GC”)，即在应用程序中调用 system.gc()。然而，这个建议是不管使用的 GC 算法的，值得一提的是，当使用 CMS 收集器时，系统 GC 将是一件很不幸的事，因为它默认会触发一次 Full GC。幸运的是，有一种方式可以改变默认设置。标志-XX:+ExplicitGCInvokesConcurrent 命令 JVM 无论什么时候调用系统 GC，都执行 CMS GC，而不是 Full GC，</td><td>-</td></tr><tr><td>-Dsun.rmi.dgc.server.gcInterval=2592000000</td><td>作为 rmi-server 时，gc 的时间间隔，默认是 1 小时，720 小时</td><td><a href=https://coderanch.com/t/91073/Difference-client-gcInterval-server-gcInterval target=_blank rel=noopener>https://coderanch.com/t/91073/Difference-client-gcInterval-server-gcInterval</a></td></tr><tr><td>-Dsun.rmi.dgc.client.gcInterval=2592000000</td><td>作为 rmi-client 时，gc 的时间间隔，默认是 1 小时，720 小时</td><td><a href=https://coderanch.com/t/91073/Difference-client-gcInterval-server-gcInterval target=_blank rel=noopener>https://coderanch.com/t/91073/Difference-client-gcInterval-server-gcInterval</a></td></tr><tr><td>-XX:ParallelGCThreads=4</td><td>并行收集器的线程数</td><td>此值最好配置与处理器数目相等 同样适用于 CMS</td></tr><tr><td>-Xloggc:/home/admin/logs/gc.log</td><td>gc 打印的日志目录</td><td>-</td></tr><tr><td>-XX:+PrintGCDetails</td><td>打印 GC 的详情信息</td><td>-</td></tr><tr><td>-XX:+PrintGCDateStamps</td><td>打印 GC 的时间戳</td><td>-</td></tr><tr><td>-XX:+HeapDumpOnOutOfMemoryError</td><td>当发生 OOM 错误 时，将内存 DUMP 下来</td><td>-</td></tr><tr><td>-XX:HeapDumpPath=/home/admin/logs/java.hprof</td><td>内存 DUMP 的路径</td><td>-</td></tr><tr><td>-Djava.awt.headless=true</td><td>Headless 模式是在缺少显示屏、键盘或者鼠标时的系统配置</td><td>-</td></tr><tr><td>-Dsun.net.client.defaultConnectTimeout=10000</td><td>java.net.URLConnection 默认的连接超时时间，毫秒数单位</td><td>-</td></tr><tr><td>-Dsun.net.client.defaultReadTimeout=30000</td><td>设置超时时间，当从 inputstream 进行读取的时候</td><td>-</td></tr><tr><td>-DJM.LOG.PATH=/home/admin/logs</td><td>阿里中间件约定定义日志文件路径</td><td>-</td></tr><tr><td>-DJM.SNAPSHOT.PATH=/home/admin/snapshots</td><td>容灾文件，原来和日志一个目录，现在单独指定，防止运维误删, 如 diamond，configclient</td><td>-</td></tr><tr><td>-Dfile.encoding=UTF-8</td><td>设置文件编码为 UTF-8，Charset.defaultCharset()</td><td>-</td></tr><tr><td>-Dhsf.publish.delayed=true</td><td>true 意思是启动延迟发布,也就是不向 configserver 上注册地址,等待用户通过 online hsf 触发将 hsf 服务地址,注册到 configserver 去,才能提供使用(这种场景下 -Dhsf.publish.delayed=true 和 online hsf 必须同时使用,缺一不可);</td><td></td></tr><tr><td>-Dproject.name=di-afi</td><td>设置工程名，与应用名相同</td><td>-</td></tr><tr><td>-Dpandora.boot.wait=true</td><td>PandoraBootstrap.markAndWait()，标记这里是不是要等待的，</td><td>-</td></tr><tr><td>-Dlog4j.defaultInitOverride=true</td><td>检查系统属性 log4j.defaultInitOverride，如果该属性被设置为 false，则执行初始化；否则（只要不是 false，无论是什么值，甚至没有值，都是否则），跳过初始化，</td><td>-</td></tr><tr><td>-Dpandora.location=/home/admin/di-afi/target/taobao-hsf.sar</td><td>设置潘多拉的路径</td><td>-</td></tr><tr><td>-Dapp.location=/home/admin/di-afi/target/di-afi</td><td>设置应用的路径</td><td>-</td></tr><tr><td>-Djava.endorsed.dirs</td><td>包升级替换机制，一般默认是 lib/endorsed 文件夹，就是说，可以把你自己的 jar 包放在这里，代替原有的系统的 jar 包</td><td>-</td></tr><tr><td>-Djava.io.tmpdir=/home/admin/di-afi/.default/temp</td><td>设置应用的写入的临时文件目录</td><td>-</td></tr></tbody></table><h1 id=内存分析>内存分析</h1><p>Full GC 每小时小于个位数</p><h1 id=线程与调用分析>线程与调用分析</h1><h1 id=追踪>追踪</h1><h1 id=jvm-常用调试命令与工具介绍>JVM 常用调试命令与工具介绍</h1><p>本文着重于介绍 JVM 线上问题定位中常用的调试命令与工具，对于具体的应用案例请参考其他章节。</p><h1 id=内存>内存</h1><p>Full GC 每小时小于个位数</p><h2 id=dump>Dump</h2><p>JEP 328: Flight Recorder（JFR）是 Oracle 刚刚开源的强大特性。而 JFR 是一套集成进入 JDK、JVM 内部的事件机制框架，通过良好架构和设计的框架，硬件层面的极致优化，生产环境的广泛验证，它可以做到极致的可靠和低开销。在 SPECjbb2015 等基准测试中，JFR 的性能开销最大不超过 1%。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># Time-Based</span>
</span></span><span class=line><span class=cl>$ java -XX:StartFlightRecording<span class=o>=</span><span class=nv>delay</span><span class=o>=</span>20s,duration<span class=o>=</span>60s,filename<span class=o>=</span>C:<span class=se>\m</span>yRecording.jfr,settings<span class=o>=</span>profile,name<span class=o>=</span>SampleRecording
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Continuous With Dump on Demand</span>
</span></span><span class=line><span class=cl>$ java -XX:StartFlightRecording<span class=o>=</span><span class=nv>settings</span><span class=o>=</span>default
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Continuous With Dump on Exit</span>
</span></span><span class=line><span class=cl>$ java -XX:StartFlightRecording<span class=o>=</span><span class=nv>settings</span><span class=o>=</span>default -XX:FlightRecorderOptions<span class=o>=</span><span class=nv>dumponexit</span><span class=o>=</span>true,dumponexitpath<span class=o>=</span>C:<span class=se>\t</span>mp
</span></span></code></pre></div><p>通过 jmap 命令生成 dump 文件
命令格式：jmap -dump:live,format=b,file=heap.bin <pid>注意：如果要保留 heapdump 中的不可达对象，则需要把”:live“去掉，即使用命令”jmap -dump,format=b,file=heap.bin <pid>“
通过设置 JVM 参数自动生成 使用-XX:+HeapDumpOnOutOfMemoryError 这个 JVM 参数，在 Java 进程运行过程中发生 OOM 的时候就会生成一个 heapdump 文件，并写入到指定目录，一般用-XX:HeapDumpPath=${HOME}/logs/test 来设置。</p><h1 id=线程>线程</h1><h1 id=网络>网络</h1><h1 id=磁盘>磁盘</h1><h1 id=追踪-1>追踪</h1><h1 id=links>Links</h1><ul><li><a href="http://my.oschina.net/91jason/blog/493870?p=%7b%7bpage%7d%7d" target=_blank rel=noopener>JVM 监控与调优</a></li></ul><p><a href=http://www.infoq.com/cn/articles/Diagnosing-Common-Java-Database-Performance-Hotspots target=_blank rel=noopener>诊断 Java 代码中常见的数据库性能热点问题</a> <a href="http://mp.weixin.qq.com/s?__biz=MzI3MzEzMDI1OQ==&mid=2651815337&idx=1&sn=8e846e11e908735a5175c9eacb642329" target=_blank rel=noopener>大神手把手教你 Java 性能优化 - 江南白衣(加强版)</a></p><ul><li><p><a href=http://calvin1978.blogcn.com/articles/jvmoption-2.html target=_blank rel=noopener>关键业务系统的 JVM 启动参数推荐</a> <a href="http://calvin1978.blogcn.com/articles/jvmoption-2.html?f=tt" target=_blank rel=noopener>关键业务系统的 JVM 参数推荐 (2016 热冬版 )</a></p></li><li><p><a href=http://blog.csdn.net/jiushuai/article/details/8455788 target=_blank rel=noopener>JVM 调试工具说明</a> ><a href=http://ihuangweiwei.iteye.com/blog/1219302 target=_blank rel=noopener>Java VisualVM</a> ><a href=http://docs.oracle.com/javase/tutorial/jmx/ target=_blank rel=noopener>JMX</a>:Java Management Extensions (JMX)</p></li></ul></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>上一页</div><a href=/books/awesome-cheatsheets/1.cs/zoo/java/java-styleguide-cheatsheet/ rel=next>Java-StyleGuide-CheatSheet</a></div></div></div><div class=body-footer><p>最近更新于 2023-03-05</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>