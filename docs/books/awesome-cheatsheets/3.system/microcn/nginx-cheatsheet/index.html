<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="Nginx CheatSheet | Nginx 配置详解与生产环境实践 一、Nginx 简介 1.1 简介 Nginx（engine x）是一个免费的，开源的，高性能的 HTTP 服务器， IMAP/POP3 代理服务器 和 TCP/UDP 代理服务器，通常可以用于进行反向代理和实现基于软件的负载均衡，"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/awesome-cheatsheets/3.system/microcn/nginx-cheatsheet/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/awesome-cheatsheets/3.system/microcn/nginx-cheatsheet/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/awesome-cheatsheets/3.system/microcn/nginx-cheatsheet/"><meta property="og:title" content="Nginx-CheatSheet | Next-gen Tech Edu"><meta property="og:description" content="Nginx CheatSheet | Nginx 配置详解与生产环境实践 一、Nginx 简介 1.1 简介 Nginx（engine x）是一个免费的，开源的，高性能的 HTTP 服务器， IMAP/POP3 代理服务器 和 TCP/UDP 代理服务器，通常可以用于进行反向代理和实现基于软件的负载均衡，"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><meta property="article:modified_time" content="2023-04-07T16:13:21+08:00"><title>Nginx-CheatSheet | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=38f4df56890a25b13076769f2301af9b><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">MicroCN</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id61726f9f112a127c6915681dc58e31cf")' href=#id61726f9f112a127c6915681dc58e31cf aria-expanded=false aria-controls=id61726f9f112a127c6915681dc58e31cf aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/3.system/>3.System</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id61726f9f112a127c6915681dc58e31cf aria-expanded=false aria-controls=id61726f9f112a127c6915681dc58e31cf><i class="fa-solid fa-angle-down" id=caret-id61726f9f112a127c6915681dc58e31cf></i></a></div><ul class="nav docs-sidenav collapse show" id=id61726f9f112a127c6915681dc58e31cf><li class="child level"><a href=/books/awesome-cheatsheets/3.system/auth-cheatsheet/>Auth-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/3.system/backend-ops-cheatsheet/>Backend-Ops-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/3.system/cache-cheatsheet/>Cache-CheatSheet</a></li><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id82e7fc5dd01917513c9c0a4302302c47")' href=#id82e7fc5dd01917513c9c0a4302302c47 aria-expanded=false aria-controls=id82e7fc5dd01917513c9c0a4302302c47 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/3.system/database/>Database</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id82e7fc5dd01917513c9c0a4302302c47 aria-expanded=false aria-controls=id82e7fc5dd01917513c9c0a4302302c47><i class="fa-solid fa-angle-right" id=caret-id82e7fc5dd01917513c9c0a4302302c47></i></a></div><ul class="nav docs-sidenav collapse" id=id82e7fc5dd01917513c9c0a4302302c47><li class="child level"><a href=/books/awesome-cheatsheets/3.system/database/mongodb-cheatsheet/>MongoDB-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/3.system/database/mysql-cheatsheet/>MySQL-Cheatsheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/3.system/database/oracle-cheatsheet/>Oracle-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/3.system/database/sql-cheatsheet/>SQL-CheatSheet</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idee445444f225f9eb0ab4bfb9751b9b81")' href=#idee445444f225f9eb0ab4bfb9751b9b81 aria-expanded=false aria-controls=idee445444f225f9eb0ab4bfb9751b9b81 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/3.system/devops/>DevOps</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idee445444f225f9eb0ab4bfb9751b9b81 aria-expanded=false aria-controls=idee445444f225f9eb0ab4bfb9751b9b81><i class="fa-solid fa-angle-right" id=caret-idee445444f225f9eb0ab4bfb9751b9b81></i></a></div><ul class="nav docs-sidenav collapse" id=idee445444f225f9eb0ab4bfb9751b9b81><li class="child level"><a href=/books/awesome-cheatsheets/3.system/devops/backend-ops-cheatsheet/>Backend-Ops-CheatSheet</a></li></ul></div><li class="child level"><a href=/books/awesome-cheatsheets/3.system/git-cheatsheet/>Git-Cheatsheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/3.system/graphql-cheatsheet/>GraphQL-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/3.system/ha-cheatsheet/>HA-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/3.system/kara-systemdesign-cheatsheet/>Kara-SystemDesign-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/3.system/live-cheatsheet/>Live-CheatSheet</a></li><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idd3c42b252a4f776f388230c97ca5897e")' href=#idd3c42b252a4f776f388230c97ca5897e aria-expanded=false aria-controls=idd3c42b252a4f776f388230c97ca5897e aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/3.system/microcn/>MicroCN</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idd3c42b252a4f776f388230c97ca5897e aria-expanded=false aria-controls=idd3c42b252a4f776f388230c97ca5897e><i class="fa-solid fa-angle-down" id=caret-idd3c42b252a4f776f388230c97ca5897e></i></a></div><ul class="nav docs-sidenav collapse show" id=idd3c42b252a4f776f388230c97ca5897e><li class="child level"><a href=/books/awesome-cheatsheets/3.system/microcn/auth-cheatsheet/>Auth-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/3.system/microcn/graphql-cheatsheet/>GraphQL-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/3.system/microcn/ha-cheatsheet/>HA-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/3.system/microcn/microservice-cheatsheet/>MicroService-CheatSheet</a></li><li class="child level active"><a href=/books/awesome-cheatsheets/3.system/microcn/nginx-cheatsheet/>Nginx-CheatSheet</a></li></ul></div><li class="child level"><a href=/books/awesome-cheatsheets/3.system/microservice-cheatsheet/>MicroService-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/3.system/nginx-cheatsheet/>Nginx-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/3.system/pulsar-cheatsheet/>Pulsar-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/3.system/rabbitmq-cheatsheet/>RabbitMQ-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/3.system/redis-cheatsheet/>Redis-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/3.system/rocketmq-cheatsheet/>RocketMQ-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/3.system/softwaretest-cheatsheet/>SoftwareTest-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/3.system/spring-cheatsheet/>Spring-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/3.system/springboot-cheatsheet/>SpringBoot-CheatSheet</a></li></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#一nginx-简介>一、Nginx 简介</a><ul><li><a href=#11-简介>1.1 简介</a></li><li><a href=#12-正向代理和反向代理>1.2 正向代理和反向代理</a></li></ul></li><li><a href=#二基本命令>二、基本命令</a></li><li><a href=#三配置格式>三、配置格式</a><ul><li><a href=#31-基本配置格式>3.1 基本配置格式</a></li><li><a href=#32-时间和空间单位>3.2 时间和空间单位</a></li><li><a href=#33-官方配置模板>3.3 官方配置模板</a></li></ul></li><li><a href=#四部署静态网站>四、部署静态网站</a><ul><li><a href=#41-增加配置>4.1 增加配置</a></li><li><a href=#42-检查配置>4.2 检查配置</a></li><li><a href=#43-重载配置>4.3 重载配置</a></li></ul></li><li><a href=#五实现负载均衡>五、实现负载均衡</a><ul><li><a href=#51-部署后台服务>5.1 部署后台服务</a></li><li><a href=#52-负载均衡配置>5.2 负载均衡配置</a></li><li><a href=#53-负载均衡策略>5.3 负载均衡策略</a></li><li><a href=#44-声明备用服务>4.4 声明备用服务</a></li></ul></li><li><a href=#六实现动静分离>六、实现动静分离</a><ul><li><a href=#61-动静分离配置>6.1 动静分离配置</a></li><li><a href=#62-常见配置异常>6.2 常见配置异常</a></li></ul></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>Nginx-CheatSheet</h1><div class=article-style><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://blog.commando.io/content/images/2014/11/1-Tg9FYCN99FlNj0gn9u8s7A-5-2.jpeg alt loading=lazy data-zoomable></div></div></figure></p><h1 id=nginx-cheatsheet--nginx-配置详解与生产环境实践>Nginx CheatSheet | Nginx 配置详解与生产环境实践</h1><h2 id=一nginx-简介>一、Nginx 简介</h2><h3 id=11-简介>1.1 简介</h3><p>Nginx（engine x）是一个免费的，开源的，高性能的 HTTP 服务器， IMAP/POP3 代理服务器 和 TCP/UDP 代理服务器，通常可以用于进行反向代理和实现基于软件的负载均衡，除此之外，它还具备以下特性：</p><ul><li>Nginx 在设计时遵循模块化的设计方案，可以通过组合模块来扩展实现不同的功能，具备很高的扩展性。</li><li>Nginx 遵循 matser \ worker 架构，主进程负责管理一个或者多个 worker 进程，每个 worker 进程负责处理实际的连接，当某个 worker 进程出错时，主进程会迅速创建一个新的 worker 来继续处理连接请求，从而保证高可用。</li><li>Nginx 在高连接数的情况下仍然可以保持极低的内存占用，从而可以支持高并发量地访问。</li><li>Nginx 支持热部署和配置热加载，并支持在不停机的情况下进行版本升级。</li><li>有免费的开源版本和商业版本 ( Nginx Plus )，可以按需选择或者进行二次开发。</li><li>在高并发环境下，Nginx 比其他 WEB 服务器有更快的响应速度。</li></ul><h3 id=12-正向代理和反向代理>1.2 正向代理和反向代理</h3><p>Nginx 能够同时支持正向代理和反向代理，这两种代理模式的区别如下：</p><ul><li>正向代理发生在客户端，是客户端主动发起的代理。如我们不能直接访问某个服务器，但可以间接通过中间的代理服务器去进行访问，然后将访问结果再返回给我们。</li><li>反向代理发生在服务端，客户端并不知道发生了代理，示例如下。用户只知道将请求发送给 Nginx，但是并不知道请求被转发了，也不知道被转发给了哪一台应用服务器。实际上对于用户来说，他也没必要知道，因为请求结果都是相同的。</li></ul><div align=center><img src=https://gitee.com/heibaiying/Full-Stack-Notes/raw/master/pictures/nginx-plus.png></div><h2 id=二基本命令>二、基本命令</h2><p>Nginx Shell 的基本使用格式如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>nginx <span class=o>[</span>-?hvVtTq<span class=o>]</span> <span class=o>[</span>-s signal<span class=o>]</span> <span class=o>[</span>-c filename<span class=o>]</span> <span class=o>[</span>-p prefix<span class=o>]</span> <span class=o>[</span>-g directives<span class=o>]</span>
</span></span></code></pre></div><ul><li><strong>-?,-h</strong> ：显示帮助信息；</li><li><strong>-v</strong>：查看版本号；</li><li><strong>-V</strong>：查看版本号及配置信息；</li><li><strong>-t</strong>：检测配置文件是否有语法错误；</li><li><strong>-q</strong>：静默模式，在检测配置期间除了错误提示外，不输出其他消息；</li><li><strong>-s signal</strong>：向 Master 进程发送信号，支持以下信号类型：stop ( 立即停止 )，quit ( 优雅停止 )，reload ( 重新加载配置文件 )，reopen (打开一个新的日志文件来继续记录日志) ；</li><li><strong>-p prefix</strong> ：指定路径的前缀，默认为安装目录，如 <code>/usr/app/nginx-1.16.1/</code> ；</li><li><strong>-c filename</strong> ：指定配置文件的位置， 默认值为 <code>conf/nginx.conf</code>，其实际指向的路径为 <code>prefix + filename</code>；</li><li><strong>-g directives</strong>：从指定的配置文件中设置全局指令。</li></ul><h2 id=三配置格式>三、配置格式</h2><h3 id=31-基本配置格式>3.1 基本配置格式</h3><p>Nginx 的配置由全局配置和局部配置（指令块）共同组成，所有的指令块都遵循相同的配置格式：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=err>&lt;section&gt;{</span>
</span></span><span class=line><span class=cl>    <span class=na>&lt;directive&gt;</span>    <span class=s>&lt;parameters&gt;;</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span></code></pre></div><p>指令块使用大括号进行划分，大括号内是独立的配置上下文，包含指令和具体的参数，每行指令以分号作为结尾。除此之外，Nginx 的配置中还支持以下操作：</p><ul><li>支持使用 <code>include</code> 语法来引入外部配置文件，从而可以将每个独立的配置拆分到单独的文件中；</li><li>支持使用 <code>#</code> 符号来添加注释；</li><li>支持使用 <code>$</code> 符号来引用变量；</li><li>部分指令的参数支持使用正则表达式。</li></ul><h3 id=32-时间和空间单位>3.2 时间和空间单位</h3><p>Nginx 的配置文件支持以下空间和时间单位：</p><ul><li><p><strong>空间单位</strong>：不加任何单位默认就是 bytes，除此之外还支持 k/K，m/M，g/G 等常用单位。</p></li><li><p><strong>时间单位</strong>：支持 ms (毫秒) ，s (秒) ，m (分钟) ，h (小时) ，d (天)，w (星期)，M (月，30 天)，y (年，365 天) 等常用单位，并支持组合使用，如 <code>1h 30m</code> (1 小时 30 分)，<code>1y 6M</code>（1 年零 6 个月）。</p></li></ul><h3 id=33-官方配置模板>3.3 官方配置模板</h3><p>在安装 Nginx 后，在安装目录的 conf 目录下会有一个官方的配置样例 nginx.conf ，其内容如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=c1># 使用这个参数来配置worker进程的用户和组，如果没有指定组，则默认为指定用户所处的组，默认值为nobody</span>
</span></span><span class=line><span class=cl><span class=na>user</span>  <span class=s>nobody;</span>
</span></span><span class=line><span class=cl><span class=c1># 指定用于处理客户端连接的worker进程的数量，通常设置为CPU的核心数。</span>
</span></span><span class=line><span class=cl><span class=c1># 如果是为IO密集型操作进行负载，可以设置为核心数的1.5 ~ 2倍</span>
</span></span><span class=line><span class=cl><span class=na>worker_processes</span>  <span class=s>1;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 指定日志的位置和日志级别，日志级别按照由低到高的顺序如下：[debug|info|notice|warn|error|crit]</span>
</span></span><span class=line><span class=cl><span class=na>error_log</span>  <span class=s>logs/error.log;</span>
</span></span><span class=line><span class=cl><span class=c1>#error_log  logs/error.log  notice;</span>
</span></span><span class=line><span class=cl><span class=c1>#error_log  logs/error.log  info;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 指定记录主进程的ID的文件</span>
</span></span><span class=line><span class=cl><span class=na>pid</span>        <span class=s>logs/nginx.pid;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>events</span> <span class=s>{</span>
</span></span><span class=line><span class=cl>    <span class=c1># 指定每个工程线程的最大连接数，总的连接数 max_clients = worker_processes * worker_connections</span>
</span></span><span class=line><span class=cl>    <span class=na>worker_connections</span>  <span class=s>1024;</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>http</span> <span class=s>{</span>
</span></span><span class=line><span class=cl>    <span class=c1># 使用include来引用外部文件</span>
</span></span><span class=line><span class=cl>    <span class=na>include</span>       <span class=s>mime.types;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 指定默认MIME类型</span>
</span></span><span class=line><span class=cl>    <span class=na>default_type</span>  <span class=s>application/octet-stream;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 定义日志的输出格式，使用$来进行变量引用</span>
</span></span><span class=line><span class=cl>    <span class=c1>#log_format  main  &#39;$remote_addr - $remote_user [$time_local] &#34;$request&#34; &#39;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#                  &#39;$status $body_bytes_sent &#34;$http_referer&#34; &#39;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#                  &#39;&#34;$http_user_agent&#34; &#34;$http_x_forwarded_for&#34;&#39;;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 定义访问日志的存放位置</span>
</span></span><span class=line><span class=cl>    <span class=na>access_log</span>  <span class=s>logs/access.log  main;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 是否开启系统调用方法sendfile(),开启后可以直接在内核空间完成文件的发送，即零拷贝</span>
</span></span><span class=line><span class=cl>    <span class=na>sendfile</span>        <span class=s>on;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 是否开启Socket选项,它只有在sendfile启用后才会生效</span>
</span></span><span class=line><span class=cl>    <span class=na>tcp_nopush</span>     <span class=s>on;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 连接超时时间</span>
</span></span><span class=line><span class=cl>    <span class=na>keepalive_timeout</span>  <span class=s>65;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 开启文件压缩</span>
</span></span><span class=line><span class=cl>       <span class=na>gzip</span>  <span class=s>on;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 配置nginx服务器(虚拟主机)</span>
</span></span><span class=line><span class=cl>    <span class=na>server</span> <span class=s>{</span>
</span></span><span class=line><span class=cl>        <span class=c1># 监听端口</span>
</span></span><span class=line><span class=cl>        <span class=na>listen</span>       <span class=s>80;</span>
</span></span><span class=line><span class=cl>        <span class=na>server_name</span>  <span class=s>localhost;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 默认字符集</span>
</span></span><span class=line><span class=cl>        <span class=na>charset</span> <span class=s>koi8-r;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 配置当前虚拟主机的访问日志的存放位置</span>
</span></span><span class=line><span class=cl>        <span class=na>access_log</span>  <span class=s>logs/host.access.log  main;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 虚拟主机对应的映射目录</span>
</span></span><span class=line><span class=cl>        <span class=na>location</span> <span class=s>/ {</span>
</span></span><span class=line><span class=cl>            <span class=na>root</span>   <span class=s>html;</span>
</span></span><span class=line><span class=cl>            <span class=na>index</span>  <span class=s>index.html index.htm;</span>
</span></span><span class=line><span class=cl><span class=err>        }</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 错误重定向页面</span>
</span></span><span class=line><span class=cl>        <span class=c1># error_page  404              /404.html;</span>
</span></span><span class=line><span class=cl>        <span class=na>error_page</span>   <span class=s>500 502 503 504  /50x.html;</span>
</span></span><span class=line><span class=cl>        <span class=na>location</span> <span class=o>=</span> <span class=s>/50x.html {</span>
</span></span><span class=line><span class=cl>            <span class=na>root</span>   <span class=s>html;</span>
</span></span><span class=line><span class=cl><span class=err>        }</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 禁止访问根目录下以ht结尾的文件</span>
</span></span><span class=line><span class=cl>        <span class=na>location</span> <span class=s>~ /\.ht {</span>
</span></span><span class=line><span class=cl>            <span class=na>deny</span>  <span class=s>all;</span>
</span></span><span class=line><span class=cl><span class=err>        }</span>
</span></span><span class=line><span class=cl><span class=err>    }</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 支持配置多台虚拟主机</span>
</span></span><span class=line><span class=cl>    <span class=c1>#server {</span>
</span></span><span class=line><span class=cl>    <span class=c1>#    listen       8000;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#    listen       somename:8080;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#    server_name  somename  alias  another.alias;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>#    location / {</span>
</span></span><span class=line><span class=cl>    <span class=c1>#        root   html;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#        index  index.html index.htm;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#    }</span>
</span></span><span class=line><span class=cl>    <span class=c1>#}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 配置Https服务</span>
</span></span><span class=line><span class=cl>    <span class=na>server</span> <span class=s>{</span>
</span></span><span class=line><span class=cl>        <span class=na>listen</span>       <span class=s>443 ssl;</span>
</span></span><span class=line><span class=cl>        <span class=na>server_name</span>  <span class=s>localhost;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 指定数字证书</span>
</span></span><span class=line><span class=cl>        <span class=na>ssl_certificate</span>      <span class=s>cert.pem;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 指定密匙</span>
</span></span><span class=line><span class=cl>        <span class=na>ssl_certificate_key</span>  <span class=s>cert.key;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 设置存储session的缓存类型和大小</span>
</span></span><span class=line><span class=cl>        <span class=na>ssl_session_cache</span>    <span class=s>shared:SSL:1m;</span>
</span></span><span class=line><span class=cl>        <span class=c1># session缓存时间</span>
</span></span><span class=line><span class=cl>        <span class=na>ssl_session_timeout</span>  <span class=s>5m;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 返回客户端支持的密码列表</span>
</span></span><span class=line><span class=cl>        <span class=na>ssl_ciphers</span>  <span class=s>HIGH:!aNULL:!MD5;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 指定在使用SSLv3和TLS协议时，服务器密码应优先于客户端密码</span>
</span></span><span class=line><span class=cl>        <span class=na>ssl_prefer_server_ciphers</span>  <span class=s>on;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=na>location</span> <span class=s>/ {</span>
</span></span><span class=line><span class=cl>            <span class=na>root</span>   <span class=s>html;</span>
</span></span><span class=line><span class=cl>            <span class=na>index</span>  <span class=s>index.html index.htm;</span>
</span></span><span class=line><span class=cl><span class=err>        }</span>
</span></span><span class=line><span class=cl><span class=err>    }</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span></code></pre></div><h2 id=四部署静态网站>四、部署静态网站</h2><p>Nginx 通常用作 HTTP 服务器来部署静态资源，其具体的操作步骤如下：</p><h3 id=41-增加配置>4.1 增加配置</h3><p>修改 <code>nginx.conf</code> ，并在 http 指令块中增加如下配置：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl> <span class=na>server</span> <span class=s>{</span>
</span></span><span class=line><span class=cl>    <span class=c1># 监听端口号</span>
</span></span><span class=line><span class=cl>    <span class=na>listen</span> <span class=s>9010;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 如果有域名的话，可以在这里进行配置</span>
</span></span><span class=line><span class=cl>    <span class=na>server_name</span> <span class=s>_;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 存放静态页面的目录</span>
</span></span><span class=line><span class=cl>    <span class=na>root</span> <span class=s>/usr/web;</span>
</span></span><span class=line><span class=cl>    <span class=c1># 主页面</span>
</span></span><span class=line><span class=cl>    <span class=na>index</span> <span class=s>index.html;</span>
</span></span><span class=line><span class=cl><span class=err>   }</span>
</span></span></code></pre></div><p>在 <code>/usr/web</code> 目录下新建一个测试页面 index.html，内容如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;en&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;UTF-8&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span>
</span></span><span class=line><span class=cl>      <span class=na>name</span><span class=o>=</span><span class=s>&#34;viewport&#34;</span>
</span></span><span class=line><span class=cl>      <span class=na>content</span><span class=o>=</span><span class=s>&#34;width=device-width, user-scalable=no, initial-scale=1.0,
</span></span></span><span class=line><span class=cl><span class=s>         maximum-scale=1.0, minimum-scale=1.0&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>http-equiv</span><span class=o>=</span><span class=s>&#34;X-UA-Compatible&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;ie=edge&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Nginx静态资源网站<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;text-align: center&#34;</span><span class=p>&gt;</span>Nginx静态资源网站<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=42-检查配置>4.2 检查配置</h3><p>使用 <code>-t</code> 参数来检查配置，出现 successful 则代表配置正确：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>root@node1 web<span class=o>]</span><span class=c1># nginx -t -c conf/nginx.conf</span>
</span></span><span class=line><span class=cl>nginx: the configuration file /usr/app/nginx-1.16.1/conf/nginx.conf syntax is ok
</span></span><span class=line><span class=cl>nginx: configuration file /usr/app/nginx-1.16.1/conf/nginx.conf <span class=nb>test</span> is successful
</span></span></code></pre></div><h3 id=43-重载配置>4.3 重载配置</h3><p>启动 Nginx ，如果 Nginx 已经启动，可以使用如下命令重载配置：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>nginx -s reload
</span></span></code></pre></div><p>访问 http://hostname:9010/index.html ，即可查看到静态网站首页。</p><h2 id=五实现负载均衡>五、实现负载均衡</h2><h3 id=51-部署后台服务>5.1 部署后台服务</h3><p>这里我使用 Docker 来部署两个 Tomcat，之后将测试项目 WAR 包分别拷贝到 <code>/usr/webapps001</code> 和 <code>/usr/webapps002</code> 两个挂载的容器卷下，程序会自动解压并运行，两个项目的端口号分别为 8080 和 8090：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>run -d  -it --privileged<span class=o>=</span><span class=nb>true</span> -v /usr/webapps01:/usr/local/tomcat/webapps <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-p 8080:8080 --name tomcat8080  96c4e536d0eb
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>run -d  -it  --privileged<span class=o>=</span><span class=nb>true</span> -v /usr/webapps02:/usr/local/tomcat/webapps <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-p 8090:8080 --name tomcat8090  96c4e536d0eb
</span></span></code></pre></div><h3 id=52-负载均衡配置>5.2 负载均衡配置</h3><p>修改 <code>nginx.conf</code> ，并在 http 指令块中增加如下配置：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=c1># 这里指令块的名称可以随意指定，只要和下面的proxy_pass的值相同即可，通常配置为项目名</span>
</span></span><span class=line><span class=cl><span class=na>upstream</span> <span class=s>springboot {</span>
</span></span><span class=line><span class=cl>    <span class=na>server</span> <span class=s>192.168.0.226:8080;</span>
</span></span><span class=line><span class=cl>    <span class=na>server</span> <span class=s>192.168.0.226:8090;</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=na>server</span> <span class=s>{</span>
</span></span><span class=line><span class=cl>    <span class=na>listen</span> <span class=s>9020;</span>
</span></span><span class=line><span class=cl>    <span class=na>location</span> <span class=s>/ {</span>
</span></span><span class=line><span class=cl>        <span class=na>proxy_pass</span> <span class=s>http://springboot;</span>
</span></span><span class=line><span class=cl><span class=err>    }</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span></code></pre></div><p>重载配置后，打开浏览器，通过 9020 端口访问项目，此时 Nginx 会以轮询的方式将请求分发到 8080 和 8090 端口上。在测试负载均衡策略的时候，最好将浏览器的缓存功能关闭，避免造成影响。</p><h3 id=53-负载均衡策略>5.3 负载均衡策略</h3><p>在上面的配置中，我们没有配置任何负载均衡策略，默认采用的是轮询策略，除此之外，Nginx 还支持以下负载均衡策略：</p><h4 id=1-权重策略--weighted-load-balancing->1. 权重策略 ( Weighted load balancing )</h4><p>通过为不同的服务分配不同的权重来进行转发，配置示例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=na>upstream</span> <span class=s>myapp1 {</span>
</span></span><span class=line><span class=cl>    <span class=na>server</span> <span class=s>srv1.example.com weight=3;</span>
</span></span><span class=line><span class=cl>    <span class=na>server</span> <span class=s>srv2.example.com weight=2;</span>
</span></span><span class=line><span class=cl>    <span class=na>server</span> <span class=s>srv3.example.com;</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span></code></pre></div><h4 id=2-最少连接策略--least-connected-load-balancing->2. 最少连接策略 ( Least connected load balancing )</h4><p>将请求转发给连接数最少的服务，配置实例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=na>upstream</span> <span class=s>myapp1 {</span>
</span></span><span class=line><span class=cl><span class=err>    least_conn;</span>
</span></span><span class=line><span class=cl>    <span class=na>server</span> <span class=s>srv1.example.com;</span>
</span></span><span class=line><span class=cl>    <span class=na>server</span> <span class=s>srv2.example.com;</span>
</span></span><span class=line><span class=cl>    <span class=na>server</span> <span class=s>srv3.example.com;</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span></code></pre></div><h4 id=3-ip-策略--ip-hash-load-balancing->3. IP 策略 ( IP Hash load balancing )</h4><p>通过对请求的 IP 地址进行哈希运算并取模来决定转发对象，配置示例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=na>upstream</span> <span class=s>myapp1 {</span>
</span></span><span class=line><span class=cl><span class=err>    ip_hash;</span>
</span></span><span class=line><span class=cl>    <span class=na>server</span> <span class=s>srv1.example.com;</span>
</span></span><span class=line><span class=cl>    <span class=na>server</span> <span class=s>srv2.example.com;</span>
</span></span><span class=line><span class=cl>    <span class=na>server</span> <span class=s>srv3.example.com;</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span></code></pre></div><p>以上是 Nginx 内置的基础的负载均衡策略，如果想要实现其他更加复杂的负载均衡策略，可以通过第三方模块来实现。</p><h3 id=44-声明备用服务>4.4 声明备用服务</h3><p>在上面任何负载均衡策略当中，都可以通过 backup 参数来添加备用服务，示例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>server backup1.example.com:8080   backup<span class=p>;</span>
</span></span></code></pre></div><p>处于备用状态下的服务并不会参与负载均衡，除非所有主服务都已宕机，此时 Nginx 才会将请求转发到备用服务上。</p><h2 id=六实现动静分离>六、实现动静分离</h2><h3 id=61-动静分离配置>6.1 动静分离配置</h3><p>Nginx 能够支持高并发的访问，并具有静态资源缓存等特性，因此相比于 Tomcat 等动态资源应用服务器，其更加适合于部署静态资源。想要实现动静分离，只需要在 server 指令块中通过正则表达式来划分静态资源，并指定其存放位置，示例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>    listen 9020<span class=p>;</span>
</span></span><span class=line><span class=cl>    location / <span class=o>{</span>
</span></span><span class=line><span class=cl>        proxy_pass http://springboot<span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=c1># 通过正则来控制所需要分离的静态资源</span>
</span></span><span class=line><span class=cl>    location ~ .*<span class=se>\.</span><span class=o>(</span>html<span class=p>|</span>htm<span class=p>|</span>gif<span class=p>|</span>jpg<span class=p>|</span>jpeg<span class=p>|</span>bmp<span class=p>|</span>png<span class=p>|</span>ico<span class=p>|</span>txt<span class=p>|</span>js<span class=p>|</span>css<span class=o>)</span>$ <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1># 静态资源存放目录</span>
</span></span><span class=line><span class=cl>        root /usr/resources/<span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=62-常见配置异常>6.2 常见配置异常</h3><h4 id=1-no-such-file-or-directory>1. No such file or directory</h4><p>第一个常见的问题是找不到静态资源，此时可以查看 logs 目录下的 <code>error.log</code> 日志，通常输出如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>2019/09/01 17:12:43 <span class=o>[</span>error<span class=o>]</span> 12402#0: *163 open<span class=o>()</span> <span class=s2>&#34;/usr/resources/spring-boot-tomcat/css/show.css&#34;</span>
</span></span><span class=line><span class=cl>failed <span class=o>(</span>2: No such file or directory<span class=o>)</span>, client: 192.168.0.106, server: ,
</span></span><span class=line><span class=cl>request: <span class=s2>&#34;GET /spring-boot-tomcat/css/show.css HTTP/1.1&#34;</span>, host: <span class=s2>&#34;192.168.0.226:9020&#34;</span>,
</span></span><span class=line><span class=cl>referrer: <span class=s2>&#34;http://192.168.0.226:9020/spring-boot-tomcat/index&#34;</span>
</span></span></code></pre></div><p>出现这个问题，是因为 Nginx 要求静态资源的请求路径必须和原有请求路径完全相同，这里我的项目在 Tomcat 中解压后的项目名为 <code>pring-boot-tomcat</code>，以 show.css 文件为例，其正确的存储路径应该为：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>/usr/resources/spring-boot-tomcat/css/show.css
</span></span></code></pre></div><p>即： 静态资源根目录 + 项目名 + 原有路径，通常我们在创建目录时会忽略掉项目名这一层级，从而导致异常。</p><h4 id=2-permission-denied>2. Permission denied</h4><p>路径正确后，另外一个常见的问题是权限不足，错误日志如下。此时需要保证配置文件中的 user 用户必须具有静态资源所处目录的访问权限，或者在创建静态资源目录时，直接使用 user 配置的用户来创建：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>2019/09/01 17:15:14 <span class=o>[</span>error<span class=o>]</span> 12402#0: *170 open<span class=o>()</span> <span class=s2>&#34;/usr/resources/spring-boot-tomcat/css/show.css&#34;</span>
</span></span><span class=line><span class=cl>failed <span class=o>(</span>13: Permission denied<span class=o>)</span>, client: 192.168.0.106, server: ,
</span></span><span class=line><span class=cl>request: <span class=s2>&#34;GET /spring-boot-tomcat/css/show.css HTTP/1.1&#34;</span>, host: <span class=s2>&#34;192.168.0.226:9020&#34;</span>,
</span></span><span class=line><span class=cl>referrer: <span class=s2>&#34;http://192.168.0.226:9020/spring-boot-tomcat/index&#34;</span>
</span></span></code></pre></div><h1 id=参考资料>参考资料</h1><p>官方文档：<a href=http://nginx.org/en/docs/ target=_blank rel=noopener>nginx documentation</a> ，<a href=http://nginx.org/en/docs/http/load_balancing.html target=_blank rel=noopener>Using nginx as HTTP load balancer</a></p></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>上一页</div><a href=/books/awesome-cheatsheets/3.system/microcn/microservice-cheatsheet/ rel=next>MicroService-CheatSheet</a></div></div></div><div class=body-footer><p>最近更新于 2023-04-07</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>