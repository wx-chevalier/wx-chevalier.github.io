<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="Java Concurrent Programming CheatSheet 当出现线程活跃性问题时，我们可以借助一些工具进行诊断: Jstack。通过 jstack 命令，获取线程执行信息，找出其中的线程阻塞和死锁问题。 Heap dump。通过 jmap 命令 dump 出当前的 jvm 堆栈信息，然后使用内存分析工具"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/awesome-cheatsheets/language/zoo/java/java-concurrentprogramming-cheatsheet/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/awesome-cheatsheets/language/zoo/java/java-concurrentprogramming-cheatsheet/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/awesome-cheatsheets/language/zoo/java/java-concurrentprogramming-cheatsheet/"><meta property="og:title" content="Java-ConcurrentProgramming-CheatSheet | Next-gen Tech Edu"><meta property="og:description" content="Java Concurrent Programming CheatSheet 当出现线程活跃性问题时，我们可以借助一些工具进行诊断: Jstack。通过 jstack 命令，获取线程执行信息，找出其中的线程阻塞和死锁问题。 Heap dump。通过 jmap 命令 dump 出当前的 jvm 堆栈信息，然后使用内存分析工具"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><meta property="article:modified_time" content="2023-03-05T15:38:23+08:00"><title>Java-ConcurrentProgramming-CheatSheet | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=402efe9caffc9dc1532fc59f6a5457dd><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">Java</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idff7d7aca72ea4a09a65a4f97f3813816")' href=#idff7d7aca72ea4a09a65a4f97f3813816 aria-expanded=false aria-controls=idff7d7aca72ea4a09a65a4f97f3813816 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/language/zoo/>Zoo</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idff7d7aca72ea4a09a65a4f97f3813816 aria-expanded=false aria-controls=idff7d7aca72ea4a09a65a4f97f3813816><i class="fa-solid fa-angle-down" id=caret-idff7d7aca72ea4a09a65a4f97f3813816></i></a></div><ul class="nav docs-sidenav collapse show" id=idff7d7aca72ea4a09a65a4f97f3813816><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id146ad16b1ca7a2a10910e3ebdfe17938")' href=#id146ad16b1ca7a2a10910e3ebdfe17938 aria-expanded=false aria-controls=id146ad16b1ca7a2a10910e3ebdfe17938 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/language/zoo/c/>C</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id146ad16b1ca7a2a10910e3ebdfe17938 aria-expanded=false aria-controls=id146ad16b1ca7a2a10910e3ebdfe17938><i class="fa-solid fa-angle-right" id=caret-id146ad16b1ca7a2a10910e3ebdfe17938></i></a></div><ul class="nav docs-sidenav collapse" id=id146ad16b1ca7a2a10910e3ebdfe17938><li class="child level"><a href=/books/awesome-cheatsheets/language/zoo/c/cpp-cheatsheet/>CPP-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/language/zoo/c/morten-cpp-cheatsheet/>Morten-CPP-CheatSheet</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idbb491fd92ce43c9bb4f44a8fd3289f94")' href=#idbb491fd92ce43c9bb4f44a8fd3289f94 aria-expanded=false aria-controls=idbb491fd92ce43c9bb4f44a8fd3289f94 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/language/zoo/go/>Go</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idbb491fd92ce43c9bb4f44a8fd3289f94 aria-expanded=false aria-controls=idbb491fd92ce43c9bb4f44a8fd3289f94><i class="fa-solid fa-angle-right" id=caret-idbb491fd92ce43c9bb4f44a8fd3289f94></i></a></div><ul class="nav docs-sidenav collapse" id=idbb491fd92ce43c9bb4f44a8fd3289f94><li class="child level"><a href=/books/awesome-cheatsheets/language/zoo/go/go-cheatsheet/>Go-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/language/zoo/go/go-concurrentprogramming-cheatsheet/>Go-ConcurrentProgramming-CheatSheet</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id726be5e823a78c8c7cf54077d88dea93")' href=#id726be5e823a78c8c7cf54077d88dea93 aria-expanded=false aria-controls=id726be5e823a78c8c7cf54077d88dea93 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/language/zoo/java/>Java</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id726be5e823a78c8c7cf54077d88dea93 aria-expanded=false aria-controls=id726be5e823a78c8c7cf54077d88dea93><i class="fa-solid fa-angle-down" id=caret-id726be5e823a78c8c7cf54077d88dea93></i></a></div><ul class="nav docs-sidenav collapse show" id=id726be5e823a78c8c7cf54077d88dea93><li class="child level"><a href=/books/awesome-cheatsheets/language/zoo/java/gradle-cheatsheet/>Gradle-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/language/zoo/java/java-cheatsheet/>Java-CheatSheet</a></li><li class="child level active"><a href=/books/awesome-cheatsheets/language/zoo/java/java-concurrentprogramming-cheatsheet/>Java-ConcurrentProgramming-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/language/zoo/java/java-styleguide-cheatsheet/>Java-StyleGuide-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/language/zoo/java/jvm-tuning-cheatsheet/>JVM-Tuning-CheatSheet</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idb1111a54c2fccd66ef7284ceb9cf85a4")' href=#idb1111a54c2fccd66ef7284ceb9cf85a4 aria-expanded=false aria-controls=idb1111a54c2fccd66ef7284ceb9cf85a4 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/language/zoo/javascript/>JavaScript</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idb1111a54c2fccd66ef7284ceb9cf85a4 aria-expanded=false aria-controls=idb1111a54c2fccd66ef7284ceb9cf85a4><i class="fa-solid fa-angle-right" id=caret-idb1111a54c2fccd66ef7284ceb9cf85a4></i></a></div><ul class="nav docs-sidenav collapse" id=idb1111a54c2fccd66ef7284ceb9cf85a4><li class="child level"><a href=/books/awesome-cheatsheets/language/zoo/javascript/dart-cheatsheet/>Dart-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/language/zoo/javascript/javascript-cheatsheet/>JavaScript-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/language/zoo/javascript/javascript-cheatsheet-en/>JavaScript-CheatSheet-en</a></li><li class="child level"><a href=/books/awesome-cheatsheets/language/zoo/javascript/typescript-cheatsheet/>TypeScript-CheatSheet</a></li><li class="child level"><a href=/books/awesome-cheatsheets/language/zoo/javascript/v8-cheatsheet/>V8-CheatSheet</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ide845c45237049459862112286be20750")' href=#ide845c45237049459862112286be20750 aria-expanded=false aria-controls=ide845c45237049459862112286be20750 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/language/zoo/python/>Python</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ide845c45237049459862112286be20750 aria-expanded=false aria-controls=ide845c45237049459862112286be20750><i class="fa-solid fa-angle-right" id=caret-ide845c45237049459862112286be20750></i></a></div><ul class="nav docs-sidenav collapse" id=ide845c45237049459862112286be20750><li class="child level"><a href=/books/awesome-cheatsheets/language/zoo/python/python-cheatsheet/>Python-CheatSheet</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id8f16262a9e5aae6fa58b2410a606ee5f")' href=#id8f16262a9e5aae6fa58b2410a606ee5f aria-expanded=false aria-controls=id8f16262a9e5aae6fa58b2410a606ee5f aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/language/zoo/ruby/>Ruby</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id8f16262a9e5aae6fa58b2410a606ee5f aria-expanded=false aria-controls=id8f16262a9e5aae6fa58b2410a606ee5f><i class="fa-solid fa-angle-right" id=caret-id8f16262a9e5aae6fa58b2410a606ee5f></i></a></div><ul class="nav docs-sidenav collapse" id=id8f16262a9e5aae6fa58b2410a606ee5f><li class="child level"><a href=/books/awesome-cheatsheets/language/zoo/ruby/ruby-cheatsheet/>Ruby-CheatSheet</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id1ff356fda035dd1a0f899a872e6d4758")' href=#id1ff356fda035dd1a0f899a872e6d4758 aria-expanded=false aria-controls=id1ff356fda035dd1a0f899a872e6d4758 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/language/zoo/rust/>Rust</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id1ff356fda035dd1a0f899a872e6d4758 aria-expanded=false aria-controls=id1ff356fda035dd1a0f899a872e6d4758><i class="fa-solid fa-angle-right" id=caret-id1ff356fda035dd1a0f899a872e6d4758></i></a></div><ul class="nav docs-sidenav collapse" id=id1ff356fda035dd1a0f899a872e6d4758><li class="child level"><a href=/books/awesome-cheatsheets/language/zoo/rust/rust-cheatsheet/>Rust-CheatSheet</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id19617781a15c41a12aead38291689824")' href=#id19617781a15c41a12aead38291689824 aria-expanded=false aria-controls=id19617781a15c41a12aead38291689824 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/awesome-cheatsheets/language/zoo/swift/>Swift</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id19617781a15c41a12aead38291689824 aria-expanded=false aria-controls=id19617781a15c41a12aead38291689824><i class="fa-solid fa-angle-right" id=caret-id19617781a15c41a12aead38291689824></i></a></div><ul class="nav docs-sidenav collapse" id=id19617781a15c41a12aead38291689824><li class="child level"><a href=/books/awesome-cheatsheets/language/zoo/swift/swift-cheatsheet/>Swift-CheatSheet</a></li></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#threads--runnables>Threads & Runnables</a></li></ul><ul><li><a href=#executors>Executors</a></li><li><a href=#forkjoin>Fork/Join</a></li></ul><ul><li><a href=#atomic-variables--原子性与原子变量>Atomic Variables | 原子性与原子变量</a></li><li><a href=#volatile--可见性保障>volatile | 可见性保障</a></li><li><a href=#countdownlatch>CountDownLatch</a></li></ul><ul><li><a href=#semaphore>Semaphore</a></li><li><a href=#lock>Lock</a></li></ul><ul><li><a href=#callable--future>Callable & Future</a></li><li><a href=#completablefuture>CompletableFuture</a></li><li><a href=#rxjava>RxJava</a></li></ul><ul><li><a href=#concurrenthashmap>ConcurrentHashMap</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>Java-ConcurrentProgramming-CheatSheet</h1><div class=article-style><h1 id=java-concurrent-programming-cheatsheet>Java Concurrent Programming CheatSheet</h1><p>当出现线程活跃性问题时，我们可以借助一些工具进行诊断:</p><ul><li><p>Jstack。通过 jstack 命令，获取线程执行信息，找出其中的线程阻塞和死锁问题。</p></li><li><p>Heap dump。通过 jmap 命令 dump 出当前的 jvm 堆栈信息，然后使用内存分析工具识别线程阻塞和死锁。</p></li><li><p>Arthas。作为阿里开源的 Java 诊断利器，arthas 也提供了线程分析诊断功能, 可以通过 arthas 的 thread 命令，查找出当前阻塞的线程。</p></li></ul><p>java.util.concurrent 包提供了一系列的并发工具类，让我们能够站在巨人的肩膀上，更加高效地实现并发程序。需要注意的是，我们一定要在正确地理解了当前所要处理的并发问题，以及工具类的机制原理之后，再去选择相应的并发工具类。如果只是一知半解就去盲目使用，很可能会给自己挖坑。</p><h1 id=concurrent-primitive--并发单元>Concurrent Primitive | 并发单元</h1><p>常见的 Runnable、Callable、Future、FutureTask 这几个与线程相关的类或者接口：</p><ul><li><p>Runnable 应该是我们最熟悉的接口，它只有一个 run()函数，用于将耗时操作写在其中，该函数没有返回值。然后使用某个线程去执行该 runnable 即可实现多线程，Thread 类在调用 start()函数后就是执行的是 Runnable 的 run()函数。</p></li><li><p>Callable 与 Runnable 的功能大致相似，Callable 中有一个 call()函数，但是 call()函数有返回值，而 Runnable 的 run()函数不能将结果返回给客户程序。</p></li><li><p>Executor 就是 Runnable 和 Callable 的调度容器，Future 就是对于具体的 Runnable 或者 Callable 任务的执行结果进行取消、查询是否完成、获取结果、设置结果操作。get 方法会阻塞，直到任务返回结果。</p></li><li><p>FutureTask 则是一个 RunnableFuture<v>，而 RunnableFuture 实现了 Runnbale 又实现了 Futrue<v> 这两个接口。</p></li></ul><h2 id=threads--runnables>Threads & Runnables</h2><h1 id=thread-pool--线程池>Thread Pool | 线程池</h1><h2 id=executors>Executors</h2><p>在并发程序中，线程的创建和管理是一个重要的命题。实际的生产代码中，不能为每一个任务就创建一个线程，也就是不能出现 new Thread(runnable).start()这样的代码，因为线程是昂贵的系统资源，不能无节制地创建，需要使用线程池对线程进行管理。Excutor 类支持了线程资源的管理和多线程任务的调度。可以使用 Executors 中的静态方法之一来创建一种线程池(newFixedThreadPool、newCachedThreadPool、newSingleThreadPool、newScheduledThreadPool 等)，可以使用 Runalbe、Callable 来提交并发任务，Excutor 类会自己负责任务的调度，解耦了任务的提交和执行。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Callable</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>task</span> <span class=o>=</span> <span class=o>()</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>TimeUnit</span><span class=o>.</span><span class=na>SECONDS</span><span class=o>.</span><span class=na>sleep</span><span class=o>(</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>123</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=o>(</span><span class=s>&#34;task interrupted&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ExecutorService</span> <span class=n>executor</span> <span class=o>=</span> <span class=n>Executors</span><span class=o>.</span><span class=na>newFixedThreadPool</span><span class=o>(</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>Future</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>future</span> <span class=o>=</span> <span class=n>executor</span><span class=o>.</span><span class=na>submit</span><span class=o>(</span><span class=n>task</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;future done? &#34;</span> <span class=o>+</span> <span class=n>future</span><span class=o>.</span><span class=na>isDone</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Integer</span> <span class=n>result</span> <span class=o>=</span> <span class=n>future</span><span class=o>.</span><span class=na>get</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;future done? &#34;</span> <span class=o>+</span> <span class=n>future</span><span class=o>.</span><span class=na>isDone</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>print</span><span class=o>(</span><span class=s>&#34;result: &#34;</span> <span class=o>+</span> <span class=n>result</span><span class=o>);</span>
</span></span></code></pre></div><p>在使用 Excutor 时，如果线程池的任务之间存在依赖，线程池中的某些任务需要无限期地等待一些其它任务提供的资源；或者某些任务运行耗时较长，其它任务得不到运行资源，则会出现线程饥饿，引发活跃性问题，需要避免。</p><h2 id=forkjoin>Fork/Join</h2><h1 id=线程协作>线程协作</h1><h2 id=atomic-variables--原子性与原子变量>Atomic Variables | 原子性与原子变量</h2><p>从 Java5.0 开始，提供了一组原子类变量(例如 AtomicInteger,AtomicLong,AtomicBoolean,AtomicReference 等)，来支持对单个变量的原子性操作。内置的监视器锁，是一种悲观锁，任何时候只有一个线程可以持有该锁，其它想获取该锁的线程必须阻塞等待。而 Atomic 类提供了一种乐观机制，任何线程都可以尝试获取资源并更新，如果在更新的过程中存在来自其它线程的干扰，那么这个操作将失败并可以重试。</p><p>Atomic 的实现依赖于处理器提供的 CAS(Compare and Swap)指令。CAS 是一个原子性操作，包含三个操作数：需要读写的内存位置 V、旧值 A 和拟写入的新值 B。线程读取 V 的值，如果等于 A，则将 V 的值更新为 B，返回成功，否则返回失败。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@ThreadSafe</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SafeSequence</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=n>AtomicInteger</span> <span class=n>value</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * Returns a unique value.
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>int</span> <span class=nf>getNext</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>value</span><span class=o>.</span><span class=na>getAndIncrement</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>相对于内置的监视器锁，Atomic 更加地轻量和高效，不存在死锁和活跃性问题。其主要劣势在于，需要调用者来处理竞争问题，决定在 CAS 操作失败时是重试、回退还是放弃。</p><h2 id=volatile--可见性保障>volatile | 可见性保障</h2><h2 id=countdownlatch>CountDownLatch</h2><p>CountDownLatch 可以用来保证某些活动直到其它活动都完成之后才继续执行。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>TestHarness</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>long</span> <span class=nf>timeTasks</span><span class=o>(</span><span class=kt>int</span> <span class=n>nThreads</span><span class=o>,</span> <span class=kd>final</span> <span class=n>Runnable</span> <span class=n>task</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>final</span> <span class=n>CountDownLatch</span> <span class=n>startGate</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CountDownLatch</span><span class=o>(</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>final</span> <span class=n>CountDownLatch</span> <span class=n>endGate</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CountDownLatch</span><span class=o>(</span><span class=n>nThreads</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>nThreads</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Thread</span> <span class=n>t</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Thread</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>startGate</span><span class=o>.</span><span class=na>await</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                            <span class=n>task</span><span class=o>.</span><span class=na>run</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                        <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                            <span class=n>endGate</span><span class=o>.</span><span class=na>countDown</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                        <span class=o>}</span>
</span></span><span class=line><span class=cl>                    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>InterruptedException</span> <span class=n>ignored</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=o>}</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>};</span>
</span></span><span class=line><span class=cl>            <span class=n>t</span><span class=o>.</span><span class=na>start</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>long</span> <span class=n>start</span> <span class=o>=</span> <span class=n>System</span><span class=o>.</span><span class=na>nanoTime</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>startGate</span><span class=o>.</span><span class=na>countDown</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>endGate</span><span class=o>.</span><span class=na>await</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>long</span> <span class=n>end</span> <span class=o>=</span> <span class=n>System</span><span class=o>.</span><span class=na>nanoTime</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>end</span> <span class=o>-</span> <span class=n>start</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span></code></pre></div><h1 id=锁与互斥>锁与互斥</h1><h2 id=semaphore>Semaphore</h2><p>信号量 Semaphore，用来控制同时访问某个特定资源的操作数量。Semaphore 中管理着一组虚拟许可，如果没有许可，则 acquire 操作将阻塞直到有许可。可以把锁看做一种特殊的二元信号量。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>BoundedHashSet</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>final</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>set</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>final</span> <span class=n>Semaphore</span> <span class=n>sem</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=nf>BoundedHashSet</span><span class=o>(</span><span class=kt>int</span> <span class=n>bound</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>.</span><span class=na>set</span> <span class=o>=</span> <span class=n>Collections</span><span class=o>.</span><span class=na>synchronizedSet</span><span class=o>(</span><span class=k>new</span> <span class=n>HashSet</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;());</span>
</span></span><span class=line><span class=cl>    <span class=n>sem</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Semaphore</span><span class=o>(</span><span class=n>bound</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>add</span><span class=o>(</span><span class=n>T</span> <span class=n>o</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>sem</span><span class=o>.</span><span class=na>acquire</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=kt>boolean</span> <span class=n>wasAdded</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>wasAdded</span> <span class=o>=</span> <span class=n>set</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>o</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>wasAdded</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=o>(!</span><span class=n>wasAdded</span><span class=o>)</span> <span class=n>sem</span><span class=o>.</span><span class=na>release</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>remove</span><span class=o>(</span><span class=n>Object</span> <span class=n>o</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>boolean</span> <span class=n>wasRemoved</span> <span class=o>=</span> <span class=n>set</span><span class=o>.</span><span class=na>remove</span><span class=o>(</span><span class=n>o</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>wasRemoved</span><span class=o>)</span> <span class=n>sem</span><span class=o>.</span><span class=na>release</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>wasRemoved</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=lock>Lock</h2><p>Lock 类提供了一种可轮询的、定时的以及可中断的锁获取操作，当内置锁无法满足使用场景的要求时，可以考虑使用显式的 Lock。举一个带有时间限制的 Lock 示例:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>TimedLocking</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=n>Lock</span> <span class=n>lock</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ReentrantLock</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>trySendOnSharedLine</span><span class=o>(</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>message</span><span class=o>,</span>
</span></span><span class=line><span class=cl>    <span class=kt>long</span> <span class=n>timeout</span><span class=o>,</span>
</span></span><span class=line><span class=cl>    <span class=n>TimeUnit</span> <span class=n>unit</span>
</span></span><span class=line><span class=cl>  <span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>throws</span> <span class=n>InterruptedException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>long</span> <span class=n>nanosToLock</span> <span class=o>=</span> <span class=n>unit</span><span class=o>.</span><span class=na>toNanos</span><span class=o>(</span><span class=n>timeout</span><span class=o>)</span> <span class=o>-</span> <span class=n>estimatedNanosToSend</span><span class=o>(</span><span class=n>message</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(!</span><span class=n>lock</span><span class=o>.</span><span class=na>tryLock</span><span class=o>(</span><span class=n>nanosToLock</span><span class=o>,</span> <span class=n>NANOSECONDS</span><span class=o>))</span> <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>sendOnSharedLine</span><span class=o>(</span><span class=n>message</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>finally</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>lock</span><span class=o>.</span><span class=na>unlock</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h1 id=async-programming--异步编程>Async Programming | 异步编程</h1><h2 id=callable--future>Callable & Future</h2><h2 id=completablefuture>CompletableFuture</h2><h2 id=rxjava>RxJava</h2><h1 id=built-in-threadsafe-datastructure--内置的线程安全模型>Built-in ThreadSafe DataStructure | 内置的线程安全模型</h1><h2 id=concurrenthashmap>ConcurrentHashMap</h2><p>为了解决线程活跃性问题，提高并发执行效率，一种可行的方案是降低锁的粒度。ConcurrentHashMap 可以看作这种思路的优秀实践，内部使用了分段锁(Lock Striping)的方式来降低锁的粒度，使用一个包含 16 个锁的数组，每个锁保护所有哈希桶的 1/16，其中第 N 个哈希桶，由 N%16 个锁来维护。其原理如下图所示:</p><p><a href=https://postimg.cc/Y4XJgrDb target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://i.postimg.cc/vBMMJDrF/image.png alt=image.png loading=lazy data-zoomable></div></div></figure></a></p></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>上一页</div><a href=/books/awesome-cheatsheets/language/zoo/java/java-cheatsheet/ rel=next>Java-CheatSheet</a></div><div class="col-6 post-nav-item"><div class=meta-nav>下一页</div><a href=/books/awesome-cheatsheets/language/zoo/java/java-styleguide-cheatsheet/ rel=prev>Java-StyleGuide-CheatSheet</a></div></div></div><div class=body-footer><p>最近更新于 2023-03-05</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte-website.oss-accelerate.aliyuncs.com/disqus/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte-website.oss-accelerate.aliyuncs.com/disqus/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>