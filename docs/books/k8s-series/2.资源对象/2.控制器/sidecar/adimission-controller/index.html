<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="K8s Adimission Controller Admission Controller 是一个拦截器，请求通过认证之后，请求被存储起来之前拦截发送给 Kuberenetes API Server 的请求。 An admission controller is a piece of code that intercepts requests to the Kubernetes API server prior to persistence of the object, but after the request is authenticated and authorized. 简而言之，Kubernetes Admission Controller 是控制和强制使用集群的"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/sidecar/adimission-controller/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/sidecar/adimission-controller/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/sidecar/adimission-controller/"><meta property="og:title" content="Adimission Controller | Next-gen Tech Edu"><meta property="og:description" content="K8s Adimission Controller Admission Controller 是一个拦截器，请求通过认证之后，请求被存储起来之前拦截发送给 Kuberenetes API Server 的请求。 An admission controller is a piece of code that intercepts requests to the Kubernetes API server prior to persistence of the object, but after the request is authenticated and authorized. 简而言之，Kubernetes Admission Controller 是控制和强制使用集群的"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>Adimission Controller | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=0d21116255c92c2eabedaf51996ca638><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">SideCar</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idd76e88f3c85b50681cec56567cb12555")' href=#idd76e88f3c85b50681cec56567cb12555 aria-expanded=false aria-controls=idd76e88f3c85b50681cec56567cb12555 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/>2.控制器</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idd76e88f3c85b50681cec56567cb12555 aria-expanded=false aria-controls=idd76e88f3c85b50681cec56567cb12555><i class="fa-solid fa-angle-down" id=caret-idd76e88f3c85b50681cec56567cb12555></i></a></div><ul class="nav docs-sidenav collapse show" id=idd76e88f3c85b50681cec56567cb12555><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id5d7a607396bfd727ad325095430f82b8")' href=#id5d7a607396bfd727ad325095430f82b8 aria-expanded=false aria-controls=id5d7a607396bfd727ad325095430f82b8 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/ambassador/>Ambassador</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id5d7a607396bfd727ad325095430f82b8 aria-expanded=false aria-controls=id5d7a607396bfd727ad325095430f82b8><i class="fa-solid fa-angle-right" id=caret-id5d7a607396bfd727ad325095430f82b8></i></a></div><ul class="nav docs-sidenav collapse" id=id5d7a607396bfd727ad325095430f82b8><li class="child level"><a href=/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/ambassador/k3s-%E7%BB%93%E5%90%88-ambassador-%E9%83%A8%E7%BD%B2/>K3s 结合 Ambassador 部署</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ide306c6dace7182d8091cc847c4157786")' href=#ide306c6dace7182d8091cc847c4157786 aria-expanded=false aria-controls=ide306c6dace7182d8091cc847c4157786 aria-hidden=false data-toggle=collapse></div></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id8d284351c72a4290842c7848c31d0b9d")' href=#id8d284351c72a4290842c7848c31d0b9d aria-expanded=false aria-controls=id8d284351c72a4290842c7848c31d0b9d aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/deployment/>Deployment</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id8d284351c72a4290842c7848c31d0b9d aria-expanded=false aria-controls=id8d284351c72a4290842c7848c31d0b9d><i class="fa-solid fa-angle-right" id=caret-id8d284351c72a4290842c7848c31d0b9d></i></a></div><ul class="nav docs-sidenav collapse" id=id8d284351c72a4290842c7848c31d0b9d><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id8d3f428634ab4af68ef3b8dc065bd7ab")' href=#id8d3f428634ab4af68ef3b8dc065bd7ab aria-expanded=false aria-controls=id8d3f428634ab4af68ef3b8dc065bd7ab aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/deployment/%E6%A1%88%E4%BE%8B/>案例</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id8d3f428634ab4af68ef3b8dc065bd7ab aria-expanded=false aria-controls=id8d3f428634ab4af68ef3b8dc065bd7ab><i class="fa-solid fa-angle-right" id=caret-id8d3f428634ab4af68ef3b8dc065bd7ab></i></a></div><ul class="nav docs-sidenav collapse" id=id8d3f428634ab4af68ef3b8dc065bd7ab><li class="child level"><a href=/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/deployment/%E6%A1%88%E4%BE%8B/%E9%9B%86%E7%BE%A4%E5%BA%94%E7%94%A8/>集群应用</a></li><li class="child level"><a href=/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/deployment/%E6%A1%88%E4%BE%8B/%E7%AE%80%E5%8D%95%E6%97%A0%E7%8A%B6%E6%80%81%E5%BA%94%E7%94%A8/>简单无状态应用</a></li><li class="child level"><a href=/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/deployment/%E6%A1%88%E4%BE%8B/%E6%9C%89%E7%8A%B6%E6%80%81%E5%BA%94%E7%94%A8/>有状态应用</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id246f7d2faefc00f86b6114279fb41c2e")' href=#id246f7d2faefc00f86b6114279fb41c2e aria-expanded=false aria-controls=id246f7d2faefc00f86b6114279fb41c2e aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/deployment/%E5%A3%B0%E6%98%8E%E4%B8%8E%E7%AE%A1%E7%90%86/>声明与管理</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id246f7d2faefc00f86b6114279fb41c2e aria-expanded=false aria-controls=id246f7d2faefc00f86b6114279fb41c2e><i class="fa-solid fa-angle-right" id=caret-id246f7d2faefc00f86b6114279fb41c2e></i></a></div><ul class="nav docs-sidenav collapse" id=id246f7d2faefc00f86b6114279fb41c2e><li class="child level"><a href=/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/deployment/%E5%A3%B0%E6%98%8E%E4%B8%8E%E7%AE%A1%E7%90%86/daemonset/>DaemonSet</a></li><li class="child level"><a href=/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/deployment/%E5%A3%B0%E6%98%8E%E4%B8%8E%E7%AE%A1%E7%90%86/deployment/>Deployment</a></li><li class="child level"><a href=/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/deployment/%E5%A3%B0%E6%98%8E%E4%B8%8E%E7%AE%A1%E7%90%86/replicaset/>ReplicaSet</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id188d435b7392e208d1bb2f1c480d6dc2")' href=#id188d435b7392e208d1bb2f1c480d6dc2 aria-expanded=false aria-controls=id188d435b7392e208d1bb2f1c480d6dc2 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/deployment/%E9%99%90%E5%88%B6%E4%B8%8E%E8%B0%83%E5%BA%A6/>限制与调度</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id188d435b7392e208d1bb2f1c480d6dc2 aria-expanded=false aria-controls=id188d435b7392e208d1bb2f1c480d6dc2><i class="fa-solid fa-angle-right" id=caret-id188d435b7392e208d1bb2f1c480d6dc2></i></a></div><ul class="nav docs-sidenav collapse" id=id188d435b7392e208d1bb2f1c480d6dc2><li class="child level"><a href=/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/deployment/%E9%99%90%E5%88%B6%E4%B8%8E%E8%B0%83%E5%BA%A6/%E8%8A%82%E7%82%B9%E8%B0%83%E5%BA%A6/>节点调度</a></li><li class="child level"><a href=/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/deployment/%E9%99%90%E5%88%B6%E4%B8%8E%E8%B0%83%E5%BA%A6/%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6/>资源限制</a></li></ul></div></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id52b20545f44ba653eaa2f0377c5941b1")' href=#id52b20545f44ba653eaa2f0377c5941b1 aria-expanded=false aria-controls=id52b20545f44ba653eaa2f0377c5941b1 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/sidecar/>SideCar</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id52b20545f44ba653eaa2f0377c5941b1 aria-expanded=false aria-controls=id52b20545f44ba653eaa2f0377c5941b1><i class="fa-solid fa-angle-down" id=caret-id52b20545f44ba653eaa2f0377c5941b1></i></a></div><ul class="nav docs-sidenav collapse show" id=id52b20545f44ba653eaa2f0377c5941b1><li class="child level active"><a href=/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/sidecar/adimission-controller/>Adimission Controller</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idf1fa6d49ed78e44a675ee8b13380e183")' href=#idf1fa6d49ed78e44a675ee8b13380e183 aria-expanded=false aria-controls=idf1fa6d49ed78e44a675ee8b13380e183 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/stateful-set/>Stateful Set</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idf1fa6d49ed78e44a675ee8b13380e183 aria-expanded=false aria-controls=idf1fa6d49ed78e44a675ee8b13380e183><i class="fa-solid fa-angle-right" id=caret-idf1fa6d49ed78e44a675ee8b13380e183></i></a></div><ul class="nav docs-sidenav collapse" id=idf1fa6d49ed78e44a675ee8b13380e183><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ide6d52b50bb72b3f8ecd98fc15e89e211")' href=#ide6d52b50bb72b3f8ecd98fc15e89e211 aria-expanded=false aria-controls=ide6d52b50bb72b3f8ecd98fc15e89e211 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/stateful-set/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/>99.参考资料</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ide6d52b50bb72b3f8ecd98fc15e89e211 aria-expanded=false aria-controls=ide6d52b50bb72b3f8ecd98fc15e89e211><i class="fa-solid fa-angle-right" id=caret-ide6d52b50bb72b3f8ecd98fc15e89e211></i></a></div><ul class="nav docs-sidenav collapse" id=ide6d52b50bb72b3f8ecd98fc15e89e211><li class="child level"><a href=/books/k8s-series/2.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/2.%E6%8E%A7%E5%88%B6%E5%99%A8/stateful-set/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2021.kubernetes-statefulset-examples-best-practices/>2021.Kubernetes StatefulSet - Examples & Best Practices</a></li></ul></div></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>Adimission Controller</h1><div class=article-style><h1 id=k8s-adimission-controller>K8s Adimission Controller</h1><p>Admission Controller 是一个拦截器，请求通过认证之后，请求被存储起来之前拦截发送给 Kuberenetes API Server 的请求。</p><blockquote><p>An admission controller is a piece of code that intercepts requests to the Kubernetes API server prior to persistence of the object, but after the request is authenticated and authorized.</p></blockquote><p>简而言之，Kubernetes Admission Controller 是控制和强制使用集群的插件。可以将它们视为拦截（已认证）API 请求的 Gatekeeper，并且可以更改请求对象或完全拒绝该请求。准入控制过程分为两个阶段：首先执行 Mutating 阶段，然后执行 Validating 阶段。因此，Admission Controller 可以充当变异或验证控制器或两者的组合。例如，LimitRanger Admission Controller 可以使用默认资源请求和限制来扩展 Pod（更改阶段），并验证具有明确设置的资源要求的 Pod 不超过 LimitRange 对象中指定的每个命名空间限制（验证阶段）。</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://s2.ax1x.com/2020/01/01/lGDzh6.png alt="Admission Controller Phases" loading=lazy data-zoomable></div></div></figure></p><p>根据以上的流程，Kubernetes 将 AC 分为三种：</p><ul><li>validating，验证型。用于验证 K8s 的资源定义是否符合规则。</li><li>mutating，修改型。用于修改 K8s 的资源定义，比如加个 label 什么的。</li><li>二者皆是，即同一个 AC，既是验证型又是修改型。</li></ul><p>多个 Admission Controller 会形成一个 Admission Chain（链条），修改型的在前面先执行，验证型的在后面后执行，这样验证型的才能去验证修改的对不对。
我们可以查看目前启用的 AC：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ kube-apiserver -h <span class=p>|</span> grep enable-admission-plugins
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--admission-control strings              Admission is divided into two phases. In the first phase, only mutating admission plugins run. In the second phase, only validating admission plugins run. The names in the below list may represent a validating plugin, a mutating plugin, or both. The order of plugins in which they are passed to this flag does not matter. Comma-delimited list of: AlwaysAdmit, AlwaysDeny, AlwaysPullImages, DefaultStorageClass, DefaultTolerationSeconds, DenyEscalatingExec, DenyExecOnPrivileged, EventRateLimit, ExtendedResourceToleration, ImagePolicyWebhook, Initializers, LimitPodHardAntiAffinityTopology, LimitRanger, MutatingAdmissionWebhook, NamespaceAutoProvision, NamespaceExists, NamespaceLifecycle, NodeRestriction, OwnerReferencesPermissionEnforcement, PersistentVolumeClaimResize, PersistentVolumeLabel, PodNodeSelector, PodPreset, PodSecurityPolicy, PodTolerationRestriction, Priority, ResourceQuota, SecurityContextDeny, ServiceAccount, StorageObjectInUseProtection, ValidatingAdmissionWebhook. <span class=o>(</span>DEPRECATED: Use --enable-admission-plugins or --disable-admission-plugins instead. Will be removed in a future version.<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>--enable-admission-plugins strings       admission plugins that should be enabled in addition to default enabled ones <span class=o>(</span>NamespaceLifecycle, LimitRanger, ServiceAccount, Priority, DefaultTolerationSeconds, DefaultStorageClass, PersistentVolumeClaimResize, MutatingAdmissionWebhook, ValidatingAdmissionWebhook, ResourceQuota<span class=o>)</span>. Comma-delimited list of admission plugins: AlwaysAdmit, AlwaysDeny, AlwaysPullImages, DefaultStorageClass, DefaultTolerationSeconds, DenyEscalatingExec, DenyExecOnPrivileged, EventRateLimit, ExtendedResourceToleration, ImagePolicyWebhook, Initializers, LimitPodHardAntiAffinityTopology, LimitRanger, MutatingAdmissionWebhook, NamespaceAutoProvision, NamespaceExists, NamespaceLifecycle, NodeRestriction, OwnerReferencesPermissionEnforcement, PersistentVolumeClaimResize, PersistentVolumeLabel, PodNodeSelector, PodPreset, PodSecurityPolicy, PodTolerationRestriction, Priority, ResourceQuota, SecurityContextDeny, ServiceAccount, StorageObjectInUseProtection, ValidatingAdmissionWebhook. The order of plugins in this flag does not matter.
</span></span></code></pre></div><h1 id=adimission-webhook>Adimission Webhook</h1><p>Admission Controller 有着非常丰富的使用场景，譬如 Istio 就是采用 Admission Webhook 实现 SideCar 容器自动注入；我们也可以自动地为应用打标签，或者自动将 SideCar 容器注册到 Pod 中。</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://s2.ax1x.com/2020/01/01/lGrgC6.md.png alt="收集应用日志的 Sidecar 容器" loading=lazy data-zoomable></div></div></figure></p><p>Admission webhooks are HTTP callbacks that receive admission requests and do something with them. 用户可以定义两种 webhook，validating admission webhook、mutating admission webhook。一个用于验证，另一个用于修改。Webhook 回调，接收 API Server 发送的 admissionReview 请求，并返回 admissionResponse。典型的 ValidatingWebhookConfiguration 的资源定义如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>admissionregistration.k8s.io/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ValidatingWebhookConfiguration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>&lt;name of this configuration object&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>webhooks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>&lt;webhook name, e.g., pod-policy.example.io&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=s2>&#34;&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>apiVersions</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>operations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>CREATE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=l>pods</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>clientConfig</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>&lt;namespace of the front-end service&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>&lt;name of the front-end service&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>caBundle</span><span class=p>:</span><span class=w> </span><span class=l>&lt;pem encoded ca cert that signs the server cert used by the webhook&gt;</span><span class=w>
</span></span></span></code></pre></div><p>其中 rules 定义了匹配规则，当发给 API Server 的请求满足该规则的时候，API Server 就会给 clientConfig 中配置的 service 发送 Admission 请求。如果存在多个 K8s 集群，我们也可以共享 WebHook API：</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://s2.ax1x.com/2020/01/01/lGsEMF.md.png alt="WebHook API" loading=lazy data-zoomable></div></div></figure></p><p>Cluster c1、c2 中的 Webhook 配置会指向各自集群内部的 service，这个 service 其实是 headless service，它指向的是 cluster A 的 service(需要暴露给其它集群能够访问，nodePort 也可以)，这样所有集群就共享一个 Webhook API 了。</p><h1 id=编程控制>编程控制</h1><p>编写自己的 Webhook 需要完成以下步骤：</p><ul><li>创建 TLS Certificate，即证书</li><li>编写服务端代码，服务端代码需要使用证书</li><li>根据证书创建 K8s sercret</li><li>创建 K8s Deployment 和 Service</li><li>创建 K8s WebhookConfiguration，其中需要使用之前创建的证书</li></ul><p>可以参考 <a href=https://github.com/BE-Kits/k8s-examples target=_blank rel=noopener>k8s-examples/webhook</a> 中的相关示例。</p><p>AdmissionWebhook 可以像拦截器一样拦截 K8s api 请求，要实现修改功能用 MutatingAdmissionWebhook，实现验证功能用 ValidatingAdmissionWebhook。AdmissionReview 结构体 request 请求信息通过 AdmissionReview 的 Request 字段可以获取到；response 通过 AdmissionReview 的 Response 字段设置返回</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// AdmissionReview describes an admission review request/response.
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=kd>type</span> <span class=nx>AdmissionReview</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>     <span class=nx>metav1</span><span class=p>.</span><span class=nx>TypeMeta</span> <span class=s>`json:&#34;,inline&#34;`</span>
</span></span><span class=line><span class=cl>     <span class=c1>// Request describes the attributes for the admission request.
</span></span></span><span class=line><span class=cl><span class=c1></span>     <span class=c1>// +optional
</span></span></span><span class=line><span class=cl><span class=c1></span>     <span class=nx>Request</span> <span class=o>*</span><span class=nx>AdmissionRequest</span> <span class=s>`json:&#34;request,omitempty&#34; protobuf:&#34;bytes,1,opt,name=request&#34;`</span>
</span></span><span class=line><span class=cl>     <span class=c1>// Response describes the attributes for the admission response.
</span></span></span><span class=line><span class=cl><span class=c1></span>     <span class=c1>// +optional
</span></span></span><span class=line><span class=cl><span class=c1></span>     <span class=nx>Response</span> <span class=o>*</span><span class=nx>AdmissionResponse</span> <span class=s>`json:&#34;response,omitempty&#34; protobuf:&#34;bytes,2,opt,name=response&#34;`</span>
</span></span><span class=line><span class=cl> <span class=p>}</span>
</span></span></code></pre></div><p>mutating 是通过 json patch 方式实现的，对应的结构体定义如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>patchOperation</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=nx>Op</span>    <span class=kt>string</span>      <span class=s>`json:&#34;op&#34;`</span>
</span></span><span class=line><span class=cl>   <span class=nx>Path</span>  <span class=kt>string</span>      <span class=s>`json:&#34;path&#34;`</span>
</span></span><span class=line><span class=cl>   <span class=nx>Value</span> <span class=kd>interface</span><span class=p>{}</span> <span class=s>`json:&#34;value,omitempty&#34;`</span>
</span></span><span class=line><span class=cl> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=nx>patches</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>patches</span><span class=p>,</span> <span class=nx>patchOperation</span><span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=nx>Op</span><span class=p>:</span>    <span class=s>&#34;add&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>   <span class=nx>Path</span><span class=p>:</span> <span class=s>&#34;/metadata/annotations&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>   <span class=nx>Value</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl> <span class=p>})</span>
</span></span></code></pre></div></div><div class=article-widget><div class="container-xl row post-nav"></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>