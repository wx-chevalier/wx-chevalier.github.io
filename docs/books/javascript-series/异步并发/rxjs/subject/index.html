<!DOCTYPE html><html lang="zh" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.5.0 for Hugo" />
  

  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
    <meta name="google-site-verification" content="google69a5cccb61297807" />
    <meta name="baidu-site-verification" content="cqmZHEleVh" />
  
  
  
  
  

  

  
  
  
    
  
  <meta name="description" content="Subject RxJS Subject 是一种特殊类型的 Observable，它允许将值多播给多个观察者，所以 Subject 是多播的，而普通的 Observables 是单播的(每个已订阅的观察者都拥有 Observable 的独立执行)。Subject 像是 Observable，但是可以多播" />

  
  <link rel="alternate" hreflang="zh" href="https://ng-tech.icu/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/rxjs/subject/" />

  
  
  
    <meta name="theme-color" content="#0a55a7" />
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css" media="print" onload="this.media='all'">

  
  
  
    
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    

    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css" integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin="anonymous">
    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css" />

  




<script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', "G-40NYXJ8823");
</script>


  


  


  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://ng-tech.icu/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/rxjs/subject/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@wx-chevalier" />
    <meta property="twitter:creator" content="@wx-chevalier" />
  
  <meta property="og:site_name" content="Next-gen Tech Edu" />
  <meta property="og:url" content="https://ng-tech.icu/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/rxjs/subject/" />
  <meta property="og:title" content="Subject | Next-gen Tech Edu" />
  <meta property="og:description" content="Subject RxJS Subject 是一种特殊类型的 Observable，它允许将值多播给多个观察者，所以 Subject 是多播的，而普通的 Observables 是单播的(每个已订阅的观察者都拥有 Observable 的独立执行)。Subject 像是 Observable，但是可以多播" /><meta property="og:image" content="https://ng-tech.icu/media/sharing.png" />
    <meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png" /><meta property="og:locale" content="zh" />
  
    
    
  

  



  

  

  





  <title>Subject | Next-gen Tech Edu</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="a78164dd22fdd075c76da56d4c116927" >
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden="true"></i></button>
  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6 search-title">
          <p>搜索</p>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="关闭"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        
        
      </div>

      
      

      
    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

      <div id="search-common-queries">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    












<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/">Next-gen Tech Edu</a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="切换导航">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/">Next-gen Tech Edu</a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/books-gallery"><span>笔记（万篇）</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#knowledge-map"><span>知识图谱</span></a>
          </li>

          
          

          
          <style>
            .dropdown-item{
              display: inline-flex;
            }
          </style>
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>实验室</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/galaxy-home/gh-craft"><span>Craft 方块世界</span></a>
              
                <a class="dropdown-item" href="/galaxy-home/glossary-cards"><span>3D 知识卡牌</span></a>
              
            </div>
          </li>

          
          

          
          <style>
            .dropdown-item{
              display: inline-flex;
            }
          </style>
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>其他阅读渠道</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="https://zhuanlan.zhihu.com/wxyyxc1992"><img style="width:16px;height:16px;display:inline-block;margin-right:8px" src="https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png"></img><span>知乎</span></a>
              
                <a class="dropdown-item" href="https://segmentfault.com/blog/wxyyxc1992"><img style="width:16px;height:16px;display:inline-block;margin-right:8px" src="https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png"></img><span>SegmentFault</span></a>
              
                <a class="dropdown-item" href="https://zhuanlan.zhihu.com/wxyyxc1992"><img style="width:16px;height:16px;display:inline-block;margin-right:8px" src="https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png"></img><span>掘金</span></a>
              
            </div>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
        
        <li class="nav-item">
          <a class="nav-link js-search" href="#" aria-label="搜索"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item">
            <a class="nav-link" href="https://github.com/wx-chevalier" aria-label="GitHub"><i class="fa-brands fa-github" aria-hidden="true"></i></a>
        </li>
        

        
        
        

        
        
        
        <div></div>
        
        <style>
        @media only screen and (max-width: 600px) {
          .jimmysong-template {
            display: none!important;
          }
        }
        </style>
        
        <li class="jimmysong-template" style="color: white;font-size: 12px;">
          <a href="https://jimmysong.io" style="color: white">By Jimmy Song's Template</a>
        </li>
      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    




<link rel="stylesheet" href="//unpkg.com/heti/umd/heti.min.css">
<div class="container-xl docs">
  <div class="row flex-xl-nowrap">
    <div class="docs-sidebar">
      <form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <div class="d-flex">
      <span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">
        
          RxJS
        
      </span>
      <span><i class="fas fa-chevron-down"></i></span>
    </div>
  </button>

  
  <button class="form-control sidebar-search js-search d-none d-md-flex">
    <i class="fas fa-search pr-2"></i>
    <span class="sidebar-search-text">搜索...</span>
    <span class="sidebar-search-shortcut">/</span>
  </button>
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  
  
  
  

  
  
    

    
      

      <ul class="nav docs-sidenav">
        <li style="display: inline-flex">
          <a style="cursor: pointer;" onclick="window.history.back()">
            <i class="fas fa-arrow-left pr-1"></i>
            Back
          </a>
          <span>|</span>
          <a href="/books/">
            <i class="fa-solid fa-house" style="margin-right: 4px"></i>
            Books
          </a>
        </li>
      </ul>

      
      
        
          
        
      



  
    
    
    
    
      
    
    

    
    
    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-idc14cd014e37678f0df1dacd6e588f36b&#34;)" href="#idc14cd014e37678f0df1dacd6e588f36b" aria-expanded="false" aria-controls="idc14cd014e37678f0df1dacd6e588f36b" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/">异步并发</a>
    <a class="nav-toogle d-inline level" aria-hidden="false" data-toggle="collapse" href="#idc14cd014e37678f0df1dacd6e588f36b" aria-expanded="false" aria-controls="idc14cd014e37678f0df1dacd6e588f36b">
    
    <i class="fa-solid fa-angle-down" id="caret-idc14cd014e37678f0df1dacd6e588f36b"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  show " id="idc14cd014e37678f0df1dacd6e588f36b">
      



  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-ida054e3577c84c05d74f2165b5cd6ff4e&#34;)" href="#ida054e3577c84c05d74f2165b5cd6ff4e" aria-expanded="false" aria-controls="ida054e3577c84c05d74f2165b5cd6ff4e" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/event-loop/">Event Loop</a>
    <a class="nav-toogle d-inline level" aria-hidden="false" data-toggle="collapse" href="#ida054e3577c84c05d74f2165b5cd6ff4e" aria-expanded="false" aria-controls="ida054e3577c84c05d74f2165b5cd6ff4e">
    
        <i class="fa-solid fa-angle-right" id="caret-ida054e3577c84c05d74f2165b5cd6ff4e"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="ida054e3577c84c05d74f2165b5cd6ff4e">
      



  <li class="child level "><a href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/event-loop/node-%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/">Node 事件循环</a></li>

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id25fa37394a84dcb86016a4c74e8c8902&#34;)" href="#id25fa37394a84dcb86016a4c74e8c8902" aria-expanded="false" aria-controls="id25fa37394a84dcb86016a4c74e8c8902" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/rxjs/">RxJS</a>
    <a class="nav-toogle d-inline level" aria-hidden="false" data-toggle="collapse" href="#id25fa37394a84dcb86016a4c74e8c8902" aria-expanded="false" aria-controls="id25fa37394a84dcb86016a4c74e8c8902">
    
    <i class="fa-solid fa-angle-down" id="caret-id25fa37394a84dcb86016a4c74e8c8902"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  show " id="id25fa37394a84dcb86016a4c74e8c8902">
      



  <li class="child level "><a href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/rxjs/observable/">Observable</a></li>




  <li class="child level "><a href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/rxjs/observer/">Observer</a></li>




  <li class="child level "><a href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/rxjs/scheduler/">Scheduler</a></li>




  <li class="child level active"><a href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/rxjs/subject/">Subject</a></li>




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id89a15865ce78fc13af3e7d3002098fe6&#34;)" href="#id89a15865ce78fc13af3e7d3002098fe6" aria-expanded="false" aria-controls="id89a15865ce78fc13af3e7d3002098fe6" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/rxjs/%E6%93%8D%E4%BD%9C%E7%AC%A6/">操作符</a>
    <a class="nav-toogle d-inline level" aria-hidden="false" data-toggle="collapse" href="#id89a15865ce78fc13af3e7d3002098fe6" aria-expanded="false" aria-controls="id89a15865ce78fc13af3e7d3002098fe6">
    
        <i class="fa-solid fa-angle-right" id="caret-id89a15865ce78fc13af3e7d3002098fe6"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id89a15865ce78fc13af3e7d3002098fe6">
      



  <li class="child level "><a href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/rxjs/%E6%93%8D%E4%BD%9C%E7%AC%A6/%E5%88%9B%E5%BB%BA%E6%93%8D%E4%BD%9C%E7%AC%A6/">创建操作符</a></li>




  <li class="child level "><a href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/rxjs/%E6%93%8D%E4%BD%9C%E7%AC%A6/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%93%8D%E4%BD%9C%E7%AC%A6/">错误处理操作符</a></li>




  <li class="child level "><a href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/rxjs/%E6%93%8D%E4%BD%9C%E7%AC%A6/%E5%A4%9A%E6%92%AD%E6%93%8D%E4%BD%9C%E7%AC%A6/">多播操作符</a></li>




  <li class="child level "><a href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/rxjs/%E6%93%8D%E4%BD%9C%E7%AC%A6/%E5%B7%A5%E5%85%B7%E6%93%8D%E4%BD%9C%E7%AC%A6/">工具操作符</a></li>




  <li class="child level "><a href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/rxjs/%E6%93%8D%E4%BD%9C%E7%AC%A6/%E8%BF%87%E6%BB%A4%E6%93%8D%E4%BD%9C%E7%AC%A6/">过滤操作符</a></li>




  <li class="child level "><a href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/rxjs/%E6%93%8D%E4%BD%9C%E7%AC%A6/%E6%95%B0%E5%AD%A6%E5%92%8C%E8%81%9A%E5%90%88%E6%93%8D%E4%BD%9C%E7%AC%A6/">数学和聚合操作符</a></li>




  <li class="child level "><a href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/rxjs/%E6%93%8D%E4%BD%9C%E7%AC%A6/%E6%9D%A1%E4%BB%B6%E5%92%8C%E5%B8%83%E5%B0%94%E6%93%8D%E4%BD%9C%E7%AC%A6/">条件和布尔操作符</a></li>




  <li class="child level "><a href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/rxjs/%E6%93%8D%E4%BD%9C%E7%AC%A6/%E8%BD%AC%E6%8D%A2%E6%93%8D%E4%BD%9C%E7%AC%A6/">转换操作符</a></li>




  <li class="child level "><a href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/rxjs/%E6%93%8D%E4%BD%9C%E7%AC%A6/%E7%BB%84%E5%90%88%E6%93%8D%E4%BD%9C%E7%AC%A6/">组合操作符</a></li>

      
        </ul>
      
    

    
      </div>
    

      
        </ul>
      
    

    
      </div>
    




  
    
    
    
    
      
    
    

    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id8fe8d6c65ca2b6b246eee0801c7bde41&#34;)" href="#id8fe8d6c65ca2b6b246eee0801c7bde41" aria-expanded="false" aria-controls="id8fe8d6c65ca2b6b246eee0801c7bde41" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/%E5%BC%82%E6%AD%A5%E6%A8%A1%E5%BC%8F/">异步模式</a>
    <a class="nav-toogle d-inline level" aria-hidden="false" data-toggle="collapse" href="#id8fe8d6c65ca2b6b246eee0801c7bde41" aria-expanded="false" aria-controls="id8fe8d6c65ca2b6b246eee0801c7bde41">
    
        <i class="fa-solid fa-angle-right" id="caret-id8fe8d6c65ca2b6b246eee0801c7bde41"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  " id="id8fe8d6c65ca2b6b246eee0801c7bde41">
      



  <li class="child level "><a href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/%E5%BC%82%E6%AD%A5%E6%A8%A1%E5%BC%8F/async-await/">async-await</a></li>




  <li class="child level "><a href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/%E5%BC%82%E6%AD%A5%E6%A8%A1%E5%BC%8F/promise/">Promise</a></li>




  <li class="child level "><a href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/%E5%BC%82%E6%AD%A5%E6%A8%A1%E5%BC%8F/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F/">异步编程模式</a></li>




  <li class="child level "><a href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/%E5%BC%82%E6%AD%A5%E6%A8%A1%E5%BC%8F/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E7%BB%BC%E8%BF%B0/">异步编程综述</a></li>

      
        </ul>
      
    

    
      </div>
    

      
        </ul>
      
    

    
      </div>
    

    
  
</nav>

    </div>

    
    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      
     
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">目录</a></li>
      </ul>
     

      <nav id="TableOfContents">
  <ul>
    <li><a href="#observable-vs-subject">Observable vs Subject</a></li>
  </ul>
</nav>

      
<div class="subscribe-module col-24 mt-1">
    <img src="https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png" alt="image" title="王下邀月熊的微信公众号"/>
</div>



    </div>
    

    <main class="py-md-3 pl-md-3 docs-content col-xl-8" role="main">

      <article class="article">

          

          <h1>Subject</h1>

          <div class="article-style">
            <h1 id="subject">Subject</h1>
<p>RxJS Subject 是一种特殊类型的 Observable，它允许将值多播给多个观察者，所以 Subject 是多播的，而普通的 Observables 是单播的(每个已订阅的观察者都拥有 Observable 的独立执行)。Subject 像是 Observable，但是可以多播给多个观察者。Subject 还像是 EventEmitters，维护着多个监听器的注册表。对于 Subject，你可以提供一个观察者并使用 subscribe 方法，就可以开始正常接收值。从观察者的角度而言，它无法判断 Observable 执行是来自普通的 Observable 还是 Subject 。在 Subject 的内部，subscribe 不会调用发送值的新执行。它只是将给定的观察者注册到观察者列表中，类似于其他库或语言中的 addListener 的工作方式。</p>
<p>Subject 是一个有如下方法的对象：next(v)、error(e) 和 complete() 。要给 Subject 提供新值，只要调用 next(theValue)，它会将值多播给已注册监听该 Subject 的观察者们。在下面的示例中，我们为 Subject 添加了两个观察者，然后给 Subject 提供一些值：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Subject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="o">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;observerA: &#34;</span> <span class="o">+</span> <span class="nx">v</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="o">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;observerB: &#34;</span> <span class="o">+</span> <span class="nx">v</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">observerA</span>: <span class="kt">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">observerB</span>: <span class="kt">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">observerA</span>: <span class="kt">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">observerB</span>: <span class="kt">2</span><span class="p">;</span>
</span></span></code></pre></div><h2 id="observable-vs-subject">Observable vs Subject</h2>
<p>The subject is another Observable type in RxJS. Subjects like Observables can emit multiple event values. However, Subjects allow subscribers of the Subject to push back or trigger their own events on the Subject. Here is what the Subject API looks like,</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Observable</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;rxjs&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">observable</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Observable</span><span class="p">((</span><span class="nx">observer</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">observer</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="s2">&#34;hello from Observable!&#34;</span><span class="p">),</span> <span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">observable</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Subject</span> <span class="p">}</span> <span class="kr">from</span> <span class="s2">&#34;rxjs&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="s2">&#34;missed message from Subject&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">v</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="s2">&#34;hello from subject!&#34;</span><span class="p">);</span>
</span></span></code></pre></div><p>We instantiate the Subject class. With the Subject instance, we can immediately trigger events outside of the constructor by calling next(). Now anyone can listen or trigger events on the Subject. Notice how we call next and emit ‘missed message from Subject’ before we have subscribed to the Subject? Subjects, unlike regular Observables, are what we would call “Hot”. A hot Observable is an Observable that can start emitting events before you subscribe. This means you can miss previous events that have already emitted.</p>
<p>Subjects, unlike Observables, share their work with all subscribers. Unlike our first Observable that created a setTimeout for each subscriber, this Subject would share that work with all subscribers. What if we subscribe late to our Subject and want to get the previous value we missed? Well, that’s where our next Subject type comes in, the ReplaySubject.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">clock$</span> <span class="o">=</span> <span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">observerA</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">‘</span><span class="nx">A</span> <span class="nx">next</span><span class="o">:</span> <span class="err">‘</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">observerB</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">‘</span><span class="nx">B</span> <span class="nx">next</span><span class="o">:</span> <span class="err">‘</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">clock$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">observerA</span><span class="p">)</span> <span class="c1">// a Observable execution
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">clock$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">observerB</span><span class="p">)</span> <span class="c1">// another new Observable execution
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">},</span> <span class="mi">2000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> * A next: 0
</span></span></span><span class="line"><span class="cl"><span class="cm"> * A next: 1
</span></span></span><span class="line"><span class="cl"><span class="cm"> * A next: 2
</span></span></span><span class="line"><span class="cl"><span class="cm"> * B next: 0
</span></span></span><span class="line"><span class="cl"><span class="cm"> * B next: 1
</span></span></span><span class="line"><span class="cl"><span class="cm"> * B next: 2
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 如果是同一个 shared Observable execution 的话，B的第一个 emit 的值应该是 2 而不是 0，并且只有且仅有一个值 2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">clock$</span> <span class="o">=</span> <span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">1000</span><span class="p">).</span><span class="nx">take</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">observerA</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">‘</span><span class="nx">A</span> <span class="nx">next</span><span class="o">:</span> <span class="err">‘</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">observerB</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">‘</span><span class="nx">B</span> <span class="nx">next</span><span class="o">:</span> <span class="err">‘</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">observerA</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">clock$</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">subject</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">observerB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="mi">2000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"> * A next: 0
</span></span></span><span class="line"><span class="cl"><span class="cm"> * A next: 1
</span></span></span><span class="line"><span class="cl"><span class="cm"> * A next: 2
</span></span></span><span class="line"><span class="cl"><span class="cm"> * B next: 2
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span></code></pre></div><h1 id="multicast">multicast</h1>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// RxJS v6+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">Subject</span><span class="p">,</span> <span class="nx">interval</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;rxjs&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">take</span><span class="p">,</span> <span class="nx">tap</span><span class="p">,</span> <span class="nx">multicast</span><span class="p">,</span> <span class="nx">mapTo</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;rxjs/operators&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//emit every 2 seconds, take 5
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">interval</span><span class="p">(</span><span class="mi">2000</span><span class="p">).</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">take</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">example</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//since we are multicasting below, side effects will be executed once
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">tap</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Side Effect #1&#34;</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mapTo</span><span class="p">(</span><span class="s2">&#34;Result!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//subscribe subject to source upon connect()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">multi</span> <span class="o">=</span> <span class="nx">example</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">multicast</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nx">Subject</span><span class="p">()));</span>
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">  subscribers will share source
</span></span></span><span class="line"><span class="cl"><span class="cm">  output:
</span></span></span><span class="line"><span class="cl"><span class="cm">  &#34;Side Effect #1&#34;
</span></span></span><span class="line"><span class="cl"><span class="cm">  &#34;Result!&#34;
</span></span></span><span class="line"><span class="cl"><span class="cm">  &#34;Result!&#34;
</span></span></span><span class="line"><span class="cl"><span class="cm">  ...
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">subscriberOne</span> <span class="o">=</span> <span class="nx">multi</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">val</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">subscriberTwo</span> <span class="o">=</span> <span class="nx">multi</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">val</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">val</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="c1">//subscribe subject to source
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">multi</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>
</span></span></code></pre></div><h1 id="引用计数">引用计数</h1>
<p>通常，当第一个观察者到达时我们想要自动地连接，而当最后一个观察者取消订阅时我们想要自动地取消共享执行。我们可以使用 ConnectableObservable 的 refCount() 方法(引用计数)，这个方法返回 Observable，这个 Observable 会追踪有多少个订阅者。当订阅者的数量从 0 变成 1，它会调用 connect() 以开启共享的执行。当订阅者数量从 1 变成 0 时，它会完全取消订阅，停止进一步的执行。</p>
<p>refCount 的作用是，当有第一个订阅者时，多播 Observable 会自动地启动执行，而当最后一个订阅者离开时，多播 Observable 会自动地停止执行。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Observable</span><span class="p">.</span><span class="nx">interval</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">Subject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">refCounted</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">multicast</span><span class="p">(</span><span class="nx">subject</span><span class="p">).</span><span class="nx">refCount</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">subscription1</span><span class="p">,</span> <span class="nx">subscription2</span><span class="p">,</span> <span class="nx">subscriptionConnect</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 这里其实调用了 `connect()`，
</span></span></span><span class="line"><span class="cl"><span class="c1">// 因为 `refCounted` 有了第一个订阅者
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;observerA subscribed&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">subscription1</span> <span class="o">=</span> <span class="nx">refCounted</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="o">:</span> <span class="nx">v</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;observerA: &#34;</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;observerB subscribed&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">subscription2</span> <span class="o">=</span> <span class="nx">refCounted</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">next</span><span class="o">:</span> <span class="nx">v</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;observerB: &#34;</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="mi">600</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;observerA unsubscribed&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">subscription1</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="mi">1200</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 这里共享的 Observable 执行会停止，
</span></span></span><span class="line"><span class="cl"><span class="c1">// 因为此后 `refCounted` 将不再有订阅者
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;observerB unsubscribed&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">subscription2</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;observerC subscribed&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">subscription2</span> <span class="o">=</span> <span class="nx">refCounted</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">next</span><span class="o">:</span> <span class="nx">v</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;observerC: &#34;</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="mi">2500</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">&#34;observerA subscribed&#34;
</span></span></span><span class="line"><span class="cl"><span class="cm">&#34;observerA: 0&#34;
</span></span></span><span class="line"><span class="cl"><span class="cm">&#34;observerB subscribed&#34;
</span></span></span><span class="line"><span class="cl"><span class="cm">&#34;observerA: 1&#34;
</span></span></span><span class="line"><span class="cl"><span class="cm">&#34;observerB: 1&#34;
</span></span></span><span class="line"><span class="cl"><span class="cm">&#34;observerA unsubscribed&#34;
</span></span></span><span class="line"><span class="cl"><span class="cm">&#34;observerB: 2&#34;
</span></span></span><span class="line"><span class="cl"><span class="cm">&#34;observerB: 3&#34;
</span></span></span><span class="line"><span class="cl"><span class="cm">&#34;observerB unsubscribed&#34;
</span></span></span><span class="line"><span class="cl"><span class="cm">&#34;observerC subscribed&#34;
</span></span></span><span class="line"><span class="cl"><span class="cm">&#34;observerC: 0&#34;
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span></code></pre></div><p>refCount() 只存在于 ConnectableObservable，它返回的是 Observable，而不是另一个 ConnectableObservable 。</p>
<h1 id="behaviorsubject">BehaviorSubject</h1>
<p>Subject 的其中一个变体就是 BehaviorSubject，它有一个“当前值”的概念。它保存了发送给消费者的最新值。并且当有新的观察者订阅时，会立即从 BehaviorSubject 那接收到“当前值”。BehaviorSubjects 适合用来表示“随时间推移的值”。举例来说，生日的流是一个 Subject，但年龄的流应该是一个 BehaviorSubject 。</p>
<p>在下面的示例中，BehaviorSubject 使用值 0 进行初始化，当第一个观察者订阅时会得到 0。第二个观察者订阅时会得到值 2，尽管它是在值 2 发送之后订阅的。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">BehaviorSubject</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// 0是初始值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="o">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;observerA: &#34;</span> <span class="o">+</span> <span class="nx">v</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="o">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;observerB: &#34;</span> <span class="o">+</span> <span class="nx">v</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">observerA: 0
</span></span></span><span class="line"><span class="cl"><span class="cm">observerA: 1
</span></span></span><span class="line"><span class="cl"><span class="cm">observerA: 2
</span></span></span><span class="line"><span class="cl"><span class="cm">observerB: 2
</span></span></span><span class="line"><span class="cl"><span class="cm">observerA: 3
</span></span></span><span class="line"><span class="cl"><span class="cm">observerB: 3
</span></span></span><span class="line"><span class="cl"><span class="cm">**/</span>
</span></span></code></pre></div><h1 id="replaysubject">ReplaySubject</h1>
<p>ReplaySubject 类似于 BehaviorSubject，它可以发送旧值给新的订阅者，但它还可以记录 Observable 执行的一部分。ReplaySubject 记录 Observable 执行中的多个值并将其回放给新的订阅者。当创建 ReplaySubject 时，你可以指定回放多少个值：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">ReplaySubject</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="c1">// 为新的订阅者缓冲3个值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="o">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;observerA: &#34;</span> <span class="o">+</span> <span class="nx">v</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="o">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;observerB: &#34;</span> <span class="o">+</span> <span class="nx">v</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">observerA: 1
</span></span></span><span class="line"><span class="cl"><span class="cm">observerA: 2
</span></span></span><span class="line"><span class="cl"><span class="cm">observerA: 3
</span></span></span><span class="line"><span class="cl"><span class="cm">observerA: 4
</span></span></span><span class="line"><span class="cl"><span class="cm">observerB: 2
</span></span></span><span class="line"><span class="cl"><span class="cm">observerB: 3
</span></span></span><span class="line"><span class="cl"><span class="cm">observerB: 4
</span></span></span><span class="line"><span class="cl"><span class="cm">observerA: 5
</span></span></span><span class="line"><span class="cl"><span class="cm">observerB: 5
</span></span></span><span class="line"><span class="cl"><span class="cm">**/</span>
</span></span></code></pre></div><p>除了缓冲数量，你还可以指定 window time (以毫秒为单位)来确定多久之前的值可以记录。在下面的示例中，我们使用了较大的缓存数量 100，但 window time 参数只设置了 500 毫秒。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">ReplaySubject</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">500</span> <span class="cm">/* windowTime */</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="o">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;observerA: &#34;</span> <span class="o">+</span> <span class="nx">v</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">setInterval</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="nx">i</span><span class="o">++</span><span class="p">),</span> <span class="mi">200</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">next</span><span class="o">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;observerB: &#34;</span> <span class="o">+</span> <span class="nx">v</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
</span></span></code></pre></div><p>从下面的输出可以看出，第二个观察者得到的值是<code>3</code>、<code>4</code>、<code>5</code>，这三个值是订阅发生前的<code>500</code>毫秒内发生的：</p>
<pre tabindex="0"><code class="language-none" data-lang="none">observerA: 1
observerA: 2
observerA: 3
observerA: 4
observerA: 5
observerB: 3
observerB: 4
observerB: 5
observerA: 6
observerB: 6
...
</code></pre><h1 id="asyncsubject">AsyncSubject</h1>
<p>AsyncSubject 是另一个 Subject 变体，只有当 Observable 执行完成时(执行 <code>complete()</code>)，它才会将执行的最后一个值发送给观察者。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">subject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Rx</span><span class="p">.</span><span class="nx">AsyncSubject</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="o">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;observerA: &#34;</span> <span class="o">+</span> <span class="nx">v</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">next</span><span class="o">:</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;observerB: &#34;</span> <span class="o">+</span> <span class="nx">v</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">subject</span><span class="p">.</span><span class="nx">complete</span><span class="p">();</span>
</span></span></code></pre></div><p>输出：</p>
<pre tabindex="0"><code class="language-none" data-lang="none">observerA: 5
observerB: 5
</code></pre><p>AsyncSubject 和 <a href="https://cn.rx.js.org/class/es6/Observable.js~Observable.html#instance-method-last" target="_blank" rel="noopener"><code>last()</code></a> 操作符类似，因为它也是等待 <code>complete</code> 通知，以发送一个单个值。</p>

          </div>

          



          
          
          <div class="article-widget">
            
<div class="container-xl row post-nav">
  
  
  
  <div class="col-6 post-nav-item">
    <div class="meta-nav">上一页</div>
    <a href="/books/javascript-series/%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/rxjs/scheduler/" rel="next">Scheduler</a>
  </div>
  
  
</div>

          </div>
          

        <div class="body-footer">
          <p>最近更新于 0001-01-01</p>

          



          


  
  
  

  

  
  <section id="comments" class="mb-3 pt-0">
    
<div id="disqus_thread"></div>
<script>
  var disqus_config = function () {
    
    
    
  };
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
      return;
    }
    var d = document, s = d.createElement('script'); 
    s.async = true;
    
    s.src = "https://ngte-website.oss-accelerate.aliyuncs.com/disqus/embed.js";
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  </section>
  



          


        </div>

      </article>

      <footer class="site-footer">

  



  

  
  <div class="copyright py-4 bg-footer">
      <div class="row justify-content-center">
        <div class="text-center footer-color">
          <p class="mb-0">© 2017-2022 NGTE all rights reserved</p>
        </div>
    </div>
  </div>

</footer>


    </main>
  </div>
</div>
<script src="//unpkg.com/heti/umd/heti-addon.min.js"></script>
<script>
  const heti = new Heti('.article');
  heti.autoSpacing();
</script>
<script type="text/javascript">
  window.$crisp = [];
  window.CRISP_WEBSITE_ID = "12adcc35-9621-4313-8262-62dc654b29d8";
  (function () {
    setTimeout(function() {
      d = document;
      s = d.createElement("script");
      s.src = "https://client.crisp.chat/l.js";
      s.async = 1;
      d.getElementsByTagName("head")[0].appendChild(s);
    }, 2500);
  })();
</script>
  </div>

  <div class="page-footer">
    
    
  </div>

      

    
    <script src="/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js"></script>

    
    
    
      

      
      

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
        
        
      

    

    
    
    

    
    
    
      
      <script id="search-hit-algolia-template" type="text/html">
        <div class="search-hit">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a>
            </div>
            <div class="article-metadata search-hit-type">{{type}}</div>
            <p class="search-hit-description">{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p>
          </div>
        </div>
      </script>
      
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js" crossorigin="anonymous"></script>
      
      
    

    
    

    
    
    
    
      
      <script id="dsq-count-scr" src="https://ngte-website.oss-accelerate.aliyuncs.com/disqus/count.js" async></script>
    

    
    
      
      
      
      
      
      
      
    

    
    <script src="/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js" type="module"></script>
    

    
    
    
    <script id="page-data" type="application/json">{"use_headroom":false}</script>

    
    
    
    
    
    
    
    
    
    
    <script src="/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js"></script>

    
    
    
    
    
    
    <script>

var mybutton = document.getElementById("backTopBtn");


window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}


function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>


    

    
    
    <script src="https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    <script>



(function() {
  'use strict';

  if(!document.queryCommandSupported('copy')) {
    return;
  }

  function flashCopyMessage(el, msg) {
    el.className = "highlight-copy-btn";
    el.textContent = msg;
    setTimeout(function() {
      el.textContent = "";
      el.className = "highlight-copy-btn fa fa-copy";
    }, 1000);
  }

  function selectText(node) {
    var selection = window.getSelection();
    var range = document.createRange();
    range.selectNodeContents(node);
    selection.removeAllRanges();
    selection.addRange(range);
    return selection;
  }

  function addCopyButton(containerEl) {
    var copyBtn = document.createElement("button");
    copyBtn.className = "highlight-copy-btn fa fa-copy";
    copyBtn.textContent = "";

    var codeEl = containerEl.firstElementChild;
    copyBtn.addEventListener('click', function() {
      try {
        var selection = selectText(codeEl);
        document.execCommand('copy');
        selection.removeAllRanges();
        
        flashCopyMessage(copyBtn, '已复制')
        
      } catch(e) {
        console && console.log(e);
        flashCopyMessage(copyBtn, 'Failed :\'(')
      }
    });

    containerEl.appendChild(copyBtn);
  }

  
  var highlightBlocks = document.getElementsByClassName('highlight');
  Array.prototype.forEach.call(highlightBlocks, addCopyButton);
})();
</script>

    


</body>
</html>
