<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="Original Repository: ryanmcdermott/clean-code-javascript JavaScript 风格指南 目录 介绍 变量 函数 对象和数据结构 类 测试 并发 错误处理 格式化 注释 介绍 作者根据 Robert C. Martin 《代码整洁之道》总结了适用于 JavaScript 的软件工程原则《Clean Code JavaScript》。 本文是对其的翻译。 不必严格"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/javascript-series/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/clean-code/ryanmcdermott-javascript-clean-code-practices/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/javascript-series/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/clean-code/ryanmcdermott-javascript-clean-code-practices/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/javascript-series/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/clean-code/ryanmcdermott-javascript-clean-code-practices/"><meta property="og:title" content="ryanmcdermott-JavaScript Clean Code Practices | Next-gen Tech Edu"><meta property="og:description" content="Original Repository: ryanmcdermott/clean-code-javascript JavaScript 风格指南 目录 介绍 变量 函数 对象和数据结构 类 测试 并发 错误处理 格式化 注释 介绍 作者根据 Robert C. Martin 《代码整洁之道》总结了适用于 JavaScript 的软件工程原则《Clean Code JavaScript》。 本文是对其的翻译。 不必严格"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>ryanmcdermott-JavaScript Clean Code Practices | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=9354a9c06b2e60971f5f4437c85a32ea><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">Clean Code</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id22e1906ddc527c5a975872135a170872")' href=#id22e1906ddc527c5a975872135a170872 aria-expanded=false aria-controls=id22e1906ddc527c5a975872135a170872 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/javascript-series/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/>设计模式</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id22e1906ddc527c5a975872135a170872 aria-expanded=false aria-controls=id22e1906ddc527c5a975872135a170872><i class="fa-solid fa-angle-down" id=caret-id22e1906ddc527c5a975872135a170872></i></a></div><ul class="nav docs-sidenav collapse show" id=id22e1906ddc527c5a975872135a170872><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id3f67437272a308859f31c9d3906e27b8")' href=#id3f67437272a308859f31c9d3906e27b8 aria-expanded=false aria-controls=id3f67437272a308859f31c9d3906e27b8 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/javascript-series/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/clean-code/>Clean Code</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id3f67437272a308859f31c9d3906e27b8 aria-expanded=false aria-controls=id3f67437272a308859f31c9d3906e27b8><i class="fa-solid fa-angle-down" id=caret-id3f67437272a308859f31c9d3906e27b8></i></a></div><ul class="nav docs-sidenav collapse show" id=id3f67437272a308859f31c9d3906e27b8><li class="child level active"><a href=/books/javascript-series/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/clean-code/ryanmcdermott-javascript-clean-code-practices/>ryanmcdermott-JavaScript Clean Code Practices</a></li></ul></div><li class="child level"><a href=/books/javascript-series/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/solid/>SOLID</a></li></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#目录>目录</a></li><li><a href=#介绍>介绍</a></li><li><a href=#变量><strong>变量</strong></a><ul><li><a href=#使用有意义可读性好的变量名>使用有意义，可读性好的变量名</a></li><li><a href=#使用-es6-的-const-定义常量>使用 ES6 的 const 定义常量</a></li><li><a href=#对功能类似的变量名采用统一的命名风格>对功能类似的变量名采用统一的命名风格</a></li><li><a href=#使用易于检索名称>使用易于检索名称</a></li><li><a href=#使用说明变量即有意义的变量名>使用说明变量(即有意义的变量名)</a></li><li><a href=#不要绕太多的弯子>不要绕太多的弯子</a></li><li><a href=#避免重复的描述>避免重复的描述</a></li><li><a href=#避免无意义的条件判断>避免无意义的条件判断</a></li></ul></li><li><a href=#函数><strong>函数</strong></a><ul><li><a href=#函数参数-理想情况下应不超过-2-个>函数参数 (理想情况下应不超过 2 个)</a></li><li><a href=#函数功能的单一性>函数功能的单一性</a></li><li><a href=#函数名应明确表明其功能>函数名应明确表明其功能</a></li><li><a href=#函数应该只做一层抽象>函数应该只做一层抽象</a></li><li><a href=#移除重复的代码>移除重复的代码</a></li><li><a href=#采用默认参数精简代码>采用默认参数精简代码</a></li><li><a href=#使用-objectassign-设置默认对象>使用 Object.assign 设置默认对象</a></li><li><a href=#不要使用标记flag作为函数参数>不要使用标记(Flag)作为函数参数</a></li><li><a href=#避免副作用>避免副作用</a></li><li><a href=#不要写全局函数>不要写全局函数</a></li><li><a href=#采用函数式编程>采用函数式编程</a></li><li><a href=#封装判断条件>封装判断条件</a></li><li><a href=#避免否定情况的判断>避免“否定情况”的判断</a></li><li><a href=#避免条件判断>避免条件判断</a></li><li><a href=#避免类型判断part-1>避免类型判断(part 1)</a></li><li><a href=#避免类型判断part-2>避免类型判断(part 2)</a></li><li><a href=#避免过度优化>避免过度优化</a></li><li><a href=#删除无效的代码>删除无效的代码</a></li></ul></li><li><a href=#对象和数据结构><strong>对象和数据结构</strong></a><ul><li><a href=#使用-getters-和-setters>使用 getters 和 setters</a></li><li><a href=#让对象拥有私有成员>让对象拥有私有成员</a></li></ul></li><li><a href=#类><strong>类</strong></a><ul><li><a href=#单一职责原则-srp>单一职责原则 (SRP)</a></li><li><a href=#开闭原则-ocp>开/闭原则 (OCP)</a></li><li><a href=#利斯科夫替代原则-lsp>利斯科夫替代原则 (LSP)</a></li><li><a href=#接口隔离原则-isp>接口隔离原则 (ISP)</a></li><li><a href=#依赖反转原则-dip>依赖反转原则 (DIP)</a></li><li><a href=#使用-es6-的-classes-而不是-es5-的-function>使用 ES6 的 classes 而不是 ES5 的 Function</a></li><li><a href=#使用方法链>使用方法链</a></li><li><a href=#优先使用组合模式而非继承>优先使用组合模式而非继承</a></li></ul></li><li><a href=#测试><strong>测试</strong></a><ul><li><a href=#单一的测试每个概念>单一的测试每个概念</a></li></ul></li><li><a href=#并发><strong>并发</strong></a><ul><li><a href=#用-promises-替代回调>用 Promises 替代回调</a></li><li><a href=#asyncawait-是较-promises-更好的选择>Async/Await 是较 Promises 更好的选择</a></li></ul></li><li><a href=#错误处理><strong>错误处理</strong></a><ul><li><a href=#别忘了捕获错误>别忘了捕获错误</a></li><li><a href=#不要忽略被拒绝的-promises>不要忽略被拒绝的 promises</a></li></ul></li><li><a href=#格式化><strong>格式化</strong></a><ul><li><a href=#大小写一致>大小写一致</a></li><li><a href=#调用函数的函数和被调函数应放在较近的位置>调用函数的函数和被调函数应放在较近的位置</a></li></ul></li><li><a href=#注释><strong>注释</strong></a><ul><li><a href=#只对存在一定业务逻辑复杂性的代码进行注释>只对存在一定业务逻辑复杂性的代码进行注释</a></li><li><a href=#不要在代码库中遗留被注释掉的代码>不要在代码库中遗留被注释掉的代码</a></li><li><a href=#不需要版本更新类型注释>不需要版本更新类型注释</a></li><li><a href=#避免位置标记>避免位置标记</a></li><li><a href=#避免在源文件中写入法律评论>避免在源文件中写入法律评论</a></li></ul></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>ryanmcdermott-JavaScript Clean Code Practices</h1><div class=article-style><blockquote><p>Original Repository: <a href=https://github.com/ryanmcdermott/clean-code-javascript target=_blank rel=noopener>ryanmcdermott/clean-code-javascript</a></p></blockquote><h1 id=javascript-风格指南>JavaScript 风格指南</h1><h2 id=目录>目录</h2><ol><li><a href=#%e4%bb%8b%e7%bb%8d>介绍</a></li><li><a href=#%e5%8f%98%e9%87%8f>变量</a></li><li><a href=#%e5%87%bd%e6%95%b0>函数</a></li><li><a href=#objects-and-data-structures>对象和数据结构</a></li><li><a href=#%e7%b1%bb>类</a></li><li><a href=#%e6%b5%8b%e8%af%95>测试</a></li><li><a href=#%e5%b9%b6%e5%8f%91>并发</a></li><li><a href=#%e9%94%99%e8%af%af%e5%a4%84%e7%90%86>错误处理</a></li><li><a href=#%e6%a0%bc%e5%bc%8f%e5%8c%96>格式化</a></li><li><a href=#%e6%b3%a8%e9%87%8a>注释</a></li></ol><h2 id=介绍>介绍</h2><p><a href=https://github.com/ryanmcdermott target=_blank rel=noopener>作者</a>根据 Robert C. Martin <a href=https://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882 target=_blank rel=noopener><em>《代码整洁之道》</em></a>总结了适用于 JavaScript 的软件工程原则<a href=https://github.com/ryanmcdermott/clean-code-javascript target=_blank rel=noopener>《Clean Code JavaScript》</a>。</p><p>本文是对其的翻译。</p><p>不必严格遵守本文的所有原则，有时少遵守一些效果可能会更好，具体应根据实际情况决定。这是根据《代码整洁之道》作者多年经验整理的代码优化建议，但也仅仅只是一份建议。</p><p>软件工程已经发展了 50 多年，至今仍在不断前进。现在，把这些原则当作试金石，尝试将他们作为团队代码质量考核的标准之一吧。</p><p>最后你需要知道的是，这些东西不会让你立刻变成一个优秀的工程师，长期奉行他们也并不意味着你能够高枕无忧不再犯错。千里之行，始于足下。我们需要时常和同行们进行代码评审，不断优化自己的代码。不要惧怕改善代码质量所需付出的努力，加油。</p><h2 id=变量><strong>变量</strong></h2><h3 id=使用有意义可读性好的变量名>使用有意义，可读性好的变量名</h3><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>yyyymmdstr</span> <span class=o>=</span> <span class=nx>moment</span><span class=p>().</span><span class=nx>format</span><span class=p>(</span><span class=s2>&#34;YYYY/MM/DD&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>yearMonthDay</span> <span class=o>=</span> <span class=nx>moment</span><span class=p>().</span><span class=nx>format</span><span class=p>(</span><span class=s2>&#34;YYYY/MM/DD&#34;</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=使用-es6-的-const-定义常量>使用 ES6 的 const 定义常量</h3><p>反例中使用"var"定义的"常量"是可变的。</p><p>在声明一个常量时，该常量在整个程序中都应该是不可变的。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>FIRST_US_PRESIDENT</span> <span class=o>=</span> <span class=s2>&#34;George Washington&#34;</span><span class=p>;</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>FIRST_US_PRESIDENT</span> <span class=o>=</span> <span class=s2>&#34;George Washington&#34;</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=对功能类似的变量名采用统一的命名风格>对功能类似的变量名采用统一的命名风格</h3><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>getUserInfo</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>getClientData</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>getCustomerRecord</span><span class=p>();</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>getUser</span><span class=p>();</span>
</span></span></code></pre></div><h3 id=使用易于检索名称>使用易于检索名称</h3><p>我们需要阅读的代码远比自己写的要多，使代码拥有良好的可读性且易于检索非常重要。阅读变量名晦涩难懂的代码对读者来说是一种相当糟糕的体验。
让你的变量名易于检索。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 525600 是什么?
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=mi>525600</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>runCronJob</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Declare them as capitalized `var` globals.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>MINUTES_IN_A_YEAR</span> <span class=o>=</span> <span class=mi>525600</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>MINUTES_IN_A_YEAR</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>runCronJob</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=使用说明变量即有意义的变量名>使用说明变量(即有意义的变量名)</h3><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>cityStateRegex</span> <span class=o>=</span> <span class=sr>/^(.+)[,\\s]+(.+?)\s*(\d{5})?$/</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>saveCityState</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>cityStateRegex</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span><span class=nx>cityStateRegex</span><span class=p>)[</span><span class=mi>1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>cityStateRegex</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span><span class=nx>cityStateRegex</span><span class=p>)[</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>ADDRESS</span> <span class=o>=</span> <span class=s2>&#34;One Infinite Loop, Cupertino 95014&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>cityStateRegex</span> <span class=o>=</span> <span class=sr>/^(.+)[,\\s]+(.+?)\s*(\d{5})?$/</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>match</span> <span class=o>=</span> <span class=nx>ADDRESS</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span><span class=nx>cityStateRegex</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>city</span> <span class=o>=</span> <span class=nx>match</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>state</span> <span class=o>=</span> <span class=nx>match</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nx>saveCityState</span><span class=p>(</span><span class=nx>city</span><span class=p>,</span> <span class=nx>state</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=不要绕太多的弯子>不要绕太多的弯子</h3><p>显式优于隐式。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>locations</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;Austin&#39;</span><span class=p>,</span> <span class=s1>&#39;New York&#39;</span><span class=p>,</span> <span class=s1>&#39;San Francisco&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nx>locations</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>l</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>doStuff</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>doSomeOtherStuff</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=c1>// l是什么？
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>dispatch</span><span class=p>(</span><span class=nx>l</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>locations</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;Austin&#39;</span><span class=p>,</span> <span class=s1>&#39;New York&#39;</span><span class=p>,</span> <span class=s1>&#39;San Francisco&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nx>locations</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>location</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>doStuff</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>doSomeOtherStuff</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=nx>dispatch</span><span class=p>(</span><span class=nx>location</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><h3 id=避免重复的描述>避免重复的描述</h3><p>当类/对象名已经有意义时，对其变量进行命名不需要再次重复。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>Car</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>carMake</span><span class=o>:</span> <span class=s2>&#34;Honda&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>carModel</span><span class=o>:</span> <span class=s2>&#34;Accord&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>carColor</span><span class=o>:</span> <span class=s2>&#34;Blue&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>paintCar</span><span class=p>(</span><span class=nx>car</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>car</span><span class=p>.</span><span class=nx>carColor</span> <span class=o>=</span> <span class=s2>&#34;Red&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>Car</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>make</span><span class=o>:</span> <span class=s2>&#34;Honda&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>model</span><span class=o>:</span> <span class=s2>&#34;Accord&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>color</span><span class=o>:</span> <span class=s2>&#34;Blue&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>paintCar</span><span class=p>(</span><span class=nx>car</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>car</span><span class=p>.</span><span class=nx>color</span> <span class=o>=</span> <span class=s2>&#34;Red&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=避免无意义的条件判断>避免无意义的条件判断</h3><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>createMicrobrewery</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>breweryName</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>breweryName</span> <span class=o>=</span> <span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>breweryName</span> <span class=o>=</span> <span class=s2>&#34;Hipster Brew Co.&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>createMicrobrewery</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>breweryName</span> <span class=o>=</span> <span class=nx>name</span> <span class=o>||</span> <span class=s2>&#34;Hipster Brew Co.&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=函数><strong>函数</strong></h2><h3 id=函数参数-理想情况下应不超过-2-个>函数参数 (理想情况下应不超过 2 个)</h3><p>限制函数参数数量很有必要，这么做使得在测试函数时更加轻松。过多的参数将导致难以采用有效的测试用例对函数的各个参数进行测试。</p><p>应避免三个以上参数的函数。通常情况下，参数超过两个意味着函数功能过于复杂，这时需要重新优化你的函数。当确实需要多个参数时，大多情况下可以考虑这些参数封装成一个对象。</p><p>JS 定义对象非常方便，当需要多个参数时，可以使用一个对象进行替代。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>createMenu</span><span class=p>(</span><span class=nx>title</span><span class=p>,</span> <span class=nx>body</span><span class=p>,</span> <span class=nx>buttonText</span><span class=p>,</span> <span class=nx>cancellable</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>menuConfig</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;Foo&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>body</span><span class=o>:</span> <span class=s1>&#39;Bar&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>buttonText</span><span class=o>:</span> <span class=s1>&#39;Baz&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>cancellable</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>createMenu</span><span class=p>(</span><span class=nx>menuConfig</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=函数功能的单一性>函数功能的单一性</h3><p>这是软件功能中最重要的原则之一。</p><p>功能不单一的函数将导致难以重构、测试和理解。功能单一的函数易于重构，并使代码更加干净。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>emailClients</span><span class=p>(</span><span class=nx>clients</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>clients</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>client</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>clientRecord</span> <span class=o>=</span> <span class=nx>database</span><span class=p>.</span><span class=nx>lookup</span><span class=p>(</span><span class=nx>client</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>clientRecord</span><span class=p>.</span><span class=nx>isActive</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>email</span><span class=p>(</span><span class=nx>client</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>emailClients</span><span class=p>(</span><span class=nx>clients</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>clients</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>client</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>emailClientIfNeeded</span><span class=p>(</span><span class=nx>client</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>emailClientIfNeeded</span><span class=p>(</span><span class=nx>client</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>isClientActive</span><span class=p>(</span><span class=nx>client</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>email</span><span class=p>(</span><span class=nx>client</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>isClientActive</span><span class=p>(</span><span class=nx>client</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>clientRecord</span> <span class=o>=</span> <span class=nx>database</span><span class=p>.</span><span class=nx>lookup</span><span class=p>(</span><span class=nx>client</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>clientRecord</span><span class=p>.</span><span class=nx>isActive</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=函数名应明确表明其功能>函数名应明确表明其功能</h3><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>dateAdd</span><span class=p>(</span><span class=nx>date</span><span class=p>,</span> <span class=nx>month</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>date</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 很难理解dateAdd(date, 1)是什么意思
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>dateAdd</span><span class=p>(</span><span class=nx>date</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>dateAddMonth</span><span class=p>(</span><span class=nx>date</span><span class=p>,</span> <span class=nx>month</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>date</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>dateAddMonth</span><span class=p>(</span><span class=nx>date</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=函数应该只做一层抽象>函数应该只做一层抽象</h3><p>当函数的需要的抽象多于一层时通常意味着函数功能过于复杂，需将其进行分解以提高其可重用性和可测试性。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>parseBetterJSAlternative</span><span class=p>(</span><span class=nx>code</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>REGEXES</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>statements</span> <span class=o>=</span> <span class=nx>code</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34; &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>tokens</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>REGEXES</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>REGEX</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>statements</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>statement</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>ast</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>tokens</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>token</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// lex...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>ast</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>node</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// parse...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>tokenize</span><span class=p>(</span><span class=nx>code</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>REGEXES</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>statements</span> <span class=o>=</span> <span class=nx>code</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34; &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>tokens</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>REGEXES</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>REGEX</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>statements</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>statement</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>tokens</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>lexer</span><span class=p>(</span><span class=nx>tokens</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>ast</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>tokens</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>token</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// lex...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>ast</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>parseBetterJSAlternative</span><span class=p>(</span><span class=nx>code</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>tokens</span> <span class=o>=</span> <span class=nx>tokenize</span><span class=p>(</span><span class=nx>code</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>ast</span> <span class=o>=</span> <span class=nx>lexer</span><span class=p>(</span><span class=nx>tokens</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>ast</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>node</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// parse...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=移除重复的代码>移除重复的代码</h3><p>永远、永远、永远不要在任何循环下有重复的代码。</p><p>这种做法毫无意义且潜在危险极大。重复的代码意味着逻辑变化时需要对不止一处进行修改。JS 弱类型的特点使得函数拥有更强的普适性。好好利用这一优点吧。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>showDeveloperList</span><span class=p>(</span><span class=nx>developers</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>developers</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>developer</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>expectedSalary</span> <span class=o>=</span> <span class=nx>developer</span><span class=p>.</span><span class=nx>calculateExpectedSalary</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>experience</span> <span class=o>=</span> <span class=nx>developer</span><span class=p>.</span><span class=nx>getExperience</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>githubLink</span> <span class=o>=</span> <span class=nx>developer</span><span class=p>.</span><span class=nx>getGithubLink</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>expectedSalary</span><span class=o>:</span> <span class=nx>expectedSalary</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>experience</span><span class=o>:</span> <span class=nx>experience</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>githubLink</span><span class=o>:</span> <span class=nx>githubLink</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>render</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>showManagerList</span><span class=p>(</span><span class=nx>managers</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>managers</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>manager</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>expectedSalary</span> <span class=o>=</span> <span class=nx>manager</span><span class=p>.</span><span class=nx>calculateExpectedSalary</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>experience</span> <span class=o>=</span> <span class=nx>manager</span><span class=p>.</span><span class=nx>getExperience</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>portfolio</span> <span class=o>=</span> <span class=nx>manager</span><span class=p>.</span><span class=nx>getMBAProjects</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>expectedSalary</span><span class=o>:</span> <span class=nx>expectedSalary</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>experience</span><span class=o>:</span> <span class=nx>experience</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>portfolio</span><span class=o>:</span> <span class=nx>portfolio</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>render</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>showList</span><span class=p>(</span><span class=nx>employees</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>employees</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>employee</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>expectedSalary</span> <span class=o>=</span> <span class=nx>employee</span><span class=p>.</span><span class=nx>calculateExpectedSalary</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>experience</span> <span class=o>=</span> <span class=nx>employee</span><span class=p>.</span><span class=nx>getExperience</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>portfolio</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>employee</span><span class=p>.</span><span class=nx>type</span> <span class=o>===</span> <span class=s2>&#34;manager&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>portfolio</span> <span class=o>=</span> <span class=nx>employee</span><span class=p>.</span><span class=nx>getMBAProjects</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>portfolio</span> <span class=o>=</span> <span class=nx>employee</span><span class=p>.</span><span class=nx>getGithubLink</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>expectedSalary</span><span class=o>:</span> <span class=nx>expectedSalary</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>experience</span><span class=o>:</span> <span class=nx>experience</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>portfolio</span><span class=o>:</span> <span class=nx>portfolio</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>render</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=采用默认参数精简代码>采用默认参数精简代码</h3><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>writeForumComment</span><span class=p>(</span><span class=nx>subject</span><span class=p>,</span> <span class=nx>body</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>subject</span> <span class=o>=</span> <span class=nx>subject</span> <span class=o>||</span> <span class=s2>&#34;No Subject&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>body</span> <span class=o>=</span> <span class=nx>body</span> <span class=o>||</span> <span class=s2>&#34;No text&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>writeForumComment</span><span class=p>(</span><span class=nx>subject</span> <span class=o>=</span> <span class=s1>&#39;No subject&#39;</span><span class=p>,</span> <span class=nx>body</span> <span class=o>=</span> <span class=s1>&#39;No text&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=使用-objectassign-设置默认对象>使用 Object.assign 设置默认对象</h3><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>menuConfig</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>title</span><span class=o>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>body</span><span class=o>:</span> <span class=s2>&#34;Bar&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>buttonText</span><span class=o>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>cancellable</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>createMenu</span><span class=p>(</span><span class=nx>config</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>config</span><span class=p>.</span><span class=nx>title</span> <span class=o>=</span> <span class=nx>config</span><span class=p>.</span><span class=nx>title</span> <span class=o>||</span> <span class=s2>&#34;Foo&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>config</span><span class=p>.</span><span class=nx>body</span> <span class=o>=</span> <span class=nx>config</span><span class=p>.</span><span class=nx>body</span> <span class=o>||</span> <span class=s2>&#34;Bar&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>config</span><span class=p>.</span><span class=nx>buttonText</span> <span class=o>=</span> <span class=nx>config</span><span class=p>.</span><span class=nx>buttonText</span> <span class=o>||</span> <span class=s2>&#34;Baz&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>config</span><span class=p>.</span><span class=nx>cancellable</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=nx>config</span><span class=p>.</span><span class=nx>cancellable</span> <span class=o>===</span> <span class=kc>undefined</span> <span class=o>?</span> <span class=nx>config</span><span class=p>.</span><span class=nx>cancellable</span> <span class=o>:</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>createMenu</span><span class=p>(</span><span class=nx>menuConfig</span><span class=p>);</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>menuConfig</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>title</span><span class=o>:</span> <span class=s2>&#34;Order&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=c1>// User did not include &#39;body&#39; key
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>buttonText</span><span class=o>:</span> <span class=s2>&#34;Send&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>cancellable</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>createMenu</span><span class=p>(</span><span class=nx>config</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>config</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>assign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>title</span><span class=o>:</span> <span class=s2>&#34;Foo&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>body</span><span class=o>:</span> <span class=s2>&#34;Bar&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>buttonText</span><span class=o>:</span> <span class=s2>&#34;Baz&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>cancellable</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>config</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// config now equals: {title: &#34;Order&#34;, body: &#34;Bar&#34;, buttonText: &#34;Send&#34;, cancellable: true}
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>createMenu</span><span class=p>(</span><span class=nx>menuConfig</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=不要使用标记flag作为函数参数>不要使用标记(Flag)作为函数参数</h3><p>这通常意味着函数的功能的单一性已经被破坏。此时应考虑对函数进行再次划分。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>createFile</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>temp</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>temp</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fs</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s2>&#34;./temp/&#34;</span> <span class=o>+</span> <span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fs</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>createTempFile</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>fs</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s2>&#34;./temp/&#34;</span> <span class=o>+</span> <span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>----------</span><span class=kd>function</span> <span class=nx>createFile</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>fs</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h3 id=避免副作用>避免副作用</h3><p>当函数产生了除了“接受一个值并返回一个结果”之外的行为时，称该函数产生了副作用。比如写文件、修改全局变量或将你的钱全转给了一个陌生人等。</p><p>程序在某些情况下确实需要副作用这一行为，如先前例子中的写文件。这时应该将这些功能集中在一起，不要用多个函数/类修改某个文件。用且只用一个 service 完成这一需求。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// Global variable referenced by following function.
</span></span></span><span class=line><span class=cl><span class=c1>// If we had another function that used this name, now it&#39;d be an array and it could break it.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>name</span> <span class=o>=</span> <span class=s2>&#34;Ryan McDermott&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>splitIntoFirstAndLastName</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span> <span class=o>=</span> <span class=nx>name</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34; &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>splitIntoFirstAndLastName</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>name</span><span class=p>);</span> <span class=c1>// [&#39;Ryan&#39;, &#39;McDermott&#39;];
</span></span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>splitIntoFirstAndLastName</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>name</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34; &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>name</span> <span class=o>=</span> <span class=s2>&#34;Ryan McDermott&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>newName</span> <span class=o>=</span> <span class=nx>splitIntoFirstAndLastName</span><span class=p>(</span><span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>name</span><span class=p>);</span> <span class=c1>// &#39;Ryan McDermott&#39;;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>newName</span><span class=p>);</span> <span class=c1>// [&#39;Ryan&#39;, &#39;McDermott&#39;];
</span></span></span></code></pre></div><h3 id=不要写全局函数>不要写全局函数</h3><p>在 JS 中污染全局是一个非常不好的实践，这么做可能和其他库起冲突，且调用你的 API 的用户在实际环境中得到一个 exception 前对这一情况是一无所知的。</p><p>想象以下例子：如果你想扩展 JS 中的 Array，为其添加一个 <code>diff</code> 函数显示两个数组间的差异，此时应如何去做？你可以将 diff 写入 <code>Array.prototype</code>，但这么做会和其他有类似需求的库造成冲突。如果另一个库对 diff 的需求为比较一个数组中首尾元素间的差异呢？</p><p>使用 ES6 中的 class 对全局的 Array 做简单的扩展显然是一个更棒的选择。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nb>Array</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>diff</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>comparisonArray</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>values</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>hash</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=k>of</span> <span class=nx>comparisonArray</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>hash</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=k>of</span> <span class=k>this</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>hash</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>values</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>values</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>SuperArray</span> <span class=kr>extends</span> <span class=nb>Array</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(...</span><span class=nx>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>super</span><span class=p>(...</span><span class=nx>args</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>diff</span><span class=p>(</span><span class=nx>comparisonArray</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>values</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>hash</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=k>of</span> <span class=nx>comparisonArray</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>hash</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=k>of</span> <span class=k>this</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>hash</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>values</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>values</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=采用函数式编程>采用函数式编程</h3><p>函数式的编程具有更干净且便于测试的特点。尽可能的使用这种风格吧。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>programmerOutput</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Uncle Bobby&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>linesOfCode</span><span class=o>:</span> <span class=mi>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Suzie Q&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>linesOfCode</span><span class=o>:</span> <span class=mi>1500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Jimmy Gosling&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>linesOfCode</span><span class=o>:</span> <span class=mi>150</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Gracie Hopper&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>linesOfCode</span><span class=o>:</span> <span class=mi>1000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>totalOutput</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>programmerOutput</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>totalOutput</span> <span class=o>+=</span> <span class=nx>programmerOutput</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>linesOfCode</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>programmerOutput</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Uncle Bobby&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>linesOfCode</span><span class=o>:</span> <span class=mi>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Suzie Q&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>linesOfCode</span><span class=o>:</span> <span class=mi>1500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Jimmy Gosling&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>linesOfCode</span><span class=o>:</span> <span class=mi>150</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Gracie Hopper&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>linesOfCode</span><span class=o>:</span> <span class=mi>1000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>totalOutput</span> <span class=o>=</span> <span class=nx>programmerOutput</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>programmer</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>programmer</span><span class=p>.</span><span class=nx>linesOfCode</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>reduce</span><span class=p>((</span><span class=nx>acc</span><span class=p>,</span> <span class=nx>linesOfCode</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>acc</span> <span class=o>+</span> <span class=nx>linesOfCode</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=封装判断条件>封装判断条件</h3><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>fsm</span><span class=p>.</span><span class=nx>state</span> <span class=o>===</span> <span class=s2>&#34;fetching&#34;</span> <span class=o>&amp;&amp;</span> <span class=nx>isEmpty</span><span class=p>(</span><span class=nx>listNode</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>/// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>shouldShowSpinner</span><span class=p>(</span><span class=nx>fsm</span><span class=p>,</span> <span class=nx>listNode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>fsm</span><span class=p>.</span><span class=nx>state</span> <span class=o>===</span> <span class=s2>&#34;fetching&#34;</span> <span class=o>&amp;&amp;</span> <span class=nx>isEmpty</span><span class=p>(</span><span class=nx>listNode</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>shouldShowSpinner</span><span class=p>(</span><span class=nx>fsmInstance</span><span class=p>,</span> <span class=nx>listNodeInstance</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h3 id=避免否定情况的判断>避免“否定情况”的判断</h3><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>isDOMNodeNotPresent</span><span class=p>(</span><span class=nx>node</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>isDOMNodeNotPresent</span><span class=p>(</span><span class=nx>node</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>isDOMNodePresent</span><span class=p>(</span><span class=nx>node</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>isDOMNodePresent</span><span class=p>(</span><span class=nx>node</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h3 id=避免条件判断>避免条件判断</h3><p>这看起来似乎不太可能。</p><p>大多人听到这的第一反应是：“怎么可能不用 if 完成其他功能呢？”许多情况下通过使用多态(polymorphism)可以达到同样的目的。</p><p>第二个问题在于采用这种方式的原因是什么。答案是我们之前提到过的：保持函数功能的单一性。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Airplane</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>getCruisingAltitude</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s2>&#34;777&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>getMaxAltitude</span><span class=p>()</span> <span class=o>-</span> <span class=nx>getPassengerCount</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s2>&#34;Air Force One&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>getMaxAltitude</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s2>&#34;Cessna&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>getMaxAltitude</span><span class=p>()</span> <span class=o>-</span> <span class=nx>getFuelExpenditure</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Airplane</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Boeing777</span> <span class=kr>extends</span> <span class=nx>Airplane</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>getCruisingAltitude</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>getMaxAltitude</span><span class=p>()</span> <span class=o>-</span> <span class=nx>getPassengerCount</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>AirForceOne</span> <span class=kr>extends</span> <span class=nx>Airplane</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>getCruisingAltitude</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>getMaxAltitude</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Cessna</span> <span class=kr>extends</span> <span class=nx>Airplane</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>getCruisingAltitude</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>getMaxAltitude</span><span class=p>()</span> <span class=o>-</span> <span class=nx>getFuelExpenditure</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=避免类型判断part-1>避免类型判断(part 1)</h3><p>JS 是弱类型语言，这意味着函数可接受任意类型的参数。</p><p>有时这会对你带来麻烦，你会对参数做一些类型判断。有许多方法可以避免这些情况。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>travelToTexas</span><span class=p>(</span><span class=nx>vehicle</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>vehicle</span> <span class=k>instanceof</span> <span class=nx>Bicycle</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>vehicle</span><span class=p>.</span><span class=nx>peddle</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>currentLocation</span><span class=p>,</span> <span class=k>new</span> <span class=nx>Location</span><span class=p>(</span><span class=s2>&#34;texas&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>vehicle</span> <span class=k>instanceof</span> <span class=nx>Car</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>vehicle</span><span class=p>.</span><span class=nx>drive</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>currentLocation</span><span class=p>,</span> <span class=k>new</span> <span class=nx>Location</span><span class=p>(</span><span class=s2>&#34;texas&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>travelToTexas</span><span class=p>(</span><span class=nx>vehicle</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>vehicle</span><span class=p>.</span><span class=nx>move</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>currentLocation</span><span class=p>,</span> <span class=k>new</span> <span class=nx>Location</span><span class=p>(</span><span class=s2>&#34;texas&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=避免类型判断part-2>避免类型判断(part 2)</h3><p>如果需处理的数据为字符串，整型，数组等类型，无法使用多态并仍有必要对其进行类型检测时，可以考虑使用 TypeScript。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>combine</span><span class=p>(</span><span class=nx>val1</span><span class=p>,</span> <span class=nx>val2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>typeof</span> <span class=nx>val1</span> <span class=o>==</span> <span class=s2>&#34;number&#34;</span> <span class=o>&amp;&amp;</span> <span class=k>typeof</span> <span class=nx>val2</span> <span class=o>==</span> <span class=s2>&#34;number&#34;</span><span class=p>)</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>typeof</span> <span class=nx>val1</span> <span class=o>==</span> <span class=s2>&#34;string&#34;</span> <span class=o>&amp;&amp;</span> <span class=k>typeof</span> <span class=nx>val2</span> <span class=o>==</span> <span class=s2>&#34;string&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>val1</span> <span class=o>+</span> <span class=nx>val2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s2>&#34;Must be of type String or Number&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>combine</span><span class=p>(</span><span class=nx>val1</span><span class=p>,</span> <span class=nx>val2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>val1</span> <span class=o>+</span> <span class=nx>val2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=避免过度优化>避免过度优化</h3><p>现代的浏览器在运行时会对代码自动进行优化。有时人为对代码进行优化可能是在浪费时间。</p><p><a href=https://github.com/petkaantonov/bluebird/wiki/Optimization-killers target=_blank rel=noopener>这里可以找到许多真正需要优化的地方</a></p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// 这里使用变量len是因为在老式浏览器中，
</span></span></span><span class=line><span class=cl><span class=c1>// 直接使用正例中的方式会导致每次循环均重复计算list.length的值，
</span></span></span><span class=line><span class=cl><span class=c1>// 而在现代浏览器中会自动完成优化，这一行为是没有必要的
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>len</span> <span class=o>=</span> <span class=nx>list</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>len</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>list</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h3 id=删除无效的代码>删除无效的代码</h3><p>不再被调用的代码应及时删除。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>oldRequestModule</span><span class=p>(</span><span class=nx>url</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>newRequestModule</span><span class=p>(</span><span class=nx>url</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>req</span> <span class=o>=</span> <span class=nx>newRequestModule</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>inventoryTracker</span><span class=p>(</span><span class=s2>&#34;apples&#34;</span><span class=p>,</span> <span class=nx>req</span><span class=p>,</span> <span class=s2>&#34;www.inventory-awesome.io&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>newRequestModule</span><span class=p>(</span><span class=nx>url</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>req</span> <span class=o>=</span> <span class=nx>newRequestModule</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>inventoryTracker</span><span class=p>(</span><span class=s2>&#34;apples&#34;</span><span class=p>,</span> <span class=nx>req</span><span class=p>,</span> <span class=s2>&#34;www.inventory-awesome.io&#34;</span><span class=p>);</span>
</span></span></code></pre></div><h2 id=对象和数据结构><strong>对象和数据结构</strong></h2><h3 id=使用-getters-和-setters>使用 getters 和 setters</h3><p>JS 没有接口或类型，因此实现这一模式是很困难的，因为我们并没有类似 <code>public</code> 和 <code>private</code> 的关键词。</p><p>然而，使用 getters 和 setters 获取对象的数据远比直接使用点操作符具有优势。为什么呢？</p><ol><li>当需要对获取的对象属性执行额外操作时。</li><li>执行 <code>set</code> 时可以增加规则对要变量的合法性进行判断。</li><li>封装了内部逻辑。</li><li>在存取时可以方便的增加日志和错误处理。</li><li>继承该类时可以重载默认行为。</li><li>从服务器获取数据时可以进行懒加载。</li></ol><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>BankAccount</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>=</span> <span class=mi>1000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>bankAccount</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>BankAccount</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Buy shoes...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>bankAccount</span><span class=p>.</span><span class=nx>balance</span> <span class=o>=</span> <span class=nx>bankAccount</span><span class=p>.</span><span class=nx>balance</span> <span class=o>-</span> <span class=mi>100</span><span class=p>;</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>BankAccount</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>=</span> <span class=mi>1000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// It doesn&#39;t have to be prefixed with `get` or `set` to be a getter/setter
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>withdraw</span><span class=p>(</span><span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>verifyAmountCanBeDeducted</span><span class=p>(</span><span class=nx>amount</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>-=</span> <span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>bankAccount</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>BankAccount</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Buy shoes...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>bankAccount</span><span class=p>.</span><span class=nx>withdraw</span><span class=p>(</span><span class=mi>100</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=让对象拥有私有成员>让对象拥有私有成员</h3><p>可以通过闭包完成</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>Employee</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Employee</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>getName</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>employee</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Employee</span><span class=p>(</span><span class=s2>&#34;John Doe&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Employee name: &#34;</span> <span class=o>+</span> <span class=nx>employee</span><span class=p>.</span><span class=nx>getName</span><span class=p>());</span> <span class=c1>// Employee name: John Doe
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>delete</span> <span class=nx>employee</span><span class=p>.</span><span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Employee name: &#34;</span> <span class=o>+</span> <span class=nx>employee</span><span class=p>.</span><span class=nx>getName</span><span class=p>());</span> <span class=c1>// Employee name: undefined
</span></span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>Employee</span> <span class=o>=</span> <span class=p>(</span><span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nx>Employee</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>getName</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>Employee</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>})();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>employee</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Employee</span><span class=p>(</span><span class=s2>&#34;John Doe&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Employee name: &#34;</span> <span class=o>+</span> <span class=nx>employee</span><span class=p>.</span><span class=nx>getName</span><span class=p>());</span> <span class=c1>// Employee name: John Doe
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>delete</span> <span class=nx>employee</span><span class=p>.</span><span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Employee name: &#34;</span> <span class=o>+</span> <span class=nx>employee</span><span class=p>.</span><span class=nx>getName</span><span class=p>());</span> <span class=c1>// Employee name: John Doe
</span></span></span></code></pre></div><h2 id=类><strong>类</strong></h2><h3 id=单一职责原则-srp>单一职责原则 (SRP)</h3><p>如《代码整洁之道》一书中所述，“修改一个类的理由不应该超过一个”。</p><p>将多个功能塞进一个类的想法很诱人，但这将导致你的类无法达到概念上的内聚，并经常不得不进行修改。</p><p>最小化对一个类需要修改的次数是非常有必要的。如果一个类具有太多太杂的功能，当你对其中一小部分进行修改时，将很难想象到这一修够对代码库中依赖该类的其他模块会带来什么样的影响。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>UserSettings</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>user</span> <span class=o>=</span> <span class=nx>user</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>changeSettings</span><span class=p>(</span><span class=nx>settings</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>verifyCredentials</span><span class=p>(</span><span class=nx>user</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>verifyCredentials</span><span class=p>(</span><span class=nx>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>UserAuth</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>user</span> <span class=o>=</span> <span class=nx>user</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>verifyCredentials</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>UserSettings</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>user</span> <span class=o>=</span> <span class=nx>user</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>auth</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>UserAuth</span><span class=p>(</span><span class=nx>user</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>changeSettings</span><span class=p>(</span><span class=nx>settings</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>auth</span><span class=p>.</span><span class=nx>verifyCredentials</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=开闭原则-ocp>开/闭原则 (OCP)</h3><p>“代码实体(类，模块，函数等)应该易于扩展，难于修改。”</p><p>这一原则指的是我们应允许用户方便的扩展我们代码模块的功能，而不需要打开 js 文件源码手动对其进行修改。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>AjaxRequester</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// What if we wanted another HTTP Method, like DELETE? We would have to
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// open this file up and modify this and put it in manually.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>HTTP_METHODS</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;POST&#34;</span><span class=p>,</span> <span class=s2>&#34;PUT&#34;</span><span class=p>,</span> <span class=s2>&#34;GET&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>get</span><span class=p>(</span><span class=nx>url</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>AjaxRequester</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>HTTP_METHODS</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;POST&#34;</span><span class=p>,</span> <span class=s2>&#34;PUT&#34;</span><span class=p>,</span> <span class=s2>&#34;GET&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>get</span><span class=p>(</span><span class=nx>url</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>addHTTPMethod</span><span class=p>(</span><span class=nx>method</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>HTTP_METHODS</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>method</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=利斯科夫替代原则-lsp>利斯科夫替代原则 (LSP)</h3><p>“子类对象应该能够替换其超类对象被使用”。</p><p>也就是说，如果有一个父类和一个子类，当采用子类替换父类时不应该产生错误的结果。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Rectangle</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>width</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>height</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setColor</span><span class=p>(</span><span class=nx>color</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>render</span><span class=p>(</span><span class=nx>area</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setWidth</span><span class=p>(</span><span class=nx>width</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>width</span> <span class=o>=</span> <span class=nx>width</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setHeight</span><span class=p>(</span><span class=nx>height</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>height</span> <span class=o>=</span> <span class=nx>height</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>getArea</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>width</span> <span class=o>*</span> <span class=k>this</span><span class=p>.</span><span class=nx>height</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Square</span> <span class=kr>extends</span> <span class=nx>Rectangle</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>super</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setWidth</span><span class=p>(</span><span class=nx>width</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>width</span> <span class=o>=</span> <span class=nx>width</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>height</span> <span class=o>=</span> <span class=nx>width</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setHeight</span><span class=p>(</span><span class=nx>height</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>width</span> <span class=o>=</span> <span class=nx>height</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>height</span> <span class=o>=</span> <span class=nx>height</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>renderLargeRectangles</span><span class=p>(</span><span class=nx>rectangles</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>rectangles</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>rectangle</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>rectangle</span><span class=p>.</span><span class=nx>setWidth</span><span class=p>(</span><span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>rectangle</span><span class=p>.</span><span class=nx>setHeight</span><span class=p>(</span><span class=mi>5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>area</span> <span class=o>=</span> <span class=nx>rectangle</span><span class=p>.</span><span class=nx>getArea</span><span class=p>();</span> <span class=c1>// BAD: Will return 25 for Square. Should be 20.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>rectangle</span><span class=p>.</span><span class=nx>render</span><span class=p>(</span><span class=nx>area</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>rectangles</span> <span class=o>=</span> <span class=p>[</span><span class=k>new</span> <span class=nx>Rectangle</span><span class=p>(),</span> <span class=k>new</span> <span class=nx>Rectangle</span><span class=p>(),</span> <span class=k>new</span> <span class=nx>Square</span><span class=p>()];</span>
</span></span><span class=line><span class=cl><span class=nx>renderLargeRectangles</span><span class=p>(</span><span class=nx>rectangles</span><span class=p>);</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Shape</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setColor</span><span class=p>(</span><span class=nx>color</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>render</span><span class=p>(</span><span class=nx>area</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Rectangle</span> <span class=kr>extends</span> <span class=nx>Shape</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>super</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>width</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>height</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setWidth</span><span class=p>(</span><span class=nx>width</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>width</span> <span class=o>=</span> <span class=nx>width</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setHeight</span><span class=p>(</span><span class=nx>height</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>height</span> <span class=o>=</span> <span class=nx>height</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>getArea</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>width</span> <span class=o>*</span> <span class=k>this</span><span class=p>.</span><span class=nx>height</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Square</span> <span class=kr>extends</span> <span class=nx>Shape</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>super</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>length</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setLength</span><span class=p>(</span><span class=nx>length</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>length</span> <span class=o>=</span> <span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>getArea</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>length</span> <span class=o>*</span> <span class=k>this</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>renderLargeShapes</span><span class=p>(</span><span class=nx>shapes</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>shapes</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>shape</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=nx>shape</span><span class=p>.</span><span class=nx>constructor</span><span class=p>.</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s2>&#34;Square&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>shape</span><span class=p>.</span><span class=nx>setLength</span><span class=p>(</span><span class=mi>5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s2>&#34;Rectangle&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>shape</span><span class=p>.</span><span class=nx>setWidth</span><span class=p>(</span><span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>shape</span><span class=p>.</span><span class=nx>setHeight</span><span class=p>(</span><span class=mi>5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>area</span> <span class=o>=</span> <span class=nx>shape</span><span class=p>.</span><span class=nx>getArea</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>shape</span><span class=p>.</span><span class=nx>render</span><span class=p>(</span><span class=nx>area</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>shapes</span> <span class=o>=</span> <span class=p>[</span><span class=k>new</span> <span class=nx>Rectangle</span><span class=p>(),</span> <span class=k>new</span> <span class=nx>Rectangle</span><span class=p>(),</span> <span class=k>new</span> <span class=nx>Square</span><span class=p>()];</span>
</span></span><span class=line><span class=cl><span class=nx>renderLargeShapes</span><span class=p>(</span><span class=nx>shapes</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=接口隔离原则-isp>接口隔离原则 (ISP)</h3><p>“客户端不应该依赖它不需要的接口；一个类对另一个类的依赖应该建立在最小的接口上。”</p><p>在 JS 中，当一个类需要许多参数设置才能生成一个对象时，或许大多时候不需要设置这么多的参数。此时减少对配置参数数量的需求是有益的。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>DOMTraverser</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>settings</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>settings</span> <span class=o>=</span> <span class=nx>settings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>setup</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>rootNode</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>settings</span><span class=p>.</span><span class=nx>rootNode</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>animationModule</span><span class=p>.</span><span class=nx>setup</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>traverse</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>$</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>DOMTraverser</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>rootNode</span><span class=o>:</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementsByTagName</span><span class=p>(</span><span class=s2>&#34;body&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>animationModule</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{},</span> <span class=c1>// Most of the time, we won&#39;t need to animate when traversing.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>});</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>DOMTraverser</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>settings</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>settings</span> <span class=o>=</span> <span class=nx>settings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>options</span> <span class=o>=</span> <span class=nx>settings</span><span class=p>.</span><span class=nx>options</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>setup</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>rootNode</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>settings</span><span class=p>.</span><span class=nx>rootNode</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>setupOptions</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setupOptions</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>animationModule</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>traverse</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>$</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>DOMTraverser</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>rootNode</span><span class=o>:</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementsByTagName</span><span class=p>(</span><span class=s2>&#34;body&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>options</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>animationModule</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><h3 id=依赖反转原则-dip>依赖反转原则 (DIP)</h3><p>该原则有两个核心点：</p><ol><li>高层模块不应该依赖于低层模块。他们都应该依赖于抽象接口。</li><li>抽象接口应该脱离具体实现，具体实现应该依赖于抽象接口。</li></ol><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>InventoryTracker</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>items</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>items</span> <span class=o>=</span> <span class=nx>items</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// BAD: We have created a dependency on a specific request implementation.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// We should just have requestItems depend on a request method: `request`
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>requester</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>InventoryRequester</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>requestItems</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>items</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>item</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>requester</span><span class=p>.</span><span class=nx>requestItem</span><span class=p>(</span><span class=nx>item</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>InventoryRequester</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>REQ_METHODS</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;HTTP&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>requestItem</span><span class=p>(</span><span class=nx>item</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>inventoryTracker</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>InventoryTracker</span><span class=p>([</span><span class=s2>&#34;apples&#34;</span><span class=p>,</span> <span class=s2>&#34;bananas&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nx>inventoryTracker</span><span class=p>.</span><span class=nx>requestItems</span><span class=p>();</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>InventoryTracker</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>items</span><span class=p>,</span> <span class=nx>requester</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>items</span> <span class=o>=</span> <span class=nx>items</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>requester</span> <span class=o>=</span> <span class=nx>requester</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>requestItems</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>items</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>item</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>requester</span><span class=p>.</span><span class=nx>requestItem</span><span class=p>(</span><span class=nx>item</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>InventoryRequesterV1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>REQ_METHODS</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;HTTP&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>requestItem</span><span class=p>(</span><span class=nx>item</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>InventoryRequesterV2</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>REQ_METHODS</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;WS&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>requestItem</span><span class=p>(</span><span class=nx>item</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// By constructing our dependencies externally and injecting them, we can easily
</span></span></span><span class=line><span class=cl><span class=c1>// substitute our request module for a fancy new one that uses WebSockets.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>let</span> <span class=nx>inventoryTracker</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>InventoryTracker</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=s2>&#34;apples&#34;</span><span class=p>,</span> <span class=s2>&#34;bananas&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=k>new</span> <span class=nx>InventoryRequesterV2</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>inventoryTracker</span><span class=p>.</span><span class=nx>requestItems</span><span class=p>();</span>
</span></span></code></pre></div><h3 id=使用-es6-的-classes-而不是-es5-的-function>使用 ES6 的 classes 而不是 ES5 的 Function</h3><p>典型的 ES5 的类(function)在继承、构造和方法定义方面可读性较差。</p><p>当需要继承时，优先选用 classes。</p><p>但是，当在需要更大更复杂的对象时，最好优先选择更小的 function 而非 classes。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>Animal</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>age</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=k>this</span> <span class=k>instanceof</span> <span class=nx>Animal</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s2>&#34;Instantiate Animal with `new`&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>age</span> <span class=o>=</span> <span class=nx>age</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Animal</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>move</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>Mammal</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>age</span><span class=p>,</span> <span class=nx>furColor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=k>this</span> <span class=k>instanceof</span> <span class=nx>Mammal</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s2>&#34;Instantiate Mammal with `new`&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>Animal</span><span class=p>.</span><span class=nx>call</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=nx>age</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>furColor</span> <span class=o>=</span> <span class=nx>furColor</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Mammal</span><span class=p>.</span><span class=nx>prototype</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=nx>Animal</span><span class=p>.</span><span class=nx>prototype</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>Mammal</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>constructor</span> <span class=o>=</span> <span class=nx>Mammal</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>Mammal</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>liveBirth</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>Human</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>age</span><span class=p>,</span> <span class=nx>furColor</span><span class=p>,</span> <span class=nx>languageSpoken</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=k>this</span> <span class=k>instanceof</span> <span class=nx>Human</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s2>&#34;Instantiate Human with `new`&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>Mammal</span><span class=p>.</span><span class=nx>call</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=nx>age</span><span class=p>,</span> <span class=nx>furColor</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>languageSpoken</span> <span class=o>=</span> <span class=nx>languageSpoken</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Human</span><span class=p>.</span><span class=nx>prototype</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=nx>Mammal</span><span class=p>.</span><span class=nx>prototype</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>Human</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>constructor</span> <span class=o>=</span> <span class=nx>Human</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>Human</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>speak</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{};</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Animal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>age</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>age</span> <span class=o>=</span> <span class=nx>age</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>move</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Mammal</span> <span class=kr>extends</span> <span class=nx>Animal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>age</span><span class=p>,</span> <span class=nx>furColor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>super</span><span class=p>(</span><span class=nx>age</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>furColor</span> <span class=o>=</span> <span class=nx>furColor</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>liveBirth</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Human</span> <span class=kr>extends</span> <span class=nx>Mammal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>age</span><span class=p>,</span> <span class=nx>furColor</span><span class=p>,</span> <span class=nx>languageSpoken</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>super</span><span class=p>(</span><span class=nx>age</span><span class=p>,</span> <span class=nx>furColor</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>languageSpoken</span> <span class=o>=</span> <span class=nx>languageSpoken</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>speak</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=使用方法链>使用方法链</h3><p>这里我们的理解与《代码整洁之道》的建议有些不同。</p><p>有争论说方法链不够干净且违反了<a href=https://en.wikipedia.org/wiki/Law_of_Demeter target=_blank rel=noopener>德米特法则</a>，也许这是对的，但这种方法在 JS 及许多库(如 JQuery)中显得非常实用。</p><p>因此，我认为在 JS 中使用方法链是非常合适的。在 class 的函数中返回 this，能够方便的将类需要执行的多个方法链接起来。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Car</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>make</span> <span class=o>=</span> <span class=s2>&#34;Honda&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>model</span> <span class=o>=</span> <span class=s2>&#34;Accord&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>color</span> <span class=o>=</span> <span class=s2>&#34;white&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setMake</span><span class=p>(</span><span class=nx>make</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setModel</span><span class=p>(</span><span class=nx>model</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>model</span> <span class=o>=</span> <span class=nx>model</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setColor</span><span class=p>(</span><span class=nx>color</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>color</span> <span class=o>=</span> <span class=nx>color</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>save</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>make</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>model</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>color</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>car</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Car</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>car</span><span class=p>.</span><span class=nx>setColor</span><span class=p>(</span><span class=s2>&#34;pink&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>car</span><span class=p>.</span><span class=nx>setMake</span><span class=p>(</span><span class=s2>&#34;Ford&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>car</span><span class=p>.</span><span class=nx>setModel</span><span class=p>(</span><span class=s2>&#34;F-150&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>car</span><span class=p>.</span><span class=nx>save</span><span class=p>();</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Car</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>make</span> <span class=o>=</span> <span class=s2>&#34;Honda&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>model</span> <span class=o>=</span> <span class=s2>&#34;Accord&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>color</span> <span class=o>=</span> <span class=s2>&#34;white&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setMake</span><span class=p>(</span><span class=nx>make</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// NOTE: Returning this for chaining
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setModel</span><span class=p>(</span><span class=nx>model</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>model</span> <span class=o>=</span> <span class=nx>model</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// NOTE: Returning this for chaining
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setColor</span><span class=p>(</span><span class=nx>color</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>color</span> <span class=o>=</span> <span class=nx>color</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// NOTE: Returning this for chaining
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>save</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>make</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>model</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>color</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>car</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Car</span><span class=p>().</span><span class=nx>setColor</span><span class=p>(</span><span class=s2>&#34;pink&#34;</span><span class=p>).</span><span class=nx>setMake</span><span class=p>(</span><span class=s2>&#34;Ford&#34;</span><span class=p>).</span><span class=nx>setModel</span><span class=p>(</span><span class=s2>&#34;F-150&#34;</span><span class=p>).</span><span class=nx>save</span><span class=p>();</span>
</span></span></code></pre></div><h3 id=优先使用组合模式而非继承>优先使用组合模式而非继承</h3><p>在著名的<a href=https://en.wikipedia.org/wiki/Design_Patterns target=_blank rel=noopener>设计模式</a>一书中提到，应多使用组合模式而非继承。</p><p>这么做有许多优点，在想要使用继承前，多想想能否通过组合模式满足需求吧。</p><p>那么，在什么时候继承具有更大的优势呢？这取决于你的具体需求，但大多情况下，可以遵守以下三点：</p><ol><li>继承关系表现为"是一个"而非"有一个"(如动物->人 和 用户->用户细节)</li><li>可以复用基类的代码(&ldquo;Human"可以看成是"All animal"的一种)</li><li>希望当基类改变时所有派生类都受到影响(如修改"all animals"移动时的卡路里消耗量)</li></ol><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Employee</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>email</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>email</span> <span class=o>=</span> <span class=nx>email</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Bad because Employees &#34;have&#34; tax data. EmployeeTaxData is not a type of Employee
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>EmployeeTaxData</span> <span class=kr>extends</span> <span class=nx>Employee</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>ssn</span><span class=p>,</span> <span class=nx>salary</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>super</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>ssn</span> <span class=o>=</span> <span class=nx>ssn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>salary</span> <span class=o>=</span> <span class=nx>salary</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Employee</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>email</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>email</span> <span class=o>=</span> <span class=nx>email</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setTaxData</span><span class=p>(</span><span class=nx>ssn</span><span class=p>,</span> <span class=nx>salary</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>taxData</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>EmployeeTaxData</span><span class=p>(</span><span class=nx>ssn</span><span class=p>,</span> <span class=nx>salary</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>EmployeeTaxData</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>ssn</span><span class=p>,</span> <span class=nx>salary</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>ssn</span> <span class=o>=</span> <span class=nx>ssn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>salary</span> <span class=o>=</span> <span class=nx>salary</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h2 id=测试><strong>测试</strong></h2><p><a href=http://gotwarlost.github.io/istanbul/ target=_blank rel=noopener>一些好的覆盖工具</a>。</p><p><a href=http://jstherightway.org/#testing-tools target=_blank rel=noopener>一些好的 JS 测试框架</a>。</p><h3 id=单一的测试每个概念>单一的测试每个概念</h3><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>assert</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;assert&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s2>&#34;MakeMomentJSGreatAgain&#34;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s2>&#34;handles date boundaries&#34;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>date</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>date</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MakeMomentJSGreatAgain</span><span class=p>(</span><span class=s2>&#34;1/1/2015&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>date</span><span class=p>.</span><span class=nx>addDays</span><span class=p>(</span><span class=mi>30</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>date</span><span class=p>.</span><span class=nx>shouldEqual</span><span class=p>(</span><span class=s2>&#34;1/31/2015&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>date</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MakeMomentJSGreatAgain</span><span class=p>(</span><span class=s2>&#34;2/1/2016&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>date</span><span class=p>.</span><span class=nx>addDays</span><span class=p>(</span><span class=mi>28</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>assert</span><span class=p>.</span><span class=nx>equal</span><span class=p>(</span><span class=s2>&#34;02/29/2016&#34;</span><span class=p>,</span> <span class=nx>date</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>date</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MakeMomentJSGreatAgain</span><span class=p>(</span><span class=s2>&#34;2/1/2015&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>date</span><span class=p>.</span><span class=nx>addDays</span><span class=p>(</span><span class=mi>28</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>assert</span><span class=p>.</span><span class=nx>equal</span><span class=p>(</span><span class=s2>&#34;03/01/2015&#34;</span><span class=p>,</span> <span class=nx>date</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>assert</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;assert&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s2>&#34;MakeMomentJSGreatAgain&#34;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s2>&#34;handles 30-day months&#34;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>date</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MakeMomentJSGreatAgain</span><span class=p>(</span><span class=s2>&#34;1/1/2015&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>date</span><span class=p>.</span><span class=nx>addDays</span><span class=p>(</span><span class=mi>30</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>date</span><span class=p>.</span><span class=nx>shouldEqual</span><span class=p>(</span><span class=s2>&#34;1/31/2015&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s2>&#34;handles leap year&#34;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>date</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MakeMomentJSGreatAgain</span><span class=p>(</span><span class=s2>&#34;2/1/2016&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>date</span><span class=p>.</span><span class=nx>addDays</span><span class=p>(</span><span class=mi>28</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>assert</span><span class=p>.</span><span class=nx>equal</span><span class=p>(</span><span class=s2>&#34;02/29/2016&#34;</span><span class=p>,</span> <span class=nx>date</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s2>&#34;handles non-leap year&#34;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>date</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MakeMomentJSGreatAgain</span><span class=p>(</span><span class=s2>&#34;2/1/2015&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>date</span><span class=p>.</span><span class=nx>addDays</span><span class=p>(</span><span class=mi>28</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>assert</span><span class=p>.</span><span class=nx>equal</span><span class=p>(</span><span class=s2>&#34;03/01/2015&#34;</span><span class=p>,</span> <span class=nx>date</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><h2 id=并发><strong>并发</strong></h2><h3 id=用-promises-替代回调>用 Promises 替代回调</h3><p>回调不够整洁并会造成大量的嵌套。ES6 内嵌了 Promises，使用它吧。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;request&#34;</span><span class=p>).</span><span class=nx>get</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;https://en.wikipedia.org/wiki/Robert_Cecil_Martin&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;fs&#34;</span><span class=p>).</span><span class=nx>writeFile</span><span class=p>(</span><span class=s2>&#34;article.html&#34;</span><span class=p>,</span> <span class=nx>response</span><span class=p>.</span><span class=nx>body</span><span class=p>,</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;File written&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;request-promise&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;https://en.wikipedia.org/wiki/Robert_Cecil_Martin&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;fs-promise&#34;</span><span class=p>).</span><span class=nx>writeFile</span><span class=p>(</span><span class=s2>&#34;article.html&#34;</span><span class=p>,</span> <span class=nx>response</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;File written&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span></code></pre></div><h3 id=asyncawait-是较-promises-更好的选择>Async/Await 是较 Promises 更好的选择</h3><p>Promises 是较回调而言更好的一种选择，但 ES7 中的 async 和 await 更胜过 Promises。</p><p>在能使用 ES7 特性的情况下可以尽量使用他们替代 Promises。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;request-promise&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;https://en.wikipedia.org/wiki/Robert_Cecil_Martin&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;fs-promise&#34;</span><span class=p>).</span><span class=nx>writeFile</span><span class=p>(</span><span class=s2>&#34;article.html&#34;</span><span class=p>,</span> <span class=nx>response</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;File written&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>getCleanCodeArticle</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>request</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;request-promise&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>request</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;https://en.wikipedia.org/wiki/Robert_Cecil_Martin&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>fileHandle</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;fs-promise&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>fileHandle</span><span class=p>.</span><span class=nx>writeFile</span><span class=p>(</span><span class=s2>&#34;article.html&#34;</span><span class=p>,</span> <span class=nx>response</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;File written&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=错误处理><strong>错误处理</strong></h2><p>错误抛出是个好东西！这使得你能够成功定位运行状态中的程序产生错误的位置。</p><h3 id=别忘了捕获错误>别忘了捕获错误</h3><p>对捕获的错误不做任何处理是没有意义的。</p><p>代码中 <code>try/catch</code> 的意味着你认为这里可能出现一些错误，你应该对这些可能的错误存在相应的处理方案。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>functionThatMightThrow</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>functionThatMightThrow</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// One option (more noisy than console.log):
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Another option:
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>notifyUserOfError</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Another option:
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>reportErrorToService</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// OR do all three!
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h3 id=不要忽略被拒绝的-promises>不要忽略被拒绝的 promises</h3><p>理由同 <code>try/catch</code>。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>getdata</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>data</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>functionThatMightThrow</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=k>catch</span><span class=p>((</span><span class=nx>error</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>getdata</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>data</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>functionThatMightThrow</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=k>catch</span><span class=p>((</span><span class=nx>error</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// One option (more noisy than console.log):
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Another option:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>notifyUserOfError</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Another option:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>reportErrorToService</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// OR do all three!
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>});</span>
</span></span></code></pre></div><h2 id=格式化><strong>格式化</strong></h2><p>格式化是一件主观的事。如同这里的许多规则一样，这里并没有一定/立刻需要遵守的规则。可以在<a href=http://standardjs.com/rules.html target=_blank rel=noopener>这里</a>完成格式的自动化。</p><h3 id=大小写一致>大小写一致</h3><p>JS 是弱类型语言，合理的采用大小写可以告诉你关于变量/函数等的许多消息。</p><p>这些规则是主观定义的，团队可以根据喜欢进行选择。重点在于无论选择何种风格，都需要注意保持一致性。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>DAYS_IN_WEEK</span> <span class=o>=</span> <span class=mi>7</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>daysInMonth</span> <span class=o>=</span> <span class=mi>30</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>songs</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;Back In Black&#34;</span><span class=p>,</span> <span class=s2>&#34;Stairway to Heaven&#34;</span><span class=p>,</span> <span class=s2>&#34;Hey Jude&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>Artists</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;ACDC&#34;</span><span class=p>,</span> <span class=s2>&#34;Led Zeppelin&#34;</span><span class=p>,</span> <span class=s2>&#34;The Beatles&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>eraseDatabase</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>restore_database</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>animal</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Alpaca</span> <span class=p>{}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>DAYS_IN_WEEK</span> <span class=o>=</span> <span class=mi>7</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>DAYS_IN_MONTH</span> <span class=o>=</span> <span class=mi>30</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>songs</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;Back In Black&#34;</span><span class=p>,</span> <span class=s2>&#34;Stairway to Heaven&#34;</span><span class=p>,</span> <span class=s2>&#34;Hey Jude&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>artists</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;ACDC&#34;</span><span class=p>,</span> <span class=s2>&#34;Led Zeppelin&#34;</span><span class=p>,</span> <span class=s2>&#34;The Beatles&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>eraseDatabase</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>restoreDatabase</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Animal</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Alpaca</span> <span class=p>{}</span>
</span></span></code></pre></div><h3 id=调用函数的函数和被调函数应放在较近的位置>调用函数的函数和被调函数应放在较近的位置</h3><p>当函数间存在相互调用的情况时，应将两者置于较近的位置。</p><p>理想情况下，应将调用其他函数的函数写在被调用函数的上方。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>PerformanceReview</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>employee</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>employee</span> <span class=o>=</span> <span class=nx>employee</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>lookupPeers</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>db</span><span class=p>.</span><span class=nx>lookup</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>employee</span><span class=p>,</span> <span class=s2>&#34;peers&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>lookupMananger</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>db</span><span class=p>.</span><span class=nx>lookup</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>employee</span><span class=p>,</span> <span class=s2>&#34;manager&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>getPeerReviews</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>peers</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>lookupPeers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>perfReview</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>getPeerReviews</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>getManagerReview</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>getSelfReview</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>getManagerReview</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>manager</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>lookupManager</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>getSelfReview</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>review</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>PerformanceReview</span><span class=p>(</span><span class=nx>user</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>review</span><span class=p>.</span><span class=nx>perfReview</span><span class=p>();</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>class</span> <span class=nx>PerformanceReview</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>employee</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>employee</span> <span class=o>=</span> <span class=nx>employee</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>perfReview</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>getPeerReviews</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>getManagerReview</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>getSelfReview</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>getPeerReviews</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>peers</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>lookupPeers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>lookupPeers</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>db</span><span class=p>.</span><span class=nx>lookup</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>employee</span><span class=p>,</span> <span class=s2>&#34;peers&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>getManagerReview</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>manager</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>lookupManager</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>lookupMananger</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>db</span><span class=p>.</span><span class=nx>lookup</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>employee</span><span class=p>,</span> <span class=s2>&#34;manager&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>getSelfReview</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>review</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>PerformanceReview</span><span class=p>(</span><span class=nx>employee</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>review</span><span class=p>.</span><span class=nx>perfReview</span><span class=p>();</span>
</span></span></code></pre></div><h2 id=注释><strong>注释</strong></h2><h3 id=只对存在一定业务逻辑复杂性的代码进行注释>只对存在一定业务逻辑复杂性的代码进行注释</h3><p>注释并不是必须的，好的代码是能够让人一目了然，不用过多无谓的注释。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>hashIt</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// The hash
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>var</span> <span class=nx>hash</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Length of string
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>var</span> <span class=nx>length</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Loop through every character in data
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Get character code.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=kr>char</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>charCodeAt</span><span class=p>(</span><span class=nx>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Make the hash
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>hash</span> <span class=o>=</span> <span class=p>(</span><span class=nx>hash</span> <span class=o>&lt;&lt;</span> <span class=mi>5</span><span class=p>)</span> <span class=o>-</span> <span class=nx>hash</span> <span class=o>+</span> <span class=kr>char</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Convert to 32-bit integer
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>hash</span> <span class=o>=</span> <span class=nx>hash</span> <span class=o>&amp;</span> <span class=nx>hash</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>hashIt</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>hash</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>length</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=kr>char</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>charCodeAt</span><span class=p>(</span><span class=nx>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>hash</span> <span class=o>=</span> <span class=p>(</span><span class=nx>hash</span> <span class=o>&lt;&lt;</span> <span class=mi>5</span><span class=p>)</span> <span class=o>-</span> <span class=nx>hash</span> <span class=o>+</span> <span class=kr>char</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Convert to 32-bit integer
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>hash</span> <span class=o>=</span> <span class=nx>hash</span> <span class=o>&amp;</span> <span class=nx>hash</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=不要在代码库中遗留被注释掉的代码>不要在代码库中遗留被注释掉的代码</h3><p>版本控制的存在是有原因的。让旧代码存在于你的 history 里吧。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>doStuff</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>// doOtherStuff();
</span></span></span><span class=line><span class=cl><span class=c1>// doSomeMoreStuff();
</span></span></span><span class=line><span class=cl><span class=c1>// doSoMuchStuff();
</span></span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>doStuff</span><span class=p>();</span>
</span></span></code></pre></div><h3 id=不需要版本更新类型注释>不需要版本更新类型注释</h3><p>记住，我们可以使用版本控制。废代码、被注释的代码及用注释记录代码中的版本更新说明都是没有必要的。</p><p>需要时可以使用 <code>git log</code> 获取历史版本。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 2016-12-20: Removed monads, didn&#39;t understand them (RM)
</span></span></span><span class=line><span class=cl><span class=cm> * 2016-10-01: Improved using special monads (JP)
</span></span></span><span class=line><span class=cl><span class=cm> * 2016-02-03: Removed type-checking (LI)
</span></span></span><span class=line><span class=cl><span class=cm> * 2015-03-14: Added combine with type-checking (JR)
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>combine</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>a</span> <span class=o>+</span> <span class=nx>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>combine</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>a</span> <span class=o>+</span> <span class=nx>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=避免位置标记>避免位置标记</h3><p>这些东西通常只能代码麻烦，采用适当的缩进就可以了。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>////////////////////////////////////////////////////////////////////////////////
</span></span></span><span class=line><span class=cl><span class=c1>// Scope Model Instantiation
</span></span></span><span class=line><span class=cl><span class=c1>////////////////////////////////////////////////////////////////////////////////
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>let</span> <span class=nx>$scope</span><span class=p>.</span><span class=nx>model</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>menu</span><span class=o>:</span> <span class=s1>&#39;foo&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>nav</span><span class=o>:</span> <span class=s1>&#39;bar&#39;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>////////////////////////////////////////////////////////////////////////////////
</span></span></span><span class=line><span class=cl><span class=c1>// Action setup
</span></span></span><span class=line><span class=cl><span class=c1>////////////////////////////////////////////////////////////////////////////////
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>let</span> <span class=nx>actions</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>let</span> <span class=nx>$scope</span><span class=p>.</span><span class=nx>model</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>menu</span><span class=o>:</span> <span class=s1>&#39;foo&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>nav</span><span class=o>:</span> <span class=s1>&#39;bar&#39;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>actions</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h3 id=避免在源文件中写入法律评论>避免在源文件中写入法律评论</h3><p>将你的 <code>LICENSE</code> 文件置于源码目录树的根目录。</p><p><strong>反例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>The MIT License (MIT)
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>Copyright (c) 2016 Ryan McDermott
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>Permission is hereby granted, free of charge, to any person obtaining a copy
</span></span></span><span class=line><span class=cl><span class=cm>of this software and associated documentation files (the &#34;Software&#34;), to deal
</span></span></span><span class=line><span class=cl><span class=cm>in the Software without restriction, including without limitation the rights
</span></span></span><span class=line><span class=cl><span class=cm>to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
</span></span></span><span class=line><span class=cl><span class=cm>copies of the Software, and to permit persons to whom the Software is
</span></span></span><span class=line><span class=cl><span class=cm>furnished to do so, subject to the following conditions:
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>The above copyright notice and this permission notice shall be included in all
</span></span></span><span class=line><span class=cl><span class=cm>copies or substantial portions of the Software.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>THE SOFTWARE IS PROVIDED &#34;AS IS&#34;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
</span></span></span><span class=line><span class=cl><span class=cm>IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
</span></span></span><span class=line><span class=cl><span class=cm>FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
</span></span></span><span class=line><span class=cl><span class=cm>AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
</span></span></span><span class=line><span class=cl><span class=cm>LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
</span></span></span><span class=line><span class=cl><span class=cm>OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
</span></span></span><span class=line><span class=cl><span class=cm>SOFTWARE
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>calculateBill</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p><strong>正例</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>calculateBill</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div></div><div class=article-widget><div class="container-xl row post-nav"></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte-website.oss-accelerate.aliyuncs.com/disqus/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte-website.oss-accelerate.aliyuncs.com/disqus/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>