<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="状态管理概述与技术选型 Redux 是完全的函数式编程思想践行者(如果你对于 Redux 还不够理解，可以参考下笔者的深入理解 Redux:10 个来自专家的 Redux 实践建议)，其核心技术围绕遵循 Pure Function 的 Reducer 与遵循 Immutable Object 的 Single State Tree，提供了 Extreme Predictability 与 Extreme Te"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5/%E6%B8%90%E8%BF%9B%E7%9A%84%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5/%E6%B8%90%E8%BF%9B%E7%9A%84%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5/%E6%B8%90%E8%BF%9B%E7%9A%84%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/"><meta property="og:title" content="渐进的状态管理 | Next-gen Tech Edu"><meta property="og:description" content="状态管理概述与技术选型 Redux 是完全的函数式编程思想践行者(如果你对于 Redux 还不够理解，可以参考下笔者的深入理解 Redux:10 个来自专家的 Redux 实践建议)，其核心技术围绕遵循 Pure Function 的 Reducer 与遵循 Immutable Object 的 Single State Tree，提供了 Extreme Predictability 与 Extreme Te"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>渐进的状态管理 | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=87f6733cba5a485baec5b6d4589513ab><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">设计理念</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idc7e3545f103271a0a9ef3ee59048fe6b")' href=#idc7e3545f103271a0a9ef3ee59048fe6b aria-expanded=false aria-controls=idc7e3545f103271a0a9ef3ee59048fe6b aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/>04.状态管理</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idc7e3545f103271a0a9ef3ee59048fe6b aria-expanded=false aria-controls=idc7e3545f103271a0a9ef3ee59048fe6b><i class="fa-solid fa-angle-down" id=caret-idc7e3545f103271a0a9ef3ee59048fe6b></i></a></div><ul class="nav docs-sidenav collapse show" id=idc7e3545f103271a0a9ef3ee59048fe6b><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id8da5be1c9c9912685830d6a918bb7607")' href=#id8da5be1c9c9912685830d6a918bb7607 aria-expanded=false aria-controls=id8da5be1c9c9912685830d6a918bb7607 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/mobx/>MobX</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id8da5be1c9c9912685830d6a918bb7607 aria-expanded=false aria-controls=id8da5be1c9c9912685830d6a918bb7607><i class="fa-solid fa-angle-right" id=caret-id8da5be1c9c9912685830d6a918bb7607></i></a></div><ul class="nav docs-sidenav collapse" id=id8da5be1c9c9912685830d6a918bb7607><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/mobx/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E4%B8%8E%E9%80%8F%E6%98%8E%E5%93%8D%E5%BA%94/>底层原理与透明响应</a></li><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/mobx/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%9B%91%E5%90%AC/>响应式监听</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idd608246a89e49eea6aca9decf0e59d5d")' href=#idd608246a89e49eea6aca9decf0e59d5d aria-expanded=false aria-controls=idd608246a89e49eea6aca9decf0e59d5d aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/>Redux</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idd608246a89e49eea6aca9decf0e59d5d aria-expanded=false aria-controls=idd608246a89e49eea6aca9decf0e59d5d><i class="fa-solid fa-angle-right" id=caret-idd608246a89e49eea6aca9decf0e59d5d></i></a></div><ul class="nav docs-sidenav collapse" id=idd608246a89e49eea6aca9decf0e59d5d><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id2bc60a1bfa7451f8b42cbfad454f2651")' href=#id2bc60a1bfa7451f8b42cbfad454f2651 aria-expanded=false aria-controls=id2bc60a1bfa7451f8b42cbfad454f2651 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/%E5%B7%A5%E7%A8%8B%E6%A1%86%E6%9E%B6/>工程框架</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id2bc60a1bfa7451f8b42cbfad454f2651 aria-expanded=false aria-controls=id2bc60a1bfa7451f8b42cbfad454f2651><i class="fa-solid fa-angle-right" id=caret-id2bc60a1bfa7451f8b42cbfad454f2651></i></a></div><ul class="nav docs-sidenav collapse" id=id2bc60a1bfa7451f8b42cbfad454f2651><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id66aa16ab5053e53e5256dac0d12810fe")' href=#id66aa16ab5053e53e5256dac0d12810fe aria-expanded=false aria-controls=id66aa16ab5053e53e5256dac0d12810fe aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/%E5%B7%A5%E7%A8%8B%E6%A1%86%E6%9E%B6/kea/>Kea</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id66aa16ab5053e53e5256dac0d12810fe aria-expanded=false aria-controls=id66aa16ab5053e53e5256dac0d12810fe><i class="fa-solid fa-angle-right" id=caret-id66aa16ab5053e53e5256dac0d12810fe></i></a></div><ul class="nav docs-sidenav collapse" id=id66aa16ab5053e53e5256dac0d12810fe><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/%E5%B7%A5%E7%A8%8B%E6%A1%86%E6%9E%B6/kea/%E6%8F%92%E4%BB%B6/>插件</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id7dc38bb16b021cd1a50a627fc66c4981")' href=#id7dc38bb16b021cd1a50a627fc66c4981 aria-expanded=false aria-controls=id7dc38bb16b021cd1a50a627fc66c4981 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/%E5%B7%A5%E7%A8%8B%E6%A1%86%E6%9E%B6/redux-toolkit/>Redux Toolkit</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id7dc38bb16b021cd1a50a627fc66c4981 aria-expanded=false aria-controls=id7dc38bb16b021cd1a50a627fc66c4981><i class="fa-solid fa-angle-right" id=caret-id7dc38bb16b021cd1a50a627fc66c4981></i></a></div><ul class="nav docs-sidenav collapse" id=id7dc38bb16b021cd1a50a627fc66c4981><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/%E5%B7%A5%E7%A8%8B%E6%A1%86%E6%9E%B6/redux-toolkit/api-%E7%AE%80%E5%8C%96/>API 简化</a></li><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/%E5%B7%A5%E7%A8%8B%E6%A1%86%E6%9E%B6/redux-toolkit/typescript/>TypeScript</a></li><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/%E5%B7%A5%E7%A8%8B%E6%A1%86%E6%9E%B6/redux-toolkit/%E6%95%B0%E6%8D%AE%E6%A0%87%E5%87%86%E5%8C%96/>数据标准化</a></li><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/%E5%B7%A5%E7%A8%8B%E6%A1%86%E6%9E%B6/redux-toolkit/%E5%BC%82%E6%AD%A5%E6%A8%A1%E5%BC%8F/>异步模式</a></li></ul></div><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/%E5%B7%A5%E7%A8%8B%E6%A1%86%E6%9E%B6/redux-actions/>redux-actions</a></li><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/%E5%B7%A5%E7%A8%8B%E6%A1%86%E6%9E%B6/%E4%BB%A3%E7%A0%81%E7%BB%84%E7%BB%87/>代码组织</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id3f75423a6282c5797f6aa93692175c58")' href=#id3f75423a6282c5797f6aa93692175c58 aria-expanded=false aria-controls=id3f75423a6282c5797f6aa93692175c58 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/>基础语法</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id3f75423a6282c5797f6aa93692175c58 aria-expanded=false aria-controls=id3f75423a6282c5797f6aa93692175c58><i class="fa-solid fa-angle-right" id=caret-id3f75423a6282c5797f6aa93692175c58></i></a></div><ul class="nav docs-sidenav collapse" id=id3f75423a6282c5797f6aa93692175c58><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/redux-scratch/>Redux Scratch</a></li><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6/>核心组件</a></li><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/>设计原则</a></li><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/%E7%8A%B6%E6%80%81%E6%A0%91%E8%AE%BE%E8%AE%A1/>状态树设计</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id594166fef4add1f8d261fe62d8a7466c")' href=#id594166fef4add1f8d261fe62d8a7466c aria-expanded=false aria-controls=id594166fef4add1f8d261fe62d8a7466c aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%B8%8E%E5%BC%82%E6%AD%A5/>中间件与异步</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id594166fef4add1f8d261fe62d8a7466c aria-expanded=false aria-controls=id594166fef4add1f8d261fe62d8a7466c><i class="fa-solid fa-angle-right" id=caret-id594166fef4add1f8d261fe62d8a7466c></i></a></div><ul class="nav docs-sidenav collapse" id=id594166fef4add1f8d261fe62d8a7466c><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%B8%8E%E5%BC%82%E6%AD%A5/observable/>Observable</a></li><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%B8%8E%E5%BC%82%E6%AD%A5/promise/>Promise</a></li><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%B8%8E%E5%BC%82%E6%AD%A5/sagas/>Sagas</a></li><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%B8%8E%E5%BC%82%E6%AD%A5/thunk/>Thunk</a></li><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%B8%8E%E5%BC%82%E6%AD%A5/%E4%B8%AD%E9%97%B4%E4%BB%B6/>中间件</a></li></ul></div></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id9db47c02f350e7ff04bcf8f01354c764")' href=#id9db47c02f350e7ff04bcf8f01354c764 aria-expanded=false aria-controls=id9db47c02f350e7ff04bcf8f01354c764 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5/>设计理念</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id9db47c02f350e7ff04bcf8f01354c764 aria-expanded=false aria-controls=id9db47c02f350e7ff04bcf8f01354c764><i class="fa-solid fa-angle-down" id=caret-id9db47c02f350e7ff04bcf8f01354c764></i></a></div><ul class="nav docs-sidenav collapse show" id=id9db47c02f350e7ff04bcf8f01354c764><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5/flux/>Flux</a></li><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5/%E5%8D%95%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81/>单向数据流</a></li><li class="child level active"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5/%E6%B8%90%E8%BF%9B%E7%9A%84%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/>渐进的状态管理</a></li><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5/%E6%95%B0%E6%8D%AE%E6%B5%81%E9%A9%B1%E5%8A%A8%E7%9A%84%E7%95%8C%E9%9D%A2/>数据流驱动的界面</a></li></ul></div><li class="child level"><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E6%A1%86%E6%9E%B6%E5%AF%B9%E6%AF%94/>状态管理框架对比</a></li></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#了解下-mobx>了解下 MobX</a></li></ul><ul><li><a href=#high-order-component>High Order Component</a></li><li><a href=#immutable-state-tree-in-single-store>Immutable State Tree in Single Store</a></li></ul><ul><li><a href=#原型--local-state>原型 | Local State</a></li><li><a href=#项目增长--external-state>项目增长 | External State</a></li><li><a href=#多人协作严格规范复杂交互redux>多人协作/严格规范/复杂交互：Redux</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>渐进的状态管理</h1><div class=article-style><h1 id=状态管理概述与技术选型>状态管理概述与技术选型</h1><p>Redux 是完全的<a href=https://github.com/wx-chevalier/Coder-Essentials/blob/master/ProgrammingParadigm/FunctionalProgramming/So-You-Want-To-Be-A-Functional-Programmer.md target=_blank rel=noopener>函数式编程思想</a>践行者(如果你对于 Redux 还不够理解，可以参考下笔者的<a href=https://segmentfault.com/a/1190000006769471 target=_blank rel=noopener>深入理解 Redux:10 个来自专家的 Redux 实践建议</a>)，其核心技术围绕遵循 Pure Function 的 Reducer 与遵循 Immutable Object 的 Single State Tree，提供了 Extreme Predictability 与 Extreme Testability，相对应的需要大量的 Boilerplate。而<a href=https://github.com/mobxjs/mobx target=_blank rel=noopener>MobX</a>则是 Less Opinioned，其脱胎于 Reactive Programming，其核心思想为 Anything that can be derived from the application state, should be derived. Automatically，即避免任何的重复状态。Redux 使用了 Uniform Single State Tree，而在后端开发中习惯了 Object Oriented Programming 的笔者不由自主的也想在前端引入 Entity，或者说在设计思想上，譬如对于 TodoList 的增删改查，笔者希望能够包含在某个 TodoList 对象中，而不需要将所有的操作拆分为 Creator、Reducer 与 Selector 三个部分，我只是想简单的展示个列表而已。笔者上大学学的第一节课就是讲 OOP，包括后面在 C#、Java、Python、PHP 等等很多后端领域的实践中，都深受 OOP 思想的熏陶与灌输。不可否认，可变的状态是软件工程中的万恶之源，但是，OOP 对于业务逻辑的描述与代码组织的可读性、可理解性的保证相较于声明式的，略为抽象的 FP 还是要好一点的。我认可函数式编程的思想成为项目构建组织的不可分割的一部分，但是是否应该在任何项目的任何阶段都先谈编程思想，而后看业务需求？这无疑有点政治正确般的耍流氓了，笔者觉得文本唯一声明秉持的思想就是在不同级别/需求的项目发展的不同阶段我们应该使用不同的技术栈与技术搭配，而本文要讨论的核心即是如何寻求一种尽可能平稳与提供碎片化代码的能够贯彻项目整个生命周期的代码组织或者框架选用方案。</p><p>无论是 MobX 还是 Redux，它们都非局限于某个界面层框架所使用的状态管理工具。</p><p>Redux 与 MobX 相比非常抽象，并且学习曲线也更为复杂；特别是对于大型应用而言，我们需要考虑</p><p>综上所述，笔者认为 MobX 更适合于实时系统、控制台、文本编辑器、展示型软件等非时间驱动型的应用，而 Redux 适用于商业应用或者交互复杂的游戏等等场景。</p><h1 id=渐进的状态管理>渐进的状态管理</h1><h1 id=复杂单页应用的状态设计>复杂单页应用的状态设计</h1><h1 id=redux-really-do-the-right-thingredux-always-do-the-best-thing>Redux Really Do The Right Thing！Redux Always Do The Best Thing?</h1><p>Redux 的 DevTools 与 Time Travel 是如此的优雅与酷炫，再也不用担心应用莫名其妙崩溃而找不到原因，还能方便地同构直出了呢。不过就像笔者在<a href=https://segmentfault.com/a/1190000007083024 target=_blank rel=noopener>2016 年里做前端是怎样一种体验</a>一文中所描述的，我只是想简单的从服务端获取个列表数据然后展示出来，你却告诉我要去学习 TypeScript+Webpack+SystemJS+Babel+React+Redux 等等，怎么看都还是 jQuery 的时代简单明了啊。以最基础的添加用户功能来说，在 jQuery 的时代我们只需要调用 Ajax 然后等待结果即可，这样当然是有问题的，项目的代码混乱度会随着需求的增加而几何倍数增长。而 Redux 则以较为严格的规范帮我们实现了 Single Responsibility，这样我们至少需要写 Reducer、ActionCreator、Store、Selector 等等几个文件，当然，在有些最佳实践里会把这几个部分归纳到一个文件中，不过自从笔者发现某个上千行的文件我连看都不想看的时候，觉得还是拆开来好:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>initialState</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>users</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Dan&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Michel&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// reducer
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>users</span><span class=p>(</span><span class=nx>state</span> <span class=o>=</span> <span class=nx>initialState</span><span class=p>,</span> <span class=nx>action</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=nx>action</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s2>&#34;USER_ADD&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>{</span> <span class=p>...</span><span class=nx>state</span><span class=p>,</span> <span class=nx>users</span><span class=o>:</span> <span class=p>[...</span><span class=nx>state</span><span class=p>.</span><span class=nx>users</span><span class=p>,</span> <span class=nx>action</span><span class=p>.</span><span class=nx>user</span><span class=p>]</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>state</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// action
</span></span></span><span class=line><span class=cl><span class=c1>// { type: &#39;USER_ADD&#39;, user: user };
</span></span></span></code></pre></div><p>然后你需要在需要调用该 Action 的地方执行以下操作:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>dispatch</span><span class=p>({</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;USER_ADD&#34;</span><span class=p>,</span> <span class=nx>user</span><span class=o>:</span> <span class=nx>user</span> <span class=p>});</span>
</span></span></code></pre></div><p>笔者最近的两个项目中都使用了 Redux 作为核心的状态管理工具中，之前是觉得只要有合适的脚手架 <a href=https://github.com/wx-chevalier/Webpack-React-Redux-Boilerplate target=_blank rel=noopener>Webpack-React-Redux-Boilerplate</a> 就可以了，不过很多时候看着从 Action Creator 到 Reducer，再到 Selector 这一系列的仅仅为了实现某个小功能而需要写的 N 多的 Boilerplate，就觉得这并不是我所想要的。就好像现在 View 层人们经常会讨论对比 Vue 与 React，虽然 Redux 目前在状态管理领域一骑绝尘，但是也有越来越多的人关注 MobX。笔者之前翻译过一篇文章，<a href=https://segmentfault.com/a/1190000006966262 target=_blank rel=noopener>你并不需要 Redux</a>，这是一篇来自 Redux 作者的对于 Redux 滥用情况的吐槽。从上面的例子中也可以看出，如果你使用 Redux 的话，你必须要遵循如下规范:</p><ul><li>必须使用基本对象与数组来描述应用状态</li><li>必须使用基本的对象来描述系统变化</li><li>必须使用纯函数来处理系统中的业务逻辑</li></ul><p>而 Dan 推荐的适用 Redux 的情况典型的有：</p><ul><li><p><a href="https://egghead.io/lessons/javascript-redux-persisting-the-state-to-the-local-storage?course=building-react-applications-with-idiomatic-redux" target=_blank rel=noopener>方便地能够将应用状态存储到本地并且重启动时能够读取恢复状态</a></p></li><li><p><a href=http://redux.js.org/docs/recipes/ServerRendering.html target=_blank rel=noopener>方便地能够在服务端完成初始状态设置，并且完成状态的服务端渲染</a></p></li><li><p><a href=https://github.com/dtschust/redux-bug-reporter target=_blank rel=noopener>能够序列化记录用户操作，能够设置状态快照，从而方便进行 Bug 报告与开发者的错误重现</a></p></li><li><p><a href=https://github.com/philholden/redux-swarmlog target=_blank rel=noopener>能够将用户的操作或者事件传递给其他环境而不需要修改现有代码</a></p></li><li><p><a href=http://redux.js.org/docs/recipes/ImplementingUndoHistory.html target=_blank rel=noopener>能够添加重放或者撤销功能而不需要重构代码</a></p></li><li><p><a href=https://github.com/gaearon/redux-devtools target=_blank rel=noopener>能够在开发过程中实现状态历史的回溯，或者根据 Action 的历史重现状态</a></p></li><li><p><a href=https://github.com/romseguy/redux-devtools-chart-monitor target=_blank rel=noopener>能够为开发者提供全面透彻的审视和修改现有开发工具的接口，从而保证产品的开发者能够根据他们自己的应用需求打造专门的工具</a></p></li><li><p><a href="https://youtu.be/gvVpSezT5_M?t=11m51s" target=_blank rel=noopener>能够在复用现在大部分业务逻辑的基础上构造不同的界面</a></p></li></ul><p>笔者觉得，Redux 适合于需要强项目健壮度与多人协调规范的大中型团队，对于很多中小型创业性质，项目需求迭代异常快的团队则往往可能起到适得其反的作用。如果你真的喜欢 Redux，那么更应该在合适的项目，合适的阶段去接入 Redux，而不是在需求尚未成型之处就花费大量精力搭建复杂的脚手架，说不准客户的需求图纸都画反了呢。</p><h2 id=了解下-mobx>了解下 MobX</h2><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://github.com/mobxjs/mobx/raw/master/docs/flow.png alt loading=lazy data-zoomable></div></div></figure></p><p>MobX 中核心的概念即是 Observable，相信接触过响应式编程的肯定非常熟悉，从后端的典型代表 RxJava 到 Android/iOS 开发中的各种响应式框架都各领风骚。这里我们以构建简单的 TODOList 为例，代码参考了笔者的<a href=https://github.com/wx-chevalier/Web-Frontend-Introduction-And-Best-Practices/tree/master/OpenSource/mobx-react-webpack-boilerplate target=_blank rel=noopener>mobx-react-webpack-boilerplate</a>这个库。首先，以典型的 OOP 的思想来考虑，我们需要构建 ToDo 的实体类:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span><span class=nx>observable</span><span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;mobx&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kr>class</span> <span class=nx>TodoModel</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=err> </span><span class=nx>store</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=err> </span><span class=nx>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=err> @</span><span class=nx>observable</span> <span class=nx>title</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=err> @</span><span class=nx>observable</span> <span class=nx>completed</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err> </span><span class=nx>constructor</span><span class=p>(</span><span class=nx>store</span><span class=p>,</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>title</span><span class=p>,</span> <span class=nx>completed</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=err> </span> <span class=k>this</span><span class=p>.</span><span class=nx>store</span> <span class=o>=</span> <span class=nx>store</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=err> </span> <span class=k>this</span><span class=p>.</span><span class=nx>id</span> <span class=o>=</span> <span class=nx>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=err> </span> <span class=k>this</span><span class=p>.</span><span class=nx>title</span> <span class=o>=</span> <span class=nx>title</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=err> </span> <span class=k>this</span><span class=p>.</span><span class=nx>completed</span> <span class=o>=</span> <span class=nx>completed</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=err> </span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=err> </span><span class=p>...</span> <span class=c1>//还有一些功能函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p>这里 <code>@observable</code> 注解标注某个变量为被观测值，一旦某个被观测的变量发生了变化，即可以触发观测值相对应的响应。在写好了模型类之后，我们需要编写 Store，这里的 Store 同时包含了数据存储与对数据的操作，和 Redux 中的 Single State Tree 差别还是较大的:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>observable</span><span class=p>,</span> <span class=nx>computed</span><span class=p>,</span> <span class=nx>reaction</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;mobx&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>TodoModel</span> <span class=nx>from</span> <span class=s1>&#39;../models/TodoModel&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=o>*</span> <span class=nx>as</span> <span class=nx>Utils</span> <span class=nx>from</span> <span class=s1>&#39;../utils&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kr>class</span> <span class=nx>TodoStore</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=err>@</span><span class=nx>observable</span> <span class=nx>todos</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=err>@</span><span class=nx>computed</span>
</span></span><span class=line><span class=cl>  <span class=nx>get</span> <span class=nx>activeTodoCount</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>todos</span><span class=p>.</span><span class=nx>reduce</span><span class=p>((</span><span class=nx>sum</span><span class=p>,</span> <span class=nx>todo</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>sum</span> <span class=o>+</span> <span class=p>(</span><span class=nx>todo</span><span class=p>.</span><span class=nx>completed</span> <span class=o>?</span> <span class=mi>0</span> <span class=o>:</span> <span class=mi>1</span><span class=p>),</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=err>@</span><span class=nx>computed</span>
</span></span><span class=line><span class=cl>  <span class=nx>get</span> <span class=nx>completedCount</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>todos</span><span class=p>.</span><span class=nx>length</span> <span class=o>-</span> <span class=k>this</span><span class=p>.</span><span class=nx>activeTodoCount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>subscribeServerToStore</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>reaction</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=p>()</span> <span class=p>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>toJS</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>      <span class=nx>todos</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nx>fetch</span><span class=p>(</span><span class=s1>&#39;/api/todos&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>method</span><span class=o>:</span> <span class=s1>&#39;post&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>body</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span> <span class=nx>todos</span> <span class=p>}),</span>
</span></span><span class=line><span class=cl>          <span class=nx>headers</span><span class=o>:</span> <span class=k>new</span> <span class=nx>Headers</span><span class=p>({</span> <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>subscribeLocalstorageToStore</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>reaction</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=p>()</span> <span class=p>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>toJS</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>      <span class=nx>todos</span> <span class=p>=&gt;</span> <span class=nx>localStorage</span><span class=p>.</span><span class=nx>setItem</span><span class=p>(</span><span class=s1>&#39;mobx-react-todomvc-todos&#39;</span><span class=p>,</span> <span class=nx>todos</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>addTodo</span><span class=p>(</span><span class=nx>title</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>todos</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=k>new</span> <span class=nx>TodoModel</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=nx>Utils</span><span class=p>.</span><span class=nx>uuid</span><span class=p>(),</span> <span class=nx>title</span><span class=p>,</span> <span class=kc>false</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>toggleAll</span><span class=p>(</span><span class=nx>checked</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>todos</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>todo</span> <span class=p>=&gt;</span> <span class=p>(</span><span class=nx>todo</span><span class=p>.</span><span class=nx>completed</span> <span class=o>=</span> <span class=nx>checked</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>clearCompleted</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>todos</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>todos</span><span class=p>.</span><span class=nx>filter</span><span class=p>(</span><span class=nx>todo</span> <span class=p>=&gt;</span> <span class=o>!</span><span class=nx>todo</span><span class=p>.</span><span class=nx>completed</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>这里有使用@computed 注解，这里的@computed 注解即是表示该变量是可以从被观测值中推导而出，而不需要你手动触发判断的。最后在我们的 View 层，同样可以将其设置为 Observer 来响应状态的变换:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=err>@</span><span class=nx>observer</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kr>class</span> <span class=nx>TodoApp</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>todoStore</span><span class=p>,</span> <span class=nx>viewStore</span> <span class=p>}</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>DevTool</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>header</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;header&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=nx>todos</span><span class=o>&lt;</span><span class=err>/h1&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>TodoEntry</span> <span class=nx>todoStore</span><span class=o>=</span><span class=p>{</span><span class=nx>todoStore</span><span class=p>}</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/header&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>TodoOverview</span> <span class=nx>todoStore</span><span class=o>=</span><span class=p>{</span><span class=nx>todoStore</span><span class=p>}</span> <span class=nx>viewStore</span><span class=o>=</span><span class=p>{</span><span class=nx>viewStore</span><span class=p>}</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>TodoFooter</span> <span class=nx>todoStore</span><span class=o>=</span><span class=p>{</span><span class=nx>todoStore</span><span class=p>}</span> <span class=nx>viewStore</span><span class=o>=</span><span class=p>{</span><span class=nx>viewStore</span><span class=p>}</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>componentDidMount</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>viewStore</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>viewStore</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>router</span> <span class=o>=</span> <span class=nx>Router</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;/&#34;</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>viewStore</span><span class=p>.</span><span class=nx>todoFilter</span> <span class=o>=</span> <span class=nx>ALL_TODOS</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;/active&#34;</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>viewStore</span><span class=p>.</span><span class=nx>todoFilter</span> <span class=o>=</span> <span class=nx>ACTIVE_TODOS</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;/completed&#34;</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>viewStore</span><span class=p>.</span><span class=nx>todoFilter</span> <span class=o>=</span> <span class=nx>COMPLETED_TODOS</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=nx>router</span><span class=p>.</span><span class=nx>init</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>TodoApp</span><span class=p>.</span><span class=nx>propTypes</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>viewStore</span><span class=o>:</span> <span class=nx>React</span><span class=p>.</span><span class=nx>PropTypes</span><span class=p>.</span><span class=nx>object</span><span class=p>.</span><span class=nx>isRequired</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>todoStore</span><span class=o>:</span> <span class=nx>React</span><span class=p>.</span><span class=nx>PropTypes</span><span class=p>.</span><span class=nx>object</span><span class=p>.</span><span class=nx>isRequired</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h1 id=我们需要状态管理吗>我们需要状态管理吗？</h1><p>笔者在<a href=https://segmentfault.com/a/1190000004292245 target=_blank rel=noopener>我的前端之路</a>这篇综述中提过，前端一直在从随意化到工程化的变革，而笔者认为的工程化的几个特征，即视图组件化、功能模块化与状态管理。笔者觉得，在构建前端项目，乃至于编写简单的 HTML 页面时，能够考虑状态管理这个概念，并且为以后引入专门的状态管理预留一定的接口空间是件很有意义的事情。而状态管理也并不意味着你就需要 Redux 或者 MobX 这样专门的框架，就像<a href=https://segmentfault.com/a/1190000006966262 target=_blank rel=noopener>你不一定需要 Redux</a>中所说的，Local State is Fine，有何不可呢？技术应该服务于业务，服务于产品，那状态管理给予了我们什么样的便捷？建议先阅读下笔者的<a href=https://segmentfault.com/a/1190000005947593 target=_blank rel=noopener>Web 开发中所谓状态浅析:Domain State&UI State</a>，对于某个前端应用，其状态大体可以分为 UI State 与 Domain State 两大类：<figure><div class="d-flex justify-content-center"><div class=w-100><img src="https://segmentfault.com/image?src=https://coding.net/u/hoteam/p/Cache/git/raw/master/2016/7/1/1-WGDVzQRyXxoEG5r1PSEiAw.png&objectId=1190000005947593&token=d80182a230a7ab65fbf26c12f49f64dc" alt loading=lazy data-zoomable></div></div></figure></p><p>而当我们考量某个状态管理框架时，我们往往希望其能够提供以下的特征或者接口：</p><ul><li>不同的组件之间能够共享状态。这一点应该算是将组件内状态提取到外部的重要原因之一，早期的 React 中如果你不同组件之间需要共享状态，只能一层一层地 Props 传递或者通过公共父节点来传递。虽然现在 React 引入了 Context，不过笔者认为其还是更适合于用作一些全局配置的传递。</li><li>状态能够在任意地方被访问，这是为了方便我们在纯粹的业务逻辑函数中也能够操作状态。</li><li>组件能够修改状态。</li><li>组件能够修改其他组件的状态。</li></ul><p>Redux 与 MobX 都能满足上述几个需求，能够允许你将状态保存于视图之外，并且允许更改与通知视图重绘，这里我们不纠结于具体的 GUI 应用程序架构模式，有兴趣深入了解的可以参考笔者的<a href=https://segmentfault.com/a/1190000006016817 target=_blank rel=noopener>GUI 应用程序架构的十年变迁:MVC,MVP,MVVM,Unidirectional,Clean</a>。总而言之，当我们的界面希望获取或者更改某个数据状态时，其有明确的接口供其使用。对于理想的状态管理工具，笔者认可其应该具备以下特征:
(1)Predictable View Rendering:可预测的视图渲染，Redux 提出的概念是 Deterministic View Render，即视图状态完全脱离于视图存在，最终呈现的视图永远由输入的状态所决定。笔者是坚定的界面组件化的支持者，我们应该将纯界面展示与数据剥离开来，这样可以保证我们代码的职责分割与可测试性，并且能够在下文所述的项目衍化过程中尽可能保证代码的可用性与复用性。(2)Pure Business Logic:纯函数方式编写的核心业务逻辑，这一点主要是为了保证核心业务逻辑的可测试性与未来的迁移性。</p><h2 id=high-order-component>High Order Component</h2><p>笔者在<a href=https://segmentfault.com/a/1190000006112093 target=_blank rel=noopener>React 设计模式:深入理解 React&Redux 原理套路</a>一文中探讨了我们在 React/Redux 开发中常用的一些模式，而笔者较为推崇的将状态管理工具引入组件中的方式即 HOC 模式。无论 Redux 还是 MobX 都是采用了这种模式，我们所熟知的在 Redux 中的应用方式为:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>connect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;react-redux&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>bindActionCreators</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;redux&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>mapStateToProps</span><span class=p>(</span><span class=nx>state</span><span class=p>,</span> <span class=nx>props</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>id</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>props</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=nx>state</span><span class=p>.</span><span class=nx>users</span><span class=p>[</span><span class=nx>id</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>user</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>mapDispatchToProps</span><span class=p>(</span><span class=nx>dispatch</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>onUpdateUser</span><span class=o>:</span> <span class=nx>bindActionCreators</span><span class=p>(</span><span class=nx>actions</span><span class=p>.</span><span class=nx>updateUser</span><span class=p>,</span> <span class=nx>dispatch</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>UserProfileContainer</span> <span class=o>=</span> <span class=nx>connect</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>mapStateToProps</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>mapDispatchToProps</span>
</span></span><span class=line><span class=cl><span class=p>)(</span><span class=nx>UserProfile</span><span class=p>);</span>
</span></span></code></pre></div><p>而类似的在 MobX 中的应用方式为:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>observer</span><span class=p>,</span> <span class=nx>inject</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;mobx-react&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>UserProfileContainer</span> <span class=o>=</span> <span class=nx>inject</span><span class=p>(</span><span class=s2>&#34;userStore&#34;</span><span class=p>)(</span>
</span></span><span class=line><span class=cl>  <span class=nx>observer</span><span class=p>(({</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>userStore</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>UserProfile</span>
</span></span><span class=line><span class=cl>        <span class=nx>user</span><span class=o>=</span><span class=p>{</span><span class=nx>userStore</span><span class=p>.</span><span class=nx>getUser</span><span class=p>(</span><span class=nx>id</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>        <span class=nx>onUpdateUser</span><span class=o>=</span><span class=p>{</span><span class=nx>userStore</span><span class=p>.</span><span class=nx>updateUser</span><span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></div><h2 id=immutable-state-tree-in-single-store>Immutable State Tree in Single Store</h2><p>Redux 有一个很不错的特性就是 Undo/Redo，这样会帮助我们在调试时重现之前的状态。那么该特性主要是基于 Immutable Data 实现的，我们同样的也可以在 MobX 的 Store 中，通过强行定义所有的数据操作为 Immutable 操作，也能实现类似的功能：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kr>class</span> <span class=nx>SlidesStore</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=err> </span> <span class=c1>// Observable history array
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err> </span> <span class=err>@</span><span class=nx>observable</span> <span class=nx>history</span> <span class=o>=</span> <span class=nx>Immutable</span><span class=p>.</span><span class=nx>from</span><span class=p>([{</span>
</span></span><span class=line><span class=cl><span class=err> </span> <span class=nx>currentSlideIndex</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=err> </span> <span class=nx>slides</span><span class=o>:</span> <span class=p>[{</span>
</span></span><span class=line><span class=cl><span class=err> </span> <span class=c1>// Default first slide
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err> </span> <span class=p>}]</span>
</span></span><span class=line><span class=cl><span class=err> </span> <span class=p>}])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err> </span> <span class=c1>// Start state at the first entry in history
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err> </span> <span class=err>@</span><span class=nx>observable</span> <span class=nx>historyIndex</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>addToHistory</span><span class=p>(</span><span class=nx>snapshot</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=err> </span> <span class=k>this</span><span class=p>.</span><span class=nx>history</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>history</span><span class=p>.</span><span class=nx>concat</span><span class=p>([</span><span class=nx>Immutable</span><span class=p>.</span><span class=nx>from</span><span class=p>(</span><span class=nx>snapshot</span><span class=p>)]);</span>
</span></span><span class=line><span class=cl><span class=err> </span> <span class=k>this</span><span class=p>.</span><span class=nx>historyIndex</span> <span class=o>+=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h1 id=项目增长过程中的状态管理方案衍化>项目增长过程中的状态管理方案衍化</h1><p>王国维先生说过人生有三个境界，我觉得根据项目的需求不同或者，。技术应该是为业务需求所服务，仅仅为了使用新的技术而罔顾实际的业务需求就是耍流氓。笔者在思索自己应该使用的状态管理框架时，有一个重要的考虑点就是项目尽可能地小代价的演进与迭代。譬如在立项之初，需求并不明确，功能逻辑尚不复杂的时候，我们可以直接从 View 层构造，尽可能地先实现 Stateless 与 Fractal 的视图组件。笔者认为是需要有独立的 API/Model 层存在的，其意义在于：(1)可重用的测试代码。(2)多个 Endpoint 的组合。(3)适当的容错与业务处理。</p><h2 id=原型--local-state>原型 | Local State</h2><p>这个阶段我们可能直接将数据获取的函数放置到 componentDidMount 中，并且将 UI State 与 Domain State 都利用<code>setState</code>函数存放在 LocalState 中。这种方式的开发效率最高，毕竟代码量最少，不过其可扩展性略差，并且不利于视图之间共享状态。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// component
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>&lt;</span><span class=nx>button</span> <span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=nx>store</span><span class=p>.</span><span class=nx>users</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>user</span><span class=p>)}</span> <span class=o>/&gt;</span>
</span></span></code></pre></div><p>这里的 store 仅仅指纯粹的数据存储或者模型类。</p><h2 id=项目增长--external-state>项目增长 | External State</h2><p>随着项目逐渐复杂化，我们需要寻找专门的状态管理工具来进行外部状态的管理了:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// component
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>&lt;</span><span class=nx>button</span> <span class=nx>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=nx>store</span><span class=p>.</span><span class=nx>addUser</span><span class=p>(</span><span class=nx>user</span><span class=p>)}</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// store
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>@</span><span class=nx>action</span> <span class=nx>addUser</span> <span class=o>=</span> <span class=p>(</span><span class=nx>user</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>users</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>user</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>这个时候你也可以直接在组件内部修改状态，即还是使用第一个阶段的代码风格，直接操作 store 对象，不过也可以通过引入 Strict 模式来避免这种不良好的实践:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// root file
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>useStrict</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;mobx&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>useStrict</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span></code></pre></div><h2 id=多人协作严格规范复杂交互redux>多人协作/严格规范/复杂交互：Redux</h2><p>随着项目体量进一步的增加与参与者的增加，这时候使用声明式的 Actions 就是最佳实践了，也应该是 Redux 闪亮登场的时候了。这时候 Redux 本来最大的限制，只能通过 Action 而不能直接地改变应用状态也就凸显出了其意义所在(Use Explicit Actions To Change The State)。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// reducer
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>(</span><span class=nx>state</span><span class=p>,</span> <span class=nx>action</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>newState</span><span class=p>;</span>
</span></span></code></pre></div></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>上一页</div><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5/%E5%8D%95%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81/ rel=next>单向数据流</a></div><div class="col-6 post-nav-item"><div class=meta-nav>下一页</div><a href=/books/web-engineering-series/04.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5/%E6%95%B0%E6%8D%AE%E6%B5%81%E9%A9%B1%E5%8A%A8%E7%9A%84%E7%95%8C%E9%9D%A2/ rel=prev>数据流驱动的界面</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>