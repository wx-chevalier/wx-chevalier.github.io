<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="Kafka 架构概念 Kafka 作为一个高度可扩展可容错的消息系统，一个典型的 kafka 集群中包含若干 producer，若干 broker，若干 consumer，以及一个 Zookeeper 集群。Kafka 通过 Zookeeper 管理集群配置，选举 leader，以及"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/messagequeue-notes/03.kafka/%E6%9E%B6%E6%9E%84%E6%A6%82%E5%BF%B5/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.fab3cd1900ae35687457073b2d518207.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/messagequeue-notes/03.kafka/%E6%9E%B6%E6%9E%84%E6%A6%82%E5%BF%B5/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/messagequeue-notes/03.kafka/%E6%9E%B6%E6%9E%84%E6%A6%82%E5%BF%B5/"><meta property="og:title" content="架构概念 | Next-gen Tech Edu"><meta property="og:description" content="Kafka 架构概念 Kafka 作为一个高度可扩展可容错的消息系统，一个典型的 kafka 集群中包含若干 producer，若干 broker，若干 consumer，以及一个 Zookeeper 集群。Kafka 通过 Zookeeper 管理集群配置，选举 leader，以及"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>架构概念 | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=3f24b0bbfda931adc24ceaafe2f3c689><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">03.Kafka</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idb0cea6ecf7755ff85276ca611d5edcac")' href=#idb0cea6ecf7755ff85276ca611d5edcac aria-expanded=false aria-controls=idb0cea6ecf7755ff85276ca611d5edcac aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/>MessageQueue-Notes</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idb0cea6ecf7755ff85276ca611d5edcac aria-expanded=false aria-controls=idb0cea6ecf7755ff85276ca611d5edcac><i class="fa-solid fa-angle-down" id=caret-idb0cea6ecf7755ff85276ca611d5edcac></i></a></div><ul class="nav docs-sidenav collapse show" id=idb0cea6ecf7755ff85276ca611d5edcac><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id344ea7763de98340393b7ea5d50735e5")' href=#id344ea7763de98340393b7ea5d50735e5 aria-expanded=false aria-controls=id344ea7763de98340393b7ea5d50735e5 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/01.%E6%A6%82%E5%BF%B5%E4%B8%8E%E8%AE%BE%E8%AE%A1/>01.概念与设计</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id344ea7763de98340393b7ea5d50735e5 aria-expanded=false aria-controls=id344ea7763de98340393b7ea5d50735e5><i class="fa-solid fa-angle-right" id=caret-id344ea7763de98340393b7ea5d50735e5></i></a></div><ul class="nav docs-sidenav collapse" id=id344ea7763de98340393b7ea5d50735e5><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id8eeb99a1c5e19d09f854b45163712c28")' href=#id8eeb99a1c5e19d09f854b45163712c28 aria-expanded=false aria-controls=id8eeb99a1c5e19d09f854b45163712c28 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/01.%E6%A6%82%E5%BF%B5%E4%B8%8E%E8%AE%BE%E8%AE%A1/1.%E8%83%8C%E6%99%AF%E4%B8%8E%E4%BB%B7%E5%80%BC/>1.背景与价值</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id8eeb99a1c5e19d09f854b45163712c28 aria-expanded=false aria-controls=id8eeb99a1c5e19d09f854b45163712c28><i class="fa-solid fa-angle-right" id=caret-id8eeb99a1c5e19d09f854b45163712c28></i></a></div><ul class="nav docs-sidenav collapse" id=id8eeb99a1c5e19d09f854b45163712c28><li class="child level"><a href=/books/messagequeue-notes/01.%E6%A6%82%E5%BF%B5%E4%B8%8E%E8%AE%BE%E8%AE%A1/1.%E8%83%8C%E6%99%AF%E4%B8%8E%E4%BB%B7%E5%80%BC/%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92%E7%9A%84%E4%B8%8D%E5%90%8C%E6%96%B9%E5%BC%8F/>消息传递的不同方式</a></li><li class="child level"><a href=/books/messagequeue-notes/01.%E6%A6%82%E5%BF%B5%E4%B8%8E%E8%AE%BE%E8%AE%A1/1.%E8%83%8C%E6%99%AF%E4%B8%8E%E4%BB%B7%E5%80%BC/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/>消息队列的应用场景</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id4fcdbd532e441e0ebac4167567f6deff")' href=#id4fcdbd532e441e0ebac4167567f6deff aria-expanded=false aria-controls=id4fcdbd532e441e0ebac4167567f6deff aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/01.%E6%A6%82%E5%BF%B5%E4%B8%8E%E8%AE%BE%E8%AE%A1/2.%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E4%B8%8E%E6%B6%88%E8%B4%B9/>2.消息生产与消费</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id4fcdbd532e441e0ebac4167567f6deff aria-expanded=false aria-controls=id4fcdbd532e441e0ebac4167567f6deff><i class="fa-solid fa-angle-right" id=caret-id4fcdbd532e441e0ebac4167567f6deff></i></a></div><ul class="nav docs-sidenav collapse" id=id4fcdbd532e441e0ebac4167567f6deff><li class="child level"><a href=/books/messagequeue-notes/01.%E6%A6%82%E5%BF%B5%E4%B8%8E%E8%AE%BE%E8%AE%A1/2.%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E4%B8%8E%E6%B6%88%E8%B4%B9/%E9%A1%BA%E5%BA%8F%E6%B6%88%E6%81%AF/>顺序消息</a></li><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id3a8e5f954621e1fd2325c83689724122")' href=#id3a8e5f954621e1fd2325c83689724122 aria-expanded=false aria-controls=id3a8e5f954621e1fd2325c83689724122 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/01.%E6%A6%82%E5%BF%B5%E4%B8%8E%E8%AE%BE%E8%AE%A1/2.%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E4%B8%8E%E6%B6%88%E8%B4%B9/%E6%B6%88%E6%81%AF%E4%BC%A0%E8%BE%93%E6%A8%A1%E5%9E%8B/>消息传输模型</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id3a8e5f954621e1fd2325c83689724122 aria-expanded=false aria-controls=id3a8e5f954621e1fd2325c83689724122><i class="fa-solid fa-angle-right" id=caret-id3a8e5f954621e1fd2325c83689724122></i></a></div><ul class="nav docs-sidenav collapse" id=id3a8e5f954621e1fd2325c83689724122><li class="child level"><a href=/books/messagequeue-notes/01.%E6%A6%82%E5%BF%B5%E4%B8%8E%E8%AE%BE%E8%AE%A1/2.%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E4%B8%8E%E6%B6%88%E8%B4%B9/%E6%B6%88%E6%81%AF%E4%BC%A0%E8%BE%93%E6%A8%A1%E5%9E%8B/%E4%B8%8D%E5%90%8C%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%B6%88%E6%81%AF%E4%BC%A0%E8%BE%93%E6%A8%A1%E5%9E%8B/>不同系统的消息传输模型</a></li><li class="child level"><a href=/books/messagequeue-notes/01.%E6%A6%82%E5%BF%B5%E4%B8%8E%E8%AE%BE%E8%AE%A1/2.%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E4%B8%8E%E6%B6%88%E8%B4%B9/%E6%B6%88%E6%81%AF%E4%BC%A0%E8%BE%93%E6%A8%A1%E5%9E%8B/%E7%82%B9%E5%AF%B9%E7%82%B9%E6%A8%A1%E5%9E%8B%E4%B8%8E%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%9E%8B/>点对点模型与发布订阅模型</a></li><li class="child level"><a href=/books/messagequeue-notes/01.%E6%A6%82%E5%BF%B5%E4%B8%8E%E8%AE%BE%E8%AE%A1/2.%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E4%B8%8E%E6%B6%88%E8%B4%B9/%E6%B6%88%E6%81%AF%E4%BC%A0%E8%BE%93%E6%A8%A1%E5%9E%8B/%E9%98%9F%E5%88%97%E6%A8%A1%E5%9E%8B%E4%B8%8E%E6%B5%81%E5%BC%8F%E6%A8%A1%E5%9E%8B/>队列模型与流式模型</a></li></ul></div><li class="child level"><a href=/books/messagequeue-notes/01.%E6%A6%82%E5%BF%B5%E4%B8%8E%E8%AE%BE%E8%AE%A1/2.%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E4%B8%8E%E6%B6%88%E8%B4%B9/%E6%B6%88%E6%81%AF%E9%98%B2%E4%B8%A2%E5%A4%B1/>消息防丢失</a></li><li class="child level"><a href=/books/messagequeue-notes/01.%E6%A6%82%E5%BF%B5%E4%B8%8E%E8%AE%BE%E8%AE%A1/2.%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E4%B8%8E%E6%B6%88%E8%B4%B9/%E6%B6%88%E6%81%AF%E7%A7%AF%E5%8E%8B%E5%A4%84%E7%90%86/>消息积压处理</a></li><li class="child level"><a href=/books/messagequeue-notes/01.%E6%A6%82%E5%BF%B5%E4%B8%8E%E8%AE%BE%E8%AE%A1/2.%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E4%B8%8E%E6%B6%88%E8%B4%B9/%E9%87%8D%E5%A4%8D%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86/>重复消息处理</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idfb9beccb68fda55de876afdba92fb9ad")' href=#idfb9beccb68fda55de876afdba92fb9ad aria-expanded=false aria-controls=idfb9beccb68fda55de876afdba92fb9ad aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/01.%E6%A6%82%E5%BF%B5%E4%B8%8E%E8%AE%BE%E8%AE%A1/3.%E6%B6%88%E6%81%AF%E5%AD%98%E5%82%A8/>3.消息存储</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idfb9beccb68fda55de876afdba92fb9ad aria-expanded=false aria-controls=idfb9beccb68fda55de876afdba92fb9ad><i class="fa-solid fa-angle-right" id=caret-idfb9beccb68fda55de876afdba92fb9ad></i></a></div><ul class="nav docs-sidenav collapse" id=idfb9beccb68fda55de876afdba92fb9ad><li class="child level"><a href=/books/messagequeue-notes/01.%E6%A6%82%E5%BF%B5%E4%B8%8E%E8%AE%BE%E8%AE%A1/3.%E6%B6%88%E6%81%AF%E5%AD%98%E5%82%A8/%E5%88%86%E5%8C%BA%E6%97%A5%E5%BF%97/>分区日志</a></li><li class="child level"><a href=/books/messagequeue-notes/01.%E6%A6%82%E5%BF%B5%E4%B8%8E%E8%AE%BE%E8%AE%A1/3.%E6%B6%88%E6%81%AF%E5%AD%98%E5%82%A8/%E6%B6%88%E6%81%AF%E5%AD%98%E5%82%A8/>消息存储</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idfa033efc147ef3f7c6846cfa712cbb51")' href=#idfa033efc147ef3f7c6846cfa712cbb51 aria-expanded=false aria-controls=idfa033efc147ef3f7c6846cfa712cbb51 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/01.%E6%A6%82%E5%BF%B5%E4%B8%8E%E8%AE%BE%E8%AE%A1/4.%E5%BC%80%E6%BA%90%E7%B3%BB%E7%BB%9F%E5%AF%B9%E6%AF%94/>4.开源系统对比</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idfa033efc147ef3f7c6846cfa712cbb51 aria-expanded=false aria-controls=idfa033efc147ef3f7c6846cfa712cbb51><i class="fa-solid fa-angle-right" id=caret-idfa033efc147ef3f7c6846cfa712cbb51></i></a></div><ul class="nav docs-sidenav collapse" id=idfa033efc147ef3f7c6846cfa712cbb51><li class="child level"><a href=/books/messagequeue-notes/01.%E6%A6%82%E5%BF%B5%E4%B8%8E%E8%AE%BE%E8%AE%A1/4.%E5%BC%80%E6%BA%90%E7%B3%BB%E7%BB%9F%E5%AF%B9%E6%AF%94/%E5%8A%9F%E8%83%BD%E5%AF%B9%E6%AF%94/>功能对比</a></li><li class="child level"><a href=/books/messagequeue-notes/01.%E6%A6%82%E5%BF%B5%E4%B8%8E%E8%AE%BE%E8%AE%A1/4.%E5%BC%80%E6%BA%90%E7%B3%BB%E7%BB%9F%E5%AF%B9%E6%AF%94/%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94/>性能对比</a></li></ul></div></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idddd74217093c1d2b0691a9554d933324")' href=#idddd74217093c1d2b0691a9554d933324 aria-expanded=false aria-controls=idddd74217093c1d2b0691a9554d933324 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/02.rabbitmq/>02.RabbitMQ</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idddd74217093c1d2b0691a9554d933324 aria-expanded=false aria-controls=idddd74217093c1d2b0691a9554d933324><i class="fa-solid fa-angle-right" id=caret-idddd74217093c1d2b0691a9554d933324></i></a></div><ul class="nav docs-sidenav collapse" id=idddd74217093c1d2b0691a9554d933324><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id4cca95b8295c8b3a75ed8f7452e842fc")' href=#id4cca95b8295c8b3a75ed8f7452e842fc aria-expanded=false aria-controls=id4cca95b8295c8b3a75ed8f7452e842fc aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/02.rabbitmq/%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/>集群部署</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id4cca95b8295c8b3a75ed8f7452e842fc aria-expanded=false aria-controls=id4cca95b8295c8b3a75ed8f7452e842fc><i class="fa-solid fa-angle-right" id=caret-id4cca95b8295c8b3a75ed8f7452e842fc></i></a></div><ul class="nav docs-sidenav collapse" id=id4cca95b8295c8b3a75ed8f7452e842fc><li class="child level"><a href=/books/messagequeue-notes/02.rabbitmq/%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/%E9%83%A8%E7%BD%B2%E9%85%8D%E7%BD%AE/>部署配置</a></li><li class="child level"><a href=/books/messagequeue-notes/02.rabbitmq/%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/%E9%9B%86%E7%BE%A4%E4%B8%8E%E9%AB%98%E5%8F%AF%E7%94%A8/>集群与高可用</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idbdfbc4f7ab6572733ed98f25101251ef")' href=#idbdfbc4f7ab6572733ed98f25101251ef aria-expanded=false aria-controls=idbdfbc4f7ab6572733ed98f25101251ef aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/02.rabbitmq/%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%9E%8B/>架构模型</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idbdfbc4f7ab6572733ed98f25101251ef aria-expanded=false aria-controls=idbdfbc4f7ab6572733ed98f25101251ef><i class="fa-solid fa-angle-right" id=caret-idbdfbc4f7ab6572733ed98f25101251ef></i></a></div><ul class="nav docs-sidenav collapse" id=idbdfbc4f7ab6572733ed98f25101251ef><li class="child level"><a href=/books/messagequeue-notes/02.rabbitmq/%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%9E%8B/%E6%B6%88%E6%81%AF%E5%AD%98%E5%82%A8/>消息存储</a></li><li class="child level"><a href=/books/messagequeue-notes/02.rabbitmq/%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%9E%8B/%E6%B6%88%E6%81%AF%E7%B1%BB%E5%9E%8B/>消息类型</a></li><li class="child level"><a href=/books/messagequeue-notes/02.rabbitmq/%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%9E%8B/%E6%B6%88%E6%81%AF%E6%B6%88%E8%B4%B9/>消息消费</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id787b97941b066f83061d985cb940d1d4")' href=#id787b97941b066f83061d985cb940d1d4 aria-expanded=false aria-controls=id787b97941b066f83061d985cb940d1d4 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/02.rabbitmq/%E6%8E%A5%E5%8F%A3%E4%BD%BF%E7%94%A8/>接口使用</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id787b97941b066f83061d985cb940d1d4 aria-expanded=false aria-controls=id787b97941b066f83061d985cb940d1d4><i class="fa-solid fa-angle-right" id=caret-id787b97941b066f83061d985cb940d1d4></i></a></div><ul class="nav docs-sidenav collapse" id=id787b97941b066f83061d985cb940d1d4><li class="child level"><a href=/books/messagequeue-notes/02.rabbitmq/%E6%8E%A5%E5%8F%A3%E4%BD%BF%E7%94%A8/java/>Java</a></li><li class="child level"><a href=/books/messagequeue-notes/02.rabbitmq/%E6%8E%A5%E5%8F%A3%E4%BD%BF%E7%94%A8/python/>Python</a></li></ul></div></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id81fa2f21924b3a8300784e88e0ca509c")' href=#id81fa2f21924b3a8300784e88e0ca509c aria-expanded=false aria-controls=id81fa2f21924b3a8300784e88e0ca509c aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/03.kafka/>03.Kafka</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id81fa2f21924b3a8300784e88e0ca509c aria-expanded=false aria-controls=id81fa2f21924b3a8300784e88e0ca509c><i class="fa-solid fa-angle-down" id=caret-id81fa2f21924b3a8300784e88e0ca509c></i></a></div><ul class="nav docs-sidenav collapse show" id=id81fa2f21924b3a8300784e88e0ca509c><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id964a7f422656e7478cb0ed5b3af358c7")' href=#id964a7f422656e7478cb0ed5b3af358c7 aria-expanded=false aria-controls=id964a7f422656e7478cb0ed5b3af358c7 aria-hidden=false data-toggle=collapse></div></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idb623e227f0ff16cee93630160bbbb905")' href=#idb623e227f0ff16cee93630160bbbb905 aria-expanded=false aria-controls=idb623e227f0ff16cee93630160bbbb905 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/03.kafka/%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/>集群部署</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idb623e227f0ff16cee93630160bbbb905 aria-expanded=false aria-controls=idb623e227f0ff16cee93630160bbbb905><i class="fa-solid fa-angle-right" id=caret-idb623e227f0ff16cee93630160bbbb905></i></a></div><ul class="nav docs-sidenav collapse" id=idb623e227f0ff16cee93630160bbbb905><li class="child level"><a href=/books/messagequeue-notes/03.kafka/%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/%E9%83%A8%E7%BD%B2%E9%85%8D%E7%BD%AE/>部署配置</a></li><li class="child level"><a href=/books/messagequeue-notes/03.kafka/%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE/>参数配置</a></li><li class="child level"><a href=/books/messagequeue-notes/03.kafka/%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/%E9%9B%86%E7%BE%A4%E4%B8%8E%E9%AB%98%E5%8F%AF%E7%94%A8/>集群与高可用</a></li></ul></div><li class="child level active"><a href=/books/messagequeue-notes/03.kafka/%E6%9E%B6%E6%9E%84%E6%A6%82%E5%BF%B5/>架构概念</a></li><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idc097d8f0766c4dfe05df459a57a9d18c")' href=#idc097d8f0766c4dfe05df459a57a9d18c aria-expanded=false aria-controls=idc097d8f0766c4dfe05df459a57a9d18c aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/03.kafka/%E6%B6%88%E6%81%AF%E4%BB%A3%E7%90%86/>消息代理</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idc097d8f0766c4dfe05df459a57a9d18c aria-expanded=false aria-controls=idc097d8f0766c4dfe05df459a57a9d18c><i class="fa-solid fa-angle-right" id=caret-idc097d8f0766c4dfe05df459a57a9d18c></i></a></div><ul class="nav docs-sidenav collapse" id=idc097d8f0766c4dfe05df459a57a9d18c><li class="child level"><a href=/books/messagequeue-notes/03.kafka/%E6%B6%88%E6%81%AF%E4%BB%A3%E7%90%86/zookeeper/>ZooKeeper</a></li><li class="child level"><a href=/books/messagequeue-notes/03.kafka/%E6%B6%88%E6%81%AF%E4%BB%A3%E7%90%86/%E7%A3%81%E7%9B%98%E8%AF%BB%E5%86%99%E4%BC%98%E5%8C%96/>磁盘读写优化</a></li><li class="child level"><a href=/books/messagequeue-notes/03.kafka/%E6%B6%88%E6%81%AF%E4%BB%A3%E7%90%86/%E5%89%AF%E6%9C%AC/>副本</a></li><li class="child level"><a href=/books/messagequeue-notes/03.kafka/%E6%B6%88%E6%81%AF%E4%BB%A3%E7%90%86/%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6/>日志文件</a></li><li class="child level"><a href=/books/messagequeue-notes/03.kafka/%E6%B6%88%E6%81%AF%E4%BB%A3%E7%90%86/%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B/>网络模型</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id0ff6122dc62a60a9c0202d833cbf4faf")' href=#id0ff6122dc62a60a9c0202d833cbf4faf aria-expanded=false aria-controls=id0ff6122dc62a60a9c0202d833cbf4faf aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/03.kafka/%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E4%B8%8E%E6%B6%88%E8%B4%B9/>消息生产与消费</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id0ff6122dc62a60a9c0202d833cbf4faf aria-expanded=false aria-controls=id0ff6122dc62a60a9c0202d833cbf4faf><i class="fa-solid fa-angle-right" id=caret-id0ff6122dc62a60a9c0202d833cbf4faf></i></a></div><ul class="nav docs-sidenav collapse" id=id0ff6122dc62a60a9c0202d833cbf4faf><li class="child level"><a href=/books/messagequeue-notes/03.kafka/%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E4%B8%8E%E6%B6%88%E8%B4%B9/%E7%94%9F%E4%BA%A7%E8%80%85/>生产者</a></li><li class="child level"><a href=/books/messagequeue-notes/03.kafka/%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E4%B8%8E%E6%B6%88%E8%B4%B9/%E4%BA%8B%E5%8A%A1%E6%B6%88%E6%81%AF/>事务消息</a></li><li class="child level"><a href=/books/messagequeue-notes/03.kafka/%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E4%B8%8E%E6%B6%88%E8%B4%B9/%E6%B6%88%E8%B4%B9%E8%80%85/>消费者</a></li></ul></div></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idfd53c0fe0dbed02a5e4ca776d831280f")' href=#idfd53c0fe0dbed02a5e4ca776d831280f aria-expanded=false aria-controls=idfd53c0fe0dbed02a5e4ca776d831280f aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/04.rocketmq/>04.RocketMQ</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idfd53c0fe0dbed02a5e4ca776d831280f aria-expanded=false aria-controls=idfd53c0fe0dbed02a5e4ca776d831280f><i class="fa-solid fa-angle-right" id=caret-idfd53c0fe0dbed02a5e4ca776d831280f></i></a></div><ul class="nav docs-sidenav collapse" id=idfd53c0fe0dbed02a5e4ca776d831280f><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id083d746b621ee52ba6d9e2612c28cb5d")' href=#id083d746b621ee52ba6d9e2612c28cb5d aria-expanded=false aria-controls=id083d746b621ee52ba6d9e2612c28cb5d aria-hidden=false data-toggle=collapse></div></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idfcbdcdcc73bdded5610721872b339975")' href=#idfcbdcdcc73bdded5610721872b339975 aria-expanded=false aria-controls=idfcbdcdcc73bdded5610721872b339975 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/04.rocketmq/02.%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E4%B8%8E%E6%B6%88%E8%B4%B9/>02.消息发送与消费</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idfcbdcdcc73bdded5610721872b339975 aria-expanded=false aria-controls=idfcbdcdcc73bdded5610721872b339975><i class="fa-solid fa-angle-right" id=caret-idfcbdcdcc73bdded5610721872b339975></i></a></div><ul class="nav docs-sidenav collapse" id=idfcbdcdcc73bdded5610721872b339975><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idd9a2f703e5a39c7c2df471fbdf497770")' href=#idd9a2f703e5a39c7c2df471fbdf497770 aria-expanded=false aria-controls=idd9a2f703e5a39c7c2df471fbdf497770 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/04.rocketmq/02.%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E4%B8%8E%E6%B6%88%E8%B4%B9/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/>99.参考资料</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idd9a2f703e5a39c7c2df471fbdf497770 aria-expanded=false aria-controls=idd9a2f703e5a39c7c2df471fbdf497770><i class="fa-solid fa-angle-right" id=caret-idd9a2f703e5a39c7c2df471fbdf497770></i></a></div><ul class="nav docs-sidenav collapse" id=idd9a2f703e5a39c7c2df471fbdf497770><li class="child level"><a href=/books/messagequeue-notes/04.rocketmq/02.%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E4%B8%8E%E6%B6%88%E8%B4%B9/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2021-rocketmq-5.0-pop-%E6%B6%88%E8%B4%B9%E6%A8%A1%E5%BC%8F%E6%8E%A2%E7%A7%98/>2021-RocketMQ 5.0 POP 消费模式探秘</a></li><li class="child level"><a href=/books/messagequeue-notes/04.rocketmq/02.%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E4%B8%8E%E6%B6%88%E8%B4%B9/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2023-rocketmq-%E6%B6%88%E6%81%AF%E7%9F%AD%E6%9A%82%E8%80%8C%E5%8F%88%E7%B2%BE%E5%BD%A9%E7%9A%84%E4%B8%80%E7%94%9F/>2023-RocketMQ 消息短暂而又精彩的一生</a></li></ul></div><li class="child level"><a href=/books/messagequeue-notes/04.rocketmq/02.%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E4%B8%8E%E6%B6%88%E8%B4%B9/%E6%B6%88%E6%81%AF%E6%B6%88%E8%B4%B9/>消息消费</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idbf9d05495b67d27f6e8af0031d091e13")' href=#idbf9d05495b67d27f6e8af0031d091e13 aria-expanded=false aria-controls=idbf9d05495b67d27f6e8af0031d091e13 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/04.rocketmq/03.%E9%9B%86%E7%BE%A4%E4%B8%8E%E9%AB%98%E5%8F%AF%E7%94%A8/>03.集群与高可用</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idbf9d05495b67d27f6e8af0031d091e13 aria-expanded=false aria-controls=idbf9d05495b67d27f6e8af0031d091e13><i class="fa-solid fa-angle-right" id=caret-idbf9d05495b67d27f6e8af0031d091e13></i></a></div><ul class="nav docs-sidenav collapse" id=idbf9d05495b67d27f6e8af0031d091e13><li class="child level"><a href=/books/messagequeue-notes/04.rocketmq/03.%E9%9B%86%E7%BE%A4%E4%B8%8E%E9%AB%98%E5%8F%AF%E7%94%A8/%E9%9B%86%E7%BE%A4%E4%B8%8E%E9%AB%98%E5%8F%AF%E7%94%A8/>集群与高可用</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idcdc1313d7e287f78fbe206a510a9178c")' href=#idcdc1313d7e287f78fbe206a510a9178c aria-expanded=false aria-controls=idcdc1313d7e287f78fbe206a510a9178c aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/04.rocketmq/04.%E5%86%85%E9%83%A8%E6%9C%BA%E5%88%B6/>04.内部机制</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idcdc1313d7e287f78fbe206a510a9178c aria-expanded=false aria-controls=idcdc1313d7e287f78fbe206a510a9178c><i class="fa-solid fa-angle-right" id=caret-idcdc1313d7e287f78fbe206a510a9178c></i></a></div><ul class="nav docs-sidenav collapse" id=idcdc1313d7e287f78fbe206a510a9178c><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id0c4f9eb420ca6565d70d2a8dbc3dec7c")' href=#id0c4f9eb420ca6565d70d2a8dbc3dec7c aria-expanded=false aria-controls=id0c4f9eb420ca6565d70d2a8dbc3dec7c aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/04.rocketmq/04.%E5%86%85%E9%83%A8%E6%9C%BA%E5%88%B6/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/>99.参考资料</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id0c4f9eb420ca6565d70d2a8dbc3dec7c aria-expanded=false aria-controls=id0c4f9eb420ca6565d70d2a8dbc3dec7c><i class="fa-solid fa-angle-right" id=caret-id0c4f9eb420ca6565d70d2a8dbc3dec7c></i></a></div><ul class="nav docs-sidenav collapse" id=id0c4f9eb420ca6565d70d2a8dbc3dec7c><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id91a14568a9093a4d3690bc4e89e5570d")' href=#id91a14568a9093a4d3690bc4e89e5570d aria-expanded=false aria-controls=id91a14568a9093a4d3690bc4e89e5570d aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/04.rocketmq/04.%E5%86%85%E9%83%A8%E6%9C%BA%E5%88%B6/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2021-vivo-%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90-rocketmq-%E6%BA%90%E7%A0%81/>2021-Vivo-深入剖析 RocketMQ 源码</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id91a14568a9093a4d3690bc4e89e5570d aria-expanded=false aria-controls=id91a14568a9093a4d3690bc4e89e5570d><i class="fa-solid fa-angle-right" id=caret-id91a14568a9093a4d3690bc4e89e5570d></i></a></div><ul class="nav docs-sidenav collapse" id=id91a14568a9093a4d3690bc4e89e5570d><li class="child level"><a href=/books/messagequeue-notes/04.rocketmq/04.%E5%86%85%E9%83%A8%E6%9C%BA%E5%88%B6/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2021-vivo-%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90-rocketmq-%E6%BA%90%E7%A0%81/%E5%AD%98%E5%82%A8%E6%A8%A1%E5%9D%97/>存储模块</a></li></ul></div><li class="child level"><a href=/books/messagequeue-notes/04.rocketmq/04.%E5%86%85%E9%83%A8%E6%9C%BA%E5%88%B6/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2022-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E8%AF%BB-rocketmq-%E5%AD%98%E5%82%A8%E6%9C%BA%E5%88%B6/>2022-深度解读 RocketMQ 存储机制</a></li></ul></div></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id6309afad29f69c4040ce4069b19a3c45")' href=#id6309afad29f69c4040ce4069b19a3c45 aria-expanded=false aria-controls=id6309afad29f69c4040ce4069b19a3c45 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/04.rocketmq/10.%E7%89%88%E6%9C%AC%E5%8F%98%E8%BF%81/>10.版本变迁</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id6309afad29f69c4040ce4069b19a3c45 aria-expanded=false aria-controls=id6309afad29f69c4040ce4069b19a3c45><i class="fa-solid fa-angle-right" id=caret-id6309afad29f69c4040ce4069b19a3c45></i></a></div><ul class="nav docs-sidenav collapse" id=id6309afad29f69c4040ce4069b19a3c45><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id968052919a413e106a7a5d548a7bf2de")' href=#id968052919a413e106a7a5d548a7bf2de aria-expanded=false aria-controls=id968052919a413e106a7a5d548a7bf2de aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/04.rocketmq/10.%E7%89%88%E6%9C%AC%E5%8F%98%E8%BF%81/rocketmq-5.0/>RocketMQ 5.0</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id968052919a413e106a7a5d548a7bf2de aria-expanded=false aria-controls=id968052919a413e106a7a5d548a7bf2de><i class="fa-solid fa-angle-right" id=caret-id968052919a413e106a7a5d548a7bf2de></i></a></div><ul class="nav docs-sidenav collapse" id=id968052919a413e106a7a5d548a7bf2de><li class="child level"><a href=/books/messagequeue-notes/04.rocketmq/10.%E7%89%88%E6%9C%AC%E5%8F%98%E8%BF%81/rocketmq-5.0/2022-rocketmq-5.0-%E5%AD%98%E5%82%A8%E8%AE%A1%E7%AE%97%E5%88%86%E7%A6%BB%E6%96%B0%E6%80%9D%E8%B7%AF/>2022-RocketMQ 5.0： 存储计算分离新思路</a></li></ul></div></ul></div></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id3252ce38ce5d22439bbe461646d72183")' href=#id3252ce38ce5d22439bbe461646d72183 aria-expanded=false aria-controls=id3252ce38ce5d22439bbe461646d72183 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/05.pulsar/>05.Pulsar</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id3252ce38ce5d22439bbe461646d72183 aria-expanded=false aria-controls=id3252ce38ce5d22439bbe461646d72183><i class="fa-solid fa-angle-right" id=caret-id3252ce38ce5d22439bbe461646d72183></i></a></div><ul class="nav docs-sidenav collapse" id=id3252ce38ce5d22439bbe461646d72183><li class="child level"><a href=/books/messagequeue-notes/05.pulsar/pulsar-%E8%AE%BE%E8%AE%A1%E6%A6%82%E8%A7%88/>Pulsar 设计概览</a></li><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ide473ed014d085e23be59eede662e1015")' href=#ide473ed014d085e23be59eede662e1015 aria-expanded=false aria-controls=ide473ed014d085e23be59eede662e1015 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/05.pulsar/%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/>集群部署</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ide473ed014d085e23be59eede662e1015 aria-expanded=false aria-controls=ide473ed014d085e23be59eede662e1015><i class="fa-solid fa-angle-right" id=caret-ide473ed014d085e23be59eede662e1015></i></a></div><ul class="nav docs-sidenav collapse" id=ide473ed014d085e23be59eede662e1015><li class="child level"><a href=/books/messagequeue-notes/05.pulsar/%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/%E9%83%A8%E7%BD%B2%E9%85%8D%E7%BD%AE/>部署配置</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idde6a0092f856adbf8bebd3c15a4b9e2a")' href=#idde6a0092f856adbf8bebd3c15a4b9e2a aria-expanded=false aria-controls=idde6a0092f856adbf8bebd3c15a4b9e2a aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/05.pulsar/%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E4%B8%8E%E6%B6%88%E8%B4%B9/>消息生产与消费</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idde6a0092f856adbf8bebd3c15a4b9e2a aria-expanded=false aria-controls=idde6a0092f856adbf8bebd3c15a4b9e2a><i class="fa-solid fa-angle-right" id=caret-idde6a0092f856adbf8bebd3c15a4b9e2a></i></a></div><ul class="nav docs-sidenav collapse" id=idde6a0092f856adbf8bebd3c15a4b9e2a><li class="child level"><a href=/books/messagequeue-notes/05.pulsar/%E6%B6%88%E6%81%AF%E7%94%9F%E4%BA%A7%E4%B8%8E%E6%B6%88%E8%B4%B9/%E6%B6%88%E6%81%AF%E6%B6%88%E8%B4%B9%E6%A8%A1%E5%9E%8B/>消息消费模型</a></li></ul></div></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id68997ea7f0b3604fb0e05ee23e2d6841")' href=#id68997ea7f0b3604fb0e05ee23e2d6841 aria-expanded=false aria-controls=id68997ea7f0b3604fb0e05ee23e2d6841 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/06.activemq/>06.ActiveMQ</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id68997ea7f0b3604fb0e05ee23e2d6841 aria-expanded=false aria-controls=id68997ea7f0b3604fb0e05ee23e2d6841><i class="fa-solid fa-angle-right" id=caret-id68997ea7f0b3604fb0e05ee23e2d6841></i></a></div><ul class="nav docs-sidenav collapse" id=id68997ea7f0b3604fb0e05ee23e2d6841><li class="child level"><a href=/books/messagequeue-notes/06.activemq/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/>架构设计</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id4b9eaa4a6402d6aa84ac540f87bf7f73")' href=#id4b9eaa4a6402d6aa84ac540f87bf7f73 aria-expanded=false aria-controls=id4b9eaa4a6402d6aa84ac540f87bf7f73 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/10.%E5%AE%9E%E8%B7%B5%E6%A1%88%E4%BE%8B/>10.实践案例</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id4b9eaa4a6402d6aa84ac540f87bf7f73 aria-expanded=false aria-controls=id4b9eaa4a6402d6aa84ac540f87bf7f73><i class="fa-solid fa-angle-right" id=caret-id4b9eaa4a6402d6aa84ac540f87bf7f73></i></a></div><ul class="nav docs-sidenav collapse" id=id4b9eaa4a6402d6aa84ac540f87bf7f73><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-iddb9f8dfe7fe1bcac4e965b855762e0fe")' href=#iddb9f8dfe7fe1bcac4e965b855762e0fe aria-expanded=false aria-controls=iddb9f8dfe7fe1bcac4e965b855762e0fe aria-hidden=false data-toggle=collapse></div></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id7f1b4ece2101e4e013129eb5880e5cb3")' href=#id7f1b4ece2101e4e013129eb5880e5cb3 aria-expanded=false aria-controls=id7f1b4ece2101e4e013129eb5880e5cb3 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/messagequeue-notes/10.%E5%AE%9E%E8%B7%B5%E6%A1%88%E4%BE%8B/%E5%93%88%E5%95%B0%E5%8D%95%E8%BD%A6/>哈啰单车</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id7f1b4ece2101e4e013129eb5880e5cb3 aria-expanded=false aria-controls=id7f1b4ece2101e4e013129eb5880e5cb3><i class="fa-solid fa-angle-right" id=caret-id7f1b4ece2101e4e013129eb5880e5cb3></i></a></div><ul class="nav docs-sidenav collapse" id=id7f1b4ece2101e4e013129eb5880e5cb3><li class="child level"><a href=/books/messagequeue-notes/10.%E5%AE%9E%E8%B7%B5%E6%A1%88%E4%BE%8B/%E5%93%88%E5%95%B0%E5%8D%95%E8%BD%A6/2021-%E5%93%88%E5%95%B0%E5%9C%A8%E5%88%86%E5%B8%83%E5%BC%8F%E6%B6%88%E6%81%AF%E6%B2%BB%E7%90%86%E5%92%8C%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E4%B8%AD%E7%9A%84%E5%AE%9E%E8%B7%B5/>2021-哈啰在分布式消息治理和微服务治理中的实践</a></li></ul></div></ul></div><li class="child level"><a href=/books/messagequeue-notes/introduction/>INTRODUCTION</a></li></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>架构概念</h1><div class=article-style><h1 id=kafka-架构概念>Kafka 架构概念</h1><p>Kafka 作为一个高度可扩展可容错的消息系统，一个典型的 kafka 集群中包含若干 producer，若干 broker，若干 consumer，以及一个 Zookeeper 集群。Kafka 通过 Zookeeper 管理集群配置，选举 leader，以及在 consumer group 发生变化时进行 rebalance。producer 使用 push 模式将消息发布到 broker，consumer 使用 pull 模式从 broker 订阅并消费消息：</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://pic.imgdb.cn/item/6076bc658322e6675c8d0ed0.png alt="Kafka 架构概览图" loading=lazy data-zoomable></div></div></figure></p><p>Kafka 专用术语：</p><ul><li>Broker：消息中间件处理结点，一个 Kafka 节点就是一个 broker，多个 broker 可以组成一个 Kafka 集群。</li><li>Topic：一类消息，Kafka 集群能够同时负责多个 topic 的分发。</li><li>Partition：topic 物理上的分组，一个 topic 可以分为多个 partition，每个 partition 是一个有序的队列。</li><li>Segment：partition 物理上由多个 segment 组成。</li><li>offset：每个 partition 都由一系列有序的、不可变的消息组成，这些消息被连续的追加到 partition 中。partition 中的每个消息都有一个连续的序列号叫做 offset，用于 partition 唯一标识一条消息。</li><li>Producer：负责发布消息到 Kafka broker。</li><li>Consumer：消息消费者，向 Kafka broker 读取消息的客户端。</li><li>Consumer Group：每个 Consumer 属于一个特定的 Consumer Group。</li></ul><p>Kafka 实现了零拷贝原理来快速移动数据，避免了内核之间的切换。Kafka 可以将数据记录分批发送，从生产者到文件系统（Kafka 主题日志）到消费者，可以端到端的查看这些批次的数据。批处理能够进行更有效的数据压缩并减少 I/O 延迟，Kafka 采取顺序写入磁盘的方式，避免了随机磁盘寻址的浪费，总结一下其实就是四个要点：</p><ul><li>顺序读写：因为硬盘是机械结构，每次读写都会寻址，写入，其中寻址是一个“机械动作”，它是最耗时的。所以硬盘最“讨厌”随机 I/O，最喜欢顺序 I/O。为了提高读写硬盘的速度，Kafka 就是使用顺序 I/O。</li><li>零拷贝：在 Linux Kernal 2.2 之后出现了一种叫做“零拷贝(zero-copy)”系统调用机制，就是跳过“用户缓冲区”的拷贝，建立一个磁盘空间和内存空间的直接映射，数据不再复制到“用户态缓冲区”系统上下文切换减少 2 次，可以提升一倍性能。</li><li>消息压缩：消息都是经过压缩传递、存储的，降低网络与磁盘的负担。</li><li>分批发送：批量处理是一种非常有效的提升系统吞吐量的方法，在 Kafka 内部，消息都是以“批”为单位处理的。</li></ul><h1 id=消息与主题>消息与主题</h1><p>消息是 Kafka 通信的基本单位，由一个固定长度的消息头和一个可变长度的消息体构成。在老版本中，每一条消息称为 Message；在由 Java 重新实现的客户端中，每一条消息称为 Record。为了提高效率，消息会分批次写入 Kafka，批次就代指的是一组消息。Kafka 将一组消息抽象归纳为一个主题(Topic)，也就是说，一个主题就是对消息的一个分类。生产者将消息发送到特定主题，消费者订阅主题或主题的某些分区进行消费。</p><p>Kafka 消息传递的事务特点如下：</p><ul><li>at most once：最多一次，这个和 JMS 中"非持久化"消息类似，发送一次，无论成败，将不会重发。消费者 fetch 消息，然后保存 offset，然后处理消息；当 client 保存 offset 之后，但是在消息处理过程中出现了异常，导致部分消息未能继续处理。那么此后"未处理"的消息将不能被 fetch 到，这就是"at most once"。</li><li>at least once：消息至少发送一次，如果消息未能接受成功，可能会重发，直到接收成功。消费者 fetch 消息，然后处理消息，然后保存 offset。如果消息处理成功之后，但是在保存 offset 阶段 zookeeper 异常导致保存操作未能执行成功，这就导致接下来再次 fetch 时可能获得上次已经处理过的消息，这就是"at least once"，原因 offset 没有及时的提交给 zookeeper，zookeeper 恢复正常还是之前 offset 状态。</li><li>exactly once：消息只会发送一次。kafka 中并没有严格的去实现（基于 2 阶段提交），我们认为这种策略在 kafka 中是没有必要的。</li></ul><h1 id=生产者producer>生产者（Producer）</h1><p>生产者(Producer)负责将消息发送给代理，也就是向 Kafka 代理发送消息的客户端。生产者会将某 topic 的消息发布到相应的 partition 中。生产者在默认情况下把消息均衡地分布到主题的所有分区上，而并不关心特定消息会被写到哪个分区。不过，在某些情况下，生产者会把消息直接写到指定的分区。</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://pic.imgdb.cn/item/6077eb408322e6675c92ad73.jpg alt=生产者设计 loading=lazy data-zoomable></div></div></figure></p><p>Kafka 中的生产者设计主要考虑了以下方面：</p><ul><li>负载均衡：由于消息 topic 由多个 partition 组成，且 partition 会均衡分布到不同 broker 上，因此，为了有效利用 broker 集群的性能，提高消息的吞吐量，producer 可以通过随机或者 hash 等方式，将消息平均发送到多个 partition 上，以实现负载均衡。</li><li>批量发送：是提高消息吞吐量重要的方式，Producer 端可以在内存中合并多条消息后，以一次请求的方式发送了批量的消息给 broker，从而大大减少 broker 存储消息的 IO 操作次数。但也一定程度上影响了消息的实时性，相当于以时延代价，换取更好的吞吐量。</li></ul><h1 id=消费者和消费组>消费者和消费组</h1><p>consumer 是 kafka 当中的消费者，主要用于消费 kafka 当中的数据；在 Kafka 中每一个消费者都属于一个特定消费组(ConsumerGroup)，我们可以为每个消费者指定一个消费组，以 groupId 代表消费组名称，通过 group.id 配置设置。如果不指定消费组，则该消费者属于默认消费组 test-consumer-group。</p><p>同时，每个消费者也有一个全局唯一的 id，通过配置项 client.id 指定，如果客户端没有指定消费者的 id，Kafka 会自动为该消费者生成一个全局唯一的 id，格式为 <code>${groupId}-${hostName}-${timestamp}-${UUID 前 8 位字符}</code>。同一个主题的一条消息只能被同一个消费组下某一个消费者消费，但不同消费组的消费者可同时消费该消息。消费组是 Kafka 用来实现对一个主题消息进行广播和单播的手段，实现消息广播只需指定各消费者均属于不同的消费组，消息单播则只需让各消费者属于同一个消费组。</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://pic.imgdb.cn/item/6077f4ba8322e6675cac97ae.png alt="Consumer Group读取消息" loading=lazy data-zoomable></div></div></figure></p><p>总结而言，Kafka 中的消费者与消费组具备以下属性：</p><ul><li>任何 Consumer 必须属于一个 Consumer Group</li><li>同一 Consumer Group 中的多个 Consumer 实例，不同时消费同一个 partition，等效于队列模式。如图，Consumer Group 1 的三个 Consumer 实例分别消费不同的 partition 的消息，即，TopicA-part0、TopicA-part1、TopicA-part2。</li><li>不同 Consumer Group 的 Consumer 实例可以同时消费同一个 partition，等效于发布订阅模式。如图，Consumer Group 1 的 Consumer1 和 Consumer Group 2 的 Consumer4，同时消费 TopicA-part0 的消息。</li><li>Partition 内消息是有序的，Consumer 通过 pull 方式消费消息。</li><li>Kafka 不删除已消费的消息</li></ul><h1 id=分区>分区</h1><p>Kafka 将一组消息归纳为一个主题，而每个主题又被分成一个或多个分区(Partition)。每个分区由一系列有序、不可变的消息组成，是一个有序队列。同一个主题中的分区可以不在一个机器上，有可能会部署在多个机器上，由此来实现 kafka 的伸缩性；单一主题中的分区有序，但是无法保证主题中所有的分区有序。</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://pic.imgdb.cn/item/6076b72d8322e6675c8343fd.jpg alt=分区写入示意 loading=lazy data-zoomable></div></div></figure></p><p>每个分区在物理上对应为一个文件夹，分区的命名规则为主题名称后接“—”连接符，之后再接分区编号，分区编号从 0 开始，编号最大值为分区的总数减 1。每个分区又有一至多个副本(Replica)，分区的副本分布在集群的不同代理上，以提高可用性。从存储角度上分析，分区的每个副本在逻辑上抽象为一个日志(Log)对象，即分区的副本与日志对象是一一对应的。每个主题对应的分区数可以在 Kafka 启动时所加载的配置文件中配置，也可以在创建主题时指定。当然，客户端还可以在主题创建后修改主题的分区数。</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://pic.imgdb.cn/item/6076b8008322e6675c84dfc3.jpg alt=消费者群组读取消息 loading=lazy data-zoomable></div></div></figure></p><p>分区使得 Kafka 在并发处理上变得更加容易，分区数量决定了每个 Consumer Group 中并发消费者的最大数量。理论上来说，分区数越多吞吐量越高，但这要根据集群实际环境及业务场景而定。某一个主题下的分区数，对于消费该主题的同一个消费组下的消费者数量，应该小于等于该主题下的分区数。某一个主题有 4 个分区，那么消费组中的消费者应该小于等于 4，而且最好与分区数成整数倍 1 2 4 这样。同一个分区下的数据，在同一时刻，不能同一个消费组的不同消费者消费。</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://pic.imgdb.cn/item/6077f5cb8322e6675caed3b3.png alt=不同分区、消费者数目 loading=lazy data-zoomable></div></div></figure></p><p>同时，分区也是 Kafka 保证消息被顺序消费以及对消息进行负载均衡的基础。Kafka 只能保证一个分区之内消息的有序性，并不能保证跨分区消息的有序性。每条消息被追加到相应的分区中，是顺序写磁盘，因此效率非常高，这是 Kafka 高吞吐率的一个重要保证。同时与传统消息系统不同的是，Kafka 并不会立即删除已被消费的消息，由于磁盘的限制消息也不会一直被存储，因此 Kafka 提供两种删除老数据的策略，一是基于消息已存储的时间长度，二是基于分区的大小。这两种策略都能通过配置文件进行配置。</p><h1 id=偏移量>偏移量</h1><p>任何发布到分区的消息会被直接追加到日志文件(分区目录下以“.log”为文件名后缀的数据文件)的尾部，而每条消息在日志文件中的位置都会对应一个按序递增的偏移量。偏移量是一个分区下严格有序的逻辑值，它并不表示消息在磁盘上的物理位置。由于 Kafka 几乎不允许对消息进行随机读写，因此 Kafka 并没有提供额外索引机制到存储偏移量，也就是说并不会给偏移量再提供索引。</p><p>消费者可以通过控制消息偏移量来对消息进行消费，如消费者可以指定消费的起始偏移量。为了保证消息被顺序消费，消费者已消费的消息对应的偏移量也需要保存。需要说明的是，消费者对消息偏移量的操作并不会影响消息本身的偏移量。旧版消费者将消费偏移量保存到 ZooKeeper 当中，而新版消费者是将消费偏移量保存到 Kafka 内部一个主题当中。当然，消费者也可以自己在外部系统保存消费偏移量，而无需保存到 Kafka 中。</p><h1 id=日志段segment>日志段（Segment）</h1><p>一个日志又被划分为多个日志段(LogSegment)，日志段是 Kafka 日志对象分片的最小单位。与日志对象一样，日志段也是一个逻辑概念，一个日志段对应磁盘上一个具体日志文件和两个索引文件。日志文件是以“.log”为文件名后缀的数据文件，用于保存消息实际数据。两个索引文件分别以“.index”和“.timeindex”作为文件名后缀，分别表示消息偏移量索引文件和消息时间戳索引文件。查找某个 offset 的消息，先二分法找出消息所在的 segment 文件（因为每个 segment 的命名都是以该文件中消息 offset 最小的值命名）；然后，加载对应的.index 索引文件到内存，同样二分法找出小于等于给定 offset 的最大的那个 offset 记录（相对 offset，position）；最后，根据 position 到.log 文件中，顺序查找出 offset 等于给定 offset 值的消息。</p><p>由于消息在 partition 的 segment 数据文件中是顺序读写的，且消息消费后不会删除（删除策略是针对过期的 segment 文件），这种顺序磁盘 IO 存储设计是 Kafka 高性能很重要的原因。</p><h1 id=代理broker>代理（Broker）</h1><p>Kafka 集群包含一个或多个服务器，我们将每一个 Kafka 实例称为代理(Broker)，通常也称代理为 Kafka 服务器(KafkaServer)。broker 接收来自生产者的消息，为消息设置偏移量，并提交消息到磁盘保存。broker 为消费者提供服务，对读取分区的请求作出响应，返回已经提交到磁盘上的消息。</p><p>在生产环境中 Kafka 集群一般包括一台或多台服务器，我们可以在一台服务器上配置一个或多个代理。每一个代理都有唯一的标识 id，这个 id 是一个非负整数。在一个 Kafka 集群中，每增加一个代理就需要为这个代理配置一个与该集群中其他代理不同的 id，id 值可以选择任意非负整数即可，只要保证它在整个 Kafka 集群中唯一，这个 id 就是代理的名字，也就是在启动代理时配置的 broker.id 对应的值，因此在本文中有时我们也称为 brokerId。由于给每个代理分配了不同的 brokerId，这样对代理进行迁移就变得更方便，从而对消费者来说是透明的，不会影响消费者对消息的消费。</p><p>每个集群中都会有一个 broker 同时充当了 集群控制器(Leader)的角色，它是由集群中的活跃成员选举出来的。每个集群中的成员都有可能充当 Leader，Leader 负责管理工作，包括将分区分配给 broker 和监控 broker。集群中，一个分区从属于一个 Leader，但是一个分区可以分配给多个 broker（非 Leader），这时候会发生分区复制。这种复制的机制为分区提供了消息冗余，如果一个 broker 失效，那么其他活跃用户会重新选举一个 Leader 接管。</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://pic.imgdb.cn/item/607701288322e6675c249fa8.jpg alt=分区复制示意图 loading=lazy data-zoomable></div></div></figure></p><h1 id=isr>ISR</h1><p>Kafka 在 ZooKeeper 中动态维护了一个 ISR(In-sync Replica)，即保存同步的副本列表，该列表中保存的是与 Leader 副本保持消息同步的所有副本对应的代理节点 id。如果一个 Follower 副本宕机(本书用宕机来特指某个代理失效的情景，包括但不限于代理被关闭，如代理被人为关闭或是发生物理故障、心跳检测过期、网络延迟、进程崩溃等)或是落后太多，则该 Follower 副本节点将从 ISR 列表中移除。对于 Kafka 节点，判断是”alive”有以下两个条件：</p><ul><li>节点必须和 Zookeeper 保持心跳连接</li><li>如果节点是 follower，必须从 leader 节点上复制数据来备份，而且备份的数据相比 leader 而言，不能落后太多。</li></ul><h1 id=副本>副本</h1><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://pic.imgdb.cn/item/6077f5e78322e6675caf0fe5.png alt="Kafka 副本示意图" loading=lazy data-zoomable></div></div></figure></p><p>由于 Kafka 副本的存在，就需要保证一个分区的多个副本之间数据的一致性，Kafka 会选择该分区的一个副本作为 Leader 副本，而该分区其他副本即为 Follower 副本，只有 Leader 副本才负责处理客户端读/写请求，Follower 副本从 Leader 副本同步数据。引入 Leader 副本后客户端只需与 Leader 副本进行交互，这样数据一致性及顺序性就有了保证。Follower 副本从 Leader 副本同步消息，对于 n 个副本只需 n−1 条通路即可，这样就使得系统更加简单而高效。副本 Follower 与 Leader 的角色并不是固定不变的，如果 Leader 失效，通过相应的选举算法将从其他 Follower 副本中选出新的 Leader 副本。</p><p>Kafka 解决了 fail/recover，一条消息只有被 ISR 里的所有 Follower 都从 Leader 复制过去才会被认为已提交。这样就避免了部分数据被写进了 Leader，还没来得及被任何 Follower 复制就宕机了，而造成数据丢失（Consumer 无法消费这些数据）。</p><h1 id=zookeeper>ZooKeeper</h1><p>Kafka 利用 ZooKeeper 保存相应元数据信息，Kafka 元数据信息包括如代理节点信息、Kafka 集群信息、旧版消费者信息及其消费偏移量信息、主题信息、分区状态信息、分区副本分配方案信息、动态配置信息等。Kafka 在启动或运行过程当中会在 ZooKeeper 上创建相应节点来保存元数据信息，Kafka 通过监听机制在这些节点注册相应监听器来监听节点元数据的变化，从而由 ZooKeeper 负责管理维护 Kafka 集群，同时通过 ZooKeeper 我们能够很方便地对 Kafka 集群进行水平扩展及数据迁移。</p><p>不过 2021 年3 月 30 日，Kafka 背后的企业 Confluent 发布博客表示，在即将发布的 2.8 版本里，用户可在完全不需要 ZooKeeper 的情况下运行 Kafka，该版本将依赖于 ZooKeeper 的控制器改造成了基于 Kafka Raft 的 Quorm 控制器。在之前的版本中，如果没有 ZooKeeper，Kafka 将无法运行。但管理部署两个不同的系统不仅让运维复杂度翻倍，还让 Kafka 变得沉重，进而限制了 Kafka 在轻量环境下的应用，同时 ZooKeeper 的分区特性也限制了 Kafka 的承载能力。</p></div><div class=article-widget><div class="container-xl row post-nav"></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div><script type=text/javascript id=clstr_globe async src="//clustrmaps.com/globe.js?d=kgpJG5sWZQpKujBmD-uW1B54-WBPol-DuDtrB2KFjKs"></script></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>