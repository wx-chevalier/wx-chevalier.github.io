<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="Quick Start Installation Linux 从这里下载，下载解压之后可以直接以独立模式运行。Server 被包含在了一个的 Jar 包中。tickTime=2000 dataDir=/var/lib/zookeeper clientPort=2181 This file can be called anything, but for the sake of this discussion call it conf/zoo.cfg. Change the value of dataDir to specify an existing (empty to start with) directory. Here are the meanings for each of the fields:tickTime"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/distributedstorage-series/10.kv-%E5%AD%98%E5%82%A8/zookeeper/%E9%83%A8%E7%BD%B2%E4%B8%8E%E9%85%8D%E7%BD%AE/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/distributedstorage-series/10.kv-%E5%AD%98%E5%82%A8/zookeeper/%E9%83%A8%E7%BD%B2%E4%B8%8E%E9%85%8D%E7%BD%AE/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/distributedstorage-series/10.kv-%E5%AD%98%E5%82%A8/zookeeper/%E9%83%A8%E7%BD%B2%E4%B8%8E%E9%85%8D%E7%BD%AE/"><meta property="og:title" content="部署与配置 | Next-gen Tech Edu"><meta property="og:description" content="Quick Start Installation Linux 从这里下载，下载解压之后可以直接以独立模式运行。Server 被包含在了一个的 Jar 包中。tickTime=2000 dataDir=/var/lib/zookeeper clientPort=2181 This file can be called anything, but for the sake of this discussion call it conf/zoo.cfg. Change the value of dataDir to specify an existing (empty to start with) directory. Here are the meanings for each of the fields:tickTime"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>部署与配置 | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=e046d887eef562526e1859fe53a87dcc><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">ZooKeeper</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id251e147344362f463ac82ab12b563cae")' href=#id251e147344362f463ac82ab12b563cae aria-expanded=false aria-controls=id251e147344362f463ac82ab12b563cae aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/distributedstorage-series/10.kv-%E5%AD%98%E5%82%A8/>10.KV 存储</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id251e147344362f463ac82ab12b563cae aria-expanded=false aria-controls=id251e147344362f463ac82ab12b563cae><i class="fa-solid fa-angle-down" id=caret-id251e147344362f463ac82ab12b563cae></i></a></div><ul class="nav docs-sidenav collapse show" id=id251e147344362f463ac82ab12b563cae><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id639de40023f26e7c320ad8b181b36030")' href=#id639de40023f26e7c320ad8b181b36030 aria-expanded=false aria-controls=id639de40023f26e7c320ad8b181b36030 aria-hidden=false data-toggle=collapse></div></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id6d74454603f8abafebc01bdea7ef642a")' href=#id6d74454603f8abafebc01bdea7ef642a aria-expanded=false aria-controls=id6d74454603f8abafebc01bdea7ef642a aria-hidden=false data-toggle=collapse></div></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idad757c7320e4e7ddcb589daca150f940")' href=#idad757c7320e4e7ddcb589daca150f940 aria-expanded=false aria-controls=idad757c7320e4e7ddcb589daca150f940 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/distributedstorage-series/10.kv-%E5%AD%98%E5%82%A8/zookeeper/>ZooKeeper</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idad757c7320e4e7ddcb589daca150f940 aria-expanded=false aria-controls=idad757c7320e4e7ddcb589daca150f940><i class="fa-solid fa-angle-down" id=caret-idad757c7320e4e7ddcb589daca150f940></i></a></div><ul class="nav docs-sidenav collapse show" id=idad757c7320e4e7ddcb589daca150f940><li class="child level"><a href=/books/distributedstorage-series/10.kv-%E5%AD%98%E5%82%A8/zookeeper/zab/>ZAB</a></li><li class="child level active"><a href=/books/distributedstorage-series/10.kv-%E5%AD%98%E5%82%A8/zookeeper/%E9%83%A8%E7%BD%B2%E4%B8%8E%E9%85%8D%E7%BD%AE/>部署与配置</a></li><li class="child level"><a href=/books/distributedstorage-series/10.kv-%E5%AD%98%E5%82%A8/zookeeper/%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/>架构原理</a></li><li class="child level"><a href=/books/distributedstorage-series/10.kv-%E5%AD%98%E5%82%A8/zookeeper/%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/>数据操作</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id3a1c5876e21085a12c8f8cbe83e914ae")' href=#id3a1c5876e21085a12c8f8cbe83e914ae aria-expanded=false aria-controls=id3a1c5876e21085a12c8f8cbe83e914ae aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/distributedstorage-series/10.kv-%E5%AD%98%E5%82%A8/%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F%E5%AF%B9%E6%AF%94/>配置方式对比</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id3a1c5876e21085a12c8f8cbe83e914ae aria-expanded=false aria-controls=id3a1c5876e21085a12c8f8cbe83e914ae><i class="fa-solid fa-angle-right" id=caret-id3a1c5876e21085a12c8f8cbe83e914ae></i></a></div><ul class="nav docs-sidenav collapse" id=id3a1c5876e21085a12c8f8cbe83e914ae><li class="child level"><a href=/books/distributedstorage-series/10.kv-%E5%AD%98%E5%82%A8/%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F%E5%AF%B9%E6%AF%94/%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F/>基础配置方式</a></li></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#installation>Installation</a><ul><li><a href=#linux>Linux</a></li><li><a href=#docker>Docker</a></li></ul></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>部署与配置</h1><div class=article-style><h1 id=quick-start>Quick Start</h1><h2 id=installation>Installation</h2><h3 id=linux>Linux</h3><p>从<a href=http://zookeeper.apache.org/releases.html target=_blank rel=noopener>这里</a>下载，下载解压之后可以直接以独立模式运行。Server 被包含在了一个的 Jar 包中。tickTime=2000 dataDir=/var/lib/zookeeper clientPort=2181</p><p>This file can be called anything, but for the sake of this discussion call it conf/zoo.cfg. Change the value of dataDir to specify an existing (empty to start with) directory. Here are the meanings for each of the fields:tickTime the basic time unit in milliseconds used by ZooKeeper. It is used to do heartbeats and the minimum session timeout will be twice the tickTime.dataDir the location to store the in-memory database snapshots and, unless specified otherwise, the transaction log of updates to the database.clientPort the port to listen for client connections</p><p>Now that you created the configuration file, you can start ZooKeeper:bin/zkServer.sh start</p><h3 id=docker>Docker</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>FROM ubuntu:vivid
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>RUN apt-get update <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span> <span class=o>&amp;&amp;</span> apt-get -y install git ant openjdk-8-jdk <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span> <span class=o>&amp;&amp;</span> apt-get clean
</span></span><span class=line><span class=cl>RUN mkdir /tmp/zookeeper
</span></span><span class=line><span class=cl>WORKDIR /tmp/zookeeper
</span></span><span class=line><span class=cl>RUN git clone https://github.com/apache/zookeeper.git .
</span></span><span class=line><span class=cl>RUN git checkout release-3.5.1-rc2
</span></span><span class=line><span class=cl>RUN ant jar
</span></span><span class=line><span class=cl><span class=c1># 将zookeeper配置文件复制到指定地方</span>
</span></span><span class=line><span class=cl>RUN cp /tmp/zookeeper/conf/zoo_sample.cfg /tmp/zookeeper/conf/zoo.cfg
</span></span><span class=line><span class=cl>RUN <span class=nb>echo</span> <span class=s2>&#34;standaloneEnabled=false&#34;</span> &gt;&gt; /tmp/zookeeper/conf/zoo.cfg
</span></span><span class=line><span class=cl>RUN	<span class=nb>echo</span> <span class=s2>&#34;dynamicConfigFile=/tmp/zookeeper/conf/zoo.cfg.dynamic&#34;</span> &gt;&gt; /tmp/zookeeper/conf/zoo.cfg
</span></span><span class=line><span class=cl>ADD zk-init.sh /usr/local/bin/
</span></span><span class=line><span class=cl>ENTRYPOINT <span class=o>[</span><span class=s2>&#34;/usr/local/bin/zk-init.sh&#34;</span><span class=o>]</span>
</span></span></code></pre></div><p>使用以下命令构建单机版的 Docker 镜像</p><pre tabindex=0><code>docker build -t `whoami`/zookeeper:latest .
</code></pre><p>zk-init.sh 脚本内容如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>ZK</span><span class=o>=</span><span class=nv>$1</span>
</span></span><span class=line><span class=cl><span class=nv>MYID</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl><span class=nv>IPADDRESS</span><span class=o>=</span><span class=sb>`</span>ip -4 addr show scope global dev eth0 <span class=p>|</span> grep inet <span class=p>|</span> awk <span class=s1>&#39;{print \$2}&#39;</span> <span class=p>|</span> cut -d / -f 1<span class=sb>`</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>cd</span> /tmp/zookeeper
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> -n <span class=s2>&#34;</span><span class=nv>$ZK</span><span class=s2>&#34;</span> <span class=o>]</span>
</span></span><span class=line><span class=cl><span class=k>then</span>
</span></span><span class=line><span class=cl>  <span class=nv>output</span><span class=o>=</span><span class=sb>`</span>./bin/zkCli.sh -server <span class=nv>$ZK</span>:2181 get /zookeeper/config <span class=p>|</span> grep ^server<span class=sb>`</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># extract all the zk-ids from the output</span>
</span></span><span class=line><span class=cl>  <span class=nb>declare</span> -a <span class=nv>id_list</span><span class=o>=()</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=nb>read</span> x<span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nv>id_list</span><span class=o>+=(</span><span class=sb>`</span><span class=nb>echo</span> <span class=nv>$x</span> <span class=p>|</span> cut -d<span class=s2>&#34;=&#34;</span> -f1 <span class=p>|</span> cut -d<span class=s2>&#34;.&#34;</span> -f2<span class=sb>`</span><span class=o>)</span>
</span></span><span class=line><span class=cl>  <span class=k>done</span> <span class=o>&lt;&lt;&lt;</span><span class=k>$(</span>output<span class=k>)</span>
</span></span><span class=line><span class=cl>  <span class=nv>sorted_id_list</span><span class=o>=(</span> <span class=k>$(</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> el in <span class=s2>&#34;</span><span class=si>${</span><span class=nv>id_list</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>do</span>
</span></span><span class=line><span class=cl>      <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$el</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>done</span> <span class=p>|</span> sort -n<span class=k>)</span> <span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># get the next increasing number from the sequence</span>
</span></span><span class=line><span class=cl>  <span class=nv>MYID</span><span class=o>=</span><span class=k>$((</span><span class=si>${</span><span class=nv>sorted_id_list</span><span class=p>[</span><span class=si>${#</span><span class=nv>sorted_id_list</span><span class=p>[@]</span><span class=si>}</span><span class=p>-1]</span><span class=si>}</span><span class=o>+</span><span class=m>1</span><span class=k>))</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=nv>$output</span> &gt;&gt; /tmp/zookeeper/conf/zoo.cfg.dynamic
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;server.</span><span class=nv>$MYID</span><span class=s2>=</span><span class=nv>$IPADDRESS</span><span class=s2>:2888:3888:observer;2181&#34;</span> &gt;&gt; /tmp/zookeeper/conf/zoo.cfg.dynamic
</span></span><span class=line><span class=cl>  cp /tmp/zookeeper/conf/zoo.cfg.dynamic /tmp/zookeeper/conf/zoo.cfg.dynamic.org
</span></span><span class=line><span class=cl>  /tmp/zookeeper/bin/zkServer-initialize.sh --force --myid<span class=o>=</span><span class=nv>$MYID</span>
</span></span><span class=line><span class=cl>  <span class=nv>ZOO_LOG_DIR</span><span class=o>=</span>/var/log <span class=nv>ZOO_LOG4J_PROP</span><span class=o>=</span><span class=s1>&#39;INFO,CONSOLE,ROLLINGFILE&#39;</span> /tmp/zookeeper/bin/zkServer.sh start
</span></span><span class=line><span class=cl>  /tmp/zookeeper/bin/zkCli.sh -server <span class=nv>$ZK</span>:2181 reconfig -add <span class=s2>&#34;server.</span><span class=nv>$MYID</span><span class=s2>=</span><span class=nv>$IPADDRESS</span><span class=s2>:2888:3888:participant;2181&#34;</span>
</span></span><span class=line><span class=cl>  /tmp/zookeeper/bin/zkServer.sh stop
</span></span><span class=line><span class=cl>  <span class=nv>ZOO_LOG_DIR</span><span class=o>=</span>/var/log <span class=nv>ZOO_LOG4J_PROP</span><span class=o>=</span><span class=s1>&#39;INFO,CONSOLE,ROLLINGFILE&#39;</span> /tmp/zookeeper/bin/zkServer.sh start-foreground
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;server.</span><span class=nv>$MYID</span><span class=s2>=</span><span class=nv>$IPADDRESS</span><span class=s2>:2888:3888;2181&#34;</span> &gt;&gt; /tmp/zookeeper/conf/zoo.cfg.dynamic
</span></span><span class=line><span class=cl>  /tmp/zookeeper/bin/zkServer-initialize.sh --force --myid<span class=o>=</span><span class=nv>$MYID</span>
</span></span><span class=line><span class=cl>  <span class=nv>ZOO_LOG_DIR</span><span class=o>=</span>/var/log <span class=nv>ZOO_LOG4J_PROP</span><span class=o>=</span><span class=s1>&#39;INFO,CONSOLE,ROLLINGFILE&#39;</span> /tmp/zookeeper/bin/zkServer.sh start-foreground
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></div><pre tabindex=0><code>docker run --net=host --name zk1 `whoami`/zookeeper
</code></pre><p>注意，这里使用了<code>—net</code>指令，即是直接将 Zookeeper 的端口映射到了宿主机上，如果要在一台宿主机上 Run 多个 Zookeeper 实例，请使用 container 网络，建议使用 Docker-Compose 进行构建。</p><p>We need the ip of our node. This will be the ip of your host, or in a single host setup you will need to inspect the container like this:</p><pre tabindex=0><code>docker inspect zk1|grep IPAddress
</code></pre><p>We specify the IP address when starting the second node:</p><pre tabindex=0><code>docker run --net=host --name zk2 containersol/zookeeper &lt;ip of the first zookeeper&gt;
</code></pre><p>This time we also see a few WARNINGS and even an ERROR, but in the end</p><p>we have two nodes running. We throw in a third for good measure:</p><pre tabindex=0><code>docker run --net=host --name zk3 containersol/zookeeper &lt;ip of 1st zookeeper&gt;
</code></pre><p>集群建立之后，可以通过如下命令验证：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>docker <span class=nb>exec</span> -it zk1 bin/zkCli.sh -server &lt;ip of 1st zookeeper&gt;:2181 config<span class=p>|</span> grep ^server
</span></span><span class=line><span class=cl>server.1<span class=o>=</span>&lt;ip of 1st zookeeper&gt;:2888:3888:participant<span class=p>;</span>0.0.0.0:2181
</span></span><span class=line><span class=cl>server.2<span class=o>=</span>&lt;ip of 2nd zookeeper&gt;:2888:3888:participant<span class=p>;</span>0.0.0.0:2181
</span></span><span class=line><span class=cl>server.3<span class=o>=</span>&lt;ip of 3rd zookeeper&gt;:2888:3888:participant<span class=p>;</span>0.0.0.0:2181
</span></span></code></pre></div></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>上一页</div><a href=/books/distributedstorage-series/10.kv-%E5%AD%98%E5%82%A8/zookeeper/zab/ rel=next>ZAB</a></div><div class="col-6 post-nav-item"><div class=meta-nav>下一页</div><a href=/books/distributedstorage-series/10.kv-%E5%AD%98%E5%82%A8/zookeeper/%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86/ rel=prev>架构原理</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>