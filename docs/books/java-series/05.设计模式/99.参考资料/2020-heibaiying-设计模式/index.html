<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="设计模式 软件设计的原则 1. 开闭原则 定义：软件实体应当对扩展开放，对修改关闭。 2. 里氏替换原则 定义：继承必须保证超类所拥有的性质在子类中仍然成立。即子类在继承父类时，除了添加新的方法来新增功能外，尽量避免重"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/java-series/05.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-heibaiying-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/java-series/05.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-heibaiying-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/java-series/05.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-heibaiying-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><meta property="og:title" content="2020-heibaiying-设计模式 | Next-gen Tech Edu"><meta property="og:description" content="设计模式 软件设计的原则 1. 开闭原则 定义：软件实体应当对扩展开放，对修改关闭。 2. 里氏替换原则 定义：继承必须保证超类所拥有的性质在子类中仍然成立。即子类在继承父类时，除了添加新的方法来新增功能外，尽量避免重"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>2020-heibaiying-设计模式 | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=2ee60d3be6bb7d1956f147aadef73444><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">99.参考资料</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idec1b188c25043ba453cba86de0130619")' href=#idec1b188c25043ba453cba86de0130619 aria-expanded=false aria-controls=idec1b188c25043ba453cba86de0130619 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/05.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/>05.设计模式</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idec1b188c25043ba453cba86de0130619 aria-expanded=false aria-controls=idec1b188c25043ba453cba86de0130619><i class="fa-solid fa-angle-down" id=caret-idec1b188c25043ba453cba86de0130619></i></a></div><ul class="nav docs-sidenav collapse show" id=idec1b188c25043ba453cba86de0130619><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id1ce5291b5e2ce6e76afd43359d8b300a")' href=#id1ce5291b5e2ce6e76afd43359d8b300a aria-expanded=false aria-controls=id1ce5291b5e2ce6e76afd43359d8b300a aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/05.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/>99.参考资料</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id1ce5291b5e2ce6e76afd43359d8b300a aria-expanded=false aria-controls=id1ce5291b5e2ce6e76afd43359d8b300a><i class="fa-solid fa-angle-down" id=caret-id1ce5291b5e2ce6e76afd43359d8b300a></i></a></div><ul class="nav docs-sidenav collapse show" id=id1ce5291b5e2ce6e76afd43359d8b300a><li class="child level active"><a href=/books/java-series/05.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-heibaiying-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/>2020-heibaiying-设计模式</a></li></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#软件设计的原则>软件设计的原则</a><ul><li><a href=#1-开闭原则>1. 开闭原则</a></li><li><a href=#2-里氏替换原则>2. 里氏替换原则</a></li><li><a href=#3-依赖倒置原则>3. 依赖倒置原则</a></li><li><a href=#4-单一职责原则>4. 单一职责原则</a></li><li><a href=#5-接口隔离原则>5. 接口隔离原则</a></li><li><a href=#6-迪米特法则-最少知道原则>6. 迪米特法则 (最少知道原则)</a></li><li><a href=#7-合成复用原则-组合复用原则>7. 合成复用原则 (组合复用原则)</a></li></ul></li></ul><ul><li><a href=#1-单例模式>1. 单例模式</a><ul><li><a href=#11-饿汉式单例>1.1 饿汉式单例</a></li><li><a href=#12-懒汉式单例>1.2 懒汉式单例</a></li><li><a href=#13-使用序列化破坏单例>1.3 使用序列化破坏单例</a></li><li><a href=#14-使用反射破坏单例>1.4 使用反射破坏单例</a></li><li><a href=#15-枚举式单例>1.5 枚举式单例</a></li></ul></li><li><a href=#2-简单工厂模式>2. 简单工厂模式</a><ul><li><a href=#21-定义>2.1 定义</a></li><li><a href=#22-示例>2.2 示例</a></li><li><a href=#23-优缺点>2.3 优缺点</a></li></ul></li><li><a href=#3-工厂模式>3. 工厂模式</a><ul><li><a href=#31-定义>3.1 定义</a></li><li><a href=#32-示例>3.2 示例</a></li><li><a href=#33-优点>3.3 优点</a></li></ul></li><li><a href=#4-抽象工厂模式>4. 抽象工厂模式</a><ul><li><a href=#41-定义>4.1 定义</a></li><li><a href=#42-示例>4.2 示例</a></li><li><a href=#43-优缺点>4.3 优缺点</a></li></ul></li><li><a href=#5-构建者模式>5. 构建者模式</a><ul><li><a href=#51-定义>5.1 定义</a></li><li><a href=#52-示例>5.2 示例</a></li><li><a href=#53-优点>5.3 优点</a></li></ul></li><li><a href=#6-原型模式>6. 原型模式</a><ul><li><a href=#61-定义>6.1 定义</a></li><li><a href=#62-示例>6.2 示例</a></li><li><a href=#63-适用场景>6.3 适用场景</a></li></ul></li></ul><ul><li><a href=#1-代理模式>1. 代理模式</a><ul><li><a href=#11-定义>1.1 定义</a></li><li><a href=#12-静态代理>1.2 静态代理</a></li><li><a href=#13-jdk-代理>1.3 JDK 代理</a></li><li><a href=#14-cglib-代理>1.4 Cglib 代理</a></li></ul></li><li><a href=#2-适配器模式>2. 适配器模式</a><ul><li><a href=#21-定义-1>2.1 定义</a></li><li><a href=#22-示例-1>2.2 示例</a></li></ul></li><li><a href=#3-桥接模式>3. 桥接模式</a><ul><li><a href=#31-定义-1>3.1 定义</a></li><li><a href=#32-优点>3.2 优点</a></li><li><a href=#33-示例>3.3 示例</a></li></ul></li><li><a href=#4-组合模式>4. 组合模式</a><ul><li><a href=#41-定义-1>4.1 定义</a></li><li><a href=#42-优点>4.2 优点</a></li><li><a href=#43-示例>4.3 示例</a></li></ul></li><li><a href=#5-装饰模式>5. 装饰模式</a><ul><li><a href=#51-定义-1>5.1 定义</a></li><li><a href=#52-优点>5.2 优点</a></li><li><a href=#53-示例>5.3 示例</a></li></ul></li><li><a href=#6-外观模式>6. 外观模式</a><ul><li><a href=#61-定义-1>6.1 定义</a></li><li><a href=#62-优点>6.2 优点</a></li><li><a href=#63-示例>6.3 示例</a></li></ul></li><li><a href=#7-享元模式>7. 享元模式</a><ul><li><a href=#71-定义>7.1 定义</a></li><li><a href=#72-示例>7.2 示例</a></li></ul></li></ul><ul><li><a href=#1-观察者模式>1. 观察者模式</a><ul><li><a href=#11-定义-1>1.1 定义</a></li><li><a href=#12-优点>1.2 优点</a></li><li><a href=#13-示例>1.3 示例</a></li></ul></li><li><a href=#2-责任链模式>2. 责任链模式</a><ul><li><a href=#21-定义-2>2.1 定义</a></li><li><a href=#22-优点>2.2 优点</a></li><li><a href=#23-示例>2.3 示例</a></li></ul></li><li><a href=#3-模板方法模式>3. 模板方法模式</a><ul><li><a href=#31-定义-2>3.1 定义</a></li><li><a href=#32-优点-1>3.2 优点</a></li><li><a href=#33-示例-1>3.3 示例</a></li></ul></li><li><a href=#4-策略模式>4. 策略模式</a><ul><li><a href=#41-定义-2>4.1 定义</a></li><li><a href=#42-示例-1>4.2 示例</a></li></ul></li><li><a href=#6-状态模式>6. 状态模式</a><ul><li><a href=#61-定义-2>6.1 定义</a></li><li><a href=#62-优点-1>6.2 优点</a></li><li><a href=#63-示例-1>6.3 示例</a></li></ul></li><li><a href=#7-中介者模式>7. 中介者模式</a><ul><li><a href=#71-定义-1>7.1 定义</a></li><li><a href=#72-优点>7.2 优点</a></li><li><a href=#73-示例>7.3 示例</a></li></ul></li><li><a href=#8-迭代器模式>8. 迭代器模式</a><ul><li><a href=#81-定义>8.1 定义</a></li><li><a href=#82-示例>8.2 示例</a></li></ul></li><li><a href=#9-访问者模式>9. 访问者模式</a><ul><li><a href=#91-定义>9.1 定义</a></li><li><a href=#92-优缺点>9.2 优缺点</a></li><li><a href=#93-示例>9.3 示例</a></li></ul></li><li><a href=#10-备忘录模式>10. 备忘录模式</a><ul><li><a href=#101-定义>10.1 定义</a></li><li><a href=#102-优缺点>10.2 优缺点</a></li><li><a href=#103-示例>10.3 示例</a></li></ul></li><li><a href=#11-解释器模式>11. 解释器模式</a></li><li><a href=#参考资料>参考资料</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>2020-heibaiying-设计模式</h1><div class=article-style><h1 id=设计模式>设计模式</h1><h2 id=软件设计的原则>软件设计的原则</h2><h3 id=1-开闭原则>1. 开闭原则</h3><p>定义：软件实体应当对扩展开放，对修改关闭。</p><h3 id=2-里氏替换原则>2. 里氏替换原则</h3><p>定义：继承必须保证超类所拥有的性质在子类中仍然成立。即子类在继承父类时，除了添加新的方法来新增功能外，尽量避免重写父类方法，因为这会导致整个继承体系的复用性变差。</p><h3 id=3-依赖倒置原则>3. 依赖倒置原则</h3><p>定义：高层模块不应该依赖低层模块，两者都应该依赖其抽象；抽象不应该依赖细节，细节应该依赖抽象。其核心思想是要面向接口编程，而不是面向实现编程，这样可以降低耦合性，提高系统稳定性，提高代码的可读性和可维护性。</p><h3 id=4-单一职责原则>4. 单一职责原则</h3><p>定义：一个类应该有且仅有一个引起它变化的原则，否则类应该被拆分。其核心思想是控制类的粒度大小、提高类的内聚性。</p><h3 id=5-接口隔离原则>5. 接口隔离原则</h3><p>定义：一个类对另一个类的依赖应该建立在最小的接口上。其核心思想是要为每个特定的功能建立对应的接口，而不是在一个接口中试图去包含所有功能，既要保证相对独立，也要避免过多接口所导致的臃肿。</p><h3 id=6-迪米特法则-最少知道原则>6. 迪米特法则 (最少知道原则)</h3><p>定义：如果两个软件实体不需要直接通讯，那么就应该避免直接互相调用，而是通过第三方转发该调用，从而降低耦合度，保证模块的相对独立。</p><h3 id=7-合成复用原则-组合复用原则>7. 合成复用原则 (组合复用原则)</h3><p>定义：应该优先使用组合、聚合等关联关系来实现复用，其次才是考虑使用继承关系。</p><p><strong>总结</strong>：开闭原则是总纲，它告诉我们要对扩展开放，对修改关闭；里氏替换原则告诉我们不要破坏继承体系；依赖倒置原则告诉我们要面向接口编程；单一职责原则告诉我们实现类要职责单一；接口隔离原则告诉我们在设计接口的时候要精简单一；迪米特法则告诉我们要降低耦合度；合成复用原则告诉我们要优先使用组合或者聚合关系复用，少用继承关系复用。</p><h1 id=创建型>创建型</h1><h2 id=1-单例模式>1. 单例模式</h2><h3 id=11-饿汉式单例>1.1 饿汉式单例</h3><p>饿汉式单例是最简单一种单例模式，它在类初始化时就完成相关单例对象的创建，可以通过静态代码块或静态内部类的方式来进行实现：</p><p>静态代码块方式：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HungrySingleton</span> <span class=kd>implements</span> <span class=n>Serializable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>HungrySingleton</span> <span class=n>instance</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>instance</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HungrySingleton</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 确保构造器私有
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>private</span> <span class=nf>HungrySingleton</span><span class=o>()</span> <span class=o>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取单例对象
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>HungrySingleton</span> <span class=nf>getInstance</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>instance</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>静态内部类方式：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>StaticInnerClassHungrySingleton</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>InnerClass</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=kd>static</span> <span class=n>StaticInnerClassHungrySingleton</span> <span class=n>instance</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StaticInnerClassHungrySingleton</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 确保构造器私有
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>private</span> <span class=nf>StaticInnerClassHungrySingleton</span><span class=o>()</span> <span class=o>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取单例对象
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>StaticInnerClassHungrySingleton</span> <span class=nf>getInstance</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>InnerClass</span><span class=o>.</span><span class=na>instance</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>饿汉式单例的优点在于其不存在线程安全问题，对象的唯一性由虚拟机在类初始化创建时保证；其缺点在于如果对象的创建比较消耗资源，并且单例对象不一定会被使用时就会造成资源的浪费。</p><h3 id=12-懒汉式单例>1.2 懒汉式单例</h3><p>懒汉式单例的思想在于在需要使用单例对象时才进行创建，如果对象存在则直接返回，如果对象不存在则创建后返回，示例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>LazySingletonUnsafe</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=n>LazySingletonUnsafe</span> <span class=n>instance</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=nf>LazySingletonUnsafe</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>LazySingletonUnsafe</span> <span class=nf>getInstance</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>instance</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>instance</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LazySingletonUnsafe</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>instance</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>需要注意的是上面的代码在单线程环境下是没有问题的，但是在多线程环境下是线程不安全的，原因在于下面的创建代码是非原子性的：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span><span class=n>instance</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>instance</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LazySingletonUnsafe</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>想要保证创建操作的原子性，可以通过 synchronized 关键字来进行实现：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>synchronized</span> <span class=kd>static</span> <span class=n>LazySingletonUnsafe</span> <span class=nf>getInstance</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>instance</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>instance</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LazySingletonUnsafe</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>instance</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span></code></pre></div><p>此时该方法是线程安全的，但是性能却存在问题。因为 synchronized 修饰的是静态方法，其锁住的是整个类对象，这意味着所有想要获取该单例对象的线程都必须要等待内部锁的释放。假设单例对象已经创建完成，并有 100 个线程并发获取该单例对象，则这 100 个线程都需要等待，显然这会降低系统的吞吐量，因此更好的方式是采用 <strong>双重检查锁的机制</strong> 来实现懒汉式单例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>DoubleCheckLazySingletonSafe</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 使用volatile来禁止指令重排序
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>volatile</span> <span class=n>DoubleCheckLazySingletonSafe</span> <span class=n>instance</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=nf>DoubleCheckLazySingletonSafe</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 双重检查
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>DoubleCheckLazySingletonSafe</span> <span class=nf>getInstance</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>instance</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=kd>synchronized</span> <span class=o>(</span><span class=n>DoubleCheckLazySingletonSafe</span><span class=o>.</span><span class=na>class</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=o>(</span><span class=n>instance</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>instance</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DoubleCheckLazySingletonSafe</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>instance</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>还是沿用上面的举例，假设单例对象已经创建完成，并有 100 个线程并发获取该单例对象，此时 <code>instance == null</code> 判断肯定是 false，所以所有线程都会直接获得该单例对象，而不会进入 synchronized 同步代码块，这减小了锁的锁定范围，用更小的锁粒度获得了更好的性能。但内部的 <code>if</code> 代码块仍然需要使用 synchronized 关键字修饰，从而保证整个 if 代码块的原子性。</p><p>需要注意的是这里的 instance 需要使用 volatile 关键修饰，用于禁止对象在创建过程中出现指令重排序。通常对象的创建分为以下三步：</p><ol><li>给对象分配内存空间；</li><li>调用对象的构造器方法，并执行初始化操作；</li><li>将变量指向相应的内存地址。</li></ol><p>如果没有禁止指令重排序，则 2 ，3 步可能会发生指令重排序，这在单线程下是没有问题的，也符合 As-If-Serial 原则，但是如果在多线程下就会出现线程不安全的问题：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 2. 由于线程1已经将变量指向内存地址，所以其他线程判断instance不为空，进而直接获取，但instance可能尚未初始化完成
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=o>(</span><span class=n>instance</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>synchronized</span> <span class=o>(</span><span class=n>DoubleCheckLazySingletonSafe</span><span class=o>.</span><span class=na>class</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>instance</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 1. 假设线程1已经给对象分配了内存空间并将变量instance指向了相应的内存地址，但尚未初始化完成
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>instance</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DoubleCheckLazySingletonSafe</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=n>instance</span><span class=o>;</span>
</span></span></code></pre></div><p>由于重排序的存在，其他线程可能拿到的是一个尚未初始化完成的 instance，此时就可能会导致异常，所以需要禁止其出现指令重排序。</p><h3 id=13-使用序列化破坏单例>1.3 使用序列化破坏单例</h3><p>饿汉式单例和双重检查锁的懒汉式单例都是线程安全的，都能满足日常的开发需求，但如果你是类库的开发者，为了防止自己类库中的单例在调用时被有意或无意地破坏，你还需要考虑单例模式的写法安全。其中序列化和反射攻击是两种常见的破坏单例的方式，示例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SerializationDamage</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span><span class=o>,</span> <span class=n>ClassNotFoundException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>HungrySingleton</span> <span class=n>instance</span> <span class=o>=</span> <span class=n>HungrySingleton</span><span class=o>.</span><span class=na>getInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>ObjectOutputStream</span> <span class=n>outputStream</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ObjectOutputStream</span><span class=o>(</span><span class=k>new</span> <span class=n>FileOutputStream</span><span class=o>(</span><span class=s>&#34;SingletonFile&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>outputStream</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=n>instance</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>ObjectInputStream</span> <span class=n>inputStream</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ObjectInputStream</span><span class=o>(</span><span class=k>new</span> <span class=n>FileInputStream</span><span class=o>(</span><span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=s>&#34;SingletonFile&#34;</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>        <span class=n>HungrySingleton</span> <span class=n>newInstance</span> <span class=o>=</span> <span class=o>(</span><span class=n>HungrySingleton</span><span class=o>)</span> <span class=n>inputStream</span><span class=o>.</span><span class=na>readObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>instance</span> <span class=o>==</span> <span class=n>newInstance</span><span class=o>);</span> <span class=c1>// false
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>将 HungrySingleton 实现 Serializable 接口后，使用上面的代码将对象序列化写入文件，然后再反序列获取，你会发现两次得到的不是一个对象，这就代表单例模式受到了序列化和反序列化的破坏。想要解决这个问题，需要在对应的单例类中定义 <code>readResolve()</code> 方法：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HungrySingleton</span> <span class=kd>implements</span> <span class=n>Serializable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>......</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Object</span> <span class=nf>readResolve</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>instance</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>......</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>此时在反序列化时该方法就会被调用来返回单例对象，对应的 ObjectInputStream 类的源码如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>  <span class=c1>// 在本用例中，readObject在内部最终调用的是readOrdinaryObject方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>private</span> <span class=n>Object</span> <span class=nf>readOrdinaryObject</span><span class=o>(</span><span class=kt>boolean</span> <span class=n>unshared</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span><span class=o>{</span>
</span></span><span class=line><span class=cl>       <span class=o>.......</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>obj</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>handles</span><span class=o>.</span><span class=na>lookupException</span><span class=o>(</span><span class=n>passHandle</span><span class=o>)</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>            <span class=n>desc</span><span class=o>.</span><span class=na>hasReadResolveMethod</span><span class=o>())</span> <span class=c1>//如果对应的对象中有readResolve方法
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// 则通过反射调用该方法来获取对应的单例对象
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>Object</span> <span class=n>rep</span> <span class=o>=</span> <span class=n>desc</span><span class=o>.</span><span class=na>invokeReadResolve</span><span class=o>(</span><span class=n>obj</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>........</span>
</span></span><span class=line><span class=cl>           <span class=n>handles</span><span class=o>.</span><span class=na>setObject</span><span class=o>(</span><span class=n>passHandle</span><span class=o>,</span> <span class=n>obj</span> <span class=o>=</span> <span class=n>rep</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>obj</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span></code></pre></div><h3 id=14-使用反射破坏单例>1.4 使用反射破坏单例</h3><p>使用反射也可以破坏单例模式，并且由于 Java 的反射功能过于强大，这种破坏几乎是无法规避的，示例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ReflectionDamage</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Constructor</span><span class=o>&lt;</span><span class=n>HungrySingleton</span><span class=o>&gt;</span> <span class=n>constructor</span> <span class=o>=</span> <span class=n>HungrySingleton</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getDeclaredConstructor</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 获取私有构造器的访问权限
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>constructor</span><span class=o>.</span><span class=na>setAccessible</span><span class=o>(</span><span class=kc>true</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>HungrySingleton</span> <span class=n>hungrySingleton</span> <span class=o>=</span> <span class=n>constructor</span><span class=o>.</span><span class=na>newInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>HungrySingleton</span> <span class=n>instance</span> <span class=o>=</span> <span class=n>HungrySingleton</span><span class=o>.</span><span class=na>getInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>hungrySingleton</span> <span class=o>==</span> <span class=n>instance</span><span class=o>);</span> <span class=c1>// false
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>即便在创建单例对象时将构造器声明为私有，此时仍然可以通过反射修改权限来获取，此时单例模式就被破坏了。如果你采用的是饿汉式单例，此时可以通过如下的代码来规避这种破坏：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HungrySingleton</span> <span class=kd>implements</span> <span class=n>Serializable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>HungrySingleton</span> <span class=n>instance</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>instance</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HungrySingleton</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 由于instance在类创建时就已经初始化完成，所以当使用反射调用构造器时就会抛出自定义的RuntimeException异常
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>private</span> <span class=nf>HungrySingleton</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>instance</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=o>(</span><span class=s>&#34;单例模式禁止反射调用&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>......</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>以上是饿汉式单例防止反射攻击的办法，如果你使用的是懒汉式单例，此时由于无法知道对象何时会被创建，并且反射功能能够获取到任意字段，方法，构造器的访问权限，所以此时没有任何方法能够规避掉反射攻击。</p><p>那么有没有一种单例模式能够在保证线程安全，还能够防止序列化和反射功能呢？在 Java 语言中，可以通过枚举式单例来实现。</p><h3 id=15-枚举式单例>1.5 枚举式单例</h3><p>使用枚举实现单例的示例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>enum</span> <span class=n>EnumInstance</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>INSTANCE</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>field</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getField</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>field</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setField</span><span class=o>(</span><span class=n>String</span> <span class=n>field</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>field</span> <span class=o>=</span> <span class=n>field</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>EnumInstance</span> <span class=nf>getInstance</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>INSTANCE</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>想要实现一个单例枚举，对应的单例类必须要使用 enum 修饰，其余的字段声明（如：field）, 方法声明（如：setField）都和正常的类一样。首先枚举类是线程安全的，这点可以使用反编译工具 Jad 对类的 class 文件进行反编译来验证：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Decompiled by Jad v1.5.8g. Copyright 2001 Pavel Kouznetsov.
</span></span></span><span class=line><span class=cl><span class=c1>// Jad home page: http://www.kpdus.com/jad.html
</span></span></span><span class=line><span class=cl><span class=c1>// Decompiler options: packimports(3)
</span></span></span><span class=line><span class=cl><span class=c1>// Source File Name:   EnumInstance.java
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.heibaiying.creational.singleton</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 不可变的类
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kd>final</span> <span class=kd>class</span> <span class=nc>EnumInstance</span> <span class=kd>extends</span> <span class=n>Enum</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>EnumInstance</span><span class=o>[]</span> <span class=nf>values</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>(</span><span class=n>EnumInstance</span><span class=o>[])</span><span class=n>$VALUES</span><span class=o>.</span><span class=na>clone</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>EnumInstance</span> <span class=nf>valueOf</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>(</span><span class=n>EnumInstance</span><span class=o>)</span><span class=n>Enum</span><span class=o>.</span><span class=na>valueOf</span><span class=o>(</span><span class=n>com</span><span class=o>/</span><span class=n>heibaiying</span><span class=o>/</span><span class=n>creational</span><span class=o>/</span><span class=n>singleton</span><span class=o>/</span><span class=n>EnumInstance</span><span class=o>,</span> <span class=n>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 私有构造器，枚举类没有无参构造器，Enum中只定义了Enum(String name, int ordinal) 构造器
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>private</span> <span class=nf>EnumInstance</span><span class=o>(</span><span class=n>String</span> <span class=n>s</span><span class=o>,</span> <span class=kt>int</span> <span class=n>i</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>s</span><span class=o>,</span> <span class=n>i</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 自定义的方法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getField</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>field</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setField</span><span class=o>(</span><span class=n>String</span> <span class=n>field</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>field</span> <span class=o>=</span> <span class=n>field</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>EnumInstance</span> <span class=nf>getInstance</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>INSTANCE</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 静态不可变的实例对象
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>EnumInstance</span> <span class=n>INSTANCE</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 自定义字段
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>private</span> <span class=n>String</span> <span class=n>field</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>EnumInstance</span> <span class=n>$VALUES</span><span class=o>[];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 在静态代码中进行初始化
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>static</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>INSTANCE</span> <span class=o>=</span> <span class=k>new</span> <span class=n>EnumInstance</span><span class=o>(</span><span class=s>&#34;INSTANCE&#34;</span><span class=o>,</span> <span class=mi>0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>$VALUES</span> <span class=o>=</span> <span class=o>(</span><span class=k>new</span> <span class=n>EnumInstance</span><span class=o>[]</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>INSTANCE</span>
</span></span><span class=line><span class=cl>        <span class=o>});</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>通过反编译工具可以看到其和饿汉式单例模式类似，因此它也是线程安全的。另外它也能防止序列化攻击和反射攻击：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>EnumInstanceTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 序列化攻击
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>EnumInstance</span> <span class=n>instance</span> <span class=o>=</span> <span class=n>EnumInstance</span><span class=o>.</span><span class=na>getInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>ObjectOutputStream</span> <span class=n>outputStream</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ObjectOutputStream</span><span class=o>(</span><span class=k>new</span> <span class=n>FileOutputStream</span><span class=o>(</span><span class=s>&#34;EnumSingletonFile&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>outputStream</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=n>instance</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>ObjectInputStream</span> <span class=n>inputStream</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ObjectInputStream</span><span class=o>(</span><span class=k>new</span> <span class=n>FileInputStream</span><span class=o>(</span><span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=s>&#34;EnumSingletonFile&#34;</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>        <span class=n>EnumInstance</span> <span class=n>newInstance</span> <span class=o>=</span> <span class=o>(</span><span class=n>EnumInstance</span><span class=o>)</span> <span class=n>inputStream</span><span class=o>.</span><span class=na>readObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>instance</span> <span class=o>==</span> <span class=n>newInstance</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 反射攻击，Enum类中只有一个两个参数的构造器：Enum(String name, int ordinal)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Constructor</span><span class=o>&lt;</span><span class=n>EnumInstance</span><span class=o>&gt;</span> <span class=n>constructor</span> <span class=o>=</span> <span class=n>EnumInstance</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getDeclaredConstructor</span><span class=o>(</span><span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=kt>int</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>constructor</span><span class=o>.</span><span class=na>setAccessible</span><span class=o>(</span><span class=kc>true</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>EnumInstance</span> <span class=n>enumInstance</span> <span class=o>=</span> <span class=n>constructor</span><span class=o>.</span><span class=na>newInstance</span><span class=o>(</span><span class=s>&#34;name&#34;</span><span class=o>,</span> <span class=mi>0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>instance</span> <span class=o>==</span> <span class=n>enumInstance</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>对于序列化与反序列化，枚举类单例能保证两次拿到的都是同一个实例。对于反射攻击，枚举类单例会抛出明确的异常：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Exception</span> <span class=n>in</span> <span class=n>thread</span> <span class=s>&#34;main&#34;</span> <span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>IllegalArgumentException</span><span class=o>:</span> <span class=n>Cannot</span> <span class=n>reflectively</span> <span class=n>create</span> <span class=kd>enum</span> <span class=n>objects</span>
</span></span><span class=line><span class=cl>    <span class=n>at</span> <span class=n>java</span><span class=o>.</span><span class=na>lang</span><span class=o>.</span><span class=na>reflect</span><span class=o>.</span><span class=na>Constructor</span><span class=o>.</span><span class=na>newInstance</span><span class=o>(</span><span class=n>Constructor</span><span class=o>.</span><span class=na>java</span><span class=o>:</span><span class=mi>417</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=n>at</span> <span class=n>com</span><span class=o>.</span><span class=na>heibaiying</span><span class=o>.</span><span class=na>creational</span><span class=o>.</span><span class=na>singleton</span><span class=o>.</span><span class=na>EnumInstanceTest</span><span class=o>.</span><span class=na>main</span><span class=o>(</span><span class=n>EnumInstanceTest</span><span class=o>.</span><span class=na>java</span><span class=o>:</span><span class=mi>18</span><span class=o>)</span>
</span></span></code></pre></div><h2 id=2-简单工厂模式>2. 简单工厂模式</h2><h3 id=21-定义>2.1 定义</h3><p>对于调用者来说，它无需知道对象的具体创建细节，只需要将自己所需对象的类型告诉工厂，然后由工厂自动创建并返回。</p><h3 id=22-示例>2.2 示例</h3><div align=center><img src=https://gitee.com/heibaiying/Full-Stack-Notes/raw/master/pictures/23_simple_factory.png></div><p>产品抽象类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>Phone</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>call</span><span class=o>(</span><span class=n>String</span> <span class=n>phoneNum</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>具体的产品：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HuaweiPhone</span> <span class=kd>extends</span> <span class=n>Phone</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>call</span><span class=o>(</span><span class=n>String</span> <span class=n>phoneNum</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;华为手机拨打电话：&#34;</span> <span class=o>+</span> <span class=n>phoneNum</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>XiaomiPhone</span> <span class=kd>extends</span> <span class=n>Phone</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>call</span><span class=o>(</span><span class=n>String</span> <span class=n>phoneNum</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;小米手机拨打电话：&#34;</span> <span class=o>+</span> <span class=n>phoneNum</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>手机工厂：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>PhoneFactory</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Phone</span> <span class=nf>getPhone</span><span class=o>(</span><span class=n>String</span> <span class=n>type</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=s>&#34;xiaomi&#34;</span><span class=o>.</span><span class=na>equalsIgnoreCase</span><span class=o>(</span><span class=n>type</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>new</span> <span class=n>XiaomiPhone</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=s>&#34;huawei&#34;</span><span class=o>.</span><span class=na>equalsIgnoreCase</span><span class=o>(</span><span class=n>type</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>new</span> <span class=n>HuaweiPhone</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>调用工厂类获取具体的实例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ZTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>PhoneFactory</span> <span class=n>phoneFactory</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PhoneFactory</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>phoneFactory</span><span class=o>.</span><span class=na>getPhone</span><span class=o>(</span><span class=s>&#34;xiaomi&#34;</span><span class=o>).</span><span class=na>call</span><span class=o>(</span><span class=s>&#34;123&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>phoneFactory</span><span class=o>.</span><span class=na>getPhone</span><span class=o>(</span><span class=s>&#34;huawei&#34;</span><span class=o>).</span><span class=na>call</span><span class=o>(</span><span class=s>&#34;321&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=23-优缺点>2.3 优缺点</h3><p>简单工厂的优点在于其向用户屏蔽了对象创建过程，使得用户可以不必关注具体的创建细节，其缺陷在于违背了开闭原则。在简单工厂模式中，如果想要增加新的产品，就需要修改简单工厂中的判断逻辑，这就违背了开闭原则，因此其并不属于 GOF 经典的 23 种设计模式。在 Java 语言中，可以通过泛型来尽量规避这一缺陷，此时可以将创建产品的方法修改为如下所示：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=n>Phone</span> <span class=nf>getPhone</span><span class=o>(</span><span class=n>Class</span><span class=o>&lt;?</span> <span class=kd>extends</span> <span class=n>Phone</span><span class=o>&gt;</span> <span class=n>phoneClass</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>(</span><span class=n>Phone</span><span class=o>)</span> <span class=n>Class</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=n>phoneClass</span><span class=o>.</span><span class=na>getName</span><span class=o>()).</span><span class=na>newInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>InstantiationException</span> <span class=o>|</span> <span class=n>IllegalAccessException</span> <span class=o>|</span> <span class=n>ClassNotFoundException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=3-工厂模式>3. 工厂模式</h2><h3 id=31-定义>3.1 定义</h3><p>定义一个用于创建对象的工厂接口，但具体实例化哪一个工厂则由子类来决定。</p><h3 id=32-示例>3.2 示例</h3><div align=center><img src=https://gitee.com/heibaiying/Full-Stack-Notes/raw/master/pictures/23_factory_method.png></div><p>产品抽象类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>Phone</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>call</span><span class=o>(</span><span class=n>String</span> <span class=n>phoneNum</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>产品实现类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HuaweiPhone</span> <span class=kd>extends</span> <span class=n>Phone</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>call</span><span class=o>(</span><span class=n>String</span> <span class=n>phoneNum</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;华为手机拨打电话：&#34;</span> <span class=o>+</span> <span class=n>phoneNum</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>XiaomiPhone</span> <span class=kd>extends</span> <span class=n>Phone</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>call</span><span class=o>(</span><span class=n>String</span> <span class=n>phoneNum</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;小米手机拨打电话：&#34;</span> <span class=o>+</span> <span class=n>phoneNum</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>工厂接口：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Factory</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Phone</span> <span class=nf>produce</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>工厂实现类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HuaweiPhoneFactory</span> <span class=kd>implements</span> <span class=n>Factory</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Phone</span> <span class=nf>produce</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>HuaweiPhone</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>XiaomiPhoneFactory</span> <span class=kd>implements</span> <span class=n>Factory</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Phone</span> <span class=nf>produce</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>XiaomiPhone</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>由调用者来决定实例化哪一个工厂对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ZTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>XiaomiPhoneFactory</span> <span class=n>xiaomiPhoneFactory</span> <span class=o>=</span> <span class=k>new</span> <span class=n>XiaomiPhoneFactory</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>xiaomiPhoneFactory</span><span class=o>.</span><span class=na>produce</span><span class=o>().</span><span class=na>call</span><span class=o>(</span><span class=s>&#34;123&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>HuaweiPhoneFactory</span> <span class=n>huaweiPhoneFactory</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HuaweiPhoneFactory</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>huaweiPhoneFactory</span><span class=o>.</span><span class=na>produce</span><span class=o>().</span><span class=na>call</span><span class=o>(</span><span class=s>&#34;456&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=33-优点>3.3 优点</h3><p>工厂模式的优点在于良好的封装性和可扩展性，如果想要增加新的产品（如：OppoPhone），只需要增加对应的工厂类即可，同时和简单工厂一样，它也向用户屏蔽了不相关的细节，使得系统的耦合度得以降低。</p><h2 id=4-抽象工厂模式>4. 抽象工厂模式</h2><h3 id=41-定义>4.1 定义</h3><p>提供一个创建一系列相关或相互依赖对象的接口，而无需指定它们具体的实现类。抽象工厂模式是工厂模式的升级版本，它适用于存在多个产品的情况。接着上面的例子，假设每个工厂不仅生产手机，而且还需要生产对应的充电器，这样才能算一个可以出售的产品，相关的代码示例如下：</p><h3 id=42-示例>4.2 示例</h3><div align=center><img src=https://gitee.com/heibaiying/Full-Stack-Notes/raw/master/pictures/23_abstract_factory.png></div><p>充电器抽象类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>Charger</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>Charge</span><span class=o>(</span><span class=n>Phone</span> <span class=n>phone</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>充电器实现类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HuaiweiCharger</span> <span class=kd>extends</span> <span class=n>Charger</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>Charge</span><span class=o>(</span><span class=n>Phone</span> <span class=n>phone</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;华为充电器给&#34;</span> <span class=o>+</span> <span class=n>phone</span> <span class=o>+</span> <span class=s>&#34;充电&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>XiaomiCharger</span> <span class=kd>extends</span> <span class=n>Charger</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>Charge</span><span class=o>(</span><span class=n>Phone</span> <span class=n>phone</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;小米充电器给&#34;</span> <span class=o>+</span> <span class=n>phone</span> <span class=o>+</span> <span class=s>&#34;充电&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>工厂接口：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Factory</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Phone</span> <span class=nf>producePhone</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>Charger</span> <span class=nf>produceCharger</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>工厂实现类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HuaweiPhoneFactory</span> <span class=kd>implements</span> <span class=n>Factory</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Phone</span> <span class=nf>producePhone</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>HuaweiPhone</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Charger</span> <span class=nf>produceCharger</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>HuaiweiCharger</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>XiaomiPhoneFactory</span> <span class=kd>implements</span> <span class=n>Factory</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Phone</span> <span class=nf>producePhone</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>XiaomiPhone</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Charger</span> <span class=nf>produceCharger</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>XiaomiCharger</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>调用具体的工厂实现类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ZTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>XiaomiPhoneFactory</span> <span class=n>xiaomiPhoneFactory</span> <span class=o>=</span> <span class=k>new</span> <span class=n>XiaomiPhoneFactory</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>xiaomiPhoneFactory</span><span class=o>.</span><span class=na>produceCharger</span><span class=o>().</span><span class=na>Charge</span><span class=o>(</span><span class=n>xiaomiPhoneFactory</span><span class=o>.</span><span class=na>producePhone</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>HuaweiPhoneFactory</span> <span class=n>huaweiPhoneFactory</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HuaweiPhoneFactory</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>huaweiPhoneFactory</span><span class=o>.</span><span class=na>produceCharger</span><span class=o>().</span><span class=na>Charge</span><span class=o>(</span><span class=n>huaweiPhoneFactory</span><span class=o>.</span><span class=na>producePhone</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=43-优缺点>4.3 优缺点</h3><p>抽象工厂模式继承了工厂模式的优点，能用于存在多个产品的情况，但其对应的产品族必须相对固定，假设我们现在认为 手机 + 充电器 + 耳机 才算一个可以对外出售的产品，则上面所有的工厂类都需要更改，但显然不是所有的手机都有配套的耳机，手机 + 充电器 这个产品族是相对固定的。</p><h2 id=5-构建者模式>5. 构建者模式</h2><h3 id=51-定义>5.1 定义</h3><p>将一个复杂对象的构造与它的表示分离，使同样的构建过程可以创建不同的表示。它将一个复杂对象的创建过程分解为多个简单的步骤，然后一步一步的组装完成。</p><h3 id=52-示例>5.2 示例</h3><div align=center><img src=https://gitee.com/heibaiying/Full-Stack-Notes/raw/master/pictures/23_builder.png></div><p>产品实体类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Phone</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/*处理器*/</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>processor</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=cm>/*摄像头*/</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>camera</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=cm>/*屏幕*/</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>screen</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>建造者抽象类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>Builder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=n>Phone</span> <span class=n>phone</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Phone</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=cm>/*安装处理器*/</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>addProcessor</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=cm>/*组装摄像头*/</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>addCamera</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=cm>/*安装屏幕*/</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>addScreen</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Phone</span> <span class=nf>produce</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>phone</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>建造者实现类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HuaweiBuilder</span> <span class=kd>extends</span> <span class=n>Builder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addProcessor</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>phone</span><span class=o>.</span><span class=na>setProcessor</span><span class=o>(</span><span class=s>&#34;海思麒麟处理器&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addCamera</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>phone</span><span class=o>.</span><span class=na>setCamera</span><span class=o>(</span><span class=s>&#34;莱卡摄像头&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addScreen</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>phone</span><span class=o>.</span><span class=na>setScreen</span><span class=o>(</span><span class=s>&#34;OLED&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>XiaomiBuilder</span> <span class=kd>extends</span> <span class=n>Builder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addProcessor</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>phone</span><span class=o>.</span><span class=na>setProcessor</span><span class=o>(</span><span class=s>&#34;高通骁龙处理器&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addCamera</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>phone</span><span class=o>.</span><span class=na>setCamera</span><span class=o>(</span><span class=s>&#34;索尼摄像头&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addScreen</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>phone</span><span class=o>.</span><span class=na>setScreen</span><span class=o>(</span><span class=s>&#34;OLED&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>定义管理者类（也称为导演类），由它来驱使具体的构建者按照指定的顺序完成构建过程：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Manager</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Builder</span> <span class=n>builder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Manager</span><span class=o>(</span><span class=n>Builder</span> <span class=n>builder</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>builder</span> <span class=o>=</span> <span class=n>builder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Phone</span> <span class=nf>buy</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>addCamera</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>addProcessor</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>addScreen</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>builder</span><span class=o>.</span><span class=na>produce</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>调用管理者类获取产品：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ZTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Phone</span> <span class=n>huawei</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Manager</span><span class=o>(</span><span class=k>new</span> <span class=n>HuaweiBuilder</span><span class=o>()).</span><span class=na>buy</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>huawei</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Phone</span> <span class=n>xiaomi</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Manager</span><span class=o>(</span><span class=k>new</span> <span class=n>XiaomiBuilder</span><span class=o>()).</span><span class=na>buy</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>xiaomi</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=c1>// 输出：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Phone</span><span class=o>(</span><span class=n>processor</span><span class=o>=</span><span class=err>海思麒麟处理器</span><span class=o>,</span> <span class=n>camera</span><span class=o>=</span><span class=err>莱卡摄像头</span><span class=o>,</span> <span class=n>screen</span><span class=o>=</span><span class=n>OLED</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=n>Phone</span><span class=o>(</span><span class=n>processor</span><span class=o>=</span><span class=err>高通骁龙处理器</span><span class=o>,</span> <span class=n>camera</span><span class=o>=</span><span class=err>索尼摄像头</span><span class=o>,</span> <span class=n>screen</span><span class=o>=</span><span class=n>OLED</span><span class=o>)</span>
</span></span></code></pre></div><h3 id=53-优点>5.3 优点</h3><p>建造者模式的优点在于将复杂的构建过程拆分为多个独立的单元，在保证拓展性的基础上也保证了良好的封装性，使得客户端不必知道产品的具体创建流程。</p><h2 id=6-原型模式>6. 原型模式</h2><h3 id=61-定义>6.1 定义</h3><p>用原型实例指定创建对象的种类，并通过拷贝这些原型创建新的对象。</p><h3 id=62-示例>6.2 示例</h3><p>在 Java 语言中可以通过 <code>clone()</code> 方法来实现原型模式：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Phone</span> <span class=kd>implements</span> <span class=n>Cloneable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>type</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Phone</span><span class=o>(</span><span class=n>String</span> <span class=n>type</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;构造器被调用&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>type</span> <span class=o>=</span> <span class=n>type</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>call</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>type</span> <span class=o>+</span> <span class=s>&#34;拨打电话&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=n>Object</span> <span class=nf>clone</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>CloneNotSupportedException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;克隆方法被调用&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kd>super</span><span class=o>.</span><span class=na>clone</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>使用克隆来创建对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Phone</span> <span class=n>phone</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Phone</span><span class=o>(</span><span class=s>&#34;3G手机&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>Phone</span> <span class=n>clonePhone</span> <span class=o>=</span> <span class=o>(</span><span class=n>Phone</span><span class=o>)</span> <span class=n>phone</span><span class=o>.</span><span class=na>clone</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>clonePhone</span><span class=o>.</span><span class=na>call</span><span class=o>();</span>
</span></span></code></pre></div><p>在使用 clone 方法时需要注意区分深拷贝和浅拷贝：即如果待拷贝的对象中含有引用类型的变量，也需要对其进行拷贝，示例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SmartPhone</span> <span class=kd>implements</span> <span class=n>Cloneable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>type</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Date</span> <span class=n>productionDate</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>SmartPhone</span><span class=o>(</span><span class=n>String</span> <span class=n>type</span><span class=o>,</span> <span class=n>Date</span> <span class=n>productionDate</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>type</span> <span class=o>=</span> <span class=n>type</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>productionDate</span> <span class=o>=</span> <span class=n>productionDate</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>call</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>type</span> <span class=o>+</span> <span class=s>&#34;拨打电话&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=n>Object</span> <span class=nf>clone</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>CloneNotSupportedException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SmartPhone</span> <span class=n>smartPhone</span> <span class=o>=</span> <span class=o>(</span><span class=n>SmartPhone</span><span class=o>)</span> <span class=kd>super</span><span class=o>.</span><span class=na>clone</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 对引用对象进行拷贝
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>smartPhone</span><span class=o>.</span><span class=na>productionDate</span> <span class=o>=</span> <span class=o>(</span><span class=n>Date</span><span class=o>)</span> <span class=n>smartPhone</span><span class=o>.</span><span class=na>productionDate</span><span class=o>.</span><span class=na>clone</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>smartPhone</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=63-适用场景>6.3 适用场景</h3><p>原型模式是直接在内存中进行二进制流的拷贝，被拷贝对象的构造函数并不会被执行，因此其性能表现非常优秀。如果对象的创建需要消耗非常多的资源，此时应该考虑使用原型模式。</p><h1 id=结构型>结构型</h1><h2 id=1-代理模式>1. 代理模式</h2><h3 id=11-定义>1.1 定义</h3><p>为目标对象提供一个代理对象以控制外部环境对其的访问，此时外部环境应访问该代理对象，而不是目标对象。通过代理模式，可以在不改变目标对象的情况下，实现功能的扩展。</p><p>在 Java 语言中，根据代理对象生成的时间点的不同可以分为静态代理和动态代理，其中动态代理根据实现方式的不同又可以分为 JDK 代理 和 Cglib 代理。</p><h3 id=12-静态代理>1.2 静态代理</h3><p>此时代理对象和目标对象需要实现相同的接口：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>IService</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>compute</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>目标对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ComputeService</span> <span class=kd>implements</span> <span class=n>IService</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>compute</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;业务处理&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>在代理对象中注入目标对象的实例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ProxyService</span> <span class=kd>implements</span> <span class=n>IService</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>IService</span> <span class=n>target</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>ProxyService</span><span class=o>(</span><span class=n>IService</span> <span class=n>target</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>target</span> <span class=o>=</span> <span class=n>target</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>compute</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;权限校验&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>target</span><span class=o>.</span><span class=na>compute</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;资源回收&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>调用时候应该访问代理对象，而不是目标对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>ProxyService</span> <span class=n>proxyService</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ProxyService</span><span class=o>(</span><span class=k>new</span> <span class=n>ComputeService</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=n>proxyService</span><span class=o>.</span><span class=na>compute</span><span class=o>();</span>
</span></span></code></pre></div><h3 id=13-jdk-代理>1.3 JDK 代理</h3><p>除了使用静态代理外，还可以利用 JDK 中的 Proxy 类和反射功能来实现对目标对象的代理：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>ComputeService</span> <span class=n>target</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ComputeService</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>IService</span> <span class=n>proxyInstance</span> <span class=o>=</span> <span class=o>(</span><span class=n>IService</span><span class=o>)</span> <span class=n>Proxy</span><span class=o>.</span><span class=na>newProxyInstance</span><span class=o>(</span>
</span></span><span class=line><span class=cl>    <span class=n>target</span><span class=o>.</span><span class=na>getClass</span><span class=o>().</span><span class=na>getClassLoader</span><span class=o>(),</span>
</span></span><span class=line><span class=cl>    <span class=n>target</span><span class=o>.</span><span class=na>getClass</span><span class=o>().</span><span class=na>getInterfaces</span><span class=o>(),</span> <span class=c1>//代理类要实现的接口列表
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>(</span><span class=n>proxy</span><span class=o>,</span> <span class=n>method</span><span class=o>,</span> <span class=n>args1</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;权限校验&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Object</span> <span class=n>invoke</span> <span class=o>=</span> <span class=n>method</span><span class=o>.</span><span class=na>invoke</span><span class=o>(</span><span class=n>target</span><span class=o>,</span> <span class=n>args1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;资源回收&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>invoke</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>});</span>
</span></span><span class=line><span class=cl><span class=n>proxyInstance</span><span class=o>.</span><span class=na>compute</span><span class=o>();</span>
</span></span></code></pre></div><p>静态代理和 JDK 动态代理都要求目标对象必须实现一个或者多个接口，如果目标对象不存在任何接口，此时可以使用 Cglib 方式对其进行代理。</p><h3 id=14-cglib-代理>1.4 Cglib 代理</h3><p>要想使用 Cglib 代理，必须导入相关的依赖：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>cglib<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>cglib<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>3.3.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>此时目标对象不需要实现任何接口：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ComputeService</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>compute</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;业务处理&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>使用 Cglib 进行代理：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Proxy</span> <span class=kd>implements</span> <span class=n>MethodInterceptor</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Object</span> <span class=n>target</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Proxy</span><span class=o>(</span><span class=n>Object</span> <span class=n>target</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>target</span> <span class=o>=</span> <span class=n>target</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Object</span> <span class=nf>getProxyInstance</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 创建用于生成生成动态子类的工具类
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Enhancer</span> <span class=n>enhancer</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Enhancer</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 指定动态生成类的父类
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>enhancer</span><span class=o>.</span><span class=na>setSuperclass</span><span class=o>(</span><span class=n>target</span><span class=o>.</span><span class=na>getClass</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 设置回调
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>enhancer</span><span class=o>.</span><span class=na>setCallback</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 动态生成子类
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=n>enhancer</span><span class=o>.</span><span class=na>create</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>    * 我们只需要实现此处的拦截逻辑，其他代码都是相对固定的
</span></span></span><span class=line><span class=cl><span class=cm>    */</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Object</span> <span class=nf>intercept</span><span class=o>(</span><span class=n>Object</span> <span class=n>obj</span><span class=o>,</span> <span class=n>Method</span> <span class=n>method</span><span class=o>,</span> <span class=n>Object</span><span class=o>[]</span> <span class=n>args</span><span class=o>,</span> <span class=n>MethodProxy</span> <span class=n>proxy</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>InvocationTargetException</span><span class=o>,</span> <span class=n>IllegalAccessException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;权限校验&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Object</span> <span class=n>invoke</span> <span class=o>=</span> <span class=n>method</span><span class=o>.</span><span class=na>invoke</span><span class=o>(</span><span class=n>target</span><span class=o>,</span> <span class=n>args</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;资源回收&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>invoke</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>访问代理对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Proxy</span> <span class=n>proxy</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Proxy</span><span class=o>(</span><span class=k>new</span> <span class=n>ComputeService</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=n>ComputeService</span> <span class=n>service</span> <span class=o>=</span> <span class=o>(</span><span class=n>ComputeService</span><span class=o>)</span> <span class=n>proxy</span><span class=o>.</span><span class=na>getProxyInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>service</span><span class=o>.</span><span class=na>compute</span><span class=o>();</span>
</span></span></code></pre></div><h2 id=2-适配器模式>2. 适配器模式</h2><h3 id=21-定义-1>2.1 定义</h3><p>将一个类的接口转换成客户希望的另外一个接口，从而使得原本由于接口不兼容而无法一起工作的类可以一起工作。</p><h3 id=22-示例-1>2.2 示例</h3><p>将 220V 的电流通过适配器转换为对应规格的电流给手机充电：</p><div align=center><img src=https://gitee.com/heibaiying/Full-Stack-Notes/raw/master/pictures\23_adapter.png></div><p>电源类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>PowerSupply</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>output</span> <span class=o>=</span> <span class=mi>220</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>output220V</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;电源电压：&#34;</span> <span class=o>+</span> <span class=n>output</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>output</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>手机电压规格：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Target</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=nf>output5V</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>适配器需要继承自源类，并实现目标类接口：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ChargerAdapter</span> <span class=kd>extends</span> <span class=n>PowerSupply</span> <span class=kd>implements</span> <span class=n>Target</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>output5V</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>output</span> <span class=o>=</span> <span class=n>output220V</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;充电头适配转换&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>output</span> <span class=o>=</span> <span class=n>output</span> <span class=o>/</span> <span class=mi>44</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;输出电压：&#34;</span> <span class=o>+</span> <span class=n>output</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>output</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>测试：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ZTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Target</span> <span class=n>target</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ChargerAdapter</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>target</span><span class=o>.</span><span class=na>output5V</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 输出：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>电源电压：</span><span class=mi>220</span>
</span></span><span class=line><span class=cl><span class=err>充电头适配转换</span>
</span></span><span class=line><span class=cl><span class=err>输出电压：</span><span class=mi>5</span>
</span></span></code></pre></div><h2 id=3-桥接模式>3. 桥接模式</h2><h3 id=31-定义-1>3.1 定义</h3><p>将抽象部分与它的实现部分分离，使它们都可以独立地变化。它使用组合关系来代替继承关系，从而降低了抽象和实现这两个可变维度的耦合度。</p><h3 id=32-优点>3.2 优点</h3><ul><li>抽象和实现分离；</li><li>优秀的扩展能力；</li><li>实现细节对客户端透明，客户可以通过各种聚合来实现不同的需求。</li></ul><h3 id=33-示例>3.3 示例</h3><p>将一个图形的形状和颜色进行分离，从而可以通过组合来实现的不同的效果：</p><div align=center><img src=https://gitee.com/heibaiying/Full-Stack-Notes/raw/master/pictures\23_bridge.png></div><p>颜色的抽象和实现：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Color</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=nf>getDesc</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Blue</span> <span class=kd>implements</span> <span class=n>Color</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getDesc</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;蓝色&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Red</span> <span class=kd>implements</span> <span class=n>Color</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getDesc</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;红色&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Yellow</span> <span class=kd>implements</span> <span class=n>Color</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getDesc</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;黄色&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>图形的抽象和实现：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>Shape</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Color</span> <span class=n>color</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Shape</span> <span class=nf>setColor</span><span class=o>(</span><span class=n>Color</span> <span class=n>color</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>color</span> <span class=o>=</span> <span class=n>color</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Color</span> <span class=nf>getColor</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>color</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>getDesc</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Round</span> <span class=kd>extends</span> <span class=n>Shape</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>getDesc</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>getColor</span><span class=o>().</span><span class=na>getDesc</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34;圆形&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Square</span> <span class=kd>extends</span> <span class=n>Shape</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>getDesc</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>getColor</span><span class=o>().</span><span class=na>getDesc</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34;正方形&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>通过聚合的方式来进行调用：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>new</span> <span class=n>Square</span><span class=o>().</span><span class=na>setColor</span><span class=o>(</span><span class=k>new</span> <span class=n>Red</span><span class=o>()).</span><span class=na>getDesc</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=k>new</span> <span class=n>Square</span><span class=o>().</span><span class=na>setColor</span><span class=o>(</span><span class=k>new</span> <span class=n>Blue</span><span class=o>()).</span><span class=na>getDesc</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=k>new</span> <span class=n>Round</span><span class=o>().</span><span class=na>setColor</span><span class=o>(</span><span class=k>new</span> <span class=n>Blue</span><span class=o>()).</span><span class=na>getDesc</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=k>new</span> <span class=n>Round</span><span class=o>().</span><span class=na>setColor</span><span class=o>(</span><span class=k>new</span> <span class=n>Yellow</span><span class=o>()).</span><span class=na>getDesc</span><span class=o>();</span>
</span></span></code></pre></div><h2 id=4-组合模式>4. 组合模式</h2><h3 id=41-定义-1>4.1 定义</h3><p>将对象组合成树形结构以表示 “部分-整体” 的层次结构，组合模式使得用户对单个对象和组合对象的使用具有一致性。</p><h3 id=42-优点>4.2 优点</h3><ul><li><p>单个对象和组合对象具有一致性，这简化了客户端代码；</p></li><li><p>可以在组合体类加入新的对象，而无需改变其源码。</p></li></ul><h3 id=43-示例>4.3 示例</h3><p>模拟 Linux 文件系统：</p><div align=center><img src=https://gitee.com/heibaiying/Full-Stack-Notes/raw/master/pictures\23_composite.png></div><p>组件类，定义文件夹和文件的所有操作：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>Component</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Component</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>add</span><span class=o>(</span><span class=n>Component</span> <span class=n>component</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>UnsupportedOperationException</span><span class=o>(</span><span class=s>&#34;不支持添加操作&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>remove</span><span class=o>(</span><span class=n>Component</span> <span class=n>component</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>UnsupportedOperationException</span><span class=o>(</span><span class=s>&#34;不支持删除操作&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>vim</span><span class=o>(</span><span class=n>String</span> <span class=n>content</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>UnsupportedOperationException</span><span class=o>(</span><span class=s>&#34;不支持使用vim编辑器打开&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>cat</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>UnsupportedOperationException</span><span class=o>(</span><span class=s>&#34;不支持查看操作&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>print</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>UnsupportedOperationException</span><span class=o>(</span><span class=s>&#34;不支持打印操作&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>文件夹类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Folder</span> <span class=kd>extends</span> <span class=n>Component</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Component</span><span class=o>&gt;</span> <span class=n>componentList</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Folder</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>add</span><span class=o>(</span><span class=n>Component</span> <span class=n>component</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>componentList</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>component</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>remove</span><span class=o>(</span><span class=n>Component</span> <span class=n>component</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>componentList</span><span class=o>.</span><span class=na>remove</span><span class=o>(</span><span class=n>component</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>print</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>getName</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>componentList</span><span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>x</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;    &#34;</span> <span class=o>+</span> <span class=n>x</span><span class=o>.</span><span class=na>getName</span><span class=o>()));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>文件类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>File</span> <span class=kd>extends</span> <span class=n>Component</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>content</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>File</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>vim</span><span class=o>(</span><span class=n>String</span> <span class=n>content</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>content</span> <span class=o>=</span> <span class=n>content</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>cat</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>content</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>print</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>getName</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>通过组合来实现层级结构：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Folder</span> <span class=n>rootDir</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Folder</span><span class=o>(</span><span class=s>&#34;ROOT目录&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>Folder</span> <span class=n>nginx</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Folder</span><span class=o>(</span><span class=s>&#34;Nginx安装目录&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>Folder</span> <span class=n>tomcat</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Folder</span><span class=o>(</span><span class=s>&#34;Tomcat安装目录&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>File</span> <span class=n>startup</span> <span class=o>=</span> <span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=s>&#34;startup.bat&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>rootDir</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>nginx</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>rootDir</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>tomcat</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>rootDir</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>startup</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>rootDir</span><span class=o>.</span><span class=na>print</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>startup</span><span class=o>.</span><span class=na>vim</span><span class=o>(</span><span class=s>&#34;java -jar&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>startup</span><span class=o>.</span><span class=na>cat</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>nginx</span><span class=o>.</span><span class=na>cat</span><span class=o>();</span>
</span></span></code></pre></div><h2 id=5-装饰模式>5. 装饰模式</h2><h3 id=51-定义-1>5.1 定义</h3><p>在不改变现有对象结构的情况下，动态地给该对象增加一些职责或功能。</p><h3 id=52-优点>5.2 优点</h3><ul><li>采用装饰模式扩展对象的功能比采用继承方式更加灵活。</li><li>可以通过设计多个不同的装饰类，来创造出多个不同行为的组合。</li></ul><h3 id=53-示例>5.3 示例</h3><p>在购买手机后，你可能还会购买屏幕保护膜，手机壳等来进行装饰：</p><div align=center><img src=https://gitee.com/heibaiying/Full-Stack-Notes/raw/master/pictures\23_decorator.png></div><p>手机抽象类及其实现：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>Phone</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>int</span> <span class=nf>getPrice</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=n>String</span>  <span class=nf>getDesc</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MiPhone</span> <span class=kd>extends</span> <span class=n>Phone</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>getPrice</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1999</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getDesc</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;MiPhone&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>装饰器抽象类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>Decorator</span> <span class=kd>extends</span> <span class=n>Phone</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Phone</span> <span class=n>phone</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Decorator</span><span class=o>(</span><span class=n>Phone</span> <span class=n>phone</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>phone</span> <span class=o>=</span> <span class=n>phone</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>getPrice</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>phone</span><span class=o>.</span><span class=na>getPrice</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getDesc</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>phone</span><span class=o>.</span><span class=na>getDesc</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>手机壳装饰器：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ShellDecorator</span> <span class=kd>extends</span> <span class=n>Decorator</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>ShellDecorator</span><span class=o>(</span><span class=n>Phone</span> <span class=n>phone</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>phone</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>getPrice</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kd>super</span><span class=o>.</span><span class=na>getPrice</span><span class=o>()</span> <span class=o>+</span> <span class=mi>200</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getDesc</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kd>super</span><span class=o>.</span><span class=na>getDesc</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34; + 手机壳&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>屏幕保护膜装饰器：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>FilmDecorator</span> <span class=kd>extends</span> <span class=n>Decorator</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>FilmDecorator</span><span class=o>(</span><span class=n>Phone</span> <span class=n>phone</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>phone</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>getPrice</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kd>super</span><span class=o>.</span><span class=na>getPrice</span><span class=o>()</span> <span class=o>+</span> <span class=mi>100</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getDesc</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kd>super</span><span class=o>.</span><span class=na>getDesc</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34; + 钢化膜&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>调用装饰器对目标对象进行装饰：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ZTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ShellDecorator</span> <span class=n>decorator</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ShellDecorator</span><span class=o>(</span><span class=k>new</span> <span class=n>FilmDecorator</span><span class=o>(</span><span class=k>new</span> <span class=n>MiPhone</span><span class=o>()));</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>decorator</span><span class=o>.</span><span class=na>getDesc</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34; : &#34;</span> <span class=o>+</span> <span class=n>decorator</span><span class=o>.</span><span class=na>getPrice</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 输出： MiPhone + 钢化膜 + 手机壳 : 2299
</span></span></span></code></pre></div><h2 id=6-外观模式>6. 外观模式</h2><h3 id=61-定义-1>6.1 定义</h3><p>在现在流行的微服务架构模式下，我们通常会将一个大型的系统拆分为多个独立的服务，此时需要提供一个一致性的接口来给外部系统进行调用，这就是外观模式的一种体现。</p><h3 id=62-优点>6.2 优点</h3><ul><li>降低了子系统和客户端之间的耦合度；</li><li>对客户端屏蔽了系统内部的实现细节。</li></ul><h3 id=63-示例>6.3 示例</h3><p>模仿电商购物下单，此时内部需要调用支付子系统，仓储子系统，物流子系统，而这些细节对用户都是屏蔽的：</p><div align=center><img src=https://gitee.com/heibaiying/Full-Stack-Notes/raw/master/pictures\23_facade.png></div><p>安全检查系统：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>EnvInspectionService</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>evInspection</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;支付环境检查...&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>支付子系统：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>AccountService</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>balanceCheck</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;账户余额校验...&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>物流子系统：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>LogisticsService</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>ship</span><span class=o>(</span><span class=n>Phone</span> <span class=n>phone</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>phone</span><span class=o>.</span><span class=na>getName</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34;已经发货，请注意查收...&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>下单系统（外观门面）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>OrderService</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>EnvInspectionService</span> <span class=n>inspectionService</span> <span class=o>=</span> <span class=k>new</span> <span class=n>EnvInspectionService</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>AccountService</span> <span class=n>accountService</span> <span class=o>=</span> <span class=k>new</span> <span class=n>AccountService</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>LogisticsService</span> <span class=n>logisticsService</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LogisticsService</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>order</span><span class=o>(</span><span class=n>Phone</span> <span class=n>phone</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>inspectionService</span><span class=o>.</span><span class=na>evInspection</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>accountService</span><span class=o>.</span><span class=na>balanceCheck</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;支付成功&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                <span class=n>logisticsService</span><span class=o>.</span><span class=na>ship</span><span class=o>(</span><span class=n>phone</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>用户只需要访问外观门面，调用下单接口即可：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Phone</span> <span class=n>phone</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Phone</span><span class=o>(</span><span class=s>&#34;XXX手机&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>OrderService</span> <span class=n>orderService</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OrderService</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>orderService</span><span class=o>.</span><span class=na>order</span><span class=o>(</span><span class=n>phone</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 输出：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>支付环境检查</span><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=err>账户余额校验</span><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=err>支付成功</span>
</span></span><span class=line><span class=cl><span class=n>XXX</span><span class=err>手机已经发货，请注意查收</span><span class=o>...</span>
</span></span></code></pre></div><h2 id=7-享元模式>7. 享元模式</h2><h3 id=71-定义>7.1 定义</h3><p>运用共享技术来有效地支持大量细粒度对象的复用，线程池，缓存技术都是其代表性的实现。在享元模式中存在以下两种状态：</p><ul><li>内部状态，即不会随着环境的改变而改变状态，它在对象初始化时就已经确定；</li><li>外部状态，指可以随环境改变而改变的状态。</li></ul><p>通过享元模式，可以避免在系统中创建大量重复的对象，进而可以节省系统的内存空间。</p><h3 id=72-示例>7.2 示例</h3><p>这里以创建 PPT 模板为例，相同类型的 PPT 模板不再重复创建：</p><div align=center><img src=https://gitee.com/heibaiying/Full-Stack-Notes/raw/master/pictures\23_flyweight.png></div><p>PPT 抽象类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>PowerPoint</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/*版权*/</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>copyright</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>title</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/*这里的版权信息是一种内部状态，它在PPT对象第一次创建时就已经确定*/</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>PowerPoint</span><span class=o>(</span><span class=n>String</span> <span class=n>copyright</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>copyright</span> <span class=o>=</span> <span class=n>copyright</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/*PPT标题是一种外部状态，它可以由外部环境根据不同的需求进行更改*/</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setTitle</span><span class=o>(</span><span class=n>String</span> <span class=n>title</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>title</span> <span class=o>=</span> <span class=n>title</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>create</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;编号：&#34;</span> <span class=o>+</span> <span class=n>hashCode</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34;: PowerPoint{&#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;copyright=&#39;&#34;</span> <span class=o>+</span> <span class=n>copyright</span> <span class=o>+</span> <span class=sc>&#39;\&#39;&#39;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;, title=&#39;&#34;</span> <span class=o>+</span> <span class=n>title</span> <span class=o>+</span> <span class=sc>&#39;\&#39;&#39;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>            <span class=sc>&#39;}&#39;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>PPT 实现类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>BusinessPPT</span> <span class=kd>extends</span> <span class=n>PowerPoint</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>BusinessPPT</span><span class=o>(</span><span class=n>String</span> <span class=n>copyright</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>copyright</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>create</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;商务类PPT模板&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SciencePPT</span> <span class=kd>extends</span> <span class=n>PowerPoint</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>SciencePPT</span><span class=o>(</span><span class=n>String</span> <span class=n>copyright</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>copyright</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>create</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;科技类PPT模板&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ArtPPT</span> <span class=kd>extends</span> <span class=n>PowerPoint</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>ArtPPT</span><span class=o>(</span><span class=n>String</span> <span class=n>copyright</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>copyright</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>create</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;艺术类PPT模板&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>通过工厂模式来进行创建和共享：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>PPTFactory</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>PowerPoint</span><span class=o>&gt;</span> <span class=n>hashMap</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>PowerPoint</span> <span class=nf>getPPT</span><span class=o>(</span><span class=n>Class</span><span class=o>&lt;?</span> <span class=kd>extends</span> <span class=n>PowerPoint</span><span class=o>&gt;</span> <span class=n>clazz</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>String</span> <span class=n>name</span> <span class=o>=</span> <span class=n>clazz</span><span class=o>.</span><span class=na>getName</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>hashMap</span><span class=o>.</span><span class=na>keySet</span><span class=o>().</span><span class=na>contains</span><span class=o>(</span><span class=n>name</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>hashMap</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=n>Constructor</span><span class=o>&lt;?&gt;</span> <span class=n>constructor</span> <span class=o>=</span> <span class=n>Class</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=n>name</span><span class=o>).</span><span class=na>getConstructor</span><span class=o>(</span><span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>PowerPoint</span> <span class=n>powerPoint</span> <span class=o>=</span> <span class=o>(</span><span class=n>PowerPoint</span><span class=o>)</span> <span class=n>constructor</span><span class=o>.</span><span class=na>newInstance</span><span class=o>(</span><span class=s>&#34;PPT工厂版本所有&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>hashMap</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>name</span><span class=o>,</span> <span class=n>powerPoint</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>powerPoint</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>调用工厂类来创建或获取享元对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ZTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>PPTFactory</span> <span class=n>pptFactory</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PPTFactory</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>PowerPoint</span> <span class=n>ppt01</span> <span class=o>=</span> <span class=n>pptFactory</span><span class=o>.</span><span class=na>getPPT</span><span class=o>(</span><span class=n>BusinessPPT</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>ppt01</span><span class=o>.</span><span class=na>setTitle</span><span class=o>(</span><span class=s>&#34;第一季度工作汇报&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>ppt01</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>PowerPoint</span> <span class=n>ppt02</span> <span class=o>=</span> <span class=n>pptFactory</span><span class=o>.</span><span class=na>getPPT</span><span class=o>(</span><span class=n>BusinessPPT</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>ppt02</span><span class=o>.</span><span class=na>setTitle</span><span class=o>(</span><span class=s>&#34;第二季度工作汇报&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>ppt02</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>PowerPoint</span> <span class=n>ppt03</span> <span class=o>=</span> <span class=n>pptFactory</span><span class=o>.</span><span class=na>getPPT</span><span class=o>(</span><span class=n>SciencePPT</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>ppt03</span><span class=o>.</span><span class=na>setTitle</span><span class=o>(</span><span class=s>&#34;科技展汇报&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>ppt03</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 输出：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>编号：</span><span class=mi>1744347043</span><span class=o>:</span> <span class=n>PowerPoint</span><span class=o>{</span><span class=n>copyright</span><span class=o>=</span><span class=err>&#39;</span><span class=n>PPT</span><span class=err>工厂版本所有&#39;</span><span class=o>,</span> <span class=n>title</span><span class=o>=</span><span class=err>&#39;第一季度工作汇报&#39;</span><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=err>编号：</span><span class=mi>1744347043</span><span class=o>:</span> <span class=n>PowerPoint</span><span class=o>{</span><span class=n>copyright</span><span class=o>=</span><span class=err>&#39;</span><span class=n>PPT</span><span class=err>工厂版本所有&#39;</span><span class=o>,</span> <span class=n>title</span><span class=o>=</span><span class=err>&#39;第二季度工作汇报&#39;</span><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=err>编号：</span><span class=mi>662441761</span><span class=o>:</span> <span class=n>PowerPoint</span><span class=o>{</span><span class=n>copyright</span><span class=o>=</span><span class=err>&#39;</span><span class=n>PPT</span><span class=err>工厂版本所有&#39;</span><span class=o>,</span> <span class=n>title</span><span class=o>=</span><span class=err>&#39;科技展汇报&#39;</span><span class=o>}</span>
</span></span></code></pre></div><h1 id=行为型>行为型</h1><h2 id=1-观察者模式>1. 观察者模式</h2><h3 id=11-定义-1>1.1 定义</h3><p>定义对象间一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新。</p><h3 id=12-优点>1.2 优点</h3><p>降低了目标对象和观察者之间的耦合。</p><h3 id=13-示例>1.3 示例</h3><p>假设多个用户都关注某一个商家，当商家发出降价等通知时，所有用户都应该收到：</p><div align=center><img src=https://gitee.com/heibaiying/Full-Stack-Notes/raw/master/pictures/23_observer.png></div><p>被观察者接口及商家实现类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Observable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 接收观察者
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>void</span> <span class=nf>addObserver</span><span class=o>(</span><span class=n>Observer</span> <span class=n>observer</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 移除观察者
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>void</span> <span class=nf>removeObserver</span><span class=o>(</span><span class=n>Observer</span> <span class=n>observer</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 通知观察者
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>void</span> <span class=nf>notifyObservers</span><span class=o>(</span><span class=n>String</span> <span class=n>message</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Business</span> <span class=kd>implements</span> <span class=n>Observable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Observer</span><span class=o>&gt;</span> <span class=n>observerList</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addObserver</span><span class=o>(</span><span class=n>Observer</span> <span class=n>observer</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>observerList</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>observer</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>removeObserver</span><span class=o>(</span><span class=n>Observer</span> <span class=n>observer</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>observerList</span><span class=o>.</span><span class=na>remove</span><span class=o>(</span><span class=n>observer</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>notifyObservers</span><span class=o>(</span><span class=n>String</span> <span class=n>message</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=n>Observer</span> <span class=n>observer</span> <span class=o>:</span> <span class=n>observerList</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>observer</span><span class=o>.</span><span class=na>receive</span><span class=o>(</span><span class=n>message</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>观察者接口及用户实现类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Observer</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>receive</span><span class=o>(</span><span class=n>String</span> <span class=n>message</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>User</span> <span class=kd>implements</span> <span class=n>Observer</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>User</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>receive</span><span class=o>(</span><span class=n>String</span> <span class=n>message</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>getName</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34;收到消息：&#34;</span> <span class=o>+</span> <span class=n>message</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>测试商户发送消息：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Business</span> <span class=n>business</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Business</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>business</span><span class=o>.</span><span class=na>addObserver</span><span class=o>(</span><span class=k>new</span> <span class=n>User</span><span class=o>(</span><span class=s>&#34;用户1&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=n>business</span><span class=o>.</span><span class=na>addObserver</span><span class=o>(</span><span class=k>new</span> <span class=n>User</span><span class=o>(</span><span class=s>&#34;用户2&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=n>business</span><span class=o>.</span><span class=na>addObserver</span><span class=o>(</span><span class=k>new</span> <span class=n>User</span><span class=o>(</span><span class=s>&#34;用户3&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=n>business</span><span class=o>.</span><span class=na>notifyObservers</span><span class=o>(</span><span class=s>&#34;商品促销通知&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 输出：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>用户</span><span class=mi>1</span><span class=err>收到消息：商品促销通知</span>
</span></span><span class=line><span class=cl><span class=err>用户</span><span class=mi>2</span><span class=err>收到消息：商品促销通知</span>
</span></span><span class=line><span class=cl><span class=err>用户</span><span class=mi>3</span><span class=err>收到消息：商品促销通知</span>
</span></span></code></pre></div><h2 id=2-责任链模式>2. 责任链模式</h2><h3 id=21-定义-2>2.1 定义</h3><p>使多个对象都有机会处理请求，从而避免请求的发送者和接受者之间的耦合关系。将这些对象连接成一条链，并沿着这条链传递该请求，直到有一个对象处理完它为止。</p><h3 id=22-优点>2.2 优点</h3><ul><li>降低了对象之间的耦合度；</li><li>增强了系统的可扩展性。可以根据需求增加新的处理类，满足开闭原则；</li><li>增强了系统的灵活性。当工作流程发生变化，可以动态地新增，删除成员或修改其调动次序；</li><li>每个对象只需保持一个指向其后继者的引用，而无需保持其他所有处理者的引用，从而可以避免了过多的条件判断语句；</li><li>每个类只需要处理自己该处理的工作，不能处理的则传递给下一个对象完成，符合类的单一职责原则。</li></ul><h3 id=23-示例>2.3 示例</h3><p>假设一个正常的流程，根据请假天数的不同，需要不同的领导共同审批：</p><div align=center><img src=https://gitee.com/heibaiying/Full-Stack-Notes/raw/master/pictures\23_chain_of_responsibility.png></div><p>申请单：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Application</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>title</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=cm>/*请假天数*/</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>dayNum</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>抽象的领导类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>Leader</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=n>Leader</span> <span class=n>leader</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 责任链模式的核心：其需要持有一个后继者
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=n>Leader</span> <span class=nf>setNextLeader</span><span class=o>(</span><span class=n>Leader</span> <span class=n>leader</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>leader</span> <span class=o>=</span> <span class=n>leader</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>leader</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>approval</span><span class=o>(</span><span class=n>Application</span> <span class=n>application</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>3 天以下的请假只需要组长审核即可：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>GroupLeader</span> <span class=kd>extends</span> <span class=n>Leader</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>approval</span><span class=o>(</span><span class=n>Application</span> <span class=n>application</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>application</span><span class=o>.</span><span class=na>getTitle</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34;被组长审批通过&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>application</span><span class=o>.</span><span class=na>getDayNum</span><span class=o>()</span> <span class=o>&gt;=</span> <span class=mi>3</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>leader</span><span class=o>.</span><span class=na>approval</span><span class=o>(</span><span class=n>application</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>3 天以上 5 天以下的请假则需要组长和部门经理共同审核：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>DepartManager</span> <span class=kd>extends</span> <span class=n>Leader</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>approval</span><span class=o>(</span><span class=n>Application</span> <span class=n>application</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>application</span><span class=o>.</span><span class=na>getTitle</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34;被部门经理审批通过&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>application</span><span class=o>.</span><span class=na>getDayNum</span><span class=o>()</span> <span class=o>&gt;=</span> <span class=mi>5</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>leader</span><span class=o>.</span><span class=na>approval</span><span class=o>(</span><span class=n>application</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>5 天以上的请假则还需要总经理审核：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>President</span> <span class=kd>extends</span> <span class=n>Leader</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>approval</span><span class=o>(</span><span class=n>Application</span> <span class=n>application</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>application</span><span class=o>.</span><span class=na>getTitle</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34;被总经理审批通过&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>组建责任链并测试：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>GroupLeader</span> <span class=n>groupLeader</span> <span class=o>=</span> <span class=k>new</span> <span class=n>GroupLeader</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>DepartManager</span> <span class=n>departManager</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DepartManager</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>President</span> <span class=n>president</span> <span class=o>=</span> <span class=k>new</span> <span class=n>President</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>groupLeader</span><span class=o>.</span><span class=na>setNextLeader</span><span class=o>(</span><span class=n>departManager</span><span class=o>).</span><span class=na>setNextLeader</span><span class=o>(</span><span class=n>president</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>groupLeader</span><span class=o>.</span><span class=na>approval</span><span class=o>(</span><span class=k>new</span> <span class=n>Application</span><span class=o>(</span><span class=s>&#34;事假单&#34;</span><span class=o>,</span> <span class=mi>3</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=n>groupLeader</span><span class=o>.</span><span class=na>approval</span><span class=o>(</span><span class=k>new</span> <span class=n>Application</span><span class=o>(</span><span class=s>&#34;婚假单&#34;</span><span class=o>,</span> <span class=mi>10</span><span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 输出：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>事假单被组长审批通过</span>
</span></span><span class=line><span class=cl><span class=err>事假单被部门经理审批通过</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>婚假单被组长审批通过</span>
</span></span><span class=line><span class=cl><span class=err>婚假单被部门经理审批通过</span>
</span></span><span class=line><span class=cl><span class=err>婚假单被总经理审批通过</span>
</span></span></code></pre></div><h2 id=3-模板方法模式>3. 模板方法模式</h2><h3 id=31-定义-2>3.1 定义</h3><p>定义一个操作的算法骨架，而将算法的一些步骤延迟到子类中，使得子类可以不改变该算法结构的情况下重定义该算法的某些特定步骤。它通常包含以下角色：</p><p><strong>抽象父类</strong> <strong>(Abstract Class)</strong>：负责给出一个算法的轮廓和骨架。它由一个模板方法和若干个基本方法构成：</p><ul><li>模板方法：定义了算法的骨架，按某种顺序调用其包含的基本方法。</li><li>基本方法：可以是具体的方法也可以是抽象方法，还可以是钩子方法（在抽象类中已经实现，包括用于判断的逻辑方法和需要子类重写的空方法两种）。</li></ul><p><strong>具体子类</strong> <strong>(Concrete Class)</strong>：实现抽象类中所定义的抽象方法和钩子方法。</p><h3 id=32-优点-1>3.2 优点</h3><ul><li>父类定义了公共的行为，可以实现代码的复用；</li><li>子类可以通过扩展来增加相应的功能，符合开闭原则。</li></ul><h3 id=33-示例-1>3.3 示例</h3><p>手机一般都有电池，摄像头等模块，但不是所有手机都有 NFC 模块，如果采用模板模式构建，则相关代码如下：</p><div align=center><img src=https://gitee.com/heibaiying/Full-Stack-Notes/raw/master/pictures\23_template.png></div><p>抽象的父类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>Phone</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 模板方法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>assembling</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>adCamera</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>addBattery</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>needAddNFC</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>addNFC</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>packaged</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 具体方法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>adCamera</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;组装摄像头&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>addBattery</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;安装电池&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>addNFC</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;增加NFC功能&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 钩子方法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>abstract</span> <span class=kt>boolean</span> <span class=nf>needAddNFC</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 抽象方法
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>packaged</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>具体的子类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>OlderPhone</span> <span class=kd>extends</span> <span class=n>Phone</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kt>boolean</span> <span class=nf>needAddNFC</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>packaged</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;附赠一个手机壳&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SmartPhone</span> <span class=kd>extends</span> <span class=n>Phone</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kt>boolean</span> <span class=nf>needAddNFC</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>packaged</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;附赠耳机一副&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>测试与输出结果如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>OlderPhone</span> <span class=n>olderPhone</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OlderPhone</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>olderPhone</span><span class=o>.</span><span class=na>assembling</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=c1>// 输出：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>组装摄像头</span>
</span></span><span class=line><span class=cl><span class=err>安装电池</span>
</span></span><span class=line><span class=cl><span class=err>附赠一个手机壳</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>SmartPhone</span> <span class=n>smartPhone</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SmartPhone</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>smartPhone</span><span class=o>.</span><span class=na>assembling</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=c1>// 输出：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>组装摄像头</span>
</span></span><span class=line><span class=cl><span class=err>安装电池</span>
</span></span><span class=line><span class=cl><span class=err>增加</span><span class=n>NFC</span><span class=err>功能</span>
</span></span><span class=line><span class=cl><span class=err>附赠耳机一副</span>
</span></span></code></pre></div><h2 id=4-策略模式>4. 策略模式</h2><h3 id=41-定义-2>4.1 定义</h3><p>定义一系列的算法，并将它们独立封装后再提供给客户端使用，从而使得算法的变化不会影响到客户端的使用。策略模式实际上是一种无处不在的模式，比如根据在 controller 层接收到的参数不同，调用不同的 service 进行处理，这也是策略模式的一种体现。</p><h3 id=42-示例-1>4.2 示例</h3><p>假设公司需要根据营业额的不同来选择不同的员工激励策略：</p><div align=center><img src=https://gitee.com/heibaiying/Full-Stack-Notes/raw/master/pictures\23_strategy.png></div><p>策略接口及其实现类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Strategy</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>execute</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>TravelStrategy</span> <span class=kd>implements</span> <span class=n>Strategy</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>execute</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;集体旅游&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>BonusStrategy</span> <span class=kd>implements</span> <span class=n>Strategy</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>execute</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;奖金激励&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>WorkOvertimeStrategy</span> <span class=kd>implements</span> <span class=n>Strategy</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>execute</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;奖励加班&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>公司类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Company</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Strategy</span> <span class=n>strategy</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Company</span> <span class=nf>setStrategy</span><span class=o>(</span><span class=n>Strategy</span> <span class=n>strategy</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>strategy</span> <span class=o>=</span> <span class=n>strategy</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>execute</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>strategy</span><span class=o>.</span><span class=na>execute</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>客户端使用时，需要根据不同的营业额选择不同的激励策略：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 营业额
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>int</span> <span class=n>turnover</span> <span class=o>=</span> <span class=n>Integer</span><span class=o>.</span><span class=na>parseInt</span><span class=o>(</span><span class=n>args</span><span class=o>[</span><span class=mi>0</span><span class=o>]);</span>
</span></span><span class=line><span class=cl>    <span class=n>Company</span> <span class=n>company</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Company</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>turnover</span> <span class=o>&gt;</span> <span class=mi>1000</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>company</span><span class=o>.</span><span class=na>setStrategy</span><span class=o>(</span><span class=k>new</span> <span class=n>BonusStrategy</span><span class=o>()).</span><span class=na>execute</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>else</span> <span class=k>if</span> <span class=o>(</span><span class=n>turnover</span> <span class=o>&gt;</span> <span class=mi>100</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>company</span><span class=o>.</span><span class=na>setStrategy</span><span class=o>(</span><span class=k>new</span> <span class=n>TravelStrategy</span><span class=o>()).</span><span class=na>execute</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>company</span><span class=o>.</span><span class=na>setStrategy</span><span class=o>(</span><span class=k>new</span> <span class=n>WorkOvertimeStrategy</span><span class=o>()).</span><span class=na>execute</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=6-状态模式>6. 状态模式</h2><h3 id=61-定义-2>6.1 定义</h3><p>对有状态的对象，把复杂的判断逻辑提取到不同的状态对象中，允许状态对象在其内部状态发生改变时改变其行为。</p><h3 id=62-优点-1>6.2 优点</h3><ul><li>状态模式将与特定状态相关的行为局部化到一个状态中，并且将不同状态的行为分割开来，满足单一职责原则；</li><li>将不同的状态引入到独立的对象中，使得状态转换变得更加明确，且减少对象间的相互依赖；</li><li>有利于程序的扩展，通过定义新的子类很容易地增加新的状态和转换。</li></ul><h3 id=63-示例-1>6.3 示例</h3><p>假设我们正在开发一个播放器，它有如下图所示四种基本的状态：播放状态，关闭状态，暂停状态，加速播放状态。这四种状态间可以相互转换，但存在一定的限制，比如在关闭或者暂停状态下，都不能加速视频，采用状态模式来实现该播放器的相关代码如下：</p><div align=center><img src=https://gitee.com/heibaiying/Full-Stack-Notes/raw/master/pictures\23_state.png></div><p>定义状态抽象类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>State</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Player</span> <span class=n>player</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setPlayer</span><span class=o>(</span><span class=n>Player</span> <span class=n>player</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>player</span> <span class=o>=</span> <span class=n>player</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>paly</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>player</span><span class=o>.</span><span class=na>setState</span><span class=o>(</span><span class=n>Player</span><span class=o>.</span><span class=na>PLAY_STATE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>pause</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>player</span><span class=o>.</span><span class=na>setState</span><span class=o>(</span><span class=n>Player</span><span class=o>.</span><span class=na>PAUSE_STATE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>close</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>player</span><span class=o>.</span><span class=na>setState</span><span class=o>(</span><span class=n>Player</span><span class=o>.</span><span class=na>CLOSE_STATE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>speed</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>player</span><span class=o>.</span><span class=na>setState</span><span class=o>(</span><span class=n>Player</span><span class=o>.</span><span class=na>SPEED_STATE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>定义四种状态的具体实现类，并限制它们之间的转换关系：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>PlayState</span> <span class=kd>extends</span> <span class=n>State</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CloseState</span> <span class=kd>extends</span> <span class=n>State</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>pause</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;操作失败：视频已处于关闭状态，无需暂停&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>speed</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;操作失败：视频已处于关闭状态，无法加速&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>PauseState</span> <span class=kd>extends</span> <span class=n>State</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>speed</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>print</span><span class=o>(</span><span class=s>&#34;操作失败：暂停状态下不支持加速&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SpeedState</span> <span class=kd>extends</span> <span class=n>State</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>paly</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;系统提示：你当前已处于加速播放状态&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>组装播放器：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Player</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>State</span> <span class=n>state</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>final</span> <span class=kd>static</span> <span class=n>PlayState</span> <span class=n>PLAY_STATE</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PlayState</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>final</span> <span class=kd>static</span> <span class=n>PauseState</span> <span class=n>PAUSE_STATE</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PauseState</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>final</span> <span class=kd>static</span> <span class=n>CloseState</span> <span class=n>CLOSE_STATE</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CloseState</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>final</span> <span class=kd>static</span> <span class=n>SpeedState</span> <span class=n>SPEED_STATE</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SpeedState</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>State</span> <span class=nf>getState</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>state</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setState</span><span class=o>(</span><span class=n>State</span> <span class=n>state</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>state</span> <span class=o>=</span> <span class=n>state</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>state</span><span class=o>.</span><span class=na>setPlayer</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Player</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 假设播放器初始状态为关闭
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>this</span><span class=o>.</span><span class=na>state</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CloseState</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>state</span><span class=o>.</span><span class=na>setPlayer</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>paly</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;播放视频&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=o>.</span><span class=na>paly</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>pause</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;暂停视频&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=o>.</span><span class=na>pause</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>close</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;关闭视频&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>speed</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;视频加速&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=o>.</span><span class=na>speed</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>调用我们自定义的播放器：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Player</span> <span class=n>player</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Player</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>player</span><span class=o>.</span><span class=na>speed</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>player</span><span class=o>.</span><span class=na>paly</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>player</span><span class=o>.</span><span class=na>speed</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>player</span><span class=o>.</span><span class=na>paly</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>player</span><span class=o>.</span><span class=na>pause</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>player</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>player</span><span class=o>.</span><span class=na>speed</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 输出：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>视频加速</span>
</span></span><span class=line><span class=cl><span class=err>操作失败：视频已处于关闭状态，无法加速</span>
</span></span><span class=line><span class=cl><span class=err>播放视频</span>
</span></span><span class=line><span class=cl><span class=err>视频加速</span>
</span></span><span class=line><span class=cl><span class=err>播放视频</span>
</span></span><span class=line><span class=cl><span class=err>系统提示：你当前已处于加速播放状态</span>
</span></span><span class=line><span class=cl><span class=err>暂停视频</span>
</span></span><span class=line><span class=cl><span class=err>关闭视频</span>
</span></span><span class=line><span class=cl><span class=err>视频加速</span>
</span></span><span class=line><span class=cl><span class=err>操作失败：视频已处于关闭状态，无法加速</span>
</span></span></code></pre></div><h2 id=7-中介者模式>7. 中介者模式</h2><h3 id=71-定义-1>7.1 定义</h3><p>定义一个中介对象来封装一系列对象之间的交互，使原有对象之间的耦合松散，且可以独立地改变它们之间的交互。</p><h3 id=72-优点>7.2 优点</h3><p>降低了对象之间的耦合度。</p><h3 id=73-示例>7.3 示例</h3><p>这里以房屋中介为例，定义一个抽象的中介类，负责接收客户以及在客户间传递消息：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>Mediator</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>register</span><span class=o>(</span><span class=n>Person</span> <span class=n>person</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>send</span><span class=o>(</span><span class=n>String</span> <span class=n>from</span><span class=o>,</span> <span class=n>String</span> <span class=n>message</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>具体的房屋中介，它会将卖方的出售消息广播给所有人：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HouseMediator</span> <span class=kd>extends</span> <span class=n>Mediator</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Person</span><span class=o>&gt;</span> <span class=n>personList</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>register</span><span class=o>(</span><span class=n>Person</span> <span class=n>person</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(!</span><span class=n>personList</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=n>person</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>personList</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>person</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>person</span><span class=o>.</span><span class=na>setMediator</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>send</span><span class=o>(</span><span class=n>String</span> <span class=n>from</span><span class=o>,</span> <span class=n>String</span> <span class=n>message</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>from</span> <span class=o>+</span> <span class=s>&#34;发送消息：&#34;</span> <span class=o>+</span> <span class=n>message</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=n>Person</span> <span class=n>person</span> <span class=o>:</span> <span class=n>personList</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>String</span> <span class=n>name</span> <span class=o>=</span> <span class=n>person</span><span class=o>.</span><span class=na>getName</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(!</span><span class=n>name</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>from</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>person</span><span class=o>.</span><span class=na>receive</span><span class=o>(</span><span class=n>message</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>定义用户类，它可以是买方也可以是卖方，它们都是中介的客户：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Person</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Mediator</span> <span class=n>mediator</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Person</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>send</span><span class=o>(</span><span class=n>String</span> <span class=n>message</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>mediator</span><span class=o>.</span><span class=na>send</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>name</span><span class=o>,</span> <span class=n>message</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>receive</span><span class=o>(</span><span class=n>String</span> <span class=n>message</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>name</span> <span class=o>+</span> <span class=s>&#34;收到消息：&#34;</span> <span class=o>+</span> <span class=n>message</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>最后买卖双方通过中介人就可以进行沟通：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ZTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>HouseMediator</span> <span class=n>houseMediator</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HouseMediator</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Person</span> <span class=n>seller</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Person</span><span class=o>(</span><span class=s>&#34;卖方&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Person</span> <span class=n>buyer</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Person</span><span class=o>(</span><span class=s>&#34;买方&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>houseMediator</span><span class=o>.</span><span class=na>register</span><span class=o>(</span><span class=n>seller</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>houseMediator</span><span class=o>.</span><span class=na>register</span><span class=o>(</span><span class=n>buyer</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>buyer</span><span class=o>.</span><span class=na>send</span><span class=o>(</span><span class=s>&#34;价格多少&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>seller</span><span class=o>.</span><span class=na>send</span><span class=o>(</span><span class=s>&#34;10万&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>buyer</span><span class=o>.</span><span class=na>send</span><span class=o>(</span><span class=s>&#34;太贵了&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 输出：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>买方发送消息：价格多少</span>
</span></span><span class=line><span class=cl><span class=err>卖方收到消息：价格多少</span>
</span></span><span class=line><span class=cl><span class=err>卖方发送消息：</span><span class=mi>10</span><span class=err>万</span>
</span></span><span class=line><span class=cl><span class=err>买方收到消息：</span><span class=mi>10</span><span class=err>万</span>
</span></span><span class=line><span class=cl><span class=err>买方发送消息：太贵了</span>
</span></span><span class=line><span class=cl><span class=err>卖方收到消息：太贵了</span>
</span></span></code></pre></div><h2 id=8-迭代器模式>8. 迭代器模式</h2><h3 id=81-定义>8.1 定义</h3><p>提供了一种方法用于顺序访问一个聚合对象中的各个元素，而又不暴露该对象的内部表示。</p><h3 id=82-示例>8.2 示例</h3><p>假设现在对书架中的所有书籍进行遍历，首先定义书籍类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Book</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Book</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>定义书柜接口及其实现类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Bookshelf</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>addBook</span><span class=o>(</span><span class=n>Book</span> <span class=n>book</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>removeBook</span><span class=o>(</span><span class=n>Book</span> <span class=n>book</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>BookIterator</span> <span class=nf>iterator</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>BookshelfImpl</span> <span class=kd>implements</span> <span class=n>Bookshelf</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Book</span><span class=o>&gt;</span> <span class=n>bookList</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addBook</span><span class=o>(</span><span class=n>Book</span> <span class=n>book</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>bookList</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>book</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>removeBook</span><span class=o>(</span><span class=n>Book</span> <span class=n>book</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>bookList</span><span class=o>.</span><span class=na>remove</span><span class=o>(</span><span class=n>book</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>BookIterator</span> <span class=nf>iterator</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>BookIterator</span><span class=o>(</span><span class=n>bookList</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>定义迭代器接口及其实现类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Iterator</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>E</span> <span class=nf>next</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=kt>boolean</span> <span class=nf>hasNext</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>BookIterator</span> <span class=kd>implements</span> <span class=n>Iterator</span><span class=o>&lt;</span><span class=n>Book</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Book</span><span class=o>&gt;</span> <span class=n>bookList</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>position</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>BookIterator</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Book</span><span class=o>&gt;</span> <span class=n>bookList</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>bookList</span> <span class=o>=</span> <span class=n>bookList</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Book</span> <span class=nf>next</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>bookList</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>position</span><span class=o>++);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>hasNext</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>position</span> <span class=o>&lt;</span> <span class=n>bookList</span><span class=o>.</span><span class=na>size</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>调用自定义的迭代器进行遍历：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>BookshelfImpl</span> <span class=n>bookshelf</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BookshelfImpl</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>bookshelf</span><span class=o>.</span><span class=na>addBook</span><span class=o>(</span><span class=k>new</span> <span class=n>Book</span><span class=o>(</span><span class=s>&#34;Java书籍&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=n>bookshelf</span><span class=o>.</span><span class=na>addBook</span><span class=o>(</span><span class=k>new</span> <span class=n>Book</span><span class=o>(</span><span class=s>&#34;Python书籍&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=n>bookshelf</span><span class=o>.</span><span class=na>addBook</span><span class=o>(</span><span class=k>new</span> <span class=n>Book</span><span class=o>(</span><span class=s>&#34;Go书籍&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=n>BookIterator</span> <span class=n>iterator</span> <span class=o>=</span> <span class=n>bookshelf</span><span class=o>.</span><span class=na>iterator</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=o>(</span><span class=n>iterator</span><span class=o>.</span><span class=na>hasNext</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>iterator</span><span class=o>.</span><span class=na>next</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=9-访问者模式>9. 访问者模式</h2><h3 id=91-定义>9.1 定义</h3><p>表示一个作用于某对象结构中各个元素的操作，它使得用户可以在不改变各个元素所对应类的前提下定义对这些元素的操作。</p><h3 id=92-优缺点>9.2 优缺点</h3><p>优点：</p><ul><li>扩展性好：能够在不修改对象结构中的元素的情况下，为对象结构中的元素添加新的功能。</li><li>复用性好：可以通过访问者来定义整个对象结构通用的功能，从而提高系统的复用程度。</li><li>灵活性好：访问者模式将数据结构与作用于结构上的操作解耦，使得操作可相对自由地演化而不影响系统的数据结构。</li></ul><p>缺点：</p><ul><li>增加新的元素类很复杂；</li><li>实现相对繁琐。</li></ul><h3 id=93-示例>9.3 示例</h3><p>通常不同级别的员工对于公司档案的访问权限是不同的，为方便理解，如下图所示假设只有公开和加密两种类型的档案，并且只有总经理和部门经理才能进入档案室：</p><div align=center><img src=https://gitee.com/heibaiying/Full-Stack-Notes/raw/master/pictures\23_visitor.png></div><p>定义档案类及其实现类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Archive</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 接受访问者
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>void</span> <span class=nf>accept</span><span class=o>(</span><span class=n>Visitor</span> <span class=n>visitor</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>PublicArchive</span> <span class=kd>implements</span> <span class=n>Archive</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>accept</span><span class=o>(</span><span class=n>Visitor</span> <span class=n>visitor</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>visitor</span><span class=o>.</span><span class=na>visit</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecretArchive</span> <span class=kd>implements</span> <span class=n>Archive</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>accept</span><span class=o>(</span><span class=n>Visitor</span> <span class=n>visitor</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>visitor</span><span class=o>.</span><span class=na>visit</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>定义访问者接口及其实现类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Visitor</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 访问公开档案
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>void</span> <span class=nf>visit</span><span class=o>(</span><span class=n>PublicArchive</span> <span class=n>publicArchive</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 访问加密档案
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>void</span> <span class=nf>visit</span><span class=o>(</span><span class=n>SecretArchive</span> <span class=n>secretArchive</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>DepartManager</span> <span class=kd>implements</span> <span class=n>Visitor</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>visit</span><span class=o>(</span><span class=n>PublicArchive</span> <span class=n>publicArchive</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;所有公开档案&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>visit</span><span class=o>(</span><span class=n>SecretArchive</span> <span class=n>secretArchive</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;三级以下权限的加密档案&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>President</span> <span class=kd>implements</span> <span class=n>Visitor</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>visit</span><span class=o>(</span><span class=n>PublicArchive</span> <span class=n>publicArchive</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;所有公开档案&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>visit</span><span class=o>(</span><span class=n>SecretArchive</span> <span class=n>secretArchive</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;所有加密档案&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>通过公司类来管理访问：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Company</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Archive</span><span class=o>&gt;</span> <span class=n>archives</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 接收档案
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>void</span> <span class=nf>add</span><span class=o>(</span><span class=n>Archive</span> <span class=n>archive</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>archives</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>archive</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 移除档案
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>void</span> <span class=nf>remove</span><span class=o>(</span><span class=n>Archive</span> <span class=n>archive</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>archives</span><span class=o>.</span><span class=na>remove</span><span class=o>(</span><span class=n>archive</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 接待访问者
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>void</span> <span class=nf>accept</span><span class=o>(</span><span class=n>Visitor</span> <span class=n>visitor</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=n>Archive</span> <span class=n>archive</span> <span class=o>:</span> <span class=n>archives</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>archive</span><span class=o>.</span><span class=na>accept</span><span class=o>(</span><span class=n>visitor</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>测试及输出结果：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Company</span> <span class=n>company</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Company</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>company</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>SecretArchive</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=n>company</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>PublicArchive</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>company</span><span class=o>.</span><span class=na>accept</span><span class=o>(</span><span class=k>new</span> <span class=n>DepartManager</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=c1>// 输出：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>三级以下权限的加密档案</span>
</span></span><span class=line><span class=cl><span class=err>所有公开档案</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>company</span><span class=o>.</span><span class=na>accept</span><span class=o>(</span><span class=k>new</span> <span class=n>President</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=c1>// 输出：
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>所有加密档案</span>
</span></span><span class=line><span class=cl><span class=err>所有公开档案</span>
</span></span></code></pre></div><h2 id=10-备忘录模式>10. 备忘录模式</h2><h3 id=101-定义>10.1 定义</h3><p>在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态，以便在需要时能将该对象恢复到原有状态。</p><h3 id=102-优缺点>10.2 优缺点</h3><p>优点是能够用于异常情况下的恢复，能够提高系统的安全性；缺点是需要额外的存储空间来保存历史状态。</p><h3 id=103-示例>10.3 示例</h3><p>编辑器的撤销功能，数据库的快照功能都是备忘录模式的一种典型实现，这里我们以 Git 保存历史版本信息为例，进行演示：</p><p>文章类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Article</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>title</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>content</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>根据业务需求的不同，你可能只需要保存数据的部分字段，或者还需要额外增加字段（如保存时间等），所以在保存时需要将目标对象转换为备忘录对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 备忘录对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Memorandum</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>title</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>content</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Date</span> <span class=n>createTime</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 根据目标对象来创建备忘录对象
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=nf>Memorandum</span><span class=o>(</span><span class=n>Article</span> <span class=n>article</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>title</span> <span class=o>=</span> <span class=n>article</span><span class=o>.</span><span class=na>getTitle</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>content</span> <span class=o>=</span> <span class=n>article</span><span class=o>.</span><span class=na>getContent</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>createTime</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Date</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Article</span> <span class=nf>toArticle</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>Article</span><span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>title</span><span class=o>,</span> <span class=k>this</span><span class=o>.</span><span class=na>content</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>管理者类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>GitRepository</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Memorandum</span><span class=o>&gt;</span> <span class=n>repository</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 保存当前数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>save</span><span class=o>(</span><span class=n>Article</span> <span class=n>article</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Memorandum</span> <span class=n>memorandum</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Memorandum</span><span class=o>(</span><span class=n>article</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>repository</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>memorandum</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 获取指定版本类的数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=n>Article</span> <span class=nf>get</span><span class=o>(</span><span class=kt>int</span> <span class=n>version</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Memorandum</span> <span class=n>memorandum</span> <span class=o>=</span> <span class=n>repository</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>version</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>memorandum</span><span class=o>.</span><span class=na>toArticle</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 撤销当前操作
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=n>Article</span> <span class=nf>back</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>repository</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>repository</span><span class=o>.</span><span class=na>size</span><span class=o>()</span> <span class=o>-</span> <span class=mi>1</span><span class=o>).</span><span class=na>toArticle</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>测试类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>GitRepository</span> <span class=n>repository</span> <span class=o>=</span> <span class=k>new</span> <span class=n>GitRepository</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>Article</span> <span class=n>article</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Article</span><span class=o>(</span><span class=s>&#34;Java手册&#34;</span><span class=o>,</span> <span class=s>&#34;版本一&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>repository</span><span class=o>.</span><span class=na>save</span><span class=o>(</span><span class=n>article</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>article</span><span class=o>.</span><span class=na>setContent</span><span class=o>(</span><span class=s>&#34;版本二&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>repository</span><span class=o>.</span><span class=na>save</span><span class=o>(</span><span class=n>article</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>article</span><span class=o>.</span><span class=na>setContent</span><span class=o>(</span><span class=s>&#34;版本三&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>repository</span><span class=o>.</span><span class=na>save</span><span class=o>(</span><span class=n>article</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>repository</span><span class=o>.</span><span class=na>back</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>repository</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=mi>0</span><span class=o>));</span>
</span></span></code></pre></div><h2 id=11-解释器模式>11. 解释器模式</h2><p>给分析对象定义一种语言，并定义该语言的文法表示，然后设计一个解析器来解释语言中的语句，用编译语言的方式来分析应用中的实例。解释器模式的实现比较复杂，在通常的开发也较少使用，这里就不提供示例了。</p><p>以上所有示例的源码见：<a href=https://github.com/heibaiying/Full-Stack-Notes/tree/master/code/Java/design-pattern target=_blank rel=noopener>design-pattern</a></p><h2 id=参考资料>参考资料</h2><ol><li>Erich Gamma / Richard Helm / Ralph Johnson / John Vlissides . 设计模式（可复用面向对象软件的基础）. 机械工业出版社 . 2000-9</li><li>秦小波 . 设计模式之禅（第 2 版）. 机械工业出版社 . 2014-2-25</li><li><a href=http://c.biancheng.net/view/1317.html target=_blank rel=noopener>Java 设计模式</a></li><li><a href=https://coding.imooc.com/class/270.html target=_blank rel=noopener>Java 设计模式精讲 Debug 方式 + 内存分析</a></li></ol></div><div class=article-widget><div class="container-xl row post-nav"></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>