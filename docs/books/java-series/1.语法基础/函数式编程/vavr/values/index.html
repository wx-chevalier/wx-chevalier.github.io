<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="Values Option Option 的主要目标是利用 Java 类型系统来消除我们代码中的空检查。Option 是 Vavr 中的一个对象容器，其最终目标与 Java 8 中的 Option 类似。Vavr 的 Option 实现了 Serializable、Iterable，并且拥有更丰富的 A"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/java-series/1.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/vavr/values/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/java-series/1.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/vavr/values/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/java-series/1.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/vavr/values/"><meta property="og:title" content="Values | Next-gen Tech Edu"><meta property="og:description" content="Values Option Option 的主要目标是利用 Java 类型系统来消除我们代码中的空检查。Option 是 Vavr 中的一个对象容器，其最终目标与 Java 8 中的 Option 类似。Vavr 的 Option 实现了 Serializable、Iterable，并且拥有更丰富的 A"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>Values | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=7eb6f65116f9aaa088aee6a4af5cb0d7><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">Vavr</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id9e6f450791962495161c6bebf9fd7c7d")' href=#id9e6f450791962495161c6bebf9fd7c7d aria-expanded=false aria-controls=id9e6f450791962495161c6bebf9fd7c7d aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/1.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/>函数式编程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id9e6f450791962495161c6bebf9fd7c7d aria-expanded=false aria-controls=id9e6f450791962495161c6bebf9fd7c7d><i class="fa-solid fa-angle-down" id=caret-id9e6f450791962495161c6bebf9fd7c7d></i></a></div><ul class="nav docs-sidenav collapse show" id=id9e6f450791962495161c6bebf9fd7c7d><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idef3cd3246f45d719b4fdd6ba812244cd")' href=#idef3cd3246f45d719b4fdd6ba812244cd aria-expanded=false aria-controls=idef3cd3246f45d719b4fdd6ba812244cd aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/1.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/lambda/>Lambda</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idef3cd3246f45d719b4fdd6ba812244cd aria-expanded=false aria-controls=idef3cd3246f45d719b4fdd6ba812244cd><i class="fa-solid fa-angle-right" id=caret-idef3cd3246f45d719b4fdd6ba812244cd></i></a></div><ul class="nav docs-sidenav collapse" id=idef3cd3246f45d719b4fdd6ba812244cd><li class="child level"><a href=/books/java-series/1.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/lambda/lambda-%E8%AF%AD%E6%B3%95/>Lambda 语法</a></li><li class="child level"><a href=/books/java-series/1.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/lambda/%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3/>函数式接口</a></li><li class="child level"><a href=/books/java-series/1.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/lambda/%E4%B8%8A%E4%B8%8B%E6%96%87%E4%B8%8E%E4%BD%9C%E7%94%A8%E5%9F%9F/>上下文与作用域</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idd92681395d6dda5395fa12374f64029f")' href=#idd92681395d6dda5395fa12374f64029f aria-expanded=false aria-controls=idd92681395d6dda5395fa12374f64029f aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/1.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/stream-api/>Stream API</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idd92681395d6dda5395fa12374f64029f aria-expanded=false aria-controls=idd92681395d6dda5395fa12374f64029f><i class="fa-solid fa-angle-right" id=caret-idd92681395d6dda5395fa12374f64029f></i></a></div><ul class="nav docs-sidenav collapse" id=idd92681395d6dda5395fa12374f64029f><li class="child level"><a href=/books/java-series/1.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/stream-api/%E5%B9%B6%E5%8F%91%E6%B5%81/>并发流</a></li><li class="child level"><a href=/books/java-series/1.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/stream-api/%E6%93%8D%E4%BD%9C%E7%AC%A6/>操作符</a></li><li class="child level"><a href=/books/java-series/1.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/stream-api/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/>异常处理</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idba42610150c8bd0275c48a7aa0841f54")' href=#idba42610150c8bd0275c48a7aa0841f54 aria-expanded=false aria-controls=idba42610150c8bd0275c48a7aa0841f54 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/1.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/vavr/>Vavr</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idba42610150c8bd0275c48a7aa0841f54 aria-expanded=false aria-controls=idba42610150c8bd0275c48a7aa0841f54><i class="fa-solid fa-angle-down" id=caret-idba42610150c8bd0275c48a7aa0841f54></i></a></div><ul class="nav docs-sidenav collapse show" id=idba42610150c8bd0275c48a7aa0841f54><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idceb3a621f1f92f25ed5b54f16b2b1978")' href=#idceb3a621f1f92f25ed5b54f16b2b1978 aria-expanded=false aria-controls=idceb3a621f1f92f25ed5b54f16b2b1978 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/1.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/vavr/collections/>Collections</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idceb3a621f1f92f25ed5b54f16b2b1978 aria-expanded=false aria-controls=idceb3a621f1f92f25ed5b54f16b2b1978><i class="fa-solid fa-angle-right" id=caret-idceb3a621f1f92f25ed5b54f16b2b1978></i></a></div><ul class="nav docs-sidenav collapse" id=idceb3a621f1f92f25ed5b54f16b2b1978><li class="child level"><a href=/books/java-series/1.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/vavr/collections/collections/>Collections</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id8ec94270fbacfaf3b51c5097a27f6867")' href=#id8ec94270fbacfaf3b51c5097a27f6867 aria-expanded=false aria-controls=id8ec94270fbacfaf3b51c5097a27f6867 aria-hidden=false data-toggle=collapse></div></div><li class="child level"><a href=/books/java-series/1.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/vavr/functions/>Functions</a></li><li class="child level"><a href=/books/java-series/1.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/vavr/pattern-matching/>Pattern Matching</a></li><li class="child level"><a href=/books/java-series/1.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/vavr/tuples/>Tuples</a></li><li class="child level"><a href=/books/java-series/1.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/vavr/validation/>Validation</a></li><li class="child level active"><a href=/books/java-series/1.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/vavr/values/>Values</a></li></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#try-异常处理>Try 异常处理</a><ul><li><a href=#处理成功的结果>处理成功的结果</a></li></ul></li></ul><ul><li><ul><li><a href=#处理异常场景>处理异常场景</a></li><li><a href=#pattern-matching>Pattern Matching</a></li></ul></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>Values</h1><div class=article-style><h1 id=values>Values</h1><h1 id=option>Option</h1><p>Option 的主要目标是利用 Java 类型系统来消除我们代码中的空检查。Option 是 Vavr 中的一个对象容器，其最终目标与 Java 8 中的 Option 类似。Vavr 的 Option 实现了 Serializable、Iterable，并且拥有更丰富的 API。由于 Java 中的任何对象引用都可能有一个空值，所以我们在使用它之前通常要用 if 语句来检查空值。这些检查使代码变得健壮而稳定。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>givenValue_whenNullCheckNeeded_thenCorrect</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Object</span> <span class=n>possibleNullObj</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>possibleNullObj</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>possibleNullObj</span> <span class=o>=</span> <span class=s>&#34;someDefaultValue&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=n>assertNotNull</span><span class=o>(</span><span class=n>possibleNullObj</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>如果不进行检查，应用程序可能会因为一个简单的 NPE 而崩溃。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=o>(</span><span class=n>expected</span> <span class=o>=</span> <span class=n>NullPointerException</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>givenValue_whenNullCheckNeeded_thenCorrect2</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Object</span> <span class=n>possibleNullObj</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>assertEquals</span><span class=o>(</span><span class=s>&#34;somevalue&#34;</span><span class=o>,</span> <span class=n>possibleNullObj</span><span class=o>.</span><span class=na>toString</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>然而，这些检查使代码变得啰嗦，不那么可读，特别是当 if 语句最终被嵌套多次时。Option 解决了这个问题，它完全消除了空值，并在每个可能的情况下用一个有效的对象引用来代替它们。有了 Option，一个空值将评估为一个 None 的实例，而一个非空值将评估为一个 Some 的实例。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>givenValue_whenCreatesOption_thenCorrect</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Option</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>&gt;</span> <span class=n>noneOption</span> <span class=o>=</span> <span class=n>Option</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Option</span><span class=o>&lt;</span><span class=n>Object</span><span class=o>&gt;</span> <span class=n>someOption</span> <span class=o>=</span> <span class=n>Option</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=s>&#34;val&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>assertEquals</span><span class=o>(</span><span class=s>&#34;None&#34;</span><span class=o>,</span> <span class=n>noneOption</span><span class=o>.</span><span class=na>toString</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=n>assertEquals</span><span class=o>(</span><span class=s>&#34;Some(val)&#34;</span><span class=o>,</span> <span class=n>someOption</span><span class=o>.</span><span class=na>toString</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>请注意，在调用 toString 之前，我们不需要做检查，也不需要像以前那样处理 NullPointerException。Option 的 toString 在每次调用中都会给我们返回有意义的值。在本节的第二个片段中，我们需要一个 null 检查，在尝试使用变量之前，我们会给它分配一个默认值。Option 可以在一行中处理这个问题，即使有一个 null。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>givenNull_whenCreatesOption_thenCorrect</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>name</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Option</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>nameOption</span> <span class=o>=</span> <span class=n>Option</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>assertEquals</span><span class=o>(</span><span class=s>&#34;baeldung&#34;</span><span class=o>,</span> <span class=n>nameOption</span><span class=o>.</span><span class=na>getOrElse</span><span class=o>(</span><span class=s>&#34;baeldung&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Test</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>givenNonNull_whenCreatesOption_thenCorrect</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>name</span> <span class=o>=</span> <span class=s>&#34;baeldung&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Option</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>nameOption</span> <span class=o>=</span> <span class=n>Option</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>assertEquals</span><span class=o>(</span><span class=s>&#34;baeldung&#34;</span><span class=o>,</span> <span class=n>nameOption</span><span class=o>.</span><span class=na>getOrElse</span><span class=o>(</span><span class=s>&#34;notbaeldung&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h1 id=try>Try</h1><p>在 Vavr 中，Try 是一个可能导致异常的计算的容器。就像 Option 包装一个可空对象，这样我们就不必显式地用 if 检查来处理空值一样，Try 包装一个计算，这样我们就不必显式地用 try-catch 块来处理异常。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=o>(</span><span class=n>expected</span> <span class=o>=</span> <span class=n>ArithmeticException</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>givenBadCode_whenThrowsException_thenCorrect</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>/</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>如果没有 try-catch 块，应用程序会崩溃。为了避免这种情况，你需要用 try-catch 块来包装语句。通过 Vavr，我们可以将同样的代码包裹在一个 Try 实例中，并得到一个结果。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>givenBadCode_whenTryHandles_thenCorrect</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Try</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>result</span> <span class=o>=</span> <span class=n>Try</span><span class=o>.</span><span class=na>of</span><span class=o>(()</span> <span class=o>-&gt;</span> <span class=mi>1</span> <span class=o>/</span> <span class=mi>0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>assertTrue</span><span class=o>(</span><span class=n>result</span><span class=o>.</span><span class=na>isFailure</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>计算是否成功，可以在代码中的任何一点选择检查。在上面的代码段中，我们选择简单地检查成功或失败。我们也可以选择返回一个默认值。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>givenBadCode_whenTryHandles_thenCorrect2</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Try</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>computation</span> <span class=o>=</span> <span class=n>Try</span><span class=o>.</span><span class=na>of</span><span class=o>(()</span> <span class=o>-&gt;</span> <span class=mi>1</span> <span class=o>/</span> <span class=mi>0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>errorSentinel</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=na>getOrElse</span><span class=o>(-</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>assertEquals</span><span class=o>(-</span><span class=mi>1</span><span class=o>,</span> <span class=n>errorSentinel</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Test</span><span class=o>(</span><span class=n>expected</span> <span class=o>=</span> <span class=n>ArithmeticException</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>givenBadCode_whenTryHandles_thenCorrect3</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Try</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>result</span> <span class=o>=</span> <span class=n>Try</span><span class=o>.</span><span class=na>of</span><span class=o>(()</span> <span class=o>-&gt;</span> <span class=mi>1</span> <span class=o>/</span> <span class=mi>0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span><span class=o>.</span><span class=na>getOrElseThrow</span><span class=o>(</span><span class=n>ArithmeticException</span><span class=o>::</span><span class=k>new</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=try-异常处理>Try 异常处理</h2><p>Vavr 库给我们提供了一个特殊的容器，它表示一个可能导致异常或成功完成的计算。将操作封装在 Try 对象中，我们得到的结果要么是 Success，要么是 Failure。然后我们可以根据这个类型执行进一步的操作。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>VavrTry</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>HttpClient</span> <span class=n>httpClient</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Try</span><span class=o>&lt;</span><span class=n>Response</span><span class=o>&gt;</span> <span class=nf>getResponse</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Try</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>httpClient</span><span class=o>::</span><span class=n>call</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// standard constructors
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span></code></pre></div><p>需要注意的是一个返回类型为 <code>Try&lt;Response></code> 的方法。当一个方法返回这样的结果类型时，我们需要正确处理，并且要记住，这个结果类型可能是 Success 或 Failure，所以我们需要在编译时明确处理。</p><h3 id=处理成功的结果>处理成功的结果</h3><p>让我们写一个测试用例，在 httpClient 返回成功结果的情况下使用我们的 Vavr 类。方法 getResponse()返回的是 <code>Try&lt;Resposne></code> 对象。因此我们可以调用 map() 方法，只有当 Try 为 Success 类型时，才会对 Response 执行操作。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>givenHttpClient_whenMakeACall_shouldReturnSuccess</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// given
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Integer</span> <span class=n>defaultChainedResult</span> <span class=o>=</span> <span class=mi>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>id</span> <span class=o>=</span> <span class=s>&#34;a&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>HttpClient</span> <span class=n>httpClient</span> <span class=o>=</span> <span class=o>()</span> <span class=o>-&gt;</span> <span class=k>new</span> <span class=n>Response</span><span class=o>(</span><span class=n>id</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// when
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Try</span><span class=o>&lt;</span><span class=n>Response</span><span class=o>&gt;</span> <span class=n>response</span> <span class=o>=</span> <span class=k>new</span> <span class=n>VavrTry</span><span class=o>(</span><span class=n>httpClient</span><span class=o>).</span><span class=na>getResponse</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>Integer</span> <span class=n>chainedResult</span> <span class=o>=</span> <span class=n>response</span>
</span></span><span class=line><span class=cl>      <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=k>this</span><span class=o>::</span><span class=n>actionThatTakesResponse</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=o>.</span><span class=na>getOrElse</span><span class=o>(</span><span class=n>defaultChainedResult</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>stream</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=na>toStream</span><span class=o>().</span><span class=na>map</span><span class=o>(</span><span class=n>it</span> <span class=o>-&gt;</span> <span class=n>it</span><span class=o>.</span><span class=na>id</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// then
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>assertTrue</span><span class=o>(!</span><span class=n>stream</span><span class=o>.</span><span class=na>isEmpty</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=n>assertTrue</span><span class=o>(</span><span class=n>response</span><span class=o>.</span><span class=na>isSuccess</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span><span class=o>.</span><span class=na>onSuccess</span><span class=o>(</span><span class=n>r</span> <span class=o>-&gt;</span> <span class=n>assertEquals</span><span class=o>(</span><span class=n>id</span><span class=o>,</span> <span class=n>r</span><span class=o>.</span><span class=na>id</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span><span class=o>.</span><span class=na>andThen</span><span class=o>(</span><span class=n>r</span> <span class=o>-&gt;</span> <span class=n>assertEquals</span><span class=o>(</span><span class=n>id</span><span class=o>,</span> <span class=n>r</span><span class=o>.</span><span class=na>id</span><span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>assertNotEquals</span><span class=o>(</span><span class=n>defaultChainedResult</span><span class=o>,</span> <span class=n>chainedResult</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>函数 actionThatTakesResponse()只是简单地将 Response 作为参数，并返回一个 id 字段的 hashCode。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kt>int</span> <span class=nf>actionThatTakesResponse</span><span class=o>(</span><span class=n>Response</span> <span class=n>response</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=na>id</span><span class=o>.</span><span class=na>hashCode</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>如果 Try 里面有 Success，它就返回 Try 的值，否则就返回 defaultChainedResult。我们的 httpClient 执行成功，因此 isSuccess 方法返回 true。然后我们可以执行 onSuccess()方法，对 Response 对象进行操作。Try 也有一个方法 andThen，当 Try 的值是 Success 时，它就会接受一个 Consumer 来消费这个值。我们可以把我们的 Try 响应当作一个流。要做到这一点，我们需要使用 toStream()方法将其转换为一个 Stream，然后所有在 Stream 类中可用的操作都可以用来对该结果进行操作。如果我们想在 Try 类型上执行一个操作，我们可以使用 transform() 方法，将 Try 作为一个参数，并对其进行操作，而不需要拆开封闭的值。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kt>int</span> <span class=nf>actionThatTakesTryResponse</span><span class=o>(</span><span class=n>Try</span><span class=o>&lt;</span><span class=n>Response</span><span class=o>&gt;</span> <span class=n>response</span><span class=o>,</span> <span class=kt>int</span> <span class=n>defaultTransformation</span><span class=o>){</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=na>transform</span><span class=o>(</span><span class=n>responses</span> <span class=o>-&gt;</span> <span class=n>response</span><span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>it</span> <span class=o>-&gt;</span> <span class=n>it</span><span class=o>.</span><span class=na>id</span><span class=o>.</span><span class=na>hashCode</span><span class=o>())</span>
</span></span><span class=line><span class=cl>      <span class=o>.</span><span class=na>getOrElse</span><span class=o>(</span><span class=n>defaultTransformation</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h1 id=lazy>Lazy</h1><p>Lazy 是一个容器，它代表了一个懒惰计算的值，即计算被推迟到需要结果的时候。此外，被评估的值会被缓存或记忆，并在每次需要时再次返回，而不需要重复计算。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>givenFunction_whenEvaluatesWithLazy_thenCorrect</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Lazy</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;</span> <span class=n>lazy</span> <span class=o>=</span> <span class=n>Lazy</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>Math</span><span class=o>::</span><span class=n>random</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>assertFalse</span><span class=o>(</span><span class=n>lazy</span><span class=o>.</span><span class=na>isEvaluated</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>double</span> <span class=n>val1</span> <span class=o>=</span> <span class=n>lazy</span><span class=o>.</span><span class=na>get</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>assertTrue</span><span class=o>(</span><span class=n>lazy</span><span class=o>.</span><span class=na>isEvaluated</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>double</span> <span class=n>val2</span> <span class=o>=</span> <span class=n>lazy</span><span class=o>.</span><span class=na>get</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>assertEquals</span><span class=o>(</span><span class=n>val1</span><span class=o>,</span> <span class=n>val2</span><span class=o>,</span> <span class=mf>0.1</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>在上面的例子中，我们正在评估的函数是 Math.random。请注意，在第二行中，我们检查了值，发现函数还没有被执行。这是因为我们仍然没有对返回值表现出兴趣。在第三行代码中，我们通过调用 Lazy.get 来显示对计算值的兴趣。此时，函数执行，Lazy.evaluated 返回 true。</p><p>我们还可以继续通过再次尝试获取值来确认 Lazy 的记忆位。如果再次执行我们提供的函数，我们肯定会得到一个不同的随机数。然而，Lazy 再次懒惰地返回最初计算的值，正如最后的断言所确认的那样。</p><h3 id=处理异常场景>处理异常场景</h3><p>让我们写一个例子，当我们的 HttpClient 执行时，会抛出 ClientException。与前面的例子相比，我们的 getOrElse 方法将返回 defaultChainedResult，因为 Try 将是 Failure 类型。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>givenHttpClientFailure_whenMakeACall_shouldReturnFailure</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// given
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Integer</span> <span class=n>defaultChainedResult</span> <span class=o>=</span> <span class=mi>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>HttpClient</span> <span class=n>httpClient</span> <span class=o>=</span> <span class=o>()</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>ClientException</span><span class=o>(</span><span class=s>&#34;problem&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// when
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Try</span><span class=o>&lt;</span><span class=n>Response</span><span class=o>&gt;</span> <span class=n>response</span> <span class=o>=</span> <span class=k>new</span> <span class=n>VavrTry</span><span class=o>(</span><span class=n>httpClient</span><span class=o>).</span><span class=na>getResponse</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>Integer</span> <span class=n>chainedResult</span> <span class=o>=</span> <span class=n>response</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=k>this</span><span class=o>::</span><span class=n>actionThatTakesResponse</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>getOrElse</span><span class=o>(</span><span class=n>defaultChainedResult</span><span class=o>);</span>
</span></span><span class=line><span class=cl>     <span class=n>Option</span><span class=o>&lt;</span><span class=n>Response</span><span class=o>&gt;</span> <span class=n>optionalResponse</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=na>toOption</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// then
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>assertTrue</span><span class=o>(</span><span class=n>optionalResponse</span><span class=o>.</span><span class=na>isEmpty</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=n>assertTrue</span><span class=o>(</span><span class=n>response</span><span class=o>.</span><span class=na>isFailure</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span><span class=o>.</span><span class=na>onFailure</span><span class=o>(</span><span class=n>ex</span> <span class=o>-&gt;</span> <span class=n>assertTrue</span><span class=o>(</span><span class=n>ex</span> <span class=k>instanceof</span> <span class=n>ClientException</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=n>assertEquals</span><span class=o>(</span><span class=n>defaultChainedResult</span><span class=o>,</span> <span class=n>chainedResult</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>方法 getReposnse() 返回 Failure，因此方法 isFailure 返回 true，我们可以对返回的响应执行 onFailure() 回调，看到异常是 ClientException 类型。我们可以在返回的响应上执行 onFailure() 回调，看到异常是 ClientException 类型。Try 类型的对象可以使用 toOption() 方法映射到 Option 类型。</p><p>当我们不想在所有代码库中携带我们的 Try 结果，但我们有一些方法使用 Option 类型来处理一个显式的缺失值时，它是有用的。当我们将 Failure 映射到 Option 时，那么方法 isEmpty()将返回 true。当 Try 对象是 Success 类型时，对它调用 toOption 将使 Option 被定义，因此方法 isDefined() 将返回 true。</p><h3 id=pattern-matching>Pattern Matching</h3><p>当我们的 httpClient 返回一个 Exception 时，我们可以对该 Exception 的类型进行模式匹配。然后根据该 Exception 的类型，在 recover() 方法中，我们可以决定是否要从该 Exception 中恢复，将 Failure 转化为 Success，或者将计算结果保留为 Failure。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>givenHttpClientThatFailure_whenMakeACall_shouldReturnFailureAndNotRecover</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// given
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Response</span> <span class=n>defaultResponse</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Response</span><span class=o>(</span><span class=s>&#34;b&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>HttpClient</span> <span class=n>httpClient</span> <span class=o>=</span> <span class=o>()</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=o>(</span><span class=s>&#34;critical problem&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// when
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Try</span><span class=o>&lt;</span><span class=n>Response</span><span class=o>&gt;</span> <span class=n>recovered</span> <span class=o>=</span> <span class=k>new</span> <span class=n>VavrTry</span><span class=o>(</span><span class=n>httpClient</span><span class=o>).</span><span class=na>getResponse</span><span class=o>()</span>
</span></span><span class=line><span class=cl>      <span class=o>.</span><span class=na>recover</span><span class=o>(</span><span class=n>r</span> <span class=o>-&gt;</span> <span class=n>Match</span><span class=o>(</span><span class=n>r</span><span class=o>).</span><span class=na>of</span><span class=o>(</span>
</span></span><span class=line><span class=cl>          <span class=n>Case</span><span class=o>(</span><span class=n>instanceOf</span><span class=o>(</span><span class=n>ClientException</span><span class=o>.</span><span class=na>class</span><span class=o>),</span> <span class=n>defaultResponse</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// then
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>assertTrue</span><span class=o>(</span><span class=n>recovered</span><span class=o>.</span><span class=na>isFailure</span><span class=o>());</span>
</span></span></code></pre></div><p>只有当 Exception 的类型是 ClientException 时，recover()方法内部的模式匹配才会将 Failure 变成 Success。否则，它将把它作为一个 Failure()。我们看到我们的 httpClient 抛出了 RuntimeException，因此我们的恢复方法不会处理这种情况，因此 isFailure() 返回 true。如果我们想从恢复的对象中获取结果，但在关键故障的情况下，我们可以使用 getOrElseThrow()方法来实现。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>recovered</span><span class=o>.</span><span class=na>getOrElseThrow</span><span class=o>(</span><span class=n>throwable</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=o>(</span><span class=n>throwable</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>});</span>
</span></span></code></pre></div><p>有些错误是至关重要的，当它们发生时，我们希望通过在调用堆栈中较高的位置抛出异常来明确地发出信号，让调用者决定进一步的异常处理。在这种情况下，像上面的例子一样重新抛出异常是非常有用的。当我们的客户端抛出一个非关键异常时，我们在 recover() 方法中的模式匹配将把我们的 Failure 变成 Success。我们正在从两种类型的异常 ClientException 和 IllegalArgumentException 中恢复。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>void</span> <span class=nf>givenHttpClientThatFailure_whenMakeACall_shouldReturnFailureAndRecover</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// given
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Response</span> <span class=n>defaultResponse</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Response</span><span class=o>(</span><span class=s>&#34;b&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>HttpClient</span> <span class=n>httpClient</span> <span class=o>=</span> <span class=o>()</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=n>ClientException</span><span class=o>(</span><span class=s>&#34;non critical problem&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// when
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Try</span><span class=o>&lt;</span><span class=n>Response</span><span class=o>&gt;</span> <span class=n>recovered</span> <span class=o>=</span> <span class=k>new</span> <span class=n>VavrTry</span><span class=o>(</span><span class=n>httpClient</span><span class=o>).</span><span class=na>getResponse</span><span class=o>()</span>
</span></span><span class=line><span class=cl>      <span class=o>.</span><span class=na>recover</span><span class=o>(</span><span class=n>r</span> <span class=o>-&gt;</span> <span class=n>Match</span><span class=o>(</span><span class=n>r</span><span class=o>).</span><span class=na>of</span><span class=o>(</span>
</span></span><span class=line><span class=cl>        <span class=n>Case</span><span class=o>(</span><span class=n>instanceOf</span><span class=o>(</span><span class=n>ClientException</span><span class=o>.</span><span class=na>class</span><span class=o>),</span> <span class=n>defaultResponse</span><span class=o>),</span>
</span></span><span class=line><span class=cl>        <span class=n>Case</span><span class=o>(</span><span class=n>instanceOf</span><span class=o>(</span><span class=n>IllegalArgumentException</span><span class=o>.</span><span class=na>class</span><span class=o>),</span> <span class=n>defaultResponse</span><span class=o>)</span>
</span></span><span class=line><span class=cl>       <span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// then
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>assertTrue</span><span class=o>(</span><span class=n>recovered</span><span class=o>.</span><span class=na>isSuccess</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h1 id=either>Either</h1><p>在函数式编程的世界里，函数值或对象不能被修改（即以正常形式）；在 Java 术语中，它被称为不可变的变量。Either 代表两种可能的数据类型的值。一个 Either 要么是左，要么是右。按照惯例，左表示失败的情况结果，右表示成功。</p><p>让我们考虑一个用例，在这个用例中，我们需要创建一个方法，该方法接受一个输入，并根据输入返回一个字符串或一个整数。我们可以用两种方式实现这个方法。要么我们的方法可以返回一个带有代表成功/失败结果的键的映射，要么它可以返回一个固定大小的 List/Array，其中位置表示一个结果类型。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Object</span><span class=o>&gt;</span> <span class=nf>computeWithoutEitherUsingMap</span><span class=o>(</span><span class=kt>int</span> <span class=n>marks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Object</span><span class=o>&gt;</span> <span class=n>results</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>marks</span> <span class=o>&lt;</span> <span class=mi>85</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;FAILURE&#34;</span><span class=o>,</span> <span class=s>&#34;Marks not acceptable&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;SUCCESS&#34;</span><span class=o>,</span> <span class=n>marks</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Object</span><span class=o>&gt;</span> <span class=n>results</span> <span class=o>=</span> <span class=n>computeWithoutEitherUsingMap</span><span class=o>(</span><span class=mi>8</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>error</span> <span class=o>=</span> <span class=o>(</span><span class=n>String</span><span class=o>)</span> <span class=n>results</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=s>&#34;FAILURE&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>marks</span> <span class=o>=</span> <span class=o>(</span><span class=kt>int</span><span class=o>)</span> <span class=n>results</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=s>&#34;SUCCESS&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>static</span> <span class=n>Object</span><span class=o>[]</span> <span class=nf>computeWithoutEitherUsingArray</span><span class=o>(</span><span class=kt>int</span> <span class=n>marks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Object</span><span class=o>[]</span> <span class=n>results</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Object</span><span class=o>[</span><span class=mi>2</span><span class=o>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>marks</span> <span class=o>&lt;</span> <span class=mi>85</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span> <span class=o>=</span> <span class=s>&#34;Marks not acceptable&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span> <span class=o>=</span> <span class=n>marks</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>我们可以看到，这两种方式都需要相当大的工作量，而且最后的效果不是很美观，使用起来也不安全。现在让我们看看如何利用 Vavr 的 Either 工具来实现同样的结果。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kd>static</span> <span class=n>Either</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Integer</span><span class=o>&gt;</span> <span class=nf>computeWithEither</span><span class=o>(</span><span class=kt>int</span> <span class=n>marks</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>marks</span> <span class=o>&lt;</span> <span class=mi>85</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Either</span><span class=o>.</span><span class=na>left</span><span class=o>(</span><span class=s>&#34;Marks not acceptable&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Either</span><span class=o>.</span><span class=na>right</span><span class=o>(</span><span class=n>marks</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>此外，Either 还提供了一个非常方便的类似 monadic 的 API 来处理这两种情况。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>computeWithEither</span><span class=o>(</span><span class=mi>80</span><span class=o>)</span>
</span></span><span class=line><span class=cl>  <span class=o>.</span><span class=na>right</span><span class=o>()</span>
</span></span><span class=line><span class=cl>  <span class=o>.</span><span class=na>filter</span><span class=o>(...)</span>
</span></span><span class=line><span class=cl>  <span class=o>.</span><span class=na>map</span><span class=o>(...)</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span></code></pre></div><p>按照惯例，Either 的左属性代表失败的情况，右属性代表成功。但是，根据我们的需要，我们可以使用投影来改变这种情况：Vavr 中的 Either 并不偏向左或右。如果我们向右投射，如果 Either 为左，则 filter()、map()等操作将没有效果。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>computeWithEither</span><span class=o>(</span><span class=mi>90</span><span class=o>).</span><span class=na>right</span><span class=o>()</span>
</span></span><span class=line><span class=cl>  <span class=o>.</span><span class=na>filter</span><span class=o>(...)</span>
</span></span><span class=line><span class=cl>  <span class=o>.</span><span class=na>map</span><span class=o>(...)</span>
</span></span><span class=line><span class=cl>  <span class=o>.</span><span class=na>getOrElse</span><span class=o>(</span><span class=n>Collections</span><span class=o>::</span><span class=n>emptyList</span><span class=o>);</span>
</span></span></code></pre></div></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>上一页</div><a href=/books/java-series/1.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/vavr/validation/ rel=next>Validation</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>