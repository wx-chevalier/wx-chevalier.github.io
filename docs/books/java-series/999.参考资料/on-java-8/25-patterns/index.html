<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="第二十五章 设计模式 概念 最初，你可以将模式视为解决特定类问题的一种特别巧妙且有深刻见解的方法。这就像前辈已经从所有角度去解决问题，并提出了最通用，最灵活的解决方案。问题可能是你之前看到并解决过的问题，但"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/25-patterns/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/25-patterns/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/25-patterns/"><meta property="og:title" content="25-Patterns | Next-gen Tech Edu"><meta property="og:description" content="第二十五章 设计模式 概念 最初，你可以将模式视为解决特定类问题的一种特别巧妙且有深刻见解的方法。这就像前辈已经从所有角度去解决问题，并提出了最通用，最灵活的解决方案。问题可能是你之前看到并解决过的问题，但"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>25-Patterns | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=7cbee6d616cc5ef61000f63ff068e87a><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">On Java 8</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idb2e20681920018e3a6e20318a9804534")' href=#idb2e20681920018e3a6e20318a9804534 aria-expanded=false aria-controls=idb2e20681920018e3a6e20318a9804534 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/>999.参考资料</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idb2e20681920018e3a6e20318a9804534 aria-expanded=false aria-controls=idb2e20681920018e3a6e20318a9804534><i class="fa-solid fa-angle-down" id=caret-idb2e20681920018e3a6e20318a9804534></i></a></div><ul class="nav docs-sidenav collapse show" id=idb2e20681920018e3a6e20318a9804534><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id4d84ffe3754d5f34aa3c13b4d1952b31")' href=#id4d84ffe3754d5f34aa3c13b4d1952b31 aria-expanded=false aria-controls=id4d84ffe3754d5f34aa3c13b4d1952b31 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/>On Java 8</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id4d84ffe3754d5f34aa3c13b4d1952b31 aria-expanded=false aria-controls=id4d84ffe3754d5f34aa3c13b4d1952b31><i class="fa-solid fa-angle-down" id=caret-id4d84ffe3754d5f34aa3c13b4d1952b31></i></a></div><ul class="nav docs-sidenav collapse show" id=id4d84ffe3754d5f34aa3c13b4d1952b31><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/00-introduction/>00-Introduction</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/01-what-is-an-object/>01-What-is-an-Object</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/02-installing-java-and-the-book-examples/>02-Installing-Java-and-the-Book-Examples</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/03-objects-everywhere/>03-Objects-Everywhere</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/04-operators/>04-Operators</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/05-control-flow/>05-Control-Flow</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/06-housekeeping/>06-Housekeeping</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/07-implementation-hiding/>07-Implementation-Hiding</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/08-reuse/>08-Reuse</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/09-polymorphism/>09-Polymorphism</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/10-interfaces/>10-Interfaces</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/11-inner-classes/>11-Inner-Classes</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/12-collections/>12-Collections</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/13-functional-programming/>13-Functional-Programming</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/14-streams/>14-Streams</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/15-exceptions/>15-Exceptions</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/16-validating-your-code/>16-Validating-Your-Code</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/17-files/>17-Files</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/18-strings/>18-Strings</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/19-type-information/>19-Type-Information</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/20-generics/>20-Generics</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/21-arrays/>21-Arrays</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/22-enumerations/>22-Enumerations</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/23-annotations/>23-Annotations</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/24-concurrent-programming/>24-Concurrent-Programming</a></li><li class="child level active"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/25-patterns/>25-Patterns</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-becoming-a-programmer/>Appendix-Becoming-a-Programmer</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-benefits-and-costs-of-static-type-checking/>Appendix-Benefits-and-Costs-of-Static-Type-Checking</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-collection-topics/>Appendix-Collection-Topics</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-data-compression/>Appendix-Data-Compression</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-io-streams/>Appendix-IO-Streams</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-javadoc/>Appendix-Javadoc</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-low-level-concurrency/>Appendix-Low-Level-Concurrency</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-new-io/>Appendix-New-IO</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-object-serialization/>Appendix-Object-Serialization</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-passing-and-returning-objects/>Appendix-Passing-and-Returning-Objects</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-programming-guidelines/>Appendix-Programming-Guidelines</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-standard-io/>Appendix-Standard-IO</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-supplements/>Appendix-Supplements</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-the-positive-legacy-of-c-plus-plus-and-java/>Appendix-The-Positive-Legacy-of-C-plus-plus-and-Java</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-understanding-equals-and-hashcode/>Appendix-Understanding-equals-and-hashCode</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/glossary/>GLOSSARY</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id214ecc87c188b2007b2d478ce6167fb1")' href=#id214ecc87c188b2007b2d478ce6167fb1 aria-expanded=false aria-controls=id214ecc87c188b2007b2d478ce6167fb1 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/>Think in Java</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id214ecc87c188b2007b2d478ce6167fb1 aria-expanded=false aria-controls=id214ecc87c188b2007b2d478ce6167fb1><i class="fa-solid fa-angle-right" id=caret-id214ecc87c188b2007b2d478ce6167fb1></i></a></div><ul class="nav docs-sidenav collapse" id=id214ecc87c188b2007b2d478ce6167fb1><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idca73ee751e8224db415e54c000dd27fb")' href=#idca73ee751e8224db415e54c000dd27fb aria-expanded=false aria-controls=idca73ee751e8224db415e54c000dd27fb aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/>1.对象入门</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idca73ee751e8224db415e54c000dd27fb aria-expanded=false aria-controls=idca73ee751e8224db415e54c000dd27fb><i class="fa-solid fa-angle-right" id=caret-idca73ee751e8224db415e54c000dd27fb></i></a></div><ul class="nav docs-sidenav collapse" id=idca73ee751e8224db415e54c000dd27fb><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.1-%E6%8A%BD%E8%B1%A1%E7%9A%84%E8%BF%9B%E6%AD%A5/>1.1 抽象的进步</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.10-%E6%B0%B8%E4%B9%85%E6%80%A7/>1.10 永久性</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.11-java%E5%92%8C%E5%9B%A0%E7%89%B9%E7%BD%91/>1.11 Java和因特网</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.12-%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1/>1.12 分析和设计</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.13-java%E8%BF%98%E6%98%AFc++/>1.13 Java还是C++</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.2-%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%8E%A5%E5%8F%A3/>1.2 对象的接口</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.3-%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88%E7%9A%84%E9%9A%90%E8%97%8F/>1.3 实现方案的隐藏</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.4-%E6%96%B9%E6%A1%88%E7%9A%84%E9%87%8D%E5%A4%8D%E4%BD%BF%E7%94%A8/>1.4 方案的重复使用</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.5-%E7%BB%A7%E6%89%BF%E9%87%8D%E6%96%B0%E4%BD%BF%E7%94%A8%E6%8E%A5%E5%8F%A3/>1.5 继承：重新使用接口</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.6-%E5%A4%9A%E6%80%81%E5%AF%B9%E8%B1%A1%E7%9A%84%E4%BA%92%E6%8D%A2%E4%BD%BF%E7%94%A8/>1.6 多态对象的互换使用</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.7-%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E5%AD%98%E5%9C%A8%E6%97%B6%E9%97%B4/>1.7 对象的创建和存在时间</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.9-%E5%A4%9A%E7%BA%BF%E7%A8%8B/>1.9 多线程</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ide41bfd2e5eef4f5cc967d0bf0d3beae5")' href=#ide41bfd2e5eef4f5cc967d0bf0d3beae5 aria-expanded=false aria-controls=ide41bfd2e5eef4f5cc967d0bf0d3beae5 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/>10.Java IO 系统</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ide41bfd2e5eef4f5cc967d0bf0d3beae5 aria-expanded=false aria-controls=ide41bfd2e5eef4f5cc967d0bf0d3beae5><i class="fa-solid fa-angle-right" id=caret-ide41bfd2e5eef4f5cc967d0bf0d3beae5></i></a></div><ul class="nav docs-sidenav collapse" id=ide41bfd2e5eef4f5cc967d0bf0d3beae5><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.1-%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA/>10.1 输入和输出</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.10-%E6%80%BB%E7%BB%93/>10.10 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.11-%E7%BB%83%E4%B9%A0/>10.11 练习</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.2-%E5%A2%9E%E6%B7%BB%E5%B1%9E%E6%80%A7%E5%92%8C%E6%9C%89%E7%94%A8%E7%9A%84%E6%8E%A5%E5%8F%A3/>10.2 增添属性和有用的接口</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.3-%E6%9C%AC%E8%BA%AB%E7%9A%84%E7%BC%BA%E9%99%B7randomaccessfile/>10.3 本身的缺陷：RandomAccessFile</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.4-file%E7%B1%BB/>10.4 File类</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.5-io%E6%B5%81%E7%9A%84%E5%85%B8%E5%9E%8B%E5%BA%94%E7%94%A8/>10.5 IO流的典型应用</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.6-streamtokenizer/>10.6 StreamTokenizer</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.7-java-1.1%E7%9A%84io%E6%B5%81/>10.7 Java 1.1的IO流</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.8-%E5%8E%8B%E7%BC%A9/>10.8 压缩</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.9-%E5%AF%B9%E8%B1%A1%E5%BA%8F%E5%88%97%E5%8C%96/>10.9 对象序列化</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idb836ac598092c15afaccbaa2c465c59e")' href=#idb836ac598092c15afaccbaa2c465c59e aria-expanded=false aria-controls=idb836ac598092c15afaccbaa2c465c59e aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/>11.运行期类型鉴定</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idb836ac598092c15afaccbaa2c465c59e aria-expanded=false aria-controls=idb836ac598092c15afaccbaa2c465c59e><i class="fa-solid fa-angle-right" id=caret-idb836ac598092c15afaccbaa2c465c59e></i></a></div><ul class="nav docs-sidenav collapse" id=idb836ac598092c15afaccbaa2c465c59e><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/11.1-%E5%AF%B9rtti%E7%9A%84%E9%9C%80%E8%A6%81/>11.1 对RTTI的需要</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/11.2-rtti-%E8%AF%AD%E6%B3%95/>11.2 RTTI 语法</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/11.3-%E5%8F%8D%E5%B0%84%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E4%BF%A1%E6%81%AF/>11.3 反射：运行期类信息</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/11.4-%E6%80%BB%E7%BB%93/>11.4 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/11.5-%E7%BB%83%E4%B9%A0/>11.5 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ide320911890134774be5931d1a0a20cc9")' href=#ide320911890134774be5931d1a0a20cc9 aria-expanded=false aria-controls=ide320911890134774be5931d1a0a20cc9 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/>12.传递和返回对象</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ide320911890134774be5931d1a0a20cc9 aria-expanded=false aria-controls=ide320911890134774be5931d1a0a20cc9><i class="fa-solid fa-angle-right" id=caret-ide320911890134774be5931d1a0a20cc9></i></a></div><ul class="nav docs-sidenav collapse" id=ide320911890134774be5931d1a0a20cc9><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.1-%E4%BC%A0%E9%80%92%E6%8C%87%E9%92%88/>12.1 传递指针</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.2-%E5%88%B6%E4%BD%9C%E6%9C%AC%E5%9C%B0%E5%89%AF%E6%9C%AC/>12.2 制作本地副本</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.3-%E5%85%8B%E9%9A%86%E7%9A%84%E6%8E%A7%E5%88%B6/>12.3 克隆的控制</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.4-%E5%8F%AA%E8%AF%BB%E7%B1%BB/>12.4 只读类</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.5-%E6%80%BB%E7%BB%93/>12.5 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.6-%E7%BB%83%E4%B9%A0/>12.6 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-iddba1dfa22d26f49d68205d3c67fa5695")' href=#iddba1dfa22d26f49d68205d3c67fa5695 aria-expanded=false aria-controls=iddba1dfa22d26f49d68205d3c67fa5695 aria-hidden=false data-toggle=collapse></div></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idbb7b9ed9f3766574125ce978e02ab9b3")' href=#idbb7b9ed9f3766574125ce978e02ab9b3 aria-expanded=false aria-controls=idbb7b9ed9f3766574125ce978e02ab9b3 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/>14.多线程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idbb7b9ed9f3766574125ce978e02ab9b3 aria-expanded=false aria-controls=idbb7b9ed9f3766574125ce978e02ab9b3><i class="fa-solid fa-angle-right" id=caret-idbb7b9ed9f3766574125ce978e02ab9b3></i></a></div><ul class="nav docs-sidenav collapse" id=idbb7b9ed9f3766574125ce978e02ab9b3><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.1-%E5%8F%8D%E5%BA%94%E7%81%B5%E6%95%8F%E7%9A%84%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2/>14.1 反应灵敏的用户界面</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.2-%E5%85%B1%E4%BA%AB%E6%9C%89%E9%99%90%E7%9A%84%E8%B5%84%E6%BA%90/>14.2 共享有限的资源</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.3-%E5%A0%B5%E5%A1%9E/>14.3 堵塞</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.4-%E4%BC%98%E5%85%88%E7%BA%A7/>14.4 优先级</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.5-%E5%9B%9E%E9%A1%BErunnable/>14.5 回顾runnable</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.6-%E6%80%BB%E7%BB%93/>14.6 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.7-%E7%BB%83%E4%B9%A0/>14.7 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id0717cbd205b42e749ff12487fe013a48")' href=#id0717cbd205b42e749ff12487fe013a48 aria-expanded=false aria-controls=id0717cbd205b42e749ff12487fe013a48 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/>15.网络编程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id0717cbd205b42e749ff12487fe013a48 aria-expanded=false aria-controls=id0717cbd205b42e749ff12487fe013a48><i class="fa-solid fa-angle-right" id=caret-id0717cbd205b42e749ff12487fe013a48></i></a></div><ul class="nav docs-sidenav collapse" id=id0717cbd205b42e749ff12487fe013a48><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.1-%E6%9C%BA%E5%99%A8%E7%9A%84%E6%A0%87%E8%AF%86/>15.1 机器的标识</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.10-%E7%BB%83%E4%B9%A0/>15.10 练习</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.2-%E5%A5%97%E6%8E%A5%E5%AD%97/>15.2 套接字</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.3-%E6%9C%8D%E5%8A%A1%E5%A4%9A%E4%B8%AA%E5%AE%A2%E6%88%B7/>15.3 服务多个客户</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.4-%E6%95%B0%E6%8D%AE%E6%8A%A5/>15.4 数据报</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.5-%E4%B8%80%E4%B8%AAweb%E5%BA%94%E7%94%A8/>15.5 一个Web应用</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.6-java%E4%B8%8Ecgi%E7%9A%84%E6%B2%9F%E9%80%9A/>15.6 Java与CGI的沟通</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.7-%E7%94%A8jdbc%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93/>15.7 用JDBC连接数据库</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.8-%E8%BF%9C%E7%A8%8B%E6%96%B9%E6%B3%95/>15.8 远程方法</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.9-%E6%80%BB%E7%BB%93/>15.9 总结</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idb45833a961ce68d05972119f0bd5689d")' href=#idb45833a961ce68d05972119f0bd5689d aria-expanded=false aria-controls=idb45833a961ce68d05972119f0bd5689d aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/>16.设计范式</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idb45833a961ce68d05972119f0bd5689d aria-expanded=false aria-controls=idb45833a961ce68d05972119f0bd5689d><i class="fa-solid fa-angle-right" id=caret-idb45833a961ce68d05972119f0bd5689d></i></a></div><ul class="nav docs-sidenav collapse" id=idb45833a961ce68d05972119f0bd5689d><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.1-%E8%8C%83%E5%BC%8F%E7%9A%84%E6%A6%82%E5%BF%B5/>16.1 范式的概念</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.10-%E7%BB%83%E4%B9%A0/>16.10 练习</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.2-%E8%A7%82%E5%AF%9F%E5%99%A8%E8%8C%83%E5%BC%8F/>16.2 观察器范式</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.3-%E6%A8%A1%E6%8B%9F%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AB%99/>16.3 模拟垃圾回收站</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.4-%E6%94%B9%E8%BF%9B%E8%AE%BE%E8%AE%A1/>16.4 改进设计</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.5-%E6%8A%BD%E8%B1%A1%E7%9A%84%E5%BA%94%E7%94%A8/>16.5 抽象的应用</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.6-%E5%A4%9A%E9%87%8D%E6%B4%BE%E9%81%A3/>16.6 多重派遣</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.7-%E8%AE%BF%E9%97%AE%E5%99%A8%E8%8C%83%E5%BC%8F/>16.7 访问器范式</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.8-rtti%E7%9C%9F%E7%9A%84%E6%9C%89%E5%AE%B3%E5%90%97/>16.8 RTTI真的有害吗</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.9-%E6%80%BB%E7%BB%93/>16.9 总结</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id9dcdb57b589db03f63de5260a0331b23")' href=#id9dcdb57b589db03f63de5260a0331b23 aria-expanded=false aria-controls=id9dcdb57b589db03f63de5260a0331b23 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/>17.项目</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id9dcdb57b589db03f63de5260a0331b23 aria-expanded=false aria-controls=id9dcdb57b589db03f63de5260a0331b23><i class="fa-solid fa-angle-right" id=caret-id9dcdb57b589db03f63de5260a0331b23></i></a></div><ul class="nav docs-sidenav collapse" id=id9dcdb57b589db03f63de5260a0331b23><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/17.1-%E6%96%87%E5%AD%97%E5%A4%84%E7%90%86/>17.1 文字处理</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/17.2-%E6%96%B9%E6%B3%95%E6%9F%A5%E6%89%BE%E5%B7%A5%E5%85%B7/>17.2 方法查找工具</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/17.3-%E5%A4%8D%E6%9D%82%E6%80%A7%E7%90%86%E8%AE%BA/>17.3 复杂性理论</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/17.4-%E6%80%BB%E7%BB%93/>17.4 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/17.5-%E7%BB%83%E4%B9%A0/>17.5 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idf0960bbb6faeb4cccffb1ac69252ea28")' href=#idf0960bbb6faeb4cccffb1ac69252ea28 aria-expanded=false aria-controls=idf0960bbb6faeb4cccffb1ac69252ea28 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/>2.一切都是对象</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idf0960bbb6faeb4cccffb1ac69252ea28 aria-expanded=false aria-controls=idf0960bbb6faeb4cccffb1ac69252ea28><i class="fa-solid fa-angle-right" id=caret-idf0960bbb6faeb4cccffb1ac69252ea28></i></a></div><ul class="nav docs-sidenav collapse" id=idf0960bbb6faeb4cccffb1ac69252ea28><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.1-%E7%94%A8%E6%8C%87%E9%92%88%E6%93%8D%E7%BA%B5%E5%AF%B9%E8%B1%A1/>2.1 用指针操纵对象</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.10-%E6%80%BB%E7%BB%93/>2.10 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.11-%E7%BB%83%E4%B9%A0/>2.11 练习</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.2-%E6%89%80%E6%9C%89%E5%AF%B9%E8%B1%A1%E9%83%BD%E5%BF%85%E9%A1%BB%E5%88%9B%E5%BB%BA/>2.2 所有对象都必须创建</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.3-%E7%BB%9D%E5%AF%B9%E4%B8%8D%E8%A6%81%E6%B8%85%E9%99%A4%E5%AF%B9%E8%B1%A1/>2.3 绝对不要清除对象</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.4-%E6%96%B0%E5%BB%BA%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%B1%BB/>2.4 新建数据类型：类</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.5-%E6%96%B9%E6%B3%95%E8%87%AA%E5%8F%98%E9%87%8F%E5%92%8C%E8%BF%94%E5%9B%9E%E5%80%BC/>2.5 方法、自变量和返回值</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.6-%E6%9E%84%E5%BB%BAjava%E7%A8%8B%E5%BA%8F/>2.6 构建Java程序</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.7-%E6%88%91%E4%BB%AC%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AAjava%E7%A8%8B%E5%BA%8F/>2.7 我们的第一个Java程序</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.8-%E6%B3%A8%E9%87%8A%E5%92%8C%E5%B5%8C%E5%85%A5%E6%96%87%E6%A1%A3/>2.8 注释和嵌入文档</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.9-%E7%BC%96%E7%A0%81%E6%A0%B7%E5%BC%8F/>2.9 编码样式</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id742622a5c8a24c8f9f9a1ecc037a0f62")' href=#id742622a5c8a24c8f9f9a1ecc037a0f62 aria-expanded=false aria-controls=id742622a5c8a24c8f9f9a1ecc037a0f62 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/3.%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/>3.控制程序流程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id742622a5c8a24c8f9f9a1ecc037a0f62 aria-expanded=false aria-controls=id742622a5c8a24c8f9f9a1ecc037a0f62><i class="fa-solid fa-angle-right" id=caret-id742622a5c8a24c8f9f9a1ecc037a0f62></i></a></div><ul class="nav docs-sidenav collapse" id=id742622a5c8a24c8f9f9a1ecc037a0f62><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/3.%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/3.1-%E4%BD%BF%E7%94%A8java%E8%BF%90%E7%AE%97%E7%AC%A6/>3.1 使用Java运算符</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/3.%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/3.2-%E6%89%A7%E8%A1%8C%E6%8E%A7%E5%88%B6/>3.2 执行控制</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/3.%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/3.3-%E6%80%BB%E7%BB%93/>3.3 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/3.%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/3.4-%E7%BB%83%E4%B9%A0/>3.4 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idada88f416ec1dfab89f033bf872d6408")' href=#idada88f416ec1dfab89f033bf872d6408 aria-expanded=false aria-controls=idada88f416ec1dfab89f033bf872d6408 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/>4.初始化和清除</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idada88f416ec1dfab89f033bf872d6408 aria-expanded=false aria-controls=idada88f416ec1dfab89f033bf872d6408><i class="fa-solid fa-angle-right" id=caret-idada88f416ec1dfab89f033bf872d6408></i></a></div><ul class="nav docs-sidenav collapse" id=idada88f416ec1dfab89f033bf872d6408><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.1-%E7%94%A8%E6%9E%84%E9%80%A0%E5%99%A8%E8%87%AA%E5%8A%A8%E5%88%9D%E5%A7%8B%E5%8C%96/>4.1 用构造器自动初始化</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.2-%E6%96%B9%E6%B3%95%E9%87%8D%E8%BD%BD/>4.2 方法重载</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.3-%E6%B8%85%E9%99%A4%E6%94%B6%E5%B0%BE%E5%92%8C%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/>4.3 清除：收尾和垃圾收集</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.4-%E6%88%90%E5%91%98%E5%88%9D%E5%A7%8B%E5%8C%96/>4.4 成员初始化</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.5-%E6%95%B0%E7%BB%84%E5%88%9D%E5%A7%8B%E5%8C%96/>4.5 数组初始化</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.6-%E6%80%BB%E7%BB%93/>4.6 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.7-%E7%BB%83%E4%B9%A0/>4.7 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idadcf0cac1c984df3c4fe242a8cf5b932")' href=#idadcf0cac1c984df3c4fe242a8cf5b932 aria-expanded=false aria-controls=idadcf0cac1c984df3c4fe242a8cf5b932 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/5.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/>5.隐藏实施过程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idadcf0cac1c984df3c4fe242a8cf5b932 aria-expanded=false aria-controls=idadcf0cac1c984df3c4fe242a8cf5b932><i class="fa-solid fa-angle-right" id=caret-idadcf0cac1c984df3c4fe242a8cf5b932></i></a></div><ul class="nav docs-sidenav collapse" id=idadcf0cac1c984df3c4fe242a8cf5b932><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/5.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.1-%E5%8C%85%E5%BA%93%E5%8D%95%E5%85%83/>5.1 包：库单元</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/5.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.2-java%E8%AE%BF%E9%97%AE%E6%8C%87%E7%A4%BA%E7%AC%A6/>5.2 Java访问指示符</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/5.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.3-%E6%8E%A5%E5%8F%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/>5.3 接口与实现</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/5.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.4-%E7%B1%BB%E8%AE%BF%E9%97%AE/>5.4 类访问</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/5.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.5-%E6%80%BB%E7%BB%93/>5.5 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/5.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.6-%E7%BB%83%E4%B9%A0/>5.6 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id867e4ec83e2a44d87f6aed649979a0c1")' href=#id867e4ec83e2a44d87f6aed649979a0c1 aria-expanded=false aria-controls=id867e4ec83e2a44d87f6aed649979a0c1 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/>6.类再生</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id867e4ec83e2a44d87f6aed649979a0c1 aria-expanded=false aria-controls=id867e4ec83e2a44d87f6aed649979a0c1><i class="fa-solid fa-angle-right" id=caret-id867e4ec83e2a44d87f6aed649979a0c1></i></a></div><ul class="nav docs-sidenav collapse" id=id867e4ec83e2a44d87f6aed649979a0c1><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.1-%E5%90%88%E6%88%90%E7%9A%84%E8%AF%AD%E6%B3%95/>6.1 合成的语法</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.10-%E6%80%BB%E7%BB%93/>6.10 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.11-%E7%BB%83%E4%B9%A0/>6.11 练习</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.2-%E7%BB%A7%E6%89%BF%E7%9A%84%E8%AF%AD%E6%B3%95/>6.2 继承的语法</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.3-%E5%90%88%E6%88%90%E4%B8%8E%E7%BB%A7%E6%89%BF%E7%9A%84%E7%BB%93%E5%90%88/>6.3 合成与继承的结合</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.4-%E5%88%B0%E5%BA%95%E9%80%89%E6%8B%A9%E5%90%88%E6%88%90%E8%BF%98%E6%98%AF%E7%BB%A7%E6%89%BF/>6.4 到底选择合成还是继承</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.5-protected/>6.5 protected</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.6-%E7%B4%AF%E7%A7%AF%E5%BC%80%E5%8F%91/>6.6 累积开发</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.7-%E4%B8%8A%E6%BA%AF%E9%80%A0%E5%9E%8B/>6.7 上溯造型</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.8-final%E5%85%B3%E9%94%AE%E5%AD%97/>6.8 final关键字</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.9-%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E7%B1%BB%E8%A3%85%E8%BD%BD/>6.9 初始化和类装载</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idf3d9d72d599cb56e323c67f4c3e5106c")' href=#idf3d9d72d599cb56e323c67f4c3e5106c aria-expanded=false aria-controls=idf3d9d72d599cb56e323c67f4c3e5106c aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/>7.多态性</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idf3d9d72d599cb56e323c67f4c3e5106c aria-expanded=false aria-controls=idf3d9d72d599cb56e323c67f4c3e5106c><i class="fa-solid fa-angle-right" id=caret-idf3d9d72d599cb56e323c67f4c3e5106c></i></a></div><ul class="nav docs-sidenav collapse" id=idf3d9d72d599cb56e323c67f4c3e5106c><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.1-%E4%B8%8A%E6%BA%AF%E9%80%A0%E5%9E%8B/>7.1 上溯造型</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.10-%E7%BB%83%E4%B9%A0/>7.10 练习</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.2-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/>7.2 深入理解</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.3-%E8%A6%86%E7%9B%96%E4%B8%8E%E9%87%8D%E8%BD%BD/>7.3 覆盖与重载</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.4-%E6%8A%BD%E8%B1%A1%E7%B1%BB%E5%92%8C%E6%96%B9%E6%B3%95/>7.4 抽象类和方法</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.5-%E6%8E%A5%E5%8F%A3/>7.5 接口</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.6-%E5%86%85%E9%83%A8%E7%B1%BB/>7.6 内部类</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.7-%E6%9E%84%E9%80%A0%E5%99%A8%E5%92%8C%E5%A4%9A%E6%80%81%E6%80%A7/>7.7 构造器和多态性</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.8-%E9%80%9A%E8%BF%87%E7%BB%A7%E6%89%BF%E8%BF%9B%E8%A1%8C%E8%AE%BE%E8%AE%A1/>7.8 通过继承进行设计</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.9-%E6%80%BB%E7%BB%93/>7.9 总结</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ide8fec1c6956e847a0af483b3edf921cd")' href=#ide8fec1c6956e847a0af483b3edf921cd aria-expanded=false aria-controls=ide8fec1c6956e847a0af483b3edf921cd aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/>8.对象的容纳</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ide8fec1c6956e847a0af483b3edf921cd aria-expanded=false aria-controls=ide8fec1c6956e847a0af483b3edf921cd><i class="fa-solid fa-angle-right" id=caret-ide8fec1c6956e847a0af483b3edf921cd></i></a></div><ul class="nav docs-sidenav collapse" id=ide8fec1c6956e847a0af483b3edf921cd><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.1-%E6%95%B0%E7%BB%84/>8.1 数组</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.2-%E9%9B%86%E5%90%88/>8.2 集合</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.3-%E8%BF%AD%E4%BB%A3%E5%99%A8/>8.3 迭代器</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.4-%E9%9B%86%E5%90%88%E7%9A%84%E7%B1%BB%E5%9E%8B/>8.4 集合的类型</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.5-%E6%8E%92%E5%BA%8F/>8.5 排序</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.6-%E9%80%9A%E7%94%A8%E9%9B%86%E5%90%88%E5%BA%93/>8.6 通用集合库</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.7-%E6%96%B0%E9%9B%86%E5%90%88/>8.7 新集合</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.8-%E6%80%BB%E7%BB%93/>8.8 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.9-%E7%BB%83%E4%B9%A0/>8.9 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id24b0f4bf6b1849b1d34cc1cf59d9a598")' href=#id24b0f4bf6b1849b1d34cc1cf59d9a598 aria-expanded=false aria-controls=id24b0f4bf6b1849b1d34cc1cf59d9a598 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/9.%E5%BC%82%E5%B8%B8%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6/>9.异常差错控制</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id24b0f4bf6b1849b1d34cc1cf59d9a598 aria-expanded=false aria-controls=id24b0f4bf6b1849b1d34cc1cf59d9a598><i class="fa-solid fa-angle-right" id=caret-id24b0f4bf6b1849b1d34cc1cf59d9a598></i></a></div><ul class="nav docs-sidenav collapse" id=id24b0f4bf6b1849b1d34cc1cf59d9a598><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/9.%E5%BC%82%E5%B8%B8%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6/9.10-%E7%BB%83%E4%B9%A0/>9.10 练习</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/9.%E5%BC%82%E5%B8%B8%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6/9.6-%E7%94%A8finally%E6%B8%85%E9%99%A4/>9.6 用finally清除</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/9.%E5%BC%82%E5%B8%B8%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6/9.7-%E6%9E%84%E9%80%A0%E5%99%A8/>9.7 构造器</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/9.%E5%BC%82%E5%B8%B8%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6/9.9-%E6%80%BB%E7%BB%93/>9.9 总结</a></li></ul></div><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95a-%E4%BD%BF%E7%94%A8%E9%9D%9Ejava%E4%BB%A3%E7%A0%81/>附录A 使用非JAVA代码</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95b-%E5%AF%B9%E6%AF%94c++%E5%92%8Cjava/>附录B 对比C++和Java</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95c-java%E7%BC%96%E7%A8%8B%E8%A7%84%E5%88%99/>附录C Java编程规则</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95d-%E6%80%A7%E8%83%BD/>附录D 性能</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95e-%E5%85%B3%E4%BA%8E%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%9A%84%E4%B8%80%E4%BA%9B%E8%AF%9D/>附录E 关于垃圾收集的一些话</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95f-%E6%8E%A8%E8%8D%90%E8%AF%BB%E7%89%A9/>附录F 推荐读物</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2%E7%9A%84%E8%AF%9D/>写在前面的话</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E5%BC%95%E8%A8%80/>引言</a></li></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#概念>概念</a><ul><li><a href=#单例模式>单例模式</a></li><li><a href=#模式分类>模式分类</a></li></ul></li><li><a href=#构建应用程序框架>构建应用程序框架</a></li><li><a href=#面向实现>面向实现</a></li><li><a href=#工厂模式>工厂模式</a><ul><li><a href=#动态工厂>动态工厂</a></li><li><a href=#多态工厂>多态工厂</a></li><li><a href=#抽象工厂>抽象工厂</a></li></ul></li><li><a href=#函数对象>函数对象</a><ul><li><a href=#命令模式>命令模式</a></li><li><a href=#策略模式>策略模式</a></li><li><a href=#责任链模式>责任链模式</a></li></ul></li><li><a href=#改变接口>改变接口</a><ul><li><a href=#适配器模式adapter>适配器模式（Adapter）</a></li><li><a href=#外观模式façade>外观模式（Façade）</a></li></ul></li><li><a href=#解释器运行时的弹性>解释器：运行时的弹性</a></li><li><a href=#回调>回调</a></li><li><a href=#多次调度>多次调度</a></li><li><a href=#模式重构>模式重构</a></li><li><a href=#抽象用法>抽象用法</a></li><li><a href=#多次派遣>多次派遣</a></li><li><a href=#访问者模式>访问者模式</a></li><li><a href=#rtti-的优劣>RTTI 的优劣</a></li><li><a href=#本章小结>本章小结</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>25-Patterns</h1><div class=article-style><h1 id=第二十五章-设计模式>第二十五章 设计模式</h1><h2 id=概念>概念</h2><p>最初，你可以将模式视为解决特定类问题的一种特别巧妙且有深刻见解的方法。这就像前辈已经从所有角度去解决问题，并提出了最通用，最灵活的解决方案。问题可能是你之前看到并解决过的问题，但你的解决方案可能没有你在模式中体现的那种完整性。</p><p>虽然它们被称为“设计模式”，但它们实际上并不与设计领域相关联。模式似乎与传统的分析、设计和实现的思维方式不同。相反，模式在程序中体现了一个完整的思想，因此它有时会出现在分析阶段或高级设计阶段。因为模式在代码中有一个直接的实现，所以你可能不会期望模式在低级设计或实现之前出现(而且通常在到达这些阶段之前，你不会意识到需要一个特定的模式)。</p><p>模式的基本概念也可以看作是程序设计的基本概念:添加抽象层。当你抽象一些东西的时候，就像在剥离特定的细节，而这背后最重要的动机之一是:</p><blockquote><p><strong>将易变的事物与不变的事物分开</strong></p></blockquote><p>另一种方法是，一旦你发现程序的某些部分可能因某种原因而发生变化，你要保持这些变化不会引起整个代码中其他变化。 如果代码更容易理解，那么维护起来会更容易。</p><p>通常，开发一个优雅且易维护设计中最困难的部分是发现我称之为变化的载体（也就是最易改变的地方）。这意味着找到系统中最重要的变化，换而言之，找到变化会导致最严重后果的地方。一旦发现变化载体，就可以围绕构建设计的焦点。</p><p>因此，设计模式的目标是隔离代码中的更改。 如果以这种方式去看，你已经在本书中看到了设计模式。 例如，继承可以被认为是一种设计模式（虽然是由编译器实现的）。它允许你表达所有具有相同接口的对象（即保持相同的行为）中的行为差异（这就是变化的部分）。组合也可以被视为一种模式，因为它允许你动态或静态地更改实现类的对象，从而改变类的工作方式。</p><p>你还看到了设计模式中出现的另一种模式：迭代器（Java 1.0 和 1.1 随意地将其称为枚举; Java 2 集合才使用 Iterator）。当你逐个选择元素时并逐步处理，这会隐藏集合的特定实现。迭代器允许你编写通用代码，该代码对序列中的所有元素执行操作，而不考虑序列的构建方式。因此，你的通用代码可以与任何可以生成迭代器的集合一起使用。</p><p>即使模式是非常有用的，但有些人断言：</p><blockquote><p><strong>设计模式代表语言的失败。</strong></p></blockquote><p>这是一个非常重要的见解，因为一个模式在 C++ 有意义，可能在 JAVA 或者其他语言中就没有意义。出于这个原因，所以一个模式可能出现在设计模式书上，不意味着应用于你的编程语言是有用的。</p><p>我认为“语言失败”这个观点是有道理的，但是我也认为这个观点过于简单化。如果你试图解决一个特定的问题，而你使用的语言没有直接提供支持你使用的技巧，你可以说这个是语言的失败。但是，你使用特定的技巧的频率的是多少呢？也许平衡是对的：当你使用特定的技巧的时候，你必须付出更多的努力，但是你又没有足够的理由去使得语言支持这个技术。另一方面，没有语言的支持，使用这种技术常常会很混乱，但是在语言支持下，你可能会改变编程方式（例如，Java 8 流实现此目的）。</p><h3 id=单例模式>单例模式</h3><p>也许单例模式是最简单的设计模式，它是一种提供一个且只有一个对象实例的方法。这在 java 库中使用，但是这有个更直接的示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// patterns/SingletonPattern.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>interface</span> <span class=nc>Resource</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=nf>getValue</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>setValue</span><span class=o>(</span><span class=kt>int</span> <span class=n>x</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>* 由于这不是从Cloneable基类继承而且没有添加可克隆性，
</span></span></span><span class=line><span class=cl><span class=cm>* 因此将其设置为final可防止通过继承添加可克隆性。
</span></span></span><span class=line><span class=cl><span class=cm>* 这也实现了线程安全的延迟初始化：
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span><span class=line><span class=cl><span class=kd>final</span> <span class=kd>class</span> <span class=nc>Singleton</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kd>class</span> <span class=nc>ResourceImpl</span> <span class=kd>implements</span> <span class=n>Resource</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=kt>int</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=nf>ResourceImpl</span><span class=o>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>i</span> <span class=o>=</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kd>synchronized</span> <span class=kt>int</span> <span class=nf>getValue</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kd>synchronized</span> <span class=kt>void</span> <span class=nf>setValue</span><span class=o>(</span><span class=kt>int</span> <span class=n>x</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>i</span> <span class=o>=</span> <span class=n>x</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>ResourceHolder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=kd>static</span> <span class=n>Resource</span> <span class=n>resource</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ResourceImpl</span><span class=o>(</span><span class=mi>47</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Resource</span> <span class=nf>getResource</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>ResourceHolder</span><span class=o>.</span><span class=na>resource</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SingletonPattern</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Resource</span> <span class=n>r</span> <span class=o>=</span> <span class=n>Singleton</span><span class=o>.</span><span class=na>getResource</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>r</span><span class=o>.</span><span class=na>getValue</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>Resource</span> <span class=n>s2</span> <span class=o>=</span> <span class=n>Singleton</span><span class=o>.</span><span class=na>getResource</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>s2</span><span class=o>.</span><span class=na>setValue</span><span class=o>(</span><span class=mi>9</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>r</span><span class=o>.</span><span class=na>getValue</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>             <span class=c1>// 不能这么做，会发生：compile-time error（编译时错误）.
</span></span></span><span class=line><span class=cl><span class=c1></span>             <span class=c1>// Singleton s3 = (Singleton)s2.clone();
</span></span></span><span class=line><span class=cl><span class=c1></span>             <span class=o>}</span> <span class=k>catch</span><span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                 <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=o>(</span><span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>             <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=cm>/* Output: 47 9 */</span>
</span></span></code></pre></div><p>创建单例的关键是防止客户端程序员直接创建对象。 在这里，这是通过在 Singleton 类中将 Resource 的实现作为私有类来实现的。</p><p>此时，你将决定如何创建对象。在这里，它是按需创建的，在第一次访问的时候创建。 该对象是私有的，只能通过 public getResource（）方法访问。</p><p>懒惰地创建对象的原因是它嵌套的私有类 resourceHolder 在首次引用之前不会加载（在 getResource（）中）。当 Resource 对象加载的时候，静态初始化块将被调用。由于 JVM 的工作方式，这种静态初始化是线程安全的。为保证线程安全，Resource 中的 getter 和 setter 是同步的。</p><h3 id=模式分类>模式分类</h3><p>“设计模式”一书讨论了 23 种不同的模式，分为以下三种类别（所有这些模式都围绕着可能变化的特定方面）。</p><ol><li><p><strong>创建型</strong>：如何创建对象。 这通常涉及隔离对象创建的细节，这样你的代码就不依赖于具体的对象的类型，因此在添加新类型的对象时不会更改。单例模式（Singleton）被归类为创作模式，本章稍后你将看到 Factory Method 的示例。</p></li><li><p><strong>构造型</strong>：设计对象以满足特定的项目约束。它们处理对象与其他对象连接的方式，以确保系统中的更改不需要更改这些连接。</p></li><li><p><strong>行为型</strong>：处理程序中特定类型的操作的对象。这些封装要执行的过程，例如解释语言、实现请求、遍历序列(如在迭代器中)或实现算法。本章包含观察者和访问者模式的例子。</p></li></ol><p>《设计模式》一书中每个设计模式都有单独的一个章节，每个章节都有一个或者多个例子，通常使用 C++，但有时也使用 SmallTalk。 本章不重复设计模式中显示的所有模式，因为该书独立存在，应单独研究。 相反，你会看到一些示例，可以为你提供关于模式的理解以及它们如此重要的原因。</p><h2 id=构建应用程序框架>构建应用程序框架</h2><p>应用程序框架允许您从一个类或一组类开始，创建一个新的应用程序，重用现有类中的大部分代码，并根据需要覆盖一个或多个方法来定制应用程序。</p><p><strong>模板方法模式</strong></p><p>应用程序框架中的一个基本概念是模板方法模式，它通常隐藏在底层，通过调用基类中的各种方法来驱动应用程序(为了创建应用程序，您已经覆盖了其中的一些方法)。</p><p>模板方法模式的一个重要特性是它是在基类中定义的，并且不能更改。它有时是一个 <strong>private</strong> 方法，但实际上总是 <strong>final</strong>。它调用其他基类方法(您覆盖的那些)来完成它的工作,但是它通常只作为初始化过程的一部分被调用(因此框架使用者不一定能够直接调用它)。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=c1>// patterns/TemplateMethod.java
</span></span></span><span class=line><span class=cl><span class=c1>// Simple demonstration of Template Method
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>ApplicationFramework</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ApplicationFramework</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>templateMethod</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>customize1</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>customize2</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// &#34;private&#34; means automatically &#34;final&#34;:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>templateMethod</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>IntStream</span><span class=o>.</span><span class=na>range</span><span class=o>(</span><span class=mi>0</span><span class=o>,</span> <span class=mi>5</span><span class=o>).</span><span class=na>forEach</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=n>n</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                    <span class=n>customize1</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                    <span class=n>customize2</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=o>});</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create a new &#34;application&#34;:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>class</span> <span class=nc>MyApp</span> <span class=kd>extends</span> <span class=n>ApplicationFramework</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>customize1</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>print</span><span class=o>(</span><span class=s>&#34;Hello &#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>customize2</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;World!&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>TemplateMethod</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>MyApp</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=cm>/* Output:
</span></span></span><span class=line><span class=cl><span class=cm>Hello World!
</span></span></span><span class=line><span class=cl><span class=cm>Hello World!
</span></span></span><span class=line><span class=cl><span class=cm>Hello World!
</span></span></span><span class=line><span class=cl><span class=cm>Hello World!
</span></span></span><span class=line><span class=cl><span class=cm>Hello World!
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p>基类构造函数负责执行必要的初始化，然后启动运行应用程序的“engine”(模板方法模式)(在 GUI 应用程序中，这个“engine”是主事件循环)。框架使用者只提供
<strong>customize1()</strong> 和 <strong>customize2()</strong> 的定义，然后“应用程序”已经就绪运行。</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=images/designproxy.png alt loading=lazy data-zoomable></div></div></figure></p><h2 id=面向实现>面向实现</h2><p>代理模式和桥接模式都提供了在代码中使用的代理类;完成工作的真正类隐藏在这个代理类的后面。当您在代理中调用一个方法时，它只是反过来调用实现类中的方法。这两种模式非常相似，所以代理模式只是桥接模式的一种特殊情况。人们倾向于将两者合并,称为代理模式，但是术语“代理”有一个长期的和专门的含义，这可能解释了这两种模式不同的原因。基本思想很简单:从基类派生代理，同时派生一个或多个提供实现的类:创建代理对象时，给它一个可以调用实际工作类的方法的实现。</p><p>在结构上，代理模式和桥接模式的区别很简单:代理模式只有一个实现，而桥接模式有多个实现。在设计模式中被认为是不同的:代理模式用于控制对其实现的访问，而桥接模式允许您动态更改实现。但是，如果您扩展了“控制对实现的访问”的概念，那么这两者就可以完美地结合在一起</p><p><strong>代理模式</strong></p><p>如果我们按照上面的关系图实现，它看起来是这样的:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=c1>// patterns/ProxyDemo.java
</span></span></span><span class=line><span class=cl><span class=c1>// Simple demonstration of the Proxy pattern
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>interface</span> <span class=nc>ProxyBase</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>f</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>g</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>h</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Proxy</span> <span class=kd>implements</span> <span class=n>ProxyBase</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>ProxyBase</span> <span class=n>implementation</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Proxy</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>implementation</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Implementation</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Pass method calls to the implementation:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>f</span><span class=o>()</span> <span class=o>{</span> <span class=n>implementation</span><span class=o>.</span><span class=na>f</span><span class=o>();</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>g</span><span class=o>()</span> <span class=o>{</span> <span class=n>implementation</span><span class=o>.</span><span class=na>g</span><span class=o>();</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>h</span><span class=o>()</span> <span class=o>{</span> <span class=n>implementation</span><span class=o>.</span><span class=na>h</span><span class=o>();</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Implementation</span> <span class=kd>implements</span> <span class=n>ProxyBase</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>f</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Implementation.f()&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>g</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Implementation.g()&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>h</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Implementation.h()&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ProxyDemo</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Proxy</span> <span class=n>p</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Proxy</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>.</span><span class=na>f</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>.</span><span class=na>g</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>.</span><span class=na>h</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>Output:
</span></span></span><span class=line><span class=cl><span class=cm>Implementation.f()
</span></span></span><span class=line><span class=cl><span class=cm>Implementation.g()
</span></span></span><span class=line><span class=cl><span class=cm>Implementation.h()
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p>具体实现不需要与代理对象具有相同的接口;只要代理对象以某种方式“代表具体实现的方法调用，那么基本思想就算实现了。然而，拥有一个公共接口是很方便的，因此具体实现必须实现代理对象调用的所有方法。</p><p><strong>状态模式</strong></p><p>状态模式向代理对象添加了更多的实现，以及在代理对象的生命周期内从一个实现切换到另一种实现的方法:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=c1>// patterns/StateDemo.java // Simple demonstration of the State pattern
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>interface</span> <span class=nc>StateBase</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>f</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>g</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>h</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>changeImp</span><span class=o>(</span><span class=n>StateBase</span> <span class=n>newImp</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>State</span> <span class=kd>implements</span> <span class=n>StateBase</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>StateBase</span> <span class=n>implementation</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>State</span><span class=o>(</span><span class=n>StateBase</span> <span class=n>imp</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>implementation</span> <span class=o>=</span> <span class=n>imp</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>changeImp</span><span class=o>(</span><span class=n>StateBase</span> <span class=n>newImp</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>implementation</span> <span class=o>=</span> <span class=n>newImp</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Pass method calls to the implementation:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>f</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>implementation</span><span class=o>.</span><span class=na>f</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>g</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>implementation</span><span class=o>.</span><span class=na>g</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>h</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>implementation</span><span class=o>.</span><span class=na>h</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Implementation1</span> <span class=kd>implements</span> <span class=n>StateBase</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>f</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Implementation1.f()&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>g</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Implementation1.g()&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>h</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Implementation1.h()&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>changeImp</span><span class=o>(</span><span class=n>StateBase</span> <span class=n>newImp</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Implementation2</span> <span class=kd>implements</span> <span class=n>StateBase</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>f</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Implementation2.f()&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>g</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Implementation2.g()&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>h</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Implementation2.h()&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>changeImp</span><span class=o>(</span><span class=n>StateBase</span> <span class=n>newImp</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>StateDemo</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>test</span><span class=o>(</span><span class=n>StateBase</span> <span class=n>b</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span><span class=o>.</span><span class=na>f</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span><span class=o>.</span><span class=na>g</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span><span class=o>.</span><span class=na>h</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>StateBase</span> <span class=n>b</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>                <span class=k>new</span> <span class=n>State</span><span class=o>(</span><span class=k>new</span> <span class=n>Implementation1</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=n>b</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span><span class=o>.</span><span class=na>changeImp</span><span class=o>(</span><span class=k>new</span> <span class=n>Implementation2</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=n>b</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=cm>/* Output:
</span></span></span><span class=line><span class=cl><span class=cm>Implementation1.f()
</span></span></span><span class=line><span class=cl><span class=cm>Implementation1.g()
</span></span></span><span class=line><span class=cl><span class=cm>Implementation1.h()
</span></span></span><span class=line><span class=cl><span class=cm>Implementation2.f()
</span></span></span><span class=line><span class=cl><span class=cm>Implementation2.g()
</span></span></span><span class=line><span class=cl><span class=cm>Implementation2.h()
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p>在 main()中，首先使用第一个实现，然后改变成第二个实现。代理模式和状态模式的区别在于它们解决的问题。设计模式中描述的代理模式的常见用途如下:</p><ol><li><p>远程代理。它在不同的地址空间中代理对象。远程方法调用(RMI)编译器 rmic 会自动为您创建一个远程代理。</p></li><li><p>虚拟代理。这提供了“懒加载”来根据需要创建“昂贵”的对象。</p></li><li><p>保护代理。当您希望对代理对象有权限访问控制时使用。</p></li><li><p>智能引用。要在被代理的对象被访问时添加其他操作。例如，跟踪特定对象的引用数量，来实现写时复制用法，和防止对象别名。一个更简单的例子是跟踪特定方法的调用数量。您可以将 Java 引用视为一种保护代理，因为它控制在堆上实例对象的访问(例如，确保不使用空引用)。</p></li></ol><p>在设计模式中，代理模式和桥接模式并不是相互关联的，因为它们被赋予(我认为是任意的)不同的结构。桥接模式,特别是使用一个单独的实现，但这似乎对我来说是不必要的,除非你确定该实现是你无法控制的(当然有可能，但是如果您编写所有代码，那么没有理由不从单基类的优雅中受益)。此外，只要代理对象控制对其“前置”对象的访问，代模式理就不需要为其实现使用相同的基类。不管具体情况如何，在代理模式和桥接模式中，代理对象都将方法调用传递给具体实现对象。</p><p><strong>状态机</strong></p><p>桥接模式允许程序员更改实现，状态机利用一个结构来自动地将实现更改到下一个。当前实现表示系统所处的状态，系统在不同状态下的行为不同(因为它使用桥接模式)。基本上，这是一个利用对象的“状态机”。将系统从一种状态移动到另一种状态的代码通常是模板方法模式，如下例所示:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=c1>// patterns/state/StateMachineDemo.java
</span></span></span><span class=line><span class=cl><span class=c1>// The StateMachine pattern and Template method
</span></span></span><span class=line><span class=cl><span class=c1>// {java patterns.state.StateMachineDemo}
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nn>patterns.state</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>onjava.Nap</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>interface</span> <span class=nc>State</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>run</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>StateMachine</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=n>State</span> <span class=n>currentState</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kd>abstract</span> <span class=kt>boolean</span> <span class=nf>changeState</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Template method:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>protected</span> <span class=kd>final</span> <span class=kt>void</span> <span class=nf>runAll</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=o>(</span><span class=n>changeState</span><span class=o>())</span> <span class=c1>// Customizable
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>currentState</span><span class=o>.</span><span class=na>run</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// A different subclass for each state:
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Wash</span> <span class=kd>implements</span> <span class=n>State</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Washing&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>Nap</span><span class=o>(</span><span class=mf>0.5</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Spin</span> <span class=kd>implements</span> <span class=n>State</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Spinning&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>Nap</span><span class=o>(</span><span class=mf>0.5</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Rinse</span> <span class=kd>implements</span> <span class=n>State</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Rinsing&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>Nap</span><span class=o>(</span><span class=mf>0.5</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Washer</span> <span class=kd>extends</span> <span class=n>StateMachine</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// The state table:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>private</span> <span class=n>State</span><span class=o>[]</span> <span class=n>states</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>new</span> <span class=n>Wash</span><span class=o>(),</span> <span class=k>new</span> <span class=n>Spin</span><span class=o>(),</span>
</span></span><span class=line><span class=cl>            <span class=k>new</span> <span class=n>Rinse</span><span class=o>(),</span> <span class=k>new</span> <span class=n>Spin</span><span class=o>(),</span>
</span></span><span class=line><span class=cl>    <span class=o>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Washer</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>runAll</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>changeState</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>i</span> <span class=o>&lt;</span> <span class=n>states</span><span class=o>.</span><span class=na>length</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// Change the state by setting the
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>// surrogate reference to a new object:
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>currentState</span> <span class=o>=</span> <span class=n>states</span><span class=o>[</span><span class=n>i</span><span class=o>++];</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>StateMachineDemo</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>Washer</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=cm>/* Output:
</span></span></span><span class=line><span class=cl><span class=cm>Washing
</span></span></span><span class=line><span class=cl><span class=cm>Spinning
</span></span></span><span class=line><span class=cl><span class=cm>Rinsing
</span></span></span><span class=line><span class=cl><span class=cm>Spinning
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p>在这里，控制状态的类(本例中是状态机)负责决定下一个状态。然而，状态对象本身也可以决定下一步移动到什么状态，通常基于系统的某种输入。这是更灵活的解决方案。</p><h2 id=工厂模式>工厂模式</h2><p>当你发现必须将新类型添加到系统中时，合理的第一步是使用多态性为这些新类型创建一个通用接口。这会将你系统中的其余代码与要添加的特定类型的信息分开，使得可以在不改变现有代码的情况下添加新类型……或者看起来如此。起初，在这种设计中，似乎你必须更改代码的唯一地方就是你继承新类型的地方，但这并不是完全正确的。 你仍然必须创建新类型的对象，并且在创建时必须指定要使用的确切构造器。因此，如果创建对象的代码分布在整个应用程序中，那么在添加新类型时，你将遇到相同的问题——你仍然必须追查你代码中新类型碍事的所有地方。恰好是类型的创建碍事，而不是类型的使用（通过多态处理），但是效果是一样的：添加新类型可能会引起问题。</p><p>解决方案是强制对象的创建都通过通用工厂进行，而不是允许创建代码在整个系统中传播。 如果你程序中的所有代码都必须执行通过该工厂创建你的一个对象，那么在添加新类时只需要修改工厂即可。</p><p>由于每个面向对象的程序都会创建对象，并且很可能会通过添加新类型来扩展程序，因此工厂是最通用的设计模式之一。</p><p>举例来说，让我们重新看一下<strong>Shape</strong>系统。 首先，我们需要一个用于所有示例的基本框架。 如果无法创建<strong>Shape</strong>对象，则需要抛出一个合适的异常：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// patterns/shapes/BadShapeCreation.java package patterns.shapes;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>BadShapeCreation</span> <span class=kd>extends</span> <span class=n>RuntimeException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>BadShapeCreation</span><span class=o>(</span><span class=n>String</span> <span class=n>msg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>msg</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>接下来，是一个<strong>Shape</strong>基类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// patterns/shapes/Shape.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nn>patterns.shapes</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Shape</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=kd>static</span> <span class=kt>int</span> <span class=n>counter</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>id</span> <span class=o>=</span> <span class=n>counter</span><span class=o>++;</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>getClass</span><span class=o>().</span><span class=na>getSimpleName</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34;[&#34;</span> <span class=o>+</span> <span class=n>id</span> <span class=o>+</span> <span class=s>&#34;]&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>draw</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=k>this</span> <span class=o>+</span> <span class=s>&#34; draw&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>erase</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=k>this</span> <span class=o>+</span> <span class=s>&#34; erase&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>该类自动为每一个<strong>Shape</strong>对象创建一个唯一的<code>id</code>。</p><p><code>toString()</code>使用运行期信息来发现特定的<strong>Shape</strong>子类的名字。</p><p>现在我们能很快创建一些<strong>Shape</strong>子类了：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// patterns/shapes/Circle.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nn>patterns.shapes</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Circle</span> <span class=kd>extends</span> <span class=n>Shape</span> <span class=o>{}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// patterns/shapes/Square.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nn>patterns.shapes</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Square</span> <span class=kd>extends</span> <span class=n>Shape</span> <span class=o>{}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// patterns/shapes/Triangle.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nn>patterns.shapes</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Triangle</span> <span class=kd>extends</span> <span class=n>Shape</span> <span class=o>{}</span>
</span></span></code></pre></div><p>工厂是具有能够创建对象的方法的类。 我们有几个示例版本，因此我们将定义一个接口：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// patterns/shapes/FactoryMethod.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nn>patterns.shapes</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>FactoryMethod</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Shape</span> <span class=nf>create</span><span class=o>(</span><span class=n>String</span> <span class=n>type</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><code>create()</code>接收一个参数，这个参数使其决定要创建哪一种<strong>Shape</strong>对象，这里是<code>String</code>，但是它其实可以是任何数据集合。对象的初始化数据（这里是字符串）可能来自系统外部。 这个例子将测试工厂：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// patterns/shapes/FactoryTest.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nn>patterns.shapes</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>FactoryTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>test</span><span class=o>(</span><span class=n>FactoryMethod</span> <span class=n>factory</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Stream</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=s>&#34;Circle&#34;</span><span class=o>,</span> <span class=s>&#34;Square&#34;</span><span class=o>,</span> <span class=s>&#34;Triangle&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                  <span class=s>&#34;Square&#34;</span><span class=o>,</span> <span class=s>&#34;Circle&#34;</span><span class=o>,</span> <span class=s>&#34;Circle&#34;</span><span class=o>,</span> <span class=s>&#34;Triangle&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>factory</span><span class=o>::</span><span class=n>create</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>peek</span><span class=o>(</span><span class=n>Shape</span><span class=o>::</span><span class=n>draw</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>peek</span><span class=o>(</span><span class=n>Shape</span><span class=o>::</span><span class=n>erase</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>count</span><span class=o>();</span> <span class=c1>// Terminal operation
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>在主函数<code>main()</code>里，要记住除非你在最后使用了一个终结操作，否则<strong>Stream</strong>不会做任何事情。在这里，<code>count()</code>的值被丢弃了。</p><p>创建工厂的一种方法是显式创建每种类型：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// patterns/ShapeFactory1.java
</span></span></span><span class=line><span class=cl><span class=c1>// A simple static factory method
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>patterns.shapes.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ShapeFactory1</span> <span class=kd>implements</span> <span class=n>FactoryMethod</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Shape</span> <span class=nf>create</span><span class=o>(</span><span class=n>String</span> <span class=n>type</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span><span class=o>(</span><span class=n>type</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s>&#34;Circle&#34;</span><span class=o>:</span> <span class=k>return</span> <span class=k>new</span> <span class=n>Circle</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s>&#34;Square&#34;</span><span class=o>:</span> <span class=k>return</span> <span class=k>new</span> <span class=n>Square</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=s>&#34;Triangle&#34;</span><span class=o>:</span> <span class=k>return</span> <span class=k>new</span> <span class=n>Triangle</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=k>default</span><span class=o>:</span> <span class=k>throw</span> <span class=k>new</span> <span class=n>BadShapeCreation</span><span class=o>(</span><span class=n>type</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>FactoryTest</span><span class=o>.</span><span class=na>test</span><span class=o>(</span><span class=k>new</span> <span class=n>ShapeFactory1</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Circle</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span> <span class=n>draw</span>
</span></span><span class=line><span class=cl><span class=n>Circle</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span> <span class=n>erase</span>
</span></span><span class=line><span class=cl><span class=n>Square</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span> <span class=n>draw</span>
</span></span><span class=line><span class=cl><span class=n>Square</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span> <span class=n>erase</span>
</span></span><span class=line><span class=cl><span class=n>Triangle</span><span class=o>[</span><span class=mi>2</span><span class=o>]</span> <span class=n>draw</span>
</span></span><span class=line><span class=cl><span class=n>Triangle</span><span class=o>[</span><span class=mi>2</span><span class=o>]</span> <span class=n>erase</span>
</span></span><span class=line><span class=cl><span class=n>Square</span><span class=o>[</span><span class=mi>3</span><span class=o>]</span> <span class=n>draw</span>
</span></span><span class=line><span class=cl><span class=n>Square</span><span class=o>[</span><span class=mi>3</span><span class=o>]</span> <span class=n>erase</span>
</span></span><span class=line><span class=cl><span class=n>Circle</span><span class=o>[</span><span class=mi>4</span><span class=o>]</span> <span class=n>draw</span>
</span></span><span class=line><span class=cl><span class=n>Circle</span><span class=o>[</span><span class=mi>4</span><span class=o>]</span> <span class=n>erase</span>
</span></span><span class=line><span class=cl><span class=n>Circle</span><span class=o>[</span><span class=mi>5</span><span class=o>]</span> <span class=n>draw</span>
</span></span><span class=line><span class=cl><span class=n>Circle</span><span class=o>[</span><span class=mi>5</span><span class=o>]</span> <span class=n>erase</span>
</span></span><span class=line><span class=cl><span class=n>Triangle</span><span class=o>[</span><span class=mi>6</span><span class=o>]</span> <span class=n>draw</span>
</span></span><span class=line><span class=cl><span class=n>Triangle</span><span class=o>[</span><span class=mi>6</span><span class=o>]</span> <span class=n>erase</span>
</span></span></code></pre></div><p><code>create()</code>现在是添加新类型的 Shape 时系统中唯一需要更改的其他代码。</p><h3 id=动态工厂>动态工厂</h3><p>前面例子中的<strong>静态</strong><code>create()</code>方法强制所有创建操作都集中在一个位置，因此这是添加新类型的<strong>Shape</strong>时唯一必须更改代码的地方。这当然是一个合理的解决方案，因为它把创建对象的过程限制在一个框内。但是，如果你在添加新类时无需修改任何内容，那就太好了。 以下版本使用反射在首次需要时将<strong>Shape</strong>的构造器动态加载到工厂列表中：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// patterns/ShapeFactory2.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.lang.reflect.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>patterns.shapes.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ShapeFactory2</span> <span class=kd>implements</span> <span class=n>FactoryMethod</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Constructor</span><span class=o>&gt;</span> <span class=n>factories</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=n>Constructor</span> <span class=nf>load</span><span class=o>(</span><span class=n>String</span> <span class=n>id</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;loading &#34;</span> <span class=o>+</span> <span class=n>id</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>Class</span><span class=o>.</span><span class=na>forName</span><span class=o>(</span><span class=s>&#34;patterns.shapes.&#34;</span> <span class=o>+</span> <span class=n>id</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>getConstructor</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span><span class=o>(</span><span class=n>ClassNotFoundException</span> <span class=o>|</span>
</span></span><span class=line><span class=cl>                <span class=n>NoSuchMethodException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>BadShapeCreation</span><span class=o>(</span><span class=n>id</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Shape</span> <span class=nf>create</span><span class=o>(</span><span class=n>String</span> <span class=n>id</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=o>(</span><span class=n>Shape</span><span class=o>)</span><span class=n>factories</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>computeIfAbsent</span><span class=o>(</span><span class=n>id</span><span class=o>,</span> <span class=n>ShapeFactory2</span><span class=o>::</span><span class=n>load</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>newInstance</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span><span class=o>(</span><span class=n>InstantiationException</span> <span class=o>|</span>
</span></span><span class=line><span class=cl>                <span class=n>IllegalAccessException</span> <span class=o>|</span>
</span></span><span class=line><span class=cl>                <span class=n>InvocationTargetException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>BadShapeCreation</span><span class=o>(</span><span class=n>id</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>FactoryTest</span><span class=o>.</span><span class=na>test</span><span class=o>(</span><span class=k>new</span> <span class=n>ShapeFactory2</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>loading</span> <span class=n>Circle</span>
</span></span><span class=line><span class=cl><span class=n>Circle</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span> <span class=n>draw</span>
</span></span><span class=line><span class=cl><span class=n>Circle</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span> <span class=n>erase</span>
</span></span><span class=line><span class=cl><span class=n>loading</span> <span class=n>Square</span>
</span></span><span class=line><span class=cl><span class=n>Square</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span> <span class=n>draw</span>
</span></span><span class=line><span class=cl><span class=n>Square</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span> <span class=n>erase</span>
</span></span><span class=line><span class=cl><span class=n>loading</span> <span class=n>Triangle</span>
</span></span><span class=line><span class=cl><span class=n>Triangle</span><span class=o>[</span><span class=mi>2</span><span class=o>]</span> <span class=n>draw</span>
</span></span><span class=line><span class=cl><span class=n>Triangle</span><span class=o>[</span><span class=mi>2</span><span class=o>]</span> <span class=n>erase</span>
</span></span><span class=line><span class=cl><span class=n>Square</span><span class=o>[</span><span class=mi>3</span><span class=o>]</span> <span class=n>draw</span>
</span></span><span class=line><span class=cl><span class=n>Square</span><span class=o>[</span><span class=mi>3</span><span class=o>]</span> <span class=n>erase</span>
</span></span><span class=line><span class=cl><span class=n>Circle</span><span class=o>[</span><span class=mi>4</span><span class=o>]</span> <span class=n>draw</span>
</span></span><span class=line><span class=cl><span class=n>Circle</span><span class=o>[</span><span class=mi>4</span><span class=o>]</span> <span class=n>erase</span>
</span></span><span class=line><span class=cl><span class=n>Circle</span><span class=o>[</span><span class=mi>5</span><span class=o>]</span> <span class=n>draw</span>
</span></span><span class=line><span class=cl><span class=n>Circle</span><span class=o>[</span><span class=mi>5</span><span class=o>]</span> <span class=n>erase</span>
</span></span><span class=line><span class=cl><span class=n>Triangle</span><span class=o>[</span><span class=mi>6</span><span class=o>]</span> <span class=n>draw</span>
</span></span><span class=line><span class=cl><span class=n>Triangle</span><span class=o>[</span><span class=mi>6</span><span class=o>]</span> <span class=n>erase</span>
</span></span></code></pre></div><p>和之前一样，<code>create()</code>方法基于你传递给它的<strong>String</strong>参数生成新的<strong>Shape</strong>s，但是在这里，它是通过在<strong>HashMap</strong>中查找作为键的<strong>String</strong>来实现的。 返回的值是一个构造器，该构造器用于通过调用<code>newInstance()</code>创建新的<strong>Shape</strong>对象。</p><p>然而，当你开始运行程序时，工厂的<code>map</code>为空。<code>create()</code>使用<code>map</code>的<code>computeIfAbsent()</code>方法来查找构造器（如果该构造器已存在于<code>map</code>中）。如果不存在则使用<code>load()</code>计算出该构造器，并将其插入到<code>map</code>中。 从输出中可以看到，每种特定类型的<strong>Shape</strong>都是在第一次请求时才加载的，然后只需要从<code>map</code>中检索它。</p><h3 id=多态工厂>多态工厂</h3><p>《设计模式》这本书强调指出，采用“工厂方法”模式的原因是可以从基本工厂中继承出不同类型的工厂。 再次修改示例，使工厂方法位于单独的类中：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// patterns/ShapeFactory3.java
</span></span></span><span class=line><span class=cl><span class=c1>// Polymorphic factory methods
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>patterns.shapes.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>interface</span> <span class=nc>PolymorphicFactory</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Shape</span> <span class=nf>create</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>RandomShapes</span> <span class=kd>implements</span> <span class=n>Supplier</span><span class=o>&lt;</span><span class=n>Shape</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=n>PolymorphicFactory</span><span class=o>[]</span> <span class=n>factories</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>(</span><span class=mi>42</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>RandomShapes</span><span class=o>(</span><span class=n>PolymorphicFactory</span><span class=o>...</span> <span class=n>factories</span><span class=o>){</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>factories</span> <span class=o>=</span> <span class=n>factories</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Shape</span> <span class=nf>get</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>factories</span><span class=o>[</span> <span class=n>rand</span><span class=o>.</span><span class=na>nextInt</span><span class=o>(</span><span class=n>factories</span><span class=o>.</span><span class=na>length</span><span class=o>)].</span><span class=na>create</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ShapeFactory3</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>RandomShapes</span> <span class=n>rs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>RandomShapes</span><span class=o>(</span>
</span></span><span class=line><span class=cl>            <span class=n>Circle</span><span class=o>::</span><span class=k>new</span><span class=o>,</span>
</span></span><span class=line><span class=cl>            <span class=n>Square</span><span class=o>::</span><span class=k>new</span><span class=o>,</span>
</span></span><span class=line><span class=cl>            <span class=n>Triangle</span><span class=o>::</span><span class=k>new</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Stream</span><span class=o>.</span><span class=na>generate</span><span class=o>(</span><span class=n>rs</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>6</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>peek</span><span class=o>(</span><span class=n>Shape</span><span class=o>::</span><span class=n>draw</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>peek</span><span class=o>(</span><span class=n>Shape</span><span class=o>::</span><span class=n>erase</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>count</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Triangle</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span> <span class=n>draw</span>
</span></span><span class=line><span class=cl><span class=n>Triangle</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span> <span class=n>erase</span>
</span></span><span class=line><span class=cl><span class=n>Circle</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span> <span class=n>draw</span>
</span></span><span class=line><span class=cl><span class=n>Circle</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span> <span class=n>erase</span>
</span></span><span class=line><span class=cl><span class=n>Circle</span><span class=o>[</span><span class=mi>2</span><span class=o>]</span> <span class=n>draw</span>
</span></span><span class=line><span class=cl><span class=n>Circle</span><span class=o>[</span><span class=mi>2</span><span class=o>]</span> <span class=n>erase</span>
</span></span><span class=line><span class=cl><span class=n>Triangle</span><span class=o>[</span><span class=mi>3</span><span class=o>]</span> <span class=n>draw</span>
</span></span><span class=line><span class=cl><span class=n>Triangle</span><span class=o>[</span><span class=mi>3</span><span class=o>]</span> <span class=n>erase</span>
</span></span><span class=line><span class=cl><span class=n>Circle</span><span class=o>[</span><span class=mi>4</span><span class=o>]</span> <span class=n>draw</span>
</span></span><span class=line><span class=cl><span class=n>Circle</span><span class=o>[</span><span class=mi>4</span><span class=o>]</span> <span class=n>erase</span>
</span></span><span class=line><span class=cl><span class=n>Square</span><span class=o>[</span><span class=mi>5</span><span class=o>]</span> <span class=n>draw</span>
</span></span><span class=line><span class=cl><span class=n>Square</span><span class=o>[</span><span class=mi>5</span><span class=o>]</span> <span class=n>erase</span>
</span></span></code></pre></div><p><strong>RandomShapes</strong>实现了<strong>Supplier &lt;Shape></strong>，因此可用于通过<code>Stream.generate()</code>创建<strong>Stream</strong>。 它的构造器采用<strong>PolymorphicFactory</strong>对象的可变参数列表。 变量参数列表以数组形式出现，因此列表是以数组形式在内部存储的。<code>get()</code>方法随机获取此数组中一个对象的索引，并在结果上调用<code>create()</code>以产生新的<strong>Shape</strong>对象。 添加新类型的<strong>Shape</strong>时，<strong>RandomShapes</strong>构造器是唯一需要更改的地方。 请注意，此构造器需要<strong>Supplier &lt;Shape></strong>。 我们传递给其<strong>Shape</strong>构造器的方法引用，该引用可满足**Supplier &lt;Shape>**约定，因为 Java 8 支持结构一致性。</p><p>鉴于<strong>ShapeFactory2.java</strong>可能会抛出异常，使用此方法则没有任何异常——它在编译时完全确定。</p><h3 id=抽象工厂>抽象工厂</h3><p>抽象工厂模式看起来像我们之前所见的工厂对象，但拥有不是一个工厂方法而是几个工厂方法， 每个工厂方法都会创建不同种类的对象。 这个想法是在创建工厂对象时，你决定如何使用该工厂创建的所有对象。 《设计模式》中提供的示例实现了跨各种图形用户界面（GUI）的可移植性：你创建一个适合你正在使用的 GUI 的工厂对象，然后从中请求菜单，按钮，滑块等等，它将自动为 GUI 创建适合该项目版本的组件。 因此，你可以将从一个 GUI 更改为另一个所产生的影响隔离限制在一处。 作为另一个示例，假设你正在创建一个通用游戏环境来支持不同类型的游戏。 使用抽象工厂看起来就像下文那样：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// patterns/abstractfactory/GameEnvironment.java
</span></span></span><span class=line><span class=cl><span class=c1>// An example of the Abstract Factory pattern
</span></span></span><span class=line><span class=cl><span class=c1>// {java patterns.abstractfactory.GameEnvironment}
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nn>patterns.abstractfactory</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>interface</span> <span class=nc>Obstacle</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>action</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>interface</span> <span class=nc>Player</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>interactWith</span><span class=o>(</span><span class=n>Obstacle</span> <span class=n>o</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Kitty</span> <span class=kd>implements</span> <span class=n>Player</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>interactWith</span><span class=o>(</span><span class=n>Obstacle</span> <span class=n>ob</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>print</span><span class=o>(</span><span class=s>&#34;Kitty has encountered a &#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>ob</span><span class=o>.</span><span class=na>action</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>KungFuGuy</span> <span class=kd>implements</span> <span class=n>Player</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>interactWith</span><span class=o>(</span><span class=n>Obstacle</span> <span class=n>ob</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>print</span><span class=o>(</span><span class=s>&#34;KungFuGuy now battles a &#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>ob</span><span class=o>.</span><span class=na>action</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Puzzle</span> <span class=kd>implements</span> <span class=n>Obstacle</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>action</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Puzzle&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>NastyWeapon</span> <span class=kd>implements</span> <span class=n>Obstacle</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>action</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;NastyWeapon&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// The Abstract Factory:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>class</span> <span class=nc>GameElementFactory</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Supplier</span><span class=o>&lt;</span><span class=n>Player</span><span class=o>&gt;</span> <span class=n>player</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Supplier</span><span class=o>&lt;</span><span class=n>Obstacle</span><span class=o>&gt;</span> <span class=n>obstacle</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Concrete factories:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>class</span> <span class=nc>KittiesAndPuzzles</span> <span class=kd>extends</span> <span class=n>GameElementFactory</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>KittiesAndPuzzles</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>player</span> <span class=o>=</span> <span class=n>Kitty</span><span class=o>::</span><span class=k>new</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>obstacle</span> <span class=o>=</span> <span class=n>Puzzle</span><span class=o>::</span><span class=k>new</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>KillAndDismember</span> <span class=kd>extends</span> <span class=n>GameElementFactory</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>KillAndDismember</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>player</span> <span class=o>=</span> <span class=n>KungFuGuy</span><span class=o>::</span><span class=k>new</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>obstacle</span> <span class=o>=</span> <span class=n>NastyWeapon</span><span class=o>::</span><span class=k>new</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>GameEnvironment</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Player</span> <span class=n>p</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Obstacle</span> <span class=n>ob</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>GameEnvironment</span><span class=o>(</span><span class=n>GameElementFactory</span> <span class=n>factory</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span> <span class=o>=</span> <span class=n>factory</span><span class=o>.</span><span class=na>player</span><span class=o>.</span><span class=na>get</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>ob</span> <span class=o>=</span> <span class=n>factory</span><span class=o>.</span><span class=na>obstacle</span><span class=o>.</span><span class=na>get</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>play</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>.</span><span class=na>interactWith</span><span class=o>(</span><span class=n>ob</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>GameElementFactory</span> <span class=n>kp</span> <span class=o>=</span> <span class=k>new</span> <span class=n>KittiesAndPuzzles</span><span class=o>(),</span> <span class=n>kd</span> <span class=o>=</span> <span class=k>new</span> <span class=n>KillAndDismember</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>GameEnvironment</span> <span class=n>g1</span> <span class=o>=</span> <span class=k>new</span> <span class=n>GameEnvironment</span><span class=o>(</span><span class=n>kp</span><span class=o>),</span> <span class=n>g2</span> <span class=o>=</span> <span class=k>new</span> <span class=n>GameEnvironment</span><span class=o>(</span><span class=n>kd</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>g1</span><span class=o>.</span><span class=na>play</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>g2</span><span class=o>.</span><span class=na>play</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Kitty</span> <span class=n>has</span> <span class=n>encountered</span> <span class=n>a</span> <span class=n>Puzzle</span>
</span></span><span class=line><span class=cl><span class=n>KungFuGuy</span> <span class=n>now</span> <span class=n>battles</span> <span class=n>a</span> <span class=n>NastyWeapon</span>
</span></span></code></pre></div><p>在这种环境中，<strong>Player</strong>对象与<strong>Obstacle</strong>对象进行交互，但是根据你所玩游戏的类型，存在不同类型的玩家和障碍物。 你可以通过选择特定的<strong>GameElementFactory</strong>来确定游戏的类型，然后<strong>GameEnvironment</strong>控制游戏的设置和玩法。 在此示例中，设置和玩法非常简单，但是这些活动（初始条件和状态变化）可以决定游戏的大部分结果。 这里，<strong>GameEnvironment</strong>不是为继承而设计的，尽管这样做很有意义。 它还包含“双重调度”和“工厂方法”的示例，稍后将对这两个示例进行说明。</p><h2 id=函数对象>函数对象</h2><p>一个 <em>函数对象</em> 封装了一个函数。其特点就是将被调用函数的选择与那个函数被调用的位置进行解耦。</p><p><em>《设计模式》</em> 中也提到了这个术语，但是没有使用。然而，<em>函数对象</em> 的话题却在那本书的很多模式中被反复论及。</p><h3 id=命令模式>命令模式</h3><p>从最直观的角度来看，<em>命令模式</em> 就是一个函数对象：一个作为对象的函数。我们可以将 <em>函数对象</em> 作为参数传递给其他方法或者对象，来执行特定的操作。</p><p>在 Java 8 之前，想要产生单个函数的效果，我们必须明确将方法包含在对象中，而这需要太多的仪式了。而利用 Java 8 的 lambda 特性， <em>命令模式</em> 的实现将是微不足道的。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// patterns/CommandPattern.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CommandPattern</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=o>&lt;</span><span class=n>Runnable</span><span class=o>&gt;</span> <span class=n>macro</span> <span class=o>=</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span>
</span></span><span class=line><span class=cl>      <span class=o>()</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>print</span><span class=o>(</span><span class=s>&#34;Hello &#34;</span><span class=o>),</span>
</span></span><span class=line><span class=cl>      <span class=o>()</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>print</span><span class=o>(</span><span class=s>&#34;World! &#34;</span><span class=o>),</span>
</span></span><span class=line><span class=cl>      <span class=o>()</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>print</span><span class=o>(</span><span class=s>&#34;I&#39;m the command pattern!&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>macro</span><span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>Runnable</span><span class=o>::</span><span class=n>run</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=cm>/* Output:
</span></span></span><span class=line><span class=cl><span class=cm>Hello World! I&#39;m the command pattern!
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p><em>命令模式</em> 的主要特点是允许向一个方法或者对象传递一个想要的动作。在上面的例子中，这个对象就是 <strong>macro</strong> ，而 <em>命令模式</em> 提供了将一系列需要一起执行的动作集进行排队的方法。在这里，<em>命令模式</em> 允许我们动态的创建新的行为，通常情况下我们需要编写新的代码才能完成这个功能，而在上面的例子中，我们可以通过解释运行一个脚本来完成这个功能（如果需要实现的东西很复杂请参考解释器模式）。</p><p><em>《设计模式》</em> 认为“命令模式是回调的面向对象的替代品”。尽管如此，我认为"back"（回来）这个词是 callback（回调）这一概念的基本要素。也就是说，我认为回调（callback）实际上是返回到回调的创建者所在的位置。另一方面，对于 <em>命令</em> 对象，通常只需创建它并将其交给某种方法或对象，而不是自始至终以其他方式联系命令对象。不管怎样，这就是我对它的看法。在本章的后面内容中，我将会把一组设计模式放在“回调”的标题下面。</p><h3 id=策略模式>策略模式</h3><p><em>策略模式</em> 看起来像是从同一个基类继承而来的一系列 <em>命令</em> 类。但是仔细查看 <em>命令模式</em>，你就会发现它也具有同样的结构：一系列分层次的 <em>函数对象</em>。不同之处在于，这些函数对象的用法和策略模式不同。就像前面的 <code>io/DirList.java</code> 那个例子，使用 <em>命令</em> 是为了解决特定问题 &ndash; 从一个列表中选择文件。“不变的部分”是被调用的那个方法，而变化的部分被分离出来放到 <em>函数对象</em> 中。我认为 <em>命令模式</em> 在编码阶段提供了灵活性，而 <em>策略模式</em> 的灵活性在运行时才会体现出来。尽管如此，这种区别却是非常模糊的。</p><p>另外，<em>策略模式</em> 还可以添加一个“上下文（context）”，这个上下文（context）可以是一个代理类（surrogate class），用来控制对某个特定 <em>策略</em> 对象的选择和使用。就像 <em>桥接模式</em> 一样！下面我们来一探究竟：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// patterns/strategy/StrategyPattern.java
</span></span></span><span class=line><span class=cl><span class=c1>// {java patterns.strategy.StrategyPattern}
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nn>patterns.strategy</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// The common strategy base type:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>class</span> <span class=nc>FindMinima</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Function</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;,</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;&gt;</span> <span class=n>algorithm</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// The various strategies:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>class</span> <span class=nc>LeastSquares</span> <span class=kd>extends</span> <span class=n>FindMinima</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>LeastSquares</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Line is a sequence of points (Dummy data):
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>algorithm</span> <span class=o>=</span> <span class=o>(</span><span class=n>line</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=mf>1.1</span><span class=o>,</span> <span class=mf>2.2</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Perturbation</span> <span class=kd>extends</span> <span class=n>FindMinima</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Perturbation</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>algorithm</span> <span class=o>=</span> <span class=o>(</span><span class=n>line</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=mf>3.3</span><span class=o>,</span> <span class=mf>4.4</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Bisection</span> <span class=kd>extends</span> <span class=n>FindMinima</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Bisection</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>algorithm</span> <span class=o>=</span> <span class=o>(</span><span class=n>line</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=mf>5.5</span><span class=o>,</span> <span class=mf>6.6</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// The &#34;Context&#34; controls the strategy:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>class</span> <span class=nc>MinimaSolver</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=n>FindMinima</span> <span class=n>strategy</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=n>MinimaSolver</span><span class=o>(</span><span class=n>FindMinima</span> <span class=n>strat</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>strategy</span> <span class=o>=</span> <span class=n>strat</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=n>List</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;</span> <span class=nf>minima</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;</span> <span class=n>line</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>strategy</span><span class=o>.</span><span class=na>algorithm</span><span class=o>.</span><span class=na>apply</span><span class=o>(</span><span class=n>line</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>changeAlgorithm</span><span class=o>(</span><span class=n>FindMinima</span> <span class=n>newAlgorithm</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>strategy</span> <span class=o>=</span> <span class=n>newAlgorithm</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>StrategyPattern</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>MinimaSolver</span> <span class=n>solver</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>      <span class=k>new</span> <span class=n>MinimaSolver</span><span class=o>(</span><span class=k>new</span> <span class=n>LeastSquares</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;</span> <span class=n>line</span> <span class=o>=</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span>
</span></span><span class=line><span class=cl>      <span class=mf>1.0</span><span class=o>,</span> <span class=mf>2.0</span><span class=o>,</span> <span class=mf>1.0</span><span class=o>,</span> <span class=mf>2.0</span><span class=o>,</span> <span class=o>-</span><span class=mf>1.0</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=mf>3.0</span><span class=o>,</span> <span class=mf>4.0</span><span class=o>,</span> <span class=mf>5.0</span><span class=o>,</span> <span class=mf>4.0</span> <span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>solver</span><span class=o>.</span><span class=na>minima</span><span class=o>(</span><span class=n>line</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=n>solver</span><span class=o>.</span><span class=na>changeAlgorithm</span><span class=o>(</span><span class=k>new</span> <span class=n>Bisection</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>solver</span><span class=o>.</span><span class=na>minima</span><span class=o>(</span><span class=n>line</span><span class=o>));</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=cm>/* Output:
</span></span></span><span class=line><span class=cl><span class=cm>[1.1, 2.2]
</span></span></span><span class=line><span class=cl><span class=cm>[5.5, 6.6]
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p><code>MinimaSolver</code> 中的 <code>changeAlgorithm()</code> 方法将一个不同的策略插入到了 <code>私有</code> 域 <code>strategy</code> 中，这使得在调用 <code>minima()</code> 方法时，可以使用新的策略。</p><p>我们可以通过将上下文注入到 <code>FindMinima</code> 中来简化我们的解决方法。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// patterns/strategy/StrategyPattern2.java // {java patterns.strategy.StrategyPattern2}
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nn>patterns.strategy</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// &#34;Context&#34; is now incorporated:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>class</span> <span class=nc>FindMinima2</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Function</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;,</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;&gt;</span> <span class=n>algorithm</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=n>FindMinima2</span><span class=o>()</span> <span class=o>{</span> <span class=n>leastSquares</span><span class=o>();</span> <span class=o>}</span> <span class=c1>// default
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// The various strategies:
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>void</span> <span class=nf>leastSquares</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>algorithm</span> <span class=o>=</span> <span class=o>(</span><span class=n>line</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=mf>1.1</span><span class=o>,</span> <span class=mf>2.2</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>perturbation</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>algorithm</span> <span class=o>=</span> <span class=o>(</span><span class=n>line</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=mf>3.3</span><span class=o>,</span> <span class=mf>4.4</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>bisection</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>algorithm</span> <span class=o>=</span> <span class=o>(</span><span class=n>line</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=mf>5.5</span><span class=o>,</span> <span class=mf>6.6</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=n>List</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;</span> <span class=nf>minima</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;</span> <span class=n>line</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>algorithm</span><span class=o>.</span><span class=na>apply</span><span class=o>(</span><span class=n>line</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>StrategyPattern2</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>FindMinima2</span> <span class=n>solver</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FindMinima2</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;</span> <span class=n>line</span> <span class=o>=</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span>
</span></span><span class=line><span class=cl>      <span class=mf>1.0</span><span class=o>,</span> <span class=mf>2.0</span><span class=o>,</span> <span class=mf>1.0</span><span class=o>,</span> <span class=mf>2.0</span><span class=o>,</span> <span class=o>-</span><span class=mf>1.0</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=mf>3.0</span><span class=o>,</span> <span class=mf>4.0</span><span class=o>,</span> <span class=mf>5.0</span><span class=o>,</span> <span class=mf>4.0</span> <span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>solver</span><span class=o>.</span><span class=na>minima</span><span class=o>(</span><span class=n>line</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=n>solver</span><span class=o>.</span><span class=na>bisection</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>solver</span><span class=o>.</span><span class=na>minima</span><span class=o>(</span><span class=n>line</span><span class=o>));</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=cm>/* Output:
</span></span></span><span class=line><span class=cl><span class=cm>[1.1, 2.2]
</span></span></span><span class=line><span class=cl><span class=cm>[5.5, 6.6]
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p><code>FindMinima2</code> 封装了不同的算法，也包含了“上下文”（Context），所以它便可以在一个单独的类中控制算法的选择了。</p><h3 id=责任链模式>责任链模式</h3><p><em>责任链模式</em> 也许可以被看作一个使用了 <em>策略</em> 对象的“递归的动态一般化”。此时我们进行一次调用，在一个链序列中的每个策略都试图满足这个调用。这个过程直到有一个策略成功满足该调用或者到达链序列的末尾才结束。在递归方法中，一个方法将反复调用它自身直至达到某个终止条件；使用责任链，一个方法会调用相同的基类方法（拥有不同的实现），这个基类方法将会调用基类方法的其他实现，如此反复直至达到某个终止条件。</p><p>除了调用某个方法来满足某个请求以外，链中的多个方法都有机会满足这个请求，因此它有点专家系统的意味。由于责任链实际上就是一个链表，它能够动态创建，因此它可以看作是一个更一般的动态构建的 <code>switch</code> 语句。</p><p>在上面的 <code>StrategyPattern.java</code> 例子中，我们可能想自动发现一个解决方法。而 <em>责任链</em> 就可以达到这个目的：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// patterns/chain/ChainOfResponsibility.java
</span></span></span><span class=line><span class=cl><span class=c1>// Using the Functional interface
</span></span></span><span class=line><span class=cl><span class=c1>// {java patterns.chain.ChainOfResponsibility}
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nn>patterns.chain</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Result</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>boolean</span> <span class=n>success</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=n>List</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;</span> <span class=n>line</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=n>Result</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;</span> <span class=n>data</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>success</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>line</span> <span class=o>=</span> <span class=n>data</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=n>Result</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>success</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>line</span> <span class=o>=</span> <span class=n>Collections</span><span class=o>.&lt;</span><span class=n>Double</span><span class=o>&gt;</span><span class=n>emptyList</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Fail</span> <span class=kd>extends</span> <span class=n>Result</span> <span class=o>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>interface</span> <span class=nc>Algorithm</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Result</span> <span class=nf>algorithm</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;</span> <span class=n>line</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>FindMinima</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=n>Result</span> <span class=nf>leastSquares</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;</span> <span class=n>line</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;LeastSquares.algorithm&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>boolean</span> <span class=n>weSucceed</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=o>(</span><span class=n>weSucceed</span><span class=o>)</span> <span class=c1>// Actual test/calculation here
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>return</span> <span class=k>new</span> <span class=n>Result</span><span class=o>(</span><span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=mf>1.1</span><span class=o>,</span> <span class=mf>2.2</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=c1>// Try the next one in the chain:
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>return</span> <span class=k>new</span> <span class=n>Fail</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=n>Result</span> <span class=nf>perturbation</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;</span> <span class=n>line</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Perturbation.algorithm&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>boolean</span> <span class=n>weSucceed</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=o>(</span><span class=n>weSucceed</span><span class=o>)</span> <span class=c1>// Actual test/calculation here
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>return</span> <span class=k>new</span> <span class=n>Result</span><span class=o>(</span><span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=mf>3.3</span><span class=o>,</span> <span class=mf>4.4</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=k>new</span> <span class=n>Fail</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=n>Result</span> <span class=nf>bisection</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;</span> <span class=n>line</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Bisection.algorithm&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>boolean</span> <span class=n>weSucceed</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=o>(</span><span class=n>weSucceed</span><span class=o>)</span> <span class=c1>// Actual test/calculation here
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>return</span> <span class=k>new</span> <span class=n>Result</span><span class=o>(</span><span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=mf>5.5</span><span class=o>,</span> <span class=mf>6.6</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=k>new</span> <span class=n>Fail</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>static</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Function</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;,</span> <span class=n>Result</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl>    <span class=n>algorithms</span> <span class=o>=</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span>
</span></span><span class=line><span class=cl>      <span class=n>FindMinima</span><span class=o>::</span><span class=n>leastSquares</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>FindMinima</span><span class=o>::</span><span class=n>perturbation</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>FindMinima</span><span class=o>::</span><span class=n>bisection</span>
</span></span><span class=line><span class=cl>    <span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=n>Result</span> <span class=nf>minima</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;</span> <span class=n>line</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=o>(</span><span class=n>Function</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;,</span> <span class=n>Result</span><span class=o>&gt;</span> <span class=n>alg</span> <span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=n>algorithms</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>Result</span> <span class=n>result</span> <span class=o>=</span> <span class=n>alg</span><span class=o>.</span><span class=na>apply</span><span class=o>(</span><span class=n>line</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span><span class=o>(</span><span class=n>result</span><span class=o>.</span><span class=na>success</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=n>Fail</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ChainOfResponsibility</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>FindMinima</span> <span class=n>solver</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FindMinima</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=o>&lt;</span><span class=n>Double</span><span class=o>&gt;</span> <span class=n>line</span> <span class=o>=</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span>
</span></span><span class=line><span class=cl>      <span class=mf>1.0</span><span class=o>,</span> <span class=mf>2.0</span><span class=o>,</span> <span class=mf>1.0</span><span class=o>,</span> <span class=mf>2.0</span><span class=o>,</span> <span class=o>-</span><span class=mf>1.0</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=mf>3.0</span><span class=o>,</span> <span class=mf>4.0</span><span class=o>,</span> <span class=mf>5.0</span><span class=o>,</span> <span class=mf>4.0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Result</span> <span class=n>result</span> <span class=o>=</span> <span class=n>solver</span><span class=o>.</span><span class=na>minima</span><span class=o>(</span><span class=n>line</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=o>(</span><span class=n>result</span><span class=o>.</span><span class=na>success</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>result</span><span class=o>.</span><span class=na>line</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>      <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;No algorithm found&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=cm>/* Output:
</span></span></span><span class=line><span class=cl><span class=cm>LeastSquares.algorithm
</span></span></span><span class=line><span class=cl><span class=cm>Perturbation.algorithm
</span></span></span><span class=line><span class=cl><span class=cm>Bisection.algorithm
</span></span></span><span class=line><span class=cl><span class=cm>[5.5, 6.6]
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p>我们从定义一个 <code>Result</code> 类开始，这个类包含一个 <code>success</code> 标志，因此接收者就可以知道算法是否成功执行，而 <code>line</code> 变量保存了真实的数据。当算法执行失败时， <code>Fail</code> 类可以作为返回值。要注意的是，当算法执行失败时，返回一个 <code>Result</code> 对象要比抛出一个异常更加合适，因为我们有时可能并不打算解决这个问题，而是希望程序继续执行下去。</p><p>每一个 <code>Algorithm</code> 接口的实现，都实现了不同的 <code>algorithm()</code> 方法。在 <code>FindMinama</code> 中，将会创建一个算法的列表（这就是所谓的“链”），而 <code>minima()</code> 方法只是遍历这个列表，然后找到能够成功执行的算法而已。</p><h2 id=改变接口>改变接口</h2><p>有时候我们需要解决的问题很简单，仅仅是“我没有需要的接口”而已。有两种设计模式用来解决这个问题：<em>适配器模式</em> 接受一种类型并且提供一个对其他类型的接口。<em>外观模式</em> 为一组类创建了一个接口，这样做只是为了提供一种更方便的方法来处理库或资源。</p><h3 id=适配器模式adapter>适配器模式（Adapter）</h3><p>当我们手头有某个类，而我们需要的却是另外一个类，我们就可以通过 <em>适配器模式</em> 来解决问题。唯一需要做的就是产生出我们需要的那个类，有许多种方法可以完成这种适配。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// patterns/adapt/Adapter.java
</span></span></span><span class=line><span class=cl><span class=c1>// Variations on the Adapter pattern
</span></span></span><span class=line><span class=cl><span class=c1>// {java patterns.adapt.Adapter}
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nn>patterns.adapt</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>WhatIHave</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>g</span><span class=o>()</span> <span class=o>{}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>h</span><span class=o>()</span> <span class=o>{}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>interface</span> <span class=nc>WhatIWant</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=nf>f</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>ProxyAdapter</span> <span class=kd>implements</span> <span class=n>WhatIWant</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>WhatIHave</span> <span class=n>whatIHave</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=n>ProxyAdapter</span><span class=o>(</span><span class=n>WhatIHave</span> <span class=n>wih</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>whatIHave</span> <span class=o>=</span> <span class=n>wih</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>f</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Implement behavior using
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// methods in WhatIHave:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>whatIHave</span><span class=o>.</span><span class=na>g</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>whatIHave</span><span class=o>.</span><span class=na>h</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>WhatIUse</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>op</span><span class=o>(</span><span class=n>WhatIWant</span> <span class=n>wiw</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>wiw</span><span class=o>.</span><span class=na>f</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Approach 2: build adapter use into op():
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>class</span> <span class=nc>WhatIUse2</span> <span class=kd>extends</span> <span class=n>WhatIUse</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>op</span><span class=o>(</span><span class=n>WhatIHave</span> <span class=n>wih</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=n>ProxyAdapter</span><span class=o>(</span><span class=n>wih</span><span class=o>).</span><span class=na>f</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Approach 3: build adapter into WhatIHave:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>class</span> <span class=nc>WhatIHave2</span> <span class=kd>extends</span> <span class=n>WhatIHave</span> <span class=kd>implements</span> <span class=n>WhatIWant</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>f</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>g</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>h</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Approach 4: use an inner class:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>class</span> <span class=nc>WhatIHave3</span> <span class=kd>extends</span> <span class=n>WhatIHave</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>class</span> <span class=nc>InnerAdapter</span> <span class=kd>implements</span> <span class=n>WhatIWant</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>f</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>g</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=n>h</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=n>WhatIWant</span> <span class=nf>whatIWant</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=n>InnerAdapter</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Adapter</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>WhatIUse</span> <span class=n>whatIUse</span> <span class=o>=</span> <span class=k>new</span> <span class=n>WhatIUse</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>WhatIHave</span> <span class=n>whatIHave</span> <span class=o>=</span> <span class=k>new</span> <span class=n>WhatIHave</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>WhatIWant</span> <span class=n>adapt</span><span class=o>=</span> <span class=k>new</span> <span class=n>ProxyAdapter</span><span class=o>(</span><span class=n>whatIHave</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>whatIUse</span><span class=o>.</span><span class=na>op</span><span class=o>(</span><span class=n>adapt</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Approach 2:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>WhatIUse2</span> <span class=n>whatIUse2</span> <span class=o>=</span> <span class=k>new</span> <span class=n>WhatIUse2</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>whatIUse2</span><span class=o>.</span><span class=na>op</span><span class=o>(</span><span class=n>whatIHave</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Approach 3:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>WhatIHave2</span> <span class=n>whatIHave2</span> <span class=o>=</span> <span class=k>new</span> <span class=n>WhatIHave2</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>whatIUse</span><span class=o>.</span><span class=na>op</span><span class=o>(</span><span class=n>whatIHave2</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Approach 4:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>WhatIHave3</span> <span class=n>whatIHave3</span> <span class=o>=</span> <span class=k>new</span> <span class=n>WhatIHave3</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>whatIUse</span><span class=o>.</span><span class=na>op</span><span class=o>(</span><span class=n>whatIHave3</span><span class=o>.</span><span class=na>whatIWant</span><span class=o>());</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>我想冒昧的借用一下术语“proxy”（代理），因为在 <em>《设计模式》</em> 里，他们坚持认为一个代理（proxy）必须拥有和它所代理的对象一模一样的接口。但是，如果把这两个词一起使用，叫做“代理适配器（proxy adapter）”，似乎更合理一些。</p><h3 id=外观模式façade>外观模式（Façade）</h3><p>当我想方设法试图将需求初步（first-cut）转化成对象的时候，通常我使用的原则是：</p><blockquote><p>“把所有丑陋的东西都隐藏到对象里去”。</p></blockquote><p>基本上说，<em>外观模式</em> 干的就是这个事情。如果我们有一堆让人头晕的类以及交互（Interactions），而它们又不是客户端程序员必须了解的，那我们就可以为客户端程序员创建一个接口只提供那些必要的功能。</p><p>外观模式经常被实现为一个符合单例模式（Singleton）的抽象工厂（abstract factory）。当然，你可以通过创建包含 <strong>静态</strong> 工厂方法（static factory methods）的类来达到上述效果。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// patterns/Facade.java
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>A</span> <span class=o>{</span> <span class=n>A</span><span class=o>(</span><span class=kt>int</span> <span class=n>x</span><span class=o>)</span> <span class=o>{}</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>B</span> <span class=o>{</span> <span class=n>B</span><span class=o>(</span><span class=kt>long</span> <span class=n>x</span><span class=o>)</span> <span class=o>{}</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>C</span> <span class=o>{</span> <span class=n>C</span><span class=o>(</span><span class=kt>double</span> <span class=n>x</span><span class=o>)</span> <span class=o>{}</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Other classes that aren&#39;t exposed by the
</span></span></span><span class=line><span class=cl><span class=c1>// facade go here ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Facade</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>static</span> <span class=n>A</span> <span class=nf>makeA</span><span class=o>(</span><span class=kt>int</span> <span class=n>x</span><span class=o>)</span> <span class=o>{</span> <span class=k>return</span> <span class=k>new</span> <span class=n>A</span><span class=o>(</span><span class=n>x</span><span class=o>);</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>static</span> <span class=n>B</span> <span class=nf>makeB</span><span class=o>(</span><span class=kt>long</span> <span class=n>x</span><span class=o>)</span> <span class=o>{</span> <span class=k>return</span> <span class=k>new</span> <span class=n>B</span><span class=o>(</span><span class=n>x</span><span class=o>);</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>static</span> <span class=n>C</span> <span class=nf>makeC</span><span class=o>(</span><span class=kt>double</span> <span class=n>x</span><span class=o>)</span> <span class=o>{</span> <span class=k>return</span> <span class=k>new</span> <span class=n>C</span><span class=o>(</span><span class=n>x</span><span class=o>);</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// The client programmer gets the objects
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// by calling the static methods:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>A</span> <span class=n>a</span> <span class=o>=</span> <span class=n>Facade</span><span class=o>.</span><span class=na>makeA</span><span class=o>(</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>B</span> <span class=n>b</span> <span class=o>=</span> <span class=n>Facade</span><span class=o>.</span><span class=na>makeB</span><span class=o>(</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>C</span> <span class=n>c</span> <span class=o>=</span> <span class=n>Facade</span><span class=o>.</span><span class=na>makeC</span><span class=o>(</span><span class=mf>1.0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>《设计模式》给出的例子并不是真正的 <em>外观模式</em> ，而仅仅是一个类使用了其他的类而已。</p><h4 id=包package作为外观模式的变体>包（Package）作为外观模式的变体</h4><p>我感觉，<em>外观模式</em> 更倾向于“过程式的（procedural）”，也就是非面向对象的（non-object-oriented）：我们是通过调用某些函数才得到对象。它和抽象工厂（Abstract factory）到底有多大差别呢？<em>外观模式</em> 关键的一点是隐藏某个库的一部分类（以及它们的交互），使它们对于客户端程序员不可见，这样那些类的接口就更加简练和易于理解了。</p><p>其实，这也正是 Java 的 packaging（包）的功能所完成的事情：在库以外，我们只能创建和使用被声明为公共（public）的那些类；所有非公共（non-public）的类只能被同一 package 的类使用。看起来，<em>外观模式</em> 似乎是 Java 内嵌的一个功能。</p><p>公平起见，<em>《设计模式》</em> 主要是写给 C++ 读者的。尽管 C++ 有命名空间（namespaces）机制来防止全局变量和类名称之间的冲突，但它并没有提供类隐藏的机制，而在 Java 里我们可以通过声明 non-public 类来实现这一点。我认为，大多数情况下 Java 的 package 功能就足以解决针对 <em>外观模式</em> 的问题了。</p><h2 id=解释器运行时的弹性>解释器：运行时的弹性</h2><p>如果程序的用户需要更好的运行时弹性，例如创建脚本来增加需要的系统功能，你就能使用解释器设计模式。这个模式下，你可以创建一个语言解释器并将它嵌入你的程序内。</p><p>在开发程序的过程中，设计自己的语言并为它构建一个解释器是一件让人分心且耗时的事。最好的解决方案就是复用代码：使用一个已经构建好并被调试过的解释器。Python 语言可以免费地嵌入营利性的应用中而不需要任何的协议许可、授权费或者是任何的声明。此外，有一个完全使用 Java 字节码实现的 Python 版本（叫做 Jython）， 能够轻易地合并到 Java 程序中。Python 是一门非常易学习的脚本语言，代码的读写很有逻辑性。它支持函数与对象，有大量的可用库，并且可运行在所有的平台上。你可以在 <a href=https://www.python.org/ target=_blank rel=noopener>www.Python.org</a> 上下载 Python 并了解更多信息。</p><h2 id=回调>回调</h2><h2 id=多次调度>多次调度</h2><h2 id=模式重构>模式重构</h2><h2 id=抽象用法>抽象用法</h2><h2 id=多次派遣>多次派遣</h2><h2 id=访问者模式>访问者模式</h2><h2 id=rtti-的优劣>RTTI 的优劣</h2><h2 id=本章小结>本章小结</h2><div style=page-break-after:always></div></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>上一页</div><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/24-concurrent-programming/ rel=next>24-Concurrent-Programming</a></div><div class="col-6 post-nav-item"><div class=meta-nav>下一页</div><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-becoming-a-programmer/ rel=prev>Appendix-Becoming-a-Programmer</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>