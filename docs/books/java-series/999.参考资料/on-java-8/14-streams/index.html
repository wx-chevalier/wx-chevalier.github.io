<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="第十四章 流式编程 集合优化了对象的存储，而流（Streams）则是关于一组组对象的处理。 流（Streams）是与任何特定存储机制无关的元素序列——实际上，我们说流是 &ldquo;没有存储 &ldquo;的"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/14-streams/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/14-streams/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/14-streams/"><meta property="og:title" content="14-Streams | Next-gen Tech Edu"><meta property="og:description" content="第十四章 流式编程 集合优化了对象的存储，而流（Streams）则是关于一组组对象的处理。 流（Streams）是与任何特定存储机制无关的元素序列——实际上，我们说流是 &ldquo;没有存储 &ldquo;的"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>14-Streams | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=048b784b8a4f4ecad3e57a0d83d6c332><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">On Java 8</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idb2e20681920018e3a6e20318a9804534")' href=#idb2e20681920018e3a6e20318a9804534 aria-expanded=false aria-controls=idb2e20681920018e3a6e20318a9804534 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/>999.参考资料</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idb2e20681920018e3a6e20318a9804534 aria-expanded=false aria-controls=idb2e20681920018e3a6e20318a9804534><i class="fa-solid fa-angle-down" id=caret-idb2e20681920018e3a6e20318a9804534></i></a></div><ul class="nav docs-sidenav collapse show" id=idb2e20681920018e3a6e20318a9804534><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id4d84ffe3754d5f34aa3c13b4d1952b31")' href=#id4d84ffe3754d5f34aa3c13b4d1952b31 aria-expanded=false aria-controls=id4d84ffe3754d5f34aa3c13b4d1952b31 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/>On Java 8</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id4d84ffe3754d5f34aa3c13b4d1952b31 aria-expanded=false aria-controls=id4d84ffe3754d5f34aa3c13b4d1952b31><i class="fa-solid fa-angle-down" id=caret-id4d84ffe3754d5f34aa3c13b4d1952b31></i></a></div><ul class="nav docs-sidenav collapse show" id=id4d84ffe3754d5f34aa3c13b4d1952b31><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/00-introduction/>00-Introduction</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/01-what-is-an-object/>01-What-is-an-Object</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/02-installing-java-and-the-book-examples/>02-Installing-Java-and-the-Book-Examples</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/03-objects-everywhere/>03-Objects-Everywhere</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/04-operators/>04-Operators</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/05-control-flow/>05-Control-Flow</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/06-housekeeping/>06-Housekeeping</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/07-implementation-hiding/>07-Implementation-Hiding</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/08-reuse/>08-Reuse</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/09-polymorphism/>09-Polymorphism</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/10-interfaces/>10-Interfaces</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/11-inner-classes/>11-Inner-Classes</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/12-collections/>12-Collections</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/13-functional-programming/>13-Functional-Programming</a></li><li class="child level active"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/14-streams/>14-Streams</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/15-exceptions/>15-Exceptions</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/16-validating-your-code/>16-Validating-Your-Code</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/17-files/>17-Files</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/18-strings/>18-Strings</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/19-type-information/>19-Type-Information</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/20-generics/>20-Generics</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/21-arrays/>21-Arrays</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/22-enumerations/>22-Enumerations</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/23-annotations/>23-Annotations</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/24-concurrent-programming/>24-Concurrent-Programming</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/25-patterns/>25-Patterns</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-becoming-a-programmer/>Appendix-Becoming-a-Programmer</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-benefits-and-costs-of-static-type-checking/>Appendix-Benefits-and-Costs-of-Static-Type-Checking</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-collection-topics/>Appendix-Collection-Topics</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-data-compression/>Appendix-Data-Compression</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-io-streams/>Appendix-IO-Streams</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-javadoc/>Appendix-Javadoc</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-low-level-concurrency/>Appendix-Low-Level-Concurrency</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-new-io/>Appendix-New-IO</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-object-serialization/>Appendix-Object-Serialization</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-passing-and-returning-objects/>Appendix-Passing-and-Returning-Objects</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-programming-guidelines/>Appendix-Programming-Guidelines</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-standard-io/>Appendix-Standard-IO</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-supplements/>Appendix-Supplements</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-the-positive-legacy-of-c-plus-plus-and-java/>Appendix-The-Positive-Legacy-of-C-plus-plus-and-Java</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-understanding-equals-and-hashcode/>Appendix-Understanding-equals-and-hashCode</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/glossary/>GLOSSARY</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id214ecc87c188b2007b2d478ce6167fb1")' href=#id214ecc87c188b2007b2d478ce6167fb1 aria-expanded=false aria-controls=id214ecc87c188b2007b2d478ce6167fb1 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/>Think in Java</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id214ecc87c188b2007b2d478ce6167fb1 aria-expanded=false aria-controls=id214ecc87c188b2007b2d478ce6167fb1><i class="fa-solid fa-angle-right" id=caret-id214ecc87c188b2007b2d478ce6167fb1></i></a></div><ul class="nav docs-sidenav collapse" id=id214ecc87c188b2007b2d478ce6167fb1><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idca73ee751e8224db415e54c000dd27fb")' href=#idca73ee751e8224db415e54c000dd27fb aria-expanded=false aria-controls=idca73ee751e8224db415e54c000dd27fb aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/>1.对象入门</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idca73ee751e8224db415e54c000dd27fb aria-expanded=false aria-controls=idca73ee751e8224db415e54c000dd27fb><i class="fa-solid fa-angle-right" id=caret-idca73ee751e8224db415e54c000dd27fb></i></a></div><ul class="nav docs-sidenav collapse" id=idca73ee751e8224db415e54c000dd27fb><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.1-%E6%8A%BD%E8%B1%A1%E7%9A%84%E8%BF%9B%E6%AD%A5/>1.1 抽象的进步</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.10-%E6%B0%B8%E4%B9%85%E6%80%A7/>1.10 永久性</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.11-java%E5%92%8C%E5%9B%A0%E7%89%B9%E7%BD%91/>1.11 Java和因特网</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.12-%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1/>1.12 分析和设计</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.13-java%E8%BF%98%E6%98%AFc++/>1.13 Java还是C++</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.2-%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%8E%A5%E5%8F%A3/>1.2 对象的接口</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.3-%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88%E7%9A%84%E9%9A%90%E8%97%8F/>1.3 实现方案的隐藏</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.4-%E6%96%B9%E6%A1%88%E7%9A%84%E9%87%8D%E5%A4%8D%E4%BD%BF%E7%94%A8/>1.4 方案的重复使用</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.5-%E7%BB%A7%E6%89%BF%E9%87%8D%E6%96%B0%E4%BD%BF%E7%94%A8%E6%8E%A5%E5%8F%A3/>1.5 继承：重新使用接口</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.6-%E5%A4%9A%E6%80%81%E5%AF%B9%E8%B1%A1%E7%9A%84%E4%BA%92%E6%8D%A2%E4%BD%BF%E7%94%A8/>1.6 多态对象的互换使用</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.7-%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E5%AD%98%E5%9C%A8%E6%97%B6%E9%97%B4/>1.7 对象的创建和存在时间</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.9-%E5%A4%9A%E7%BA%BF%E7%A8%8B/>1.9 多线程</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ide41bfd2e5eef4f5cc967d0bf0d3beae5")' href=#ide41bfd2e5eef4f5cc967d0bf0d3beae5 aria-expanded=false aria-controls=ide41bfd2e5eef4f5cc967d0bf0d3beae5 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/>10.Java IO 系统</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ide41bfd2e5eef4f5cc967d0bf0d3beae5 aria-expanded=false aria-controls=ide41bfd2e5eef4f5cc967d0bf0d3beae5><i class="fa-solid fa-angle-right" id=caret-ide41bfd2e5eef4f5cc967d0bf0d3beae5></i></a></div><ul class="nav docs-sidenav collapse" id=ide41bfd2e5eef4f5cc967d0bf0d3beae5><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.1-%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA/>10.1 输入和输出</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.10-%E6%80%BB%E7%BB%93/>10.10 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.11-%E7%BB%83%E4%B9%A0/>10.11 练习</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.2-%E5%A2%9E%E6%B7%BB%E5%B1%9E%E6%80%A7%E5%92%8C%E6%9C%89%E7%94%A8%E7%9A%84%E6%8E%A5%E5%8F%A3/>10.2 增添属性和有用的接口</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.3-%E6%9C%AC%E8%BA%AB%E7%9A%84%E7%BC%BA%E9%99%B7randomaccessfile/>10.3 本身的缺陷：RandomAccessFile</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.4-file%E7%B1%BB/>10.4 File类</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.5-io%E6%B5%81%E7%9A%84%E5%85%B8%E5%9E%8B%E5%BA%94%E7%94%A8/>10.5 IO流的典型应用</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.6-streamtokenizer/>10.6 StreamTokenizer</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.7-java-1.1%E7%9A%84io%E6%B5%81/>10.7 Java 1.1的IO流</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.8-%E5%8E%8B%E7%BC%A9/>10.8 压缩</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.9-%E5%AF%B9%E8%B1%A1%E5%BA%8F%E5%88%97%E5%8C%96/>10.9 对象序列化</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idb836ac598092c15afaccbaa2c465c59e")' href=#idb836ac598092c15afaccbaa2c465c59e aria-expanded=false aria-controls=idb836ac598092c15afaccbaa2c465c59e aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/>11.运行期类型鉴定</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idb836ac598092c15afaccbaa2c465c59e aria-expanded=false aria-controls=idb836ac598092c15afaccbaa2c465c59e><i class="fa-solid fa-angle-right" id=caret-idb836ac598092c15afaccbaa2c465c59e></i></a></div><ul class="nav docs-sidenav collapse" id=idb836ac598092c15afaccbaa2c465c59e><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/11.1-%E5%AF%B9rtti%E7%9A%84%E9%9C%80%E8%A6%81/>11.1 对RTTI的需要</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/11.2-rtti-%E8%AF%AD%E6%B3%95/>11.2 RTTI 语法</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/11.3-%E5%8F%8D%E5%B0%84%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E4%BF%A1%E6%81%AF/>11.3 反射：运行期类信息</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/11.4-%E6%80%BB%E7%BB%93/>11.4 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/11.5-%E7%BB%83%E4%B9%A0/>11.5 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ide320911890134774be5931d1a0a20cc9")' href=#ide320911890134774be5931d1a0a20cc9 aria-expanded=false aria-controls=ide320911890134774be5931d1a0a20cc9 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/>12.传递和返回对象</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ide320911890134774be5931d1a0a20cc9 aria-expanded=false aria-controls=ide320911890134774be5931d1a0a20cc9><i class="fa-solid fa-angle-right" id=caret-ide320911890134774be5931d1a0a20cc9></i></a></div><ul class="nav docs-sidenav collapse" id=ide320911890134774be5931d1a0a20cc9><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.1-%E4%BC%A0%E9%80%92%E6%8C%87%E9%92%88/>12.1 传递指针</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.2-%E5%88%B6%E4%BD%9C%E6%9C%AC%E5%9C%B0%E5%89%AF%E6%9C%AC/>12.2 制作本地副本</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.3-%E5%85%8B%E9%9A%86%E7%9A%84%E6%8E%A7%E5%88%B6/>12.3 克隆的控制</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.4-%E5%8F%AA%E8%AF%BB%E7%B1%BB/>12.4 只读类</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.5-%E6%80%BB%E7%BB%93/>12.5 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.6-%E7%BB%83%E4%B9%A0/>12.6 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-iddba1dfa22d26f49d68205d3c67fa5695")' href=#iddba1dfa22d26f49d68205d3c67fa5695 aria-expanded=false aria-controls=iddba1dfa22d26f49d68205d3c67fa5695 aria-hidden=false data-toggle=collapse></div></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idbb7b9ed9f3766574125ce978e02ab9b3")' href=#idbb7b9ed9f3766574125ce978e02ab9b3 aria-expanded=false aria-controls=idbb7b9ed9f3766574125ce978e02ab9b3 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/>14.多线程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idbb7b9ed9f3766574125ce978e02ab9b3 aria-expanded=false aria-controls=idbb7b9ed9f3766574125ce978e02ab9b3><i class="fa-solid fa-angle-right" id=caret-idbb7b9ed9f3766574125ce978e02ab9b3></i></a></div><ul class="nav docs-sidenav collapse" id=idbb7b9ed9f3766574125ce978e02ab9b3><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.1-%E5%8F%8D%E5%BA%94%E7%81%B5%E6%95%8F%E7%9A%84%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2/>14.1 反应灵敏的用户界面</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.2-%E5%85%B1%E4%BA%AB%E6%9C%89%E9%99%90%E7%9A%84%E8%B5%84%E6%BA%90/>14.2 共享有限的资源</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.3-%E5%A0%B5%E5%A1%9E/>14.3 堵塞</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.4-%E4%BC%98%E5%85%88%E7%BA%A7/>14.4 优先级</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.5-%E5%9B%9E%E9%A1%BErunnable/>14.5 回顾runnable</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.6-%E6%80%BB%E7%BB%93/>14.6 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.7-%E7%BB%83%E4%B9%A0/>14.7 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id0717cbd205b42e749ff12487fe013a48")' href=#id0717cbd205b42e749ff12487fe013a48 aria-expanded=false aria-controls=id0717cbd205b42e749ff12487fe013a48 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/>15.网络编程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id0717cbd205b42e749ff12487fe013a48 aria-expanded=false aria-controls=id0717cbd205b42e749ff12487fe013a48><i class="fa-solid fa-angle-right" id=caret-id0717cbd205b42e749ff12487fe013a48></i></a></div><ul class="nav docs-sidenav collapse" id=id0717cbd205b42e749ff12487fe013a48><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.1-%E6%9C%BA%E5%99%A8%E7%9A%84%E6%A0%87%E8%AF%86/>15.1 机器的标识</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.10-%E7%BB%83%E4%B9%A0/>15.10 练习</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.2-%E5%A5%97%E6%8E%A5%E5%AD%97/>15.2 套接字</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.3-%E6%9C%8D%E5%8A%A1%E5%A4%9A%E4%B8%AA%E5%AE%A2%E6%88%B7/>15.3 服务多个客户</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.4-%E6%95%B0%E6%8D%AE%E6%8A%A5/>15.4 数据报</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.5-%E4%B8%80%E4%B8%AAweb%E5%BA%94%E7%94%A8/>15.5 一个Web应用</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.6-java%E4%B8%8Ecgi%E7%9A%84%E6%B2%9F%E9%80%9A/>15.6 Java与CGI的沟通</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.7-%E7%94%A8jdbc%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93/>15.7 用JDBC连接数据库</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.8-%E8%BF%9C%E7%A8%8B%E6%96%B9%E6%B3%95/>15.8 远程方法</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.9-%E6%80%BB%E7%BB%93/>15.9 总结</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idb45833a961ce68d05972119f0bd5689d")' href=#idb45833a961ce68d05972119f0bd5689d aria-expanded=false aria-controls=idb45833a961ce68d05972119f0bd5689d aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/>16.设计范式</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idb45833a961ce68d05972119f0bd5689d aria-expanded=false aria-controls=idb45833a961ce68d05972119f0bd5689d><i class="fa-solid fa-angle-right" id=caret-idb45833a961ce68d05972119f0bd5689d></i></a></div><ul class="nav docs-sidenav collapse" id=idb45833a961ce68d05972119f0bd5689d><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.1-%E8%8C%83%E5%BC%8F%E7%9A%84%E6%A6%82%E5%BF%B5/>16.1 范式的概念</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.10-%E7%BB%83%E4%B9%A0/>16.10 练习</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.2-%E8%A7%82%E5%AF%9F%E5%99%A8%E8%8C%83%E5%BC%8F/>16.2 观察器范式</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.3-%E6%A8%A1%E6%8B%9F%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AB%99/>16.3 模拟垃圾回收站</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.4-%E6%94%B9%E8%BF%9B%E8%AE%BE%E8%AE%A1/>16.4 改进设计</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.5-%E6%8A%BD%E8%B1%A1%E7%9A%84%E5%BA%94%E7%94%A8/>16.5 抽象的应用</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.6-%E5%A4%9A%E9%87%8D%E6%B4%BE%E9%81%A3/>16.6 多重派遣</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.7-%E8%AE%BF%E9%97%AE%E5%99%A8%E8%8C%83%E5%BC%8F/>16.7 访问器范式</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.8-rtti%E7%9C%9F%E7%9A%84%E6%9C%89%E5%AE%B3%E5%90%97/>16.8 RTTI真的有害吗</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.9-%E6%80%BB%E7%BB%93/>16.9 总结</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id9dcdb57b589db03f63de5260a0331b23")' href=#id9dcdb57b589db03f63de5260a0331b23 aria-expanded=false aria-controls=id9dcdb57b589db03f63de5260a0331b23 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/>17.项目</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id9dcdb57b589db03f63de5260a0331b23 aria-expanded=false aria-controls=id9dcdb57b589db03f63de5260a0331b23><i class="fa-solid fa-angle-right" id=caret-id9dcdb57b589db03f63de5260a0331b23></i></a></div><ul class="nav docs-sidenav collapse" id=id9dcdb57b589db03f63de5260a0331b23><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/17.1-%E6%96%87%E5%AD%97%E5%A4%84%E7%90%86/>17.1 文字处理</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/17.2-%E6%96%B9%E6%B3%95%E6%9F%A5%E6%89%BE%E5%B7%A5%E5%85%B7/>17.2 方法查找工具</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/17.3-%E5%A4%8D%E6%9D%82%E6%80%A7%E7%90%86%E8%AE%BA/>17.3 复杂性理论</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/17.4-%E6%80%BB%E7%BB%93/>17.4 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/17.5-%E7%BB%83%E4%B9%A0/>17.5 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idf0960bbb6faeb4cccffb1ac69252ea28")' href=#idf0960bbb6faeb4cccffb1ac69252ea28 aria-expanded=false aria-controls=idf0960bbb6faeb4cccffb1ac69252ea28 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/>2.一切都是对象</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idf0960bbb6faeb4cccffb1ac69252ea28 aria-expanded=false aria-controls=idf0960bbb6faeb4cccffb1ac69252ea28><i class="fa-solid fa-angle-right" id=caret-idf0960bbb6faeb4cccffb1ac69252ea28></i></a></div><ul class="nav docs-sidenav collapse" id=idf0960bbb6faeb4cccffb1ac69252ea28><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.1-%E7%94%A8%E6%8C%87%E9%92%88%E6%93%8D%E7%BA%B5%E5%AF%B9%E8%B1%A1/>2.1 用指针操纵对象</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.10-%E6%80%BB%E7%BB%93/>2.10 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.11-%E7%BB%83%E4%B9%A0/>2.11 练习</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.2-%E6%89%80%E6%9C%89%E5%AF%B9%E8%B1%A1%E9%83%BD%E5%BF%85%E9%A1%BB%E5%88%9B%E5%BB%BA/>2.2 所有对象都必须创建</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.3-%E7%BB%9D%E5%AF%B9%E4%B8%8D%E8%A6%81%E6%B8%85%E9%99%A4%E5%AF%B9%E8%B1%A1/>2.3 绝对不要清除对象</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.4-%E6%96%B0%E5%BB%BA%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%B1%BB/>2.4 新建数据类型：类</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.5-%E6%96%B9%E6%B3%95%E8%87%AA%E5%8F%98%E9%87%8F%E5%92%8C%E8%BF%94%E5%9B%9E%E5%80%BC/>2.5 方法、自变量和返回值</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.6-%E6%9E%84%E5%BB%BAjava%E7%A8%8B%E5%BA%8F/>2.6 构建Java程序</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.7-%E6%88%91%E4%BB%AC%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AAjava%E7%A8%8B%E5%BA%8F/>2.7 我们的第一个Java程序</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.8-%E6%B3%A8%E9%87%8A%E5%92%8C%E5%B5%8C%E5%85%A5%E6%96%87%E6%A1%A3/>2.8 注释和嵌入文档</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.9-%E7%BC%96%E7%A0%81%E6%A0%B7%E5%BC%8F/>2.9 编码样式</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id742622a5c8a24c8f9f9a1ecc037a0f62")' href=#id742622a5c8a24c8f9f9a1ecc037a0f62 aria-expanded=false aria-controls=id742622a5c8a24c8f9f9a1ecc037a0f62 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/3.%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/>3.控制程序流程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id742622a5c8a24c8f9f9a1ecc037a0f62 aria-expanded=false aria-controls=id742622a5c8a24c8f9f9a1ecc037a0f62><i class="fa-solid fa-angle-right" id=caret-id742622a5c8a24c8f9f9a1ecc037a0f62></i></a></div><ul class="nav docs-sidenav collapse" id=id742622a5c8a24c8f9f9a1ecc037a0f62><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/3.%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/3.1-%E4%BD%BF%E7%94%A8java%E8%BF%90%E7%AE%97%E7%AC%A6/>3.1 使用Java运算符</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/3.%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/3.2-%E6%89%A7%E8%A1%8C%E6%8E%A7%E5%88%B6/>3.2 执行控制</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/3.%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/3.3-%E6%80%BB%E7%BB%93/>3.3 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/3.%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/3.4-%E7%BB%83%E4%B9%A0/>3.4 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idada88f416ec1dfab89f033bf872d6408")' href=#idada88f416ec1dfab89f033bf872d6408 aria-expanded=false aria-controls=idada88f416ec1dfab89f033bf872d6408 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/>4.初始化和清除</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idada88f416ec1dfab89f033bf872d6408 aria-expanded=false aria-controls=idada88f416ec1dfab89f033bf872d6408><i class="fa-solid fa-angle-right" id=caret-idada88f416ec1dfab89f033bf872d6408></i></a></div><ul class="nav docs-sidenav collapse" id=idada88f416ec1dfab89f033bf872d6408><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.1-%E7%94%A8%E6%9E%84%E9%80%A0%E5%99%A8%E8%87%AA%E5%8A%A8%E5%88%9D%E5%A7%8B%E5%8C%96/>4.1 用构造器自动初始化</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.2-%E6%96%B9%E6%B3%95%E9%87%8D%E8%BD%BD/>4.2 方法重载</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.3-%E6%B8%85%E9%99%A4%E6%94%B6%E5%B0%BE%E5%92%8C%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/>4.3 清除：收尾和垃圾收集</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.4-%E6%88%90%E5%91%98%E5%88%9D%E5%A7%8B%E5%8C%96/>4.4 成员初始化</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.5-%E6%95%B0%E7%BB%84%E5%88%9D%E5%A7%8B%E5%8C%96/>4.5 数组初始化</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.6-%E6%80%BB%E7%BB%93/>4.6 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.7-%E7%BB%83%E4%B9%A0/>4.7 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idadcf0cac1c984df3c4fe242a8cf5b932")' href=#idadcf0cac1c984df3c4fe242a8cf5b932 aria-expanded=false aria-controls=idadcf0cac1c984df3c4fe242a8cf5b932 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/5.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/>5.隐藏实施过程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idadcf0cac1c984df3c4fe242a8cf5b932 aria-expanded=false aria-controls=idadcf0cac1c984df3c4fe242a8cf5b932><i class="fa-solid fa-angle-right" id=caret-idadcf0cac1c984df3c4fe242a8cf5b932></i></a></div><ul class="nav docs-sidenav collapse" id=idadcf0cac1c984df3c4fe242a8cf5b932><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/5.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.1-%E5%8C%85%E5%BA%93%E5%8D%95%E5%85%83/>5.1 包：库单元</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/5.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.2-java%E8%AE%BF%E9%97%AE%E6%8C%87%E7%A4%BA%E7%AC%A6/>5.2 Java访问指示符</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/5.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.3-%E6%8E%A5%E5%8F%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/>5.3 接口与实现</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/5.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.4-%E7%B1%BB%E8%AE%BF%E9%97%AE/>5.4 类访问</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/5.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.5-%E6%80%BB%E7%BB%93/>5.5 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/5.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.6-%E7%BB%83%E4%B9%A0/>5.6 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id867e4ec83e2a44d87f6aed649979a0c1")' href=#id867e4ec83e2a44d87f6aed649979a0c1 aria-expanded=false aria-controls=id867e4ec83e2a44d87f6aed649979a0c1 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/>6.类再生</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id867e4ec83e2a44d87f6aed649979a0c1 aria-expanded=false aria-controls=id867e4ec83e2a44d87f6aed649979a0c1><i class="fa-solid fa-angle-right" id=caret-id867e4ec83e2a44d87f6aed649979a0c1></i></a></div><ul class="nav docs-sidenav collapse" id=id867e4ec83e2a44d87f6aed649979a0c1><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.1-%E5%90%88%E6%88%90%E7%9A%84%E8%AF%AD%E6%B3%95/>6.1 合成的语法</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.10-%E6%80%BB%E7%BB%93/>6.10 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.11-%E7%BB%83%E4%B9%A0/>6.11 练习</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.2-%E7%BB%A7%E6%89%BF%E7%9A%84%E8%AF%AD%E6%B3%95/>6.2 继承的语法</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.3-%E5%90%88%E6%88%90%E4%B8%8E%E7%BB%A7%E6%89%BF%E7%9A%84%E7%BB%93%E5%90%88/>6.3 合成与继承的结合</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.4-%E5%88%B0%E5%BA%95%E9%80%89%E6%8B%A9%E5%90%88%E6%88%90%E8%BF%98%E6%98%AF%E7%BB%A7%E6%89%BF/>6.4 到底选择合成还是继承</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.5-protected/>6.5 protected</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.6-%E7%B4%AF%E7%A7%AF%E5%BC%80%E5%8F%91/>6.6 累积开发</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.7-%E4%B8%8A%E6%BA%AF%E9%80%A0%E5%9E%8B/>6.7 上溯造型</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.8-final%E5%85%B3%E9%94%AE%E5%AD%97/>6.8 final关键字</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.9-%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E7%B1%BB%E8%A3%85%E8%BD%BD/>6.9 初始化和类装载</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idf3d9d72d599cb56e323c67f4c3e5106c")' href=#idf3d9d72d599cb56e323c67f4c3e5106c aria-expanded=false aria-controls=idf3d9d72d599cb56e323c67f4c3e5106c aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/>7.多态性</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idf3d9d72d599cb56e323c67f4c3e5106c aria-expanded=false aria-controls=idf3d9d72d599cb56e323c67f4c3e5106c><i class="fa-solid fa-angle-right" id=caret-idf3d9d72d599cb56e323c67f4c3e5106c></i></a></div><ul class="nav docs-sidenav collapse" id=idf3d9d72d599cb56e323c67f4c3e5106c><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.1-%E4%B8%8A%E6%BA%AF%E9%80%A0%E5%9E%8B/>7.1 上溯造型</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.10-%E7%BB%83%E4%B9%A0/>7.10 练习</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.2-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/>7.2 深入理解</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.3-%E8%A6%86%E7%9B%96%E4%B8%8E%E9%87%8D%E8%BD%BD/>7.3 覆盖与重载</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.4-%E6%8A%BD%E8%B1%A1%E7%B1%BB%E5%92%8C%E6%96%B9%E6%B3%95/>7.4 抽象类和方法</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.5-%E6%8E%A5%E5%8F%A3/>7.5 接口</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.6-%E5%86%85%E9%83%A8%E7%B1%BB/>7.6 内部类</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.7-%E6%9E%84%E9%80%A0%E5%99%A8%E5%92%8C%E5%A4%9A%E6%80%81%E6%80%A7/>7.7 构造器和多态性</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.8-%E9%80%9A%E8%BF%87%E7%BB%A7%E6%89%BF%E8%BF%9B%E8%A1%8C%E8%AE%BE%E8%AE%A1/>7.8 通过继承进行设计</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.9-%E6%80%BB%E7%BB%93/>7.9 总结</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ide8fec1c6956e847a0af483b3edf921cd")' href=#ide8fec1c6956e847a0af483b3edf921cd aria-expanded=false aria-controls=ide8fec1c6956e847a0af483b3edf921cd aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/>8.对象的容纳</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ide8fec1c6956e847a0af483b3edf921cd aria-expanded=false aria-controls=ide8fec1c6956e847a0af483b3edf921cd><i class="fa-solid fa-angle-right" id=caret-ide8fec1c6956e847a0af483b3edf921cd></i></a></div><ul class="nav docs-sidenav collapse" id=ide8fec1c6956e847a0af483b3edf921cd><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.1-%E6%95%B0%E7%BB%84/>8.1 数组</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.2-%E9%9B%86%E5%90%88/>8.2 集合</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.3-%E8%BF%AD%E4%BB%A3%E5%99%A8/>8.3 迭代器</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.4-%E9%9B%86%E5%90%88%E7%9A%84%E7%B1%BB%E5%9E%8B/>8.4 集合的类型</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.5-%E6%8E%92%E5%BA%8F/>8.5 排序</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.6-%E9%80%9A%E7%94%A8%E9%9B%86%E5%90%88%E5%BA%93/>8.6 通用集合库</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.7-%E6%96%B0%E9%9B%86%E5%90%88/>8.7 新集合</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.8-%E6%80%BB%E7%BB%93/>8.8 总结</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.9-%E7%BB%83%E4%B9%A0/>8.9 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id24b0f4bf6b1849b1d34cc1cf59d9a598")' href=#id24b0f4bf6b1849b1d34cc1cf59d9a598 aria-expanded=false aria-controls=id24b0f4bf6b1849b1d34cc1cf59d9a598 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/9.%E5%BC%82%E5%B8%B8%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6/>9.异常差错控制</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id24b0f4bf6b1849b1d34cc1cf59d9a598 aria-expanded=false aria-controls=id24b0f4bf6b1849b1d34cc1cf59d9a598><i class="fa-solid fa-angle-right" id=caret-id24b0f4bf6b1849b1d34cc1cf59d9a598></i></a></div><ul class="nav docs-sidenav collapse" id=id24b0f4bf6b1849b1d34cc1cf59d9a598><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/9.%E5%BC%82%E5%B8%B8%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6/9.10-%E7%BB%83%E4%B9%A0/>9.10 练习</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/9.%E5%BC%82%E5%B8%B8%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6/9.6-%E7%94%A8finally%E6%B8%85%E9%99%A4/>9.6 用finally清除</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/9.%E5%BC%82%E5%B8%B8%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6/9.7-%E6%9E%84%E9%80%A0%E5%99%A8/>9.7 构造器</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/9.%E5%BC%82%E5%B8%B8%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6/9.9-%E6%80%BB%E7%BB%93/>9.9 总结</a></li></ul></div><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95a-%E4%BD%BF%E7%94%A8%E9%9D%9Ejava%E4%BB%A3%E7%A0%81/>附录A 使用非JAVA代码</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95b-%E5%AF%B9%E6%AF%94c++%E5%92%8Cjava/>附录B 对比C++和Java</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95c-java%E7%BC%96%E7%A8%8B%E8%A7%84%E5%88%99/>附录C Java编程规则</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95d-%E6%80%A7%E8%83%BD/>附录D 性能</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95e-%E5%85%B3%E4%BA%8E%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%9A%84%E4%B8%80%E4%BA%9B%E8%AF%9D/>附录E 关于垃圾收集的一些话</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95f-%E6%8E%A8%E8%8D%90%E8%AF%BB%E7%89%A9/>附录F 推荐读物</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2%E7%9A%84%E8%AF%9D/>写在前面的话</a></li><li class="child level"><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E5%BC%95%E8%A8%80/>引言</a></li></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#流支持>流支持</a></li><li><a href=#流创建>流创建</a><ul><li><a href=#随机数流>随机数流</a></li><li><a href=#int-类型的范围>int 类型的范围</a></li><li><a href=#generate>generate()</a></li><li><a href=#iterate>iterate()</a></li><li><a href=#流的建造者模式>流的建造者模式</a></li><li><a href=#arrays>Arrays</a></li><li><a href=#正则表达式>正则表达式</a></li></ul></li><li><a href=#中间操作>中间操作</a><ul><li><a href=#跟踪和调试>跟踪和调试</a></li><li><a href=#流元素排序>流元素排序</a></li><li><a href=#移除元素>移除元素</a></li><li><a href=#应用函数到元素>应用函数到元素</a></li><li><a href=#在-map-中组合流>在 <code>map()</code> 中组合流</a></li></ul></li><li><a href=#optional-类>Optional 类</a><ul><li><a href=#便利函数>便利函数</a></li><li><a href=#创建-optional>创建 Optional</a></li><li><a href=#optional-对象操作>Optional 对象操作</a></li><li><a href=#optional-流>Optional 流</a></li></ul></li><li><a href=#终端操作>终端操作</a><ul><li><a href=#数组>数组</a></li><li><a href=#循环>循环</a></li><li><a href=#集合>集合</a></li><li><a href=#组合>组合</a></li><li><a href=#匹配>匹配</a></li><li><a href=#查找>查找</a></li><li><a href=#信息>信息</a></li><li><a href=#数字流信息>数字流信息</a></li></ul></li><li><a href=#本章小结>本章小结</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>14-Streams</h1><div class=article-style><h1 id=第十四章-流式编程>第十四章 流式编程</h1><blockquote><p>集合优化了对象的存储，而流（Streams）则是关于一组组对象的处理。</p></blockquote><p>流（Streams）是与任何特定存储机制无关的元素序列——实际上，我们说流是 &ldquo;没有存储 &ldquo;的。</p><p>取代了在集合中迭代元素的做法，使用流即可从管道中提取元素并对其操作。这些管道通常被串联在一起形成一整套的管线，来对流进行操作。</p><p>在大多数情况下，将对象存储在集合中就是为了处理它们，因此你会发现你把编程的主要焦点从集合转移到了流上。</p><p>流的一个核心好处是，它使得程序更加短小并且更易理解。当 Lambda 表达式和方法引用（method references）和流一起使用的时候会让人感觉自成一体。流使得 Java 8 更具吸引力。</p><p>举个例子，假如你要随机展示 5 至 20 之间不重复的整数并进行排序。你要对它们进行排序的事实，会使你首先关注选用哪个有序集合，然后围绕这个集合进行后续的操作。但是使用流式编程，你就可以简单陈述你要做什么：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/Randoms.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Randoms</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>Random</span><span class=o>(</span><span class=mi>47</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>ints</span><span class=o>(</span><span class=mi>5</span><span class=o>,</span> <span class=mi>20</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>distinct</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>7</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>sorted</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>6
10
13
16
17
18
19
</code></pre><p>首先，我们给 <strong>Random</strong> 对象一个种子值 47（以便程序再次运行时产生相同的输出）。<code>ints()</code> 方法产生一个流并且 <code>ints()</code> 方法有多种方式的重载 —— 两个参数限定了产生的数值的边界。这将生成一个随机整数流。我们用 <em>流的中间操作</em>（intermediate stream operation） <code>distinct()</code> 使流中的整数不重复，然后使用 <code>limit()</code> 方法获取前 7 个元素。接下来使用 <code>sorted()</code> 方法排序。最终使用 <code>forEach()</code> 方法遍历输出，它根据传递给它的函数对流中的每个对象执行操作。在这里，我们传递了一个可以在控制台显示每个元素的方法引用：<code>System.out::println</code> 。</p><p>注意 <code>Randoms.java</code> 中没有声明任何变量。流可以在不曾使用赋值或可变数据的情况下，对有状态的系统建模，这非常有用。</p><p><em>声明式编程</em>（Declarative programming）是一种编程风格——它声明了要做什么，而不是指明（每一步）如何做。而这正是我们在函数式编程中所看到的（编程风格）。你会注意到，命令式（Imperative）编程的形式（指明每一步如何做）会更难理解：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/ImperativeRandoms.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ImperativeRandoms</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>(</span><span class=mi>47</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>SortedSet</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>rints</span> <span class=o>=</span> <span class=k>new</span> <span class=n>TreeSet</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span><span class=o>(</span><span class=n>rints</span><span class=o>.</span><span class=na>size</span><span class=o>()</span> <span class=o>&lt;</span> <span class=mi>7</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>r</span> <span class=o>=</span> <span class=n>rand</span><span class=o>.</span><span class=na>nextInt</span><span class=o>(</span><span class=mi>20</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=o>(</span><span class=n>r</span> <span class=o>&lt;</span> <span class=mi>5</span><span class=o>)</span> <span class=k>continue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>rints</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>r</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>rints</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>[7, 8, 9, 11, 13, 15, 18]
</code></pre><p>在 <code>Randoms.java</code> 中，我们无需定义任何变量，但在这里我们定义了 3 个变量： <code>rand</code>，<code>rints</code> 和 <code>r</code>。由于 <code>nextInt()</code> 方法没有下限的原因（其内置的下限永远为 0），这段代码实现起来更复杂。所以我们要生成额外的值来过滤小于 5 的结果。</p><p>注意，你必须研究代码才能搞清楚<code>ImperativeRandoms.java</code>程序在做什么。而在 <code>Randoms.java</code> 中，代码会直接告诉你它在做什么。这种语义的清晰性是使用 Java 8 流式编程的重要原因之一。</p><p>像在 <code>ImperativeRandoms.java</code> 中那样显式地编写迭代过程的方式称为<em>外部迭代（external iteration）</em>。而在 <code>Randoms.java</code> 中，你看不到任何上述的迭代过程，所以它被称为<em>内部迭代（internal iteration）</em>，这是流式编程的一个核心特征。内部迭代产生的代码可读性更强，而且能更简单的使用多核处理器。通过放弃对迭代过程的控制，可以把控制权交给并行化机制。我们将在<a href=24-Concurrent-Programming.md>并发编程</a>一章中学习这部分内容。</p><p>另一个重要方面，流是懒加载的。这代表着它只在绝对必要时才计算。你可以将流看作“延迟列表”。由于计算延迟，流使我们能够表示非常大（甚至无限）的序列，而不需要考虑内存问题。</p><h2 id=流支持>流支持</h2><p>Java 设计者面临着这样一个难题：现存的大量类库不仅为 Java 所用，同时也被应用在整个 Java 生态圈数百万行的代码中。如何将一个全新的流的概念融入到现有类库中呢？</p><p>比如在 <strong>Random</strong> 中添加更多的方法。只要不改变原有的方法，现有代码就不会受到干扰。</p><p>一个大的挑战来自于使用接口的库。集合类是其中关键的一部分，因为你想把集合转为流。但是如果你将一个新方法添加到接口，那就破坏了每一个实现接口的类，因为这些类都没有实现你添加的新方法。</p><p>Java 8 采用的解决方案是：在<a href=10-Interfaces.md>接口</a>中添加被 <code>default</code>（<code>默认</code>）修饰的方法。通过这种方案，设计者们可以将流式（<em>stream</em>）方法平滑地嵌入到现有类中。流方法预置的操作几乎已满足了我们平常所有的需求。流操作的类型有三种：创建流，修改流元素（中间操作， Intermediate Operations），消费流元素（终端操作， Terminal Operations）。最后一种类型通常意味着收集流元素（通常是汇入一个集合）。</p><p>下面我们来看下每种类型的流操作。</p><h2 id=流创建>流创建</h2><p>你可以通过 <code>Stream.of()</code> 很容易地将一组元素转化成为流（<code>Bubble</code> 类在本章的后面定义）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/StreamOf.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>StreamOf</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Stream</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=k>new</span> <span class=n>Bubble</span><span class=o>(</span><span class=mi>1</span><span class=o>),</span> <span class=k>new</span> <span class=n>Bubble</span><span class=o>(</span><span class=mi>2</span><span class=o>),</span> <span class=k>new</span> <span class=n>Bubble</span><span class=o>(</span><span class=mi>3</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Stream</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=s>&#34;It&#39;s &#34;</span><span class=o>,</span> <span class=s>&#34;a &#34;</span><span class=o>,</span> <span class=s>&#34;wonderful &#34;</span><span class=o>,</span> <span class=s>&#34;day &#34;</span><span class=o>,</span> <span class=s>&#34;for &#34;</span><span class=o>,</span> <span class=s>&#34;pie!&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>print</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Stream</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=mf>3.14159</span><span class=o>,</span> <span class=mf>2.718</span><span class=o>,</span> <span class=mf>1.618</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>Bubble(1)
Bubble(2)
Bubble(3)
It&#39;s a wonderful day for pie!
3.14159
2.718
1.618
</code></pre><p>除此之外，每个集合都可以通过调用 <code>stream()</code> 方法来产生一个流。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/CollectionToStream.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CollectionToStream</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>List</span><span class=o>&lt;</span><span class=n>Bubble</span><span class=o>&gt;</span> <span class=n>bubbles</span> <span class=o>=</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=k>new</span> <span class=n>Bubble</span><span class=o>(</span><span class=mi>1</span><span class=o>),</span> <span class=k>new</span> <span class=n>Bubble</span><span class=o>(</span><span class=mi>2</span><span class=o>),</span> <span class=k>new</span> <span class=n>Bubble</span><span class=o>(</span><span class=mi>3</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>bubbles</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>mapToInt</span><span class=o>(</span><span class=n>b</span> <span class=o>-&gt;</span> <span class=n>b</span><span class=o>.</span><span class=na>i</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>sum</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>w</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=o>&lt;&gt;(</span><span class=n>Arrays</span><span class=o>.</span><span class=na>asList</span><span class=o>(</span><span class=s>&#34;It&#39;s a wonderful day for pie!&#34;</span><span class=o>.</span><span class=na>split</span><span class=o>(</span><span class=s>&#34; &#34;</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>        <span class=n>w</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>         <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>x</span> <span class=o>-&gt;</span> <span class=n>x</span> <span class=o>+</span> <span class=s>&#34; &#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>         <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>print</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Double</span><span class=o>&gt;</span> <span class=n>m</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;pi&#34;</span><span class=o>,</span> <span class=mf>3.14159</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;e&#34;</span><span class=o>,</span> <span class=mf>2.718</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;phi&#34;</span><span class=o>,</span> <span class=mf>1.618</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span><span class=o>.</span><span class=na>entrySet</span><span class=o>().</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>e</span> <span class=o>-&gt;</span> <span class=n>e</span><span class=o>.</span><span class=na>getKey</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34;: &#34;</span> <span class=o>+</span> <span class=n>e</span><span class=o>.</span><span class=na>getValue</span><span class=o>())</span>
</span></span><span class=line><span class=cl>                    <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>6
a pie! It&#39;s for wonderful day
phi: 1.618
e: 2.718
pi: 3.14159
</code></pre><p>在创建 <code>List&lt;Bubble></code> 对象之后，我们只需要简单地调用所有集合中都有的 <code>stream()</code>。中间操作 <code>map()</code> 会获取流中的所有元素，并且对流中元素应用操作从而产生新的元素，并将其传递到后续的流中。通常 <code>map()</code> 会获取对象并产生新的对象，但在这里产生了特殊的用于数值类型的流。例如，<code>mapToInt()</code> 方法将一个对象流（object stream）转换成为包含整型数字的 <code>IntStream</code>。同样，针对 <code>Float</code> 和 <code>Double</code> 也有类似名字的操作。</p><p>我们通过调用字符串的 <code>split()</code>（该方法会根据参数来拆分字符串）来获取元素用于定义变量 <code>w</code>。稍后你会知道 <code>split()</code> 参数可以是十分复杂，但在这里我们只是根据空格来分割字符串。</p><p>为了从 <strong>Map</strong> 集合中产生流数据，我们首先调用 <code>entrySet()</code> 产生一个对象流，每个对象都包含一个 <code>key</code> 键以及与其相关联的 <code>value</code> 值。然后分别调用 <code>getKey()</code> 和 <code>getValue()</code> 获取值。</p><h3 id=随机数流>随机数流</h3><p><code>Random</code> 类被一组生成流的方法增强了。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/RandomGenerators.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>RandomGenerators</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=kt>void</span> <span class=nf>show</span><span class=o>(</span><span class=n>Stream</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>stream</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>stream</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>4</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;++++++++&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>(</span><span class=mi>47</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>show</span><span class=o>(</span><span class=n>rand</span><span class=o>.</span><span class=na>ints</span><span class=o>().</span><span class=na>boxed</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>show</span><span class=o>(</span><span class=n>rand</span><span class=o>.</span><span class=na>longs</span><span class=o>().</span><span class=na>boxed</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>show</span><span class=o>(</span><span class=n>rand</span><span class=o>.</span><span class=na>doubles</span><span class=o>().</span><span class=na>boxed</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 控制上限和下限：
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>show</span><span class=o>(</span><span class=n>rand</span><span class=o>.</span><span class=na>ints</span><span class=o>(</span><span class=mi>10</span><span class=o>,</span> <span class=mi>20</span><span class=o>).</span><span class=na>boxed</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>show</span><span class=o>(</span><span class=n>rand</span><span class=o>.</span><span class=na>longs</span><span class=o>(</span><span class=mi>50</span><span class=o>,</span> <span class=mi>100</span><span class=o>).</span><span class=na>boxed</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>show</span><span class=o>(</span><span class=n>rand</span><span class=o>.</span><span class=na>doubles</span><span class=o>(</span><span class=mi>20</span><span class=o>,</span> <span class=mi>30</span><span class=o>).</span><span class=na>boxed</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 控制流大小：
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>show</span><span class=o>(</span><span class=n>rand</span><span class=o>.</span><span class=na>ints</span><span class=o>(</span><span class=mi>2</span><span class=o>).</span><span class=na>boxed</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>show</span><span class=o>(</span><span class=n>rand</span><span class=o>.</span><span class=na>longs</span><span class=o>(</span><span class=mi>2</span><span class=o>).</span><span class=na>boxed</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>show</span><span class=o>(</span><span class=n>rand</span><span class=o>.</span><span class=na>doubles</span><span class=o>(</span><span class=mi>2</span><span class=o>).</span><span class=na>boxed</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 控制流的大小和界限
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>show</span><span class=o>(</span><span class=n>rand</span><span class=o>.</span><span class=na>ints</span><span class=o>(</span><span class=mi>3</span><span class=o>,</span> <span class=mi>3</span><span class=o>,</span> <span class=mi>9</span><span class=o>).</span><span class=na>boxed</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>show</span><span class=o>(</span><span class=n>rand</span><span class=o>.</span><span class=na>longs</span><span class=o>(</span><span class=mi>3</span><span class=o>,</span> <span class=mi>12</span><span class=o>,</span> <span class=mi>22</span><span class=o>).</span><span class=na>boxed</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>show</span><span class=o>(</span><span class=n>rand</span><span class=o>.</span><span class=na>doubles</span><span class=o>(</span><span class=mi>3</span><span class=o>,</span> <span class=mf>11.5</span><span class=o>,</span> <span class=mf>12.3</span><span class=o>).</span><span class=na>boxed</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>-1172028779
1717241110
-2014573909
229403722
++++++++
2955289354441303771
3476817843704654257
-8917117694134521474
4941259272818818752
++++++++
0.2613610344283964
0.0508673570556899
0.8037155449603999
0.7620665811558285
++++++++
16
10
11
12
++++++++
65
99
54
58
++++++++
29.86777681078574
24.83968447804611
20.09247112332014
24.046793846338723
++++++++
1169976606
1947946283
++++++++
2970202997824602425
-2325326920272830366
++++++++
0.7024254510631527
0.6648552384607359
++++++++
6
7
7
++++++++
17
12
20
++++++++
12.27872414236691
11.732085449736195
12.196509449817267
++++++++
</code></pre><p>为了消除冗余代码，我创建了一个泛型方法 <code>show(Stream&lt;T> stream)</code> （在讲解泛型之前就使用这个特性，确实有点作弊，但是回报是值得的）。类型参数 <code>T</code> 可以是任何类型，所以这个方法对 <strong>Integer</strong>、<strong>Long</strong> 和 <strong>Double</strong> 类型都生效。但是 <strong>Random</strong> 类只能生成基本类型 <strong>int</strong>， <strong>long</strong>， <strong>double</strong> 的流。幸运的是， <code>boxed()</code> 流操作将会自动地把基本类型包装成为对应的装箱类型，从而使得 <code>show()</code> 能够接受流。</p><p>我们可以使用 <strong>Random</strong> 为任意对象集合创建 <strong>Supplier</strong>。从文本文件提供字符串对象的例子如下。</p><p>Cheese.dat 文件内容：</p><pre tabindex=0><code>// streams/Cheese.dat
Not much of a cheese shop really, is it?
Finest in the district, sir.
And what leads you to that conclusion?
Well, it&#39;s so clean.
It&#39;s certainly uncontaminated by cheese.
</code></pre><p>我们通过 <strong>File</strong> 类将 Cheese.dat 文件的所有行读取到 <code>List&lt;String></code> 中。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/RandomWords.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.io.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.nio.file.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>RandomWords</span> <span class=kd>implements</span> <span class=n>Supplier</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>words</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>(</span><span class=mi>47</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>RandomWords</span><span class=o>(</span><span class=n>String</span> <span class=n>fname</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>lines</span> <span class=o>=</span> <span class=n>Files</span><span class=o>.</span><span class=na>readAllLines</span><span class=o>(</span><span class=n>Paths</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>fname</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 略过第一行
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>for</span> <span class=o>(</span><span class=n>String</span> <span class=n>line</span> <span class=o>:</span> <span class=n>lines</span><span class=o>.</span><span class=na>subList</span><span class=o>(</span><span class=mi>1</span><span class=o>,</span> <span class=n>lines</span><span class=o>.</span><span class=na>size</span><span class=o>()))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=o>(</span><span class=n>String</span> <span class=n>word</span> <span class=o>:</span> <span class=n>line</span><span class=o>.</span><span class=na>split</span><span class=o>(</span><span class=s>&#34;[ .?,]+&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=n>words</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>word</span><span class=o>.</span><span class=na>toLowerCase</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>get</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>words</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>rand</span><span class=o>.</span><span class=na>nextInt</span><span class=o>(</span><span class=n>words</span><span class=o>.</span><span class=na>size</span><span class=o>()));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>words</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>Collectors</span><span class=o>.</span><span class=na>joining</span><span class=o>(</span><span class=s>&#34; &#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span>
</span></span><span class=line><span class=cl>            <span class=n>Stream</span><span class=o>.</span><span class=na>generate</span><span class=o>(</span><span class=k>new</span> <span class=n>RandomWords</span><span class=o>(</span><span class=s>&#34;Cheese.dat&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>10</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>Collectors</span><span class=o>.</span><span class=na>joining</span><span class=o>(</span><span class=s>&#34; &#34;</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>it shop sir the much cheese by conclusion district is
</code></pre><p>在这里可以看到 <code>split()</code> 更复杂的运用。在构造器里，每一行都被 <code>split()</code> 通过方括号内的空格或其它标点符号分割。在方括号后面的 <code>+</code> 表示 <code>+</code> 前面的东西可以出现一次或者多次（正则表达式）。</p><p>你会发现构造函数使用命令式编程（外部迭代）进行循环。在以后的例子中，你会看到我们是如何去除命令式编程。这种旧的形式虽不是特别糟糕，但使用流会让人感觉更好。</p><p>在<code>toString()</code> 和<code>main()</code>方法中你看到了 <code>collect()</code> 操作，它根据参数来结合所有的流元素。当你用 <code>Collectors.joining()</code>作为 <code>collect()</code> 的参数时，将得到一个<code>String</code> 类型的结果，该结果是流中的所有元素被<code>joining()</code>的参数隔开。还有很多不同的 <code>Collectors</code> 用于产生不同的结果。</p><p>在主方法中，我们提前看到了 <strong>Stream.</strong><code>generate()</code> 的用法，它可以把任意 <code>Supplier&lt;T></code> 用于生成 <code>T</code> 类型的流。</p><h3 id=int-类型的范围>int 类型的范围</h3><p><code>IntStream</code> 类提供了 <code>range()</code> 方法用于生成整型序列的流。编写循环时，这个方法会更加便利：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/Ranges.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import static</span> <span class=nn>java.util.stream.IntStream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Ranges</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 传统方法:
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kt>int</span> <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>10</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>20</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>+=</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>result</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// for-in 循环:
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>:</span> <span class=n>range</span><span class=o>(</span><span class=mi>10</span><span class=o>,</span> <span class=mi>20</span><span class=o>).</span><span class=na>toArray</span><span class=o>())</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>+=</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>result</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 使用流:
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>range</span><span class=o>(</span><span class=mi>10</span><span class=o>,</span> <span class=mi>20</span><span class=o>).</span><span class=na>sum</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>145
145
145
</code></pre><p>在主方法中的第一种方式是我们传统编写 <code>for</code> 循环的方式；第二种方式，我们使用 <code>range()</code> 创建了流并将其转化为数组，然后在 <code>for-in</code> 代码块中使用。但是，如果你能像第三种方法那样全程使用流是更好的。我们对范围中的数字进行求和。在流中可以很方便的使用 <code>sum()</code> 操作求和。</p><p>注意 <strong>IntStream.</strong><code>range()</code> 相比 <code>onjava.Range.range()</code> 受更多限制。这是由于其可选的第三个参数，后者允许步长大于 1，并且可以从大到小来生成。</p><p>实用小功能 <code>repeat()</code> 可以用来替换简单的 <code>for</code> 循环。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// onjava/Repeat.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nn>onjava</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import static</span> <span class=nn>java.util.stream.IntStream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Repeat</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>repeat</span><span class=o>(</span><span class=kt>int</span> <span class=n>n</span><span class=o>,</span> <span class=n>Runnable</span> <span class=n>action</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>range</span><span class=o>(</span><span class=mi>0</span><span class=o>,</span> <span class=n>n</span><span class=o>).</span><span class=na>forEach</span><span class=o>(</span><span class=n>i</span> <span class=o>-&gt;</span> <span class=n>action</span><span class=o>.</span><span class=na>run</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>其产生的循环更加清晰：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/Looping.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import static</span> <span class=nn>onjava.Repeat.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Looping</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>hi</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Hi!&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>repeat</span><span class=o>(</span><span class=mi>3</span><span class=o>,</span> <span class=o>()</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Looping!&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>repeat</span><span class=o>(</span><span class=mi>2</span><span class=o>,</span> <span class=n>Looping</span><span class=o>::</span><span class=n>hi</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>Looping!
Looping!
Looping!
Hi!
Hi!
</code></pre><p>原则上，在代码中包含和解释 <code>repeat()</code> 并不值得。诚然它是一个相当透明的工具，但这取决于你的团队和公司的运作方式。</p><h3 id=generate>generate()</h3><p>参照 <code>RandomWords.java</code> 中 <strong>Stream.</strong><code>generate()</code> 搭配 <code>Supplier&lt;T></code> 使用的例子。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/Generator.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Generator</span> <span class=kd>implements</span> <span class=n>Supplier</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>(</span><span class=mi>47</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span><span class=o>[]</span> <span class=n>letters</span> <span class=o>=</span> <span class=s>&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><span class=o>.</span><span class=na>toCharArray</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>get</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;&#34;</span> <span class=o>+</span> <span class=n>letters</span><span class=o>[</span><span class=n>rand</span><span class=o>.</span><span class=na>nextInt</span><span class=o>(</span><span class=n>letters</span><span class=o>.</span><span class=na>length</span><span class=o>)];</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>word</span> <span class=o>=</span> <span class=n>Stream</span><span class=o>.</span><span class=na>generate</span><span class=o>(</span><span class=k>new</span> <span class=n>Generator</span><span class=o>())</span>
</span></span><span class=line><span class=cl>                            <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>30</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                            <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>Collectors</span><span class=o>.</span><span class=na>joining</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>word</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>YNZBRNYGCFOWZNTCQRGSEGZMMJMROE
</code></pre><p>使用 <code>Random.nextInt()</code> 方法来挑选字母表中的大写字母。<code>Random.nextInt()</code> 的参数代表可以接受的最大的随机数范围，所以使用数组边界是经过慎重考虑的。</p><p>如果要创建包含相同对象的流，只需要传递一个生成那些对象的 <code>lambda</code> 到 <code>generate()</code> 中：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/Duplicator.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Duplicator</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Stream</span><span class=o>.</span><span class=na>generate</span><span class=o>(()</span> <span class=o>-&gt;</span> <span class=s>&#34;duplicate&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>              <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>3</span><span class=o>)</span>
</span></span><span class=line><span class=cl>              <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>duplicate
duplicate
duplicate
</code></pre><p>如下是在本章之前例子中使用过的 <code>Bubble</code> 类。<strong>注意</strong>它包含了自己的静态生成器（Static generator）方法。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/Bubble.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Bubble</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Bubble</span><span class=o>(</span><span class=kt>int</span> <span class=n>n</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>=</span> <span class=n>n</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;Bubble(&#34;</span> <span class=o>+</span> <span class=n>i</span> <span class=o>+</span> <span class=s>&#34;)&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>int</span> <span class=n>count</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Bubble</span> <span class=nf>bubbler</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>Bubble</span><span class=o>(</span><span class=n>count</span><span class=o>++);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>由于 <code>bubbler()</code> 与 <code>Supplier&lt;Bubble></code> 是接口兼容的，我们可以将其方法引用直接传递给 <strong>Stream.</strong><code>generate()</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/Bubbles.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Bubbles</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Stream</span><span class=o>.</span><span class=na>generate</span><span class=o>(</span><span class=n>Bubble</span><span class=o>::</span><span class=n>bubbler</span><span class=o>)</span>
</span></span><span class=line><span class=cl>              <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>5</span><span class=o>)</span>
</span></span><span class=line><span class=cl>              <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>Bubble(0)
Bubble(1)
Bubble(2)
Bubble(3)
Bubble(4)
</code></pre><p>这是创建单独工厂类（Separate Factory class）的另一种方式。在很多方面它更加整洁，但是这是一个关于代码组织和品味的问题——你总是可以创建一个完全不同的工厂类。</p><h3 id=iterate>iterate()</h3><p><code>Stream.iterate()</code> 产生的流的第一个元素是种子（iterate 方法的第一个参数），然后将种子传递给方法（iterate 方法的第二个参数）。方法运行的结果被添加到流（作为流的下一个元素），并被存储起来，作为下次调用 <code>iterate()</code>方法时的第一个参数，以此类推。我们可以利用 <code>iterate()</code> 生成一个斐波那契数列（上一章已经遇到过 Fibonacci）。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/Fibonacci.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Fibonacci</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>x</span> <span class=o>=</span> <span class=mi>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Stream</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=nf>numbers</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Stream</span><span class=o>.</span><span class=na>iterate</span><span class=o>(</span><span class=mi>0</span><span class=o>,</span> <span class=n>i</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>result</span> <span class=o>=</span> <span class=n>x</span> <span class=o>+</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=n>x</span> <span class=o>=</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>result</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>});</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>Fibonacci</span><span class=o>().</span><span class=na>numbers</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                       <span class=o>.</span><span class=na>skip</span><span class=o>(</span><span class=mi>20</span><span class=o>)</span> <span class=c1>// 过滤前 20 个
</span></span></span><span class=line><span class=cl><span class=c1></span>                       <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>10</span><span class=o>)</span> <span class=c1>// 然后取 10 个
</span></span></span><span class=line><span class=cl><span class=c1></span>                       <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>6765
10946
17711
28657
46368
75025
121393
196418
317811
514229
</code></pre><p>斐波那契数列将数列中最后两个元素进行求和以产生下一个元素。<code>iterate()</code> 只能记忆结果，因此我们需要利用一个变量 <code>x</code> 追踪另外一个元素。</p><p>在主方法中，我们使用了一个之前没有见过的 <code>skip()</code> 操作。它根据参数丢弃指定数量的流元素。在这里，我们丢弃了前 20 个元素。</p><h3 id=流的建造者模式>流的建造者模式</h3><p>在<em>建造者模式</em>（Builder design pattern）中，首先创建一个 <code>builder</code> 对象，然后将创建流所需的多个信息传递给它，最后<code>builder</code> 对象执行”创建“流的操作。<strong>Stream</strong> 库提供了这样的 <code>Builder</code>。在这里，我们重新审视文件读取并将其转换成为单词流的过程。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/FileToWordsBuilder.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.io.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.nio.file.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>FileToWordsBuilder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Stream</span><span class=o>.</span><span class=na>Builder</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>builder</span> <span class=o>=</span> <span class=n>Stream</span><span class=o>.</span><span class=na>builder</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>FileToWordsBuilder</span><span class=o>(</span><span class=n>String</span> <span class=n>filePath</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Files</span><span class=o>.</span><span class=na>lines</span><span class=o>(</span><span class=n>Paths</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>filePath</span><span class=o>))</span>
</span></span><span class=line><span class=cl>             <span class=o>.</span><span class=na>skip</span><span class=o>(</span><span class=mi>1</span><span class=o>)</span> <span class=c1>// 略过开头的注释行
</span></span></span><span class=line><span class=cl><span class=c1></span>             <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>line</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                  <span class=k>for</span> <span class=o>(</span><span class=n>String</span> <span class=n>w</span> <span class=o>:</span> <span class=n>line</span><span class=o>.</span><span class=na>split</span><span class=o>(</span><span class=s>&#34;[ .?,]+&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                      <span class=n>builder</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>w</span><span class=o>);</span>
</span></span><span class=line><span class=cl>              <span class=o>});</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>stream</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>builder</span><span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>FileToWordsBuilder</span><span class=o>(</span><span class=s>&#34;Cheese.dat&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>7</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>w</span> <span class=o>-&gt;</span> <span class=n>w</span> <span class=o>+</span> <span class=s>&#34; &#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>print</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>Not much of a cheese shop really
</code></pre><p><strong>注意</strong>，构造器会添加文件中的所有单词（除了第一行，它是包含文件路径信息的注释），但是其并没有调用 <code>build()</code>。只要你不调用 <code>stream()</code> 方法，就可以继续向 <code>builder</code> 对象中添加单词。</p><p>在该类的更完整形式中，你可以添加一个标志位用于查看 <code>build()</code> 是否被调用，并且可能的话增加一个可以添加更多单词的方法。在 <code>Stream.Builder</code> 调用 <code>build()</code> 方法后继续尝试添加单词会产生一个异常。</p><h3 id=arrays>Arrays</h3><p><code>Arrays</code> 类中含有一个名为 <code>stream()</code> 的静态方法用于把数组转换成为流。我们可以重写 <code>interfaces/Machine.java</code> 中的主方法用于创建一个流，并将 <code>execute()</code> 应用于每一个元素。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/Machine2.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>onjava.Operations</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Machine2</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Arrays</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=k>new</span> <span class=n>Operations</span><span class=o>[]</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=o>()</span> <span class=o>-&gt;</span> <span class=n>Operations</span><span class=o>.</span><span class=na>show</span><span class=o>(</span><span class=s>&#34;Bing&#34;</span><span class=o>),</span>
</span></span><span class=line><span class=cl>            <span class=o>()</span> <span class=o>-&gt;</span> <span class=n>Operations</span><span class=o>.</span><span class=na>show</span><span class=o>(</span><span class=s>&#34;Crack&#34;</span><span class=o>),</span>
</span></span><span class=line><span class=cl>            <span class=o>()</span> <span class=o>-&gt;</span> <span class=n>Operations</span><span class=o>.</span><span class=na>show</span><span class=o>(</span><span class=s>&#34;Twist&#34;</span><span class=o>),</span>
</span></span><span class=line><span class=cl>            <span class=o>()</span> <span class=o>-&gt;</span> <span class=n>Operations</span><span class=o>.</span><span class=na>show</span><span class=o>(</span><span class=s>&#34;Pop&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>}).</span><span class=na>forEach</span><span class=o>(</span><span class=n>Operations</span><span class=o>::</span><span class=n>execute</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>Bing
Crack
Twist
Pop
</code></pre><p><code>new Operations[]</code> 表达式动态创建了 <code>Operations</code> 对象的数组。</p><p><code>stream()</code> 同样可以产生 <strong>IntStream</strong>，<strong>LongStream</strong> 和 <strong>DoubleStream</strong>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/ArrayStreams.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ArrayStreams</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Arrays</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=k>new</span> <span class=kt>double</span><span class=o>[]</span> <span class=o>{</span> <span class=mf>3.14159</span><span class=o>,</span> <span class=mf>2.718</span><span class=o>,</span> <span class=mf>1.618</span> <span class=o>})</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%f &#34;</span><span class=o>,</span> <span class=n>n</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Arrays</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=k>new</span> <span class=kt>int</span><span class=o>[]</span> <span class=o>{</span> <span class=mi>1</span><span class=o>,</span> <span class=mi>3</span><span class=o>,</span> <span class=mi>5</span> <span class=o>})</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%d &#34;</span><span class=o>,</span> <span class=n>n</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Arrays</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=k>new</span> <span class=kt>long</span><span class=o>[]</span> <span class=o>{</span> <span class=mi>11</span><span class=o>,</span> <span class=mi>22</span><span class=o>,</span> <span class=mi>44</span><span class=o>,</span> <span class=mi>66</span> <span class=o>})</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%d &#34;</span><span class=o>,</span> <span class=n>n</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 选择一个子域:
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Arrays</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=k>new</span> <span class=kt>int</span><span class=o>[]</span> <span class=o>{</span> <span class=mi>1</span><span class=o>,</span> <span class=mi>3</span><span class=o>,</span> <span class=mi>5</span><span class=o>,</span> <span class=mi>7</span><span class=o>,</span> <span class=mi>15</span><span class=o>,</span> <span class=mi>28</span><span class=o>,</span> <span class=mi>37</span> <span class=o>},</span> <span class=mi>3</span><span class=o>,</span> <span class=mi>6</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%d &#34;</span><span class=o>,</span> <span class=n>n</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>3.141590 2.718000 1.618000
1 3 5
11 22 44 66
7 15 28
</code></pre><p>最后一次 <code>stream()</code> 的调用有两个额外的参数。第一个参数告诉 <code>stream()</code> 从数组的哪个位置开始选择元素，第二个参数用于告知在哪里停止。每种不同类型的 <code>stream()</code> 都有类似的操作。</p><h3 id=正则表达式>正则表达式</h3><p>Java 的正则表达式将在<a href=18-Strings.md>字符串</a>这一章节详细介绍。Java 8 在 <code>java.util.regex.Pattern</code> 中增加了一个新的方法 <code>splitAsStream()</code>。这个方法可以根据传入的公式将字符序列转化为流。但是有一个限制，输入只能是 <strong>CharSequence</strong>，因此不能将流作为 <code>splitAsStream()</code> 的参数。</p><p>我们再一次查看将文件转换为单词的过程。这一次，我们使用流将文件转换为一个字符串，接着使用正则表达式将字符串转化为单词流。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/FileToWordsRegexp.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.io.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.nio.file.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.regex.Pattern</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>FileToWordsRegexp</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>all</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>FileToWordsRegexp</span><span class=o>(</span><span class=n>String</span> <span class=n>filePath</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>all</span> <span class=o>=</span> <span class=n>Files</span><span class=o>.</span><span class=na>lines</span><span class=o>(</span><span class=n>Paths</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>filePath</span><span class=o>))</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>skip</span><span class=o>(</span><span class=mi>1</span><span class=o>)</span> <span class=c1>// First (comment) line
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>Collectors</span><span class=o>.</span><span class=na>joining</span><span class=o>(</span><span class=s>&#34; &#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>stream</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Pattern</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>compile</span><span class=o>(</span><span class=s>&#34;[ .,?]+&#34;</span><span class=o>).</span><span class=na>splitAsStream</span><span class=o>(</span><span class=n>all</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span>
</span></span><span class=line><span class=cl>    <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>FileToWordsRegexp</span> <span class=n>fw</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileToWordsRegexp</span><span class=o>(</span><span class=s>&#34;Cheese.dat&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>fw</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>7</span><span class=o>)</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>w</span> <span class=o>-&gt;</span> <span class=n>w</span> <span class=o>+</span> <span class=s>&#34; &#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>print</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>fw</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>skip</span><span class=o>(</span><span class=mi>7</span><span class=o>)</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>2</span><span class=o>)</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>w</span> <span class=o>-&gt;</span> <span class=n>w</span> <span class=o>+</span> <span class=s>&#34; &#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>print</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>Not much of a cheese shop really is it
</code></pre><p>在构造器中我们读取了文件中的所有内容（跳过第一行注释，并将其转化成为单行字符串）。现在，当你调用 <code>stream()</code> 的时候，可以像往常一样获取一个流，但这回你可以多次调用 <code>stream()</code> ，每次从已存储的字符串中创建一个新的流。这里有个限制，整个文件必须存储在内存中；在大多数情况下这并不是什么问题，但是这丢掉了流操作非常重要的优势：</p><ol><li>“不需要把流存储起来。”当然，流确实需要一些内部存储，但存储的只是序列的一小部分，和存储整个序列不同。</li><li>它们是懒加载计算的。</li></ol><p>幸运的是，我们稍后就会知道如何解决这个问题。</p><h2 id=中间操作>中间操作</h2><p>中间操作用于从一个流中获取对象，并将对象作为另一个流从后端输出，以连接到其他操作。</p><h3 id=跟踪和调试>跟踪和调试</h3><p><code>peek()</code> 操作的目的是帮助调试。它允许你无修改地查看流中的元素。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/Peeking.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>class</span> <span class=nc>Peeking</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>FileToWords</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=s>&#34;Cheese.dat&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>skip</span><span class=o>(</span><span class=mi>21</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>4</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>w</span> <span class=o>-&gt;</span> <span class=n>w</span> <span class=o>+</span> <span class=s>&#34; &#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>peek</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>print</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>String</span><span class=o>::</span><span class=n>toUpperCase</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>peek</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>print</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>String</span><span class=o>::</span><span class=n>toLowerCase</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>print</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>Well WELL well it IT it s S s so SO so
</code></pre><p><code>FileToWords</code> 稍后定义，但它的功能实现貌似和之前我们看到的差不多：产生字符串对象的流。之后在其通过管道时调用 <code>peek()</code> 进行处理。</p><p>因为 <code>peek()</code> 符合无返回值的 <strong>Consumer</strong> 函数式接口，所以我们只能观察，无法使用不同的元素来替换流中的对象。</p><h3 id=流元素排序>流元素排序</h3><p>在 <code>Randoms.java</code> 中，我们熟识了 <code>sorted()</code> 的默认比较器实现。其实它还有另一种形式的实现：传入一个 <strong>Comparator</strong> 参数。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/SortedComparator.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SortedComparator</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>FileToWords</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=s>&#34;Cheese.dat&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>skip</span><span class=o>(</span><span class=mi>10</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>10</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>sorted</span><span class=o>(</span><span class=n>Comparator</span><span class=o>.</span><span class=na>reverseOrder</span><span class=o>())</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>w</span> <span class=o>-&gt;</span> <span class=n>w</span> <span class=o>+</span> <span class=s>&#34; &#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>print</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>you what to the that sir leads in district And
</code></pre><p><code>sorted()</code> 预设了一些默认的比较器。这里我们使用的是反转“自然排序”。当然你也可以把 Lambda 函数作为参数传递给 <code>sorted()</code>。</p><h3 id=移除元素>移除元素</h3><ul><li><p><code>distinct()</code>：在 <code>Randoms.java</code> 类中的 <code>distinct()</code> 可用于消除流中的重复元素。相比创建一个 <strong>Set</strong> 集合来消除重复，该方法的工作量要少得多。</p></li><li><p><code>filter(Predicate)</code>：过滤操作，保留如下元素：若元素传递给过滤函数产生的结果为<code>true</code> 。</p></li></ul><p>在下例中，<code>isPrime()</code> 作为过滤函数，用于检测质数。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/Prime.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import static</span> <span class=nn>java.util.stream.LongStream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Prime</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Boolean</span> <span class=nf>isPrime</span><span class=o>(</span><span class=kt>long</span> <span class=n>n</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>rangeClosed</span><span class=o>(</span><span class=mi>2</span><span class=o>,</span> <span class=o>(</span><span class=kt>long</span><span class=o>)</span><span class=n>Math</span><span class=o>.</span><span class=na>sqrt</span><span class=o>(</span><span class=n>n</span><span class=o>))</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>noneMatch</span><span class=o>(</span><span class=n>i</span> <span class=o>-&gt;</span> <span class=n>n</span> <span class=o>%</span> <span class=n>i</span> <span class=o>==</span> <span class=mi>0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>LongStream</span> <span class=nf>numbers</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>iterate</span><span class=o>(</span><span class=mi>2</span><span class=o>,</span> <span class=n>i</span> <span class=o>-&gt;</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>filter</span><span class=o>(</span><span class=n>Prime</span><span class=o>::</span><span class=n>isPrime</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>Prime</span><span class=o>().</span><span class=na>numbers</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>10</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%d &#34;</span><span class=o>,</span> <span class=n>n</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>Prime</span><span class=o>().</span><span class=na>numbers</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>skip</span><span class=o>(</span><span class=mi>90</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>10</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%d &#34;</span><span class=o>,</span> <span class=n>n</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>2 3 5 7 11 13 17 19 23 29
467 479 487 491 499 503 509 521 523 541
</code></pre><p><code>rangeClosed()</code> 包含了上限值。如果不能整除，即余数不等于 0，则 <code>noneMatch()</code> 操作返回 <code>true</code>，如果出现任何等于 0 的结果则返回 <code>false</code>。 <code>noneMatch()</code> 操作一旦有失败就会退出。</p><h3 id=应用函数到元素>应用函数到元素</h3><ul><li><p><code>map(Function)</code>：将函数操作应用在输入流的元素中，并将返回值传递到输出流中。</p></li><li><p><code>mapToInt(ToIntFunction)</code>：操作同上，但结果是 <strong>IntStream</strong>。</p></li><li><p><code>mapToLong(ToLongFunction)</code>：操作同上，但结果是 <strong>LongStream</strong>。</p></li><li><p><code>mapToDouble(ToDoubleFunction)</code>：操作同上，但结果是 <strong>DoubleStream</strong>。</p></li></ul><p>在这里，我们使用 <code>map()</code> 映射多种函数到一个字符串流中。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/FunctionMap.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>FunctionMap</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=n>String</span><span class=o>[]</span> <span class=n>elements</span> <span class=o>=</span> <span class=o>{</span> <span class=s>&#34;12&#34;</span><span class=o>,</span> <span class=s>&#34;&#34;</span><span class=o>,</span> <span class=s>&#34;23&#34;</span><span class=o>,</span> <span class=s>&#34;45&#34;</span> <span class=o>};</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nf>testStream</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=n>elements</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>test</span><span class=o>(</span><span class=n>String</span> <span class=n>descr</span><span class=o>,</span> <span class=n>Function</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>func</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34; ---( &#34;</span> <span class=o>+</span> <span class=n>descr</span> <span class=o>+</span> <span class=s>&#34; )---&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>testStream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>func</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;add brackets&#34;</span><span class=o>,</span> <span class=n>s</span> <span class=o>-&gt;</span> <span class=s>&#34;[&#34;</span> <span class=o>+</span> <span class=n>s</span> <span class=o>+</span> <span class=s>&#34;]&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;Increment&#34;</span><span class=o>,</span> <span class=n>s</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>Integer</span><span class=o>.</span><span class=na>parseInt</span><span class=o>(</span><span class=n>s</span><span class=o>)</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>+</span> <span class=s>&#34;&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=k>catch</span><span class=o>(</span><span class=n>NumberFormatException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>s</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;Replace&#34;</span><span class=o>,</span> <span class=n>s</span> <span class=o>-&gt;</span> <span class=n>s</span><span class=o>.</span><span class=na>replace</span><span class=o>(</span><span class=s>&#34;2&#34;</span><span class=o>,</span> <span class=s>&#34;9&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;Take last digit&#34;</span><span class=o>,</span> <span class=n>s</span> <span class=o>-&gt;</span> <span class=n>s</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>?</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=n>s</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>-</span> <span class=mi>1</span><span class=o>)</span> <span class=o>+</span> <span class=s>&#34;&#34;</span> <span class=o>:</span> <span class=n>s</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code> ---( add brackets )---
[12]
[]
[23]
[45]
 ---( Increment )---
13

24
46
 ---( Replace )---
19

93
45
 ---( Take last digit )---
2

3
5
</code></pre><p>在上面的自增示例中，我们用 <code>Integer.parseInt()</code> 尝试将一个字符串转化为整数。如果字符串不能被转化成为整数就会抛出 <code>NumberFormatException</code> 异常，此时我们就回过头来把原始字符串放到输出流中。</p><p>在以上例子中，<code>map()</code> 将一个字符串映射为另一个字符串，但是我们完全可以产生和接收类型完全不同的类型，从而改变流的数据类型。下面代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/FunctionMap2.java
</span></span></span><span class=line><span class=cl><span class=c1>// Different input and output types （不同的输入输出类型）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Numbered</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>final</span> <span class=kt>int</span> <span class=n>n</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Numbered</span><span class=o>(</span><span class=kt>int</span> <span class=n>n</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>n</span> <span class=o>=</span> <span class=n>n</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;Numbered(&#34;</span> <span class=o>+</span> <span class=n>n</span> <span class=o>+</span> <span class=s>&#34;)&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>FunctionMap2</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Stream</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=mi>1</span><span class=o>,</span> <span class=mi>5</span><span class=o>,</span> <span class=mi>7</span><span class=o>,</span> <span class=mi>9</span><span class=o>,</span> <span class=mi>11</span><span class=o>,</span> <span class=mi>13</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>Numbered</span><span class=o>::</span><span class=k>new</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>Numbered(1)
Numbered(5)
Numbered(7)
Numbered(9)
Numbered(11)
Numbered(13)
</code></pre><p>我们将获取到的整数通过构造器 <code>Numbered::new</code> 转化成为 <code>Numbered</code> 类型。</p><p>如果使用 <strong>Function</strong> 返回的结果是数值类型的一种，我们必须使用合适的 <code>mapTo数值类型</code> 进行替代。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/FunctionMap3.java
</span></span></span><span class=line><span class=cl><span class=c1>// Producing numeric output streams（ 产生数值输出流）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>FunctionMap3</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Stream</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=s>&#34;5&#34;</span><span class=o>,</span> <span class=s>&#34;7&#34;</span><span class=o>,</span> <span class=s>&#34;9&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>mapToInt</span><span class=o>(</span><span class=n>Integer</span><span class=o>::</span><span class=n>parseInt</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%d &#34;</span><span class=o>,</span> <span class=n>n</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Stream</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=s>&#34;17&#34;</span><span class=o>,</span> <span class=s>&#34;19&#34;</span><span class=o>,</span> <span class=s>&#34;23&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>mapToLong</span><span class=o>(</span><span class=n>Long</span><span class=o>::</span><span class=n>parseLong</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%d &#34;</span><span class=o>,</span> <span class=n>n</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Stream</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=s>&#34;17&#34;</span><span class=o>,</span> <span class=s>&#34;1.9&#34;</span><span class=o>,</span> <span class=s>&#34;.23&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>mapToDouble</span><span class=o>(</span><span class=n>Double</span><span class=o>::</span><span class=n>parseDouble</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%f &#34;</span><span class=o>,</span> <span class=n>n</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>5 7 9
17 19 23
17.000000 1.900000 0.230000
</code></pre><p>遗憾的是，Java 设计者并没有尽最大努力去消除基本类型。</p><h3 id=在-map-中组合流>在 <code>map()</code> 中组合流</h3><p>假设我们现在有了一个传入的元素流，并且打算对流元素使用 <code>map()</code> 函数。现在你已经找到了一些可爱并独一无二的函数功能，但是问题来了：这个函数功能是产生一个流。我们想要产生一个元素流，而实际却产生了一个元素流的流。</p><p><code>flatMap()</code> 做了两件事：将产生流的函数应用在每个元素上（与 <code>map()</code> 所做的相同），然后将每个流都扁平化为元素，因而最终产生的仅仅是元素。</p><p><code>flatMap(Function)</code>：当 <code>Function</code> 产生流时使用。</p><p><code>flatMapToInt(Function)</code>：当 <code>Function</code> 产生 <code>IntStream</code> 时使用。</p><p><code>flatMapToLong(Function)</code>：当 <code>Function</code> 产生 <code>LongStream</code> 时使用。</p><p><code>flatMapToDouble(Function)</code>：当 <code>Function</code> 产生 <code>DoubleStream</code> 时使用。</p><p>为了弄清它的工作原理，我们从传入一个刻意设计的函数给 <code>map()</code> 开始。该函数接受一个整数并产生一个字符串流：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/StreamOfStreams.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>StreamOfStreams</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Stream</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=mi>1</span><span class=o>,</span> <span class=mi>2</span><span class=o>,</span> <span class=mi>3</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>i</span> <span class=o>-&gt;</span> <span class=n>Stream</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=s>&#34;Gonzo&#34;</span><span class=o>,</span> <span class=s>&#34;Kermit&#34;</span><span class=o>,</span> <span class=s>&#34;Beaker&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>e</span><span class=o>-&gt;</span> <span class=n>e</span><span class=o>.</span><span class=na>getClass</span><span class=o>().</span><span class=na>getName</span><span class=o>())</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>java.util.stream.ReferencePipeline$Head
java.util.stream.ReferencePipeline$Head
java.util.stream.ReferencePipeline$Head
</code></pre><p>我们天真地希望能够得到字符串流，但实际得到的却是“Head”流的流。我们可以使用 <code>flatMap()</code> 解决这个问题：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/FlatMap.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>FlatMap</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Stream</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=mi>1</span><span class=o>,</span> <span class=mi>2</span><span class=o>,</span> <span class=mi>3</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>flatMap</span><span class=o>(</span><span class=n>i</span> <span class=o>-&gt;</span> <span class=n>Stream</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=s>&#34;Gonzo&#34;</span><span class=o>,</span> <span class=s>&#34;Fozzie&#34;</span><span class=o>,</span> <span class=s>&#34;Beaker&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>Gonzo
Fozzie
Beaker
Gonzo
Fozzie
Beaker
Gonzo
Fozzie
Beaker
</code></pre><p>从映射返回的每个流都会自动扁平为组成它的字符串。</p><p>下面是另一个演示，我们从一个整数流开始，然后使用每一个整数去创建更多的随机数。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/StreamOfRandoms.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>StreamOfRandoms</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>(</span><span class=mi>47</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Stream</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=mi>1</span><span class=o>,</span> <span class=mi>2</span><span class=o>,</span> <span class=mi>3</span><span class=o>,</span> <span class=mi>4</span><span class=o>,</span> <span class=mi>5</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>flatMapToInt</span><span class=o>(</span><span class=n>i</span> <span class=o>-&gt;</span> <span class=n>IntStream</span><span class=o>.</span><span class=na>concat</span><span class=o>(</span>
</span></span><span class=line><span class=cl>        <span class=n>rand</span><span class=o>.</span><span class=na>ints</span><span class=o>(</span><span class=mi>0</span><span class=o>,</span> <span class=mi>100</span><span class=o>).</span><span class=na>limit</span><span class=o>(</span><span class=n>i</span><span class=o>),</span> <span class=n>IntStream</span><span class=o>.</span><span class=na>of</span><span class=o>(-</span><span class=mi>1</span><span class=o>)))</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%d &#34;</span><span class=o>,</span> <span class=n>n</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>58 -1 55 93 -1 61 61 29 -1 68 0 22 7 -1 88 28 51 89 9 -1
</code></pre><p>在这里我们引入了 <code>concat()</code>，它以参数顺序组合两个流。 如此，我们在每个随机 <code>Integer</code> 流的末尾添加一个 -1 作为标记。你可以看到最终流确实是从一组扁平流中创建的。</p><p>因为 <code>rand.ints()</code> 产生的是一个 <code>IntStream</code>，所以我必须使用 <code>flatMap()</code>、<code>concat()</code> 和 <code>of()</code> 的特定整数形式。</p><p>让我们再看一下将文件划分为单词流的任务。我们最后使用到的是 <strong>FileToWordsRegexp.java</strong>，它的问题是需要将整个文件读入行列表中 —— 显然需要存储该列表。而我们真正想要的是创建一个不需要中间存储层的单词流。</p><p>下面，我们再使用 <code>flatMap()</code> 来解决这个问题：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/FileToWords.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.nio.file.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.regex.Pattern</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>FileToWords</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>stream</span><span class=o>(</span><span class=n>String</span> <span class=n>filePath</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Files</span><span class=o>.</span><span class=na>lines</span><span class=o>(</span><span class=n>Paths</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>filePath</span><span class=o>))</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>skip</span><span class=o>(</span><span class=mi>1</span><span class=o>)</span> <span class=c1>// First (comment) line
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>.</span><span class=na>flatMap</span><span class=o>(</span><span class=n>line</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>        <span class=n>Pattern</span><span class=o>.</span><span class=na>compile</span><span class=o>(</span><span class=s>&#34;\\W+&#34;</span><span class=o>).</span><span class=na>splitAsStream</span><span class=o>(</span><span class=n>line</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><code>stream()</code> 现在是一个静态方法，因为它可以自己完成整个流创建过程。</p><p>注意：<code>\\W+</code> 是一个正则表达式。表示“非单词字符”，<code>+</code> 表示“可以出现一次或者多次”。小写形式的 <code>\\w</code> 表示“单词字符”。</p><p>我们之前遇到的问题是 <code>Pattern.compile().splitAsStream()</code> 产生的结果为流，这意味着当我们只是想要一个简单的单词流时，在传入的行流（stream of lines）上调用 <code>map()</code> 会产生一个单词流的流。幸运的是，<code>flatMap()</code> 可以将元素流的流扁平化为一个简单的元素流。或者，我们可以使用 <code>String.split()</code> 生成一个数组，其可以被 <code>Arrays.stream()</code> 转化成为流：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>.</span><span class=na>flatMap</span><span class=o>(</span><span class=n>line</span> <span class=o>-&gt;</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=n>line</span><span class=o>.</span><span class=na>split</span><span class=o>(</span><span class=s>&#34;\\W+&#34;</span><span class=o>))))</span>
</span></span></code></pre></div><p>因为有了真正的流（而不是<code>FileToWordsRegexp.java</code> 中基于集合存储的流），所以每次需要一个新的流时，我们都必须从头开始创建，因为流不能被复用：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/FileToWordsTest.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>FileToWordsTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>FileToWords</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=s>&#34;Cheese.dat&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>7</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>s</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%s &#34;</span><span class=o>,</span> <span class=n>s</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>FileToWords</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=s>&#34;Cheese.dat&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>skip</span><span class=o>(</span><span class=mi>7</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>2</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>s</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%s &#34;</span><span class=o>,</span> <span class=n>s</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>Not much of a cheese shop really
is it
</code></pre><p>在 <code>System.out.format()</code> 中的 <code>%s</code> 表明参数为 <strong>String</strong> 类型。</p><h2 id=optional-类>Optional 类</h2><p>在我们学习终端操作（Terminal Operations）之前，我们必须考虑在一个空流中获取元素会发生什么。我们喜欢沿着“快乐路径”<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>把流连接起来，同时假设流不会中断。然而，在流中放置 <code>null</code> 却会轻易令其中断。那么是否存在某种对象，可以在持有流元素的同时，即使在我们查找的元素不存在时，也能友好地对我们进行提示（也就是说，不会产生异常）？</p><p><strong>Optional</strong> 可以实现这样的功能。一些标准流操作返回 <strong>Optional</strong> 对象，因为它们并不能保证预期结果一定存在。包括：</p><ul><li><code>findFirst()</code> 返回一个包含第一个元素的 <strong>Optional</strong> 对象，如果流为空则返回 <strong>Optional.empty</strong></li><li><code>findAny()</code> 返回包含任意元素的 <strong>Optional</strong> 对象，如果流为空则返回 <strong>Optional.empty</strong></li><li><code>max()</code> 和 <code>min()</code> 返回一个包含最大值或者最小值的 <strong>Optional</strong> 对象，如果流为空则返回 <strong>Optional.empty</strong></li></ul><p><code>reduce()</code> 不再以 <code>identity</code> 形式开头，而是将其返回值包装在 <strong>Optional</strong> 中。（<code>identity</code> 对象成为其他形式的 <code>reduce()</code> 的默认结果，因此不存在空结果的风险）</p><p>对于数字流 <strong>IntStream</strong>、<strong>LongStream</strong> 和 <strong>DoubleStream</strong>，<code>average()</code> 会将结果包装在 <strong>Optional</strong> 以防止流为空。</p><p>以下是对空流进行所有这些操作的简单测试：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/OptionalsFromEmptyStreams.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>OptionalsFromEmptyStreams</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>Stream</span><span class=o>.&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=n>empty</span><span class=o>()</span>
</span></span><span class=line><span class=cl>             <span class=o>.</span><span class=na>findFirst</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>Stream</span><span class=o>.&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=n>empty</span><span class=o>()</span>
</span></span><span class=line><span class=cl>             <span class=o>.</span><span class=na>findAny</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>Stream</span><span class=o>.&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=n>empty</span><span class=o>()</span>
</span></span><span class=line><span class=cl>             <span class=o>.</span><span class=na>max</span><span class=o>(</span><span class=n>String</span><span class=o>.</span><span class=na>CASE_INSENSITIVE_ORDER</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>Stream</span><span class=o>.&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=n>empty</span><span class=o>()</span>
</span></span><span class=line><span class=cl>             <span class=o>.</span><span class=na>min</span><span class=o>(</span><span class=n>String</span><span class=o>.</span><span class=na>CASE_INSENSITIVE_ORDER</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>Stream</span><span class=o>.&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=n>empty</span><span class=o>()</span>
</span></span><span class=line><span class=cl>             <span class=o>.</span><span class=na>reduce</span><span class=o>((</span><span class=n>s1</span><span class=o>,</span> <span class=n>s2</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=n>s1</span> <span class=o>+</span> <span class=n>s2</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>IntStream</span><span class=o>.</span><span class=na>empty</span><span class=o>()</span>
</span></span><span class=line><span class=cl>             <span class=o>.</span><span class=na>average</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>Optional.empty
Optional.empty
Optional.empty
Optional.empty
Optional.empty
OptionalDouble.empty
</code></pre><p>当流为空的时候你会获得一个 <strong>Optional.empty</strong> 对象，而不是抛出异常。<strong>Optional</strong> 拥有 <code>toString()</code> 方法可以用于展示有用信息。</p><p>注意，空流是通过 <code>Stream.&lt;String>empty()</code> 创建的。如果你在没有任何上下文环境的情况下调用 <code>Stream.empty()</code>，Java 并不知道它的数据类型；这个语法解决了这个问题。如果编译器拥有了足够的上下文信息，比如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>s</span> <span class=o>=</span> <span class=n>Stream</span><span class=o>.</span><span class=na>empty</span><span class=o>();</span>
</span></span></code></pre></div><p>就可以在调用 <code>empty()</code> 时推断类型。</p><p>这个示例展示了 <strong>Optional</strong> 的两个基本用法：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/OptionalBasics.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>OptionalBasics</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>test</span><span class=o>(</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>optString</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=o>(</span><span class=n>optString</span><span class=o>.</span><span class=na>isPresent</span><span class=o>())</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>optString</span><span class=o>.</span><span class=na>get</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Nothing inside!&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=n>Stream</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=s>&#34;Epithets&#34;</span><span class=o>).</span><span class=na>findFirst</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=n>Stream</span><span class=o>.&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=n>empty</span><span class=o>().</span><span class=na>findFirst</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>Epithets
Nothing inside!
</code></pre><p>当你接收到 <strong>Optional</strong> 对象时，应首先调用 <code>isPresent()</code> 检查其中是否包含元素。如果存在，可使用 <code>get()</code> 获取。</p><h3 id=便利函数>便利函数</h3><p>有许多便利函数可以解包 <strong>Optional</strong> ，这简化了上述“对所包含的对象的检查和执行操作”的过程：</p><ul><li><code>ifPresent(Consumer)</code>：当值存在时调用 <strong>Consumer</strong>，否则什么也不做。</li><li><code>orElse(otherObject)</code>：如果值存在则直接返回，否则生成 <strong>otherObject</strong>。</li><li><code>orElseGet(Supplier)</code>：如果值存在则直接返回，否则使用 <strong>Supplier</strong> 函数生成一个可替代对象。</li><li><code>orElseThrow(Supplier)</code>：如果值存在直接返回，否则使用 <strong>Supplier</strong> 函数生成一个异常。</li></ul><p>如下是针对不同便利函数的简单演示：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/Optionals.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Optionals</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>basics</span><span class=o>(</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>optString</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=o>(</span><span class=n>optString</span><span class=o>.</span><span class=na>isPresent</span><span class=o>())</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>optString</span><span class=o>.</span><span class=na>get</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Nothing inside!&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>ifPresent</span><span class=o>(</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>optString</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>optString</span><span class=o>.</span><span class=na>ifPresent</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>orElse</span><span class=o>(</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>optString</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>optString</span><span class=o>.</span><span class=na>orElse</span><span class=o>(</span><span class=s>&#34;Nada&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>orElseGet</span><span class=o>(</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>optString</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span>
</span></span><span class=line><span class=cl>        <span class=n>optString</span><span class=o>.</span><span class=na>orElseGet</span><span class=o>(()</span> <span class=o>-&gt;</span> <span class=s>&#34;Generated&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>orElseThrow</span><span class=o>(</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>optString</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>optString</span><span class=o>.</span><span class=na>orElseThrow</span><span class=o>(</span>
</span></span><span class=line><span class=cl>            <span class=o>()</span> <span class=o>-&gt;</span> <span class=k>new</span> <span class=n>Exception</span><span class=o>(</span><span class=s>&#34;Supplied&#34;</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span><span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Caught &#34;</span> <span class=o>+</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>test</span><span class=o>(</span><span class=n>String</span> <span class=n>testName</span><span class=o>,</span> <span class=n>Consumer</span><span class=o>&lt;</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;&gt;</span> <span class=n>cos</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34; === &#34;</span> <span class=o>+</span> <span class=n>testName</span> <span class=o>+</span> <span class=s>&#34; === &#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>cos</span><span class=o>.</span><span class=na>accept</span><span class=o>(</span><span class=n>Stream</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=s>&#34;Epithets&#34;</span><span class=o>).</span><span class=na>findFirst</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>cos</span><span class=o>.</span><span class=na>accept</span><span class=o>(</span><span class=n>Stream</span><span class=o>.&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=n>empty</span><span class=o>().</span><span class=na>findFirst</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;basics&#34;</span><span class=o>,</span> <span class=n>Optionals</span><span class=o>::</span><span class=n>basics</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;ifPresent&#34;</span><span class=o>,</span> <span class=n>Optionals</span><span class=o>::</span><span class=n>ifPresent</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;orElse&#34;</span><span class=o>,</span> <span class=n>Optionals</span><span class=o>::</span><span class=n>orElse</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;orElseGet&#34;</span><span class=o>,</span> <span class=n>Optionals</span><span class=o>::</span><span class=n>orElseGet</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;orElseThrow&#34;</span><span class=o>,</span> <span class=n>Optionals</span><span class=o>::</span><span class=n>orElseThrow</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>=== basics ===
Epithets
Nothing inside!
=== ifPresent ===
Epithets
=== orElse ===
Epithets
Nada
=== orElseGet ===
Epithets
Generated
=== orElseThrow ===
Epithets
Caught java.lang.Exception: Supplied
</code></pre><p><code>test()</code> 通过传入所有方法都适用的 <strong>Consumer</strong> 来避免重复代码。</p><p><code>orElseThrow()</code> 通过 <strong>catch</strong> 关键字来捕获抛出的异常。更多细节，将在 <a href=./15-Exceptions.md>异常</a> 这一章节中学习。</p><h3 id=创建-optional>创建 Optional</h3><p>当我们在自己的代码中加入 <strong>Optional</strong> 时，可以使用下面 3 个静态方法：</p><ul><li><code>empty()</code>：生成一个空 <strong>Optional</strong>。</li><li><code>of(value)</code>：将一个非空值包装到 <strong>Optional</strong> 里。</li><li><code>ofNullable(value)</code>：针对一个可能为空的值，为空时自动生成 <strong>Optional.empty</strong>，否则将值包装在 <strong>Optional</strong> 中。</li></ul><p>下面来看看它是如何工作的。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/CreatingOptionals.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>CreatingOptionals</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>test</span><span class=o>(</span><span class=n>String</span> <span class=n>testName</span><span class=o>,</span> <span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>opt</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34; === &#34;</span> <span class=o>+</span> <span class=n>testName</span> <span class=o>+</span> <span class=s>&#34; === &#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>opt</span><span class=o>.</span><span class=na>orElse</span><span class=o>(</span><span class=s>&#34;Null&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;empty&#34;</span><span class=o>,</span> <span class=n>Optional</span><span class=o>.</span><span class=na>empty</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;of&#34;</span><span class=o>,</span> <span class=n>Optional</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=s>&#34;Howdy&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>test</span><span class=o>(</span><span class=s>&#34;of&#34;</span><span class=o>,</span> <span class=n>Optional</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=kc>null</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span><span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;ofNullable&#34;</span><span class=o>,</span> <span class=n>Optional</span><span class=o>.</span><span class=na>ofNullable</span><span class=o>(</span><span class=s>&#34;Hi&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;ofNullable&#34;</span><span class=o>,</span> <span class=n>Optional</span><span class=o>.</span><span class=na>ofNullable</span><span class=o>(</span><span class=kc>null</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>=== empty ===
Null
=== of ===
Howdy
java.lang.NullPointerException
=== ofNullable ===
Hi
=== ofNullable ===
Null
</code></pre><p>我们不能通过传递 <code>null</code> 到 <code>of()</code> 来创建 <code>Optional</code> 对象。最安全的方法是， 使用 <code>ofNullable()</code> 来优雅地处理 <code>null</code>。</p><h3 id=optional-对象操作>Optional 对象操作</h3><p>当我们的流管道生成了 <strong>Optional</strong> 对象，下面 3 个方法可使得 <strong>Optional</strong> 的后续能做更多的操作：</p><ul><li><p><code>filter(Predicate)</code>：对 <strong>Optional</strong> 中的内容应用<strong>Predicate</strong> 并将结果返回。如果 <strong>Optional</strong> 不满足 <strong>Predicate</strong> ，将 <strong>Optional</strong> 转化为空 <strong>Optional</strong> 。如果 <strong>Optional</strong> 已经为空，则直接返回空<strong>Optional</strong> 。</p></li><li><p><code>map(Function)</code>：如果 <strong>Optional</strong> 不为空，应用 <strong>Function</strong> 于 <strong>Optional</strong> 中的内容，并返回结果。否则直接返回 <strong>Optional.empty</strong>。</p></li><li><p><code>flatMap(Function)</code>：同 <code>map()</code>，但是提供的映射函数将结果包装在 <strong>Optional</strong> 对象中，因此 <code>flatMap()</code> 不会在最后进行任何包装。</p></li></ul><p>以上方法都不适用于数值型 <strong>Optional</strong>。一般来说，流的 <code>filter()</code> 会在 <strong>Predicate</strong> 返回 <code>false</code> 时移除流元素。而 <code>Optional.filter()</code> 在失败时不会删除 <strong>Optional</strong>，而是将其保留下来，并转化为空。下面请看代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/OptionalFilter.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>OptionalFilter</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=n>String</span><span class=o>[]</span> <span class=n>elements</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;Foo&#34;</span><span class=o>,</span> <span class=s>&#34;&#34;</span><span class=o>,</span> <span class=s>&#34;Bar&#34;</span><span class=o>,</span> <span class=s>&#34;Baz&#34;</span><span class=o>,</span> <span class=s>&#34;Bingo&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>};</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>testStream</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=n>elements</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>test</span><span class=o>(</span><span class=n>String</span> <span class=n>descr</span><span class=o>,</span> <span class=n>Predicate</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>pred</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34; ---( &#34;</span> <span class=o>+</span> <span class=n>descr</span> <span class=o>+</span> <span class=s>&#34; )---&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>elements</span><span class=o>.</span><span class=na>length</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>testStream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                            <span class=o>.</span><span class=na>skip</span><span class=o>(</span><span class=n>i</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                            <span class=o>.</span><span class=na>findFirst</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                            <span class=o>.</span><span class=na>filter</span><span class=o>(</span><span class=n>pred</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;true&#34;</span><span class=o>,</span> <span class=n>str</span> <span class=o>-&gt;</span> <span class=kc>true</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;false&#34;</span><span class=o>,</span> <span class=n>str</span> <span class=o>-&gt;</span> <span class=kc>false</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;str != \&#34;\&#34;&#34;</span><span class=o>,</span> <span class=n>str</span> <span class=o>-&gt;</span> <span class=n>str</span> <span class=o>!=</span> <span class=s>&#34;&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;str.length() == 3&#34;</span><span class=o>,</span> <span class=n>str</span> <span class=o>-&gt;</span> <span class=n>str</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>==</span> <span class=mi>3</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;startsWith(\&#34;B\&#34;)&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=n>str</span> <span class=o>-&gt;</span> <span class=n>str</span><span class=o>.</span><span class=na>startsWith</span><span class=o>(</span><span class=s>&#34;B&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>---( true )---
Optional[Foo]
Optional[]
Optional[Bar]
Optional[Baz]
Optional[Bingo]
Optional.empty
---( false )---
Optional.empty
Optional.empty
Optional.empty
Optional.empty
Optional.empty
Optional.empty
---( str != &#34;&#34; )---
Optional[Foo]
Optional.empty
Optional[Bar]
Optional[Baz]
Optional[Bingo]
Optional.empty
---( str.length() == 3 )---
Optional[Foo]
Optional.empty
Optional[Bar]
Optional[Baz]
Optional.empty
Optional.empty
---( startsWith(&#34;B&#34;) )---
Optional.empty
Optional.empty
Optional[Bar]
Optional[Baz]
Optional[Bingo]
Optional.empty
</code></pre><p>即使输出看起来像流，要特别注意 <code>test()</code> 中的 for 循环。每一次的 for 循环都重新启动流，然后跳过 for 循环索引指定的数量的元素，这就是流只剩后续元素的原因。然后调用<code>findFirst()</code> 获取剩余元素中的第一个元素，并包装在一个 <code>Optional</code>对象中。</p><p><strong>注意</strong>，不同于普通 for 循环，这里的索引值范围并不是 <code>i &lt; elements.length</code>， 而是 <code>i &lt;= elements.length</code>。所以最后一个元素实际上超出了流。方便的是，这将自动成为 <strong>Optional.empty</strong>，你可以在每一个测试的结尾中看到。</p><p>同 <code>map()</code> 一样 ， <code>Optional.map()</code> 执行一个函数。它仅在 <strong>Optional</strong> 不为空时才执行这个映射函数。并将 <strong>Optional</strong> 的内容提取出来，传递给映射函数。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/OptionalMap.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.Arrays</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.function.Function</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.Stream</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>OptionalMap</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=n>String</span><span class=o>[]</span> <span class=n>elements</span> <span class=o>=</span> <span class=o>{</span><span class=s>&#34;12&#34;</span><span class=o>,</span> <span class=s>&#34;&#34;</span><span class=o>,</span> <span class=s>&#34;23&#34;</span><span class=o>,</span> <span class=s>&#34;45&#34;</span><span class=o>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>testStream</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=n>elements</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>test</span><span class=o>(</span><span class=n>String</span> <span class=n>descr</span><span class=o>,</span> <span class=n>Function</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>func</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34; ---( &#34;</span> <span class=o>+</span> <span class=n>descr</span> <span class=o>+</span> <span class=s>&#34; )---&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>elements</span><span class=o>.</span><span class=na>length</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>testStream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                            <span class=o>.</span><span class=na>skip</span><span class=o>(</span><span class=n>i</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                            <span class=o>.</span><span class=na>findFirst</span><span class=o>()</span> <span class=c1>// Produces an Optional
</span></span></span><span class=line><span class=cl><span class=c1></span>                            <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>func</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// If Optional is not empty, map() first extracts
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// the contents which it then passes
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// to the function:
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;Add brackets&#34;</span><span class=o>,</span> <span class=n>s</span> <span class=o>-&gt;</span> <span class=s>&#34;[&#34;</span> <span class=o>+</span> <span class=n>s</span> <span class=o>+</span> <span class=s>&#34;]&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;Increment&#34;</span><span class=o>,</span> <span class=n>s</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>Integer</span><span class=o>.</span><span class=na>parseInt</span><span class=o>(</span><span class=n>s</span><span class=o>)</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>+</span> <span class=s>&#34;&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>NumberFormatException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>s</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>});</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;Replace&#34;</span><span class=o>,</span> <span class=n>s</span> <span class=o>-&gt;</span> <span class=n>s</span><span class=o>.</span><span class=na>replace</span><span class=o>(</span><span class=s>&#34;2&#34;</span><span class=o>,</span> <span class=s>&#34;9&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;Take last digit&#34;</span><span class=o>,</span> <span class=n>s</span> <span class=o>-&gt;</span> <span class=n>s</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>?</span>
</span></span><span class=line><span class=cl>                <span class=n>s</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=n>s</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>-</span> <span class=mi>1</span><span class=o>)</span> <span class=o>+</span> <span class=s>&#34;&#34;</span> <span class=o>:</span> <span class=n>s</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// After the function is finished, map() wraps the
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// result in an Optional before returning it:
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>---( Add brackets )---
Optional[[12]]
Optional[[]]
Optional[[23]]
Optional[[45]]
Optional.empty
---( Increment )---
Optional[13]
Optional[]
Optional[24]
Optional[46]
Optional.empty
---( Replace )---
Optional[19]
Optional[]
Optional[93]
Optional[45]
Optional.empty
---( Take last digit )---
Optional[2]
Optional[]
Optional[3]
Optional[5]
Optional.empty
</code></pre><p>映射函数的返回结果会自动包装成为 <strong>Optional</strong>。<strong>Optional.empty</strong> 会被直接跳过。</p><p><strong>Optional</strong> 的 <code>flatMap()</code> 应用于已生成 <strong>Optional</strong> 的映射函数，所以 <code>flatMap()</code> 不会像 <code>map()</code> 那样将结果封装在 <strong>Optional</strong> 中。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/OptionalFlatMap.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.Arrays</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.Optional</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.function.Function</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.Stream</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>OptionalFlatMap</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=n>String</span><span class=o>[]</span> <span class=n>elements</span> <span class=o>=</span> <span class=o>{</span><span class=s>&#34;12&#34;</span><span class=o>,</span> <span class=s>&#34;&#34;</span><span class=o>,</span> <span class=s>&#34;23&#34;</span><span class=o>,</span> <span class=s>&#34;45&#34;</span><span class=o>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>testStream</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=n>elements</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>test</span><span class=o>(</span><span class=n>String</span> <span class=n>descr</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                     <span class=n>Function</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;&gt;</span> <span class=n>func</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34; ---( &#34;</span> <span class=o>+</span> <span class=n>descr</span> <span class=o>+</span> <span class=s>&#34; )---&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>elements</span><span class=o>.</span><span class=na>length</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>testStream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                            <span class=o>.</span><span class=na>skip</span><span class=o>(</span><span class=n>i</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                            <span class=o>.</span><span class=na>findFirst</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                            <span class=o>.</span><span class=na>flatMap</span><span class=o>(</span><span class=n>func</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;Add brackets&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=n>s</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=s>&#34;[&#34;</span> <span class=o>+</span> <span class=n>s</span> <span class=o>+</span> <span class=s>&#34;]&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;Increment&#34;</span><span class=o>,</span> <span class=n>s</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>Optional</span><span class=o>.</span><span class=na>of</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                        <span class=n>Integer</span><span class=o>.</span><span class=na>parseInt</span><span class=o>(</span><span class=n>s</span><span class=o>)</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>+</span> <span class=s>&#34;&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>NumberFormatException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>Optional</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>s</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>});</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;Replace&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=n>s</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>s</span><span class=o>.</span><span class=na>replace</span><span class=o>(</span><span class=s>&#34;2&#34;</span><span class=o>,</span> <span class=s>&#34;9&#34;</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>        <span class=n>test</span><span class=o>(</span><span class=s>&#34;Take last digit&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=n>s</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>s</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>?</span>
</span></span><span class=line><span class=cl>                        <span class=n>s</span><span class=o>.</span><span class=na>charAt</span><span class=o>(</span><span class=n>s</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>-</span> <span class=mi>1</span><span class=o>)</span> <span class=o>+</span> <span class=s>&#34;&#34;</span>
</span></span><span class=line><span class=cl>                        <span class=o>:</span> <span class=n>s</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>---( Add brackets )---
Optional[[12]]
Optional[[]]
Optional[[23]]
Optional[[45]]
Optional.empty
 ---( Increment )---
Optional[13]
Optional[]
Optional[24]
Optional[46]
Optional.empty
 ---( Replace )---
Optional[19]
Optional[]
Optional[93]
Optional[45]
Optional.empty
 ---( Take last digit )---
Optional[2]
Optional[]
Optional[3]
Optional[5]
Optional.empty
</code></pre><p>同 <code>map()</code>，<code>flatMap()</code> 将提取非空 <strong>Optional</strong> 的内容并将其应用在映射函数。唯一的区别就是 <code>flatMap()</code> 不会把结果包装在 <strong>Optional</strong> 中，因为映射函数已经被包装过了。在如上示例中，我们已经在每一个映射函数中显式地完成了包装，但是很显然 <code>Optional.flatMap()</code> 是为那些自己已经生成 <strong>Optional</strong> 的函数而设计的。</p><h3 id=optional-流>Optional 流</h3><p>假设你的生成器可能产生 <code>null</code> 值，那么当用它来创建流时，你会自然地想到用 <strong>Optional</strong> 来包装元素。如下是它的样子，代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/Signal.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Signal</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>msg</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Signal</span><span class=o>(</span><span class=n>String</span> <span class=n>msg</span><span class=o>)</span> <span class=o>{</span> <span class=k>this</span><span class=o>.</span><span class=na>msg</span> <span class=o>=</span> <span class=n>msg</span><span class=o>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getMsg</span><span class=o>()</span> <span class=o>{</span> <span class=k>return</span> <span class=n>msg</span><span class=o>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;Signal(&#34;</span> <span class=o>+</span> <span class=n>msg</span> <span class=o>+</span> <span class=s>&#34;)&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>(</span><span class=mi>47</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Signal</span> <span class=nf>morse</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>switch</span><span class=o>(</span><span class=n>rand</span><span class=o>.</span><span class=na>nextInt</span><span class=o>(</span><span class=mi>4</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=mi>1</span><span class=o>:</span> <span class=k>return</span> <span class=k>new</span> <span class=n>Signal</span><span class=o>(</span><span class=s>&#34;dot&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>case</span> <span class=mi>2</span><span class=o>:</span> <span class=k>return</span> <span class=k>new</span> <span class=n>Signal</span><span class=o>(</span><span class=s>&#34;dash&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>default</span><span class=o>:</span> <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Stream</span><span class=o>&lt;</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Signal</span><span class=o>&gt;&gt;</span> <span class=nf>stream</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Stream</span><span class=o>.</span><span class=na>generate</span><span class=o>(</span><span class=n>Signal</span><span class=o>::</span><span class=n>morse</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>signal</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=o>.</span><span class=na>ofNullable</span><span class=o>(</span><span class=n>signal</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>当我们使用这个流的时候，必须要弄清楚如何解包 <strong>Optional</strong>。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/StreamOfOptionals.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>StreamOfOptionals</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Signal</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>10</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34; ---&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Signal</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>10</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>filter</span><span class=o>(</span><span class=n>Optional</span><span class=o>::</span><span class=n>isPresent</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>Optional</span><span class=o>::</span><span class=n>get</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Optional</span><span class=o>[</span><span class=n>Signal</span><span class=o>(</span><span class=n>dash</span><span class=o>)]</span>
</span></span><span class=line><span class=cl><span class=n>Optional</span><span class=o>[</span><span class=n>Signal</span><span class=o>(</span><span class=n>dot</span><span class=o>)]</span>
</span></span><span class=line><span class=cl><span class=n>Optional</span><span class=o>[</span><span class=n>Signal</span><span class=o>(</span><span class=n>dash</span><span class=o>)]</span>
</span></span><span class=line><span class=cl><span class=n>Optional</span><span class=o>.</span><span class=na>empty</span>
</span></span><span class=line><span class=cl><span class=n>Optional</span><span class=o>.</span><span class=na>empty</span>
</span></span><span class=line><span class=cl><span class=n>Optional</span><span class=o>[</span><span class=n>Signal</span><span class=o>(</span><span class=n>dash</span><span class=o>)]</span>
</span></span><span class=line><span class=cl><span class=n>Optional</span><span class=o>.</span><span class=na>empty</span>
</span></span><span class=line><span class=cl><span class=n>Optional</span><span class=o>[</span><span class=n>Signal</span><span class=o>(</span><span class=n>dot</span><span class=o>)]</span>
</span></span><span class=line><span class=cl><span class=n>Optional</span><span class=o>[</span><span class=n>Signal</span><span class=o>(</span><span class=n>dash</span><span class=o>)]</span>
</span></span><span class=line><span class=cl><span class=n>Optional</span><span class=o>[</span><span class=n>Signal</span><span class=o>(</span><span class=n>dash</span><span class=o>)]</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=n>Signal</span><span class=o>(</span><span class=n>dot</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=n>Signal</span><span class=o>(</span><span class=n>dot</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=n>Signal</span><span class=o>(</span><span class=n>dash</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=n>Signal</span><span class=o>(</span><span class=n>dash</span><span class=o>)</span>
</span></span></code></pre></div><p>在这里，我们使用 <code>filter()</code> 来保留那些非空 <strong>Optional</strong>，然后在 <code>map()</code> 中使用 <code>get()</code> 获取元素。由于每种情况都需要定义“空值”的含义，所以通常我们要为每个应用程序采用不同的方法。</p><h2 id=终端操作>终端操作</h2><p>以下操作将会获取流的最终结果。至此我们无法再继续往后传递流。可以说，终端操作（Terminal Operations）总是我们在流管道中所做的最后一件事。</p><h3 id=数组>数组</h3><ul><li><code>toArray()</code>：将流转换成适当类型的数组。</li><li><code>toArray(generator)</code>：在特殊情况下，生成自定义类型的数组。</li></ul><p>当我们需要得到数组类型的数据以便于后续操作时，上面的方法就很有用。假设我们需要复用流产生的随机数时，就可以这么使用。代码示例:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/RandInts.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nn>streams</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>RandInts</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>int</span><span class=o>[]</span> <span class=n>rints</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>(</span><span class=mi>47</span><span class=o>).</span><span class=na>ints</span><span class=o>(</span><span class=mi>0</span><span class=o>,</span> <span class=mi>1000</span><span class=o>).</span><span class=na>limit</span><span class=o>(</span><span class=mi>100</span><span class=o>).</span><span class=na>toArray</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IntStream</span> <span class=nf>rands</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=n>rints</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>上例将 100 个数值范围在 0 到 1000 之间的随机数流转换成为数组并将其存储在 <code>rints</code> 中。这样一来，每次调用 <code>rands()</code> 的时候可以重复获取相同的整数流。</p><h3 id=循环>循环</h3><ul><li><code>forEach(Consumer)</code>常见如 <code>System.out::println</code> 作为 <strong>Consumer</strong> 函数。</li><li><code>forEachOrdered(Consumer)</code>： 保证 <code>forEach</code> 按照原始流顺序操作。</li></ul><p>第一种形式：无序操作，仅在引入并行流时才有意义。在 <a href=24-Concurrent-Programming.md>并发编程</a> 章节之前我们不会深入研究这个问题。这里简单介绍下 <code>parallel()</code>：可实现多处理器并行操作。实现原理为将流分割为多个（通常数目为 CPU 核心数）并在不同处理器上分别执行操作。因为我们采用的是内部迭代，而不是外部迭代，所以这是可能实现的。</p><p><code>parallel()</code> 看似简单，实则棘手。更多内容将在稍后的 <a href=24-Concurrent-Programming.md>并发编程</a> 章节中学习。</p><p>下例引入 <code>parallel()</code> 来帮助理解 <code>forEachOrdered(Consumer)</code> 的作用和使用场景。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/ForEach.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import static</span> <span class=nn>streams.RandInts.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ForEach</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>SZ</span> <span class=o>=</span> <span class=mi>14</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>rands</span><span class=o>().</span><span class=na>limit</span><span class=o>(</span><span class=n>SZ</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%d &#34;</span><span class=o>,</span> <span class=n>n</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>rands</span><span class=o>().</span><span class=na>limit</span><span class=o>(</span><span class=n>SZ</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>parallel</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%d &#34;</span><span class=o>,</span> <span class=n>n</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>rands</span><span class=o>().</span><span class=na>limit</span><span class=o>(</span><span class=n>SZ</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>parallel</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>forEachOrdered</span><span class=o>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%d &#34;</span><span class=o>,</span> <span class=n>n</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>258 555 693 861 961 429 868 200 522 207 288 128 551 589
551 861 429 589 200 522 555 693 258 128 868 288 961 207
258 555 693 861 961 429 868 200 522 207 288 128 551 589
</code></pre><p>为了方便测试不同大小的流，我们抽离出了 <code>SZ</code> 变量。然而即使 <code>SZ</code> 值为 14 也产生了有趣的结果。在第一个流中，未使用 <code>parallel()</code> ，因此以元素从 <code>rands()</code>出来的顺序输出结果。在第二个流中，引入<code>parallel()</code> ，即便流很小，输出的结果的顺序也和前面不一样。这是由于多处理器并行操作的原因，如果你将程序多运行几次，你会发现输出都不相同，这是多处理器并行操作的不确定性造成的结果。</p><p>在最后一个流中，同时使用了 <code>parallel()</code> 和 <code>forEachOrdered()</code> 来强制保持原始流顺序。因此，对非并行流使用 <code>forEachOrdered()</code> 是没有任何影响的。</p><h3 id=集合>集合</h3><ul><li><code>collect(Collector)</code>：使用 <strong>Collector</strong> 收集流元素到结果集合中。</li><li><code>collect(Supplier, BiConsumer, BiConsumer)</code>：同上，第一个参数 <strong>Supplier</strong> 创建了一个新的结果集合，第二个参数 <strong>BiConsumer</strong> 将下一个元素收集到结果集合中，第三个参数 <strong>BiConsumer</strong> 用于将两个结果集合合并起来。</li></ul><p>在这里我们只是简单介绍了几个 <strong>Collectors</strong> 的运用示例。实际上，它还有一些非常复杂的操作实现，可通过查看 <code>java.util.stream.Collectors</code> 的 API 文档了解。例如，我们可以将元素收集到任意一种特定的集合中。</p><p>假设我们现在为了保证元素有序，将元素存储在 <strong>TreeSet</strong> 中。<strong>Collectors</strong> 里面没有特定的 <code>toTreeSet()</code>，但是我们可以通过将集合的构造函数引用传递给 <code>Collectors.toCollection()</code>，从而构建任何类型的集合。下面我们来将一个文件中的单词收集到 <strong>TreeSet</strong> 集合中。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/TreeSetOfWords.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.nio.file.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>TreeSetOfWords</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span>
</span></span><span class=line><span class=cl>    <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>words2</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>                <span class=n>Files</span><span class=o>.</span><span class=na>lines</span><span class=o>(</span><span class=n>Paths</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=s>&#34;TreeSetOfWords.java&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                        <span class=o>.</span><span class=na>flatMap</span><span class=o>(</span><span class=n>s</span> <span class=o>-&gt;</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=n>s</span><span class=o>.</span><span class=na>split</span><span class=o>(</span><span class=s>&#34;\\W+&#34;</span><span class=o>)))</span>
</span></span><span class=line><span class=cl>                        <span class=o>.</span><span class=na>filter</span><span class=o>(</span><span class=n>s</span> <span class=o>-&gt;</span> <span class=o>!</span><span class=n>s</span><span class=o>.</span><span class=na>matches</span><span class=o>(</span><span class=s>&#34;\\d+&#34;</span><span class=o>))</span> <span class=c1>// No numbers
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=o>.</span><span class=na>map</span><span class=o>(</span><span class=n>String</span><span class=o>::</span><span class=n>trim</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                        <span class=o>.</span><span class=na>filter</span><span class=o>(</span><span class=n>s</span> <span class=o>-&gt;</span> <span class=n>s</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>&gt;</span> <span class=mi>2</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                        <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>100</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                        <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>Collectors</span><span class=o>.</span><span class=na>toCollection</span><span class=o>(</span><span class=n>TreeSet</span><span class=o>::</span><span class=k>new</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>words2</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>[Arrays, Collectors, Exception, Files, Output, Paths,
Set, String, System, TreeSet, TreeSetOfWords, args,
class, collect, file, filter, flatMap, get, import,
java, length, limit, lines, main, map, matches, new,
nio, numbers, out, println, public, split, static,
stream, streams, throws, toCollection, trim, util,
void, words2]
</code></pre><p><strong>Files.</strong><code>lines()</code> 打开 <strong>Path</strong> 并将其转换成为由行组成的流。下一行代码以一个或多个非单词字符（<code>\\W+</code>）为分界，对每一行进行分割，结果是产生一个数组，然后使用 <strong>Arrays.</strong><code>stream()</code> 将数组转化成为流，最后<code>flatMap()</code>将各行形成的多个单词流，扁平映射为一个单词流。使用 <code>matches(\\d+)</code> 查找并移除全部是数字的字符串（注意,<code>words2</code> 是通过的）。然后用 <strong>String.</strong><code>trim()</code> 去除单词两边的空白，<code>filter()</code> 过滤所有长度小于 3 的单词，并只获取前 100 个单词，最后将其保存到 <strong>TreeSet</strong> 中。</p><p>我们也可以在流中生成 <strong>Map</strong>。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/MapCollector.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Pair</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>final</span> <span class=n>Character</span> <span class=n>c</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>final</span> <span class=n>Integer</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Pair</span><span class=o>(</span><span class=n>Character</span> <span class=n>c</span><span class=o>,</span> <span class=n>Integer</span> <span class=n>i</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>c</span> <span class=o>=</span> <span class=n>c</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>i</span> <span class=o>=</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Character</span> <span class=nf>getC</span><span class=o>()</span> <span class=o>{</span> <span class=k>return</span> <span class=n>c</span><span class=o>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Integer</span> <span class=nf>getI</span><span class=o>()</span> <span class=o>{</span> <span class=k>return</span> <span class=n>i</span><span class=o>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;Pair(&#34;</span> <span class=o>+</span> <span class=n>c</span> <span class=o>+</span> <span class=s>&#34;, &#34;</span> <span class=o>+</span> <span class=n>i</span> <span class=o>+</span> <span class=s>&#34;)&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>RandomPair</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>(</span><span class=mi>47</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// An infinite iterator of random capital letters:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Iterator</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>&gt;</span> <span class=n>capChars</span> <span class=o>=</span> <span class=n>rand</span><span class=o>.</span><span class=na>ints</span><span class=o>(</span><span class=mi>65</span><span class=o>,</span><span class=mi>91</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>mapToObj</span><span class=o>(</span><span class=n>i</span> <span class=o>-&gt;</span> <span class=o>(</span><span class=kt>char</span><span class=o>)</span><span class=n>i</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>iterator</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Stream</span><span class=o>&lt;</span><span class=n>Pair</span><span class=o>&gt;</span> <span class=nf>stream</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>rand</span><span class=o>.</span><span class=na>ints</span><span class=o>(</span><span class=mi>100</span><span class=o>,</span> <span class=mi>1000</span><span class=o>).</span><span class=na>distinct</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>mapToObj</span><span class=o>(</span><span class=n>i</span> <span class=o>-&gt;</span> <span class=k>new</span> <span class=n>Pair</span><span class=o>(</span><span class=n>capChars</span><span class=o>.</span><span class=na>next</span><span class=o>(),</span> <span class=n>i</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MapCollector</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Map</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>,</span> <span class=n>Character</span><span class=o>&gt;</span> <span class=n>map</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>                <span class=k>new</span> <span class=n>RandomPair</span><span class=o>().</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                        <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>8</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                        <span class=o>.</span><span class=na>collect</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                                <span class=n>Collectors</span><span class=o>.</span><span class=na>toMap</span><span class=o>(</span><span class=n>Pair</span><span class=o>::</span><span class=n>getI</span><span class=o>,</span> <span class=n>Pair</span><span class=o>::</span><span class=n>getC</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>map</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>{688=W, 309=C, 293=B, 761=N, 858=N, 668=G, 622=F, 751=N}
</code></pre><p><strong>Pair</strong> 只是一个基础的数据对象。<strong>RandomPair</strong> 创建了随机生成的 <strong>Pair</strong> 对象流。在 Java 中，我们不能直接以某种方式组合两个流。所以我创建了一个整数流，并且使用 <code>mapToObj()</code> 将整数流转化成为 <strong>Pair</strong> 流。 <strong>capChars</strong>的随机大写字母迭代器创建了流，然后<code>next()</code>让我们可以在<code>stream()</code>中使用这个流。就我所知，这是将多个流组合成新的对象流的唯一方法。</p><p>在这里，我们只使用最简单形式的 <code>Collectors.toMap()</code>，这个方法只需要两个从流中获取键和值的函数。还有其他重载形式，其中一种当是键发生冲突时，使用一个函数来处理冲突。</p><p>大多数情况下，<code>java.util.stream.Collectors</code> 中预设的 <strong>Collector</strong> 就能满足我们的要求。除此之外，你还可以使用第二种形式的 <code>collect()</code>。 我把它留作更高级的练习，下例给出基本用法：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/SpecialCollector.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SpecialCollector</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>words</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>                <span class=n>FileToWords</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=s>&#34;Cheese.dat&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                        <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>ArrayList</span><span class=o>::</span><span class=k>new</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                                <span class=n>ArrayList</span><span class=o>::</span><span class=n>add</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                                <span class=n>ArrayList</span><span class=o>::</span><span class=n>addAll</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>words</span><span class=o>.</span><span class=na>stream</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>filter</span><span class=o>(</span><span class=n>s</span> <span class=o>-&gt;</span> <span class=n>s</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=s>&#34;cheese&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>cheese
cheese
</code></pre><p>在这里， <strong>ArrayList</strong> 的方法已经做了你所需要的操作，但更有可能的是，如果你必须使用这种形式的 <code>collect()</code>，就要自己创建特定的定义。</p><h3 id=组合>组合</h3><ul><li><code>reduce(BinaryOperator)</code>：使用 <strong>BinaryOperator</strong> 来组合所有流中的元素。因为流可能为空，其返回值为 <strong>Optional</strong>。</li><li><code>reduce(identity, BinaryOperator)</code>：功能同上，但是使用 <strong>identity</strong> 作为其组合的初始值。因此如果流为空，<strong>identity</strong> 就是结果。</li><li><code>reduce(identity, BiFunction, BinaryOperator)</code>：更复杂的使用形式（暂不介绍），这里把它包含在内，因为它可以提高效率。通常，我们可以显式地组合 <code>map()</code> 和 <code>reduce()</code> 来更简单的表达它。</li></ul><p>下面来看下 <code>reduce</code> 的代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/Reduce.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Frobnitz</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>size</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Frobnitz</span><span class=o>(</span><span class=kt>int</span> <span class=n>sz</span><span class=o>)</span> <span class=o>{</span> <span class=n>size</span> <span class=o>=</span> <span class=n>sz</span><span class=o>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;Frobnitz(&#34;</span> <span class=o>+</span> <span class=n>size</span> <span class=o>+</span> <span class=s>&#34;)&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Generator:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>static</span> <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>(</span><span class=mi>47</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>BOUND</span> <span class=o>=</span> <span class=mi>100</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=n>Frobnitz</span> <span class=nf>supply</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>Frobnitz</span><span class=o>(</span><span class=n>rand</span><span class=o>.</span><span class=na>nextInt</span><span class=o>(</span><span class=n>BOUND</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Reduce</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Stream</span><span class=o>.</span><span class=na>generate</span><span class=o>(</span><span class=n>Frobnitz</span><span class=o>::</span><span class=n>supply</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>limit</span><span class=o>(</span><span class=mi>10</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>peek</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>reduce</span><span class=o>((</span><span class=n>fr0</span><span class=o>,</span> <span class=n>fr1</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=n>fr0</span><span class=o>.</span><span class=na>size</span> <span class=o>&lt;</span> <span class=mi>50</span> <span class=o>?</span> <span class=n>fr0</span> <span class=o>:</span> <span class=n>fr1</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>ifPresent</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>Frobnitz(58)
Frobnitz(55)
Frobnitz(93)
Frobnitz(61)
Frobnitz(61)
Frobnitz(29)
Frobnitz(68)
Frobnitz(0)
Frobnitz(22)
Frobnitz(7)
Frobnitz(29)
</code></pre><p><strong>Frobnitz</strong> 包含一个可生成自身的生成器 <code>supply()</code> ；因为 <code>supply()</code> 方法作为一个 <code>Supplier&lt;Frobnitz></code> 是签名兼容的，我们可以把 <code>supply()</code> 作为一个方法引用传递给 <code>Stream.generate()</code> （这种签名兼容性被称作结构一致性）。我们使用了没有“初始值”作为第一个参数的 <code>reduce()</code>方法，所以产生的结果是 <strong>Optional</strong> 类型。<code>Optional.ifPresent()</code> 方法只有在结果非空的时候才会调用 <code>Consumer&lt;Frobnitz></code> （<code>println</code> 方法可以被调用是因为 <strong>Frobnitz</strong> 可以通过 <code>toString()</code> 方法转换成 <strong>String</strong>）。</p><p>Lambda 表达式中的第一个参数 <code>fr0</code> 是 <code>reduce()</code> 中上一次调用的结果。而第二个参数 <code>fr1</code> 是从流传递过来的值。</p><p><code>reduce()</code> 中的 Lambda 表达式使用了三元表达式来获取结果，当 <code>fr0</code> 的 <code>size</code> 值小于 50 的时候，将 <code>fr0</code> 作为结果，否则将序列中的下一个元素即 <code>fr1</code>作为结果。当取得第一个 <code>size</code> 值小于 50 的 <code>Frobnitz</code>，只要得到这个结果就会忽略流中其他元素。这是个非常奇怪的限制， 但也确实让我们对 <code>reduce()</code> 有了更多的了解。</p><h3 id=匹配>匹配</h3><ul><li><code>allMatch(Predicate)</code> ：如果流的每个元素提供给 <strong>Predicate</strong> 都返回 true ，结果返回为 true。在第一个 false 时，则停止执行计算。</li><li><code>anyMatch(Predicate)</code>：如果流的任意一个元素提供给 <strong>Predicate</strong> 返回 true ，结果返回为 true。在第一个 true 是停止执行计算。</li><li><code>noneMatch(Predicate)</code>：如果流的每个元素提供给 <strong>Predicate</strong> 都返回 false 时，结果返回为 true。在第一个 true 时停止执行计算。</li></ul><p>我们已经在 <code>Prime.java</code> 中看到了 <code>noneMatch()</code> 的示例；<code>allMatch()</code> 和 <code>anyMatch()</code> 的用法基本上是等同的。下面我们来探究一下短路行为。为了消除冗余代码，我们创建了 <code>show()</code>。首先我们必须知道如何统一地描述这三个匹配器的操作，然后再将其转换为 <strong>Matcher</strong> 接口。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/Matching.java
</span></span></span><span class=line><span class=cl><span class=c1>// Demonstrates short-circuiting of *Match() operations
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import static</span> <span class=nn>streams.RandInts.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>interface</span> <span class=nc>Matcher</span> <span class=kd>extends</span> <span class=n>BiPredicate</span><span class=o>&lt;</span><span class=n>Stream</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;,</span> <span class=n>Predicate</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;&gt;</span> <span class=o>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Matching</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>show</span><span class=o>(</span><span class=n>Matcher</span> <span class=n>match</span><span class=o>,</span> <span class=kt>int</span> <span class=n>val</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=n>match</span><span class=o>.</span><span class=na>test</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                        <span class=n>IntStream</span><span class=o>.</span><span class=na>rangeClosed</span><span class=o>(</span><span class=mi>1</span><span class=o>,</span> <span class=mi>9</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                                <span class=o>.</span><span class=na>boxed</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                                <span class=o>.</span><span class=na>peek</span><span class=o>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%d &#34;</span><span class=o>,</span> <span class=n>n</span><span class=o>)),</span>
</span></span><span class=line><span class=cl>                        <span class=n>n</span> <span class=o>-&gt;</span> <span class=n>n</span> <span class=o>&lt;</span> <span class=n>val</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>show</span><span class=o>(</span><span class=n>Stream</span><span class=o>::</span><span class=n>allMatch</span><span class=o>,</span> <span class=mi>10</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>show</span><span class=o>(</span><span class=n>Stream</span><span class=o>::</span><span class=n>allMatch</span><span class=o>,</span> <span class=mi>4</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>show</span><span class=o>(</span><span class=n>Stream</span><span class=o>::</span><span class=n>anyMatch</span><span class=o>,</span> <span class=mi>2</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>show</span><span class=o>(</span><span class=n>Stream</span><span class=o>::</span><span class=n>anyMatch</span><span class=o>,</span> <span class=mi>0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>show</span><span class=o>(</span><span class=n>Stream</span><span class=o>::</span><span class=n>noneMatch</span><span class=o>,</span> <span class=mi>5</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>show</span><span class=o>(</span><span class=n>Stream</span><span class=o>::</span><span class=n>noneMatch</span><span class=o>,</span> <span class=mi>0</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>1 2 3 4 5 6 7 8 9 true
1 2 3 4 false
1 true
1 2 3 4 5 6 7 8 9 false
1 false
1 2 3 4 5 6 7 8 9 true
</code></pre><p><strong>BiPredicate</strong> 是一个二元谓词，它接受两个参数并返回 true 或者 false。第一个参数是我们要测试的流，第二个参数是一个谓词 <strong>Predicate</strong>。<strong>Matcher</strong> 可以匹配所有的 <strong>Stream::*Match</strong> 方法，所以可以将每一个<strong>Stream::*Match</strong>方法引用传递到 <code>show()</code> 中。对<code>match.test()</code> 的调用会被转换成 对方法引用<strong>Stream::*Match</strong> 的调用。</p><p><code>show()</code> 接受一个<strong>Matcher</strong>和一个 <code>val</code> 参数，<code>val</code> 在判断测试 <code>n &lt; val</code>中指定了最大值。<code>show()</code> 方法生成了整数 1-9 组成的一个流。<code>peek()</code>用来展示在测试短路之前测试进行到了哪一步。从输出中可以看到每次都发生了短路。</p><h3 id=查找>查找</h3><ul><li><code>findFirst()</code>：返回第一个流元素的 <strong>Optional</strong>，如果流为空返回 <strong>Optional.empty</strong>。</li><li><code>findAny(</code>：返回含有任意流元素的 <strong>Optional</strong>，如果流为空返回 <strong>Optional.empty</strong>。</li></ul><p>代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/SelectElement.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import static</span> <span class=nn>streams.RandInts.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SelectElement</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>rands</span><span class=o>().</span><span class=na>findFirst</span><span class=o>().</span><span class=na>getAsInt</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=n>rands</span><span class=o>().</span><span class=na>parallel</span><span class=o>().</span><span class=na>findFirst</span><span class=o>().</span><span class=na>getAsInt</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>rands</span><span class=o>().</span><span class=na>findAny</span><span class=o>().</span><span class=na>getAsInt</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=n>rands</span><span class=o>().</span><span class=na>parallel</span><span class=o>().</span><span class=na>findAny</span><span class=o>().</span><span class=na>getAsInt</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>258
258
258
242
</code></pre><p>无论流是否为并行化，<code>findFirst()</code> 总是会选择流中的第一个元素。对于非并行流，<code>findAny()</code>会选择流中的第一个元素（即使从定义上来看是选择任意元素）。在这个例子中，用 <code>parallel()</code> 将流并行化，以展示 <code>findAny()</code> 不选择流的第一个元素的可能性。</p><p>如果必须选择流中最后一个元素，那就使用 <code>reduce()</code>。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/LastElement.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>LastElement</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>OptionalInt</span> <span class=n>last</span> <span class=o>=</span> <span class=n>IntStream</span><span class=o>.</span><span class=na>range</span><span class=o>(</span><span class=mi>10</span><span class=o>,</span> <span class=mi>20</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>reduce</span><span class=o>((</span><span class=n>n1</span><span class=o>,</span> <span class=n>n2</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=n>n2</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>last</span><span class=o>.</span><span class=na>orElse</span><span class=o>(-</span><span class=mi>1</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Non-numeric object:
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>lastobj</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>                <span class=n>Stream</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=s>&#34;one&#34;</span><span class=o>,</span> <span class=s>&#34;two&#34;</span><span class=o>,</span> <span class=s>&#34;three&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                        <span class=o>.</span><span class=na>reduce</span><span class=o>((</span><span class=n>n1</span><span class=o>,</span> <span class=n>n2</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=n>n2</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=n>lastobj</span><span class=o>.</span><span class=na>orElse</span><span class=o>(</span><span class=s>&#34;Nothing there!&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>19
three
</code></pre><p><code>reduce()</code> 的参数只是用最后一个元素替换了最后两个元素，最终只生成最后一个元素。如果为数字流，你必须使用相近的数字 <strong>Optional</strong> 类型（ numeric optional type），否则使用 <strong>Optional</strong> 类型，就像上例中的 <code>Optional&lt;String></code>。</p><h3 id=信息>信息</h3><ul><li><code>count()</code>：流中的元素个数。</li><li><code>max(Comparator)</code>：根据所传入的 <strong>Comparator</strong> 所决定的“最大”元素。</li><li><code>min(Comparator)</code>：根据所传入的 <strong>Comparator</strong> 所决定的“最小”元素。</li></ul><p><strong>String</strong> 类型有预设的 <strong>Comparator</strong> 实现。代码示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/Informational.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Informational</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span>
</span></span><span class=line><span class=cl>    <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=n>FileToWords</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=s>&#34;Cheese.dat&#34;</span><span class=o>).</span><span class=na>count</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=n>FileToWords</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=s>&#34;Cheese.dat&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                        <span class=o>.</span><span class=na>min</span><span class=o>(</span><span class=n>String</span><span class=o>.</span><span class=na>CASE_INSENSITIVE_ORDER</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                        <span class=o>.</span><span class=na>orElse</span><span class=o>(</span><span class=s>&#34;NONE&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=n>FileToWords</span><span class=o>.</span><span class=na>stream</span><span class=o>(</span><span class=s>&#34;Cheese.dat&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                        <span class=o>.</span><span class=na>max</span><span class=o>(</span><span class=n>String</span><span class=o>.</span><span class=na>CASE_INSENSITIVE_ORDER</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                        <span class=o>.</span><span class=na>orElse</span><span class=o>(</span><span class=s>&#34;NONE&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>32
a
you
</code></pre><p><code>min()</code> 和 <code>max()</code> 的返回类型为 <strong>Optional</strong>，这需要我们使用 <code>orElse()</code>来解包。</p><h3 id=数字流信息>数字流信息</h3><ul><li><code>average()</code> ：求取流元素平均值。</li><li><code>max()</code> 和 <code>min()</code>：数值流操作无需 <strong>Comparator</strong>。</li><li><code>sum()</code>：对所有流元素进行求和。</li><li><code>summaryStatistics()</code>：生成可能有用的数据。目前并不太清楚这个方法存在的必要性，因为我们其实可以用更直接的方法获得需要的数据。</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// streams/NumericStreamInfo.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import static</span> <span class=nn>streams.RandInts.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>NumericStreamInfo</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>rands</span><span class=o>().</span><span class=na>average</span><span class=o>().</span><span class=na>getAsDouble</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>rands</span><span class=o>().</span><span class=na>max</span><span class=o>().</span><span class=na>getAsInt</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>rands</span><span class=o>().</span><span class=na>min</span><span class=o>().</span><span class=na>getAsInt</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>rands</span><span class=o>().</span><span class=na>sum</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>rands</span><span class=o>().</span><span class=na>summaryStatistics</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出结果：</p><pre tabindex=0><code>507.94
998
8
50794
IntSummaryStatistics{count=100, sum=50794, min=8, average=507.940000, max=998}
</code></pre><p>上例操作对于 <strong>LongStream</strong> 和 <strong>DoubleStream</strong> 同样适用。</p><h2 id=本章小结>本章小结</h2><p>流式操作改变并极大地提升了 Java 语言的可编程性，并可能极大地阻止了 Java 编程人员向诸如 Scala 这种函数式语言的流转。在本书的剩余部分，我们将尽可能地使用流。</p><div style=page-break-after:always></div><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>在软件或信息建模的上下文中，快乐路径(有时称为快乐流)是没有异常或错误条件的默认场景。例如，验证信用卡号的函数的快乐路径应该是任何验证规则都不会出现错误的地方，从而让执行成功地继续到最后，生成一个积极的响应。<a href=https://en.wikipedia.org/wiki/Happy_path target=_blank rel=noopener>见 wikipedia: happy path</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>上一页</div><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/13-functional-programming/ rel=next>13-Functional-Programming</a></div><div class="col-6 post-nav-item"><div class=meta-nav>下一页</div><a href=/books/java-series/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/15-exceptions/ rel=prev>15-Exceptions</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>