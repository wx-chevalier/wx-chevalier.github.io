<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="Java 13 版本介绍 Dynamic CDS Archives 这一特性是在 JEP310：Application Class-Data Sharing 基础上扩展而来的，Dynamic CDS Archives 中的 CDS 指的就是 Class-Data Sharing。我们知道在同一个物理机／虚拟机上启动多个 JVM 时，如果每个虚拟机都"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/java-series/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/2.%E8%83%8C%E6%99%AF%E4%B8%8E%E7%89%B9%E6%80%A7/%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7/java-13/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/java-series/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/2.%E8%83%8C%E6%99%AF%E4%B8%8E%E7%89%B9%E6%80%A7/%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7/java-13/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/java-series/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/2.%E8%83%8C%E6%99%AF%E4%B8%8E%E7%89%B9%E6%80%A7/%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7/java-13/"><meta property="og:title" content="Java 13 | Next-gen Tech Edu"><meta property="og:description" content="Java 13 版本介绍 Dynamic CDS Archives 这一特性是在 JEP310：Application Class-Data Sharing 基础上扩展而来的，Dynamic CDS Archives 中的 CDS 指的就是 Class-Data Sharing。我们知道在同一个物理机／虚拟机上启动多个 JVM 时，如果每个虚拟机都"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>Java 13 | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=4737c0c04cdce3df9503c7bb249490e5><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">版本特性</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id3d6d8494a0acad1ba91cc73eedf73dde")' href=#id3d6d8494a0acad1ba91cc73eedf73dde aria-expanded=false aria-controls=id3d6d8494a0acad1ba91cc73eedf73dde aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/2.%E8%83%8C%E6%99%AF%E4%B8%8E%E7%89%B9%E6%80%A7/>2.背景与特性</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id3d6d8494a0acad1ba91cc73eedf73dde aria-expanded=false aria-controls=id3d6d8494a0acad1ba91cc73eedf73dde><i class="fa-solid fa-angle-down" id=caret-id3d6d8494a0acad1ba91cc73eedf73dde></i></a></div><ul class="nav docs-sidenav collapse show" id=id3d6d8494a0acad1ba91cc73eedf73dde><li class="child level"><a href=/books/java-series/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/2.%E8%83%8C%E6%99%AF%E4%B8%8E%E7%89%B9%E6%80%A7/java-%E7%AE%80%E5%8F%B2/>Java 简史</a></li><li class="child level"><a href=/books/java-series/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/2.%E8%83%8C%E6%99%AF%E4%B8%8E%E7%89%B9%E6%80%A7/java-%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5/>Java 设计理念</a></li><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id5a68bd3bddbb22d75aa56b7f79f38ba0")' href=#id5a68bd3bddbb22d75aa56b7f79f38ba0 aria-expanded=false aria-controls=id5a68bd3bddbb22d75aa56b7f79f38ba0 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-series/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/2.%E8%83%8C%E6%99%AF%E4%B8%8E%E7%89%B9%E6%80%A7/%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7/>版本特性</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id5a68bd3bddbb22d75aa56b7f79f38ba0 aria-expanded=false aria-controls=id5a68bd3bddbb22d75aa56b7f79f38ba0><i class="fa-solid fa-angle-down" id=caret-id5a68bd3bddbb22d75aa56b7f79f38ba0></i></a></div><ul class="nav docs-sidenav collapse show" id=id5a68bd3bddbb22d75aa56b7f79f38ba0><li class="child level"><a href=/books/java-series/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/2.%E8%83%8C%E6%99%AF%E4%B8%8E%E7%89%B9%E6%80%A7/%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7/java-10/>Java 10</a></li><li class="child level"><a href=/books/java-series/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/2.%E8%83%8C%E6%99%AF%E4%B8%8E%E7%89%B9%E6%80%A7/%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7/java-11/>Java 11</a></li><li class="child level"><a href=/books/java-series/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/2.%E8%83%8C%E6%99%AF%E4%B8%8E%E7%89%B9%E6%80%A7/%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7/java-12/>Java 12</a></li><li class="child level active"><a href=/books/java-series/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/2.%E8%83%8C%E6%99%AF%E4%B8%8E%E7%89%B9%E6%80%A7/%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7/java-13/>Java 13</a></li><li class="child level"><a href=/books/java-series/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/2.%E8%83%8C%E6%99%AF%E4%B8%8E%E7%89%B9%E6%80%A7/%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7/java-14/>Java 14</a></li><li class="child level"><a href=/books/java-series/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/2.%E8%83%8C%E6%99%AF%E4%B8%8E%E7%89%B9%E6%80%A7/%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7/java-15/>Java 15</a></li><li class="child level"><a href=/books/java-series/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/2.%E8%83%8C%E6%99%AF%E4%B8%8E%E7%89%B9%E6%80%A7/%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7/java-8/>Java 8</a></li><li class="child level"><a href=/books/java-series/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/2.%E8%83%8C%E6%99%AF%E4%B8%8E%E7%89%B9%E6%80%A7/%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7/java-9/>Java 9</a></li><li class="child level"><a href=/books/java-series/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/2.%E8%83%8C%E6%99%AF%E4%B8%8E%E7%89%B9%E6%80%A7/%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7/%E5%85%BC%E5%AE%B9%E6%80%A7%E6%96%B9%E6%B3%95/>兼容性方法</a></li></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>Java 13</h1><div class=article-style><h1 id=java-13-版本介绍>Java 13 版本介绍</h1><h1 id=dynamic-cds-archives>Dynamic CDS Archives</h1><p>这一特性是在 JEP310：Application Class-Data Sharing 基础上扩展而来的，Dynamic CDS Archives 中的 CDS 指的就是 Class-Data Sharing。我们知道在同一个物理机／虚拟机上启动多个 JVM 时，如果每个虚拟机都单独装载自己需要的所有类，启动成本和内存占用是比较高的。所以 Java 团队引入了 CDS 的概念，通过把一些核心类在每个 JVM 间共享，每个 JVM 只需要装载自己的应用类，启动时间减少了，另外核心类是共享的，所以 JVM 的内存占用也减少了。</p><p>CDS 只能作用于 Boot Class Loader 加载的类，不能作用于 App Class Loader 或者自定义的 Class Loader 加载的类。在 Java 10 中，则将 CDS 扩展为 AppCDS，顾名思义，AppCDS 不止能够作用于 Boot Class Loader 了，App Class Loader 和自定义的 Class Loader 也都能够起作用，大大加大了 CDS 的适用范围。也就说开发自定义的类也可以装载给多个 JVM 共享了。</p><p>Java 10 中包含的 JEP310 的通过跨不同 Java 进程共享公共类元数据来减少了内存占用和改进了启动时间。但是，JEP310 中，使用 AppCDS 的过程还是比较复杂的，需要有三个步骤：</p><p>1、决定要 Dump 哪些 Class
2、将类的内存 Dump 到归档文件中
3、使用 Dump 出来的归档文件加快应用启动速度</p><p>这一次的 JDK 13 中的 JEP 350，在 JEP310 的基础上，又做了一些扩展。允许在 Java 应用程序执行结束时动态归档类，归档类将包括默认的基础层 CDS（class data-sharing）存档中不存在的所有已加载的应用程序类和库类。也就是说，在 Java 13 中再使用 AppCDS 的时候，就不在需要这么复杂了。</p><h1 id=zgc-uncommit-unused-memory>ZGC: Uncommit Unused Memory</h1><p>JVM 的 GC 释放的内存会还给操作系统吗？GC 后的内存如何处置，其实是取决于不同的垃圾回收器的。因为把内存还给 OS，意味着要调整 JVM 的堆大小，这个过程是比较耗费资源的。</p><p>在 JDK 11 中，Java 引入了 ZGC，这是一款可伸缩的低延迟垃圾收集器，但是当时只是实验性的。并且，ZGC 释放的内存是不会还给操作系统的。而在 Java 13 中，JEP 351 再次对 ZGC 做了增强，本次 ZGC 可以将未使用的堆内存返回给操作系统。之所以引入这个特性，是因为如今有很多场景中内存是比较昂贵的资源，在以下情况中，将内存还给操作系统还是很有必要的：</p><p>1、那些需要根据使用量付费的容器
2、应用程序可能长时间处于空闲状态并与许多其他应用程序共享或竞争资源的环境。
3、应用程序在执行期间可能有非常不同的堆空间需求。例如，启动期间所需的堆可能大于稍后在稳定状态执行期间所需的堆。</p><h1 id=reimplement-the-legacy-socket-api>Reimplement the Legacy Socket API</h1><p>使用易于维护和调试的更简单、更现代的实现替换 java.net.Socket 和 java.net.ServerSocket API。java.net.Socket 和 java.net.ServerSocket 的实现非常古老，这个 JEP 为它们引入了一个现代的实现。现代实现是 Java 13 中的默认实现，但是旧的实现还没有删除，可以通过设置系统属性 jdk.net.usePlainSocketImpl 来使用它们。</p><p>运行一个实例化 Socket 和 ServerSocket 的类将显示这个调试输出。这是默认的(新的):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>java -XX:+TraceClassLoading JEP353  <span class=p>|</span> grep Socket
</span></span><span class=line><span class=cl><span class=o>[</span>0.033s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.Socket source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.035s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.SocketOptions source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.035s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.SocketImpl source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.039s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.SocketImpl<span class=nv>$$</span>Lambda<span class=nv>$1</span>/0x0000000800b50840 source: java.net.SocketImpl
</span></span><span class=line><span class=cl><span class=o>[</span>0.042s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> sun.net.PlatformSocketImpl source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.042s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> sun.nio.ch.NioSocketImpl source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.043s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> sun.nio.ch.SocketDispatcher source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.044s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.DelegatingSocketImpl source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.044s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.SocksSocketImpl source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.044s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.ServerSocket source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.045s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> jdk.internal.access.JavaNetSocketAccess source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.045s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.ServerSocket<span class=nv>$1</span> source: jrt:/java.base
</span></span></code></pre></div><p>上面输出的 sun.nio.ch.NioSocketImpl 就是新提供的实现。如果使用旧的实现也是可以的（指定参数 jdk.net.usePlainSocketImpl）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ java -Djdk.net.usePlainSocketImpl -XX:+TraceClassLoading JEP353  <span class=p>|</span> grep Socket
</span></span><span class=line><span class=cl><span class=o>[</span>0.037s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.Socket source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.039s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.SocketOptions source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.039s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.SocketImpl source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.043s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.SocketImpl<span class=nv>$$</span>Lambda<span class=nv>$1</span>/0x0000000800b50840 source: java.net.SocketImpl
</span></span><span class=line><span class=cl><span class=o>[</span>0.046s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> sun.net.PlatformSocketImpl source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.047s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.AbstractPlainSocketImpl source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.047s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.PlainSocketImpl source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.047s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.AbstractPlainSocketImpl<span class=nv>$1</span> source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.047s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> sun.net.ext.ExtendedSocketOptions source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.047s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> jdk.net.ExtendedSocketOptions source: jrt:/jdk.net
</span></span><span class=line><span class=cl><span class=o>[</span>0.047s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.SocketOption source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.047s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> jdk.net.ExtendedSocketOptions<span class=nv>$ExtSocketOption</span> source: jrt:/jdk.net
</span></span><span class=line><span class=cl><span class=o>[</span>0.047s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> jdk.net.SocketFlow source: jrt:/jdk.net
</span></span><span class=line><span class=cl><span class=o>[</span>0.047s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> jdk.net.ExtendedSocketOptions<span class=nv>$PlatformSocketOptions</span> source: jrt:/jdk.net
</span></span><span class=line><span class=cl><span class=o>[</span>0.047s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> jdk.net.ExtendedSocketOptions<span class=nv>$PlatformSocketOptions$1</span> source: jrt:/jdk.net
</span></span><span class=line><span class=cl><span class=o>[</span>0.048s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> jdk.net.LinuxSocketOptions source: jrt:/jdk.net
</span></span><span class=line><span class=cl><span class=o>[</span>0.048s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> jdk.net.LinuxSocketOptions<span class=nv>$$</span>Lambda<span class=nv>$2</span>/0x0000000800b51040 source: jdk.net.LinuxSocketOptions
</span></span><span class=line><span class=cl><span class=o>[</span>0.049s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> jdk.net.ExtendedSocketOptions<span class=nv>$1</span> source: jrt:/jdk.net
</span></span><span class=line><span class=cl><span class=o>[</span>0.049s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.StandardSocketOptions source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.049s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.StandardSocketOptions<span class=nv>$StdSocketOption</span> source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.051s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> sun.net.ext.ExtendedSocketOptions<span class=nv>$$</span>Lambda<span class=nv>$3</span>/0x0000000800b51440 source: sun.net.ext.ExtendedSocketOptions
</span></span><span class=line><span class=cl><span class=o>[</span>0.057s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.DelegatingSocketImpl source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.057s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.SocksSocketImpl source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.058s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.ServerSocket source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.058s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> jdk.internal.access.JavaNetSocketAccess source: jrt:/java.base
</span></span><span class=line><span class=cl><span class=o>[</span>0.058s<span class=o>][</span>info   <span class=o>][</span>class,load<span class=o>]</span> java.net.ServerSocket<span class=nv>$1</span> source: jrt:/java.base
</span></span></code></pre></div><p>上面的结果中，旧的实现 java.net.PlainSocketImpl 被用到了。</p><h1 id=switch-expressions-preview>Switch Expressions (Preview)</h1><p>在 JDK 12 中引入了 Switch 表达式作为预览特性。JEP 354 修改了这个特性，它引入了 yield 语句，用于返回值。这意味着，switch 表达式(返回值)应该使用 yield, switch 语句(不返回值)应该使用 break。在以前，我们想要在 switch 中返回内容，还是比较麻烦的，一般语法如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kt>int</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=k>switch</span> <span class=o>(</span><span class=n>x</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s>&#34;1&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s>&#34;2&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span><span class=o>=</span><span class=mi>2</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>=</span> <span class=n>x</span><span class=o>.</span><span class=na>length</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>在 JDK13 中使用以下语法：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=k>switch</span> <span class=o>(</span><span class=n>x</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s>&#34;1&#34;</span> <span class=o>-&gt;</span> <span class=mi>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s>&#34;2&#34;</span> <span class=o>-&gt;</span> <span class=mi>2</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>len</span> <span class=o>=</span> <span class=n>args</span><span class=o>[</span><span class=mi>1</span><span class=o>].</span><span class=na>length</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>yield</span> <span class=n>len</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 或者
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=k>switch</span> <span class=o>(</span><span class=n>x</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s>&#34;1&#34;</span><span class=o>:</span> <span class=n>yield</span> <span class=mi>1</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s>&#34;2&#34;</span><span class=o>:</span> <span class=n>yield</span> <span class=mi>2</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>default</span><span class=o>:</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>len</span> <span class=o>=</span> <span class=n>args</span><span class=o>[</span><span class=mi>1</span><span class=o>].</span><span class=na>length</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>yield</span> <span class=n>len</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>};</span>
</span></span></code></pre></div><p>在这之后，switch 中就多了一个关键字用于跳出 switch 块了，那就是 yield，他用于返回一个值。和 return 的区别在于：return 会直接跳出当前循环或者方法，而 yield 只会跳出当前 switch 块。</p><h1 id=text-blocks-preview>Text Blocks (Preview)</h1><p>在 JDK 12 中引入了 Raw String Literals 特性，但在发布之前就放弃了。这个 JEP 在引入多行字符串文字（text block）在意义上是类似的。Text Blocks，文本块，是一个多行字符串文字，它避免了对大多数转义序列的需要，以可预测的方式自动格式化字符串，并在需要时让开发人员控制格式。</p><p>我们以前从外部 copy 一段文本串到 Java 中，会被自动转义，如有一段以下字符串：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;html&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;body&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;p&gt;</span>Hello, world<span class=nt>&lt;/p&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/body&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/html&gt;</span>
</span></span></code></pre></div><p>将其复制到 Java 的字符串中，会展示成以下内容：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=s>&#34;&lt;html&gt;\n&#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=s>&#34;    &lt;body&gt;\n&#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=s>&#34;        &lt;p&gt;Hello, world&lt;/p&gt;\n&#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=s>&#34;    &lt;/body&gt;\n&#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl><span class=s>&#34;&lt;/html&gt;\n&#34;</span><span class=o>;</span>
</span></span></code></pre></div><p>即被自动进行了转义，这样的字符串看起来不是很直观，在 JDK 13 中，就可以使用以下语法了：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=s>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s>&lt;html&gt;
</span></span></span><span class=line><span class=cl><span class=s>  &lt;body&gt;
</span></span></span><span class=line><span class=cl><span class=s>      &lt;p&gt;Hello, world&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=s>  &lt;/body&gt;
</span></span></span><span class=line><span class=cl><span class=s>&lt;/html&gt;
</span></span></span><span class=line><span class=cl><span class=s>&#34;&#34;&#34;</span><span class=o>;</span>
</span></span></code></pre></div><p>使用“”“作为文本块的开始符合结束符，在其中就可以放置多行的字符串，不需要进行任何转义。看起来就十分清爽了。如常见的 SQL 语句：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span> <span class=n>query</span> <span class=o>=</span> <span class=s>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s>    SELECT `EMP_ID`, `LAST_NAME` FROM `EMPLOYEE_TB`
</span></span></span><span class=line><span class=cl><span class=s>    WHERE `CITY` = &#39;INDIANAPOLIS&#39;
</span></span></span><span class=line><span class=cl><span class=s>    ORDER BY `EMP_ID`, `LAST_NAME`;
</span></span></span><span class=line><span class=cl><span class=s>&#34;&#34;&#34;</span><span class=o>;</span>
</span></span></code></pre></div></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>上一页</div><a href=/books/java-series/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/2.%E8%83%8C%E6%99%AF%E4%B8%8E%E7%89%B9%E6%80%A7/%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7/java-12/ rel=next>Java 12</a></div><div class="col-6 post-nav-item"><div class=meta-nav>下一页</div><a href=/books/java-series/01.%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/2.%E8%83%8C%E6%99%AF%E4%B8%8E%E7%89%B9%E6%80%A7/%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7/java-14/ rel=prev>Java 14</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>