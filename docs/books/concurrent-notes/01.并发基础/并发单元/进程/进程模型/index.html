<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="进程模型 Process Elements 进程 ID（或 PID）由操作系统分配，并且对于每个正在运行的进程都是唯一的。 Process Hierarchy 尽管操作系统可以同时运行多个进程，但实际上它只能直接启动一个称为 init（初始缩写）进程的进程。这不是一个特别"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/concurrent-notes/01.%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E5%8D%95%E5%85%83/%E8%BF%9B%E7%A8%8B/%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/concurrent-notes/01.%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E5%8D%95%E5%85%83/%E8%BF%9B%E7%A8%8B/%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/concurrent-notes/01.%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E5%8D%95%E5%85%83/%E8%BF%9B%E7%A8%8B/%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B/"><meta property="og:title" content="进程模型 | Next-gen Tech Edu"><meta property="og:description" content="进程模型 Process Elements 进程 ID（或 PID）由操作系统分配，并且对于每个正在运行的进程都是唯一的。 Process Hierarchy 尽管操作系统可以同时运行多个进程，但实际上它只能直接启动一个称为 init（初始缩写）进程的进程。这不是一个特别"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>进程模型 | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=2ffca8b9150d992410275692fe93b438><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">进程</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id029578155c3f9ffda99833dea068031d")' href=#id029578155c3f9ffda99833dea068031d aria-expanded=false aria-controls=id029578155c3f9ffda99833dea068031d aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/concurrent-notes/01.%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E5%8D%95%E5%85%83/>并发单元</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id029578155c3f9ffda99833dea068031d aria-expanded=false aria-controls=id029578155c3f9ffda99833dea068031d><i class="fa-solid fa-angle-down" id=caret-id029578155c3f9ffda99833dea068031d></i></a></div><ul class="nav docs-sidenav collapse show" id=id029578155c3f9ffda99833dea068031d><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idf01ace86ef9c32566faf65bb45e2a2ba")' href=#idf01ace86ef9c32566faf65bb45e2a2ba aria-expanded=false aria-controls=idf01ace86ef9c32566faf65bb45e2a2ba aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/concurrent-notes/01.%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E5%8D%95%E5%85%83/%E8%BF%9B%E7%A8%8B/>进程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idf01ace86ef9c32566faf65bb45e2a2ba aria-expanded=false aria-controls=idf01ace86ef9c32566faf65bb45e2a2ba><i class="fa-solid fa-angle-down" id=caret-idf01ace86ef9c32566faf65bb45e2a2ba></i></a></div><ul class="nav docs-sidenav collapse show" id=idf01ace86ef9c32566faf65bb45e2a2ba><li class="child level"><a href=/books/concurrent-notes/01.%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E5%8D%95%E5%85%83/%E8%BF%9B%E7%A8%8B/%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/>进程间通信</a></li><li class="child level active"><a href=/books/concurrent-notes/01.%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E5%8D%95%E5%85%83/%E8%BF%9B%E7%A8%8B/%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B/>进程模型</a></li><li class="child level"><a href=/books/concurrent-notes/01.%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E5%8D%95%E5%85%83/%E8%BF%9B%E7%A8%8B/%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81/>进程状态</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idf21be5ff41f5a94167d99bfe1736f603")' href=#idf21be5ff41f5a94167d99bfe1736f603 aria-expanded=false aria-controls=idf21be5ff41f5a94167d99bfe1736f603 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/concurrent-notes/01.%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E5%8D%95%E5%85%83/%E7%BA%BF%E7%A8%8B/>线程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idf21be5ff41f5a94167d99bfe1736f603 aria-expanded=false aria-controls=idf21be5ff41f5a94167d99bfe1736f603><i class="fa-solid fa-angle-right" id=caret-idf21be5ff41f5a94167d99bfe1736f603></i></a></div><ul class="nav docs-sidenav collapse" id=idf21be5ff41f5a94167d99bfe1736f603><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ideb80a669248b1574c532152a209b0257")' href=#ideb80a669248b1574c532152a209b0257 aria-expanded=false aria-controls=ideb80a669248b1574c532152a209b0257 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/concurrent-notes/01.%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E5%8D%95%E5%85%83/%E7%BA%BF%E7%A8%8B/%E7%BA%BF%E7%A8%8B%E6%B1%A0/>线程池</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ideb80a669248b1574c532152a209b0257 aria-expanded=false aria-controls=ideb80a669248b1574c532152a209b0257><i class="fa-solid fa-angle-right" id=caret-ideb80a669248b1574c532152a209b0257></i></a></div><ul class="nav docs-sidenav collapse" id=ideb80a669248b1574c532152a209b0257><li class="child level"><a href=/books/concurrent-notes/01.%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E5%8D%95%E5%85%83/%E7%BA%BF%E7%A8%8B/%E7%BA%BF%E7%A8%8B%E6%B1%A0/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%B0%83%E4%BC%98/>线程池调优</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idf1435defde4ea47454a304ea3435284c")' href=#idf1435defde4ea47454a304ea3435284c aria-expanded=false aria-controls=idf1435defde4ea47454a304ea3435284c aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/concurrent-notes/01.%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E5%8D%95%E5%85%83/%E7%BA%BF%E7%A8%8B/%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/>线程模型</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idf1435defde4ea47454a304ea3435284c aria-expanded=false aria-controls=idf1435defde4ea47454a304ea3435284c><i class="fa-solid fa-angle-right" id=caret-idf1435defde4ea47454a304ea3435284c></i></a></div><ul class="nav docs-sidenav collapse" id=idf1435defde4ea47454a304ea3435284c><li class="child level"><a href=/books/concurrent-notes/01.%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E5%8D%95%E5%85%83/%E7%BA%BF%E7%A8%8B/%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/01.%E7%94%A8%E6%88%B7%E6%80%81%E4%B8%8E%E5%86%85%E6%A0%B8%E6%80%81/>01.用户态与内核态</a></li><li class="child level"><a href=/books/concurrent-notes/01.%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E5%8D%95%E5%85%83/%E7%BA%BF%E7%A8%8B/%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/02.%E7%94%A8%E6%88%B7%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%86%85%E6%A0%B8%E7%BA%BF%E7%A8%8B/>02.用户线程与内核线程</a></li><li class="child level"><a href=/books/concurrent-notes/01.%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E5%8D%95%E5%85%83/%E7%BA%BF%E7%A8%8B/%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/03.%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/>03.线程模型</a></li></ul></div></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id18b80dbb88c1dc208dc74659dc2a984d")' href=#id18b80dbb88c1dc208dc74659dc2a984d aria-expanded=false aria-controls=id18b80dbb88c1dc208dc74659dc2a984d aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/concurrent-notes/01.%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E5%8D%95%E5%85%83/%E5%8D%8F%E7%A8%8B/>协程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id18b80dbb88c1dc208dc74659dc2a984d aria-expanded=false aria-controls=id18b80dbb88c1dc208dc74659dc2a984d><i class="fa-solid fa-angle-right" id=caret-id18b80dbb88c1dc208dc74659dc2a984d></i></a></div><ul class="nav docs-sidenav collapse" id=id18b80dbb88c1dc208dc74659dc2a984d><li class="child level"><a href=/books/concurrent-notes/01.%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E5%8D%95%E5%85%83/%E5%8D%8F%E7%A8%8B/%E5%8D%8F%E7%A8%8B/>协程</a></li></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#process-hierarchy>Process Hierarchy</a></li><li><a href=#文件描述符file-descriptors>文件描述符（File Descriptors）</a></li><li><a href=#registers>Registers</a></li><li><a href=#内核状态kernel-state>内核状态（Kernel State）</a></li></ul><ul><li><a href=#the-stack>The Stack</a></li><li><a href=#the-heap>The Heap</a></li><li><a href=#内存布局>内存布局</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>进程模型</h1><div class=article-style><h1 id=进程模型>进程模型</h1><h1 id=process-elements>Process Elements</h1><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://s2.ax1x.com/2020/01/27/1nf0Cd.png alt="The Elements of a Process" loading=lazy data-zoomable></div></div></figure></p><p>进程 ID（或 PID）由操作系统分配，并且对于每个正在运行的进程都是唯一的。</p><h2 id=process-hierarchy>Process Hierarchy</h2><p>尽管操作系统可以同时运行多个进程，但实际上它只能直接启动一个称为 init（初始缩写）进程的进程。这不是一个特别特殊的过程，除了它的 PID 始终为 0 并且将一直运行。所有其他过程都可以视为此初始过程的子过程。进程与其他进程一样都有一棵家谱。每个进程都有一个父进程，并且可以有许多同级，它们是同一父进程创建的进程。当然，子进程可以创造更多的子进程，依此类推。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps data-lang=ps><span class=line><span class=cl><span class=mf>1</span> <span class=nf>init-+-apmd</span>
</span></span><span class=line><span class=cl>        <span class=nf>|-atd</span>
</span></span><span class=line><span class=cl>        <span class=nf>|-cron</span>
</span></span><span class=line><span class=cl>        <span class=nf>...</span>
</span></span><span class=line><span class=cl><span class=mf>5</span>      <span class=nf>|-dhclient</span>
</span></span><span class=line><span class=cl>        <span class=nf>|-firefox-bin-+-firefox-bin---2*</span><span class=p>[</span><span class=nf>firefox-bin</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>|</span>             <span class=nf>|-java_vm---java_vm---13*</span><span class=p>[</span><span class=nf>java_vm</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>|</span>             <span class=nf>`-swf_play</span>
</span></span></code></pre></div><h2 id=文件描述符file-descriptors>文件描述符（File Descriptors）</h2><p>我们之前了解了 stdin，stdout 和 stderr；给每个进程的默认文件。您将记住，这些文件始终具有相同的文件描述符号（分别为 0,1,2）。因此，内核为每个进程单独保存文件描述符。文件描述符也具有权限。例如，您可能能够从文件中读取但无法写入文件。打开文件后，操作系统会在文件描述符中保留对该文件的进程权限记录，并且不允许进程执行不应执行的任何操作。</p><h2 id=registers>Registers</h2><p>处理器实际上对寄存器中的值执行一般简单的操作。这些值被读取（或写入）到内存中，每个进程都分配有内核跟踪的内存。</p><p>因此，方程式的另一面是跟踪寄存器。当当前正在运行的进程放弃处理器以便其他进程可以运行时，它需要保存其当前状态。同样，当进程有更多时间在 CPU 上运行时，我们需要能够恢复此状态。为此，操作系统需要将 CPU 寄存器的副本存储到内存中。当该进程再次运行时，操作系统会将寄存器值从内存中复制回 CPU 寄存器中，而该进程将立即从中断处返回。</p><h2 id=内核状态kernel-state>内核状态（Kernel State）</h2><p>在内部，内核需要跟踪每个进程的许多元素。操作系统要跟踪的另一个重要元素是进程状态。如果该进程当前正在运行，则使其处于运行状态是有意义的。但是，如果进程请求从磁盘读取文件，则从内存层次结构中我们知道这可能会花费大量时间。该进程应该放弃其当前执行以允许另一个进程运行，但是内核不必让该进程再次运行，直到磁盘中的数据在内存中可用为止。因此，它可以将进程标记为磁盘等待（或类似），直到数据准备就绪为止。</p><p>一些过程比其他过程更重要，并且具有更高的优先级。请参阅下面有关调度程序的讨论。内核可以保留有关每个进程行为的统计信息，这有助于其决定进程的行为。例如，它主要是从磁盘读取还是主要是 CPU 密集型操作。</p><h1 id=内存memory>内存（Memory）</h1><p>所有程序代码以及变量和任何其他分配的存储都存储在该存储器中。内存的一部分可以在进程之间共享（称为共享内存）。在较早版本的操作系统中执行原始操作后，通常会看到称为系统五共享内存（SysV SHM）的信息。进程可以利用的另一个重要概念是将磁盘上的文件映射到内存。这意味着不必打开文件并使用诸如 <code>read()</code> 和 <code>write()</code> 之类的命令，文件看起来就像是其他任何类型的 RAM。映射区域具有诸如读取，写入和执行之类的权限，需要对其进行跟踪。众所周知，维护安全性和稳定性是操作系统的工作，因此它需要检查进程是否尝试写入只读区域并返回错误。</p><p>一个过程可以进一步分为代码和数据部分。程序代码和数据应分开保存，因为它们需要与操作系统不同的权限，并且分开可以促进代码共享（如您稍后所见）。操作系统需要授予程序代码读取和执行的权限，但通常不予写入。另一方面，数据（变量）需要读写权限，但不能执行。</p><h2 id=the-stack>The Stack</h2><p>进程的另一个非常重要的部分是称为栈的内存区域。这可以视为流程数据部分的一部分，并且与任何程序的执行都密切相关。栈是通用的数据结构，其工作方式与一堆板块完全相同。您可以推动一个元素（将一个元素放在一叠元素的顶部），然后成为顶部元素，或者您可以弹出一个元素（取下元素，露出前一个元素）。</p><p>栈是函数调用的基础。每次调用一个函数都会得到一个新的栈框架。这是一个内存区域，通常至少包含完成后要返回的地址，函数的输入参数和局部变量的空间。按照惯例，栈通常会变小。这意味着栈从内存中的高地址开始，然后逐渐降低。</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://s2.ax1x.com/2020/01/27/1nzrDS.png alt="The Stack" loading=lazy data-zoomable></div></div></figure></p><p>我们可以看到拥有栈如何带来函数的许多功能：</p><ul><li><p>每个函数都有其输入参数的副本。这是因为为每个函数分配了一个新的栈帧，其参数位于新的内存区域中。</p></li><li><p>这就是为什么在函数内部定义的变量无法被其他函数看到的原因。全局变量（可以通过任何函数看到）都保存在数据存储器的单独区域中。</p></li><li><p>这有助于递归调用。这意味着一个函数可以自由地再次调用自身，因为将为其所有局部变量创建一个新的栈框架。</p></li><li><p>每个帧都包含要返回的地址。C 仅允许从函数返回单个值，因此按照惯例，该值将在指定的寄存器中而不是栈中返回给调用函数。</p></li><li><p>由于每一帧都引用了它之前的那一帧，因此调试器可以向后“遍历”指针，跟随指针到达栈。由此可以生成栈跟踪，该跟踪向您显示调用该函数的所有函数。这对于调试非常有用。</p></li><li><p>您可以看到函数的工作方式完全适合栈的性质。任何函数都可以调用任何其他函数，然后成为其他函数（放在栈顶）。最终，该函数将返回到调用它的函数（将自身移出栈）。</p></li><li><p>栈的确会使调用函数变慢，因为必须将值移出寄存器并移入内存。有些体系结构允许参数直接在寄存器中传递。但是，为了保持每个函数获得每个参数的唯一副本的语义，寄存器必须旋转。</p></li><li><p>您可能听说过术语栈溢出。这是通过传递伪造的值来入侵系统的一种常见方法。如果您是程序员，则可以接受对栈变量的任意输入（例如，从键盘或通过网络读取），则需要明确说明数据的大小。允许不检查任何数量的数据将仅覆盖内存。通常，这会导致崩溃，但是有些人意识到，如果函数写满了足以在栈帧的返回地址部分中放置特定值的内存，则函数完成时将返回而不是返回正确的位置（从），他们可以使其返回到刚发送的数据中。如果该数据包含会破坏系统的二进制可执行代码（例如，以 root 权限为用户启动终端），则说明您的计算机已受到威胁。发生这种情况是因为栈向下增长，但是数据是“向上”读取的（即从较低地址到较高地址）。有几种解决方法：首先，作为程序员，您必须确保始终检查要接收到的数据量。操作系统可以通过确保栈被标记为不可执行来帮助程序员避免这种情况。也就是说，即使恶意用户试图将某些代码传递到您的程序中，处理器也不会运行任何代码。现代体系结构和操作系统支持此功能。</p></li><li><p>栈最终由编译器管理，因为它负责生成程序代码。对于操作系统来说，栈就像该进程的任何其他内存区域一样。</p></li></ul><p>为了跟踪栈的当前增长，硬件将寄存器定义为栈指针。编译器（或编程器，在用汇编器编写时）使用该寄存器来跟踪栈的当前顶部。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>  <span class=m>1</span> $ cat sp.c
</span></span><span class=line><span class=cl>    void <span class=k>function</span><span class=o>(</span>void<span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>            int <span class=nv>i</span> <span class=o>=</span> 100<span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=m>5</span>         int <span class=nv>j</span> <span class=o>=</span> 200<span class=p>;</span>
</span></span><span class=line><span class=cl>            int <span class=nv>k</span> <span class=o>=</span> 300<span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    $ gcc -fomit-frame-pointer -S sp.c
</span></span><span class=line><span class=cl> <span class=m>10</span>
</span></span><span class=line><span class=cl>    $ cat sp.s
</span></span><span class=line><span class=cl>            .file   <span class=s2>&#34;sp.c&#34;</span>
</span></span><span class=line><span class=cl>            .text
</span></span><span class=line><span class=cl>    .globl <span class=k>function</span>
</span></span><span class=line><span class=cl> <span class=m>15</span>         .type   <span class=k>function</span>, @function
</span></span><span class=line><span class=cl>    <span class=k>function</span>:
</span></span><span class=line><span class=cl>            subl    <span class=nv>$16</span>, %esp
</span></span><span class=line><span class=cl>            movl    <span class=nv>$100</span>, 4<span class=o>(</span>%esp<span class=o>)</span>
</span></span><span class=line><span class=cl>            movl    <span class=nv>$200</span>, 8<span class=o>(</span>%esp<span class=o>)</span>
</span></span><span class=line><span class=cl> <span class=m>20</span>         movl    <span class=nv>$300</span>, 12<span class=o>(</span>%esp<span class=o>)</span>
</span></span><span class=line><span class=cl>            addl    <span class=nv>$16</span>, %esp
</span></span><span class=line><span class=cl>            ret
</span></span><span class=line><span class=cl>            .size   <span class=k>function</span>, .-function
</span></span><span class=line><span class=cl>            .ident  <span class=s2>&#34;GCC: (GNU) 4.0.2 20050806 (prerelease) (Debian 4.0.1-4)&#34;</span>
</span></span><span class=line><span class=cl> <span class=m>25</span>         .section        .note.GNU-stack,<span class=s2>&#34;&#34;</span>,@progbits
</span></span></code></pre></div><p>上面我们展示了一个在栈上分配三个变量的简单函数。该反汇编说明了在 x86 体系结构上使用栈指针。首先，我们在栈上为局部变量分配一些空间。由于栈变小，我们从栈指针中保存的值中减去。值 16 是一个足以容纳我们的局部变量的值，但可能不完全是所需的大小（例如，对于 3 个 4 字节的 int 值，我们实际上只需要 12 个字节，而不是 16 个）就可以保持内存中栈的对齐 编译器要求的特定边界。</p><p>然后，我们将这些值移动到栈存储器中（并在实函数中使用它们）。最后，在返回父函数之前，我们通过将栈指针移回开始之前的位置来“弹出”栈中的值。</p><h2 id=the-heap>The Heap</h2><p>堆是由进程管理的用于动态分配内存的内存区域。这适用于在编译时不知道其内存要求的变量。堆的底部称为 brk，因此被称为对其进行修改的系统调用。通过使用 brk 调用向下扩展区域，进程可以请求内核分配更多的内存供其使用。</p><p>堆通常由 malloc 库调用管理。通过允许程序员简单地分配和释放（通过 free 调用）堆内存，这使程序员易于管理堆。malloc 可以使用诸如伙伴分配器之类的方案来管理用户的堆内存。malloc 在分配方面也可以更聪明，并且可以使用匿名 mmap 来获得额外的进程内存。在这里，不是将文件映射到进程内存，而是直接映射系统 RAM 的区域。这样可以更有效。由于正确管理内存的复杂性，对于任何现代程序来说，都有理由直接调用 brk 是非常罕见的。</p><h2 id=内存布局>内存布局</h2><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://s2.ax1x.com/2020/01/27/1nz5uT.png alt="Process memory layout" loading=lazy data-zoomable></div></div></figure></p><p>如我们所见，一个进程分配了较小的内存区域，每个区域都有特定的用途。上面给出了内核如何在内存中安排进程的示例。从顶部开始，内核会在进程的顶部为其自身保留一些内存（我们通过虚拟内存了解如何在所有进程之间实际共享此内存）。在其下方是用于映射文件和库的空间。在堆栈的下面，在堆栈的下面。底部是程序映像，是从磁盘上的可执行文件加载的。在后面的章节中，我们将仔细研究加载数据的过程。</p><h1 id=进程上下文>进程上下文</h1><p>进程是操作系统对一个正在运行的程序的一种抽象，在一个系统上可以同时运行多个进程，而每个进程都好像在独占地使用硬件。所谓的并发运行，则是说一个进程的指令和另一个进程的指令是交错执行的。无论是在单核还是多核系统中，可以通过处理器在进程间切换，来实现单个 CPU 看上去像是在并发地执行多个进程。操作系统实现这种交错执行的机制称为上下文切换。</p><p>操作系统保持跟踪进程运行所需的所有状态信息。这种状态，也就是上下文，它包括许多信息，例如 PC 和寄存器文件的当前值，以及主存的内容。在任何一个时刻，单处理器系统都只能执行一个进程的代码。当操作系统决定要把控制权从当前进程转移到某个新进程时，就会进行上下文切换，即保存当前进程的上下文、恢复新进程的上下文，然后将控制权传递到新进程。新进程就会从上次停止的地方开始。</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://user-images.githubusercontent.com/5803001/52271382-6fcf8580-297e-11e9-9161-de3d9461d5f4.png alt=image loading=lazy data-zoomable></div></div></figure></p><p>在《<a href="https://github.com/wx-chevalier/Linux-Series?q=" target=_blank rel=noopener>Linux-Series/虚拟存储管理器</a>》一节中，我们介绍过它为每个进程提供了一个假象，即每个进程都在独占地使用主存。每个进程看到的是一致的存储器，称为虚拟地址空间。其虚拟地址空间最上面的区域是为操作系统中的代码和数据保留的，这对所有进程来说都是一样的；地址空间的底部区域存放用户进程定义的代码和数据。</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://user-images.githubusercontent.com/5803001/52272019-52032000-2980-11e9-953c-89de286e5174.png alt=image loading=lazy data-zoomable></div></div></figure></p><ul><li><p>程序代码和数据，对于所有的进程来说，代码是从同一固定地址开始，直接按照可执行目标文件的内容初始化。</p></li><li><p>堆，代码和数据区后紧随着的是运行时堆。代码和数据区是在进程一开始运行时就被规定了大小，与此不同，当调用如 malloc 和 free 这样的 C 标准库函数时，堆可以在运行时动态地扩展和收缩。</p></li><li><p>共享库：大约在地址空间的中间部分是一块用来存放像 C 标准库和数学库这样共享库的代码和数据的区域。</p></li><li><p>栈，位于用户虚拟地址空间顶部的是用户栈，编译器用它来实现函数调用。和堆一样，用户栈在程序执行期间可以动态地扩展和收缩。</p></li><li><p>内核虚拟存储器：内核总是驻留在内存中，是操作系统的一部分。地址空间顶部的区域是为内核保留的，不允许应用程序读写这个区域的内容或者直接调用内核代码定义的函数。</p></li></ul></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>上一页</div><a href=/books/concurrent-notes/01.%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E5%8D%95%E5%85%83/%E8%BF%9B%E7%A8%8B/%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/ rel=next>进程间通信</a></div><div class="col-6 post-nav-item"><div class=meta-nav>下一页</div><a href=/books/concurrent-notes/01.%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E5%8D%95%E5%85%83/%E8%BF%9B%E7%A8%8B/%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81/ rel=prev>进程状态</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div><script type=text/javascript id=clstr_globe async src="//clustrmaps.com/globe.js?d=kgpJG5sWZQpKujBmD-uW1B54-WBPol-DuDtrB2KFjKs"></script></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>