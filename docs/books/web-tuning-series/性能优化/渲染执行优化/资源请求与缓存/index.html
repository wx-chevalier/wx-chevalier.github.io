<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="资源请求与缓存 数据压缩与流式加载 HTTP 缓存 CDN HTTP/2 服务端推送 使用 HTTPS 安全传输 Font | 字体 Custom Web Fonts 我们首先回顾下浏览器是如何使用自定义字体的，当浏览器识别到用户在 CSS 中基于@font-size定义的字体时，会尝试下载该字"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E6%B8%B2%E6%9F%93%E6%89%A7%E8%A1%8C%E4%BC%98%E5%8C%96/%E8%B5%84%E6%BA%90%E8%AF%B7%E6%B1%82%E4%B8%8E%E7%BC%93%E5%AD%98/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E6%B8%B2%E6%9F%93%E6%89%A7%E8%A1%8C%E4%BC%98%E5%8C%96/%E8%B5%84%E6%BA%90%E8%AF%B7%E6%B1%82%E4%B8%8E%E7%BC%93%E5%AD%98/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E6%B8%B2%E6%9F%93%E6%89%A7%E8%A1%8C%E4%BC%98%E5%8C%96/%E8%B5%84%E6%BA%90%E8%AF%B7%E6%B1%82%E4%B8%8E%E7%BC%93%E5%AD%98/"><meta property="og:title" content="资源请求与缓存 | Next-gen Tech Edu"><meta property="og:description" content="资源请求与缓存 数据压缩与流式加载 HTTP 缓存 CDN HTTP/2 服务端推送 使用 HTTPS 安全传输 Font | 字体 Custom Web Fonts 我们首先回顾下浏览器是如何使用自定义字体的，当浏览器识别到用户在 CSS 中基于@font-size定义的字体时，会尝试下载该字"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>资源请求与缓存 | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=729b4813e212bb8b73578b122eb27d7c><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">渲染执行优化</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id728c4515c5ef521444bbdf5476fdce86")' href=#id728c4515c5ef521444bbdf5476fdce86 aria-expanded=false aria-controls=id728c4515c5ef521444bbdf5476fdce86 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/>性能优化</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id728c4515c5ef521444bbdf5476fdce86 aria-expanded=false aria-controls=id728c4515c5ef521444bbdf5476fdce86><i class="fa-solid fa-angle-down" id=caret-id728c4515c5ef521444bbdf5476fdce86></i></a></div><ul class="nav docs-sidenav collapse show" id=id728c4515c5ef521444bbdf5476fdce86><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id26746541e80a742cd5cc44388d9ac168")' href=#id26746541e80a742cd5cc44388d9ac168 aria-expanded=false aria-controls=id26746541e80a742cd5cc44388d9ac168 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96/>内存优化</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id26746541e80a742cd5cc44388d9ac168 aria-expanded=false aria-controls=id26746541e80a742cd5cc44388d9ac168><i class="fa-solid fa-angle-right" id=caret-id26746541e80a742cd5cc44388d9ac168></i></a></div><ul class="nav docs-sidenav collapse" id=id26746541e80a742cd5cc44388d9ac168><li class="child level"><a href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96/%E5%86%85%E5%AD%98%E4%BD%BF%E7%94%A8%E5%88%86%E6%9E%90/>内存使用分析</a></li><li class="child level"><a href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96/%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2%E4%BC%98%E5%8C%96/>内存泄露优化</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id3ea1d54efc841b109f6856aa0c4873ac")' href=#id3ea1d54efc841b109f6856aa0c4873ac aria-expanded=false aria-controls=id3ea1d54efc841b109f6856aa0c4873ac aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E5%9B%BE%E7%89%87%E4%BC%98%E5%8C%96/>图片优化</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id3ea1d54efc841b109f6856aa0c4873ac aria-expanded=false aria-controls=id3ea1d54efc841b109f6856aa0c4873ac><i class="fa-solid fa-angle-right" id=caret-id3ea1d54efc841b109f6856aa0c4873ac></i></a></div><ul class="nav docs-sidenav collapse" id=id3ea1d54efc841b109f6856aa0c4873ac><li class="child level"><a href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E5%9B%BE%E7%89%87%E4%BC%98%E5%8C%96/webp/>Webp</a></li><li class="child level"><a href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E5%9B%BE%E7%89%87%E4%BC%98%E5%8C%96/%E8%A7%86%E9%A2%91%E4%BC%98%E5%8C%96/>视频优化</a></li><li class="child level"><a href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E5%9B%BE%E7%89%87%E4%BC%98%E5%8C%96/%E5%9B%BE%E7%89%87%E6%A0%BC%E5%BC%8F%E4%B8%8E%E8%BD%AC%E6%8D%A2/>图片格式与转换</a></li><li class="child level"><a href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E5%9B%BE%E7%89%87%E4%BC%98%E5%8C%96/%E5%9B%BE%E7%89%87%E5%8E%8B%E7%BC%A9/>图片压缩</a></li><li class="child level"><a href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E5%9B%BE%E7%89%87%E4%BC%98%E5%8C%96/%E5%9B%BE%E7%89%87%E4%BC%98%E5%8C%96/>图片优化</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idaa328e731572f27878db0c5fd0fdd077")' href=#idaa328e731572f27878db0c5fd0fdd077 aria-expanded=false aria-controls=idaa328e731572f27878db0c5fd0fdd077 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E6%B8%B2%E6%9F%93%E6%89%A7%E8%A1%8C%E4%BC%98%E5%8C%96/>渲染执行优化</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idaa328e731572f27878db0c5fd0fdd077 aria-expanded=false aria-controls=idaa328e731572f27878db0c5fd0fdd077><i class="fa-solid fa-angle-down" id=caret-idaa328e731572f27878db0c5fd0fdd077></i></a></div><ul class="nav docs-sidenav collapse show" id=idaa328e731572f27878db0c5fd0fdd077><li class="child level"><a href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E6%B8%B2%E6%9F%93%E6%89%A7%E8%A1%8C%E4%BC%98%E5%8C%96/%E5%B8%83%E5%B1%80%E4%B8%8E%E6%B8%B2%E6%9F%93%E7%AD%96%E7%95%A5/>布局与渲染策略</a></li><li class="child level"><a href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E6%B8%B2%E6%9F%93%E6%89%A7%E8%A1%8C%E4%BC%98%E5%8C%96/%E4%BA%A4%E4%BA%92%E4%B8%8E%E5%8A%A8%E7%94%BB/>交互与动画</a></li><li class="child level"><a href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E6%B8%B2%E6%9F%93%E6%89%A7%E8%A1%8C%E4%BC%98%E5%8C%96/%E8%84%9A%E6%9C%AC%E8%A7%A3%E6%9E%90%E4%B8%8E%E6%89%A7%E8%A1%8C/>脚本解析与执行</a></li><li class="child level"><a href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E6%B8%B2%E6%9F%93%E6%89%A7%E8%A1%8C%E4%BC%98%E5%8C%96/%E6%B8%B2%E6%9F%93%E7%AD%96%E7%95%A5/>渲染策略</a></li><li class="child level active"><a href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E6%B8%B2%E6%9F%93%E6%89%A7%E8%A1%8C%E4%BC%98%E5%8C%96/%E8%B5%84%E6%BA%90%E8%AF%B7%E6%B1%82%E4%B8%8E%E7%BC%93%E5%AD%98/>资源请求与缓存</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idf9043200cf4c4ff310fa91491393d457")' href=#idf9043200cf4c4ff310fa91491393d457 aria-expanded=false aria-controls=idf9043200cf4c4ff310fa91491393d457 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E4%BC%98%E5%8C%96/>资源加载优化</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idf9043200cf4c4ff310fa91491393d457 aria-expanded=false aria-controls=idf9043200cf4c4ff310fa91491393d457><i class="fa-solid fa-angle-right" id=caret-idf9043200cf4c4ff310fa91491393d457></i></a></div><ul class="nav docs-sidenav collapse" id=idf9043200cf4c4ff310fa91491393d457><li class="child level"><a href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E4%BC%98%E5%8C%96/%E5%85%B3%E9%94%AE%E6%B8%B2%E6%9F%93%E8%B7%AF%E5%BE%84/>关键渲染路径</a></li><li class="child level"><a href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E4%BC%98%E5%8C%96/%E6%87%92%E5%8A%A0%E8%BD%BD/>懒加载</a></li><li class="child level"><a href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E4%BC%98%E5%8C%96/%E8%AE%BE%E8%AE%A1%E4%BC%98%E5%8C%96/>设计优化</a></li><li class="child level"><a href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E4%BC%98%E5%8C%96/%E9%A2%84%E5%8A%A0%E8%BD%BD/>预加载</a></li><li class="child level"><a href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E4%BC%98%E5%8C%96/%E5%AD%97%E4%BD%93%E4%BC%98%E5%8C%96/>字体优化</a></li></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#cdn>CDN</a></li></ul><ul><li><a href=#custom-web-fonts>Custom Web Fonts</a></li></ul><ul><li><a href=#configuration>Configuration</a></li><li><a href=#https>HTTPS</a></li><li><a href=#cookies>Cookies</a></li><li><a href=#file-level-caching>File Level Caching</a></li></ul><ul><li><a href=#roadmap>Roadmap</a><ul><li></li></ul></li></ul><ul><li><a href=#webp>WebP</a></li></ul><ul><li><a href=#多域名资源存放>多域名资源存放</a></li><li><a href=#static-content网站静态化>Static Content:网站静态化</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>资源请求与缓存</h1><div class=article-style><h1 id=资源请求与缓存>资源请求与缓存</h1><h1 id=数据压缩与流式加载>数据压缩与流式加载</h1><h1 id=http-缓存>HTTP 缓存</h1><h2 id=cdn>CDN</h2><h1 id=http2-服务端推送>HTTP/2 服务端推送</h1><h1 id=使用-https-安全传输>使用 HTTPS 安全传输</h1><h1 id=font--字体>Font | 字体</h1><h2 id=custom-web-fonts>Custom Web Fonts</h2><p>我们首先回顾下浏览器是如何使用自定义字体的，当浏览器识别到用户在 CSS 中基于<code>@font-size</code>定义的字体时，会尝试下载该字体文件。而在下载的过程中，浏览器是不会展示该字体所属的文本内容，最终导致了所谓的<code>Flash of Invisible Text</code>现象。现在很多的网站都存在这个问题，这也是导致用户体验差的一个重要原因，即会影响用户最主要的内容浏览这一操作。而我们的优化点即在于首先将字体设置为默认字体，而后在自定义的 Web Font 下载完毕之后对标准字体再进行替换操作，并且重新渲染整个文本块。而如果自定义的字体下载失败，整个内容还是能保证基本的可读性，不会对用户体验造成毁灭性的打击。<figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://cdn.css-tricks.com/wp-content/uploads/2016/08/voorhoede-fonts.jpg alt loading=lazy data-zoomable></div></div></figure></p><p>首先，我们会为需要使用到的 Web Fonts 创建最小子集，即只将那些需要使用的字体提取出来，而并不需要让用户下载整个字体集，这里推荐使用<a href=https://www.fontsquirrel.com/tools/webfont-generator target=_blank rel=noopener>Font squirrel webfont generator</a>。另外，我们还需要为字体的下载设置监视器，即保证能够在字体下载完毕之后自动回调，这里我们使用的是<a href=https://github.com/bramstein/fontfaceobserver target=_blank rel=noopener>fontfaceobserver</a>，它会为页面自动创建一个监视器，在侦测到所有的自定义 Web Fonts 下载完毕后，会为整个页面添加默认的类名:</p><pre tabindex=0><code>html {font-family: Georgia, serif;}
html.fonts-loaded {font-family: Noto, Georgia, serif;}
</code></pre><p>不过现在 CSS 的<code>font-display</code>属性也原生提供了我们这种替换功能，更多详情可见<a href=https://developers.google.com/web/updates/2016/02/font-display target=_blank rel=noopener>font-display</a>属性。</p><h1 id=服务端与缓存>服务端与缓存</h1><p>高性能的前端离不开服务端的支持，在我们的实践中也发现不同的服务端配置同样会影响到前端的性能。目前我们主要使用 Apache Web Server 作为中间件，并且通过 HTTPS 来安全地传递内容。</p><h2 id=configuration>Configuration</h2><p>我们首先对于合适的服务端配置做了些调研，这里推荐是使用<a href=https://github.com/h5bp/server-configs-apache target=_blank rel=noopener>H5BP Boilerplate Apache Configuration</a>作为配置模板，它是个不错的兼顾了性能与安全性的配置建议。同样地它也提供了面向其他服务端环境的配置。我们对于大部分的 HTML、CSS 以及 JavaScript 都开启了 GZip 压缩选项，并且对于大部分的资源都设置了缓存策略，详见下文的 File Level Caching 章节。</p><h2 id=https>HTTPS</h2><p>使用 HTTPS 可以保证站点的安全性，但是也会影响到你网站的性能表现，性能损耗主要发生在建立 SSL 握手协议的时候，这会导致很多的延迟，不过我们同样可以通过某些设置来进行优化。</p><ul><li>设置 HTTP Strict Transport Security 请求头可以让服务端告诉浏览器其只允许通过 HTTPS 进行交互，这就避免了浏览器从 HTTP 再重定向到 HTTPS 的时间消耗。</li><li>设置 TLS false start 允许客户端在第一轮 TLS 中就能够立刻传递加密数据。握手协议余下的操作，譬如确认没有人进行中间人监听可以同步进行，这一点也能节约部分时间。</li><li>设置 TLS Session Resumption，当浏览器与服务端曾经通过 TLS 进行过通信，那么浏览器会自动记录下 Session Identifier，当下次需要重新建立连接的时候，其可以复用该 Identifier，从而解决了一轮的时间。</li></ul><p>这里推荐扩展阅读下<a href="https://www.youtube.com/watch?v=YMfW1bfyGSY" target=_blank rel=noopener>Mythbusting HTTPS: Squashing security’s urban legends by Emily Stark</a>。</p><h2 id=cookies>Cookies</h2><p>我们并没有使用某个服务端框架，而是直接使用了静态的 Apache Web Server，不过 Apache Web Server 也是能够读取 Cookie 并且进行些简单的操作。譬如在下面这个例子中我们将 CSS 缓存信息存放在了 Cookie 中，然后交付 Apache 进行判断是否需要重复加载 CSS 文件:</p><pre tabindex=0><code>&lt;!-- #if expr=&#34;($HTTP_COOKIE!=/css-loaded/) || ($HTTP_COOKIE=/.*css-loaded=([^;]+);?.*/ &amp;&amp; ${1} != &#39;0d82f.css&#39; )&#34;--&gt;

&lt;noscript&gt;&lt;link rel=&#34;stylesheet&#34; href=&#34;0d82f.css&#34;&gt;&lt;/noscript&gt;
&lt;script&gt;
(function() {
  function loadCSS(url) {...}
  function onloadCSS(stylesheet, callback) {...}
  function setCookie(name, value, expInDays) {...}

  var stylesheet = loadCSS(&#39;0d82f.css&#39;);
  onloadCSS(stylesheet, function() {
    setCookie(&#39;css-loaded&#39;, &#39;0d82f&#39;, 100);
  });
}());
&lt;/script&gt;

&lt;style&gt;/* Critical CSS here */&lt;/style&gt;

&lt;!-- #else --&gt;
&lt;link rel=&#34;stylesheet&#34; href=&#34;0d82f.css&#34;&gt;
&lt;!-- #endif --&gt;
</code></pre><p>这里 Apache Server 中的逻辑控制代码就是有点类似于注释形式的<code>&lt;!-- #</code>，其主要包含以下步骤:</p><ul><li><code>$HTTP_COOKIE!=/css-loaded/</code> 检测是否有设置过 CSS 缓存相关的 Cookie</li><li><code>$HTTP_COOKIE=/.*css-loaded=([^;]+);?.*/ && ${1} != '0d82f.css'</code>检测缓存的 CSS 版本是否为当前版本</li><li>If <code>&lt;!-- #if expr="..." --></code> 值为<code>true</code> 我们便能假设该用户是第一次访问该站点</li><li>如果用户是首次浏览，我们添加了一个<code>&lt;noscript></code>标签，里面还包含了一个阻塞型的<code>&lt;link rel="stylesheet"></code>标签。添加该标签的意义在于我们在下面是使用 JavaScript 来异步加载 CSS 文件，而在用户禁止 JavaScript 的情况下也能保证可以通过该标签来正常加载 CSS 文件。</li><li><code>&lt;!-- #else --></code> 表达式在用户二次访问该页面时，我们可以认为 CSS 文件已经被加载过了，因此可以直接从本地缓存中加载而不需要重复请求。</li></ul><p>上述策略同样可以应用于 Web Fonts 的加载，最终的 Cookie 如下所示:<figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://cdn.css-tricks.com/wp-content/uploads/2016/08/voorhoede-cookies.jpg alt loading=lazy data-zoomable></div></div></figure></p><h2 id=file-level-caching>File Level Caching</h2><p>在上文可以发现，我们严重依赖于浏览器缓存来处理用户重复访问时资源加载的问题，理想情况下我们肯定希望能够永久地缓存 CSS、JS、Fonts 以及图片文件，然后在某个文件发生变化的时候将缓存设置为失效。这里我们设置了以<code>https://www.voorhoede.nl/assets/css/main.css?v=1.0.4</code>形式，即在请求路径上加上版本号的方式进行缓存。不过这种方式的缺陷在于如果我们更换了资源文件的存放地址，那么所有的缓存也就自然失效了。这里我们使用了<a href=https://github.com/sindresorhus/gulp-rev target=_blank rel=noopener>gulp-rev</a>以及<a href=https://github.com/jamesknelson/gulp-rev-replace target=_blank rel=noopener>gulp-rev-replace</a>来为文件添加 Hash 值，从而保证了仅当文件内容发生变化的时候文件请求路径才会发生改变，即将每个文件的缓存验证独立开来。</p><h1 id=result>Result</h1><p>上面我们介绍了很多的优化手段，这里我们以实验的形式来对优化的结果与效果进行分析。我们可以用类似于<a href=https://developers.google.com/speed/pagespeed/insights/ target=_blank rel=noopener>PageSpeed Insights</a>或者<a href=http://www.webpagetest.org/ target=_blank rel=noopener>WebPagetest</a>来进行性能测试或者网络分析。我觉得最好的测试你站点渲染性能的方式就是在限流的情况下观察页面的呈现效果，Google Chrome 内置了限流的功能：<figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://cdn.css-tricks.com/wp-content/uploads/2016/08/voorhoede-network-analysis.jpg alt loading=lazy data-zoomable></div></div></figure>这里我们将我们的网络环境设置为了 50KB/S 的 GPRS 网络环境，我们总共花费了 2.27 秒完成了首屏渲染。上图中黄线左侧的时间即指明了从 HTML 文件开始下载到下载完成所耗费的时间，该 HTML 文件中已经包含了关键的 CSS 代码，因此整个页面已经保证了基本的可用性与可交互型。而剩下的比较大的资源都会进行延时加载，这正是我们想要达到的目标。我们也可以使用 PageSpeed 来测试下网站的性能，可以看出我们得分很不错:<figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://cdn.css-tricks.com/wp-content/uploads/2016/08/pagespeed-insights-voorhoede.jpg alt loading=lazy data-zoomable></div></div></figure>而在 WebPagetest 中，我们看出了如下的结果:<figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://cdn.css-tricks.com/wp-content/uploads/2016/08/webpagetest-voorhoede.jpg alt loading=lazy data-zoomable></div></div></figure></p><h2 id=roadmap>Roadmap</h2><p>优化之路漫漫，永无止境，我们在未来也会关注以下几个方面：</p><ul><li>HTTP/2:我们目前已经开始尝试使用 HTTP/2，而本篇文章中提到的很多的优化的要点都是面向 HTTP/1.1 的。简言之，HTTP/1.1 诞生之初还是处于 Table 布局与行内样式流行的时代，它并没有考虑到现在所面对的 2.6MB 大小，包含 200 多个网络请求的页面。为了弥合这老的协议的缺陷，我们不得不连接 JS 与 CSS 文件、使用行内样式、对于小图片使用 Data URL 等等。这些操作都是为了节约请求次数，而 HTTP/2 中允许在同一个 TCP 请求中进行多个并发的请求，这样就会允许我们不需要再去进行大量的文件合并操作。</li><li>Service Workers:这是现代浏览器提供的后台工作线程，可以允许我们为网站添加譬如离线支持、推送消息、后台同步等等很多复杂的操作。</li><li>CDN:目前我们是自己维护网站，而在真实的应用场景下可以考虑使用 CDN 服务来减少服务端与客户端之间的物理距离，从而减少传输时延。</li></ul><ol><li>最多三秒钟渲染完成单屏或者使用 Loading</li><li>基于 3G/4G 移动网络下，每屏幕资源不超过 1024KB</li></ol><h6 id=加载优化>加载优化</h6><ul><li>合并 CSS、JavaScript</li><li>合并小图片、使用雪碧图</li><li>缓存一切可以缓存的资源，部分资源 css、js 使用<code>src="abc.css?cacheVersion=1"</code>来控制版本</li><li>使用长 Cache</li><li>压缩 HTML、CSS、JS</li><li>启用<code>GZip</code></li><li>使用首屏加载</li></ul><ul><li>使用按需加载</li><li>使用滚屏加载</li><li>增加进度指示器</li><li>减少<code>Cookie</code></li><li>避免重定向</li><li>异步加载第三方资源</li></ul><h6 id=css-优化>CSS 优化</h6><ul><li>CSS 写在头部，JS 写到尾部或者异步</li><li>避免图片和<code>iFrame</code>等的 SRC 为空</li><li>尽量避免重设图片大小</li><li>图片尽量避免使用<code>DataURL</code></li><li>尽量避免在 HTML 标签中写 Style</li><li>避免 CSS 表达式</li><li>移除空的 CSS 规则</li><li>正确使用 Display 的属性</li><li>不滥用<code>Float</code></li><li>不滥用 Web 字体</li><li>不声明过多的<code>Font-size</code></li><li>值为 0 时候不需要任何单位</li><li>标准化各种浏览器的前缀</li><li>避免让选择符看起来像正则表达式</li></ul><h6 id=图片优化>图片优化</h6><ul><li>使用 <code>CSS3、SVG、IconFont</code>代替图片</li><li>使用 Srcset</li><li>WebP 优于 JPG</li><li>PNG8 优于 GIF</li><li>首次加载不大于 1024KB 单页</li><li>图片不宽于 640</li></ul><h6 id=脚本优化>脚本优化</h6><ul><li>减少重绘</li><li>缓存 Dom 选择与计算</li><li>缓存列表的长度</li><li>尽量使用事件代理，避免批量绑定事件</li><li>尽量使用 ID 选择器</li><li>使用 touch 代理 click</li></ul><h6 id=渲染优化>渲染优化</h6><ul><li>HTML 使用 ViewPort</li><li>减少 Dom 节点</li><li>尽量使用 CSS3 动画</li><li>合理使用<code>requestAnimationFrame</code>动画代替 setTimeout</li><li>适当使用 Canvas 动画</li><li><code>touchmove，scroll</code>事件会导致多次渲染</li><li>使用 <code>CSS3-transitions、CSS3-3D、Opacity、Canvas、WebGL、Video</code>来触发 GPU 渲染</li></ul><blockquote><p>本文从属于笔者的<a href=https://github.com/wx-chevalier/web-frontend-practice-handbook target=_blank rel=noopener>Web 前端入门与最佳实践</a>中<a href=https://github.com/wx-chevalier/web-frontend-practice-handbook#optimization%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96 target=_blank rel=noopener>前端性能优化</a>系列，同时也归纳于笔者的<a href=https://github.com/wx-chevalier/Coder-Knowledge-Graph/blob/master/interview/my-frontend-backend-interview.md target=_blank rel=noopener>我的校招准备之路:从 Web 前端到服务端应用架构</a>这篇综述。</p></blockquote><p>前端优化的根本目的是为了有一个更好地用户体验的同时尽可能减少后端负载压力。即保证更少的加载时间、更快的首屏渲染、更流畅的用户交互。在笔者自己的知识体系内，当我们想为用户呈现更好的视觉效果与用户体验时，我们往往会从<a href=https://github.com/wx-chevalier/web-frontend-practice-handbook/blob/master/advanced/Optimization/FrontendOptimization-Benchmark.md target=_blank rel=noopener>性能评测与监控</a>、<a href=https://github.com/wx-chevalier/web-frontend-practice-handbook/blob/master/advanced/Optimization/FrontendOptimization-Resource-Request.md target=_blank rel=noopener>资源与请求优化</a>、<a href=https://github.com/wx-chevalier/web-frontend-practice-handbook/blob/master/advanced/Optimization/FrontendOptimization-Load.md target=_blank rel=noopener>加载策略</a>、<a href=https://github.com/wx-chevalier/web-frontend-practice-handbook/blob/master/advanced/Optimization/FrontendOptimization-HomePage-CriticalPath.md target=_blank rel=noopener>首页与关键路径</a>、<a href=https://github.com/wx-chevalier/web-frontend-practice-handbook/blob/master/advanced/Optimization/FrontendOptimization-Render.md target=_blank rel=noopener>渲染优化</a>这几个方面进行考虑。</p><ul><li><a href=https://segmentfault.com/a/1190000002884052 target=_blank rel=noopener>让 web app 更快的 HTML5 最佳实践</a></li><li><a href=http://www.cnblogs.com/zichi/p/4713031.html target=_blank rel=noopener>高性能 JavaScript DOM 编程</a></li><li><a href=http://www.helloweba.com/view-blog-369.html target=_blank rel=noopener>移动 Web 开发规范摘录</a></li><li><a href="http://mp.weixin.qq.com/s?__biz=MjM5MTA1MjAxMQ==&mid=2651221573&idx=1&sn=776c6188071f571455e98d98e30f2fac&scene=0#wechat_redirect" target=_blank rel=noopener>百度移动端首页前端速度那些事儿</a></li><li><a href=https://aotu.io/notes/2016/04/12/jcloud-opt/ target=_blank rel=noopener>京东凹凸实验室:前端优化实践总结</a></li><li><a href="https://developers.google.com/web/fundamentals/performance/?hl=zh-cn" target=_blank rel=noopener>Google Developers：优化性能</a></li></ul><h1 id=编码与压缩>编码与压缩</h1><h1 id=image-optimization图片使用与显示优化>Image Optimization:图片使用与显示优化</h1><ul><li><a href=https://zhuanlan.zhihu.com/p/24315362 target=_blank rel=noopener>前端图片引入方式神演算</a></li><li><a href=http://www.creativebloq.com/features/10-ways-to-optimise-images-for-better-performance target=_blank rel=noopener>http://www.creativebloq.com/features/10-ways-to-optimise-images-for-better-performance</a></li><li><a href=https://medium.freecodecamp.com/you-need-to-stop-making-these-6-mistakes-with-your-img-s-e242c02d14be#.rc8caa9fp target=_blank rel=noopener>you-need-to-stop-making-these-6-mistakes-with-your-img-s</a></li><li><a href=https://css-tricks.com/responsive-images-css/ target=_blank rel=noopener>responsive-images-css</a></li></ul><h2 id=webp>WebP</h2><ul><li><a href=https://segmentfault.com/a/1190000007482148 target=_blank rel=noopener>把网站的图片升级到 WebP 格式吧</a></li></ul><h1 id=http-cache>HTTP Cache</h1><p>静态网站非常简单，它就是通过一个 url 访问 web 服务器上的一个网页，web 服务器接收到请求后在网络上使用 http 协议将网页返回给浏览器，浏览器通过解析 http 协议 最终将页面展示在浏览器里，有时这个网页会比较复杂点，里面包含了一些额外的资源例如：图片、外部的 css 文件、外部的 js 文件以及一些 flash 之类的 多媒体资源，这些资源会单独使用 http 协议把信息返回给浏览器，浏览器从页面里的 src，href、Object 这样的标签将这些资源和页面组合在一 起，最终在浏览器里展示页面。但是不管什么类型的资源，这些资源如果我们不是手动的改变它们，那么我们每次请求获得结果都是一样的。这就说明静态网页的一 个特点：静态网页的资源基本是不会发生变化的。因此我们第一次访问一个静态网页和我们以后访问这个静态网页都是一个重 复的请求，这种网站加载的速度基本都是由网络传输的速度，以及每个资源请求的大小所决定，既然访问的资源基本不会发生变化，那么我们重复请求这些资源，自 己在那里空等不是很浪费时间吗？如是乎，浏览器出现了缓存技术，我们开发时候可以对那些不变的资源在 http 协议上编写相应指令，这些指令会让浏览器第一 次访问到静态资源后缓存起这些静态资源，用户第二次访问这个网页时候就不再需要重复请求了，因为请求资源本地缓存，那么获取它的效率就变得异常高效。</p><h1 id=cdn-1>CDN</h1><h2 id=多域名资源存放>多域名资源存放</h2><ol><li>静态内容和动态内容分服务器存放，使用不同的服务器处理请求。处理动态内容的只处理动态内容，不处理别的，提高效率，这样使得 CDN(内容分发网络)缓存更方便</li></ol><p>2、突破浏览器并发限制 (你随便挑一个 G 家的 url: <a href=https://lh4.googleusercontent.com/- target=_blank rel=noopener>https://lh4.googleusercontent.com/-</a> si4dh2myPWk/T81YkSi__AI/AAAAAAAAQ5o/LlwbBRpp58Q/w497-h373/IMG_20120603_163233.jpg, 把前面的 lh4 换成 lh3,lh6 啥的，都照样能够访问，像地图之类的需要大量并发下载图片的站点，这个非常重要。)</p><p>3、跨域不会传 cookie,节省宽带；举例说一下：
twitter 的主站 <a href=http://twitter.com target=_blank rel=noopener>http://twitter.com</a>，用户的每次访问，都会带上自己的 cookie，挺大的。假如 twitter 的图片放在主站域名下，那么用户每次访问图片时，request header 里就会带有自己的 cookie，header 里的 cookie 还不能压缩，而图片是不需要知道用户的 cookie 的，所以这部分带宽就白白浪费了。
写主站程序时，set-cookie 也不要 set 到图片的域名上。
在小流量的网站，这个 cookie 其实节省不了多少带宽，当流量如 facebook twitter 时，节省下来就很可观了。</p><p>关于多域名，也不是越多越好，虽然服务器端可以做泛解释，浏览器做 dns 解释也是耗时间的，而且太多域名，如果要走 https 的话，还有要多买证书和部署的问题</p><h2 id=static-content网站静态化>Static Content:网站静态化</h2><ul><li><a href=http://www.cnblogs.com/sharpxiajun/p/4282789.html target=_blank rel=noopener>关于大型网站技术演进的思考(九)&ndash;网站静态化处理&ndash;总述(1)</a></li></ul><p>动静分离是让动态网站里的动态网页根据一定规则把不变的资源和经常变的资源区分开来，动静资源做好了拆分以后，我们就可以根据静态资源的特点将其做缓存操作，这就是网站静态化处理的核心思路。由此可见，网站静态化处理的核心就是动静分离和缓存两大方面，上篇我简单讲述了动静整合的基础知识，本篇将会讲述两大核心之一的动静分离策略，只有把动静分离策略做好了，缓存才能发挥出它应有的效果。</p><h1 id=请求优化>请求优化</h1><h1 id=throttling-限流>Throttling: 限流</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>ajaxThrottle</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=nx>params</span><span class=p>,</span> <span class=nx>timeout</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 这里的缓存暂时挂载在 window 命名空间下
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nb>window</span><span class=p>.</span><span class=nx>ajaxThrottleContext</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>window</span><span class=p>.</span><span class=nx>ajaxThrottleContext</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>token</span> <span class=o>=</span> <span class=nx>url</span> <span class=o>+</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>params</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>lastAjaxTime</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>ajaxThrottleContext</span><span class=p>[</span><span class=nx>token</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// 判断是否已经过时
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span> <span class=p>(</span><span class=nx>lastAjaxTime</span> <span class=o>&amp;&amp;</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>-</span> <span class=nx>lastAjaxTime</span> <span class=o>&lt;</span> <span class=nx>timeout</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// console.log(`Request Abort: ${token}`);
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>window</span><span class=p>.</span><span class=nx>ajaxThrottleContext</span><span class=p>[</span><span class=nx>token</span><span class=p>]</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><a href=https://github.com/beaudurrant/Ajax-Debounce-jQuery-Plugin/blob/master/jquery.ajaxDebounce.js target=_blank rel=noopener>jquery.ajaxDebounce</a></p><h1 id=资源预抓取>资源预抓取</h1><p>譬如 <a href=https://github.com/instantpage/instant.page target=_blank rel=noopener>instant.page</a> 能够利用即时预加载 - 它在用户点击之前预先加载页面。在用户点击链接之前，他们将鼠标悬停在该链接上；大概在 65 毫秒时，他们可能才会实际点击该链接，instant.page 此时开始预加载，平均超过 300 毫秒，以便页面预加载。在移动设备上，用户在释放之前开始触摸他们的显示器，平均花费 90 毫秒来预加载页面。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>prefetcher</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s2>&#34;link&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>preload</span><span class=p>(</span><span class=nx>url</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>prefetcher</span><span class=p>.</span><span class=nx>href</span> <span class=o>=</span> <span class=nx>url</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>touchstartListener</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>linkElement</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>closest</span><span class=p>(</span><span class=s2>&#34;a&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>linkElement</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;touchcancel&#34;</span><span class=p>,</span> <span class=nx>touchendAndTouchcancelListener</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>passive</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=nx>linkElement</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;touchend&#34;</span><span class=p>,</span> <span class=nx>touchendAndTouchcancelListener</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>passive</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>urlToPreload</span> <span class=o>=</span> <span class=nx>linkElement</span><span class=p>.</span><span class=nx>href</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>preload</span><span class=p>(</span><span class=nx>linkElement</span><span class=p>.</span><span class=nx>href</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h1 id=links>Links</h1><ul><li><a href=https://medium.com/@asyncmax/the-right-way-to-bundle-your-assets-for-faster-sites-over-http-2-437c37efe3ff target=_blank rel=noopener>https://medium.com/@asyncmax/the-right-way-to-bundle-your-assets-for-faster-sites-over-http-2-437c37efe3ff</a></li></ul></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>上一页</div><a href=/books/web-tuning-series/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E6%B8%B2%E6%9F%93%E6%89%A7%E8%A1%8C%E4%BC%98%E5%8C%96/%E6%B8%B2%E6%9F%93%E7%AD%96%E7%95%A5/ rel=next>渲染策略</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>