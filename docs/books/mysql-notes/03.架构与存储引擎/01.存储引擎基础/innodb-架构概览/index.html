<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="MySQL Innodb 存储引擎详解 InnoDB 是事务安全的存储引擎，设计上借鉴了很多 Oracle 的架构思想，一般而言，在 OLTP 应用中，InnoDB 应该作为核心应用表的首先存储引擎。InnoDB 是由第三方的 Innobase Oy 公司开发，现已被 Oracle 收购，创始人是 Heikki"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/01.%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E5%9F%BA%E7%A1%80/innodb-%E6%9E%B6%E6%9E%84%E6%A6%82%E8%A7%88/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.fab3cd1900ae35687457073b2d518207.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/01.%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E5%9F%BA%E7%A1%80/innodb-%E6%9E%B6%E6%9E%84%E6%A6%82%E8%A7%88/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/01.%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E5%9F%BA%E7%A1%80/innodb-%E6%9E%B6%E6%9E%84%E6%A6%82%E8%A7%88/"><meta property="og:title" content="InnoDB 架构概览 | Next-gen Tech Edu"><meta property="og:description" content="MySQL Innodb 存储引擎详解 InnoDB 是事务安全的存储引擎，设计上借鉴了很多 Oracle 的架构思想，一般而言，在 OLTP 应用中，InnoDB 应该作为核心应用表的首先存储引擎。InnoDB 是由第三方的 Innobase Oy 公司开发，现已被 Oracle 收购，创始人是 Heikki"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>InnoDB 架构概览 | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=082797af5edb3c70fe215e8f0a554516><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">01.存储引擎基础</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id51cb062b64498fd6f8eee3b595658f3e")' href=#id51cb062b64498fd6f8eee3b595658f3e aria-expanded=false aria-controls=id51cb062b64498fd6f8eee3b595658f3e aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/>03.架构与存储引擎</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id51cb062b64498fd6f8eee3b595658f3e aria-expanded=false aria-controls=id51cb062b64498fd6f8eee3b595658f3e><i class="fa-solid fa-angle-down" id=caret-id51cb062b64498fd6f8eee3b595658f3e></i></a></div><ul class="nav docs-sidenav collapse show" id=id51cb062b64498fd6f8eee3b595658f3e><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id386784b43ac42f7c5b6c878e1e66656d")' href=#id386784b43ac42f7c5b6c878e1e66656d aria-expanded=false aria-controls=id386784b43ac42f7c5b6c878e1e66656d aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/01.%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E5%9F%BA%E7%A1%80/>01.存储引擎基础</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id386784b43ac42f7c5b6c878e1e66656d aria-expanded=false aria-controls=id386784b43ac42f7c5b6c878e1e66656d><i class="fa-solid fa-angle-down" id=caret-id386784b43ac42f7c5b6c878e1e66656d></i></a></div><ul class="nav docs-sidenav collapse show" id=id386784b43ac42f7c5b6c878e1e66656d><li class="child level active"><a href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/01.%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E5%9F%BA%E7%A1%80/innodb-%E6%9E%B6%E6%9E%84%E6%A6%82%E8%A7%88/>InnoDB 架构概览</a></li><li class="child level"><a href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/01.%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E5%9F%BA%E7%A1%80/%E4%BB%8E%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C%E7%AA%A5%E6%8E%A2%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/>从语句执行窥探架构设计</a></li><li class="child level"><a href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/01.%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E5%9F%BA%E7%A1%80/%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E5%AF%B9%E6%AF%94/>存储引擎对比</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id3b367c64c11f659d2b10742a90cae3ed")' href=#id3b367c64c11f659d2b10742a90cae3ed aria-expanded=false aria-controls=id3b367c64c11f659d2b10742a90cae3ed aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/02.%E4%BA%8B%E5%8A%A1%E4%B8%8E%E9%94%81/>02.事务与锁</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id3b367c64c11f659d2b10742a90cae3ed aria-expanded=false aria-controls=id3b367c64c11f659d2b10742a90cae3ed><i class="fa-solid fa-angle-right" id=caret-id3b367c64c11f659d2b10742a90cae3ed></i></a></div><ul class="nav docs-sidenav collapse" id=id3b367c64c11f659d2b10742a90cae3ed><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idf0528a91ba8933461ae41cd83af8172c")' href=#idf0528a91ba8933461ae41cd83af8172c aria-expanded=false aria-controls=idf0528a91ba8933461ae41cd83af8172c aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/02.%E4%BA%8B%E5%8A%A1%E4%B8%8E%E9%94%81/mvcc/>MVCC</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idf0528a91ba8933461ae41cd83af8172c aria-expanded=false aria-controls=idf0528a91ba8933461ae41cd83af8172c><i class="fa-solid fa-angle-right" id=caret-idf0528a91ba8933461ae41cd83af8172c></i></a></div><ul class="nav docs-sidenav collapse" id=idf0528a91ba8933461ae41cd83af8172c><li class="child level"><a href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/02.%E4%BA%8B%E5%8A%A1%E4%B8%8E%E9%94%81/mvcc/mvcc-%E5%AE%9E%E7%8E%B0/>MVCC 实现</a></li><li class="child level"><a href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/02.%E4%BA%8B%E5%8A%A1%E4%B8%8E%E9%94%81/mvcc/%E4%BA%8B%E5%8A%A1%E6%97%A5%E5%BF%97/>事务日志</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id96b66c61e567dc331e6bc0f0834ed35e")' href=#id96b66c61e567dc331e6bc0f0834ed35e aria-expanded=false aria-controls=id96b66c61e567dc331e6bc0f0834ed35e aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/02.%E4%BA%8B%E5%8A%A1%E4%B8%8E%E9%94%81/%E9%94%81/>锁</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id96b66c61e567dc331e6bc0f0834ed35e aria-expanded=false aria-controls=id96b66c61e567dc331e6bc0f0834ed35e><i class="fa-solid fa-angle-right" id=caret-id96b66c61e567dc331e6bc0f0834ed35e></i></a></div><ul class="nav docs-sidenav collapse" id=id96b66c61e567dc331e6bc0f0834ed35e><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id5aefdd349fbcb2945298df9b10288ac2")' href=#id5aefdd349fbcb2945298df9b10288ac2 aria-expanded=false aria-controls=id5aefdd349fbcb2945298df9b10288ac2 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/02.%E4%BA%8B%E5%8A%A1%E4%B8%8E%E9%94%81/%E9%94%81/01.mysql-%E9%94%81%E5%88%86%E7%B1%BB/>01.MySQL 锁分类</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id5aefdd349fbcb2945298df9b10288ac2 aria-expanded=false aria-controls=id5aefdd349fbcb2945298df9b10288ac2><i class="fa-solid fa-angle-right" id=caret-id5aefdd349fbcb2945298df9b10288ac2></i></a></div><ul class="nav docs-sidenav collapse" id=id5aefdd349fbcb2945298df9b10288ac2><li class="child level"><a href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/02.%E4%BA%8B%E5%8A%A1%E4%B8%8E%E9%94%81/%E9%94%81/01.mysql-%E9%94%81%E5%88%86%E7%B1%BB/%E4%B8%8D%E5%90%8C%E8%8C%83%E5%9B%B4%E7%9A%84%E9%94%81/>不同范围的锁</a></li></ul></div><li class="child level"><a href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/02.%E4%BA%8B%E5%8A%A1%E4%B8%8E%E9%94%81/%E9%94%81/innodb-%E5%8A%A0%E9%94%81%E6%B5%81%E7%A8%8B%E6%B5%85%E6%9E%90/>InnoDB 加锁流程浅析</a></li><li class="child level"><a href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/02.%E4%BA%8B%E5%8A%A1%E4%B8%8E%E9%94%81/%E9%94%81/%E5%85%B1%E4%BA%AB%E9%94%81%E4%B8%8E%E6%8E%92%E4%BB%96%E9%94%81/>共享锁与排他锁</a></li><li class="child level"><a href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/02.%E4%BA%8B%E5%8A%A1%E4%B8%8E%E9%94%81/%E9%94%81/%E6%AD%BB%E9%94%81/>死锁</a></li></ul></div></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-iddd6aa639ad7d174ca2c17e52019302fe")' href=#iddd6aa639ad7d174ca2c17e52019302fe aria-expanded=false aria-controls=iddd6aa639ad7d174ca2c17e52019302fe aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/03.%E6%97%A5%E5%BF%97%E4%B8%8E%E6%8C%81%E4%B9%85%E5%8C%96/>03.日志与持久化</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#iddd6aa639ad7d174ca2c17e52019302fe aria-expanded=false aria-controls=iddd6aa639ad7d174ca2c17e52019302fe><i class="fa-solid fa-angle-right" id=caret-iddd6aa639ad7d174ca2c17e52019302fe></i></a></div><ul class="nav docs-sidenav collapse" id=iddd6aa639ad7d174ca2c17e52019302fe><li class="child level"><a href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/03.%E6%97%A5%E5%BF%97%E4%B8%8E%E6%8C%81%E4%B9%85%E5%8C%96/innodb-%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84/>Innodb 日志文件结构</a></li><li class="child level"><a href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/03.%E6%97%A5%E5%BF%97%E4%B8%8E%E6%8C%81%E4%B9%85%E5%8C%96/purge/>Purge</a></li><li class="child level"><a href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/03.%E6%97%A5%E5%BF%97%E4%B8%8E%E6%8C%81%E4%B9%85%E5%8C%96/%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84/>存储结构</a></li><li class="child level"><a href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/03.%E6%97%A5%E5%BF%97%E4%B8%8E%E6%8C%81%E4%B9%85%E5%8C%96/%E7%BC%93%E5%86%B2%E5%8C%BA%E7%AE%A1%E7%90%86/>缓冲区管理</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ida87abe5a59e6debcd7142530bf4c0733")' href=#ida87abe5a59e6debcd7142530bf4c0733 aria-expanded=false aria-controls=ida87abe5a59e6debcd7142530bf4c0733 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/04.%E8%AF%AD%E5%8F%A5%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%A4%84%E7%90%86/>04.语句解析与处理</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ida87abe5a59e6debcd7142530bf4c0733 aria-expanded=false aria-controls=ida87abe5a59e6debcd7142530bf4c0733><i class="fa-solid fa-angle-right" id=caret-ida87abe5a59e6debcd7142530bf4c0733></i></a></div><ul class="nav docs-sidenav collapse" id=ida87abe5a59e6debcd7142530bf4c0733><li class="child level"><a href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/04.%E8%AF%AD%E5%8F%A5%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%A4%84%E7%90%86/sql-%E8%A7%A3%E6%9E%90/>SQL 解析</a></li><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ida77751cae16a3eb98918c6b3f1aa12bd")' href=#ida77751cae16a3eb98918c6b3f1aa12bd aria-expanded=false aria-controls=ida77751cae16a3eb98918c6b3f1aa12bd aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/04.%E8%AF%AD%E5%8F%A5%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%A4%84%E7%90%86/%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/>查询优化</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ida77751cae16a3eb98918c6b3f1aa12bd aria-expanded=false aria-controls=ida77751cae16a3eb98918c6b3f1aa12bd><i class="fa-solid fa-angle-right" id=caret-ida77751cae16a3eb98918c6b3f1aa12bd></i></a></div><ul class="nav docs-sidenav collapse" id=ida77751cae16a3eb98918c6b3f1aa12bd><li class="child level"><a href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/04.%E8%AF%AD%E5%8F%A5%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%A4%84%E7%90%86/%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/volcano/>Volcano</a></li><li class="child level"><a href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/04.%E8%AF%AD%E5%8F%A5%E8%A7%A3%E6%9E%90%E4%B8%8E%E5%A4%84%E7%90%86/%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/%E5%90%91%E9%87%8F%E4%BC%98%E5%8C%96/>向量优化</a></li></ul></div></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id6f7eec22274190f2e9e8291d87342d79")' href=#id6f7eec22274190f2e9e8291d87342d79 aria-expanded=false aria-controls=id6f7eec22274190f2e9e8291d87342d79 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/05.%E7%B4%A2%E5%BC%95/>05.索引</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id6f7eec22274190f2e9e8291d87342d79 aria-expanded=false aria-controls=id6f7eec22274190f2e9e8291d87342d79><i class="fa-solid fa-angle-right" id=caret-id6f7eec22274190f2e9e8291d87342d79></i></a></div><ul class="nav docs-sidenav collapse" id=id6f7eec22274190f2e9e8291d87342d79><li class="child level"><a href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/05.%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E5%9F%BA%E7%A1%80/>索引基础</a></li><li class="child level"><a href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/05.%E7%B4%A2%E5%BC%95/%E7%B4%A2%E5%BC%95%E4%BB%8B%E7%BB%8D/>索引介绍</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idee71b4cab1810d2a6b07fa8a7282d570")' href=#idee71b4cab1810d2a6b07fa8a7282d570 aria-expanded=false aria-controls=idee71b4cab1810d2a6b07fa8a7282d570 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/06.%E7%BD%91%E7%BB%9C%E6%9E%B6%E6%9E%84/>06.网络架构</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idee71b4cab1810d2a6b07fa8a7282d570 aria-expanded=false aria-controls=idee71b4cab1810d2a6b07fa8a7282d570><i class="fa-solid fa-angle-right" id=caret-idee71b4cab1810d2a6b07fa8a7282d570></i></a></div><ul class="nav docs-sidenav collapse" id=idee71b4cab1810d2a6b07fa8a7282d570><li class="child level"><a href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/06.%E7%BD%91%E7%BB%9C%E6%9E%B6%E6%9E%84/%E6%9F%A5%E8%AF%A2%E6%89%A7%E8%A1%8C/>查询执行</a></li><li class="child level"><a href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/06.%E7%BD%91%E7%BB%9C%E6%9E%B6%E6%9E%84/%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE/>通信协议</a></li></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#行存储>行存储</a></li><li><a href=#磁盘预读机制和局部性原理>磁盘预读机制和局部性原理</a></li><li><a href=#磁盘和内存的交互>磁盘和内存的交互</a></li><li><a href=#随机磁盘-io>随机磁盘 IO</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>InnoDB 架构概览</h1><div class=article-style><h1 id=mysql-innodb-存储引擎详解>MySQL Innodb 存储引擎详解</h1><p>InnoDB 是事务安全的存储引擎，设计上借鉴了很多 Oracle 的架构思想，一般而言，在 OLTP 应用中，InnoDB 应该作为核心应用表的首先存储引擎。InnoDB 是由第三方的 Innobase Oy 公司开发，现已被 Oracle 收购，创始人是 Heikki Tuuri，芬兰赫尔辛基人，和著名的 Linux 创始人 Linus 是校友。</p><p>InnoDB 的整体架构分为两个部分：内存架构和磁盘架构，如图：</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://assets.ng-tech.icu/superbed/2021/07/25/60fd14be5132923bf8a00f56.jpg alt="InnoDB 整体架构" loading=lazy data-zoomable></div></div></figure></p><h1 id=memory-architecture--内存架构>Memory Architecture | 内存架构</h1><p>InnoDB 的内存主要有以下几个部分组成：缓冲池 (buffer pool)、重做日志缓冲池(Redo Log buffer）以及额外的内存池（additional memory pool），如下图所示：</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://assets.ng-tech.icu/item/20230502140209.png alt loading=lazy data-zoomable></div></div></figure></p><p>其中缓冲池占最大块内存，用来缓存各自数据，数据文件按页（每页 16K）读取到缓冲池，按最近最少使用算法（LRU）保留缓存数据。缓冲池缓冲的数据类型有：数据页、索引页、插入缓冲、自适应哈希索引、锁信息、数据字典信息等，其中数据页和索引页占了绝大部分内存。日志缓冲将重做日志信息先放入这个缓冲区，然后按一定频率（默认为 1s）将其刷新至重做日志文件。</p><p>InnoDB 通过一些列后台线程将相关操作进行异步处理，同时借助缓冲池来减小 CPU 和磁盘速度上的差异。当查询的时候会先通过索引定位到对应的数据页，然后检测数据页是否在缓冲池内，如果在就直接返回，如果不在就去聚簇索引中通过磁盘 IO 读取对应的数据页并放入缓冲池。一个数据页会包含多个数据行。缓存池通过 LRU 算法对数据页进行管理，也就是最频繁使用的数据页排在列表前面，不经常使用的排在队尾，当缓冲池满了的时候会淘汰掉队尾的数据页。从磁盘新读取到的数据页并不会放在队列头部而是放在中间位置，这个中间位置可以通过参数进行修。缓冲池也可以设置多个实例，数据页根据哈希算法决定放在哪个缓冲池。</p><h1 id=storage-architecture--存储结构>Storage Architecture | 存储结构</h1><p>InnoDB 存储引擎的逻辑存储结构和 Oracle 大致相同，所有数据都被逻辑地存放在一个空间中，我们称之为表空间（tablespace）。表空间又由段（segment）、区（extent）、页（page）组成。页在一些文档中有时也称为块（block），1 extent = 64 pages，InnoDB 存储引擎的逻辑存储结构大致如图所示：</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://assets.ng-tech.icu/item/20230502140226.png alt loading=lazy data-zoomable></div></div></figure></p><p>表空间作为存储结构的最高层，所有数据都存放在表空间中，默认情况下用一个共享表空间 ibdata1，如果开启了 innodb_file_per_table 则每张表的数据将存储在单独的表空间中，也就是每张表都会有一个文件，</p><p>表空间由各个段构成，InnoDB 存储引擎由索引组织的，而索引中的叶子节点用来记录数据，存储在数据段，而非叶子节点用来构建索引，存储在索引段。区是由连续的页组成，任何情况下一个区都是 1MB，一个区中可以有多个页，每个页默认为 16KB，所以默认情况下一个区中可以包含 64 个连续的页，页的大小是可以通过 innodb_page_size 设置，页中存储的是具体的行记录。一行记录最终以二进制的方式存储在文件里。</p><p>从物理意义上来看，InnoDB 表由共享表空间、日志文件组（更准确地说，应该是 Redo 文件组）、表结构定义文件组成。若将 innodb_file_per_table 设置为 on，则每个表将独立地产生一个表空间文件，以 ibd 结尾，数据、索引、表的内部数据字典信息都将保存在这个单独的表空间文件中。表结构定义文件以 frm 结尾，这个是与存储引擎无关的，任何存储引擎的表结构定义文件都一样，为 .frm 文件。</p><h2 id=行存储>行存储</h2><p>InnoDB 引擎是面向行存储的，数据都是存储在磁盘的数据页中，数据页里面按照固定的行格式存储着每一行数据。行格式主要分为四种类型 Compact、Redundant、Dynamic 和 Compressed，默认为 Compact 格式。</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://assets.ng-tech.icu/superbed/2021/07/25/60fd15385132923bf8a286ff.jpg alt="Compact 行格式示意图" loading=lazy data-zoomable></div></div></figure></p><h2 id=磁盘预读机制和局部性原理>磁盘预读机制和局部性原理</h2><p>当计算机访问一个数据时，不仅会加载当前数据所在的数据页，还会将当前数据页相邻的数据页一同加载到内存，磁盘预读的长度一般为页的整倍数，从而有效降低磁盘 IO 的次数。</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://assets.ng-tech.icu/superbed/2021/07/25/60fd15cf5132923bf8a57386.jpg alt=磁盘预读和局部性 loading=lazy data-zoomable></div></div></figure></p><h2 id=磁盘和内存的交互>磁盘和内存的交互</h2><p>MySQL 中磁盘的数据需要被交换到内存，才能完成一次 SQL 交互，大致如图：</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://assets.ng-tech.icu/superbed/2021/07/25/60fd16285132923bf8a72b91.jpg alt=磁盘和内存交互 loading=lazy data-zoomable></div></div></figure></p><ul><li>扇区是硬盘的读写的基本单位，通常情况下每个扇区的大小是 512B</li><li>磁盘块文件系统读写数据的最小单位，相邻的扇区组合在一起形成一个块，一般是 4KB</li><li>页是内存的最小存储单位，页的大小通常为磁盘块大小的 2^n 倍</li><li>InnoDB 页面的默认大小是 16KB，是数倍个操作系统的页</li></ul><h2 id=随机磁盘-io>随机磁盘 IO</h2><p>MySQL 的数据是一行行存储在磁盘上的，并且这些数据并非物理连续地存储，这样的话要查找数据就无法避免随机在磁盘上读取和写入数据。对于 MySQL 来说，当出现大量磁盘随机 IO 时，大部分时间都被浪费到寻道上，磁盘呼噜呼噜转，就是传输不了多少数据。</p><p>一次磁盘访问由三个动作组成：</p><ul><li>寻道：磁头移动定位到指定磁道</li><li>旋转：等待指定扇区从磁头下旋转经过</li><li>数据传输：数据在磁盘与内存之间的实际传输</li></ul><p>对于存储引擎来说，如何有效降低随机 IO 是个非常重要的问题。</p><h1 id=process-architecture--进程架构>Process Architecture | 进程架构</h1><p>默认情况下，InnoDB 的后台线程有 7 个，其中 4 个 IO thread, 1 个 Master thread, 1 个 Lock monitor thread, 一个 Error monitor thread。InnoDB 的主要工作都是在一个单独的 Master 线程里完成的。Master 线程的优先级最高，它主要分为以下几个循环：主循环（loop）、后台循环（background loop）、刷新循环（flush loop）、暂停循环（suspend loop）。</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://assets.ng-tech.icu/item/20230502140308.png alt loading=lazy data-zoomable></div></div></figure></p><p>其中主循环的伪代码如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>master_thread</span><span class=p>()</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nl>loop</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span><span class=mi>10</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=k>do</span> <span class=n>thing</span> <span class=n>once</span> <span class=n>per</span> <span class=n>second</span>
</span></span><span class=line><span class=cl>        <span class=n>sleep</span> <span class=mi>1</span> <span class=n>second</span> <span class=k>if</span> <span class=n>necessary</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>do</span> <span class=n>things</span> <span class=n>once</span> <span class=n>per</span> <span class=n>ten</span> <span class=n>seconds</span>
</span></span><span class=line><span class=cl>    <span class=k>goto</span> <span class=n>loop</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li>其中每秒一次的操作包括：刷新日志缓冲区（总是），合并插入缓冲（可能），至多刷新 100 个脏数据页（可能），如果没有当前用户活动，切换至 background loop（可能）。</li><li>其中每 10 秒一次的操作包括：合并至多 5 个插入缓冲（总是），刷新日志缓冲（总是），刷新 100 个或 10 个脏页到磁盘（总是），产生一个检查点（总是），删除无用 Undo 页（总是）。</li><li>后台循环，若当前没有用户活动或数据库关闭时，会切换至该循环执行以下操作：删除无用的 undo 页（总是），合并 20 个插入缓冲（总是），跳回到主循环（总是），不断刷新 100 个页，直到符合条件跳转到 flush loop（可能）。</li><li>如果 flush loop 中也没有什么事情可做，边切换到 suspend loop，将 master 线程挂起。</li></ul></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>下一页</div><a href=/books/mysql-notes/03.%E6%9E%B6%E6%9E%84%E4%B8%8E%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/01.%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E5%9F%BA%E7%A1%80/%E4%BB%8E%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C%E7%AA%A5%E6%8E%A2%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/ rel=prev>从语句执行窥探架构设计</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div><script type=text/javascript id=clstr_globe async src="//clustrmaps.com/globe.js?d=kgpJG5sWZQpKujBmD-uW1B54-WBPol-DuDtrB2KFjKs"></script></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>