<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>网络 | Next-gen Tech Edu</title><link>https://ng-tech.icu/books/sre-series/%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/%E7%B3%BB%E7%BB%9F%E6%8C%87%E6%A0%87/%E7%BD%91%E7%BB%9C/</link><atom:link href="https://ng-tech.icu/books/sre-series/%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/%E7%B3%BB%E7%BB%9F%E6%8C%87%E6%A0%87/%E7%BD%91%E7%BB%9C/index.xml" rel="self" type="application/rss+xml"/><description>网络</description><generator>Wowchemy (https://wowchemy.com)</generator><language>zh</language><image><url>https://ng-tech.icu/media/sharing.png</url><title>网络</title><link>https://ng-tech.icu/books/sre-series/%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/%E7%B3%BB%E7%BB%9F%E6%8C%87%E6%A0%87/%E7%BD%91%E7%BB%9C/</link></image><item><title>网络</title><link>https://ng-tech.icu/books/sre-series/%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/%E7%B3%BB%E7%BB%9F%E6%8C%87%E6%A0%87/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://ng-tech.icu/books/sre-series/%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6/%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/%E7%B3%BB%E7%BB%9F%E6%8C%87%E6%A0%87/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C/</guid><description>&lt;h1 id="网络">网络&lt;/h1>
&lt;p>网络这个概念涵盖的范围较广，在应用层、传输层、网络层、网络接口层都有不同的指标去衡量。这里我们讨论的网络，特指应用层的网络，通常使用的指标如下:&lt;/p>
&lt;ul>
&lt;li>网络带宽：表示链路的最大传输速率；&lt;/li>
&lt;li>网络吞吐：表示单位时间内成功传输的数据量大小；&lt;/li>
&lt;li>网络延时：表示从网络请求发出后直到收到远端响应，所需要的时间；&lt;/li>
&lt;li>网络连接数和错误数；&lt;/li>
&lt;/ul>
&lt;p>一般来说，应用层的网络瓶颈有如下几类：&lt;/p>
&lt;ul>
&lt;li>集群或机器所在的机房的网络带宽饱和，影响应用 QPS/TPS 的提升；&lt;/li>
&lt;li>网络吞吐出现异常，如接口存在大量的数据传输，造成带宽占用过高；&lt;/li>
&lt;li>网络连接出现异常或错误；&lt;/li>
&lt;li>网络出现分区。&lt;/li>
&lt;/ul>
&lt;p>带宽和网络吞吐这两个指标，一般我们会关注整个应用的，通过监控系统可直接得到，如果一段时间内出现了明显的指标上升，说明存在网络性能瓶颈。对于单机，可以使用 sar 得到网络接口、进程的网络吞吐。&lt;/p>
&lt;p>使用 ping 或者 hping3 可以得到是否出现网络分区、网络具体时延。对于应用，我们更关注整个链路的时延，可以通过中间件埋点后输出的 trace 日志得到链路上各个环节的时延信息。使用 netstat、ss 和 sar 可以获取网络连接数或网络错误数。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看系统当前网络连接数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ netstat -n &lt;span class="p">|&lt;/span> awk &lt;span class="s1">&amp;#39;/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="mtr">mtr&lt;/h1>
&lt;p>MTR 是一个简单的跨平台命令行网络诊断工具，将常用的 traceroute 和 ping 程序的功能组合到一个工具中。以与 traceroute 类似的方式，mtr 打印有关数据包从运行 mtr 的主机到用户指定的目标主机的路由的信息。运行 mtr 后，它将探查本地系统与您指定的远程主机之间的网络连接。它首先在主机之间建立每个网络跃点（网桥，路由器和网关等）的地址，然后对其进行 ping（发送 ICMP ECHO 请求的序列）以确定每个计算机的链路质量。&lt;/p>
&lt;p>该工具已预装在大多数 Linux 发行版中，我们也可以手动添加：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-s" data-lang="s">&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">sudo&lt;/span> &lt;span class="n">apt&lt;/span> &lt;span class="n">install&lt;/span> &lt;span class="n">mtr&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">sudo&lt;/span> &lt;span class="n">yum&lt;/span> &lt;span class="n">install&lt;/span> &lt;span class="n">mtr&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">sudo&lt;/span> &lt;span class="n">dnf&lt;/span> &lt;span class="n">install&lt;/span> &lt;span class="n">mtr&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>使用 mtr 的最简单示例是提供远程计算机的域名或 IP 地址作为参数，例如 google.com 或 216.58.223.78。此命令将向您显示实时更新的路由跟踪报告，直到您退出程序（通过按 q 或 Ctrl + C）。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-s" data-lang="s">&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">mtr&lt;/span> &lt;span class="n">google.com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">OR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">mtr&lt;/span> &lt;span class="m">216.58.223.78&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Start&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">Thu&lt;/span> &lt;span class="n">Jun&lt;/span> &lt;span class="m">28&lt;/span> &lt;span class="m">12&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="m">10&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="m">13&lt;/span> &lt;span class="m">2018&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">HOST&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">TecMint&lt;/span> &lt;span class="n">Loss&lt;/span>&lt;span class="o">% Snt Last Avg Best Wrst StDev
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o"> 1.|-- 192.168.0.1 0.0%&lt;/span> &lt;span class="m">5&lt;/span> &lt;span class="m">0.3&lt;/span> &lt;span class="m">0.3&lt;/span> &lt;span class="m">0.3&lt;/span> &lt;span class="m">0.4&lt;/span> &lt;span class="m">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">2&lt;/span>&lt;span class="n">.|&lt;/span>&lt;span class="o">--&lt;/span> &lt;span class="m">5.5.5.211&lt;/span> &lt;span class="m">0.0&lt;/span>&lt;span class="o">% 5 0.7 0.9 0.7 1.3 0.0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o"> 3.|-- 209.snat-111-91-120.hns.n 80.0%&lt;/span> &lt;span class="m">5&lt;/span> &lt;span class="m">7.1&lt;/span> &lt;span class="m">7.1&lt;/span> &lt;span class="m">7.1&lt;/span> &lt;span class="m">7.1&lt;/span> &lt;span class="m">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">4&lt;/span>&lt;span class="n">.|&lt;/span>&lt;span class="o">--&lt;/span> &lt;span class="m">72.14.194.226&lt;/span> &lt;span class="m">0.0&lt;/span>&lt;span class="o">% 5 1.9 2.9 1.9 4.4 1.1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o"> 5.|-- 108.170.248.161 0.0%&lt;/span> &lt;span class="m">5&lt;/span> &lt;span class="m">2.9&lt;/span> &lt;span class="m">3.5&lt;/span> &lt;span class="m">2.0&lt;/span> &lt;span class="m">4.3&lt;/span> &lt;span class="m">0.7&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">6&lt;/span>&lt;span class="n">.|&lt;/span>&lt;span class="o">--&lt;/span> &lt;span class="m">216.239.62.237&lt;/span> &lt;span class="m">0.0&lt;/span>&lt;span class="o">% 5 3.0 6.2 2.9 18.3 6.7
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o"> 7.|-- bom05s12-in-f14.1e100.net 0.0%&lt;/span> &lt;span class="m">5&lt;/span> &lt;span class="m">2.1&lt;/span> &lt;span class="m">2.4&lt;/span> &lt;span class="m">2.0&lt;/span> &lt;span class="m">3.8&lt;/span> &lt;span class="m">0.5&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>常见的参数用法如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-s" data-lang="s">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 强制展示 IP 地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">mtr&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">google.com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 同时展示域名与 IP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">mtr&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">b&lt;/span> &lt;span class="n">google.com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 使用 TCP 或者 UDP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">mtr&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">tcp&lt;/span> &lt;span class="n">test.com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">mtr&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">udp&lt;/span> &lt;span class="n">test.com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 设置测试包的大小&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">mtr&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">r&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="n">PACKETSIZE&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="m">5&lt;/span> &lt;span class="n">google.com&lt;/span> &lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">mtr&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">report&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>您可以使用-r 标志将其设置为报告模式，该标志是用于生成有关网络质量的统计信息的有用选项。您可以将此选项与-c 选项一起使用以指定 ping 的数量。由于统计信息已打印到标准输出，因此您可以将其重定向到文件以供以后分析。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-s" data-lang="s">&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">mtr&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">r&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="m">5&lt;/span> &lt;span class="n">google.com&lt;/span> &lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">mtr&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">report&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">mtr&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">rw&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="m">5&lt;/span> &lt;span class="n">google.com&lt;/span> &lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">mtr&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">report&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">mtr&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="s">&amp;#34;LSDR NBAW JMXI&amp;#34;&lt;/span> &lt;span class="m">216.58.223.78&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>