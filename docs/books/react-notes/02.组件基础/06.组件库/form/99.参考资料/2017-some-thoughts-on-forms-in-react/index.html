<!DOCTYPE html><html lang="zh" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.5.0 for Hugo" />
  

  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
    <meta name="google-site-verification" content="google69a5cccb61297807" />
    <meta name="baidu-site-verification" content="cqmZHEleVh" />
  
  
  
  
  

  

  
  
  
    
  
  <meta name="description" content="Some Thoughts On Forms in React If you’re working on business to business applications, than you will quickly come across forms, many of them. They same goes when you’re building an App probably, where the user needs to interact. Now let’s set aside any UI or UX aspects and just think what is involved in a seemingly trivial task.
We might have a couple of fields, some select or checkboxes, a text area or two. Now we also might need to validate against the input and return meaningful messages. Everything doable actually. Ok, now maybe we want to validate as soon as a field is touched or when the user submits." />

  
  <link rel="alternate" hreflang="zh" href="https://ng-tech.icu/books/react-notes/02.%E7%BB%84%E4%BB%B6%E5%9F%BA%E7%A1%80/06.%E7%BB%84%E4%BB%B6%E5%BA%93/form/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2017-some-thoughts-on-forms-in-react/" />

  
  
  
    <meta name="theme-color" content="#0a55a7" />
  

  
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css" media="print" onload="this.media='all'">

  
  
  
    
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    

    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css" integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin="anonymous">
    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.0d97305106da5efa530e28b021b4c580.css" />

  




<script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', "G-40NYXJ8823");
</script>


  


  


  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://ng-tech.icu/books/react-notes/02.%E7%BB%84%E4%BB%B6%E5%9F%BA%E7%A1%80/06.%E7%BB%84%E4%BB%B6%E5%BA%93/form/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2017-some-thoughts-on-forms-in-react/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@wx-chevalier" />
    <meta property="twitter:creator" content="@wx-chevalier" />
  
  <meta property="og:site_name" content="Next-gen Tech Edu" />
  <meta property="og:url" content="https://ng-tech.icu/books/react-notes/02.%E7%BB%84%E4%BB%B6%E5%9F%BA%E7%A1%80/06.%E7%BB%84%E4%BB%B6%E5%BA%93/form/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2017-some-thoughts-on-forms-in-react/" />
  <meta property="og:title" content="2017-Some Thoughts On Forms in React | Next-gen Tech Edu" />
  <meta property="og:description" content="Some Thoughts On Forms in React If you’re working on business to business applications, than you will quickly come across forms, many of them. They same goes when you’re building an App probably, where the user needs to interact. Now let’s set aside any UI or UX aspects and just think what is involved in a seemingly trivial task.
We might have a couple of fields, some select or checkboxes, a text area or two. Now we also might need to validate against the input and return meaningful messages. Everything doable actually. Ok, now maybe we want to validate as soon as a field is touched or when the user submits." /><meta property="og:image" content="https://ng-tech.icu/media/sharing.png" />
    <meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png" /><meta property="og:locale" content="zh" />
  
    
    
  

  



  

  

  





  <title>2017-Some Thoughts On Forms in React | Next-gen Tech Edu</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="28768dc6d035605508164f910f8528a9" >
  <button onclick="topFunction()" id="backTopBtn" title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden="true"></i></button>
  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6 search-title">
          <p>搜索</p>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="关闭"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        
        
      </div>

      
      

      
    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

      <div id="search-common-queries">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    












<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/">Next-gen Tech Edu</a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="切换导航">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/">Next-gen Tech Edu</a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/books-gallery"><span>笔记（万篇）</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#knowledge-map"><span>知识图谱</span></a>
          </li>

          
          

          
          <style>
            .dropdown-item{
              display: inline-flex;
            }
          </style>
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>实验室</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="/galaxy-home/gh-craft"><span>Craft 方块世界</span></a>
              
                <a class="dropdown-item" href="/galaxy-home/glossary-cards"><span>3D 知识卡牌</span></a>
              
            </div>
          </li>

          
          

          
          <style>
            .dropdown-item{
              display: inline-flex;
            }
          </style>
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>其他阅读渠道</span><span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              
                <a class="dropdown-item" href="https://zhuanlan.zhihu.com/wxyyxc1992"><img style="width:16px;height:16px;display:inline-block;margin-right:8px" src="https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png"></img><span>知乎</span></a>
              
                <a class="dropdown-item" href="https://segmentfault.com/blog/wxyyxc1992"><img style="width:16px;height:16px;display:inline-block;margin-right:8px" src="https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png"></img><span>SegmentFault</span></a>
              
                <a class="dropdown-item" href="https://zhuanlan.zhihu.com/wxyyxc1992"><img style="width:16px;height:16px;display:inline-block;margin-right:8px" src="https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png"></img><span>掘金</span></a>
              
            </div>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
        
        <li class="nav-item">
          <a class="nav-link js-search" href="#" aria-label="搜索"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item">
            <a class="nav-link" href="https://github.com/wx-chevalier" aria-label="GitHub"><i class="fa-brands fa-github" aria-hidden="true"></i></a>
        </li>
        

        
        
        

        
        
        
        <div></div>
        
        <style>
        @media only screen and (max-width: 600px) {
          .jimmysong-template {
            display: none!important;
          }
        }
        </style>
        
        <li class="jimmysong-template" style="color: white;font-size: 12px;">
          <a href="https://jimmysong.io" style="color: white">By Jimmy Song's Template</a>
        </li>
      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    




<link rel="stylesheet" href="//unpkg.com/heti/umd/heti.min.css">
<div class="container-xl docs">
  <div class="row flex-xl-nowrap">
    <div class="docs-sidebar">
      <form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <div class="d-flex">
      <span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">
        
          99.参考资料
        
      </span>
      <span><i class="fas fa-chevron-down"></i></span>
    </div>
  </button>

  
  <button class="form-control sidebar-search js-search d-none d-md-flex">
    <i class="fas fa-search pr-2"></i>
    <span class="sidebar-search-text">搜索...</span>
    <span class="sidebar-search-shortcut">/</span>
  </button>
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  
  
  
  

  
  
    

    
      

      <ul class="nav docs-sidenav">
        <li style="display: inline-flex">
          <a style="cursor: pointer;" onclick="window.history.back()">
            <i class="fas fa-arrow-left pr-1"></i>
            Back
          </a>
          <span>|</span>
          <a href="/books/">
            <i class="fa-solid fa-house" style="margin-right: 4px"></i>
            Books
          </a>
        </li>
      </ul>

      
      
        
          
        
      



  
    
    
    
    
      
    
    

    
    
    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-idb877873625ef0bbc1a8af424280d7da8&#34;)" href="#idb877873625ef0bbc1a8af424280d7da8" aria-expanded="false" aria-controls="idb877873625ef0bbc1a8af424280d7da8" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/books/react-notes/02.%E7%BB%84%E4%BB%B6%E5%9F%BA%E7%A1%80/06.%E7%BB%84%E4%BB%B6%E5%BA%93/form/">Form</a>
    <a class="nav-toogle d-inline level" aria-hidden="false" data-toggle="collapse" href="#idb877873625ef0bbc1a8af424280d7da8" aria-expanded="false" aria-controls="idb877873625ef0bbc1a8af424280d7da8">
    
    <i class="fa-solid fa-angle-down" id="caret-idb877873625ef0bbc1a8af424280d7da8"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  show " id="idb877873625ef0bbc1a8af424280d7da8">
      



  
    
    
    
    
      
    
    

    
    
    
    
    
    <div class="docs-toc-item has-child">
    <div class="parent-node d-flex justify-content-between" onClick="Collapse(&#34;caret-id63086cbb9ec1e512b03f6937427b4c71&#34;)" href="#id63086cbb9ec1e512b03f6937427b4c71" aria-expanded="false" aria-controls="id63086cbb9ec1e512b03f6937427b4c71" aria-hidden="false" data-toggle="collapse">
    
    <a class="d-inline docs-toc-link " href="/books/react-notes/02.%E7%BB%84%E4%BB%B6%E5%9F%BA%E7%A1%80/06.%E7%BB%84%E4%BB%B6%E5%BA%93/form/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/">99.参考资料</a>
    <a class="nav-toogle d-inline level" aria-hidden="false" data-toggle="collapse" href="#id63086cbb9ec1e512b03f6937427b4c71" aria-expanded="false" aria-controls="id63086cbb9ec1e512b03f6937427b4c71">
    
    <i class="fa-solid fa-angle-down" id="caret-id63086cbb9ec1e512b03f6937427b4c71"></i>
    
    </a>
    
    </div>
    
      
      <ul class="nav docs-sidenav collapse  show " id="id63086cbb9ec1e512b03f6937427b4c71">
      



  <li class="child level active"><a href="/books/react-notes/02.%E7%BB%84%E4%BB%B6%E5%9F%BA%E7%A1%80/06.%E7%BB%84%E4%BB%B6%E5%BA%93/form/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2017-some-thoughts-on-forms-in-react/">2017-Some Thoughts On Forms in React</a></li>

      
        </ul>
      
    

    
      </div>
    




  <li class="child level "><a href="/books/react-notes/02.%E7%BB%84%E4%BB%B6%E5%9F%BA%E7%A1%80/06.%E7%BB%84%E4%BB%B6%E5%BA%93/form/react-hook-form/">React Hook Form</a></li>

      
        </ul>
      
    

    
      </div>
    

    
  
</nav>

    </div>

    
    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      
     
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">目录</a></li>
      </ul>
     

      <nav id="TableOfContents">
  <ul>
    <li><a href="#view-driven">View Driven</a></li>
    <li><a href="#model-driven"><strong>Model Driven</strong></a></li>
    <li><a href="#a-mix-of-model-and-view-driven">A Mix of Model and View Driven</a></li>
    <li><a href="#redux--state-management-driven">Redux / State Management Driven</a></li>
    <li><a href="#back-to-square-one-some-background-on-forms-in-react">Back to square one: Some Background on Forms in React.</a></li>
    <li><a href="#back-to-the-efficiency-topic">Back to the Efficiency Topic</a></li>
    <li><a href="#validation">Validation</a></li>
    <li><a href="#connecting-the-dots">Connecting the Dots</a></li>
    <li><a href="#validation-1">Validation</a></li>
    <li><a href="#whats-next">What’s Next?</a></li>
  </ul>
</nav>

      
<div class="subscribe-module col-24 mt-1">
    <img src="https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png" alt="image" title="王下邀月熊的微信公众号"/>
</div>



    </div>
    

    <main class="py-md-3 pl-md-3 docs-content col-xl-8" role="main">

      <article class="article">

          

          <h1>2017-Some Thoughts On Forms in React</h1>

          <div class="article-style">
            <h1 id="some-thoughts-on-forms-in-react">Some Thoughts On Forms in React</h1>
<p>If you’re working on business to business applications, than you will quickly come across forms, many of them. They same goes when you’re building an App probably, where the user needs to interact. Now let’s set aside any UI or UX aspects and just think what is involved in a seemingly trivial task.</p>
<p>We might have a couple of fields, some select or checkboxes, a text area or two. Now we also might need to validate against the input and return meaningful messages. Everything doable actually. Ok, now maybe we want to validate as soon as a field is touched or when the user submits. We might also want to display all the error messages at once or one by one. What about dynamic fields, say, give the user the opportunity to add more than one address and what about deeply nested forms or data? You see where this going.</p>
<p>There are a number of viable approaches to solve aforementioned situations when it comes forms in React land. Without getting too specific, let’s just think about those approaches from a high level perspective.</p>
<h2 id="view-driven">View Driven</h2>
<p>Let’s call the first approach <strong>*React/JSX Driven*</strong>, which is meant as tackling the problem via form elements. Building abstractions over elements like <code>form</code> or <code>input</code> for example.</p>
<pre tabindex="0"><code>&lt;Input
  onChange={doSomething}
  label=&#39;Name Field&#39;
  errorMessage={getSomeMessage()}
  {/*  */}
/&gt;
</code></pre><p>Maybe managing the values via <em>Context</em> or via <em>refs</em> or other React specific ways, in some cases providing a <code>&lt;Field /&gt; </code>or <code>&lt;Fieldset /&gt;</code> Component.</p>
<pre tabindex="0"><code>&lt;Form onSubmit={doSomething} errors={getFormErrors()} &gt;
  &lt;Input onChange={doSomethingElse} /&gt;
  {/* ... */}
&lt;/Form&gt;
</code></pre><p>The validation part is either shifted back to the developer or handled via attributes for example. These concepts work well for standardized solutions.</p>
<h2 id="model-driven"><strong>Model Driven</strong></h2>
<p>On the other side of the spectrum, there is a model driven approach, which creates elements from a given set of data. In the most extreme form having knowledge of the data types, creating validators and specific inputs based on the field’s type. Again abstracting away the manual part of having to write the initial form and its corresponding elements and their attributes.</p>
<pre tabindex="0"><code>const schema = {
  name: type.string,
  customerId: optional(type.number)
}// ...&lt;SpecialForm structure={schema} {/* ... */}/&gt;
  {/* maybe add own elements too */}
&lt;/SpecialForm&gt;
</code></pre><p>Which then renders the needed elements for the fields <em>name</em> and <em>customerId</em>, providing labels or messages via an configuration object.</p>
<h2 id="a-mix-of-model-and-view-driven">A Mix of Model and View Driven</h2>
<p>Another approach is to tackle the problem from both, the model and the view side. Using the model for the validation and abstracting over the regular form elements interconnected via <em>ContextType</em> i.e.</p>
<h2 id="redux--state-management-driven">Redux / State Management Driven</h2>
<p>Then of course there is always the possibility to use existing state management solutions like Redux and others to handle the form state. In the most simplest case using <strong>*react-redux*</strong> <code>connect</code> to add state management capabilities to a container containing the form.</p>
<h2 id="back-to-square-one-some-background-on-forms-in-react">Back to square one: Some Background on Forms in React.</h2>
<p>Before we continue, let’s take a step back and see what surprises most people when they start working with forms in React. A common question is: <em>How do we validate and update our form fields?</em> To answer that question, we need to refer back to the <a href="https://facebook.github.io/react/docs/uncontrolled-components.html" target="_blank" rel="noopener">Uncontrolled Forms</a> and <a href="https://facebook.github.io/react/docs/forms.html" target="_blank" rel="noopener">Controlled Forms</a> sections in the React documentation. So, one can either access the form state via refs, in case of uncontrolled forms or use the value attribute and set the field values manually. With the latter being the recommended solution.</p>
<p>Ok, let’s build a form containing a couple of fields, just to get a sense of how this would be done in the real world. Before we start the initial iteration, let’s take a look at the actual form data:</p>
<pre tabindex="0"><code>type Data = {
  firstName: string,
  lastName: string,
  userName: string,
  confirmUserName: string,
  notifications: boolean,
}
</code></pre><p>So let’s see how the form would look like based on what we know:</p>
<pre tabindex="0"><code>// render function ...
&lt;form onSubmit={handleSubmit}&gt;
  &lt;label&gt;
    First Name:
    &lt;input
      type=&#34;text&#34;
      name=&#34;firstName&#34;
      value={state.firstName}
      onChange={handleChange}
    /&gt;
  &lt;/label&gt;
  &lt;label&gt;
    Last Name:
    &lt;input
      type=&#34;text&#34;
      name=&#34;lastName&#34;
      value={state.lastName}
      onChange={handleChange}
    /&gt;
  &lt;/label&gt;
  &lt;label&gt;
    User Name:
    &lt;input
      type=&#34;text&#34;
      name=&#34;userName&#34;
      value={state.userName}
      onChange={handleChange}
    /&gt;
  &lt;/label&gt;
  &lt;label&gt;
    Confirm User Name:
    &lt;input
      type=&#34;text&#34;
      name=&#34;confirmUserName&#34;
      value={state.confirmUserName}
      onChange={handleChange}
    /&gt;
  &lt;/label&gt;
  &lt;label&gt;
    Notifications:
    &lt;input
      name=&#34;notifications&#34;
      type=&#34;checkbox&#34;
      checked={state.notifications}
      onChange={handleChange} /&gt;
  &lt;/label&gt;
  &lt;br /&gt;
  &lt;label&gt;
  &lt;input type=&#34;submit&#34; value=&#34;Submit&#34; /&gt;
&lt;/form&gt;
</code></pre><p>Now that we have the form setup sans the state handling capabilities, let’s implement <code>handleChange</code> to control the actual form state. Again, let’s follow the documentation and add the above functions just as described in the <a href="https://facebook.github.io/react/docs/forms.html#handling-multiple-inputs" target="_blank" rel="noopener">documentation</a>.</p>
<pre tabindex="0"><code>handleChange(event) {
  const target = event.target;

  this.setState({
    [ target.name]: target.type === &#39;checkbox&#39;
      ? target.checked
      : target.value
  });
}
</code></pre><p>Currently the form is uncontrolled per definition, so we still need to pass in an initial state, which could be done inside the constructor.</p>
<pre tabindex="0"><code>constructor(props) {
  super(props)
  this.state = {
    firstName: &#39;&#39;,
    lastName: &#39;&#39;,
    userName: &#39;&#39;,
    confirmUserName: &#39;&#39;,
    notifications: false
  }
}
</code></pre><p>So, this is it, we have a controlled form up and running. You can find the example <a href="http://jsbin.com/fisecutojo/14/edit?js,console,output" target="_blank" rel="noopener"><strong>here</strong></a>.</p>
<p>Now that we have the basics out the way, let’s focus on how to make our form management more efficient.</p>
<p>The state management can be extracted into a Higher Order Component. Leaving the actual visual representation to the wrapped component. Here’s a quick example sans any optimizations:</p>
<iframe src="https://medium.com/media/67b17ab989c0614b984cb2659dd513cb" allowfullscreen="" frameborder="0" height="765" width="680" title="HigherOrderComponentValidateExample.js" class="ek n fc dx bg" scrolling="no" style="box-sizing: inherit; top: 0px; width: 680px; height: 765px; position: absolute; left: 0px;"></iframe>
<p>We’re able to pass in the <em>Form</em> via <code>enhancedForm(Form)</code> and use it like this:</p>
<pre tabindex="0"><code>&lt;Form initialState={initialState} /&gt;
</code></pre><p>You can find the code <a href="https://gist.github.com/busypeoples/6f2ead1dac8e47eb61b459eb8b24026f" target="_blank" rel="noopener"><strong>here</strong></a> and the example <a href="http://jsbin.com/nuxadodigu/edit?js,console,output" target="_blank" rel="noopener"><strong>here</strong></a><strong>.</strong></p>
<h2 id="back-to-the-efficiency-topic">Back to the Efficiency Topic</h2>
<p>As we have seen, creating the form structure is not the problem here, it even leaves us more room on deciding how these inputs can be styled, so we can see that the initial JSX or view code we need to write is maybe repetitive but nothing worth abstracting away and sacrificing flexibility for. Now we are free to choose a UI library to render our inputs or we can move these labels or error message anywhere we want to. This is not the real problem.</p>
<h2 id="validation">Validation</h2>
<p>Now if you recall, our form has no validation capabilities yet. So let’s see how we can approach the validation topic in a cautious manner, just because as opposed to state management, which can be solved with a single function, we need to think about how validation needs to happen from a user perspective. Does validation occur <code>onChange</code> or <code>onBlur</code> or <code>onKeyUp</code>? Or will the form values be validated when submitting the form?</p>
<p>We can identify two things here: the state is updated on every change when working with a controlled form, while the validation could happen at a different point in time. The following ideas I’m presenting are not new, I have previously written about these concepts <a href="https://medium.com/javascript-inside/form-validation-as-a-higher-order-component-pt-1-83ac8fd6c1f0" target="_blank" rel="noopener"><em>here</em></a> and <a href="https://medium.com/javascript-inside/form-validation-as-a-higher-order-component-pt-2-1edb7881870d#.t3xiogoe5" target="_blank" rel="noopener"><em>here</em></a>.</p>
<p>The predicate functions are not Form specific, so writing something like this inside a <code>validate</code> function can be easily avoided.</p>
<pre tabindex="0"><code>const errors = {}if (this.state.street.length &lt;= 3) {
  error.street = &#39;Street has min length of 4&#39;
}
</code></pre><p>We can extract the validation from the form very easily by defining predicate functions that we apply with the provided input. So we can write a couple of predicate functions and compose them to bigger functions, each expecting and validating an input.</p>
<pre tabindex="0"><code>import {
  compose,
  curry,
  path,
  prop,
} from &#39;ramda&#39;


// validations
const isNotEmpty = a =&gt; a.trim().length &gt; 0const hasCapitalLetter = a =&gt; /[A-Z]/.test(a)const isGreaterThan = curry((len, a) =&gt; (a &gt; len))const isLengthGreaterThan = len =&gt;
  compose(isGreaterThan(len), prop(&#39;length&#39;))
</code></pre><p>We can also resort to existing validation libraries and just add the missing validations for any specific cases we might need covered. This means we can easily run an array of predicates against an input and collect the error messages. For example <a href="https://github.com/25th-floor/spected" target="_blank" rel="noopener"><strong>Spected</strong></a>, a library I have written, does exactly this:</p>
<pre tabindex="0"><code>const validationRules = {
  name: [
    [ isGreaterThan(5),
      `Minimum Name length of 6 is required.`
    ],
  ],
  random: [
    [ isGreaterThan(7), &#39;Minimum Random length of 8 is required.&#39; ],
    [ hasCapitalLetter,
      &#39;Random should contain at least one uppercase letter.&#39;
    ],
  ]
}
</code></pre><p>We’re defining <code>[predicateFunction, errorMsg]</code> for every input and then letting the predicates run against that input. Our previous validation can be rewritten to the following:</p>
<pre tabindex="0"><code>const spec = {
  street: [[isLengthGreaterThan(3), &#39;Street has min length of 4&#39;]]
}
</code></pre><p>And we can validate the input against that spec.</p>
<pre tabindex="0"><code>spected(spec, {street: &#39;foo&#39;})
</code></pre><p>This is one possible way to decouple the <em>input</em> from the <em>predicates</em> and the <em>error messages</em>. There are other ways to validate and up to of the form library on how you want to achieve this. Taking the aforementioned route enables us to quickly compose small specs to bigger specs or change the error messages depending on the project.</p>
<h2 id="connecting-the-dots">Connecting the Dots</h2>
<p>So once we have a solution for validating the input independent from the form itself, we will want to connect the validation with the form.</p>
<p>Our Higher Order Component needs access to the validation <code>rules</code> . Expanding on the basics, let’s see how we can tackle all the different situations where a validation might occur, without locking the user from being able to define specific behaviours when needed.</p>
<p>We need to rethink our initial approach and enable user land to define and name specific functions as needed while keeping the state handling inside the higher order component.</p>
<p>What if we enable to override existing defaults when calling our form library? Enabling to define every single action upfront and then passing these functions to the wrapped component enables us to provide sane defaults that can be easily overridden.</p>
<pre tabindex="0"><code>const createForm = ({
  // define functions like onChange, validate etc.
}) =&gt; {
  // define and return class
}
</code></pre><p>Let’s implement a basic variant of that idea. All we want to do is update the state, when needed, at first.</p>
<pre tabindex="0"><code>const createForm = ({
  mapSetStateToProps = (updateState, actions) =&gt; ({
    onChange: e =&gt; {
      const { name, value } = getValueName(e)
      return updateState(actions.update(name, value))
    },
  }),
  actions = {
    update: (name, value, state) =&gt; {
      return [assocPath([&#39;values&#39;, name], value, state)]
    },
  }
}) =&gt; Component =&gt; {}
</code></pre><p>Ok, so if you glance over the example, we can see that we defined a <code>mapSetStateToProps</code> function and an <code>actions</code> object. Like the name implies we are defining functions available to the wrapped component. By receiving an update function (think of an extended <code>setState</code>) and actions we are able to define specific functions and trigger actions corresponding to any events triggered inside the wrapped form. The actions handle common tasks like <em>update</em> or <em>validate</em>. What actions do is calculate the new state and return a <em>next state</em> and a <em>callback</em> tuple. The callback can be fired when the setState callback is fired, useful when we want to do actions after the user has submitted any actions.</p>
<p>So any function defined in <code>mapSetStateToProps</code> takes care of calling the correct action and returning the results back to the passed in <code>updateState</code> function. Our actions only calculate the state. Separating the actual calculation from the specific action opens up a number of interesting opportunities as we will see.</p>
<p>But to get this refactored higher order component to work, we will need to find away on how to connect the mapStateToProps to the actual component.</p>
<pre tabindex="0"><code>const createForm = ({
  mapSetStateToProps,
  actions,
}) =&gt; Component =&gt; {
  return class HigherOrderFormComponent extends React.Component {
    constructor(props) {
      super(props)
      this.state = { values:props.values }
      this.actions = R.map(
        f =&gt; (...args) =&gt; f(...args, this.state),
        actions
      )
    }

    updateState = (setState) =&gt; {
      const [setStateFn, cb = () =&gt; {}] = setState
      this.setState(setStateFn, () =&gt; cb(this.state))
    }

    render() {
      const dispatchers =
        mapSetStateToProps(this.updateState, this.actions)
      return React.createElement(Component, {
        ...this.props,
        ...dispatchers,
        state: this.state.values,
      })
    }
  }
}
</code></pre><p>There is not really too much we need, to connect the actions with the actual component. Inside the constructor we map over the actions and wrap those inside another function which then passes in the actual arguments as well as the current state on to the action.</p>
<p>The <code>updateState</code> method destructs the passed in tuple to <em>nextState</em> and <em>callback</em> and then calls <code>setState</code> and passes in that defined <em>nextState</em>.</p>
<p>So we should have a running form again, what’s left is to pass in form values.</p>
<pre tabindex="0"><code>const enhanceForm = createForm({})
const EnhancedForm = enhanceForm(Form)

&lt;EnhancedForm values={values} /&gt;
</code></pre><p>You can find a working example <a href="http://jsbin.com/bebezizego/1/edit?html,js,output" target="_blank" rel="noopener"><strong>here</strong></a>.</p>
<h2 id="validation-1">Validation</h2>
<p>Once we have validation rules defined, we can run these against the actual form state and keep track of any errors via local state, which we can pass down to the wrapped component again. But we know for a fact that the validation itself can be detached from the actual field value update, i.e. validating <code>oBlur</code>. Let’s see how this would work by writing some actual code.</p>
<p>First off we will add a new method <code>validate</code> to our existing <code>mapSetStateToProps</code> function as well as the corresponding <code>action</code> , which receives a name and a value and runs the validation against the corresponding spec for that given name.</p>
<p>If you recall we passed in the current state to the defined action functions. Let’s extend actions to also receive an object containing the component’s props as well as the defined <em>validate</em> function. But where is the <em>validate</em> function defined actually?</p>
<p>So, let’s extend the configuration object to also accept a <code>validate</code> property. Our <code>validate</code> is an object containing two functions, one for validating single fields, the other for validating all fields.</p>
<pre tabindex="0"><code>validateFns = {
  all: (data) =&gt;
    spected(basicValidationRules, data),
  input: (name, value) =&gt;
    spected(
      pick([name], basicValidationRules), {[name]: value}
    )
}
</code></pre><p>Now we can pass the specific validation via the <em>config</em> object.</p>
<pre tabindex="0"><code>createForm({ validate: validateFns })
</code></pre><p>And the our higher order component might look like this now.</p>
<pre tabindex="0"><code>const createForm = ({
  validate,
  mapSetStateToProps = (updateState, actions) =&gt; ({
    // ...
    validate: e =&gt; {
      const { name, value } = getValueName(e)
      return updateState(actions.validate(name, value))
    },
    // ...
  }),
  actions: {
    validate: (name, value, state, {validate}) =&gt; {
      return [
        R.assoc(&#39;errors&#39;, validate.input(name, value), state)
      ]
    },
  }
}
</code></pre><p>The returned result for running the <code>validate</code> input function is an object consisting of the field name and an array of error messages in our case.</p>
<pre tabindex="0"><code>{ firstName: [&#39;First Name is required&#39;] } // in case of an error
{ firstName: [] } // in case of success
</code></pre><p>Then we merge the returned result with the current error state and update the actual state. So there is not too much involved in handling field validations on a form level. A second method <code>validateAll</code> as the name implies will validate all form values, i.e. when validating after submitting the form as opposed to dynamic <code>onChange</code> or <code>onBlur</code> validations.</p>
<pre tabindex="0"><code>validateAll: (cbFn, state, { validate }) =&gt; {
  return [
    assoc(&#39;errors&#39;, validate.all(state.values), state),
    (state) =&gt; {
      if (isValid(state.errors)) {
        cbFn(state.values)
      }
    }
  ]
}
</code></pre><p>You might have noticed that we’re returning a tuple this time. The nextState as well as a callback that should run when React’s <code>setState</code> has finished. The callback should fire when our form is valid and we want to call a passed in function that passes up the form values up the tree again.</p>
<p>Finally let’s add an <code>onSubmit</code> prop, so we can run the validations and pass up the values.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">mapSetStateToProps</span> <span class="o">=</span> <span class="p">(</span><span class="nx">updateState</span><span class="p">,</span> <span class="nx">actions</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">onSubmit</span><span class="o">:</span> <span class="p">(</span><span class="nx">onsSubmitFn</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">updateState</span><span class="p">(</span><span class="nx">actions</span><span class="p">.</span><span class="nx">validateAll</span><span class="p">(</span><span class="nx">onsSubmitFn</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}),</span>
</span></span></code></pre></div><p>So what’s still missing? What about if we wanted to update the local field state and validate at the same time. The same principle applies we define the prop and a corresponding action. Here is the code for our implementation.</p>
<p><a href="https://gist.github.com/busypeoples/ec79da7da72bc6cd6bc240810f54a511#file-higherordercomponentvalidationexample-js" target="_blank" rel="noopener">HigherOrderComponentValidationExample.jsClone with Git or checkout with SVN using the repository&rsquo;s web address.gist.github.com</a></p>
<p>There are still a number of possible optimization regarding the current code, but it should give an overview of where this is heading. By doing the minimal work, of keeping state of values and errors, we open up the possibilities for user land to define the specific actions as needed.</p>
<p>You can also checkout the <a href="https://www.webpackbin.com/bins/-KoNgC1Hkd1AdDnZM0gG" target="_blank" rel="noopener"><strong>demo for our current example</strong></a>.</p>
<h2 id="whats-next">What’s Next?</h2>
<p>In part 2 we will focus on asynchronous actions, how to debounce and how to react to the current form state, i.e. switching to dynamic inline validation as soon as the form has been submitted for the very first time etc.</p>

          </div>

          



          
          
          <div class="article-widget">
            
<div class="container-xl row post-nav">
  
  
</div>

          </div>
          

        <div class="body-footer">
          <p>最近更新于 0001-01-01</p>

          



          


  
  
  

  

  
  <section id="comments" class="mb-3 pt-0">
    
<div id="disqus_thread"></div>
<script>
  var disqus_config = function () {
    
    
    
  };
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
      return;
    }
    var d = document, s = d.createElement('script'); 
    s.async = true;
    s.src = 'https://' + "ngte" + '.disqus.com/embed.js';
    
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  </section>
  



          


        </div>

      </article>

      <footer class="site-footer">

  



  

  
  <div class="copyright py-4 bg-footer">
      <div class="row justify-content-center">
        <div class="text-center footer-color">
          <p class="mb-0">© 2017-2022 NGTE all rights reserved</p>
        </div>
    </div>
  </div>

  <script type="text/javascript" id="clstr_globe" async src="//clustrmaps.com/globe.js?d=kgpJG5sWZQpKujBmD-uW1B54-WBPol-DuDtrB2KFjKs"></script>
  
</footer>


    </main>
  </div>
</div>
<script src="//unpkg.com/heti/umd/heti-addon.min.js"></script>
<script>
  const heti = new Heti('.article');
  heti.autoSpacing();
</script>
<script type="text/javascript">
  window.$crisp = [];
  window.CRISP_WEBSITE_ID = "12adcc35-9621-4313-8262-62dc654b29d8";
  (function () {
    setTimeout(function() {
      d = document;
      s = d.createElement("script");
      s.src = "https://client.crisp.chat/l.js";
      s.async = 1;
      d.getElementsByTagName("head")[0].appendChild(s);
    }, 2500);
  })();
</script>
  </div>

  <div class="page-footer">
    
    
  </div>

      

    
    <script src="/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js"></script>

    
    
    
      

      
      

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
        
        
      

    

    
    
    

    
    
    
      
      <script id="search-hit-algolia-template" type="text/html">
        <div class="search-hit">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a>
            </div>
            <div class="article-metadata search-hit-type">{{type}}</div>
            <p class="search-hit-description">{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p>
          </div>
        </div>
      </script>
      
        <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js" crossorigin="anonymous"></script>
      
      
    

    
    

    
    
    
    
      <script id="dsq-count-scr" src="https://ngte.disqus.com/count.js" async></script>
      
    

    
    
      
      
      
      
      
      
      
    

    
    <script src="/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js" type="module"></script>
    

    
    
    
    <script id="page-data" type="application/json">{"use_headroom":false}</script>

    
    
    
    
    
    
    
    
    
    
    <script src="/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js"></script>

    
    
    
    
    
    
    <script>

var mybutton = document.getElementById("backTopBtn");


window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}


function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>


    

    
    
    <script src="https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    <script>



(function() {
  'use strict';

  if(!document.queryCommandSupported('copy')) {
    return;
  }

  function flashCopyMessage(el, msg) {
    el.className = "highlight-copy-btn";
    el.textContent = msg;
    setTimeout(function() {
      el.textContent = "";
      el.className = "highlight-copy-btn fa fa-copy";
    }, 1000);
  }

  function selectText(node) {
    var selection = window.getSelection();
    var range = document.createRange();
    range.selectNodeContents(node);
    selection.removeAllRanges();
    selection.addRange(range);
    return selection;
  }

  function addCopyButton(containerEl) {
    var copyBtn = document.createElement("button");
    copyBtn.className = "highlight-copy-btn fa fa-copy";
    copyBtn.textContent = "";

    var codeEl = containerEl.firstElementChild;
    copyBtn.addEventListener('click', function() {
      try {
        var selection = selectText(codeEl);
        document.execCommand('copy');
        selection.removeAllRanges();
        
        flashCopyMessage(copyBtn, '已复制')
        
      } catch(e) {
        console && console.log(e);
        flashCopyMessage(copyBtn, 'Failed :\'(')
      }
    });

    containerEl.appendChild(copyBtn);
  }

  
  var highlightBlocks = document.getElementsByClassName('highlight');
  Array.prototype.forEach.call(highlightBlocks, addCopyButton);
})();
</script>

    


</body>
</html>
