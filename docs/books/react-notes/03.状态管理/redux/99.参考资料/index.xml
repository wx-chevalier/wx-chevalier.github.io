<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>99.å‚è€ƒèµ„æ–™ | Next-gen Tech Edu</title><link>https://ng-tech.icu/books/react-notes/03.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/</link><atom:link href="https://ng-tech.icu/books/react-notes/03.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/index.xml" rel="self" type="application/rss+xml"/><description>99.å‚è€ƒèµ„æ–™</description><generator>Wowchemy (https://wowchemy.com)</generator><language>zh</language><image><url>https://ng-tech.icu/media/sharing.png</url><title>99.å‚è€ƒèµ„æ–™</title><link>https://ng-tech.icu/books/react-notes/03.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/</link></image><item><title>2020-Stale props and zombie children in Redux</title><link>https://ng-tech.icu/books/react-notes/03.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-stale-props-and-zombie-children-in-redux/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://ng-tech.icu/books/react-notes/03.%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/redux/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-stale-props-and-zombie-children-in-redux/</guid><description>&lt;blockquote>
&lt;p>&lt;a href="https://kaihao.dev/posts/Stale-props-and-zombie-children-in-Redux" target="_blank" rel="noopener">Original&lt;/a>ï¼Œ&lt;a href="https://github.com/xitu/gold-miner/blob/master/article/2020/Stale-props-and-zombie-children-in-Redux.md" target="_blank" rel="noopener">ä¸­æ–‡ç¿»è¯‘&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h1 id="stale-props-and-zombie-children-in-redux">Stale props and zombie children in Redux&lt;/h1>
&lt;p>å¦‚æœä½ è¯»äº† &lt;code>react-redux&lt;/code> v7 å‘è¡Œç‰ˆæœ¬çš„æ–‡æ¡£ï¼Œä½ å¯èƒ½ä¼šç¢°åˆ°&lt;a href="https://react-redux.js.org/api/hooks#stale-props-and-zombie-children" target="_blank" rel="noopener">è¿‡æ—¶çš„ props å’Œâ€œåƒµå°¸å­èŠ‚ç‚¹â€&lt;/a>è¿™ç¯‡æ–‡ç« ä¸­æåˆ°çš„éƒ¨åˆ†é—®é¢˜ã€‚å³ä½¿å®ƒå·²ç»å†™çš„éå¸¸æ¸…æ™°æ˜äº†ï¼Œä½†å¯¹äºä¸ç†Ÿæ‚‰è¿™ä¸ªé—®é¢˜çš„äººæ¥è¯´ä¼šæ„Ÿåˆ°è¿·èŒ«ã€‚è¿™ç¯‡æ–‡ç« æ·±å…¥æ¢ç©¶äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶è®²è§£äº† &lt;code>react-redux&lt;/code> æ˜¯å¦‚ä½•è§£å†³çš„ã€‚&lt;/p>
&lt;h2 id="ç†è§£-react-redux">ç†è§£ &lt;code>react-redux&lt;/code>&lt;/h2>
&lt;p>è¦ç†è§£è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆç†è§£ &lt;code>Redux&lt;/code>ï¼Œæˆ–è€…æ›´å…·ä½“çš„æ¥è¯´æ˜¯ &lt;code>react-redux&lt;/code>ã€‚æˆ‘ä»¬å°†é€šè¿‡é‡æ–°å®ç° &lt;code>Redux&lt;/code> å’Œ &lt;code>react-redux&lt;/code> çš„æ ¸å¿ƒåŠŸèƒ½æ¥è¿›è¡Œç†è§£ã€‚æ³¨æ„ï¼Œè¿™åªæ˜¯ä¸ºäº†æ¼”ç¤ºçš„ç›®çš„ï¼Œå› æ­¤æˆ‘ä»¬ä¸ä¼šé‡æ„æ¯ä¸€ä¸ªåŠŸèƒ½å¹¶å¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼Œåªæ˜¯è¶³ä»¥è®©æˆ‘ä»¬ç†è§£æˆ‘ä»¬éœ€è¦è§£å†³çš„é—®é¢˜ã€‚&lt;/p>
&lt;p>&lt;code>Redux&lt;/code> çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªåœ¨å…¨å±€çŠ¶æ€çº§åˆ«ä¸Šå¼ºåˆ¶ä½¿ç”¨ Flux æ¨¡å¼æ“ä½œçš„è®¢é˜…æ¨¡å‹ã€‚åœ¨ JavaScript ä¸­ä¸€ä¸ªè®¢é˜…æ¨¡å‹é€šå¸¸é€šè¿‡åˆ©ç”¨äº‹ä»¶ç›‘å¬å™¨æ¥å®ç°çš„ã€‚æˆ‘ä»¬ &lt;code>subscribe&lt;/code> æ›´æ”¹å¹¶é€šè¿‡ &lt;code>reducers&lt;/code> æ”¹å˜çŠ¶æ€ï¼Œå¹¶å‘å¸ƒç»“æœç»™æ¯ä¸€ä¸ªç›‘å¬è€…ä»¥æ‰§è¡Œæ›´æ–°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">createStore&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">reducer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">initialState&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{})&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">let&lt;/span> &lt;span class="nx">state&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">initialState&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">listeners&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">getState&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">state&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">subscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">listener&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">listeners&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">listener&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Returns an unsubscribe function
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">index&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">listeners&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">indexOf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">listener&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">listeners&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">splice&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">index&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">dispatch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">action&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">state&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">reducer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">action&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">listeners&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">forEach&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">listener&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">listener&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸Šé¢æ˜¯ä¸€ä¸ª &lt;code>Redux&lt;/code> çš„ &lt;code>createStore&lt;/code> API çš„ç®€å•å®ç°ï¼Œæˆ‘ä»¬åˆ›å»ºçš„ &lt;code>store&lt;/code> å¯ä»¥ä½¿ç”¨ &lt;code>getState()&lt;/code> æ¥è·å–çŠ¶æ€ï¼Œé€šè¿‡ &lt;code>subscribe(listener)&lt;/code> æ¥è®¢é˜…ç›‘å¬å™¨ï¼Œä»¥åŠé€šè¿‡ &lt;code>dispatch(action)&lt;/code> æ¥åˆ†å‘åŠ¨ä½œï¼ˆdispatch actionï¼‰ï¼Œå°±åƒæˆ‘ä»¬ä¹ æƒ¯ä½¿ç”¨çš„å®˜æ–¹ API ä¸€æ ·ã€‚&lt;/p>
&lt;p>ä¸‹ä¸€æ­¥æ˜¯å¼„æ˜ç™½å¦‚ä½•å°†å…¶å’Œ &lt;code>React&lt;/code> é›†æˆã€‚æˆ‘ä»¬å°†æ„å»ºä¸€ä¸ª &lt;a href="https://react-redux.js.org/api/provider" target="_blank" rel="noopener">&lt;code>&amp;lt;Provider&amp;gt;&lt;/code>&lt;/a> ç»„ä»¶é€šè¿‡ä¸Šä¸‹æ–‡ä¼ é€’ &lt;code>store&lt;/code>ï¼Œä¸€ä¸ª &lt;a href="https://react-redux.js.org/api/connect" target="_blank" rel="noopener">&lt;code>connect&lt;/code>&lt;/a> é«˜é˜¶ç»„ä»¶ç”¨äºåŒ…è£…å±•ç¤ºç»„ä»¶ï¼Œæœ€è¿‘çš„ç‰ˆæœ¬ä¸­ï¼Œ&lt;a href="https://react-redux.js.org/api/hooks#useselector" target="_blank" rel="noopener">&lt;code>useSelector&lt;/code>&lt;/a> é’©å­åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å–ä»£ &lt;code>connect&lt;/code>ã€‚&lt;/p>
&lt;p>&lt;code>&amp;lt;Provider&amp;gt;&lt;/code> API ç›¸å¯¹ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡ &lt;code>React&lt;/code> ä¸Šä¸‹æ–‡ä¼ é€’ç”± &lt;code>createStore&lt;/code> åˆ›å»ºçš„ &lt;code>store&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">Context&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">createContext&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">Provider&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">({&lt;/span> &lt;span class="nx">children&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">store&lt;/span> &lt;span class="p">})&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Context.Provider&lt;/span> &lt;span class="na">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">}&amp;gt;{&lt;/span>&lt;span class="nx">children&lt;/span>&lt;span class="p">}&amp;lt;/&lt;/span>&lt;span class="nt">Context.Provider&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>åœ¨æˆ‘ä»¬è¿›å…¥ &lt;code>connect&lt;/code> å’Œ &lt;code>useSelector&lt;/code> çš„å®ç°ä¹‹å‰ï¼Œæœ€å¥½é€šè¿‡ä¸€ä¸ªå®ä¾‹æ¥å›é¡¾ä¸€ä¸‹æˆ‘ä»¬æ­£åœ¨å¤„ç†çš„é—®é¢˜ã€‚å®ç°ç»†èŠ‚å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äº &lt;code>Redux&lt;/code> çš„å†å²ï¼Œå¦‚æœæˆ‘ä»¬å¯¹è¦è§£å†³çš„é—®é¢˜æœ‰æ‰å®çš„èƒŒæ™¯ä¼šæ›´å¥½ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ›´è½»æ¾çš„è®¨è®ºå®ç°çš„æ¼”å˜ã€‚&lt;/p>
&lt;h2 id="é—®é¢˜">é—®é¢˜&lt;/h2>
&lt;p>è®©æˆ‘ä»¬å¿«é€Ÿå›é¡¾ä¸€ä¸‹æˆ‘ä»¬è¦è§£å†³çš„é—®é¢˜çš„&lt;a href="https://react-redux.js.org/api/hooks#stale-props-and-zombie-children" target="_blank" rel="noopener">å®šä¹‰&lt;/a>ã€‚&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>è¿‡æ—¶çš„ props&lt;/strong> æ„å‘³ç€åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼š&lt;/p>
&lt;ul>
&lt;li>é€‰æ‹©å™¨å‡½æ•°ä¾èµ–äºæ­¤ç»„ä»¶çš„ props æ¥æå–æ•°æ®&lt;/li>
&lt;li>åŠ¨ä½œçš„ç»“æœä¼šå¯¼è‡´çˆ¶ç»„ä»¶&lt;strong>å°†&lt;/strong>é‡æ–°æ¸²æŸ“å¹¶ä¼ é€’æ–°çš„ props&lt;/li>
&lt;li>ä½†æ˜¯ï¼Œåœ¨è¯¥ç»„ä»¶æœ‰æœºä¼šä½¿ç”¨é‚£äº›æ–°çš„ props é‡æ¸²æŸ“ä¹‹å‰ï¼Œè¿™ä¸ªç»„ä»¶çš„é€‰æ‹©å™¨å‡½æ•°å°±ä¼šæ‰§è¡Œ&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>åƒµå°¸å­èŠ‚ç‚¹&lt;/strong>ä¸“é—¨æŒ‡ä»¥ä¸‹æƒ…å†µï¼š&lt;/p>
&lt;ul>
&lt;li>é¦–å…ˆï¼ŒæŒ‚è½½äº†å¤šä¸ªåµŒå¥—ä¸”ç›¸å…³è”çš„ç»„ä»¶ï¼Œå¯¼è‡´å­ç»„ä»¶åœ¨çˆ¶ç»„ä»¶å‰è®¢é˜…äº† &lt;code>store&lt;/code>&lt;/li>
&lt;li>åˆ†å‘ä¸€ä¸ªä» &lt;code>store&lt;/code> ä¸­åˆ é™¤æ•°æ®çš„åŠ¨ä½œï¼Œä¾‹å¦‚åˆ é™¤ä¸€ä¸ª todo é¡¹&lt;/li>
&lt;li>çˆ¶ç»„ä»¶å°†å› æ­¤åœæ­¢æ¸²æŸ“è¯¥å­ç»„ä»¶&lt;/li>
&lt;li>ä½†æ˜¯ï¼Œç”±äºå­ç»„ä»¶å…ˆè¿›è¡Œäº†è®¢é˜…ï¼Œå®ƒçš„è®¢é˜…æ‰§è¡Œäºçˆ¶ç»„ä»¶åœæ­¢æ¸²æŸ“å®ƒä¹‹å‰ï¼Œå½“å®ƒåŸºäº props ä» &lt;code>store&lt;/code> ä¸­è¯»å–ä¸€ä¸ªå€¼æ—¶ï¼Œè¿™ä¸ªæ•°æ®ä¸å¤å­˜åœ¨ï¼Œå¹¶ä¸”å¦‚æœè¯»å–é€»è¾‘ä¸å®Œå–„çš„è¯ï¼Œåˆ™å¯èƒ½å¼•å‘é”™è¯¯ã€‚&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>å¦‚æœä½ ä»”ç»†çš„é˜…è¯»ä»¥ä¸Šå†…å®¹ï¼Œä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†ï¼Œè¿™äº›é—®é¢˜ä¸æ˜¯ä¸¤ä¸ªåˆ†å¼€çš„é—®é¢˜ï¼Œè€Œæ˜¯ä¸€ä¸ªå•ç‹¬çš„é—®é¢˜ã€‚ä»–ä»¬éƒ½æ˜¯&lt;strong>è¿‡æ—¶çš„ props&lt;/strong> é—®é¢˜ï¼Œ&lt;strong>åƒµå°¸å­èŠ‚ç‚¹&lt;/strong>æè¿°äº†ä¸€ä¸ªç‰¹å®šåœºæ™¯å¸¸è§çš„å­é—®é¢˜ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ç°åœ¨è¿˜ä¸å¿…äº†è§£æ‰€æœ‰å®šä¹‰ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œæä¾›ä¸€ä¸ªç¤ºä¾‹æ¥æ¼”ç¤ºä»£ç é—®é¢˜ã€‚&lt;/p>
&lt;h2 id="ä¸€ä¸ªä¾‹å­">ä¸€ä¸ªä¾‹å­&lt;/h2>
&lt;p>æˆ‘ä»¬å°†æ„å»ºçš„ç¤ºä¾‹æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ Todo åº”ç”¨ç¨‹åºï¼ˆæˆ‘çŸ¥é“ï¼Œduhï¼‰ï¼Œè¿™ä¸ªåº”ç”¨ç¨‹åºå°†ç®€å•çš„æ¸²æŸ“ä¸€ç»„ &lt;code>todos&lt;/code>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ†å‘ &lt;code>DELETE&lt;/code> åŠ¨ä½œæ¥åˆ é™¤å…¶ä¸­çš„ä¸€ä¸ªã€‚&lt;/p>
&lt;p>é¦–å…ˆï¼Œæˆ‘ä»¬ç»§ç»­ï¼Œåˆ›å»ºä¸€ä¸ª &lt;code>store&lt;/code> å’Œå¯¹åº”çš„ &lt;code>reducer&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">reducer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">action&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">switch&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">action&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">type&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">case&lt;/span> &lt;span class="s2">&amp;#34;DELETE&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">...&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">todos&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">todos&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">filter&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">todo&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">todo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span> &lt;span class="o">!==&lt;/span> &lt;span class="nx">action&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">payload&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">default&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">state&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">store&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">createStore&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">reducer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">todos&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">[{&lt;/span> &lt;span class="nx">id&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;a&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">content&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;A&amp;#34;&lt;/span> &lt;span class="p">}],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç„¶åï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª &lt;code>&amp;lt;todo&amp;gt;&lt;/code> ç»„ä»¶ï¼Œå¹¶ä½¿ç”¨ &lt;code>connect&lt;/code> è¿›è¡ŒåŒ…è£…ï¼ˆ&lt;strong>æˆ‘ä»¬åœ¨è¿™ä»…ä½¿ç”¨ &lt;code>connect&lt;/code> é«˜é˜¶ç»„ä»¶æ„å»º APIã€‚ç¨åå†è®¨è®º &lt;code>useSelector&lt;/code>&lt;/strong>ï¼‰ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">Todo&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">({&lt;/span> &lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">content&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">dispatch&lt;/span> &lt;span class="p">})&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">li&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">onClick&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">dispatch&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">type&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;DELETE&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">payload&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">id&lt;/span> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="nx">content&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">li&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">TodoContainer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">connect&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ownProps&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">content&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">todos&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">find&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">todo&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">todo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="nx">ownProps&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">content&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}))(&lt;/span>&lt;span class="nx">Todo&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">TodoList&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">({&lt;/span> &lt;span class="nx">todos&lt;/span> &lt;span class="p">})&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">ul&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="nx">todos&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">map&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">todo&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TodoContainer&lt;/span> &lt;span class="na">key&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">todo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="na">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">todo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">))}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">ul&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">TodoListContainer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">connect&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">todos&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">todos&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}))(&lt;/span>&lt;span class="nx">TodoList&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">ReactDOM&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">render&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Provider&lt;/span> &lt;span class="na">store&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">}&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">TodoListContainer&lt;/span> &lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Provider&lt;/span>&lt;span class="p">&amp;gt;,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">document&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getElementById&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;root&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸¤ä¸ªå±•ç¤ºç»„ä»¶ &lt;code>&amp;lt;Todo&amp;gt;&lt;/code> å’Œ &lt;code>&amp;lt;TodoList&amp;gt;&lt;/code>ï¼Œç„¶åç”¨ &lt;code>connect&lt;/code> é«˜é˜¶ç»„ä»¶è¿›è¡ŒåŒ…è£…ã€‚è¿™åªæ˜¯ä½¿ç”¨ &lt;code>Redux&lt;/code> æ¨¡å¼è¿›è¡Œç¼–å†™çš„ä¸€ä¸ªéå¸¸ç®€å•åŸºç¡€çš„ Todo åº”ç”¨ç¨‹åºçš„ç¤ºä¾‹ï¼Œæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„ã€‚&lt;/p>
&lt;p>å¦‚æœæˆ‘ä»¬è¿è¡Œè¿™ä¸ªåº”ç”¨ç¨‹åºå¹¶ç‚¹å‡»ä»»ä½• &lt;code>&amp;lt;Todo&amp;gt;&lt;/code> é¡¹ï¼Œæˆ‘ä»¬å¸Œæœ›å°†å…¶åˆ é™¤ã€‚&lt;/p>
&lt;p>ç°åœ¨ï¼Œæˆ‘ä»¬äº†è§£äº†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè§„èŒƒï¼Œæˆ‘ä»¬å°†åœ¨ &lt;code>react-redux&lt;/code> ä¸­æ„å»ºæˆ‘ä»¬çš„ &lt;code>connect&lt;/code> é«˜é˜¶ç»„ä»¶ã€‚&lt;/p>
&lt;h2 id="ç¬¬ä¸€ç§æ–¹æ³•">ç¬¬ä¸€ç§æ–¹æ³•&lt;/h2>
&lt;p>æˆ‘ä»¬å…ˆä» &lt;code>react-redux&lt;/code> v4 ç‰ˆæœ¬å¼€å§‹ï¼Œè¿™æ—¶äº‹æƒ…å˜å¾—æ›´ç®€å•ï¼Œå¹¶ä¸” API é¦–æ¬¡æ˜¯&lt;strong>å®Œæ•´&lt;/strong>å’Œ&lt;strong>ç¨³å®š&lt;/strong>çš„ã€‚è®©æˆ‘ä»¬æ„å»ºæ›´ç®€å•ç‰ˆæœ¬çš„ &lt;code>connect&lt;/code> é«˜é˜¶ç»„ä»¶ APIã€‚&lt;strong>æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨é’©å­å’Œå…¶ä»–ç°ä»£çš„ React ç‰¹æ€§æ¥å®ç°ï¼Œä½†æ˜¯åº”è¯¥ä¸åŸºäºç±»çš„ API å¤§è‡´ç›¸åŒã€‚æ˜¯å…³äºæœªæ¥ç”Ÿæ´»çš„ä¸€ä»¶å¥½äº‹ï¼Œå¯¹å§ï¼Ÿ&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// For demonstration purpose, we intentionally omit `mapDispatchToProps`,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// since it&amp;#39;s almost the same as `mapStateToProps`.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Instead, we just pass down `dispatch` as a prop.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kr">const&lt;/span> &lt;span class="nx">connect&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">mapStateToProps&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">WrappedComponent&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">store&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useContext&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setState&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useState&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">mapStateToProps&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getState&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="nx">props&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">propsRef&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useRef&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">propsRef&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">current&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">props&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribe&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">mapStateToProps&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getState&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="nx">propsRef&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">current&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setState&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">propsRef&lt;/span>&lt;span class="p">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">WrappedComponent&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="na">...props&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="na">...state&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="na">dispatch&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">dispatch&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="p">/&amp;gt;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å¦‚æœä¸éœ€è¦è¿›è¡Œä¼˜åŒ–çš„è¯ï¼Œè¿™å¯èƒ½æ˜¯ &lt;code>connect&lt;/code> æœ€ç›´æ¥çš„å®ç°ã€‚&lt;/p>
&lt;p>è®©æˆ‘ä»¬ç‚¹å‡» Todo é¡¹å»åˆ é™¤å®ƒï¼Œçœ‹æ˜¯å¦æœ‰æ•ˆå·¥ä½œã€‚å—¯ï¼Œå¥½å§ï¼Œä¸€åˆ‡éƒ½å´©æºƒäº†ã€‚å®ƒä¸èƒ½å·¥ä½œäº†ï¼Œå‡ºä»€ä¹ˆé—®é¢˜äº†ï¼Ÿ&lt;/p>
&lt;p>æˆ‘ä»¬åƒ JavaScript è¿è¡Œæ—¶ä¸€æ ·ä¸€æ­¥ä¸€æ­¥å®Œæˆè¿™ä¸ªè¿‡ç¨‹ï¼Œçœ‹çœ‹åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚&lt;/p>
&lt;ol>
&lt;li>åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶ï¼Œ&lt;code>&amp;lt;TodoList&amp;gt;&lt;/code> å’Œ &lt;code>&amp;lt;Todo&amp;gt;&lt;/code> åœ¨ &lt;code>useEffect&lt;/code> ä¸­è®¢é˜…äº† &lt;code>store&lt;/code>ã€‚å› ä¸º &lt;code>useEffect&lt;/code> ï¼ˆæˆ–è€… &lt;code>componentDidMount&lt;/code>ï¼‰ä»ä¸‹å¾€ä¸Šè§¦å‘ï¼Œ&lt;code>&amp;lt;Todo&amp;gt;&lt;/code> é¦–å…ˆè¿›è¡Œè®¢é˜…ï¼Œç„¶åæ˜¯ &lt;code>&amp;lt;TodoList&amp;gt;&lt;/code>ã€‚&lt;/li>
&lt;li>ç”¨æˆ·ç‚¹å‡» &lt;code>&amp;lt;Todo&amp;gt;&lt;/code> ç»„ä»¶ï¼Œå‘ &lt;code>store&lt;/code> åˆ†å‘äº†ä¸€ä¸ª &lt;code>DELETE&lt;/code> åŠ¨ä½œï¼ŒæœŸå¾…è¯¥é¡¹è¢«åˆ é™¤ã€‚&lt;/li>
&lt;li>&lt;code>store&lt;/code> æ¥æ”¶åˆ°è¿™ä¸ªåŠ¨ä½œåï¼Œé€šè¿‡ &lt;strong>reducer&lt;/strong> æ¥è¿è¡Œï¼Œç„¶åæŠŠ &lt;code>todos&lt;/code> çš„çŠ¶æ€æ”¹ä¸ºç©ºæ•°ç»„ &lt;code>{ todos: [] }&lt;/code>ã€‚&lt;/li>
&lt;li>ç„¶å &lt;code>store&lt;/code> è°ƒç”¨å·²è®¢é˜…çš„ç›‘å¬å™¨ã€‚å› ä¸º &lt;code>&amp;lt;Todo&amp;gt;&lt;/code> å…ˆè¿›è¡Œçš„è®¢é˜…ï¼Œå› æ­¤ä¹Ÿä¼šå…ˆè°ƒç”¨ç›‘å¬å™¨ã€‚&lt;/li>
&lt;li>&lt;code>&amp;lt;Todo&amp;gt;&lt;/code> ä¸­çš„ &lt;code>connect&lt;/code> é«˜é˜¶ç»„ä»¶è§¦å‘ç›‘å¬å™¨ï¼Œè°ƒç”¨å¸¦æœ‰æœ€æ–°çš„ stateï¼ˆ&lt;code>store.getState()&lt;/code>ï¼‰å’Œæœ€æ–°çš„ propsï¼ˆ&lt;code>propsRef.current&lt;/code>ï¼‰çš„ &lt;code>mapStateToProps&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;strong>å› ä¸ºæœ€æ–°çš„ state ä¸å†æœ‰ &lt;code>todos&lt;/code> çš„ stateï¼Œå°è¯•å»è®¿é—® &lt;code>state.todos[ownProps.id]&lt;/code> å¯¼è‡´ä¸º &lt;code>undefined&lt;/code>ã€‚è°ƒç”¨ &lt;code>(undefined).content&lt;/code> å°†å¯¼è‡´é”™è¯¯ ğŸ’¥ã€‚&lt;/strong>&lt;/li>
&lt;/ol>
&lt;p>è¿™å°±æ˜¯åœ¨åŠ¨ä½œä¸­è‘—åçš„&lt;code>åƒµå°¸å­èŠ‚ç‚¹&lt;/code>é—®é¢˜ã€‚&lt;strong>åœ¨ Redux åˆ†å‘åï¼Œstate ä¼šåŒæ­¥æ”¹å˜ï¼Œä½†æ˜¯æ¸²æŸ“åˆ™ä¸ä¼šã€‚å½“æˆ‘ä»¬å°è¯•åœ¨ &lt;code>mapStateToProps&lt;/code> å‡½æ•°ä¸­è®¿é—® &lt;code>ownProps&lt;/code>ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šåœ¨å…¶ä¸­è¿è¡Œè¿‡æ—¶çš„ props&lt;/strong>ã€‚è¿™æ˜¯ç±»ä¼¼çš„åŸå› ï¼ˆä¹‹ä¸€ï¼‰&lt;a href="https://github.com/facebook/react/issues/11527#issuecomment-360199710" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆ &lt;code>setState&lt;/code> ä¸æ˜¯åŒæ­¥çš„&lt;/a>ï¼Œç®¡ç† &lt;code>React&lt;/code> ä¸–ç•Œä¹‹å¤–çš„ä¸€äº›çŠ¶æ€é€šå¸¸éœ€è¦æ³¨æ„ä¸€äº›é™·é˜±ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬åº”è¯¥å¦‚ä½•è¿›è¡Œä¿®å¤ï¼Ÿå¦‚æœæ˜¯å› ä¸ºæˆ‘ä»¬ç®¡ç†äº† &lt;code>React&lt;/code> &lt;strong>ä¹‹å¤–&lt;/strong>çš„çŠ¶æ€ï¼Œæ˜¯å¦æˆ‘ä»¬å¯èƒ½æŠŠçŠ¶æ€æ”¾åˆ° &lt;code>React&lt;/code> &lt;strong>å†…éƒ¨&lt;/strong>ï¼Ÿæˆ‘ä»¬å¸Œæœ› &lt;code>props&lt;/code> å§‹ç»ˆä¿æŒæœ€æ–°ï¼Œè¿™ä»…åœ¨ &lt;code>React&lt;/code> ä½¿ç”¨æœ€æ–°çš„ props æ¸²æŸ“ç»„ä»¶æ—¶å‘ç”Ÿã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆä¸è¿™æ ·åšå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æŠŠ &lt;code>mapStateToProps&lt;/code> æ”¹åˆ°æ¸²æŸ“é˜¶æ®µï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ç›‘å¬å™¨å›è°ƒä¸­è§¦å‘æ›´æ–°æ¥å¼ºåˆ¶é‡æ–°æ¸²æŸ“ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">connect&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">mapStateToProps&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">WrappedComponent&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">store&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useContext&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">state&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">mapStateToProps&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getState&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="nx">props&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribe&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">forceUpdate&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">forceUpdate&lt;/span>&lt;span class="p">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">WrappedComponent&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="na">...props&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="na">...state&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="na">dispatch&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">dispatch&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="p">/&amp;gt;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç°åœ¨ï¼Œå½“æˆ‘ä»¬ç‚¹å‡»è¯¥é¡¹æ—¶ï¼Œä»–æˆåŠŸåˆ é™¤äº†è‡ªå·±ï¼Œä¸‡å² ğŸ‰ï¼&lt;/p>
&lt;p>ç¨åï¼ŒPM æ¥è¯¢é—®æˆ‘ä»¬æ˜¯å¦å¯ä»¥å°†åˆ é™¤å»¶è¿Ÿåˆ° 1 ç§’ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå•å‡»è¯¥é¡¹åä¸ä¼šç«‹å³åˆ é™¤ï¼Œè€Œæ˜¯ 1 ç§’åå°†å…¶åˆ é™¤ã€‚&lt;/p>
&lt;p>å—¯ï¼Œå¬èµ·æ¥å¾ˆç®€å•ï¼æ˜¯å§ï¼Ÿ&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-diff" data-lang="diff">&lt;span class="line">&lt;span class="cl">const Todo = ({ id, content, dispatch }) =&amp;gt; (
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;li
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> onClick={() =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">- dispatch({ type: &amp;#39;DELETE&amp;#39;, payload: id });
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">&lt;/span>&lt;span class="gi">+ setTimeout(() =&amp;gt; {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ dispatch({ type: &amp;#39;DELETE&amp;#39;, payload: id });
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ }, 1000);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span> }}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {content}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/li&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬éå¸¸æœ‰ä¿¡å¿ƒå®ƒä¼šå·¥ä½œï¼Œæˆ‘ä»¬è¿›è¡Œä¿å­˜ï¼Œæäº¤ï¼Œç”šè‡³æ²¡æœ‰æµ‹è¯•ï¼ˆä½ æ°¸è¿œä¸è¦è¿™æ ·åšï¼‰ç›´æ¥å‘å¸ƒã€‚æ­¤åä¸ä¹…ï¼Œæˆ‘ä»¬æ”¶åˆ°äº†å¤§é‡çš„æŠ•è¯‰ï¼Œæ¯ä¸ªäººéƒ½æƒŠæ…Œå¤±æªã€‚å½“ç”¨æˆ·ç‚¹å‡»å¹¶ç­‰å¾… 1 ç§’åï¼Œåº”ç”¨ç¨‹åºå´©æºƒäº†ï¼Œæ•´ä¸ªåº”ç”¨ç¨‹åºéƒ½å´©æºƒäº†&lt;/p>
&lt;h2 id="unstable_batchedupdates">&lt;code>unstable_batchedUpdates&lt;/code>&lt;/h2>
&lt;p>ä¸ºä»€ä¹ˆæ·»åŠ ä¸€ä¸ªç®€å•çš„ &lt;code>setTimeout&lt;/code> ä¼šå¯¼è‡´æ•´ä¸ªåº”ç”¨ç¨‹åºå´©æºƒå‘¢ï¼Ÿè¦ç ”ç©¶è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è¿”å›å¹¶å†æ¬¡æ‰§è¡Œæ¯ä¸ªæ­¥éª¤ã€æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ä»£ç ä¸­æ·»åŠ ä¸€å † &lt;code>console.log&lt;/code> æ¥éªŒè¯è¾“å‡ºï¼Œä½†æ˜¯ä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œåœ¨è¿™é‡Œåªæä¾›ç»“æœã€‚å‰ 4 æ­¥å’Œä¹‹å‰ç›¸åŒï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥ä»ç¬¬ 5 æ­¥å¼€å§‹ã€‚&lt;/p>
&lt;p>&lt;strong>åœ¨æ·»åŠ  &lt;code>setTimeout&lt;/code> ä¹‹å‰ï¼š&lt;/strong>&lt;/p>
&lt;ol start="5">
&lt;li>&lt;code>&amp;lt;Todo&amp;gt;&lt;/code> ä¸­çš„ &lt;code>connect&lt;/code> é«˜é˜¶ç»„ä»¶è§¦å‘ç›‘å¬å™¨ï¼Œè°ƒç”¨ &lt;code>forceUpdate()&lt;/code> æ¥è°ƒåº¦é‡æ¸²æŸ“ã€‚&lt;/li>
&lt;li>&lt;code>&amp;lt;TodoList&amp;gt;&lt;/code> ä¸­çš„ &lt;code>connect&lt;/code> é«˜é˜¶ç»„ä»¶è§¦å‘ç›‘å¬å™¨ï¼Œè°ƒç”¨ &lt;code>forceUpdate()&lt;/code> æ¥è°ƒåº¦é‡æ¸²æŸ“ã€‚&lt;/li>
&lt;li>&lt;code>&amp;lt;TodoList&amp;gt;&lt;/code> æ¸²æŸ“ï¼Œè¿”å›çš„å…ƒç´ æ˜¯ä¸€ä¸ªç©ºæ•°ç»„ &lt;code>[]&lt;/code>ï¼Œåªæ¸²æŸ“ &lt;code>&amp;lt;ul&amp;gt;&lt;/code> å®¹å™¨ï¼Œ&lt;code>&amp;lt;Todo&amp;gt;&lt;/code> ç»„ä»¶ä¸ä¼šæ¸²æŸ“ã€‚&lt;/li>
&lt;/ol>
&lt;p>æ²¡æœ‰é”™è¯¯ï¼Œå®ƒæ­£å¸¸å·¥ä½œã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å½“æˆ‘ä»¬æ·»åŠ  &lt;code>setTimeout&lt;/code> åï¼Œä½•æ—¶ä¼šåˆ†å‘åŠ¨ä½œã€‚å‰ 4 æ­¥ä¹Ÿæ˜¯ç›¸åŒçš„ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯åœ¨ &lt;strong>ï¼ˆ1ï¼‰&lt;/strong> å’Œ &lt;strong>ï¼ˆ2ï¼‰&lt;/strong> ç›´æ¥å­˜åœ¨ 1 ç§’å»¶è¿Ÿã€‚&lt;/p>
&lt;p>&lt;strong>åœ¨æ·»åŠ  &lt;code>setTimeout&lt;/code> ä¹‹åï¼š&lt;/strong>&lt;/p>
&lt;ol start="5">
&lt;li>&lt;code>&amp;lt;Todo&amp;gt;&lt;/code> ä¸­çš„ &lt;code>connect&lt;/code> é«˜é˜¶ç»„ä»¶è§¦å‘ç›‘å¬å™¨ï¼Œè°ƒç”¨ &lt;code>forceUpdate()&lt;/code> æ¥è°ƒåº¦é‡æ¸²æŸ“ã€‚&lt;/li>
&lt;li>&lt;code>&amp;lt;Todo&amp;gt;&lt;/code> æ¸²æŸ“ï¼Œè°ƒç”¨å¸¦æœ‰æœ€æ–°çš„ state å’Œæœ€æ–°çš„ props çš„ &lt;code>mapStateToProps&lt;/code>ã€‚&lt;/li>
&lt;li>å› ä¸ºçˆ¶ç»„ä»¶ï¼ˆ&lt;code>&amp;lt;TodoList&amp;gt;&lt;/code>ï¼‰è¿˜æ²¡æœ‰æ¸²æŸ“ï¼Œ&lt;code>&amp;lt;Todo&amp;gt;&lt;/code> ä¸­çš„ props å®é™…ä¸Šæ˜¯&lt;strong>è¿‡æ—¶çš„ props&lt;/strong>ï¼Œä½†æ˜¯ state å·²ç»æ˜¯æœ€æ–°çš„äº†ã€‚è°ƒç”¨ &lt;code>state.todos[ownProps.id]&lt;/code> å¯¼è‡´ä¸º &lt;code>undefined&lt;/code>ï¼Œè°ƒç”¨ &lt;code>(undefined).content&lt;/code> å¯¼è‡´ä¸€ä¸ªé”™è¯¯ã€‚&lt;/li>
&lt;/ol>
&lt;p>è¯·æ³¨æ„ï¼Œåœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œç¬¬å…­æ­¥æ˜¯ä¸åŒçš„ã€‚å‰è€…åœ¨çˆ¶ç»„ä»¶ï¼ˆ&lt;code>&amp;lt;TodoList&amp;gt;&lt;/code>ï¼‰ä¸­è°ƒç”¨å¦ä¸€ä¸ªç›‘è§†å™¨ï¼Œè€Œåè€…é¦–å…ˆæ¸²æŸ“å­ç»„ä»¶ï¼ˆ&lt;code>&amp;lt;Todo&amp;gt;&lt;/code>ï¼‰ã€‚ &lt;strong>ä¼¼ä¹æ˜¯è°ƒç”¨ &lt;code>forceUpdate()&lt;/code> ä¸ä¹…åï¼Œ&lt;code>&amp;lt;Todo&amp;gt;&lt;/code> åŒæ­¥é‡æ¸²æŸ“äº†ï¼&lt;/strong>&lt;/p>
&lt;p>â€œç­‰ç­‰ï¼Œæˆ‘ä»¥ä¸º &lt;code>setState&lt;/code> æ˜¯å¼‚æ­¥çš„ï¼Ÿâ€ æ˜¯çš„ï¼Œå½“ç„¶ä¸ä¼šã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ &lt;code>setState&lt;/code> å®é™…ä¸Šæ˜¯å¼‚æ­¥çš„ï¼Œ&lt;a href="https://twitter.com/dan_abramov/status/959507572951797761" target="_blank" rel="noopener">åªè¦ &lt;code>setState&lt;/code> åœ¨ React äº‹ä»¶å¤„ç†å›è°ƒä¸­è°ƒç”¨å³å¯&lt;/a>ï¼ŒReact å°†ç¡®ä¿åœ¨äº‹ä»¶å¤„ç†å›è°ƒä¸­&lt;strong>æ‰¹å¤„ç†&lt;/strong>æ‰€æœ‰çš„æ›´æ–°ï¼Œå¹¶ä¸€æ¬¡å¼‚æ­¥æ‰§è¡Œæ‰€æœ‰çš„æ¸²æŸ“ã€‚é€šè¿‡åœ¨ &lt;code>setTimeout&lt;/code> å›è°ƒä¸­åŒ…è£… &lt;code>setState&lt;/code>ï¼Œæˆ‘ä»¬&lt;strong>é€‰æ‹©å–æ¶ˆ&lt;/strong> è¿™ä¸ªç‰¹æ€§ï¼Œå¹¶ä½¿ &lt;code>setState&lt;/code> åŒæ­¥ã€‚&lt;/p>
&lt;p>åœ¨æˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒReact æŠŠ &lt;code>&amp;lt;Todo&amp;gt;&lt;/code> ç»„ä»¶çš„ &lt;code>forceUpdate()&lt;/code> å’Œ &lt;code>&amp;lt;TodoList&amp;gt;&lt;/code> ç»„ä»¶çš„ &lt;code>forceUpdate()&lt;/code> æ”¾åœ¨ä¸€ä¸ªäº‹ä»¶å¤„ç†å›è°ƒä¸­ï¼Œç„¶åæœ€ç»ˆè®©å®ƒä»¬ä¸€æ¬¡è¿›è¡Œæ¸²æŸ“ã€‚**è¿™é‡Œå¦ä¸€ä¸ªé‡è¦çš„è¯´æ˜æ˜¯ï¼Œåœ¨é‡æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼ŒReact å°†ç¡®ä¿ä»ä¸‹åˆ°ä¸Šæ‰§è¡Œã€‚**è¿™å°±æ˜¯ä¸ºä»€ä¹ˆçˆ¶ç»„ä»¶ï¼ˆ&lt;code>&amp;lt;TodoList&amp;gt;&lt;/code>ï¼‰é¦–å…ˆè¿›è¡Œé‡æ¸²æŸ“ï¼Œç„¶åè·³è¿‡ &lt;code>&amp;lt;Todo&amp;gt;&lt;/code> æ¸²æŸ“çš„åŸå› ã€‚&lt;/p>
&lt;p>å¹¸è¿çš„æ˜¯ï¼Œåœ¨å°†æ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­ï¼Œ&lt;a href="https://twitter.com/dan_abramov/status/959557687158689792" target="_blank" rel="noopener">React å°†å¯èƒ½ç¡®ä¿æ‰€æœ‰çš„ &lt;code>setState&lt;/code> éƒ½æ˜¯å¼‚æ­¥çš„&lt;/a>ï¼Œè¿™æ„å‘³ç€å³ä½¿æˆ‘ä»¬æŠŠ &lt;code>setState&lt;/code> æ”¾åˆ° &lt;code>setTimeout&lt;/code> é‡Œé¢ï¼Œæ›´æ–°ä»ç„¶å°†åˆ†æ‰¹è¿›è¡Œã€‚&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘ä»¬ä»…ä»…æ˜¯è¿›è¡Œç­‰å¾…å—ï¼Ÿå½“ç„¶ä¸æ˜¯ã€‚ç°åœ¨è¿˜æœ‰å¦ä¸€ç§è§£å†³æ–¹æ³•ã€‚&lt;/p>
&lt;p>Reactï¼Œæˆ–è€…æ›´å‡†ç¡®çš„è¯´ï¼Œ&lt;code>react-dom&lt;/code>ï¼Œæœ‰ä¸€ä¸ªéšè—ç‰¹æ€§ï¼š&lt;code>unstable_batchedUpdates&lt;/code>ï¼Œèƒ½å¤Ÿç²¾ç¡®çš„å®ç°æˆ‘ä»¬æƒ³è¦ç¡®ä¿çš„æ›´æ–°åœ¨ä¸€èµ·æ‰¹å¤„ç†ã€‚&lt;a href="https://react-redux.js.org/api/batch" target="_blank" rel="noopener">React ä¸­äº‹ä»¶å¤„ç†ç¨‹åºå·²ç»åœ¨å†…éƒ¨ä½¿ç”¨æ­¤ API&lt;/a>ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆåœ¨äº‹ä»¶å¤„ç†ä¸­ &lt;code>setState&lt;/code> å°†æ˜¯å¼‚æ­¥çš„ã€‚&lt;strong>(æ­£å¦‚ä»–çš„åå­—æš—ç¤ºçš„é‚£æ ·ï¼Œæˆ‘ä»¬åº”è¯¥å®Œå…¨ç†è§£åå†ä½¿ç”¨å®ƒã€‚æˆ‘ä»¬å·²ç»è¢«è­¦å‘Šäº†ã€‚&lt;/strong>)&lt;/p>
&lt;p>æˆ‘ä»¬ç®€å•çš„åœ¨ &lt;code>unstable_batchedUpdates&lt;/code> å›è°ƒä¸­æ¥åŒ…è£…æˆ‘ä»¬çš„ &lt;code>dispatch&lt;/code> æ–¹æ³•ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-diff" data-lang="diff">&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+import { unstable_batchedUpdates } from &amp;#39;react-dom&amp;#39;;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">const Todo = ({ id, content, dispatch }) =&amp;gt; (
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;li
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> onClick={() =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> setTimeout(() =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">- dispatch({ type: &amp;#39;DELETE&amp;#39;, payload: id });
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gd">&lt;/span>&lt;span class="gi">+ unstable_batchedUpdates(() =&amp;gt; {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ dispatch({ type: &amp;#39;DELETE&amp;#39;, payload: id });
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ });
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span> }, 1000);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {content}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/li&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿˜æœ‰å¦ä¸€ä¸ªåœ°æ–¹æˆ‘ä»¬å¯ä»¥æ·»åŠ  &lt;code>unstable_batchedUpdates&lt;/code>ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ç®€å•çš„åŒ…è£…æˆ‘ä»¬ store åˆ†å‘æ–¹æ³•ï¼Œæ¥ä»£æ›¿åŒ…è£…æ¯ä¸ªå¸¦æœ‰ &lt;code>unstable_batchedUpdates&lt;/code> çš„ &lt;code>dispatch&lt;/code> è°ƒç”¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-diff" data-lang="diff">&lt;span class="line">&lt;span class="cl">dispatch(action) {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> state = reducer(state, action);
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ unstable_batchedUpdates(() =&amp;gt; {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span> listeners.forEach(listener =&amp;gt; {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listener();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> });
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">+ });
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="gi">&lt;/span>},
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>å®ƒå·¥ä½œè‰¯å¥½ã€‚è¿™å®é™…ä¸Šå°±æ˜¯ &lt;code>react-redux&lt;/code> v4 çš„å®ç°ï¼Œæ²¡æœ‰è®¸å¤šå…¶ä»–å¿…è¦çš„ä¼˜åŒ–ï¼Œåƒ&lt;a href="https://github.com/reduxjs/react-redux/blob/v4.4.0/src/components/connect.js#L238-L270" target="_blank" rel="noopener">è®°ä½è¿”å›çš„å…ƒç´ &lt;/a>ï¼Œæˆ–è€…&lt;a href="https://github.com/reduxjs/react-redux/pull/348" target="_blank" rel="noopener">å¦‚æœ &lt;code>mapStateToProps&lt;/code> å‡½æ•°ä¸ä¾èµ–äº &lt;code>ownProps&lt;/code>ï¼Œåˆ™å°½æ—©è¿›è¡Œæ›´æ–°&lt;/a>ã€‚ å³ä½¿è¿›è¡Œäº†è¿™äº›ä¼˜åŒ–ï¼Œåœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œæ¯æ¬¡çŠ¶æ€æ›´æ”¹æ—¶ï¼Œæˆ‘ä»¬ä»ç„¶ä¼šå¼ºåˆ¶å®¹å™¨ç»„ä»¶è¿›è¡Œé‡æ¸²æŸ“ã€‚å¯¹äºä¸€ä¸ªå¾ˆå°çš„åº”ç”¨ç¨‹åºï¼Œå®ƒåº”è¯¥è¿˜ä¸é”™ï¼Œä½†æ˜¯å¯¹äºä¸€ä¸ªå¯æ‰©å±•çš„å…¨å±€çŠ¶æ€ç®¡ç†åº“ï¼Œå®ƒå¾ˆå¿«å°±å˜å¾—æ— æ³•æ¥å—ã€‚&lt;/p>
&lt;h2 id="åµŒå¥—è®¢é˜…æ¨¡å‹">åµŒå¥—è®¢é˜…æ¨¡å‹&lt;/h2>
&lt;p>æˆ‘ä»¬å¸Œæœ›æœ€å°åŒ–å®¹å™¨ç»„ä»¶ä¸­çš„æ¸²æŸ“è°ƒç”¨ï¼Œå› æ­¤æˆ‘ä»¬æƒ³å‡ºä¸€ç§æ–¹æ³•æ¥åœ¨ &lt;code>forceUpdate()&lt;/code> è°ƒç”¨ä¹‹å‰çš„ç›‘å¬å™¨å›è°ƒä¸­å°½æ—©è·³è¿‡æ›´æ–°ã€‚æˆ‘ä»¬è¿˜æƒ³å¼ºåˆ¶æ‰§è¡Œ&lt;strong>è‡ªä¸Šè€Œä¸‹çš„å‘½ä»¤&lt;/strong>ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ä¼šå†æå‡ºè¿‡æ—¶çš„ props å’Œåƒµå°¸å­èŠ‚ç‚¹é—®é¢˜ã€‚&lt;/p>
&lt;p>Redux å›¢é˜Ÿæå‡ºäº†ä¸€ç§æœ‰è¶£çš„æ–¹æ³•æ¥è§£å†³ &lt;code>react-redux&lt;/code> v5 ä¸­çš„é—®é¢˜ã€‚é€šè¿‡ä½¿ç”¨&lt;strong>åµŒå¥—è®¢é˜…æ¨¡å‹&lt;/strong>ï¼Œæˆ‘ä»¬å¯ä»¥å°½æ—©è·³è¿‡æ›´æ–°ï¼Œè¿˜å¯ä»¥é¿å…è¿‡æ—¶çš„ props é—®é¢˜ã€‚&lt;/p>
&lt;p>&lt;strong>åŸºæœ¬æ€æƒ³æ˜¯ï¼Œæˆ‘ä»¬å»¶è¿Ÿç›‘å¬å™¨å›è°ƒçš„è§¦å‘ï¼Œç›´åˆ°çˆ¶çº§å®Œå…¨é‡æ¸²æŸ“ä¸ºæ­¢ï¼Œç”¨æ¥ä»£æ›¿åˆ†æ‰¹åœ°è¿›è¡Œæ›´æ–°ä»¥ä½¿å…¶è‡ªä¸Šè€Œä¸‹&lt;/strong>ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿æ›´æ–°å§‹ç»ˆæ˜¯è‡ªä¸Šè€Œä¸‹çš„ï¼Œå­©å­ä¸ä¼šåœ¨ç›‘å¬å™¨å›è°ƒä¸­è·å¾—&lt;strong>è¿‡æ—¶çš„ props&lt;/strong>ï¼Œå› ä¸ºå½“æˆ‘ä»¬è§¦å‘å›è°ƒæ—¶ï¼Œprops å·²ç»æ˜¯æœ€æ–°çš„äº†ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªä»£ç ç‰‡æ®µä»·å€¼ä¸€åƒå¥è¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">createSubscription&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">listeners&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">subscribe&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">listener&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">listeners&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">listener&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Returns an unsubscribe function
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">index&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">listeners&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">indexOf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">listener&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">listeners&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">splice&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">index&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">notifyUpdates&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">listeners&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">forEach&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">listener&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">listener&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª &lt;code>createSubscription&lt;/code>ï¼Œå®ƒå’Œ &lt;code>createStore&lt;/code> å‡½æ•°éå¸¸åƒï¼Œå®ƒä¹Ÿæœ‰ç›‘å¬å™¨ï¼Œå’Œ &lt;code>subscribe&lt;/code> å‡½æ•°ã€‚ä¸åŒä¹‹å¤„æ˜¯å®ƒä¸ä¿å­˜ä»»ä½•çš„çŠ¶æ€ï¼Œä¹Ÿæœ‰ä¸€ä¸ª &lt;code>notifyUpdates()&lt;/code> æ–¹æ³•ã€‚è¿™ä¸ª &lt;code>notifyUpdates()&lt;/code> æ–¹æ³•ç”¨æ¥é€šçŸ¥å®ƒçš„æ‰€æœ‰çš„å­©å­èŠ‚ç‚¹ï¼Œæ¥è§¦å‘å®ƒä»¬çš„ç›‘å¬å™¨å›è°ƒï¼Œæˆ‘ä»¬å°†åœ¨ä¹‹åè¿›è¡Œæ›´å¤šçš„è®¨è®ºã€‚&lt;/p>
&lt;p>ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œè¿™åªæ˜¯åˆ›å»ºäº‹ä»¶è§¦å‘å™¨çš„å‡½æ•°ï¼Œè¿™æ˜¯éå¸¸æ­£ç¡®çš„ï¼Œå¹¶ä¸”å®ƒå°±è¿™ä¹ˆçš„ç®€å•ã€‚ä¸‹ä¸€æ­¥æ˜¯ç¼–å†™æ–°çš„ &lt;code>connect&lt;/code> é«˜é˜¶ç»„ä»¶ï¼Œå¹¶å°†å…¶ &lt;code>mapStateToProps&lt;/code> æ”¾å…¥ç›‘å¬å™¨å›è°ƒä¸­ï¼Œä»¥å°½æ—©è·³è¿‡æ›´æ–°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">connect&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">mapStateToProps&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">WrappedComponent&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">store&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useContext&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">subStore&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useMemo&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">...&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">...&lt;/span>&lt;span class="nx">createSubscription&lt;/span>&lt;span class="p">(),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[,&lt;/span> &lt;span class="nx">forceUpdate&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useReducer&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">c&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">stateRef&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useRef&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">stateRef&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">current&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">mapStateToProps&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getState&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="nx">props&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">propsRef&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useRef&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">propsRef&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">current&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">props&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribe&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">nextState&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">mapStateToProps&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getState&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="nx">propsRef&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">current&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">shallowEqual&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">stateRef&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">current&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">nextState&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Bail out updates early, immediately notify updates to children
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">subStore&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">notifyUpdates&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">forceUpdate&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">propsRef&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">stateRef&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">forceUpdate&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">subStore&lt;/span>&lt;span class="p">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">subStore&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">notifyUpdates&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span> &lt;span class="c1">// Don&amp;#39;t pass dependencies so that it will run after every re-render
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Provider&lt;/span> &lt;span class="na">store&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">subStore&lt;/span>&lt;span class="p">}&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">WrappedComponent&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="na">...props&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="na">...stateRef.current&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">dispatch&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">dispatch&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">Provider&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™é‡Œæœ‰å¾ˆå¤šäº‹æƒ…ï¼Œè®©æˆ‘ä»¬ä¸€ä¸€åˆ†è§£ã€‚åŸºæœ¬å®ç°æœ‰ç‚¹ç±»ä¼¼äºæˆ‘ä»¬çš„ç¬¬ä¸€ç§æ–¹æ³•ã€‚æˆ‘ä»¬é€šè¿‡åˆ›å»ºä¸€ä¸ªæˆ‘ä»¬åˆšåˆšå®ç°çš„ &lt;code>subscription&lt;/code> æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ &lt;code>subStore&lt;/code>ï¼Œå¹¶å°†å…¶ä¸åŸå§‹çš„ &lt;code>store&lt;/code> åˆå¹¶ã€‚ç»“æœï¼Œè¯¥ &lt;code>subscribe&lt;/code> æ–¹æ³•å°†è¦†ç›– &lt;code>store&lt;/code> ä¸­åŸå§‹çš„ &lt;code>subscribe&lt;/code> æ–¹æ³•ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªåä¸ºçš„ &lt;code>notifyUpdates&lt;/code> çš„æ–°æ–¹æ³•ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬åœ¨ 2 ä¸ªåœ°æ–¹è¿è¡Œ &lt;code>mapStateToProps&lt;/code> é€‰æ‹©å™¨ã€‚æˆ‘ä»¬åœ¨æ¸²æŸ“é˜¶æ®µè¿è¡Œæˆ‘ä»¬çš„ &lt;code>mapStateToProps&lt;/code>ï¼Œä»¥ä¾¿åœ¨å›è°ƒä¸­è°ƒç”¨ &lt;code>forceUpdate()&lt;/code> ä¹‹åæ€»æ˜¯è·å¾—æœ€æ–°çš„ propsã€‚åœ¨æˆ‘ä»¬çš„ç›‘å¬å™¨å›è°ƒä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¹Ÿç›´æ¥åœ¨å®ƒå†…éƒ¨ä½¿ç”¨ &lt;code>mapStateToProps&lt;/code>ï¼Œå¹¶ä¸”è¿›è¡Œäº†ä¸€ä¸ªæµ…å¯¹æ¯”ï¼Œä»¥ç¡®å®šå¦‚æœæ˜ å°„çŠ¶æ€ä¸å˜ï¼Œæ˜¯å¦å¯ä»¥è·³è¿‡æ›´æ–°ã€‚&lt;/p>
&lt;p>åœ¨ return è¯­å¥ä¸­ï¼Œæˆ‘ä»¬å†æ¬¡ç”¨è¯¥ &lt;code>&amp;lt;Provider&amp;gt;&lt;/code> ç»„ä»¶åŒ…è£…æˆ‘ä»¬çš„ç»„ä»¶ï¼Œå¹¶ç”¨æ–°åˆ›å»ºçš„ &lt;code>subStore&lt;/code> æ¥æ˜¾å¼è¦†ç›– store ä¸Šä¸‹æ–‡ã€‚è¿™æ ·ç»„ä»¶æ ‘ä¸‹çš„æ¯ä¸ªç»„ä»¶éƒ½å°†è·å¾— &lt;code>subStore&lt;/code> è€Œä¸æ˜¯æœ€é¡¶å±‚çš„ &lt;code>store&lt;/code>ã€‚&lt;/p>
&lt;p>æœ€åï¼Œæˆ‘ä»¬åˆ›å»ºå¦ä¸€ä¸ªå«åš &lt;code>subStore.notifyUpdates()&lt;/code> çš„å‰¯ä½œç”¨ï¼Œä»¥ä¾¿&lt;strong>åœ¨æ¯æ¬¡æ¸²æŸ“ä¹‹å&lt;/strong>è°ƒç”¨ç»„ä»¶æ ‘ä¸‹çš„æ‰€æœ‰å­çº§ã€‚&lt;strong>ç›´åˆ°ä¸‹ä¸€ä¸ªæ¸²æŸ“ä¸­æœ€æ–°çš„ props å·²ç»ä¼ é€’ç»™å­èŠ‚ç‚¹æ—¶ï¼Œæ‰ä¼šè°ƒç”¨å­èŠ‚ç‚¹çš„å›è°ƒ&lt;/strong>ï¼Œä»è€Œæ¶ˆé™¤äº†&lt;strong>è¿‡æ—¶çš„ props&lt;/strong> é—®é¢˜ã€‚&lt;/p>
&lt;p>å†æ¬¡å•å‡»è¯¥é¡¹ï¼Œè¯¥é¡¹ç°åœ¨å°†æˆåŠŸåˆ é™¤è€Œä¸ä¼šå¼•å‘ä»»ä½•é”™è¯¯ã€‚ä¸ºäº†ä½¿æµç¨‹æ›´æ¸…æ™°ï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡æ‰§è¡Œæ¯ä¸ªæ­¥éª¤ï¼Œä»¥ç¡®ä¿å…¶æŒ‰é¢„æœŸå·¥ä½œã€‚&lt;/p>
&lt;ol>
&lt;li>åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“åï¼Œ&lt;code>&amp;lt;Todo&amp;gt;&lt;/code> è®¢é˜… &lt;code>&amp;lt;TodoList&amp;gt;&lt;/code> åˆ›å»ºçš„ &lt;code>subStore&lt;/code> ç„¶åé€šè¿‡ &lt;code>useEffect&lt;/code> ä¸­çš„ &lt;code>Provider&lt;/code> å‘ä¸‹ä¼ é€’ã€‚&lt;/li>
&lt;li>ç„¶å &lt;code>&amp;lt;TodoList&amp;gt;&lt;/code> è®¢é˜…åœ¨å®ƒçš„ &lt;code>useEffect&lt;/code> ä¸­é€šè¿‡ &lt;code>createStore&lt;/code> åˆ›å»ºçš„å…¨å±€çš„ &lt;code>store&lt;/code>ã€‚&lt;/li>
&lt;li>ç”¨æˆ·ç‚¹å‡» &lt;code>&amp;lt;Todo&amp;gt;&lt;/code>ï¼Œå‘ store åˆ†å‘ä¸€ä¸ª &lt;code>DELETE&lt;/code> åŠ¨ä½œï¼ŒæœŸæœ›è¯¥é¡¹è¢«åˆ é™¤ã€‚&lt;/li>
&lt;li>store æ”¶åˆ°è¿™ä¸ªåŠ¨ä½œï¼Œé€šè¿‡ &lt;strong>reducer&lt;/strong> è¿è¡Œå®ƒã€‚å¹¶å°† &lt;code>todos&lt;/code> çŠ¶æ€æ›´æ”¹ä¸ºä¸€ä¸ªç©ºæ•°ç»„ &lt;code>{ todos: [] }&lt;/code>ã€‚&lt;/li>
&lt;li>&lt;code>store&lt;/code> ç„¶åè°ƒç”¨è®¢é˜…ç›‘å¬å™¨ã€‚å› ä¸ºä»…æœ‰ä¸€ä¸ªç›‘å¬å™¨è®¢é˜…äº† &lt;code>store&lt;/code>ï¼Œä»…ä»… &lt;code>&amp;lt;TodoList&amp;gt;&lt;/code> çš„ç›‘å¬å™¨å°†è°ƒç”¨ï¼Œ&lt;code>&amp;lt;Todo&amp;gt;&lt;/code> çš„åˆ™ä¸ä¼šã€‚&lt;/li>
&lt;li>&lt;code>&amp;lt;TodoList&amp;gt;&lt;/code> è°ƒç”¨ç›‘å¬å™¨å›è°ƒï¼Œè°ƒç”¨å¸¦æœ‰æœ€æ–°çŠ¶æ€ï¼ˆ&lt;code>store.getState()&lt;/code>ï¼‰å’Œæœ€æ–° props ï¼ˆ&lt;code>propsRef.current&lt;/code>ï¼‰çš„ &lt;code>mapStateToProps&lt;/code>ã€‚&lt;/li>
&lt;li>æ˜ å°„çŠ¶æ€å¹¶ä¸å®Œå…¨ç›¸ç­‰ï¼Œå› æ­¤æˆ‘ä»¬è®¡åˆ’ä½¿ç”¨ &lt;code>forceUpdate()&lt;/code> è¿›è¡Œæ›´æ–°ã€‚&lt;code>&amp;lt;TodoList&amp;gt;&lt;/code> ç„¶ååœ¨æ¸²æŸ“é˜¶æ®µå†æ¬¡è°ƒç”¨ &lt;code>mapStateToProps&lt;/code> å¹¶è¿”å›ä¸€ä¸ªç©ºçš„ &lt;code>&amp;lt;ul&amp;gt;&lt;/code> å› ä¸ºåˆ—è¡¨ä¸­ä¸å†æœ‰ä»»ä½•é¡¹ã€‚&lt;/li>
&lt;li>&lt;code>&amp;lt;Todo&amp;gt;&lt;/code> å°†ä¼šå¸è½½ï¼Œå› æ­¤å®ƒå°†è°ƒç”¨å‰¯ä½œç”¨ä¸­çš„ &lt;code>unsubscribe&lt;/code> å‡½æ•°ï¼Œä» &lt;code>subStore&lt;/code> ä¸­çš„ &lt;code>listeners&lt;/code> æ•°ç»„ä¸­ç§»é™¤å®ƒçš„ç›‘å¬å™¨å›è°ƒã€‚&lt;/li>
&lt;li>&lt;code>&amp;lt;TodoList&amp;gt;&lt;/code> è°ƒç”¨å‰¯ä½œç”¨å¹¶åœ¨æ¸²æŸ“åè¿è¡Œ &lt;code>subStore.notifyUpdates()&lt;/code>ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰åœ¨ &lt;code>subStore&lt;/code> ä¸­ç•™ä¸‹ä»»ä½•è¦è°ƒç”¨çš„ä¾¦å¬å™¨ï¼Œå› æ­¤æ•´ä¸ªè¿‡ç¨‹æˆåŠŸå®Œæˆã€‚&lt;/li>
&lt;/ol>
&lt;p>å¯¹äºä»ç„¶å‰©ä¸‹ä¸€äº›å­èŠ‚ç‚¹çš„æƒ…å†µï¼Œæ¯ä¸ªå­èŠ‚ç‚¹å°†éšåè°ƒç”¨å®ƒä»¬çš„ç›‘å¬å™¨å›è°ƒã€‚å› ä¸ºå®ƒä»¬å°†åœ¨æ¸²æŸ“åè¢«è°ƒç”¨ï¼Œæ‰€ä»¥å®ƒä»¬å°†ä»çˆ¶ç»„ä»¶é‚£é‡Œè·å¾—æœ€æ–°çš„ propsã€‚&lt;/p>
&lt;p>æœ‰è¶£çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨å­ç»„ä»¶ä¸­è¿è¡Œäº†ä¸¤æ¬¡ &lt;code>mapStateToProps&lt;/code>ï¼Œä¸€æ¬¡æ˜¯åœ¨ç›‘å¬å™¨å›è°ƒå†…ï¼Œè€Œå¦ä¸€æ¬¡æ˜¯ç”±çˆ¶ç»„ä»¶çš„é‡æ¸²æŸ“è§¦å‘çš„ã€‚åè€…åº”è¯¥åœ¨å‰è€…ä¹‹å‰å‘ç”Ÿï¼Œä½†æ˜¯çŠ¶æ€å’Œ props éƒ½åº”è¯¥æ˜¯æœ€æ–°çš„ï¼Œå¹¶ä¸”åœ¨æ¯æ¬¡è¿è¡Œä¸­éƒ½åº”è¯¥ç›¸åŒã€‚ä¸ºäº†è¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥è®°ä½è¿™ä¸ª &lt;code>mapStateToProps&lt;/code> å‡½æ•°ï¼Œä»¥ä¾¿åœ¨è¿™ç§æƒ…å†µä¸‹ä¸å¿…è°ƒç”¨ä¸¤æ¬¡ã€‚&lt;/p>
&lt;p>æ³¨æ„ï¼Œæˆ‘ä»¬ç”šè‡³ä¸å¿…åœ¨ &lt;code>notifyUpdates&lt;/code> å‡½æ•°ä¸­ä½¿ç”¨ &lt;code>unstable_batchedUpdates&lt;/code>ã€‚åŒä¸€å±‚æ¬¡ç»“æ„è°ƒç”¨ä¸­çš„æ›´æ–°è¢«&lt;strong>åˆ’åˆ†&lt;/strong>åˆ°ä¸åŒçš„ &lt;code>subStore&lt;/code>ï¼Œå­ç»„ä»¶ä»…åœ¨çˆ¶ç»„ä»¶å®Œæˆé‡æ¸²æŸ“åæ‰è°ƒç”¨ç›‘å¬å™¨å›è°ƒï¼Œå› æ­¤æ— éœ€å°†å®ƒä»¬ä¸€èµ·æ‰¹å¤„ç†ã€‚&lt;/p>
&lt;p>è¿™æ˜¯ &lt;code>react-redux&lt;/code> åœ¨ v5 å’Œ v7 ä¸­å®ç°åµŒå¥—è®¢é˜…æ¨¡å‹çš„åŸºæœ¬æ€æƒ³ï¼ˆå½“ç„¶ï¼Œç¼ºå°‘å¤§é‡çš„ä¼˜åŒ–ï¼‰ã€‚&lt;a href="https://github.com/reduxjs/react-redux/pull/416" target="_blank" rel="noopener">å½“æˆ‘ä»¬å¯ä»¥ææ—©æ‰¹å‡†æ›´æ–°å¹¶ä¸”ä¸å¿…å°½å¯èƒ½è°ƒç”¨ React çš„æ—¶å€™ï¼Œç»“æœå°†å¤§å¤§æé«˜æ€§èƒ½&lt;/a>ã€‚å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥æ‘†è„± &lt;code>unstable_batchedUpdates&lt;/code>ï¼Œè¿™æ˜¯å¾ˆéš¾åŒ…å«åœ¨ &lt;code>react-redux&lt;/code>ä¸­çš„ï¼ˆå®ƒæ¥è‡ª &lt;code>react-dom&lt;/code> ä½† &lt;code>react-redux&lt;/code> ä¹Ÿå¯ä»¥åœ¨å…¶ä»–æ¸²æŸ“å™¨ä¸­ä½¿ç”¨ï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„èƒœåˆ©ï¼&lt;/p>
&lt;h2 id="react-ä¸Šä¸‹æ–‡">React ä¸Šä¸‹æ–‡&lt;/h2>
&lt;p>æœ‰ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³•å¯ä»¥é€šè¿‡ä½¿ç”¨ React ä¸Šä¸‹æ–‡æ¥è§£å†³ã€‚æˆ‘ä»¬å·²ç»åœ¨ä½¿ç”¨å®ƒæ¥ä¼ é€’ &lt;code>store&lt;/code> å®ä¾‹ï¼Œä¸ºä»€ä¹ˆä¸è®©å®ƒä¹Ÿå¯¹çŠ¶æ€æ›´æ”¹åšå‡ºååº”ï¼Ÿå½“ React ä¸Šä¸‹æ–‡çš„ç¨³å®šç‰ˆæœ¬é¦–æ¬¡å‡ºç°æ—¶ï¼Œ&lt;code>react-context&lt;/code> v6 é‡‡ç”¨è¿™ç§æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼¼ä¹å®¹æ˜“å¾—å¤šï¼Œå¹¶ä¸”ç”±äºçŠ¶æ€æ¸²æŸ“ä¼ æ’­æ˜¯ç”± React å¤„ç†çš„ï¼Œå› æ­¤æˆ‘ä»¬è½»æ¾è·å¾—äº†è‡ªä¸Šè€Œä¸‹çš„æ›´æ–°ã€‚æ²¡æœ‰æ›´å¤šçš„ &lt;code>unstable_batchedUpdates&lt;/code>ï¼Œæ²¡æœ‰æ›´å¤šçš„åµŒå¥—è®¢é˜…æ¨¡å‹ã€‚äº‹ä»¶ç›‘å¬å™¨çš„æ•°é‡ä¹Ÿå‡å°‘åˆ°äº†ä¸€ä¸ªï¼Œæˆ‘ä»¬ä¸å†éœ€è¦è®¢é˜…æ¯ä¸ª connect é«˜é˜¶ç»„ä»¶ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Again, there&amp;#39;re lack of many optimizations and error handlings
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// in this implementation for demonstration purpose.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kr">const&lt;/span> &lt;span class="nx">Provider&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">({&lt;/span> &lt;span class="nx">children&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">store&lt;/span> &lt;span class="p">})&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setState&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useState&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getState&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribe&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getState&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setState&lt;/span>&lt;span class="p">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">context&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useMemo&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">...&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">state&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">state&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Context.Provider&lt;/span> &lt;span class="na">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">context&lt;/span>&lt;span class="p">}&amp;gt;{&lt;/span>&lt;span class="nx">children&lt;/span>&lt;span class="p">}&amp;lt;/&lt;/span>&lt;span class="nt">Context.Provider&lt;/span>&lt;span class="p">&amp;gt;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">connect&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">mapStateToProps&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">WrappedComponent&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">props&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">dispatch&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useContext&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">mappedState&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">mapStateToProps&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">props&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">WrappedComponent&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="na">...props&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="na">...mappedState&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="na">dispatch&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">dispatch&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="p">/&amp;gt;;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä¸€åˆ‡çœ‹èµ·æ¥éƒ½å¦‚æ­¤å®Œç¾ï¼Œå®ç°çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥åƒç¬¬ä¸€ç§æ–¹æ³•ï¼ˆ&lt;code>react-redux&lt;/code> v4ï¼‰ä¸€æ ·è¿›è¡Œä¼˜åŒ–ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦å¤„ç†è¿‡æ—¶çš„ props å’Œåƒµå°¸å­èŠ‚ç‚¹é—®é¢˜ã€‚ä»æœ¬è´¨ä¸Šè®²ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬é€šå¸¸åœ¨ç”¨æˆ·åŒºåŸŸä¸­æ‰€åšçš„äº‹æƒ…ï¼Œä»¥åŠä¸€äº›å—æ¬¢è¿çš„åº“ï¼Œåƒ &lt;a href="https://github.com/jamiebuilds/unstated-next" target="_blank" rel="noopener">&lt;code>unstated-next&lt;/code>&lt;/a> ä¸ºæˆ‘ä»¬æ‰€åšçš„äº‹æƒ…ã€‚ä¸è¿‡ï¼Œå¯¹äºåªæœ‰ä¸€ä¸ªå…¨å±€ store çš„ &lt;code>Redux&lt;/code> æ¥è¯´ï¼Œæ‹¥æœ‰å¤šä¸ªæ›´å°çš„ store å¯èƒ½æ˜¯ä¸€ä¸ªå®Œç¾çš„è§£å†³æ–¹æ¡ˆã€‚æ€§èƒ½æˆæœ¬éå¸¸é«˜ï¼Œè¶³ä»¥è¿«ä½¿æˆ‘ä»¬å†æ¬¡å¯¹å…¶è¿›è¡Œè¿­ä»£ã€‚&lt;/p>
&lt;p>è¿˜è®°å¾—ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ä»ç¬¬ä¸€ç§æ–¹æ³•è¿­ä»£åˆ°åµŒå¥—è®¢é˜…æ¨¡å‹å—ï¼Ÿè¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥åœ¨è°ƒç”¨ &lt;code>setState&lt;/code> å’Œé‡æ¸²æŸ“ç»„ä»¶ä¹‹å‰å°±å°½æ—©è·³è¿‡æ›´æ–°ã€‚åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œç”±äºæˆ‘ä»¬åªèƒ½åœ¨æ¸²æŸ“é˜¶æ®µè·å¾—æ•´ä¸ªçŠ¶æ€ï¼Œ&lt;strong>å› æ­¤è¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»å§‹ç»ˆå…ˆè°ƒç”¨ &lt;code>setState&lt;/code> ç„¶åé‡æ¸²æŸ“ç»„ä»¶æ‰èƒ½åœ¨ä¹‹åè·å¾—æœ€æ–°çŠ¶æ€&lt;/strong>ã€‚åªæœ‰åˆ°é‚£æ—¶ï¼Œæˆ‘ä»¬æ‰èƒ½è°ƒç”¨ &lt;code>mapStateToProps&lt;/code> æ¥è·å¾—ç»„ä»¶å…³å¿ƒçš„æ˜ å°„çŠ¶æ€ã€‚å®é™…ä¸Šï¼Œåœ¨ &lt;code>react-redux&lt;/code> v6 é¦–æ¬¡å‘å¸ƒæ—¶ï¼Œæœ‰ä¸€äº›&lt;a href="https://github.com/reduxjs/react-redux/issues/1164" target="_blank" rel="noopener">æ€§èƒ½ä¸‹é™äº‹ä»¶&lt;/a>ã€‚æ­¤å¤–ï¼Œ&lt;a href="https://github.com/facebook/react/issues/14110#issuecomment-448074060" target="_blank" rel="noopener">React å›¢é˜Ÿç”šè‡³æåˆ°ä»–ä»¬ä¸å»ºè®®å½“æ—¶ä½¿ç”¨ React ä¸Šä¸‹æ–‡è¿›è¡Œç±»ä¼¼ flux çš„çŠ¶æ€ä¼ æ’­&lt;/a>ã€‚&lt;/p>
&lt;h2 id="hooks">Hooks&lt;/h2>
&lt;p>React ä¸Šä¸‹æ–‡ä¸æ˜¯ React å®¶æ—ä¸­çš„æœ€æ–°æˆå‘˜ï¼Œæˆ‘ä»¬è¿˜æœ‰ hookï¼ˆé’©å­ï¼‰ï¼&lt;code>react-redux&lt;/code> v7 å¼•å…¥äº†æ–°çš„åŸºäºé’©å­çš„ APIï¼Œè¿™äº› API ä½¿ä»£ç æ›´åŠ ç®€å•æ˜“æ‡‚ã€‚æœ€é‡è¦çš„é’©å­å¯èƒ½æ˜¯ &lt;code>useSelector&lt;/code> é’©å­ã€‚&lt;/p>
&lt;p>ä½†æ˜¯é¦–å…ˆï¼Œæˆ‘ä»¬å°†é‡å†™æˆ‘ä»¬çš„ Todo åº”ç”¨ç¨‹åºä»¥ä½¿ç”¨é’©å­ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œ&lt;code>&amp;lt;Todo&amp;gt;&lt;/code> å’Œ &lt;code>&amp;lt;TodoList&amp;gt;&lt;/code> ç»„ä»¶ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-jsx" data-lang="jsx">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">Todo&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">({&lt;/span> &lt;span class="nx">id&lt;/span> &lt;span class="p">})&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">content&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useSelector&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">todos&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">find&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">todo&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">todo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="nx">id&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">content&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">dispatch&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useDispatch&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">li&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="na">onClick&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">dispatch&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">type&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;DELETE&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">payload&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">id&lt;/span> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="nx">content&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">li&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">TodoList&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">todos&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">useSelector&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">todos&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">ul&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>&lt;span class="nx">todos&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">map&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">todo&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">Todo&lt;/span> &lt;span class="na">key&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">todo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="na">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">todo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">id&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">))}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">ul&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬ä¸å†éœ€è¦é‚£äº›å¸¦æœ‰é’©å­çš„é«˜é˜¶å‡½æ•°å®¹å™¨ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ &lt;code>useSelector&lt;/code> å’Œ &lt;code>useDispatch&lt;/code> æ¥è·å–é€‰å®šçš„çŠ¶æ€å’Œåˆ†å‘æ–¹æ³•ã€‚è¯·æ³¨æ„ä¸€ä¸ªå¾®å°çš„å·®åˆ«åœ¨æ™®é€šçš„æ—§çš„ &lt;code>mapStateToProps&lt;/code> å’Œ &lt;code>useSelector&lt;/code> ä¹‹é—´çš„æ˜¯æˆ‘ä»¬ä¸å†è·å–çŠ¶æ€ï¼ˆstateï¼‰çš„&lt;strong>å¯¹è±¡&lt;/strong>ï¼Œå¹¶å°†å…¶ä¼ æ’­åˆ° propsï¼Œè€Œæ˜¯ä»…ä»…å¾—åˆ°çŠ¶æ€æœ¬èº«ã€‚å› æ­¤ä»£æ›¿è·å¾— &lt;code>{ content }&lt;/code>ï¼Œæˆ‘ä»¬åªéœ€è¦å¾—åˆ° &lt;code>content&lt;/code>ã€‚åœ¨æˆ‘ä»¬çš„ &lt;code>setState&lt;/code> ä¸­ä¼šç¨å¾®æ”¹å˜æˆ‘ä»¬çš„ç›¸ç­‰æ€§æ£€æŸ¥ã€‚&lt;/p>
&lt;p>&lt;code>useDispatch&lt;/code> é’©å­å®ç°ä¹Ÿå¾ˆç®€å•ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">useDispatch&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useContext&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">Content&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">dispatch&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>æˆ‘ä»¬ä¹Ÿå¯ä»¥è½»æ¾åˆ›å»ºæˆ‘ä»¬çš„ &lt;code>useSelector&lt;/code> é’©å­ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">useSelector&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">selector&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">store&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useContext&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[,&lt;/span> &lt;span class="nx">forceUpdate&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useReducer&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">c&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">state&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">selector&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getState&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribe&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">forceUpdate&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">forceUpdate&lt;/span>&lt;span class="p">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">state&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ä½†æ˜¯ï¼Œå®ƒç”šè‡³è¿˜ä¸èƒ½ç«‹å³ä½¿ç”¨ã€‚æ¯æ¬¡çŠ¶æ€æ›´æ–°æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šé‡æ¸²æŸ“æ‰€æœ‰çš„ &lt;strong>connected&lt;/strong> ç»„ä»¶ã€‚ä½¿ç”¨é’©å­ API ä¼šæ›´åŠ ç³Ÿç³•ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä¸€ä¸ªä¸­é—´å®¹å™¨ç»„ä»¶ï¼Œè¯¥ç»„ä»¶é€šå¸¸èƒ½è¿›è¡Œå»‰ä»·çš„æ¸²æŸ“ï¼Œå¯ä»¥æŒ½æ•‘é€šå¸¸æ›´æ˜‚è´µçš„åŒ…è£…ç»„ä»¶çš„æ›´æ–°ã€‚ä¸ä»¥å‰çš„æƒè¡¡å–èˆä¸åŒï¼Œæˆ‘ä»¬æœ‰ç‚¹å¿…é¡»æŠŠ &lt;code>selector&lt;/code> æ”¾å…¥ç›‘å¬å™¨å›è°ƒä¸­ä»¥å°½æ—©è·³è¿‡æ›´æ–°ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">useSelector&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">selector&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">store&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useContext&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setState&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useState&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">selector&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getState&lt;/span>&lt;span class="p">()));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribe&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">selector&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getState&lt;/span>&lt;span class="p">()));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">setState&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">selector&lt;/span>&lt;span class="p">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">state&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>è¿™ä¸ªç‰ˆæœ¬åªæ˜¯ç®€å•çš„æ‰“ç ´ã€‚æˆ‘ä»¬åœ¨æ•´ä¸ªæ–‡ç« ä¸­å†æ¬¡æåˆ°&lt;strong>è¿‡æ—¶çš„ props å’Œåƒµå°¸å­èŠ‚ç‚¹&lt;/strong>é—®é¢˜ã€‚ä¸å¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬å°†éå†æ¯ä¸ªæ­¥éª¤ï¼Œä»¥æŸ¥çœ‹é”™è¯¯çš„å‡ºå¤„å’ŒåŸå› ã€‚&lt;/p>
&lt;ol>
&lt;li>åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“åï¼Œ&lt;code>&amp;lt;TodoList&amp;gt;&lt;/code> å’Œ &lt;code>&amp;lt;Todo&amp;gt;&lt;/code> ç»„ä»¶åœ¨ &lt;code>useEffect&lt;/code> ä¸­è®¢é˜… storeã€‚å› ä¸º &lt;code>useEffect&lt;/code> è‡ªä¸Šè€Œä¸‹è§¦å‘ï¼Œ&lt;code>&amp;lt;Todo&amp;gt;&lt;/code> é¦–å…ˆè®¢é˜…ï¼Œç„¶åæ˜¯ &lt;code>&amp;lt;TodoList&amp;gt;&lt;/code>ã€‚&lt;/li>
&lt;li>ç”¨æˆ·ç‚¹å‡» &lt;code>&amp;lt;Todo&amp;gt;&lt;/code>ï¼Œå‘ store åˆ†å‘ä¸€ä¸ª &lt;code>DELETE&lt;/code> åŠ¨ä½œï¼ŒæœŸå¾…è¯¥é¡¹è¢«åˆ é™¤ã€‚&lt;/li>
&lt;li>store æ”¶åˆ°è¿™ä¸ªåŠ¨ä½œ,é€šè¿‡ &lt;strong>reducer&lt;/strong> è¿è¡Œå®ƒï¼Œç„¶åå°† &lt;code>todos&lt;/code> çŠ¶æ€æ›´æ”¹ä¸ºç©ºæ•°ç»„ &lt;code>{ todos: [] }&lt;/code>ã€‚&lt;/li>
&lt;li>ç„¶åï¼Œstore è°ƒç”¨å·²è®¢é˜…çš„ç›‘å¬å™¨ã€‚ç”±äº &lt;code>&amp;lt;Todo&amp;gt;&lt;/code> å…ˆè®¢é˜…ï¼Œå› æ­¤ä¹Ÿä¼šå…ˆè°ƒç”¨å®ƒçš„ç›‘å¬å™¨ã€‚&lt;/li>
&lt;li>&lt;strong>ç”±äºæˆ‘ä»¬åœ¨æ¸²æŸ“é˜¶æ®µä¼ é€’ &lt;code>props&lt;/code> ç»™ &lt;code>listener&lt;/code>ï¼Œåœ¨é‚£æ—¶å…¶å½¢æˆäº†å°é—­çš„ &lt;code>props&lt;/code>ã€‚å®ƒä»¬æ˜¯è¿‡æ—¶çš„ props&lt;/strong>ã€‚è®¿é—® &lt;code>state.todos[ownProps.id]&lt;/code> å°†å¯¼è‡´ &lt;code>undefined&lt;/code>ï¼Œç„¶åè°ƒç”¨ &lt;code>(undefined).content&lt;/code> å°†å¯¼è‡´ä¸€ä¸ªé”™è¯¯ ğŸ’¥ã€‚&lt;/li>
&lt;/ol>
&lt;p>å›æƒ³ä¸€ä¸‹åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å¯¹è¿‡æ—¶çš„ props é—®é¢˜çš„äº†è§£ã€‚&lt;strong>å½“å­èŠ‚ç‚¹ä»¬ä½¿ç”¨ä» store æ´¾ç”Ÿçš„ props æ—¶ï¼Œè¿‡æ—¶çš„ props å°†åœ¨åŒæ­¥è®¢é˜…æ¨¡å‹ä¸­å‘ç”Ÿ&lt;/strong>ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæœ‰ 2 ä¸ªè§£å†³æ–¹æ¡ˆã€‚&lt;/p>
&lt;ol>
&lt;li>ç§»åŠ¨ &lt;code>selector&lt;/code> åˆ°æ¸²æŸ“é˜¶æ®µå’Œä½¿ç”¨ &lt;code>unstable_batchedUpdates&lt;/code>&lt;/li>
&lt;li>ä½¿ç”¨åµŒå¥—è®¢é˜…æ¨¡å‹&lt;/li>
&lt;/ol>
&lt;p>é’©å­æ— æ³•æ›´æ”¹æ¸²æŸ“æ ‘ï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•ä¸ºæ¯ä¸ªç»„ä»¶æ·»åŠ ä¸€ä¸ªæ–°çš„ &lt;code>&amp;lt;Provider&amp;gt;&lt;/code>ï¼Œä»¥ä½¿å…¶ä¼ æ’­åˆ°æœ€è¿‘çš„çˆ¶çº§ subStoreã€‚æˆ‘ä»¬å¯ä»¥å¿«é€Ÿæ’é™¤ç¬¬äºŒç§è§£å†³æ–¹æ¡ˆã€‚&lt;/p>
&lt;p>å¯¹äºç¬¬ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œå½“æˆ‘ä»¬ä»…åœ¨æ¸²æŸ“é˜¶æ®µä½¿ç”¨ &lt;code>selector&lt;/code>ï¼Œå®ƒçš„æ€§èƒ½ä¸ä½³ï¼Œä¼šå¯¼è‡´æ¯æ¬¡æ›´æ”¹éƒ½éœ€è¦é‡æ¸²æŸ“ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»åœ¨ç›‘å¬å™¨å›è°ƒä¸­å°½æ—©è·³è¿‡æ›´æ–°ã€‚å†è€…ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ç›‘å¬å™¨å›è°ƒä¸­è°ƒç”¨è¿‡æ—¶çš„ props åˆ™å¯èƒ½ä¼šå¯¼è‡´ &lt;code>selector&lt;/code> æŠ›å‡ºé”™è¯¯ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬çš„åŒæ‰‹è¢«æŸç¼šï¼Œå°šæ— è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¿…é¡»åšå‡ºä¸€äº›å¦¥åã€‚&lt;/p>
&lt;p>å¦‚æœæˆ‘ä»¬å¿½ç•¥è¯¥é”™è¯¯ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿæˆ‘ä»¬é¦–å…ˆè¦é—®è‡ªå·±ä¸€ä¸ªé—®é¢˜ï¼šä½•æ—¶ä¼šå‘ç”Ÿé”™è¯¯ï¼Ÿå¤§çº¦æœ‰ 2 ç§æƒ…å†µã€‚é”™è¯¯å¯èƒ½æ˜¯ç”±äºé€‰æ‹©å™¨æœ¬èº«çš„é”™è¯¯è€Œå¼•èµ·çš„ï¼Œæˆ–è€…å› ä¸ºåƒµå°¸å­èŠ‚ç‚¹é—®é¢˜å¯¼è‡´äº†æ„å¤–é”™è¯¯ã€‚æ— è®ºå“ªç§æ–¹å¼ï¼Œæˆ‘ä»¬éƒ½å¸Œæœ›é€šè¿‡é‡æ–°æ¸²æŸ“ç»„ä»¶å¹¶åœ¨æ¸²æŸ“é˜¶æ®µåº”ç”¨ &lt;code>selector(store.getState())&lt;/code> ä»¥è·å–æœ€æ–°çŠ¶æ€æ¥å®‰å…¨åœ°å¤„ç†å®ƒä»¬ã€‚å‰ä¸€ç§æƒ…å†µå°†åœ¨æ¸²æŸ“é˜¶æ®µ&lt;strong>é‡æ–°å¼•å‘&lt;/strong>é”™è¯¯ï¼Œè€Œåè€…å°†ä¸ä¼šäº§ç”Ÿä»»ä½•é”™è¯¯ã€‚&lt;/p>
&lt;p>é‚£ç§ä¸ä¼šæŠ›å‡ºè¿‡æ—¶çš„ props é—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬ä»ç„¶å¯ä»¥å¾—åˆ°ä¸ä¸€è‡´çŠ¶æ€ä½†æ²¡æœ‰é”™è¯¯çš„æƒ…å†µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ— è®ºå¦‚ä½•ç»„ä»¶ä»ç„¶ä¼šåœ¨ä»¥åé‡æ–°æ¸²æŸ“ï¼Œå› ä¸ºæˆ‘ä»¬ä»å°†å¤„äº &lt;code>selector(store.getState())&lt;/code> æ¸²æŸ“é˜¶æ®µï¼Œå› æ­¤ç”±äºæˆ‘ä»¬ä¸Šé¢æåˆ°çš„ç¬¬ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œé—®é¢˜å°†æ¶ˆå¤±ã€‚&lt;/p>
&lt;p>çœ‹èµ·æ¥æˆ‘ä»¬å¯ä»¥åœ¨ç¬¬ 5 æ­¥ä¸­å®‰å…¨åœ°å¿½ç•¥è¯¥é”™è¯¯ï¼Œè€Œåœ¨æ¸²æŸ“é˜¶æ®µé‡è¯•è¯¥é”™è¯¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">useSelector&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">selector&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">store&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useContext&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="p">[,&lt;/span> &lt;span class="nx">forceUpdate&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useReducer&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">c&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">currentState&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useRef&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Try to get the state in the render phase to safely get the latest props
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">currentState&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">current&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">selector&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getState&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">React&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">useEffect&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">subscribe&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">nextState&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">selector&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">getState&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">nextState&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="nx">currentState&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">current&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Bail out updates early
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Ignore errors
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Either way we want to force a re-render
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">forceUpdate&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">forceUpdate&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">selector&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">currentState&lt;/span>&lt;span class="p">]);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">currentState&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">current&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>ç»“åˆ &lt;code>unstable_batchedUpdates&lt;/code> çš„æŠ€å·§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é€‰å®šçŠ¶æ€ä¸å˜çš„æƒ…å†µä¸‹å°½æ—©è·³è¿‡æ›´æ–°ï¼Œå¹¶å®‰å…¨åœ°é˜²æ­¢è¿‡æ—¶çš„ props å’Œåƒµå°¸å­èŠ‚ç‚¹é—®é¢˜ã€‚æˆ‘ä»¬å†æ¬¡è¿è¡Œä»£ç ï¼Œå¹¶æ£€æŸ¥ä¸€åˆ‡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚å‰ 4 ä¸ªæ­¥éª¤ç›¸åŒï¼Œå› æ­¤æˆ‘ä»¬ä»ç¬¬ 5 æ­¥å¼€å§‹ã€‚&lt;/p>
&lt;ol start="5">
&lt;li>ç”±äºæˆ‘ä»¬åœ¨æ¸²æŸ“é˜¶æ®µä¼ é€’ &lt;code>props&lt;/code> ç»™ &lt;code>listener&lt;/code>ï¼Œåœ¨é‚£æ—¶ï¼Œå…¶å½¢æˆäº†å°é—­çš„ &lt;code>props&lt;/code>ï¼Œæ¢å¥è¯è¯´ï¼Œå®ƒæ˜¯&lt;strong>è¿‡æ—¶çš„ props&lt;/strong>ã€‚è®¿é—® &lt;code>state.todos[ownProps.id]&lt;/code> å°†å¯¼è‡´ &lt;code>undefined&lt;/code>ï¼Œç„¶åè°ƒç”¨ &lt;code>(undefined).content&lt;/code> å°†å¯¼è‡´é”™è¯¯ã€‚&lt;strong>æˆ‘ä»¬æ•…æ„æ•è·å¹¶éšè—é”™è¯¯ï¼Œè¿™æ˜¯å½“æˆ‘ä»¬çŸ¥é“è¦åœ¨æ¸²æŸ“é˜¶æ®µé€‰æ‹©çŠ¶æ€ï¼Œä»è€Œè§¦å‘é‡æ¸²æŸ“æ—¶&lt;/strong>ã€‚&lt;/li>
&lt;li>ç”±äºæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ &lt;code>unstable_batchedUpdates&lt;/code>ï¼Œæ¸²æŸ“å·²è¢«æ‰¹å¤„ç†ã€‚&lt;code>&amp;lt;TodoList&amp;gt;&lt;/code> è§¦å‘å…¶ç›‘å¬å™¨å›è°ƒï¼Œ&lt;code>selector(store.getState())&lt;/code> çš„ç»“æœä¸º &lt;code>[]&lt;/code>ï¼Œä¹Ÿè®¡åˆ’é‡æ¸²æŸ“ã€‚&lt;/li>
&lt;li>æ¸²æŸ“ä»ä¸Šå‘ä¸‹è¿›è¡Œæ“ä½œï¼Œ&lt;code>&amp;lt;TodoList&amp;gt;&lt;/code> å…ˆæ¸²æŸ“ï¼Œç„¶åå†æ¬¡è°ƒç”¨ &lt;code>selector(store.getState())&lt;/code>ï¼Œè¿”å›ä¸€ä¸ªç©ºçš„ &lt;code>&amp;lt;ul&amp;gt;&lt;/code>ï¼Œå®Œæˆæ¸²æŸ“ã€‚&lt;/li>
&lt;/ol>
&lt;p>åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å‡è®¾ç”¨æˆ·æä¾›çš„ &lt;code>selector&lt;/code> å‡½æ•°å¿…é¡»éµå¾ª 2 æ¡è§„åˆ™ã€‚&lt;/p>
&lt;ol>
&lt;li>&lt;code>selector&lt;/code> æ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚&lt;/li>
&lt;li>ä»£ç ä¸ä¾èµ–ä¹Ÿä¸æœŸæœ› &lt;code>selector&lt;/code> æŠ›å‡ºé”™è¯¯ã€‚&lt;/li>
&lt;/ol>
&lt;p>ç®€è€Œè¨€ä¹‹ï¼Œ&lt;code>selector&lt;/code> å¿…é¡»æ˜¯ä¸€ä¸ª&lt;strong>çº¯å‡½æ•°&lt;/strong>ã€‚åœ¨æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè¿è¡Œ &lt;code>selector&lt;/code> å¤šæ¬¡ã€‚åªè¦ &lt;code>selector&lt;/code> æ˜¯çº¯çš„ï¼Œé‚£ä¹ˆå¤šæ¬¡è¿è¡Œå®ƒä»¬å°±ä¸æˆé—®é¢˜ã€‚è€Œä¸”ï¼Œ&lt;code>React.StrictMode&lt;/code> å·²ç»æ‰§è¡Œäº†ä¸€æ®µæ—¶é—´çš„æ¸²æŸ“è§„åˆ™ï¼Œåœ¨ &lt;code>selector&lt;/code> ä¸­ï¼Œè¿™æ ·åšä¹Ÿæ˜¯ä¸€ç§æ›´å¥½çš„åšæ³•ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å†³å®šä»¥ç”¨æˆ·èº«ä»½è‡ªè¡Œå¤„ç†é—®é¢˜ã€‚è°¨æ…åœ°ä¿æŠ¤ &lt;code>selecto&lt;/code> å‡½æ•°å¹¶é€‚å½“åœ°å¤„ç†é”™è¯¯ï¼Œè™½ç„¶æœ‰ç‚¹å¤šï¼Œä½†æ˜¯ä»ç„¶æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚&lt;/p>
&lt;p>æˆ‘ä»¬å¯ä»¥åšæ›´å¤šçš„ä¼˜åŒ–æ¥å¢å¼ºæ€§èƒ½ï¼Œä¾‹å¦‚ä»…åœ¨éœ€è¦æ—¶ï¼ˆå½“å®ƒæœ‰è¿‡æ—¶çš„ props æˆ–é€‰æ‹©å™¨å‘ç”Ÿæ›´æ”¹æ—¶ï¼‰åœ¨æ¸²æŸ“é˜¶æ®µæ‰å¼ºåˆ¶å…¶è°ƒç”¨ &lt;code>selector&lt;/code>ã€‚ä½†æ˜¯ï¼Œè¿™æ˜¯ &lt;code>useSelector&lt;/code> åœ¨åå°å¦‚ä½•å·¥ä½œä»¥åŠä¸ºä»€ä¹ˆæˆ‘ä»¬å¿…é¡»ä¿æŒé€‰æ‹©å™¨ä¸º&lt;strong>çº¯çš„&lt;/strong>åŸºæœ¬æ€æƒ³ã€‚&lt;/p>
&lt;h2 id="æ”¶è·">æ”¶è·&lt;/h2>
&lt;p>Phewï¼è¿™æ˜¯ä¸€æ®µæ¼«é•¿çš„æ—…ç¨‹ã€‚ç»™è‡ªå·±ä¸€ä¸ªèµ°åˆ°æœ€åçš„æŒå£°ã€‚è·Ÿç€èµ°å¹¶ä¸å®¹æ˜“ï¼&lt;/p>
&lt;p>é‡æ–°åˆ›å»º &lt;code>Redux&lt;/code> çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†è¦å°å¿ƒå¤„ç†è®¸å¤šé™·é˜±ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç”šè‡³æ²¡æœ‰æåˆ°å¤§é‡çš„ä¼˜åŒ–å’Œé”™è¯¯å¤„ç†ã€‚&lt;/p>
&lt;p>å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æ›´å¥½åœ°äº†è§£ &lt;code>Redux&lt;/code> å’Œ &lt;code>react-redux&lt;/code> çš„èƒŒåçš„å·¥ä½œåŸç†å¾ˆæœ‰å¸®åŠ©ã€‚ä¹Ÿèµæ‰¬æ‰€æœ‰ç»´æŠ¤è€…å’Œè´¡çŒ®è€…åˆ›å»ºäº†å¦‚æ­¤å‡ºè‰²çš„åº“å¹¶ä¸æ–­åœ°å¯¹å…¶è¿›è¡Œæ”¹è¿›ã€‚å³ä½¿æˆ‘åŒæ„ä½ å¯èƒ½ä¸éœ€è¦ &lt;code>Redux&lt;/code>ï¼Œå®ƒä»ç„¶ä¸ºä¸­å‹ä¹ƒè‡³å¤§å‹å›¢é˜Ÿæä¾›äº†ä¸€ç§æœ‰ç”¨çš„æ¨¡å¼ï¼Œä½¿ä»–ä»¬å¯ä»¥é¡ºåˆ©åœ°è¿›è¡Œåä½œã€‚&lt;/p>
&lt;p>ä¸‹æ¬¡ï¼Œå½“ä½ å‘ç°å…¶å®ƒäººå°† &lt;code>Redux&lt;/code> è§†ä¸ºç†æ‰€å½“ç„¶æ—¶ï¼Œè¯·é—®ä»–/ä»–å¦‚ä½•è§£å†³&lt;strong>è¿‡æ—¶çš„ props å’Œåƒµå°¸å­èŠ‚ç‚¹&lt;/strong>é—®é¢˜ï¼Œå¹¶å‘å¥¹/ä»–å±•ç¤ºæ­¤å¸–å­ ğŸ˜‰ã€‚&lt;/p>
&lt;h2 id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« &lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://blog.isquaredsoftware.com/2018/11/react-redux-history-implementation/" target="_blank" rel="noopener">Idiomatic Redux: The History and Implementation of React-Redux&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/reduxjs/react-redux/pull/99" target="_blank" rel="noopener">reduxjs/react-redux#99 (Fix issues with stale props #99) Where the stale props first fixed back in v4&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/reduxjs/react-redux/issues/292" target="_blank" rel="noopener">reduxjs/react-redux#292 (Can we avoid inconsistencies on non-batched dispatches?) Where Dan found that the order doesn&amp;rsquo;t matter, but batching updates does&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/reduxjs/react-redux/issues/1177" target="_blank" rel="noopener">reduxjs/react-redux#1177 (React-Redux Roadmap: v6, Context, Subscriptions, and Hooks)&lt;/a>
&lt;ul>
&lt;li>&lt;a href="https://github.com/reduxjs/react-redux/issues/1177#issuecomment-468765242" target="_blank" rel="noopener">Mark explains that &lt;code>unstable_batchedUpdates&lt;/code> isn&amp;rsquo;t sufficient for fixing stale props due to performance reason&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="https://github.com/reduxjs/react-redux/issues/1179" target="_blank" rel="noopener">reduxjs/react-redux#1179 (Discussion: Potential hooks API design)&lt;/a>
&lt;ul>
&lt;li>&lt;a href="https://github.com/reduxjs/react-redux/issues/1179#issuecomment-482164630" target="_blank" rel="noopener">A comment by the author of the hooks API proposal&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/reduxjs/react-redux/issues/1179#issuecomment-483617153" target="_blank" rel="noopener">Example test cases for stale props with hooks&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&amp;hellip;, and many more which I simply cannot recall where I read them.&lt;/li>
&lt;/ul></description></item></channel></rss>