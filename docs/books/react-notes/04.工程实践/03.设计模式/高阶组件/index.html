<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="React 高阶组件详解 高阶组件（HOC）是 React 中用于复用组件逻辑的一种高级技巧。HOC 自身不是 React API 的一部分，它是一种基于 React 的组合特性而形成的设计模式。具体而言，高阶组件是参数为组件，返回值为新组件的函数；高阶组"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/03.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.fab3cd1900ae35687457073b2d518207.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/03.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/03.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6/"><meta property="og:title" content="高阶组件 | Next-gen Tech Edu"><meta property="og:description" content="React 高阶组件详解 高阶组件（HOC）是 React 中用于复用组件逻辑的一种高级技巧。HOC 自身不是 React API 的一部分，它是一种基于 React 的组合特性而形成的设计模式。具体而言，高阶组件是参数为组件，返回值为新组件的函数；高阶组"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>高阶组件 | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=2871e4dcd1fb368df71204e1d152452f><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">03.设计模式</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id9e6f75436f88dbd5c407bb187c8128b4")' href=#id9e6f75436f88dbd5c407bb187c8128b4 aria-expanded=false aria-controls=id9e6f75436f88dbd5c407bb187c8128b4 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/>04.工程实践</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id9e6f75436f88dbd5c407bb187c8128b4 aria-expanded=false aria-controls=id9e6f75436f88dbd5c407bb187c8128b4><i class="fa-solid fa-angle-down" id=caret-id9e6f75436f88dbd5c407bb187c8128b4></i></a></div><ul class="nav docs-sidenav collapse show" id=id9e6f75436f88dbd5c407bb187c8128b4><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id7af49256d9bfb815dda74a88280c47ec")' href=#id7af49256d9bfb815dda74a88280c47ec aria-expanded=false aria-controls=id7af49256d9bfb815dda74a88280c47ec aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/01.%E9%9D%99%E6%80%81%E7%B1%BB%E5%9E%8B/>01.静态类型</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id7af49256d9bfb815dda74a88280c47ec aria-expanded=false aria-controls=id7af49256d9bfb815dda74a88280c47ec><i class="fa-solid fa-angle-right" id=caret-id7af49256d9bfb815dda74a88280c47ec></i></a></div><ul class="nav docs-sidenav collapse" id=id7af49256d9bfb815dda74a88280c47ec><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/01.%E9%9D%99%E6%80%81%E7%B1%BB%E5%9E%8B/flow/>Flow</a></li><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/01.%E9%9D%99%E6%80%81%E7%B1%BB%E5%9E%8B/typescript/>TypeScript</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id35bd09b4817ab765c718c2461cd24bed")' href=#id35bd09b4817ab765c718c2461cd24bed aria-expanded=false aria-controls=id35bd09b4817ab765c718c2461cd24bed aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/02.%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD/>02.数据加载</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id35bd09b4817ab765c718c2461cd24bed aria-expanded=false aria-controls=id35bd09b4817ab765c718c2461cd24bed><i class="fa-solid fa-angle-right" id=caret-id35bd09b4817ab765c718c2461cd24bed></i></a></div><ul class="nav docs-sidenav collapse" id=id35bd09b4817ab765c718c2461cd24bed><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id2940e821279586cb73ce22fc69ac133c")' href=#id2940e821279586cb73ce22fc69ac133c aria-expanded=false aria-controls=id2940e821279586cb73ce22fc69ac133c aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/02.%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD/react-query/>React Query</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id2940e821279586cb73ce22fc69ac133c aria-expanded=false aria-controls=id2940e821279586cb73ce22fc69ac133c><i class="fa-solid fa-angle-right" id=caret-id2940e821279586cb73ce22fc69ac133c></i></a></div><ul class="nav docs-sidenav collapse" id=id2940e821279586cb73ce22fc69ac133c><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/02.%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD/react-query/%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2/>高级查询</a></li><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/02.%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD/react-query/%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/>快速开始</a></li></ul></div><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/02.%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD/suspense/>Suspense</a></li><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/02.%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD/%E6%95%B0%E6%8D%AE%E8%AF%B7%E6%B1%82/>数据请求</a></li><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/02.%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD/%E5%BC%82%E6%AD%A5%E6%B8%B2%E6%9F%93/>异步渲染</a></li><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/02.%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD/%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1/>组件间通信</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idb43c0c4fb505d039a249b6cc475b5b81")' href=#idb43c0c4fb505d039a249b6cc475b5b81 aria-expanded=false aria-controls=idb43c0c4fb505d039a249b6cc475b5b81 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/03.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/>03.设计模式</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idb43c0c4fb505d039a249b6cc475b5b81 aria-expanded=false aria-controls=idb43c0c4fb505d039a249b6cc475b5b81><i class="fa-solid fa-angle-down" id=caret-idb43c0c4fb505d039a249b6cc475b5b81></i></a></div><ul class="nav docs-sidenav collapse show" id=idb43c0c4fb505d039a249b6cc475b5b81><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/03.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/renderprops/>renderProps</a></li><li class="child level active"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/03.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6/>高阶组件</a></li><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/03.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%85%B6%E4%BB%96%E6%8A%80%E5%B7%A7/>其他技巧</a></li><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/03.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E7%BB%84%E4%BB%B6%E5%88%92%E5%88%86/>组件划分</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id0b148fa0f7e84e94cd52a42477c46128")' href=#id0b148fa0f7e84e94cd52a42477c46128 aria-expanded=false aria-controls=id0b148fa0f7e84e94cd52a42477c46128 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/04.%E9%A3%8E%E6%A0%BC%E6%8C%87%E5%8D%97/>04.风格指南</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id0b148fa0f7e84e94cd52a42477c46128 aria-expanded=false aria-controls=id0b148fa0f7e84e94cd52a42477c46128><i class="fa-solid fa-angle-right" id=caret-id0b148fa0f7e84e94cd52a42477c46128></i></a></div><ul class="nav docs-sidenav collapse" id=id0b148fa0f7e84e94cd52a42477c46128><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id987eb8a2f2d8ce1744448f266af8155a")' href=#id987eb8a2f2d8ce1744448f266af8155a aria-expanded=false aria-controls=id987eb8a2f2d8ce1744448f266af8155a aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/04.%E9%A3%8E%E6%A0%BC%E6%8C%87%E5%8D%97/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/>99.参考资料</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id987eb8a2f2d8ce1744448f266af8155a aria-expanded=false aria-controls=id987eb8a2f2d8ce1744448f266af8155a><i class="fa-solid fa-angle-right" id=caret-id987eb8a2f2d8ce1744448f266af8155a></i></a></div><ul class="nav docs-sidenav collapse" id=id987eb8a2f2d8ce1744448f266af8155a><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/04.%E9%A3%8E%E6%A0%BC%E6%8C%87%E5%8D%97/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2021-react-philosophies/>2021-React Philosophies</a></li></ul></div></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ida476e5123b1eb155c837c2f90a902103")' href=#ida476e5123b1eb155c837c2f90a902103 aria-expanded=false aria-controls=ida476e5123b1eb155c837c2f90a902103 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93/>服务端渲染</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ida476e5123b1eb155c837c2f90a902103 aria-expanded=false aria-controls=ida476e5123b1eb155c837c2f90a902103><i class="fa-solid fa-angle-right" id=caret-ida476e5123b1eb155c837c2f90a902103></i></a></div><ul class="nav docs-sidenav collapse" id=ida476e5123b1eb155c837c2f90a902103><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93/react-router/>React Router</a></li><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93/%E6%90%AD%E5%BB%BA%E6%B8%B2%E6%9F%93%E6%9C%8D%E5%8A%A1%E5%99%A8/>搭建渲染服务器</a></li><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93%E6%80%A7%E8%83%BD%E6%B5%85%E6%9E%90/>服务端渲染性能浅析</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id702d61a018a7bd1a4722c128e3328a91")' href=#id702d61a018a7bd1a4722c128e3328a91 aria-expanded=false aria-controls=id702d61a018a7bd1a4722c128e3328a91 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%BB%84%E4%BB%B6/>服务端组件</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id702d61a018a7bd1a4722c128e3328a91 aria-expanded=false aria-controls=id702d61a018a7bd1a4722c128e3328a91><i class="fa-solid fa-angle-right" id=caret-id702d61a018a7bd1a4722c128e3328a91></i></a></div><ul class="nav docs-sidenav collapse" id=id702d61a018a7bd1a4722c128e3328a91><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%BB%84%E4%BB%B6/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%BB%84%E4%BB%B6%E7%9A%84%E4%BC%98%E5%8A%BF/>服务端组件的优势</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id6f99b90d9c58cb8b10421b95e5b72cfd")' href=#id6f99b90d9c58cb8b10421b95e5b72cfd aria-expanded=false aria-controls=id6f99b90d9c58cb8b10421b95e5b72cfd aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E7%B1%BB-react-%E5%BA%93/>类 React 库</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id6f99b90d9c58cb8b10421b95e5b72cfd aria-expanded=false aria-controls=id6f99b90d9c58cb8b10421b95e5b72cfd><i class="fa-solid fa-angle-right" id=caret-id6f99b90d9c58cb8b10421b95e5b72cfd></i></a></div><ul class="nav docs-sidenav collapse" id=id6f99b90d9c58cb8b10421b95e5b72cfd><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E7%B1%BB-react-%E5%BA%93/inferno/>Inferno</a></li><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E7%B1%BB-react-%E5%BA%93/preact/>Preact</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idbfff3547eefbca83786831ee25cfb3a1")' href=#idbfff3547eefbca83786831ee25cfb3a1 aria-expanded=false aria-controls=idbfff3547eefbca83786831ee25cfb3a1 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/>性能优化</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idbfff3547eefbca83786831ee25cfb3a1 aria-expanded=false aria-controls=idbfff3547eefbca83786831ee25cfb3a1><i class="fa-solid fa-angle-right" id=caret-idbfff3547eefbca83786831ee25cfb3a1></i></a></div><ul class="nav docs-sidenav collapse" id=idbfff3547eefbca83786831ee25cfb3a1><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E4%BB%A3%E7%A0%81%E5%88%86%E5%89%B2%E4%B8%8E%E5%BC%82%E6%AD%A5%E5%8A%A0%E8%BD%BD/>代码分割与异步加载</a></li><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E6%80%A7%E8%83%BD%E8%AF%84%E6%B5%8B%E4%B8%8E%E5%88%86%E6%9E%90/>性能评测与分析</a></li><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E5%BC%82%E6%AD%A5%E7%A2%8E%E7%89%87%E5%8C%96%E7%8A%B6%E6%80%81%E6%9B%B4%E6%96%B0/>异步碎片化状态更新</a></li><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E7%BB%84%E4%BB%B6%E6%B8%B2%E6%9F%93%E4%BC%98%E5%8C%96/>组件渲染优化</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id87d1a42ed9bdf498dfbe844805948289")' href=#id87d1a42ed9bdf498dfbe844805948289 aria-expanded=false aria-controls=id87d1a42ed9bdf498dfbe844805948289 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E7%BB%84%E4%BB%B6%E6%B5%8B%E8%AF%95/>组件测试</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id87d1a42ed9bdf498dfbe844805948289 aria-expanded=false aria-controls=id87d1a42ed9bdf498dfbe844805948289><i class="fa-solid fa-angle-right" id=caret-id87d1a42ed9bdf498dfbe844805948289></i></a></div><ul class="nav docs-sidenav collapse" id=id87d1a42ed9bdf498dfbe844805948289><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E7%BB%84%E4%BB%B6%E6%B5%8B%E8%AF%95/enzyme/>Enzyme</a></li><li class="child level"><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E7%BB%84%E4%BB%B6%E6%B5%8B%E8%AF%95/jest/>Jest</a></li></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#操作-props>操作 props</a></li><li><a href=#通过-refs-访问到组件实例>通过 Refs 访问到组件实例</a></li><li><a href=#提取-state>提取 state</a></li><li><a href=#用其他元素包裹-wrappedcomponent>用其他元素包裹 WrappedComponent</a></li><li><a href=#hoc-和参数>HOC 和参数</a></li><li><a href=#案例分析>案例分析</a></li></ul><ul><li><a href=#渲染劫持render-highjacking>渲染劫持（Render Highjacking）</a></li><li><a href=#操作-state>操作 state</a></li></ul><ul><li><a href=#命名>命名</a></li><li><a href=#不要改变原始组件>不要改变原始组件</a></li><li><a href=#不要在-render-方法中使用-hoc>不要在 render 方法中使用 HOC</a></li><li><a href=#务必复制静态方法>务必复制静态方法</a></li></ul><ul><li><a href=#通用数据加载>通用数据加载</a></li><li><a href=#props-throttle>Props Throttle</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>高阶组件</h1><div class=article-style><h1 id=react-高阶组件详解>React 高阶组件详解</h1><p>高阶组件（HOC）是 React 中用于复用组件逻辑的一种高级技巧。HOC 自身不是 React API 的一部分，它是一种基于 React 的组合特性而形成的设计模式。具体而言，高阶组件是参数为组件，返回值为新组件的函数；高阶组件就是一个 React 组件包裹着另外一个 React 组件。这种模式通常使用函数来实现，基本上是一个类工厂；它的函数签名可以用类似 Haskell 的伪代码表示：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>hocFactory:: W: React.Component <span class=o>=</span>&gt; E: React.Component
</span></span></code></pre></div><p>其中 W (WrappedComponent) 指被包裹的 React.Component，E (EnhancedComponent) 指返回类型为 React.Component 的新的 HOC。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>EnhancedComponent</span> <span class=o>=</span> <span class=nx>higherOrderComponent</span><span class=p>(</span><span class=nx>WrappedComponent</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>higherOrderComponent</span> <span class=o>=</span> <span class=nx>BaseComponent</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// create new component from old one and update
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>EnhancedComponent</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>React 中两种 HOC 的实现方法：Props Proxy (PP) and Inheritance Inversion (II)，两种方法都可以操作 WrappedComponent。</p><h1 id=props-proxy>Props Proxy</h1><p>Props Proxy (PP) 主要是 HOC 在 render 方法中 返回 了一个 WrappedComponent 类型的 React Element。我们还传入了 HOC 接收到的 props，这就是名字 Props Proxy 的由来。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kd>function</span> <span class=nx>ppHOC</span><span class=p>(</span><span class=nx>WrappedComponent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=kr>class</span> <span class=nx>PP</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>&lt;</span><span class=nt>WrappedComponent</span> <span class=p>{</span><span class=na>...this.props</span><span class=p>}</span> <span class=p>/&gt;;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>在 React 内部的一致化处理（reconciliation process）中，两者都创建了一个 React Element 用于渲染。</p><h2 id=操作-props>操作 props</h2><p>我们可以读取、添加、编辑、删除传给 WrappedComponent 的 props。当删除或者编辑重要的 props 时要小心，你可能应该通过命名空间确保高阶组件的 props 不会破坏 WrappedComponent。譬如添加新的 props。在这个应用中，当前登录的用户可以在 WrappedComponent 中通过 this.props.user 访问到。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>function</span> <span class=nx>ppHOC</span><span class=p>(</span><span class=nx>WrappedComponent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=kr>class</span> <span class=nx>PP</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>render() {</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>newProps</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>user</span>: <span class=kt>currentLoggedInUser</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>&lt;</span><span class=nt>WrappedComponent</span> <span class=p>{</span><span class=na>...this.props</span><span class=p>}</span> <span class=p>{</span><span class=na>...newProps</span><span class=p>}</span> <span class=p>/&gt;;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>在 TypeScript 中我们往往还需要声明传入到下一层组件的 Props 对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Subtract</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;utility-types&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>interface</span> <span class=nx>InjectedCounterProps</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>value</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>onIncrement</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>onDecrement</span><span class=p>()</span><span class=o>:</span> <span class=k>void</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>interface</span> <span class=nx>MakeCounterProps</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>minValue?</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>maxValue?</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>interface</span> <span class=nx>MakeCounterState</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>value</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>makeCounter</span> <span class=o>=</span> <span class=p>&lt;</span><span class=nt>P</span> <span class=na>extends</span> <span class=na>InjectedCounterProps</span><span class=p>&gt;(</span>
</span></span><span class=line><span class=cl>  <span class=nx>Component</span>: <span class=kt>React.ComponentType</span><span class=p>&lt;</span><span class=nt>P</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kr>class</span> <span class=nx>MakeCounter</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span><span class=o>&lt;</span>
</span></span><span class=line><span class=cl>    <span class=nx>Subtract</span><span class=p>&lt;</span><span class=nt>P</span><span class=err>,</span> <span class=na>InjectedCounterProps</span><span class=p>&gt;</span> <span class=o>&amp;</span> <span class=nx>MakeCounterProps</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>MakeCounterState</span>
</span></span><span class=line><span class=cl>  <span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>state</span>: <span class=kt>MakeCounterState</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>value</span>: <span class=kt>0</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>increment</span> <span class=o>=</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>setState</span><span class=p>(</span><span class=nx>prevState</span> <span class=o>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>value</span>:
</span></span><span class=line><span class=cl>          <span class=kt>prevState.value</span> <span class=o>===</span> <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>maxValue</span>
</span></span><span class=line><span class=cl>            <span class=o>?</span> <span class=nx>prevState.value</span>
</span></span><span class=line><span class=cl>            : <span class=kt>prevState.value</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>      <span class=p>}));</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>decrement</span> <span class=o>=</span> <span class=p>()</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>setState</span><span class=p>(</span><span class=nx>prevState</span> <span class=o>=&gt;</span> <span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>value</span>:
</span></span><span class=line><span class=cl>          <span class=kt>prevState.value</span> <span class=o>===</span> <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>minValue</span>
</span></span><span class=line><span class=cl>            <span class=o>?</span> <span class=nx>prevState.value</span>
</span></span><span class=line><span class=cl>            : <span class=kt>prevState.value</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>      <span class=p>}));</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>render() {</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=p>{</span> <span class=nx>minValue</span><span class=p>,</span> <span class=nx>maxValue</span><span class=p>,</span> <span class=p>...</span><span class=nx>props</span> <span class=p>}</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>Component</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span><span class=na>...</span><span class=err>(</span><span class=na>props</span> <span class=na>as</span> <span class=na>P</span><span class=err>)</span><span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=na>value</span><span class=o>=</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>value</span><span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=na>onIncrement</span><span class=o>=</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>increment</span><span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=na>onDecrement</span><span class=o>=</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>decrement</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span></code></pre></div><h2 id=通过-refs-访问到组件实例>通过 Refs 访问到组件实例</h2><p>你可以通过引用（ref）访问到 this（WrappedComponent 的实例），但为了得到引用，WrappedComponent 还需要一个初始渲染，意味着你需要在 HOC 的 render 方法中返回 WrappedComponent 元素，让 React 开始它的一致化处理，你就可以得到 WrappedComponent 的实例的引用。譬如通过 refs 访问到实例的方法和实例本身：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>refsHOC</span><span class=p>(</span><span class=nx>WrappedComponent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=kr>class</span> <span class=nx>RefsHOC</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>proc</span><span class=p>(</span><span class=nx>wrappedComponentInstance</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>wrappedComponentInstance</span><span class=p>.</span><span class=nx>method</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>props</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>assign</span><span class=p>({},</span> <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>ref</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>proc</span><span class=p>.</span><span class=nx>bind</span><span class=p>(</span><span class=k>this</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=o>&lt;</span><span class=nx>WrappedComponent</span> <span class=p>{...</span><span class=nx>props</span><span class=p>}</span> <span class=o>/&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Ref 的回调函数会在 WrappedComponent 渲染时执行，你就可以得到 WrappedComponent 的引用。这可以用来读取/添加实例的 props，调用实例的方法。</p><h2 id=提取-state>提取 state</h2><p>我们可以通过传入 props 和回调函数把 state 提取出来，类似于 smart component 与 dumb component。譬如提取了 input 的 value 和 onChange 方法：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>ppHOC</span><span class=p>(</span><span class=nx>WrappedComponent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=kr>class</span> <span class=nx>PP</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>super</span><span class=p>(</span><span class=nx>props</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>state</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>onNameChange</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>onNameChange</span><span class=p>.</span><span class=nx>bind</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>onNameChange</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>setState</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>name</span><span class=o>:</span> <span class=nx>event</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>newProps</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>name</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>value</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>onChange</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>onNameChange</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=o>&lt;</span><span class=nx>WrappedComponent</span> <span class=p>{...</span><span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>}</span> <span class=p>{...</span><span class=nx>newProps</span><span class=p>}</span> <span class=o>/&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>然后可以这样用：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=err>@</span><span class=nx>ppHOC</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Example</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&lt;</span><span class=nx>input</span> <span class=nx>name</span><span class=o>=</span><span class=s2>&#34;name&#34;</span> <span class=p>{...</span><span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span> <span class=o>/&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=用其他元素包裹-wrappedcomponent>用其他元素包裹 WrappedComponent</h2><p>为了封装样式、布局或别的目的，你可以用其它组件和元素包裹 WrappedComponent。基本方法是使用父组件实现，但通过 HOC 你可以得到更多灵活性。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>ppHOC</span><span class=p>(</span><span class=nx>WrappedComponent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=kr>class</span> <span class=nx>PP</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>style</span><span class=o>=</span><span class=p>{{</span> <span class=nx>display</span><span class=o>:</span> <span class=s2>&#34;block&#34;</span> <span class=p>}}</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>WrappedComponent</span> <span class=p>{...</span><span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>}</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=hoc-和参数>HOC 和参数</h2><p>有时候我们也需要在 HOC 中传入自定义的参数，Props Proxy 模式 的 HOC 最简参数使用方法。关键在于 HOCFactoryFactory 函数。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>HOCFactoryFactory</span><span class=p>(...</span><span class=nx>params</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// do something with params
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=kd>function</span> <span class=nx>HOCFactory</span><span class=p>(</span><span class=nx>WrappedComponent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kr>class</span> <span class=nx>HOC</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>&lt;</span><span class=nx>WrappedComponent</span> <span class=p>{...</span><span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>}</span> <span class=o>/&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>你可以这样用：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>HOCFactoryFactory</span><span class=p>(</span><span class=nx>params</span><span class=p>)(</span><span class=nx>WrappedComponent</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>//或
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>@</span><span class=nx>HOCFatoryFactory</span><span class=p>(</span><span class=nx>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>WrappedComponent</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span> <span class=p>{}</span>
</span></span></code></pre></div><h2 id=案例分析>案例分析</h2><p>为此，我们首先定义一个名为 withColor 的高阶组件函数。它接受 BaseComponent 作为参数，并返回增强的组件。返回的 EnhancedComponent 由 getRandomColor 和 render 方法组成。在 render 方法中，我们返回分配了具有 color 属性 Props 的 BaseComponent，并利用 <code>{... this.props}</code> 解构的优势，BaseComponent 还可以访问从 HOC 外部传递给 BaseComponent 的所有 Props。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s2>&#34;react&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>withColor</span> <span class=o>=</span> <span class=nx>BaseComponent</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>class</span> <span class=nx>EnhancedComponent</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>getRandomColor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kd>var</span> <span class=nx>letters</span> <span class=o>=</span> <span class=s2>&#34;0123456789ABCDEF&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kd>var</span> <span class=nx>color</span> <span class=o>=</span> <span class=s2>&#34;#&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=mi>6</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>color</span> <span class=o>+=</span> <span class=nx>letters</span><span class=p>[</span><span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=mi>16</span><span class=p>)];</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>color</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=o>&lt;</span><span class=nx>BaseComponent</span> <span class=nx>color</span><span class=o>=</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>getRandomColor</span><span class=p>()}</span> <span class=p>{...</span><span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>}</span> <span class=o>/&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>EnhancedComponent</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>withColor</span><span class=p>;</span>
</span></span></code></pre></div><p>对于该 HoC 的使用，我们只要将其包裹正常的组件即可：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span> <span class=kr>from</span> <span class=s2>&#34;react&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>withColor</span> <span class=kr>from</span> <span class=s2>&#34;./withColor&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>ColoredComponent</span> <span class=o>=</span> <span class=nx>props</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>&lt;</span><span class=nt>div</span> <span class=na>style</span><span class=o>=</span><span class=p>{{</span> <span class=nx>background</span>: <span class=kt>props.color</span> <span class=p>}}&gt;{</span><span class=nx>props</span><span class=p>.</span><span class=nx>color</span><span class=p>}&lt;/</span><span class=nt>div</span><span class=p>&gt;;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>withColor</span><span class=p>(</span><span class=nx>ColoredComponent</span><span class=p>);</span>
</span></span></code></pre></div><p>最后，可以在外部的应用中直接传入 color 属性：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span><span class=p>,</span> <span class=p>{</span> <span class=nx>Component</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;react&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>ColoredComponent</span> <span class=nx>from</span> <span class=s2>&#34;./ColoredComponent&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>App</span> <span class=kr>extends</span> <span class=nx>Component</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>ColoredComponent</span> <span class=nx>someProp</span><span class=o>=</span><span class=s2>&#34;Prop 1&#34;</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>ColoredComponent</span> <span class=nx>someProp</span><span class=o>=</span><span class=s2>&#34;Prop 2&#34;</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>ColoredComponent</span> <span class=nx>someProp</span><span class=o>=</span><span class=s2>&#34;Prop 3&#34;</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>App</span><span class=p>;</span>
</span></span></code></pre></div><h1 id=inheritance-inversion>Inheritance Inversion</h1><p>Inheritance Inversion (II) 的最简实现：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>iiHOC</span><span class=p>(</span><span class=nx>WrappedComponent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=kr>class</span> <span class=nx>Enhancer</span> <span class=kr>extends</span> <span class=nx>WrappedComponent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=kr>super</span><span class=p>.</span><span class=nx>render</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>可以看到，返回的 HOC 类（Enhancer）继承了 WrappedComponent。之所以被称为 Inheritance Inversion 是因为 WrappedComponent 被 Enhancer 继承了，而不是 WrappedComponent 继承了 Enhancer。在这种方式中，它们的关系看上去被反转（inverse）了。</p><p>Inheritance Inversion 允许 HOC 通过 this 访问到 WrappedComponent，意味着它可以访问到 state、props、组件生命周期方法和 render 方法。</p><h2 id=渲染劫持render-highjacking>渲染劫持（Render Highjacking）</h2><p>之所以被称为渲染劫持是因为 HOC 控制着 WrappedComponent 的渲染输出，可以用它做各种各样的事。通过渲染劫持你可以：</p><ul><li>在由 render 输出的任何 React 元素中读取、添加、编辑、删除 props</li><li>读取和修改由 render 输出的 React 元素树</li><li>有条件地渲染元素树</li><li>把样式包裹进元素树（就像在 Props Proxy 中的那样）</li></ul><p>II 类型的 HOC 不一定会解析完整子树，意味着渲染劫持有一些限制。根据经验，使用渲染劫持你可以完全操作 WrappedComponent 的 render 方法返回的元素树。但是如果元素树包括一个函数类型的 React 组件，你就不能操作它的子组件了。（被 React 的一致化处理推迟到了真正渲染到屏幕时）。譬如当 this.props.loggedIn 为 true 时，这个 HOC 会完全渲染 WrappedComponent 的渲染结果。（假设 HOC 接收到了 loggedIn 这个 prop）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>iiHOC</span><span class=p>(</span><span class=nx>WrappedComponent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=kr>class</span> <span class=nx>Enhancer</span> <span class=kr>extends</span> <span class=nx>WrappedComponent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>loggedIn</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kr>super</span><span class=p>.</span><span class=nx>render</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>再如，修改由 render 方法输出的 React 组件树。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>iiHOC</span><span class=p>(</span><span class=nx>WrappedComponent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=kr>class</span> <span class=nx>Enhancer</span> <span class=kr>extends</span> <span class=nx>WrappedComponent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>elementsTree</span> <span class=o>=</span> <span class=kr>super</span><span class=p>.</span><span class=nx>render</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>newProps</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>elementsTree</span> <span class=o>&amp;&amp;</span> <span class=nx>elementsTree</span><span class=p>.</span><span class=nx>type</span> <span class=o>===</span> <span class=s2>&#34;input&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>newProps</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>value</span><span class=o>:</span> <span class=s2>&#34;may the force be with you&#34;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>props</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>assign</span><span class=p>({},</span> <span class=nx>elementsTree</span><span class=p>.</span><span class=nx>props</span><span class=p>,</span> <span class=nx>newProps</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>newElementsTree</span> <span class=o>=</span> <span class=nx>React</span><span class=p>.</span><span class=nx>cloneElement</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>elementsTree</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>props</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>elementsTree</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>children</span>
</span></span><span class=line><span class=cl>      <span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>newElementsTree</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>在这个例子中，如果 WrappedComponent 的输出在最顶层有一个 input，那么就把它的 value 设为 “may the force be with you”。在 Props Proxy 中不能做到渲染劫持。虽然通过 WrappedComponent.prototype.render 你可以访问到 render 方法，不过还需要模拟 WrappedComponent 的实例和它的 props，还可能亲自处理组件的生命周期，而不是交给 React。根据我的实验，这么做不值，你要是想做到渲染劫持你应该用 Inheritance Inversion 而不是 Props Proxy。记住，React 在内部处理了组件实例，你处理实例的唯一方法是通过 this 或者 refs。</p><h2 id=操作-state>操作 state</h2><p>HOC 可以读取、编辑和删除 WrappedComponent 实例的 state，如果你需要，你也可以给它添加更多的 state。记住，这会搞乱 WrappedComponent 的 state，导致你可能会破坏某些东西。要限制 HOC 读取或添加 state，添加 state 时应该放在单独的命名空间里，而不是和 WrappedComponent 的 state 混在一起。</p><p>譬如通过访问 WrappedComponent 的 props 和 state 来做调试：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>export</span> <span class=kd>function</span> <span class=nx>IIHOCDEBUGGER</span><span class=p>(</span><span class=nx>WrappedComponent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=kr>class</span> <span class=nx>II</span> <span class=kr>extends</span> <span class=nx>WrappedComponent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>h2</span><span class=o>&gt;</span><span class=nx>HOC</span> <span class=nx>Debugger</span> <span class=nx>Component</span><span class=o>&lt;</span><span class=err>/h2&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span><span class=nx>Props</span><span class=o>&lt;</span><span class=err>/p&gt; &lt;pre&gt;{JSON.stringify(this.props, null, 2)}&lt;/pre&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>p</span><span class=o>&gt;</span><span class=nx>State</span><span class=o>&lt;</span><span class=err>/p&gt;</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>pre</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>,</span> <span class=kc>null</span><span class=p>,</span> <span class=mi>2</span><span class=p>)}</span><span class=o>&lt;</span><span class=err>/pre&gt;</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span><span class=kr>super</span><span class=p>.</span><span class=nx>render</span><span class=p>()}</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>这里 HOC 用其他元素包裹着 WrappedComponent，还输出了 WrappedComponent 实例的 props 和 state。</p><h1 id=技巧与注意>技巧与注意</h1><h2 id=命名>命名</h2><p>用 HOC 包裹了一个组件会使它失去原本 WrappedComponent 的名字，可能会影响开发和调试。通常会用 WrappedComponent 的名字加上一些前缀作为 HOC 的名字。下面的代码来自 React-Redux：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>HOC</span><span class=p>.</span><span class=nx>displayName</span> <span class=o>=</span> <span class=sb>`HOC(</span><span class=si>${</span><span class=nx>getDisplayName</span><span class=p>(</span><span class=nx>WrappedComponent</span><span class=p>)</span><span class=si>}</span><span class=sb>)`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//或
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>HOC</span> <span class=kr>extends</span> <span class=nx>Component</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>static</span> <span class=nx>displayName</span> <span class=o>=</span> <span class=sb>`HOC(</span><span class=si>${</span><span class=nx>getDisplayName</span><span class=p>(</span><span class=nx>WrappedComponent</span><span class=p>)</span><span class=si>}</span><span class=sb>)`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p>getDisplayName 函数：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>getDisplayName</span><span class=p>(</span><span class=nx>WrappedComponent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>WrappedComponent</span><span class=p>.</span><span class=nx>displayName</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>         <span class=nx>WrappedComponent</span><span class=p>.</span><span class=nx>name</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>         <span class=err>‘</span><span class=nx>Component</span><span class=err>’</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=不要改变原始组件>不要改变原始组件</h2><p>不要试图在 HoC 中修改组件原型（或以其他方式改变它）。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>logProps</span><span class=p>(</span><span class=nx>InputComponent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>InputComponent</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>componentWillReceiveProps</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>nextProps</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Current props: &#34;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Next props: &#34;</span><span class=p>,</span> <span class=nx>nextProps</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 返回原始的 input 组件，暗示它已经被修改。
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=nx>InputComponent</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 每次调用 logProps 时，增强组件都会有 log 输出。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>EnhancedComponent</span> <span class=o>=</span> <span class=nx>logProps</span><span class=p>(</span><span class=nx>InputComponent</span><span class=p>);</span>
</span></span></code></pre></div><p>这样做会产生一些不良后果。其一是输入组件再也无法像 HOC 增强之前那样使用了。更严重的是，如果你再用另一个同样会修改 componentWillReceiveProps 的 HOC 增强它，那么前面的 HOC 就会失效！同时，这个 HOC 也无法应用于没有生命周期的函数组件。修改传入组件的 HOC 是一种糟糕的抽象方式。调用者必须知道他们是如何实现的，以避免与其他 HOC 发生冲突。HOC 不应该修改传入组件，而应该使用组合的方式，通过将组件包装在容器组件中实现功能：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>logProps</span><span class=p>(</span><span class=nx>WrappedComponent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=kr>class</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>componentWillReceiveProps</span><span class=p>(</span><span class=nx>nextProps</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Current props: &#34;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Next props: &#34;</span><span class=p>,</span> <span class=nx>nextProps</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 将 input 组件包装在容器中，而不对其进行修改。Good!
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>return</span> <span class=o>&lt;</span><span class=nx>WrappedComponent</span> <span class=p>{...</span><span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>}</span> <span class=o>/&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>该 HOC 与上文中修改传入组件的 HOC 功能相同，同时避免了出现冲突的情况。它同样适用于 class 组件和函数组件。而且因为它是一个纯函数，它可以与其他 HOC 组合，甚至可以与其自身组合。</p><h2 id=不要在-render-方法中使用-hoc>不要在 render 方法中使用 HOC</h2><p>React 的 diff 算法（称为协调）使用组件标识来确定它是应该更新现有子树还是将其丢弃并挂载新子树。如果从 render 返回的组件与前一个渲染中的组件相同（===），则 React 通过将子树与新子树进行区分来递归更新子树。如果它们不相等，则完全卸载前一个子树。通常，你不需要考虑这点。但对 HOC 来说这一点很重要，因为这代表着你不应在组件的 render 方法中对一个组件应用 HOC：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 每次调用 render 函数都会创建一个新的 EnhancedComponent
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// EnhancedComponent1 !== EnhancedComponent2
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>EnhancedComponent</span> <span class=o>=</span> <span class=nx>enhance</span><span class=p>(</span><span class=nx>MyComponent</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 这将导致子树每次渲染都会进行卸载，和重新挂载的操作！
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=o>&lt;</span><span class=nx>EnhancedComponent</span> <span class=o>/&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>这不仅仅是性能问题 - 重新挂载组件会导致该组件及其所有子组件的状态丢失。如果在组件之外创建 HOC，这样一来组件只会创建一次。因此，每次 render 时都会是同一个组件。一般来说，这跟你的预期表现是一致的。在极少数情况下，你需要动态调用 HOC。你可以在组件的生命周期方法或其构造函数中进行调用。</p><h2 id=务必复制静态方法>务必复制静态方法</h2><p>有时在 React 组件上定义静态方法很有用。例如，Relay 容器暴露了一个静态方法 getFragment 以方便组合 GraphQL 片段。但是，当你将 HOC 应用于组件时，原始组件将使用容器组件进行包装。这意味着新组件没有原始组件的任何静态方法。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// 定义静态函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>WrappedComponent</span><span class=p>.</span><span class=nx>staticMethod</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=cm>/*...*/</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=c1>// 现在使用 HOC
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>EnhancedComponent</span> <span class=o>=</span> <span class=nx>enhance</span><span class=p>(</span><span class=nx>WrappedComponent</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 增强组件没有 staticMethod
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>typeof</span> <span class=nx>EnhancedComponent</span><span class=p>.</span><span class=nx>staticMethod</span> <span class=o>===</span> <span class=s2>&#34;undefined&#34;</span><span class=p>;</span> <span class=c1>// true
</span></span></span></code></pre></div><p>为了解决这个问题，你可以在返回之前把这些方法拷贝到容器组件上：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>enhance</span><span class=p>(</span><span class=nx>WrappedComponent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>class</span> <span class=nx>Enhance</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/*...*/</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// 必须准确知道应该拷贝哪些方法 :(
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>Enhance</span><span class=p>.</span><span class=nx>staticMethod</span> <span class=o>=</span> <span class=nx>WrappedComponent</span><span class=p>.</span><span class=nx>staticMethod</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>Enhance</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>但要这样做，你需要知道哪些方法应该被拷贝。你可以使用 hoist-non-react-statics 自动拷贝所有非 React 静态方法:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=nx>hoistNonReactStatic</span> <span class=nx>from</span> <span class=s2>&#34;hoist-non-react-statics&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>enhance</span><span class=p>(</span><span class=nx>WrappedComponent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>class</span> <span class=nx>Enhance</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/*...*/</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>hoistNonReactStatic</span><span class=p>(</span><span class=nx>Enhance</span><span class=p>,</span> <span class=nx>WrappedComponent</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>Enhance</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>除了导出组件，另一个可行的方案是再额外导出这个静态方法。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// 使用这种方式代替...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>MyComponent</span><span class=p>.</span><span class=nx>someFunction</span> <span class=o>=</span> <span class=nx>someFunction</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>MyComponent</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ...单独导出该方法...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>export</span> <span class=p>{</span> <span class=nx>someFunction</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ...并在要使用的组件中，import 它们
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>MyComponent</span><span class=p>,</span> <span class=p>{</span> <span class=nx>someFunction</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;./MyComponent.js&#34;</span><span class=p>;</span>
</span></span></code></pre></div><h1 id=案例分析-1>案例分析</h1><h2 id=通用数据加载>通用数据加载</h2><p>在以下示例中，我们将开发一个高阶组件，该组件接受 BaseComponent 和 API URL 来获取所需的数据。加载数据时，它将显示加载状态，加载数据后，我们将显示基于该数据呈现的任何 BaseComponent。</p><p>首先，我们将首先创建一个高阶组件函数。我们将使用 Loader 对其进行调用，并首先将组件状态的 data 属性设置为 null。一旦加载了组件，我们将开始获取数据，完成后，将 data 属性设置为返回的响应。如前所述，当状态为 null 时，我们将显示加载状态。一旦获取了数据，我们将返回 BaseComponent，而 BaseComponent 将根据返回的数据呈现标记。HOC 定义如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span> <span class=kr>from</span> <span class=s2>&#34;react&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>withLoader</span> <span class=o>=</span> <span class=p>(</span><span class=nx>BaseComponent</span><span class=p>,</span> <span class=nx>apiUrl</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>class</span> <span class=nx>EnhancedComponent</span> <span class=kr>extends</span> <span class=nx>React</span><span class=p>.</span><span class=nx>Component</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>state</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>data</span>: <span class=kt>null</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>componentDidMount() {</span>
</span></span><span class=line><span class=cl>      <span class=nx>fetch</span><span class=p>(</span><span class=nx>apiUrl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>res</span> <span class=o>=&gt;</span> <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>data</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>setState</span><span class=p>({</span> <span class=nx>data</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>render() {</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span><span class=nx>Loading</span> <span class=p>...&lt;/</span><span class=nt>div</span><span class=p>&gt;;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=p>&lt;</span><span class=nt>BaseComponent</span> <span class=na>data</span><span class=o>=</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>data</span><span class=p>}</span> <span class=p>{</span><span class=na>...this.props</span><span class=p>}</span> <span class=p>/&gt;;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>EnhancedComponent</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>withLoader</span><span class=p>;</span>
</span></span></code></pre></div><p>使用此 HOC 的组件非常简单。我们只需要从道具中获取数据并根据需要使用即可。在下面的示例中，我们使用数据显示用户列表。与往常一样，我们首先需要导入 HOC 函数并将该组件作为函数参数传递。伴随着它，我们还传递了从中获取数据的 API URL。请参阅以下基本组件的代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s2>&#34;react&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>withLoader</span> <span class=nx>from</span> <span class=s2>&#34;./withLoader&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Users</span> <span class=o>=</span> <span class=nx>props</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=nx>Users</span><span class=o>:&lt;</span><span class=err>/h1&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>ul</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=nx>props</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>user</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>li</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>user</span><span class=p>.</span><span class=nx>id</span><span class=p>}</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>user</span><span class=p>.</span><span class=nx>name</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/li&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>))}</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=err>/ul&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>withLoader</span><span class=p>(</span><span class=nx>Users</span><span class=p>,</span> <span class=s2>&#34;https://jsonplaceholder.typicode.com/users&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p>类似地，我们也可以有如下的加载 Posts 的组件：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span> <span class=nx>from</span> <span class=s2>&#34;react&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>withLoader</span> <span class=nx>from</span> <span class=s2>&#34;./withLoader&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Posts</span> <span class=o>=</span> <span class=nx>props</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=nx>Posts</span><span class=o>:&lt;</span><span class=err>/h1&gt;</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=nx>ul</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=nx>props</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>post</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=o>&lt;</span><span class=nx>li</span> <span class=nx>key</span><span class=o>=</span><span class=p>{</span><span class=nx>post</span><span class=p>.</span><span class=nx>title</span><span class=p>}</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>post</span><span class=p>.</span><span class=nx>title</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/li&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>))}</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=err>/ul&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>withLoader</span><span class=p>(</span><span class=nx>Posts</span><span class=p>,</span> <span class=s2>&#34;https://jsonplaceholder.typicode.com/posts/&#34;</span><span class=p>);</span>
</span></span></code></pre></div><h2 id=props-throttle>Props Throttle</h2><p>代码定义如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>createElement</span><span class=p>,</span> <span class=nx>Component</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;react&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>getDisplayName</span> <span class=nx>from</span> <span class=s2>&#34;react-display-name&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>throttle</span> <span class=nx>from</span> <span class=s2>&#34;just-throttle&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>throttleHandler</span> <span class=o>=</span> <span class=p>(</span><span class=nx>handlerName</span><span class=p>,</span> <span class=nx>interval</span><span class=p>,</span> <span class=nx>leadingCall</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>Target</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>class</span> <span class=nx>ThrottleHandler</span> <span class=kr>extends</span> <span class=nx>Component</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>constructor</span><span class=p>(</span><span class=nx>props</span><span class=p>,</span> <span class=nx>context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>super</span><span class=p>(</span><span class=nx>props</span><span class=p>,</span> <span class=nx>context</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>intervalValue</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>typeof</span> <span class=nx>interval</span> <span class=o>===</span> <span class=s2>&#34;function&#34;</span> <span class=o>?</span> <span class=nx>interval</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span> <span class=o>:</span> <span class=nx>interval</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>throttlePropInvoke</span> <span class=o>=</span> <span class=nx>throttle</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>(...</span><span class=nx>args</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>[</span><span class=nx>handlerName</span><span class=p>](...</span><span class=nx>args</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>intervalValue</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>leadingCall</span>
</span></span><span class=line><span class=cl>      <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>handler</span> <span class=o>=</span> <span class=p>(</span><span class=nx>e</span><span class=p>,</span> <span class=p>...</span><span class=nx>rest</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>e</span> <span class=o>&amp;&amp;</span> <span class=k>typeof</span> <span class=nx>e</span><span class=p>.</span><span class=nx>persist</span> <span class=o>===</span> <span class=s2>&#34;function&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>e</span><span class=p>.</span><span class=nx>persist</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>throttlePropInvoke</span><span class=p>(</span><span class=nx>e</span><span class=p>,</span> <span class=p>...</span><span class=nx>rest</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>createElement</span><span class=p>(</span><span class=nx>Target</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span><span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=nx>handlerName</span><span class=p>]</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>handler</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span> <span class=o>!==</span> <span class=s2>&#34;production&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ThrottleHandler</span><span class=p>.</span><span class=nx>displayName</span> <span class=o>=</span> <span class=sb>`throttleHandler(</span><span class=si>${</span><span class=nx>getDisplayName</span><span class=p>(</span><span class=nx>Target</span><span class=p>)</span><span class=si>}</span><span class=sb>)`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>ThrottleHandler</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>throttleHandler</span><span class=p>;</span>
</span></span></code></pre></div><p>使用案例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Demo</span> <span class=o>=</span> <span class=p>({</span> <span class=nx>count</span><span class=p>,</span> <span class=nx>onButtonClick</span><span class=p>,</span> <span class=nx>label</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=o>&lt;</span><span class=nx>div</span> <span class=nx>className</span><span class=o>=</span><span class=s2>&#34;demo&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=nx>label</span> <span class=o>||</span> <span class=s2>&#34;&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=nx>h1</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>count</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/h1&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=nx>button</span> <span class=nx>onClick</span><span class=o>=</span><span class=p>{</span><span class=nx>onButtonClick</span><span class=p>}</span><span class=o>&gt;</span><span class=nx>CLICK</span> <span class=nx>ME</span> <span class=nx>FAST</span><span class=o>&lt;</span><span class=err>/button&gt;</span>
</span></span><span class=line><span class=cl>  <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Demo1</span> <span class=o>=</span> <span class=nx>compose</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>withState</span><span class=p>(</span><span class=s2>&#34;count&#34;</span><span class=p>,</span> <span class=s2>&#34;setCount&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>withHandlers</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>onButtonClick</span><span class=o>:</span> <span class=p>({</span> <span class=nx>count</span><span class=p>,</span> <span class=nx>setCount</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>setCount</span><span class=p>(</span><span class=nx>count</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}),</span>
</span></span><span class=line><span class=cl>  <span class=nx>throttleHandler</span><span class=p>(</span><span class=s2>&#34;onButtonClick&#34;</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)(</span><span class=nx>Demo</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Demo2</span> <span class=o>=</span> <span class=nx>compose</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>withState</span><span class=p>(</span><span class=s2>&#34;count&#34;</span><span class=p>,</span> <span class=s2>&#34;setCount&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>withHandlers</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>onButtonClick</span><span class=o>:</span> <span class=p>({</span> <span class=nx>count</span><span class=p>,</span> <span class=nx>setCount</span> <span class=p>})</span> <span class=p>=&gt;</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>setCount</span><span class=p>(</span><span class=nx>count</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}),</span>
</span></span><span class=line><span class=cl>  <span class=nx>throttleHandler</span><span class=p>(</span><span class=s2>&#34;onButtonClick&#34;</span><span class=p>,</span> <span class=nx>props</span> <span class=p>=&gt;</span> <span class=nx>props</span><span class=p>.</span><span class=nx>throttle</span> <span class=o>||</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)(</span><span class=nx>Demo</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>MainDemo</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=o>&lt;</span><span class=nx>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=nx>style</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span><span class=sb>`.demo {
</span></span></span><span class=line><span class=cl><span class=sb>          margin-bottom: 10px;
</span></span></span><span class=line><span class=cl><span class=sb>          border-style: dotted;
</span></span></span><span class=line><span class=cl><span class=sb>          border-radius: 10px;
</span></span></span><span class=line><span class=cl><span class=sb>          padding: 5px;
</span></span></span><span class=line><span class=cl><span class=sb>        }`</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=err>/style&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=nx>Demo1</span> <span class=nx>label</span><span class=o>=</span><span class=s2>&#34;Delay as argument&#34;</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=nx>Demo2</span> <span class=nx>label</span><span class=o>=</span><span class=s2>&#34;Delay from props&#34;</span> <span class=nx>throttle</span><span class=o>=</span><span class=p>{</span><span class=mi>300</span><span class=p>}</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=nx>Demo2</span> <span class=nx>label</span><span class=o>=</span><span class=s2>&#34;No delay (zero by default)&#34;</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=o>&lt;</span><span class=err>/div&gt;</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>MainDemo</span><span class=p>;</span>
</span></span></code></pre></div></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>上一页</div><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/03.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/renderprops/ rel=next>renderProps</a></div><div class="col-6 post-nav-item"><div class=meta-nav>下一页</div><a href=/books/react-notes/04.%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/03.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%85%B6%E4%BB%96%E6%8A%80%E5%B7%A7/ rel=prev>其他技巧</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div><script type=text/javascript id=clstr_globe async src="//clustrmaps.com/globe.js?d=kgpJG5sWZQpKujBmD-uW1B54-WBPol-DuDtrB2KFjKs"></script></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>