<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="Blob Blob（Binary Large Object）表示二进制类型的大对象。在数据库管理系统中，将二进制数据存储为一个单一个体的集合。Blob 通常是影像、声音或多媒体文件。在 JavaScript 中 Blob 类型的对象表示不可变的类似文件对"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/blob/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/blob/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/blob/"><meta property="og:title" content="Blob | Next-gen Tech Edu"><meta property="og:description" content="Blob Blob（Binary Large Object）表示二进制类型的大对象。在数据库管理系统中，将二进制数据存储为一个单一个体的集合。Blob 通常是影像、声音或多媒体文件。在 JavaScript 中 Blob 类型的对象表示不可变的类似文件对"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>Blob | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=7c3a5df29bdab2592230a0e2b6413e94><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">文件处理</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id9eb0b8a31fb24e1e255ea0f8045bd526")' href=#id9eb0b8a31fb24e1e255ea0f8045bd526 aria-expanded=false aria-controls=id9eb0b8a31fb24e1e255ea0f8045bd526 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/>网络请求</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id9eb0b8a31fb24e1e255ea0f8045bd526 aria-expanded=false aria-controls=id9eb0b8a31fb24e1e255ea0f8045bd526><i class="fa-solid fa-angle-down" id=caret-id9eb0b8a31fb24e1e255ea0f8045bd526></i></a></div><ul class="nav docs-sidenav collapse show" id=id9eb0b8a31fb24e1e255ea0f8045bd526><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id6ee19a73dd88e6b119f55d2168e6d376")' href=#id6ee19a73dd88e6b119f55d2168e6d376 aria-expanded=false aria-controls=id6ee19a73dd88e6b119f55d2168e6d376 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E8%B7%A8%E5%9F%9F%E9%80%9A%E4%BF%A1/>跨域通信</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id6ee19a73dd88e6b119f55d2168e6d376 aria-expanded=false aria-controls=id6ee19a73dd88e6b119f55d2168e6d376><i class="fa-solid fa-angle-right" id=caret-id6ee19a73dd88e6b119f55d2168e6d376></i></a></div><ul class="nav docs-sidenav collapse" id=id6ee19a73dd88e6b119f55d2168e6d376><li class="child level"><a href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E8%B7%A8%E5%9F%9F%E9%80%9A%E4%BF%A1/cors/>CORS</a></li><li class="child level"><a href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E8%B7%A8%E5%9F%9F%E9%80%9A%E4%BF%A1/%E8%B7%A8%E5%9F%9F%E8%AF%B7%E6%B1%82/>跨域请求</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ide592cf3845552ed8ef7810c29fc49045")' href=#ide592cf3845552ed8ef7810c29fc49045 aria-expanded=false aria-controls=ide592cf3845552ed8ef7810c29fc49045 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E8%AF%B7%E6%B1%82%E5%BA%93/>请求库</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ide592cf3845552ed8ef7810c29fc49045 aria-expanded=false aria-controls=ide592cf3845552ed8ef7810c29fc49045><i class="fa-solid fa-angle-right" id=caret-ide592cf3845552ed8ef7810c29fc49045></i></a></div><ul class="nav docs-sidenav collapse" id=ide592cf3845552ed8ef7810c29fc49045><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id2a5aced6424085e47aec2a22bb2bad03")' href=#id2a5aced6424085e47aec2a22bb2bad03 aria-expanded=false aria-controls=id2a5aced6424085e47aec2a22bb2bad03 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E8%AF%B7%E6%B1%82%E5%BA%93/axios/>Axios</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id2a5aced6424085e47aec2a22bb2bad03 aria-expanded=false aria-controls=id2a5aced6424085e47aec2a22bb2bad03><i class="fa-solid fa-angle-right" id=caret-id2a5aced6424085e47aec2a22bb2bad03></i></a></div><ul class="nav docs-sidenav collapse" id=id2a5aced6424085e47aec2a22bb2bad03><li class="child level"><a href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E8%AF%B7%E6%B1%82%E5%BA%93/axios/%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/>基础使用</a></li><li class="child level"><a href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E8%AF%B7%E6%B1%82%E5%BA%93/axios/%E6%8B%A6%E6%88%AA%E5%99%A8/>拦截器</a></li></ul></div><li class="child level"><a href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E8%AF%B7%E6%B1%82%E5%BA%93/fetch/>Fetch</a></li><li class="child level"><a href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E8%AF%B7%E6%B1%82%E5%BA%93/xmlhttprequest/>XMLHttpRequest</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id1a4171b65faf8c026959d9d0156b3a3e")' href=#id1a4171b65faf8c026959d9d0156b3a3e aria-expanded=false aria-controls=id1a4171b65faf8c026959d9d0156b3a3e aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD/>数据加载</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id1a4171b65faf8c026959d9d0156b3a3e aria-expanded=false aria-controls=id1a4171b65faf8c026959d9d0156b3a3e><i class="fa-solid fa-angle-right" id=caret-id1a4171b65faf8c026959d9d0156b3a3e></i></a></div><ul class="nav docs-sidenav collapse" id=id1a4171b65faf8c026959d9d0156b3a3e><li class="child level"><a href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD/swr/>SWR</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idaf88e422d628910004cd5fbd6cc5cdb4")' href=#idaf88e422d628910004cd5fbd6cc5cdb4 aria-expanded=false aria-controls=idaf88e422d628910004cd5fbd6cc5cdb4 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/>文件处理</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idaf88e422d628910004cd5fbd6cc5cdb4 aria-expanded=false aria-controls=idaf88e422d628910004cd5fbd6cc5cdb4><i class="fa-solid fa-angle-down" id=caret-idaf88e422d628910004cd5fbd6cc5cdb4></i></a></div><ul class="nav docs-sidenav collapse show" id=idaf88e422d628910004cd5fbd6cc5cdb4><li class="child level active"><a href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/blob/>Blob</a></li><li class="child level"><a href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/filesaver/>FileSaver</a></li><li class="child level"><a href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99/>文件读写</a></li><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idaa1a14e59bc33e40e2a6e4801ad15cb3")' href=#idaa1a14e59bc33e40e2a6e4801ad15cb3 aria-expanded=false aria-controls=idaa1a14e59bc33e40e2a6e4801ad15cb3 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/>文件上传</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idaa1a14e59bc33e40e2a6e4801ad15cb3 aria-expanded=false aria-controls=idaa1a14e59bc33e40e2a6e4801ad15cb3><i class="fa-solid fa-angle-right" id=caret-idaa1a14e59bc33e40e2a6e4801ad15cb3></i></a></div><ul class="nav docs-sidenav collapse" id=idaa1a14e59bc33e40e2a6e4801ad15cb3><li class="child level"><a href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/%E5%A4%A7%E6%96%87%E4%BB%B6%E5%88%86%E7%89%87%E4%B8%8A%E4%BC%A0/>大文件分片上传</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id55b67637ce82d931f7f198fe41a95812")' href=#id55b67637ce82d931f7f198fe41a95812 aria-expanded=false aria-controls=id55b67637ce82d931f7f198fe41a95812 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/>文件下载</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id55b67637ce82d931f7f198fe41a95812 aria-expanded=false aria-controls=id55b67637ce82d931f7f198fe41a95812><i class="fa-solid fa-angle-right" id=caret-id55b67637ce82d931f7f198fe41a95812></i></a></div><ul class="nav docs-sidenav collapse" id=id55b67637ce82d931f7f198fe41a95812><li class="child level"><a href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/range-%E5%B9%B6%E5%8F%91%E4%B8%8B%E8%BD%BD/>Range 并发下载</a></li><li class="child level"><a href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/%E7%BA%AF%E5%89%8D%E7%AB%AF%E4%B8%8B%E8%BD%BD/>纯前端下载</a></li><li class="child level"><a href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/%E5%9F%BA%E4%BA%8E-fetch-%E7%9A%84%E4%B8%8B%E8%BD%BD/>基于 fetch 的下载</a></li></ul></div></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#构造函数>构造函数</a></li><li><a href=#blob-类的属性和方法>Blob 类的属性和方法</a></li></ul><ul><li><a href=#分片上传>分片上传</a></li><li><a href=#从互联网下载数据>从互联网下载数据</a></li><li><a href=#blob-用作-url>Blob 用作 URL</a></li><li><a href=#blob-转换为-base64>Blob 转换为 Base64</a></li><li><a href=#图片压缩>图片压缩</a></li><li><a href=#生成-pdf-文档>生成 PDF 文档</a></li></ul><ul><li><a href=#blob-vs-arraybuffer>Blob vs ArrayBuffer</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>Blob</h1><div class=article-style><h1 id=blob>Blob</h1><p>Blob（Binary Large Object）表示二进制类型的大对象。在数据库管理系统中，将二进制数据存储为一个单一个体的集合。Blob 通常是影像、声音或多媒体文件。在 JavaScript 中 Blob 类型的对象表示不可变的类似文件对象的原始数据。为了更直观的感受 Blob 对象，我们先来使用 Blob 构造函数，创建一个 myBlob 对象，具体如下图所示：</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://assets.ng-tech.icu/item/20221225161317.png alt="Blob 对象示意" loading=lazy data-zoomable></div></div></figure></p><p>如你所见，myBlob 对象含有两个属性：size 和 type。其中 size 属性用于表示数据的大小（以字节为单位），type 是 MIME 类型的字符串。Blob 表示的不一定是 JavaScript 原生格式的数据。比如 File 接口基于 Blob，继承了 blob 的功能并将其扩展使其支持用户系统上的文件。</p><h1 id=blob-api-简介>Blob API 简介</h1><p>Blob 由一个可选的字符串 type（通常是 MIME 类型）和 blobParts 组成：</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://assets.ng-tech.icu/item/20221225161426.png alt="Blob 结构" loading=lazy data-zoomable></div></div></figure></p><p>MIME（Multipurpose Internet Mail Extensions）多用途互联网邮件扩展类型，是设定某种扩展名的文件用一种应用程序来打开的方式类型，当该扩展名文件被访问的时候，浏览器会自动使用指定应用程序来打开。多用于指定一些客户端自定义的文件名，以及一些媒体文件打开方式。常见的 MIME 类型有：超文本标记语言文本 .html text/html、PNG 图像 .png image/png、普通文本 .txt text/plain 等。</p><h2 id=构造函数>构造函数</h2><p>Blob 构造函数的语法为：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>aBlob</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Blob</span><span class=p>(</span><span class=nx>blobParts</span><span class=p>,</span> <span class=nx>options</span><span class=p>);</span>
</span></span></code></pre></div><p>相关的参数说明如下：</p><ul><li><p>blobParts：它是一个由 ArrayBuffer，ArrayBufferView，Blob，DOMString 等对象构成的数组。DOMStrings 会被编码为 UTF-8。</p></li><li><p>options：一个可选的对象，包含以下两个属性：</p><ul><li>type —— 默认值为 <code>""</code>，它代表了将会被放入到 blob 中的数组内容的 MIME 类型。</li><li>endings —— 默认值为 <code>"transparent"</code>，用于指定包含行结束符 <code>\n</code> 的字符串如何被写入。它是以下两个值中的一个：<code>"native"</code>，代表行结束符会被更改为适合宿主操作系统文件系统的换行符，或者 <code>"transparent"</code>，代表会保持 blob 中保存的结束符不变。</li></ul></li><li><p><strong>示例一：从字符串创建 Blob</strong></p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>let</span> <span class=nx>myBlobParts</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;&lt;html&gt;&lt;h2&gt;Hello Semlinker&lt;/h2&gt;&lt;/html&gt;&#34;</span><span class=p>];</span> <span class=c1>// an array consisting of a single DOMString
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>let</span> <span class=nx>myBlob</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Blob</span><span class=p>(</span><span class=nx>myBlobParts</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;text/html&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>endings</span><span class=o>:</span> <span class=s2>&#34;transparent&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>});</span> <span class=c1>// the blob
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>myBlob</span><span class=p>.</span><span class=nx>size</span> <span class=o>+</span> <span class=s2>&#34; bytes size&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// Output: 37 bytes size
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>myBlob</span><span class=p>.</span><span class=nx>type</span> <span class=o>+</span> <span class=s2>&#34; is the type&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// Output: text/html is the type
</span></span></span></code></pre></div><ul><li><strong>示例二：从类型化数组和字符串创建 Blob</strong></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>let</span> <span class=nx>hello</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Uint8Array</span><span class=p>([</span><span class=mi>72</span><span class=p>,</span> <span class=mi>101</span><span class=p>,</span> <span class=mi>108</span><span class=p>,</span> <span class=mi>108</span><span class=p>,</span> <span class=mi>111</span><span class=p>]);</span> <span class=c1>// 二进制格式的 &#34;hello&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>let</span> <span class=nx>blob</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Blob</span><span class=p>([</span><span class=nx>hello</span><span class=p>,</span> <span class=s2>&#34; &#34;</span><span class=p>,</span> <span class=s2>&#34;semlinker&#34;</span><span class=p>],</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;text/plain&#34;</span> <span class=p>});</span>
</span></span></code></pre></div><h2 id=blob-类的属性和方法>Blob 类的属性和方法</h2><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://assets.ng-tech.icu/item/20221225161637.png alt="Blob 属性与方法" loading=lazy data-zoomable></div></div></figure></p><p>前面我们已经知道 Blob 对象包含两个属性：</p><ul><li>size（只读）：表示 <code>Blob</code> 对象中所包含数据的大小（以字节为单位）。</li><li>type（只读）：一个字符串，表明该 <code>Blob</code> 对象所包含数据的 MIME 类型。如果类型未知，则该值为空字符串。</li></ul><p>方法包含：</p><ul><li>slice([start[, end[, contentType]]])：返回一个新的 Blob 对象，包含了源 Blob 对象中指定范围内的数据。</li><li>stream()：返回一个能读取 blob 内容的 <code>ReadableStream</code>。</li><li>text()：返回一个 Promise 对象且包含 blob 所有内容的 UTF-8 格式的 <code>USVString</code>。</li><li>arrayBuffer()：返回一个 Promise 对象且包含 blob 所有内容的二进制格式的 <code>ArrayBuffer</code>。</li></ul><p>这里我们需要注意的是，<strong><code>Blob</code> 对象是不可改变的</strong>。我们不能直接在一个 Blob 中更改数据，但是我们可以对一个 Blob 进行分割，从其中创建新的 Blob 对象，将它们混合到一个新的 Blob 中。这种行为类似于 JavaScript 字符串：我们无法更改字符串中的字符，但可以创建新的更正后的字符串。</p><h1 id=blob-使用场景>Blob 使用场景</h1><h2 id=分片上传>分片上传</h2><p>File 对象是特殊类型的 Blob，且可以用在任意的 Blob 类型的上下文中。所以针对大文件传输的场景，我们可以使用 slice 方法对大文件进行切割，然后分片进行上传，具体示例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>file</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>File</span><span class=p>([</span><span class=s2>&#34;a&#34;</span><span class=p>.</span><span class=nx>repeat</span><span class=p>(</span><span class=mi>1000000</span><span class=p>)],</span> <span class=s2>&#34;test.txt&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>chunkSize</span> <span class=o>=</span> <span class=mi>40000</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>url</span> <span class=o>=</span> <span class=s2>&#34;https://httpbin.org/post&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>chunkedUpload</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>start</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>start</span> <span class=o>&lt;</span> <span class=nx>file</span><span class=p>.</span><span class=nx>size</span><span class=p>;</span> <span class=nx>start</span> <span class=o>+=</span> <span class=nx>chunkSize</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>chunk</span> <span class=o>=</span> <span class=nx>file</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=nx>start</span><span class=p>,</span> <span class=nx>start</span> <span class=o>+</span> <span class=nx>chunkSize</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>fd</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>FormData</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>fd</span><span class=p>.</span><span class=nx>append</span><span class=p>(</span><span class=s2>&#34;data&#34;</span><span class=p>,</span> <span class=nx>chunk</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=p>{</span> <span class=nx>method</span><span class=o>:</span> <span class=s2>&#34;post&#34;</span><span class=p>,</span> <span class=nx>body</span><span class=o>:</span> <span class=nx>fd</span> <span class=p>}).</span><span class=nx>then</span><span class=p>((</span><span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>res</span><span class=p>.</span><span class=nx>text</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=从互联网下载数据>从互联网下载数据</h2><p>我们可以使用以下方法从互联网上下载数据并将数据存储到 Blob 对象中，比如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>downloadBlob</span> <span class=o>=</span> <span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=nx>callback</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>xhr</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>XMLHttpRequest</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>xhr</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=s2>&#34;GET&#34;</span><span class=p>,</span> <span class=nx>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>xhr</span><span class=p>.</span><span class=nx>responseType</span> <span class=o>=</span> <span class=s2>&#34;blob&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>xhr</span><span class=p>.</span><span class=nx>onload</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>callback</span><span class=p>(</span><span class=nx>xhr</span><span class=p>.</span><span class=nx>response</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=nx>xhr</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>当然除了使用 XMLHttpRequest API 之外，我们也可以使用 fetch API 来实现以流的方式获取二进制数据。这里我们来看一下如何使用 fetch API 获取线上图片并本地显示，具体实现如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>myImage</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s2>&#34;img&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>myRequest</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Request</span><span class=p>(</span><span class=s2>&#34;flowers.jpg&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>fetch</span><span class=p>(</span><span class=nx>myRequest</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>response</span><span class=p>.</span><span class=nx>blob</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>myBlob</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>objectURL</span> <span class=o>=</span> <span class=nx>URL</span><span class=p>.</span><span class=nx>createObjectURL</span><span class=p>(</span><span class=nx>myBlob</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>myImage</span><span class=p>.</span><span class=nx>src</span> <span class=o>=</span> <span class=nx>objectURL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span></code></pre></div><p>当 fetch 请求成功的时候，我们调用 response 对象的 blob() 方法，从 response 对象中读取一个 Blob 对象，然后使用 createObjectURL() 方法创建一个 objectURL，然后把它赋值给 img 元素的 src 属性从而显示这张图片。</p><h2 id=blob-用作-url>Blob 用作 URL</h2><p>Blob 可以很容易的作为 <a>、<img> 或其他标签的 URL，多亏了 type 属性，我们也可以上传/下载 Blob 对象。Blob URL/Object URL 是一种伪协议，允许 Blob 和 File 对象用作图像，下载二进制数据链接等的 URL 源。在浏览器中，我们使用 URL.createObjectURL 方法来创建 Blob URL，该方法接收一个 Blob 对象，并为其创建一个唯一的 URL，其形式为 <code>blob:&lt;origin>/&lt;uuid></code>，对应的示例如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-s data-lang=s><span class=line><span class=cl><span class=n>blob</span><span class=o>:</span><span class=n>https</span><span class=o>://</span><span class=n>example.org</span><span class=o>/</span><span class=m>40</span><span class=n>a5fb5a</span><span class=o>-</span><span class=n>d56d</span><span class=m>-4</span><span class=n>a33</span><span class=o>-</span><span class=n>b4e2</span><span class=m>-0</span><span class=n>acf6a8e5f641</span>
</span></span></code></pre></div><p>浏览器内部为每个通过 URL.createObjectURL 生成的 URL 存储了一个 URL → Blob 映射。因此，此类 URL 较短，但可以访问 Blob。生成的 URL 仅在当前文档打开的状态下才有效。它允许引用 <code>&lt;img></code>、<code>&lt;a></code> 中的 Blob，但如果你访问的 Blob URL 不再存在，则会从浏览器中收到 404 错误。上述的 Blob URL 看似很不错，但实际上它也有副作用。虽然存储了 URL → Blob 的映射，但 Blob 本身仍驻留在内存中，浏览器无法释放它。映射在文档卸载时自动清除，因此 Blob 对象随后被释放。</p><p>但是，如果应用程序寿命很长，那不会很快发生。因此，如果我们创建一个 Blob URL，即使不再需要该 Blob，它也会存在内存中。针对这个问题，我们可以调用 URL.revokeObjectURL(url) 方法，从内部映射中删除引用，从而允许删除 Blob（如果没有其他引用），并释放内存。接下来，我们来看一下 Blob 文件下载的具体示例。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;UTF-8&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Blob 文件下载示例<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;downloadBtn&#34;</span><span class=p>&gt;</span>文件下载<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;index.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>download</span> <span class=o>=</span> <span class=p>(</span><span class=nx>fileName</span><span class=p>,</span> <span class=nx>blob</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>link</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s2>&#34;a&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>link</span><span class=p>.</span><span class=nx>href</span> <span class=o>=</span> <span class=nx>URL</span><span class=p>.</span><span class=nx>createObjectURL</span><span class=p>(</span><span class=nx>blob</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>link</span><span class=p>.</span><span class=nx>download</span> <span class=o>=</span> <span class=nx>fileName</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>link</span><span class=p>.</span><span class=nx>click</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>link</span><span class=p>.</span><span class=nx>remove</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>URL</span><span class=p>.</span><span class=nx>revokeObjectURL</span><span class=p>(</span><span class=nx>link</span><span class=p>.</span><span class=nx>href</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>downloadBtn</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s2>&#34;#downloadBtn&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>downloadBtn</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;click&#34;</span><span class=p>,</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>fileName</span> <span class=o>=</span> <span class=s2>&#34;blob.txt&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>myBlob</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Blob</span><span class=p>([</span><span class=s2>&#34;一文彻底掌握 Blob Web API&#34;</span><span class=p>],</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;text/plain&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=nx>download</span><span class=p>(</span><span class=nx>fileName</span><span class=p>,</span> <span class=nx>myBlob</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>在示例中，我们通过调用 Blob 的构造函数来创建类型为 &ldquo;text/plain&rdquo; 的 Blob 对象，然后通过动态创建 a 标签来实现文件的下载。</p><h2 id=blob-转换为-base64>Blob 转换为 Base64</h2><p>URL.createObjectURL 的一个替代方法是，将 Blob 转换为 base64 编码的字符串。Base64 是一种基于 64 个可打印字符来表示二进制数据的表示方法，它常用于在处理文本数据的场合，表示、传输、存储一些二进制数据，包括 MIME 的电子邮件及 XML 的一些复杂数据。在 MIME 格式的电子邮件中，base64 可以用来将二进制的字节序列数据编码成 ASCII 字符序列构成的文本。使用时，在传输编码方式中指定 base64。使用的字符包括大小写拉丁字母各 26 个、数字 10 个、加号 + 和斜杠 /，共 64 个字符，等号 = 用来作为后缀用途。</p><p>下面我们来介绍如何在 HTML 中嵌入 base64 编码的图片。在编写 HTML 网页时，对于一些简单图片，通常会选择将图片内容直接内嵌在网页中，从而减少不必要的网络请求，但是图片数据是二进制数据，该怎么嵌入呢？绝大多数现代浏览器都支持一种名为 Data URLs 的特性，允许使用 base64 对图片或其他文件的二进制数据进行编码，将其作为文本字符串嵌入网页中。</p><p>Data URLs 由四个部分组成：前缀（data:）、指示数据类型的 MIME 类型、如果非文本则为可选的 base64 标记、数据本身：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-s data-lang=s><span class=line><span class=cl><span class=n>data</span><span class=o>:</span><span class=n>[</span><span class=o>&lt;</span><span class=n>mediatype</span><span class=o>&gt;</span><span class=n>][</span><span class=p>;</span><span class=n>base64]</span><span class=p>,</span><span class=o>&lt;</span><span class=n>data</span><span class=o>&gt;</span>
</span></span></code></pre></div><p>mediatype 是个 MIME 类型的字符串，例如 &ldquo;image/jpeg&rdquo; 表示 JPEG 图像文件。如果被省略，则默认值为 text/plain;charset=US-ASCII。如果数据是文本类型，你可以直接将文本嵌入（根据文档类型，使用合适的实体字符或转义字符）。如果是二进制数据，你可以将数据进行 base64 编码之后再进行嵌入。比如嵌入一张图片：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>img</span> <span class=na>alt</span><span class=o>=</span><span class=s>&#34;logo&#34;</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;data:image/png;base64,iVBORw0KGgoAAAANSUhEUg...&#34;</span> <span class=p>/&gt;</span>
</span></span></code></pre></div><p>但需要注意的是：如果图片较大，图片的色彩层次比较丰富，则不适合使用这种方式，因为该图片经过 base64 编码后的字符串非常大，会明显增大 HTML 页面的大小，从而影响加载速度。除此之外，利用 FileReader API，我们也可以方便的实现图片本地预览功能，具体代码如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;file&#34;</span> <span class=na>accept</span><span class=o>=</span><span class=s>&#34;image/*&#34;</span> <span class=na>onchange</span><span class=o>=</span><span class=s>&#34;loadFile(event)&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>img</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;output&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>loadFile</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>reader</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>FileReader</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>reader</span><span class=p>.</span><span class=nx>onload</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>output</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s2>&#34;output&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>output</span><span class=p>.</span><span class=nx>src</span> <span class=o>=</span> <span class=nx>reader</span><span class=p>.</span><span class=nx>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=nx>reader</span><span class=p>.</span><span class=nx>readAsDataURL</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>files</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>在以上示例中，我们为 file 类型输入框绑定 onchange 事件处理函数 loadFile，在该函数中，我们创建了一个 FileReader 对象并为该对象绑定 onload 相应的事件处理函数，然后调用 FileReader 对象的 readAsDataURL() 方法，把本地图片对应的 File 对象转换为 Data URL。在完成本地图片预览之后，我们可以直接把图片对应的 Data URLs 数据提交到服务器。针对这种情形，服务端需要做一些相关处理，才能正常保存上传的图片，这里以 Express 为例，具体处理代码如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;express&#34;</span><span class=p>)();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s2>&#34;/upload&#34;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>imgData</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>imgData</span><span class=p>;</span> <span class=c1>// 获取POST请求中的base64图片数据
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>let</span> <span class=nx>base64Data</span> <span class=o>=</span> <span class=nx>imgData</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/^data:image\/\w+;base64,/</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>dataBuffer</span> <span class=o>=</span> <span class=nx>Buffer</span><span class=p>.</span><span class=nx>from</span><span class=p>(</span><span class=nx>base64Data</span><span class=p>,</span> <span class=s2>&#34;base64&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>fs</span><span class=p>.</span><span class=nx>writeFile</span><span class=p>(</span><span class=s2>&#34;image.png&#34;</span><span class=p>,</span> <span class=nx>dataBuffer</span><span class=p>,</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=s2>&#34;图片上传成功！&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>对于 FileReader 对象来说，除了支持把 Blob/File 对象转换为 Data URL 之外，它还提供了 readAsArrayBuffer() 和 readAsText() 方法，用于把 Blob/File 对象转换为其它的数据格式。这里我们来看个 readAsArrayBuffer() 的使用示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// 从 blob 获取 arrayBuffer
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>let</span> <span class=nx>fileReader</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>FileReader</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>fileReader</span><span class=p>.</span><span class=nx>onload</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>arrayBuffer</span> <span class=o>=</span> <span class=nx>fileReader</span><span class=p>.</span><span class=nx>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=nx>fileReader</span><span class=p>.</span><span class=nx>readAsArrayBuffer</span><span class=p>(</span><span class=nx>blob</span><span class=p>);</span>
</span></span></code></pre></div><h2 id=图片压缩>图片压缩</h2><p>在一些场合中，我们希望在上传本地图片时，先对图片进行一定的压缩，然后再提交到服务器，从而减少传输的数据量。在前端要实现图片压缩，我们可以利用 Canvas 对象提供的 toDataURL() 方法，该方法接收 type 和 encoderOptions 两个可选参数。</p><p>其中 type 表示图片格式，默认为 image/png。而 encoderOptions 用于表示图片的质量，在指定图片格式为 image/jpeg 或 image/webp 的情况下，可以从 0 到 1 的区间内选择图片的质量。如果超出取值范围，将会使用默认值 0.92，其他参数会被忽略。</p><p>下面我们来看一下具体如何实现图片压缩：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// compress.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>MAX_WIDTH</span> <span class=o>=</span> <span class=mi>800</span><span class=p>;</span> <span class=c1>// 图片最大宽度
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>compress</span><span class=p>(</span><span class=nx>base64</span><span class=p>,</span> <span class=nx>quality</span><span class=p>,</span> <span class=nx>mimeType</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>canvas</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s2>&#34;canvas&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>img</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s2>&#34;img&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>img</span><span class=p>.</span><span class=nx>crossOrigin</span> <span class=o>=</span> <span class=s2>&#34;anonymous&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>img</span><span class=p>.</span><span class=nx>src</span> <span class=o>=</span> <span class=nx>base64</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>img</span><span class=p>.</span><span class=nx>onload</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>targetWidth</span><span class=p>,</span> <span class=nx>targetHeight</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>img</span><span class=p>.</span><span class=nx>width</span> <span class=o>&gt;</span> <span class=nx>MAX_WIDTH</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>targetWidth</span> <span class=o>=</span> <span class=nx>MAX_WIDTH</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>targetHeight</span> <span class=o>=</span> <span class=p>(</span><span class=nx>img</span><span class=p>.</span><span class=nx>height</span> <span class=o>*</span> <span class=nx>MAX_WIDTH</span><span class=p>)</span> <span class=o>/</span> <span class=nx>img</span><span class=p>.</span><span class=nx>width</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>targetWidth</span> <span class=o>=</span> <span class=nx>img</span><span class=p>.</span><span class=nx>width</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>targetHeight</span> <span class=o>=</span> <span class=nx>img</span><span class=p>.</span><span class=nx>height</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nx>canvas</span><span class=p>.</span><span class=nx>width</span> <span class=o>=</span> <span class=nx>targetWidth</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>canvas</span><span class=p>.</span><span class=nx>height</span> <span class=o>=</span> <span class=nx>targetHeight</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>ctx</span> <span class=o>=</span> <span class=nx>canvas</span><span class=p>.</span><span class=nx>getContext</span><span class=p>(</span><span class=s2>&#34;2d&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>ctx</span><span class=p>.</span><span class=nx>clearRect</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>targetWidth</span><span class=p>,</span> <span class=nx>targetHeight</span><span class=p>);</span> <span class=c1>// 清除画布
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>ctx</span><span class=p>.</span><span class=nx>drawImage</span><span class=p>(</span><span class=nx>img</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>canvas</span><span class=p>.</span><span class=nx>width</span><span class=p>,</span> <span class=nx>canvas</span><span class=p>.</span><span class=nx>height</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>imageData</span> <span class=o>=</span> <span class=nx>canvas</span><span class=p>.</span><span class=nx>toDataURL</span><span class=p>(</span><span class=nx>mimeType</span><span class=p>,</span> <span class=nx>quality</span> <span class=o>/</span> <span class=mi>100</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>resolve</span><span class=p>(</span><span class=nx>imageData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>对于返回的 Data URL 格式的图片数据，为了进一步减少传输的数据量，我们可以把它转换为 Blob 对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>dataUrlToBlob</span><span class=p>(</span><span class=nx>base64</span><span class=p>,</span> <span class=nx>mimeType</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>bytes</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>atob</span><span class=p>(</span><span class=nx>base64</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34;,&#34;</span><span class=p>)[</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>ab</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ArrayBuffer</span><span class=p>(</span><span class=nx>bytes</span><span class=p>.</span><span class=nx>length</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>ia</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Uint8Array</span><span class=p>(</span><span class=nx>ab</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>bytes</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ia</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>bytes</span><span class=p>.</span><span class=nx>charCodeAt</span><span class=p>(</span><span class=nx>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>new</span> <span class=nx>Blob</span><span class=p>([</span><span class=nx>ab</span><span class=p>],</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=nx>mimeType</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>在转换完成后，我们就可以压缩后的图片对应的 Blob 对象封装在 FormData 对象中，然后再通过 AJAX 提交到服务器上：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>uploadFile</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=nx>blob</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>formData</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>FormData</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>request</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>XMLHttpRequest</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>formData</span><span class=p>.</span><span class=nx>append</span><span class=p>(</span><span class=s2>&#34;image&#34;</span><span class=p>,</span> <span class=nx>blob</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>request</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=s2>&#34;POST&#34;</span><span class=p>,</span> <span class=nx>url</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>request</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>formData</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>其实 Canvas 对象除了提供 <code>toDataURL()</code> 方法之外，它还提供了一个 <code>toBlob()</code> 方法，该方法的语法如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>canvas</span><span class=p>.</span><span class=nx>toBlob</span><span class=p>(</span><span class=nx>callback</span><span class=p>,</span> <span class=nx>mimeType</span><span class=p>,</span> <span class=nx>qualityArgument</span><span class=p>);</span>
</span></span></code></pre></div><p>和 <code>toDataURL()</code> 方法相比，<code>toBlob()</code> 方法是异步的，因此多了个 <code>callback</code> 参数，这个 <code>callback</code> 回调方法默认的第一个参数就是转换好的 <code>blob</code>文件信息。</p><p>介绍完上述的内容，我们来看一下本地图片压缩完整的示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;UTF-8&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;viewport&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;width=device-width, initial-scale=1.0&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>本地图片压缩<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;file&#34;</span> <span class=na>accept</span><span class=o>=</span><span class=s>&#34;image/*&#34;</span> <span class=na>onchange</span><span class=o>=</span><span class=s>&#34;loadFile(event)&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;./compress.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>loadFile</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>reader</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>FileReader</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>reader</span><span class=p>.</span><span class=nx>onload</span> <span class=o>=</span> <span class=kr>async</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kd>let</span> <span class=nx>compressedDataURL</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>compress</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nx>reader</span><span class=p>.</span><span class=nx>result</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=mi>90</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;image/jpeg&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=kd>let</span> <span class=nx>compressedImageBlob</span> <span class=o>=</span> <span class=nx>dataUrlToBlob</span><span class=p>(</span><span class=nx>compressedDataURL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nx>uploadFile</span><span class=p>(</span><span class=s2>&#34;https://httpbin.org/post&#34;</span><span class=p>,</span> <span class=nx>compressedImageBlob</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=nx>reader</span><span class=p>.</span><span class=nx>readAsDataURL</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>files</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><h2 id=生成-pdf-文档>生成 PDF 文档</h2><p>PDF（便携式文件格式，Portable Document Format）是由 Adobe Systems 在 1993 年用于文件交换所发展出的文件格式。在浏览器端，利用一些现成的开源库，比如 jsPDF，我们也可以方便地生成 PDF 文档。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;UTF-8&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;viewport&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;width=device-width, initial-scale=1.0&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>客户端生成 PDF 示例<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>客户端生成 PDF 示例<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://unpkg.com/jspdf@latest/dist/jspdf.min.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=kd>function</span> <span class=nx>generatePdf</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>doc</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>jsPDF</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>doc</span><span class=p>.</span><span class=nx>text</span><span class=p>(</span><span class=s2>&#34;Hello semlinker!&#34;</span><span class=p>,</span> <span class=mi>66</span><span class=p>,</span> <span class=mi>88</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>blob</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Blob</span><span class=p>([</span><span class=nx>doc</span><span class=p>.</span><span class=nx>output</span><span class=p>()],</span> <span class=p>{</span> <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;application/pdf&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=nx>blob</span><span class=p>.</span><span class=nx>text</span><span class=p>().</span><span class=nx>then</span><span class=p>((</span><span class=nx>blobAsText</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>blobAsText</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=p>})();</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>在以上示例中，我们首先创建 PDF 文档对象，然后调用该对象上的 text() 方法在指定的坐标点上添加 Hello semlinker! 文本，然后我们利用生成的 PDF 内容来创建对应的 Blob 对象，需要注意的是我们设置 Blob 的类型为 application/pdf，最后我们把 Blob 对象中保存的内容转换为文本并输出到控制台。由于内容较多，这里我们只列出少部分输出结果：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-s data-lang=s><span class=line><span class=cl><span class=o>%PDF-1.3
</span></span></span><span class=line><span class=cl><span class=o>%</span>ºß¬à
</span></span><span class=line><span class=cl><span class=m>3</span> <span class=m>0</span> <span class=n>obj</span>
</span></span><span class=line><span class=cl><span class=o>&lt;&lt;/</span><span class=n>Type</span> <span class=o>/</span><span class=n>Page</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>Parent</span> <span class=m>1</span> <span class=m>0</span> <span class=n>R</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>Resources</span> <span class=m>2</span> <span class=m>0</span> <span class=n>R</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>MediaBox</span> <span class=n>[0</span> <span class=m>0</span> <span class=m>595.28</span> <span class=m>841.89</span><span class=n>]</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>Contents</span> <span class=m>4</span> <span class=m>0</span> <span class=n>R</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl><span class=n>endobj</span>
</span></span><span class=line><span class=cl><span class=n>....</span>
</span></span></code></pre></div><p>其实 jsPDF 除了支持纯文本之外，它也可以生成带图片的 PDF 文档，比如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>let</span> <span class=nx>imgData</span> <span class=o>=</span> <span class=s2>&#34;data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/...&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>doc</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>jsPDF</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>doc</span><span class=p>.</span><span class=nx>setFontSize</span><span class=p>(</span><span class=mi>40</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>doc</span><span class=p>.</span><span class=nx>text</span><span class=p>(</span><span class=mi>35</span><span class=p>,</span> <span class=mi>25</span><span class=p>,</span> <span class=s2>&#34;Paranyan loves jsPDF&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>doc</span><span class=p>.</span><span class=nx>addImage</span><span class=p>(</span><span class=nx>imgData</span><span class=p>,</span> <span class=s2>&#34;JPEG&#34;</span><span class=p>,</span> <span class=mi>15</span><span class=p>,</span> <span class=mi>40</span><span class=p>,</span> <span class=mi>180</span><span class=p>,</span> <span class=mi>160</span><span class=p>);</span>
</span></span></code></pre></div><h1 id=blob-与-arraybuffer-的区别>Blob 与 ArrayBuffer 的区别</h1><p>ArrayBuffer 对象用于表示通用的，固定长度的原始二进制数据缓冲区。你不能直接操纵 ArrayBuffer 的内容，而是需要创建一个类型化数组对象或 DataView 对象，该对象以特定格式表示缓冲区，并使用该对象读取和写入缓冲区的内容。Blob 类型的对象表示不可变的类似文件对象的原始数据。Blob 表示的不一定是 JavaScript 原生格式的数据。File 接口基于 Blob，继承了 Blob 功能并将其扩展为支持用户系统上的文件。</p><h2 id=blob-vs-arraybuffer>Blob vs ArrayBuffer</h2><ul><li><p>除非你需要使用 ArrayBuffer 提供的写入/编辑的能力，否则 Blob 格式可能是最好的。</p></li><li><p>Blob 对象是不可变的，而 ArrayBuffer 是可以通过 TypedArrays 或 DataView 来操作。</p></li><li><p>ArrayBuffer 是存在内存中的，可以直接操作。而 Blob 可以位于磁盘、高速缓存内存和其他不可用的位置。</p></li><li><p>虽然 Blob 可以直接作为参数传递给其他函数，比如 <code>window.URL.createObjectURL()</code>。但是，你可能仍需要 FileReader 之类的 File API 才能与 Blob 一起使用。</p></li><li><p>Blob 与 ArrayBuffer 对象之间是可以相互转化的：</p></li><li><ul><li>使用 FileReader 的 <code>readAsArrayBuffer()</code> 方法，可以把 Blob 对象转换为 ArrayBuffer 对象；</li><li>使用 Blob 构造函数，如 <code>new Blob([new Uint8Array(data]);</code>，可以把 ArrayBuffer 对象转换为 Blob 对象。</li></ul></li></ul><p>对于 HTTP 的场景，比如在 AJAX 场景下，<strong>Blob</strong> 和 <strong>ArrayBuffer</strong> 可以通过以下方式来使用：</p><pre tabindex=0><code>function GET(url, callback) {
  let xhr = new XMLHttpRequest();
  xhr.open(&#39;GET&#39;, url, true);
  xhr.responseType = &#39;arraybuffer&#39;; // or xhr.responseType = &#34;blob&#34;;
  xhr.send();

  xhr.onload = function(e) {
    if (xhr.status != 200) {
      alert(&#34;Unexpected status code &#34; + xhr.status + &#34; for &#34; + url);
      return false;
    }
    callback(new Uint8Array(xhr.response)); // or new Blob([xhr.response]);
  };
}
</code></pre><p>对于 <strong>ArrayBuffer</strong> 和 <strong>Uint8Array</strong> 感兴趣的读者，可以阅读<a href="http://mp.weixin.qq.com/s?__biz=MzI2MjcxNTQ0Nw==&mid=2247484317&idx=1&sn=c0b397b6bd5fdfced0c1bebc187a7c0d&chksm=ea47a2c5dd302bd37b285f65dd7a92df8ca1bc213465091e82a28be08ec5808b905e9fb69bec&scene=21#wechat_redirect" target=_blank rel=noopener><strong>Deno bytes 模块全解析</strong></a>这篇文章。</p><p>了解完上述的内容，相信有的读者可能会觉得意犹未尽。那么，对于 Blob 来说还有哪些内容可以继续深入学习的呢？本人下一步的计划是基于 Deno 的源码，来逐步分析 DenoBlob 的具体实现。当然也会顺便分析一下 <code>URL.createObjectURL()</code> 方法和 <code>revokeObjectURL()</code> 方法的实现。</p><h1 id=links>Links</h1><ul><li><a href=https://mp.weixin.qq.com/s/MPTTMUXLRK0boeMDYzmaLA target=_blank rel=noopener>https://mp.weixin.qq.com/s/MPTTMUXLRK0boeMDYzmaLA</a></li></ul></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>下一页</div><a href=/books/web-series/1.%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86/filesaver/ rel=prev>FileSaver</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>