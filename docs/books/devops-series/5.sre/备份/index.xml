<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>备份 | Next-gen Tech Edu</title><link>https://ng-tech.icu/books/devops-series/5.sre/%E5%A4%87%E4%BB%BD/</link><atom:link href="https://ng-tech.icu/books/devops-series/5.sre/%E5%A4%87%E4%BB%BD/index.xml" rel="self" type="application/rss+xml"/><description>备份</description><generator>Wowchemy (https://wowchemy.com)</generator><language>zh</language><image><url>https://ng-tech.icu/media/sharing.png</url><title>备份</title><link>https://ng-tech.icu/books/devops-series/5.sre/%E5%A4%87%E4%BB%BD/</link></image><item><title>文件备份</title><link>https://ng-tech.icu/books/devops-series/5.sre/%E5%A4%87%E4%BB%BD/%E6%96%87%E4%BB%B6%E5%A4%87%E4%BB%BD/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://ng-tech.icu/books/devops-series/5.sre/%E5%A4%87%E4%BB%BD/%E6%96%87%E4%BB%B6%E5%A4%87%E4%BB%BD/</guid><description>&lt;h1 id="系统安全加固中的文件备份">系统安全加固中的文件备份&lt;/h1>
&lt;h1 id="文件备份">文件备份&lt;/h1>
&lt;p>在每月第一天备份并压缩/etc 目录的所有内容，存放在/root/bak 目录里，且文件名为如下形式 yymmdd_etc，yy 为年，mm 为月，dd 为日。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/sh
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="nv">DIRNAME&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="sb">`&lt;/span>ls /root &lt;span class="p">|&lt;/span> grep bak&lt;span class="sb">`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> -z &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$DIRNAME&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span> &lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir /root/bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> /root/bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">YY&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="sb">`&lt;/span>date +%y&lt;span class="sb">`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">MM&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="sb">`&lt;/span>date +%m&lt;span class="sb">`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">DD&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="sb">`&lt;/span>date +%d&lt;span class="sb">`&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">BACKETC&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nv">$YY$MM$DD_etc&lt;/span>.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tar zcvf &lt;span class="nv">$BACKETC&lt;/span> /etc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> “fileback finished!”
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>编写任务定时器：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> “0 &lt;span class="m">0&lt;/span> &lt;span class="m">1&lt;/span> * * /bin/sh /usr/bin/fileback” &amp;gt;&lt;span class="p">;&lt;/span> /root/etcbakcron
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">crontab /root/etcbakcron
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">或使用crontab -e 命令添加定时任务：
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">0&lt;/span> &lt;span class="m">1&lt;/span> * * * /bin/sh /usr/bin/fileback
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>