<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="MVVM: 数据绑定与无状态的视图 Model View View-Model 模型是 MV*家族中最年轻的一位，也是由 Microsoft 提出，并经由 Martin Fowler 布道传播。MVVM 源于 Martin Fowler 的 Presentation Model，Presentation Model 的核心在于接管了 View 所有的行为响应，View 的所"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/architecture-series/5.gui-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/%E5%8F%8C%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81/mvvm/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/architecture-series/5.gui-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/%E5%8F%8C%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81/mvvm/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/architecture-series/5.gui-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/%E5%8F%8C%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81/mvvm/"><meta property="og:title" content="MVVM | Next-gen Tech Edu"><meta property="og:description" content="MVVM: 数据绑定与无状态的视图 Model View View-Model 模型是 MV*家族中最年轻的一位，也是由 Microsoft 提出，并经由 Martin Fowler 布道传播。MVVM 源于 Martin Fowler 的 Presentation Model，Presentation Model 的核心在于接管了 View 所有的行为响应，View 的所"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>MVVM | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=67194e0f699beb1f94750d076af5563e><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">双向数据流</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id3b43e9740091467181fe3cca78da0505")' href=#id3b43e9740091467181fe3cca78da0505 aria-expanded=false aria-controls=id3b43e9740091467181fe3cca78da0505 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/architecture-series/5.gui-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/>5.GUI 应用程序架构</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id3b43e9740091467181fe3cca78da0505 aria-expanded=false aria-controls=id3b43e9740091467181fe3cca78da0505><i class="fa-solid fa-angle-down" id=caret-id3b43e9740091467181fe3cca78da0505></i></a></div><ul class="nav docs-sidenav collapse show" id=id3b43e9740091467181fe3cca78da0505><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id5defff311ae30163ea8402ba7cb86369")' href=#id5defff311ae30163ea8402ba7cb86369 aria-expanded=false aria-controls=id5defff311ae30163ea8402ba7cb86369 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/architecture-series/5.gui-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/%E5%8D%95%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81/>单向数据流</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id5defff311ae30163ea8402ba7cb86369 aria-expanded=false aria-controls=id5defff311ae30163ea8402ba7cb86369><i class="fa-solid fa-angle-right" id=caret-id5defff311ae30163ea8402ba7cb86369></i></a></div><ul class="nav docs-sidenav collapse" id=id5defff311ae30163ea8402ba7cb86369><li class="child level"><a href=/books/architecture-series/5.gui-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/%E5%8D%95%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81/clean-architecture/>Clean Architecture</a></li><li class="child level"><a href=/books/architecture-series/5.gui-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/%E5%8D%95%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81/flux/>Flux</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idb3c183a70dae730056dcf3e9f5f77f96")' href=#idb3c183a70dae730056dcf3e9f5f77f96 aria-expanded=false aria-controls=idb3c183a70dae730056dcf3e9f5f77f96 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/architecture-series/5.gui-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/%E5%8F%8C%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81/>双向数据流</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idb3c183a70dae730056dcf3e9f5f77f96 aria-expanded=false aria-controls=idb3c183a70dae730056dcf3e9f5f77f96><i class="fa-solid fa-angle-down" id=caret-idb3c183a70dae730056dcf3e9f5f77f96></i></a></div><ul class="nav docs-sidenav collapse show" id=idb3c183a70dae730056dcf3e9f5f77f96><li class="child level"><a href=/books/architecture-series/5.gui-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/%E5%8F%8C%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81/mvc/>MVC</a></li><li class="child level"><a href=/books/architecture-series/5.gui-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/%E5%8F%8C%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81/mvp/>MVP</a></li><li class="child level active"><a href=/books/architecture-series/5.gui-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/%E5%8F%8C%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81/mvvm/>MVVM</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id967754518e110b86cf15fe670e1d7bd1")' href=#id967754518e110b86cf15fe670e1d7bd1 aria-expanded=false aria-controls=id967754518e110b86cf15fe670e1d7bd1 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/architecture-series/5.gui-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/%E7%BB%84%E4%BB%B6%E5%8C%96/>组件化</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id967754518e110b86cf15fe670e1d7bd1 aria-expanded=false aria-controls=id967754518e110b86cf15fe670e1d7bd1><i class="fa-solid fa-angle-right" id=caret-id967754518e110b86cf15fe670e1d7bd1></i></a></div><ul class="nav docs-sidenav collapse" id=id967754518e110b86cf15fe670e1d7bd1><li class="child level"><a href=/books/architecture-series/5.gui-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/%E7%BB%84%E4%BB%B6%E5%8C%96/atomic-design/>Atomic Design</a></li></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#mvvm-数据绑定与无状态的视图>MVVM: 数据绑定与无状态的视图</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>MVVM</h1><div class=article-style><h2 id=mvvm-数据绑定与无状态的视图>MVVM: 数据绑定与无状态的视图</h2><p>Model View View-Model 模型是 <code>MV*</code>家族中最年轻的一位，也是由 Microsoft 提出，并经由 Martin Fowler 布道传播。MVVM 源于 Martin Fowler 的 Presentation Model，Presentation Model 的核心在于接管了 View 所有的行为响应，View 的所有响应与状态都定义在了 Presentation Model 中。也就是说，View 不会包含任意的状态。举个典型的使用场景，当用户点击某个按钮之后，状态信息是从 Presentation Model 传递给 Model，而不是从 View 传递给 Presentation Model。任何控制组件间的逻辑操作，即上文所述的 ViewLogic，都应该放置在 Presentation Model 中进行处理，而不是在 View 层，这一点也是 MVP 模式与 Presentation Model 最大的区别。</p><p>MVVM 模式进一步深化了 Presentation Model 的思想，利用 Data Binding 等技术保证了 View 中不会存储任何的状态或者逻辑操作。在 WPF 中，UI 主要是利用 XAML 或者 XML 创建，而这些标记类型的语言是无法存储任何状态的，就像 HTML 一样(因此 JSX 语法其实是将 View 又有状态化了)，只是允许 UI 与某个 ViewModel 中的类建立映射关系。渲染引擎根据 XAML 中的声明以及来自于 ViewModel 的数据最终生成呈现的页面。因为数据绑定的特性，有时候 MVVM 也会被称作 MVB:Model View Binder。总结一下，MVVM 利用数据绑定彻底完成了从命令式编程到声明式编程的转化，使得 View 逐步无状态化。一个典型的 MVVM 的使用场景为：</p><ul><li>用户交互输入</li><li>View 将数据直接传送给 ViewModel，ViewModel 保存这些状态数据</li><li>在有需要的情况下，ViewModel 会将数据传送给 Model</li><li>Model 在更新完成之后通知 ViewModel</li><li>ViewModel 从 Model 中获取最新的模型，并且更新自己的数据状态</li><li>View 根据最新的 ViewModel 的数据进行重新渲染</li></ul><p>根据上述流程，我们可知 MVVM 模式的特性为：</p><ul><li>ViewModel、Model 中存在 ViewLogic 实现，View 则不保存任何状态信息</li><li>View 不需要了解 ViewModel 的实现细节，但是会声明自己所需要的数据类型，并且能够知道如何重新渲染</li><li>ViewModel 不需要了解 View 的实现细节(非命令式编程)，但是需要根据 View 声明的数据类型传入对应的数据。ViewModel 需要了解 Model 的实现细节。</li><li>Model 不需要了解 View 的实现细节，需要了解 ViewModel 的实现细节</li></ul><h1 id=ios>iOS</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-swift data-lang=swift><span class=line><span class=cl><span class=kd>import</span> <span class=nc>UIKit</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>struct</span> <span class=nc>Person</span> <span class=p>{</span> <span class=c1>// Model</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>firstName</span><span class=p>:</span> <span class=nb>String</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>lastName</span><span class=p>:</span> <span class=nb>String</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>protocol</span> <span class=nc>GreetingViewModelProtocol</span><span class=p>:</span> <span class=kd>class</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nv>greeting</span><span class=p>:</span> <span class=nb>String</span><span class=p>?</span> <span class=p>{</span> <span class=kr>get</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nv>greetingDidChange</span><span class=p>:</span> <span class=p>((</span><span class=n>GreetingViewModelProtocol</span><span class=p>)</span> <span class=p>-&gt;</span> <span class=p>())?</span> <span class=p>{</span> <span class=kr>get</span> <span class=kr>set</span> <span class=p>}</span> <span class=c1>// function to call when greeting did change</span>
</span></span><span class=line><span class=cl>    <span class=kd>init</span><span class=p>(</span><span class=n>person</span><span class=p>:</span> <span class=n>Person</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>func</span> <span class=nf>showGreeting</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>GreetingViewModel</span> <span class=p>:</span> <span class=n>GreetingViewModelProtocol</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>person</span><span class=p>:</span> <span class=n>Person</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nv>greeting</span><span class=p>:</span> <span class=nb>String</span><span class=p>?</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=kr>didSet</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kc>self</span><span class=p>.</span><span class=n>greetingDidChange</span><span class=p>?(</span><span class=kc>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nv>greetingDidChange</span><span class=p>:</span> <span class=p>((</span><span class=n>GreetingViewModelProtocol</span><span class=p>)</span> <span class=p>-&gt;</span> <span class=p>())?</span>
</span></span><span class=line><span class=cl>    <span class=kr>required</span> <span class=kd>init</span><span class=p>(</span><span class=n>person</span><span class=p>:</span> <span class=n>Person</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=kc>self</span><span class=p>.</span><span class=n>person</span> <span class=p>=</span> <span class=n>person</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>func</span> <span class=nf>showGreeting</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=kc>self</span><span class=p>.</span><span class=n>greeting</span> <span class=p>=</span> <span class=s>&#34;Hello&#34;</span> <span class=o>+</span> <span class=s>&#34; &#34;</span> <span class=o>+</span> <span class=kc>self</span><span class=p>.</span><span class=n>person</span><span class=p>.</span><span class=n>firstName</span> <span class=o>+</span> <span class=s>&#34; &#34;</span> <span class=o>+</span> <span class=kc>self</span><span class=p>.</span><span class=n>person</span><span class=p>.</span><span class=n>lastName</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>GreetingViewController</span> <span class=p>:</span> <span class=n>UIViewController</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nv>viewModel</span><span class=p>:</span> <span class=n>GreetingViewModelProtocol</span><span class=p>!</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=kr>didSet</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kc>self</span><span class=p>.</span><span class=n>viewModel</span><span class=p>.</span><span class=n>greetingDidChange</span> <span class=p>=</span> <span class=p>{</span> <span class=p>[</span><span class=kr>unowned</span> <span class=kc>self</span><span class=p>]</span> <span class=n>viewModel</span> <span class=k>in</span>
</span></span><span class=line><span class=cl><span class=kc>self</span><span class=p>.</span><span class=n>greetingLabel</span><span class=p>.</span><span class=n>text</span> <span class=p>=</span> <span class=n>viewModel</span><span class=p>.</span><span class=n>greeting</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>showGreetingButton</span> <span class=p>=</span> <span class=n>UIButton</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nv>greetingLabel</span> <span class=p>=</span> <span class=n>UILabel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>override</span> <span class=kd>func</span> <span class=nf>viewDidLoad</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=kc>super</span><span class=p>.</span><span class=n>viewDidLoad</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kc>self</span><span class=p>.</span><span class=n>showGreetingButton</span><span class=p>.</span><span class=n>addTarget</span><span class=p>(</span><span class=kc>self</span><span class=p>.</span><span class=n>viewModel</span><span class=p>,</span> <span class=n>action</span><span class=p>:</span> <span class=s>&#34;showGreeting&#34;</span><span class=p>,</span> <span class=n>forControlEvents</span><span class=p>:</span> <span class=p>.</span><span class=n>TouchUpInside</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// layout code goes here</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// Assembling of MVVM</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nv>model</span> <span class=p>=</span> <span class=n>Person</span><span class=p>(</span><span class=n>firstName</span><span class=p>:</span> <span class=s>&#34;David&#34;</span><span class=p>,</span> <span class=n>lastName</span><span class=p>:</span> <span class=s>&#34;Blaine&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nv>viewModel</span> <span class=p>=</span> <span class=n>GreetingViewModel</span><span class=p>(</span><span class=n>person</span><span class=p>:</span> <span class=n>model</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nv>view</span> <span class=p>=</span> <span class=n>GreetingViewController</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>view</span><span class=p>.</span><span class=n>viewModel</span> <span class=p>=</span> <span class=n>viewModel</span>
</span></span></code></pre></div><ul><li>Distribution:在 Cocoa MVVM 中，View 相对于 MVP 中的 View 担负了更多的功能，譬如需要构建数据绑定等等</li><li>Testability:ViewModel 拥有 View 中的所有数据结构，因此很容易就可以进行测试</li><li>易用性:相对而言有很多的冗余代码</li></ul><h1 id=android>Android</h1><ul><li>XML 中声明数据绑定</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;data&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;variable</span>
</span></span><span class=line><span class=cl>    <span class=na>name=</span><span class=s>&#34;viewModel&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>type=</span><span class=s>&#34;uk.ivanc.archimvvm.viewmodel.MainViewModel&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/data&gt;</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;EditText</span>
</span></span><span class=line><span class=cl><span class=na>android:id=</span><span class=s>&#34;@+id/edit_text_username&#34;</span>
</span></span><span class=line><span class=cl><span class=na>android:layout_width=</span><span class=s>&#34;match_parent&#34;</span>
</span></span><span class=line><span class=cl><span class=na>android:layout_height=</span><span class=s>&#34;wrap_content&#34;</span>
</span></span><span class=line><span class=cl><span class=na>android:layout_toLeftOf=</span><span class=s>&#34;@id/button_search&#34;</span>
</span></span><span class=line><span class=cl><span class=na>android:hint=</span><span class=s>&#34;@string/hit_username&#34;</span>
</span></span><span class=line><span class=cl><span class=na>android:imeOptions=</span><span class=s>&#34;actionSearch&#34;</span>
</span></span><span class=line><span class=cl><span class=na>android:inputType=</span><span class=s>&#34;text&#34;</span>
</span></span><span class=line><span class=cl><span class=na>android:onEditorAction=</span><span class=s>&#34;@{viewModel.onSearchAction}&#34;</span>
</span></span><span class=line><span class=cl><span class=na>android:textColor=</span><span class=s>&#34;@color/white&#34;</span>
</span></span><span class=line><span class=cl><span class=na>android:theme=</span><span class=s>&#34;@style/LightEditText&#34;</span>
</span></span><span class=line><span class=cl>                <span class=na>app:addTextChangedListener=</span><span class=s>&#34;@{viewModel.usernameEditTextWatcher}&#34;</span><span class=nt>/&gt;</span>
</span></span></code></pre></div><ul><li>View 中绑定 ViewModel</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>super</span><span class=o>.</span><span class=na>onCreate</span><span class=o>(</span><span class=n>savedInstanceState</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>binding</span> <span class=o>=</span> <span class=n>DataBindingUtil</span><span class=o>.</span><span class=na>setContentView</span><span class=o>(</span><span class=k>this</span><span class=o>,</span> <span class=n>R</span><span class=o>.</span><span class=na>layout</span><span class=o>.</span><span class=na>main_activity</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>mainViewModel</span> <span class=o>=</span> <span class=k>new</span> <span class=n>MainViewModel</span><span class=o>(</span><span class=k>this</span><span class=o>,</span> <span class=k>this</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>binding</span><span class=o>.</span><span class=na>setViewModel</span><span class=o>(</span><span class=n>mainViewModel</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>setSupportActionBar</span><span class=o>(</span><span class=n>binding</span><span class=o>.</span><span class=na>toolbar</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>setupRecyclerView</span><span class=o>(</span><span class=n>binding</span><span class=o>.</span><span class=na>reposRecyclerView</span><span class=o>);</span>
</span></span></code></pre></div><ul><li>ViewModel 中进行数据操作</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>onSearchAction</span><span class=o>(</span><span class=n>TextView</span> <span class=n>view</span><span class=o>,</span> <span class=kt>int</span> <span class=n>actionId</span><span class=o>,</span> <span class=n>KeyEvent</span> <span class=n>event</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>(</span><span class=n>actionId</span> <span class=o>==</span> <span class=n>EditorInfo</span><span class=o>.</span><span class=na>IME_ACTION_SEARCH</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>username</span> <span class=o>=</span> <span class=n>view</span><span class=o>.</span><span class=na>getText</span><span class=o>().</span><span class=na>toString</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>username</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=o>)</span> <span class=n>loadGithubRepos</span><span class=o>(</span><span class=n>username</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>onClickSearch</span><span class=o>(</span><span class=n>View</span> <span class=n>view</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=n>loadGithubRepos</span><span class=o>(</span><span class=n>editTextUsernameValue</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>TextWatcher</span> <span class=nf>getUsernameEditTextWatcher</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=k>new</span> <span class=n>TextWatcher</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>beforeTextChanged</span><span class=o>(</span><span class=n>CharSequence</span> <span class=n>charSequence</span><span class=o>,</span> <span class=kt>int</span> <span class=n>start</span><span class=o>,</span> <span class=kt>int</span> <span class=n>count</span><span class=o>,</span> <span class=kt>int</span> <span class=n>after</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>onTextChanged</span><span class=o>(</span><span class=n>CharSequence</span> <span class=n>charSequence</span><span class=o>,</span> <span class=kt>int</span> <span class=n>start</span><span class=o>,</span> <span class=kt>int</span> <span class=n>before</span><span class=o>,</span> <span class=kt>int</span> <span class=n>count</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=n>editTextUsernameValue</span> <span class=o>=</span> <span class=n>charSequence</span><span class=o>.</span><span class=na>toString</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>searchButtonVisibility</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=n>charSequence</span><span class=o>.</span><span class=na>length</span><span class=o>()</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>?</span> <span class=n>View</span><span class=o>.</span><span class=na>VISIBLE</span> <span class=o>:</span> <span class=n>View</span><span class=o>.</span><span class=na>GONE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>afterTextChanged</span><span class=o>(</span><span class=n>Editable</span> <span class=n>editable</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>};</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>上一页</div><a href=/books/architecture-series/5.gui-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/%E5%8F%8C%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81/mvp/ rel=next>MVP</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>