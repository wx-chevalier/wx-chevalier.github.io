<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>单向数据流 | Next-gen Tech Edu</title><link>https://ng-tech.icu/books/architecture-series/5.gui-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/%E5%8D%95%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81/</link><atom:link href="https://ng-tech.icu/books/architecture-series/5.gui-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/%E5%8D%95%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81/index.xml" rel="self" type="application/rss+xml"/><description>单向数据流</description><generator>Wowchemy (https://wowchemy.com)</generator><language>zh</language><image><url>https://ng-tech.icu/media/sharing.png</url><title>单向数据流</title><link>https://ng-tech.icu/books/architecture-series/5.gui-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/%E5%8D%95%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81/</link></image><item><title>Clean Architecture</title><link>https://ng-tech.icu/books/architecture-series/5.gui-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/%E5%8D%95%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81/clean-architecture/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://ng-tech.icu/books/architecture-series/5.gui-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/%E5%8D%95%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81/clean-architecture/</guid><description>&lt;h1 id="clean-architecture">Clean Architecture&lt;/h1>
&lt;p>
&lt;figure >
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="http://luboganev.github.io/images/2015-07-23-clean-architecture-pt2/CleanArchitecture.jpg" alt="" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;/figure>&lt;/p>
&lt;p>Uncle Bob 提出 Clean Architecture 最早并不是专门面向于 GUI 应用程序，而是描述了一种用于构建可扩展、可测试软件系统的概要原则。Clean Architecture 可能运用于构建网站、Web 应用、桌面应用以及移动应用等不同领域场景的软件开发中。其定义的基本原则保证了关注点分离以及整个软件项目的模块性与可组织性，也就是我们在上文提及的 GUI 应用程序架构中所需要考量的点。Clean Architecture 中最基础的理论当属所谓的依赖原则(Dependency Rule)，在依赖洋葱图中的任一内层模块不应该了解或依赖于任何外层模块。换言之，我们定义在外层模块中的代码不应该被内层模块所引入，包括变量、函数、类等等任何的软件实体。&lt;/p>
&lt;p>除此之外，Clean Architecture 还强制规定了所有邻接圈层之间的交互与通信应当以抽象方式定义，譬如在 Android 中应该利用 Java 提供的 POJOs 以及 Interfaces，而 iOS 中应该使用 Protocols 或者标准类。这种强制定义也就保证了不同层之间的组件完全解耦合，并且能够很方便地更改或者 Mock 测试，而不会影响到其他层的代码。Clean Architecture 是非常理想化的架构定义模式，也仅是提出了一些基本的原则，其在 iOS 的具体实践也就是所谓的 VIPER 架构。&lt;/p>
&lt;h2 id="ios-viper-architecture">iOS Viper Architecture&lt;/h2>
&lt;p>Viper 架构中职责分割地更为细致，大概分为了五层:&lt;/p>
&lt;ul>
&lt;li>Interactor:包含了与数据以及网络相关的业务逻辑，譬如从服务端获取数据并构造出实体对象。很多时候我们会使用所谓的 Services 或者 Managers 来负责此方面的工作&lt;/li>
&lt;li>包含 UI 相关的一些业务逻辑，调用 Interactor 中的方法&lt;/li>
&lt;li>Entities:单纯的数据对象而不是数据访问层&lt;/li>
&lt;li>Router:在 VIPER 模块间完成路由&lt;/li>
&lt;/ul>
&lt;p>一般来说，一个 VIPER 模块可以是单独的某个页面或者整个应用程序，经常会按照权限来划分。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-swift" data-lang="swift">&lt;span class="line">&lt;span class="cl">&lt;span class="kd">import&lt;/span> &lt;span class="nc">UIKit&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">struct&lt;/span> &lt;span class="nc">Person&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="c1">// Entity (usually more complex e.g. NSManagedObject)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">let&lt;/span> &lt;span class="nv">firstName&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">String&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">let&lt;/span> &lt;span class="nv">lastName&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">String&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">struct&lt;/span> &lt;span class="nc">GreetingData&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="c1">// Transport data structure (not Entity)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">let&lt;/span> &lt;span class="nv">greeting&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">String&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">let&lt;/span> &lt;span class="nv">subject&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">String&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">protocol&lt;/span> &lt;span class="nc">GreetingProvider&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">func&lt;/span> &lt;span class="nf">provideGreetingData&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">protocol&lt;/span> &lt;span class="nc">GreetingOutput&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">func&lt;/span> &lt;span class="nf">receiveGreetingData&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">greetingData&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">GreetingData&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">GreetingInteractor&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">GreetingProvider&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">weak&lt;/span> &lt;span class="kd">var&lt;/span> &lt;span class="nv">output&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">GreetingOutput&lt;/span>&lt;span class="p">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">func&lt;/span> &lt;span class="nf">provideGreetingData&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">let&lt;/span> &lt;span class="nv">person&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">Person&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">firstName&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;David&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lastName&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;Blaine&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// usually comes from data access layer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">let&lt;/span> &lt;span class="nv">subject&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">person&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">firstName&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34; &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">person&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">lastName&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">let&lt;/span> &lt;span class="nv">greeting&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">GreetingData&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">greeting&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;Hello&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">subject&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">subject&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kc">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">output&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">receiveGreetingData&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">greeting&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">protocol&lt;/span> &lt;span class="nc">GreetingViewEventHandler&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">func&lt;/span> &lt;span class="nf">didTapShowGreetingButton&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">protocol&lt;/span> &lt;span class="nc">GreetingView&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kd">class&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">func&lt;/span> &lt;span class="nf">setGreeting&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">greeting&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">String&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">GreetingPresenter&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">GreetingOutput&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">GreetingViewEventHandler&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">weak&lt;/span> &lt;span class="kd">var&lt;/span> &lt;span class="nv">view&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">GreetingView&lt;/span>&lt;span class="p">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nv">greetingProvider&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">GreetingProvider&lt;/span>&lt;span class="p">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">func&lt;/span> &lt;span class="nf">didTapShowGreetingButton&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kc">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">greetingProvider&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">provideGreetingData&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">func&lt;/span> &lt;span class="nf">receiveGreetingData&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">greetingData&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">GreetingData&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">let&lt;/span> &lt;span class="nv">greeting&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">greetingData&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">greeting&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s">&amp;#34; &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">greetingData&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">subject&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kc">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">view&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">setGreeting&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">greeting&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">class&lt;/span> &lt;span class="nc">GreetingViewController&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">UIViewController&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">GreetingView&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nv">eventHandler&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">GreetingViewEventHandler&lt;/span>&lt;span class="p">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">let&lt;/span> &lt;span class="nv">showGreetingButton&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">UIButton&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">let&lt;/span> &lt;span class="nv">greetingLabel&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">UILabel&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">override&lt;/span> &lt;span class="kd">func&lt;/span> &lt;span class="nf">viewDidLoad&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kc">super&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">viewDidLoad&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kc">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">showGreetingButton&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">addTarget&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">action&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s">&amp;#34;didTapButton:&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">forControlEvents&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">.&lt;/span>&lt;span class="n">TouchUpInside&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">func&lt;/span> &lt;span class="nf">didTapButton&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">button&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">UIButton&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kc">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">eventHandler&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">didTapShowGreetingButton&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">func&lt;/span> &lt;span class="nf">setGreeting&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">greeting&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">String&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kc">self&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">greetingLabel&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">text&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">greeting&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// layout code goes here&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Assembling of VIPER module, without Router&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span> &lt;span class="nv">view&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">GreetingViewController&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span> &lt;span class="nv">presenter&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">GreetingPresenter&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">let&lt;/span> &lt;span class="nv">interactor&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">GreetingInteractor&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">view&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">eventHandler&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">presenter&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">presenter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">view&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">view&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">presenter&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">greetingProvider&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">interactor&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interactor&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">output&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">presenter&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>
&lt;p>Distribution: 毫无疑问，VIPER 中职责分割的最为细致&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Testability: 测试性肯定也是最好的&lt;/p>
&lt;/li>
&lt;li>
&lt;p>易用性: 代码最多&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>Flux</title><link>https://ng-tech.icu/books/architecture-series/5.gui-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/%E5%8D%95%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81/flux/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://ng-tech.icu/books/architecture-series/5.gui-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84/%E5%8D%95%E5%90%91%E6%95%B0%E6%8D%AE%E6%B5%81/flux/</guid><description>&lt;h1 id="flux-单向数据流架构">Flux 单向数据流架构&lt;/h1>
&lt;h1 id="双向数据绑定的不足">双向数据绑定的不足&lt;/h1>
&lt;p>This means that one change (a user input or API response) can affect the state of an application in many places in the code — for example, two-way data binding. That can be hard to maintain and debug.&lt;/p>
&lt;p>Facebook 强调，双向数据绑定极不利于代码的扩展与维护。从具体的代码实现角度来看，双向数据绑定会导致更改的不可预期性(UnPredictable)，就好像 Angular 利用 Dirty Checking 来进行是否需要重新渲染的检测，这导致了应用的缓慢，简直就是来砸场子的。而在采用了单向数据流之后，整个应用状态会变得可预测(Predictable)，也能很好地了解当状态发生变化时到底会有多少的组件发生变化。另一方面，相对集中地状态管理，也有助于你不同的组件之间进行信息交互或者状态共享，特别是像 Redux 这种强调 Single Store 与 SIngle State Tree 的状态管理模式，能够保证以统一的方式对于应用的状态进行修改，并且 Immutable 的概念引入使得状态变得可回溯。譬如 Facebook 在&lt;a href="https://facebook.github.io/flux/docs/overview.html" target="_blank" rel="noopener">Flux Overview&lt;/a>中举的例子，当我们希望在一个界面上同时展示未读信息列表与未读信息的总数目的时候，对于 &lt;code>MV*&lt;/code>就有点恶心了，特别是当这两个组件不在同一个 ViewModel/Controller 中的时候。一旦我们将某个未读信息标识为已读，会引起控制已读信息、未读信息、未读信息总数目等等一系列模型的更新。特别是很多时候为了方便我们可能在每个 ViewModel/Controller 都会设置一个数据副本，这会导致依赖连锁更新，最终导致不可预测的结果与性能损耗。而在 Flux 中这种依赖是反转的，Store 接收到更新的 Action 请求之后对数据进行统一的更新并且通知各个 View，而不是依赖于各个独立的 ViewModel/Controller 所谓的一致性更新。从职责划分的角度来看，除了 Store 之外的任何模块其实都不知道应该如何处理数据，这就保证了合理的职责分割。这种模式下，当我们创建新项目时，项目复杂度的增长瓶颈也就会更高，不同于传统的 View 与 ViewLogic 之间的绑定，控制流被独立处理，当我们添加新的特性，新的数据，新的界面，新的逻辑处理模块时，并不会导致原有模块的复杂度增加，从而使得整个逻辑更加清晰可控。&lt;/p>
&lt;p>这里还需要提及一下，很多人应该是从 React 开始认知到单向数据流这种架构模式的，而当时 Angular 1 的缓慢与性能之差令人发指，但是譬如 Vue 与 Angular 2 的性能就非常优秀。借用 Vue.js 官方的说法，
The virtual-DOM approach provides a functional way to describe your view at any point of time, which is really nice. Because it doesn’t use observables and re-renders the entire app on every update, the view is by definition guaranteed to be in sync with the data. It also opens up possibilities to isomorphic JavaScript applications.
Instead of a Virtual DOM, Vue.js uses the actual DOM as the template and keeps references to actual nodes for data bindings. This limits Vue.js to environments where DOM is present. However, contrary to the common misconception that Virtual-DOM makes React faster than anything else, Vue.js actually out-performs React when it comes to hot updates, and requires almost no hand-tuned optimization. With React, you need to implementshouldComponentUpdate everywhere and use immutable data structures to achieve fully optimized re-renders.&lt;/p>
&lt;p>总而言之，笔者认为双向数据流与单向数据流相比，性能上孰优孰劣尚无定论，最大的区别在于单向数据流与双向数据流相比有更好地可控性，这一点在上文提及的函数响应式编程中也有体现。若论快速开发，笔者感觉双向数据绑定略胜一筹，毕竟这种 View 与 ViewModel/ViewLogic 之间的直接绑定直观便捷。而如果是注重于全局的状态管理，希望维护耦合程度较低、可测试性/可扩展性较高的代码，那么还是单向数据流，即 Unidirectional Architecture 较为合适。一家之言，欢迎讨论。&lt;/p>
&lt;h1 id="flux-数据流驱动的页面">Flux: 数据流驱动的页面&lt;/h1>
&lt;p>Flux 不能算是绝对的先行者，但是在 Unidirectional Architecture 中却是最富盛名的一个，也是很多人接触到的第一个 Unidirectional Architecture。Flux 主要由以下几个部分构成：&lt;/p>
&lt;ul>
&lt;li>Stores:存放业务数据和应用状态，一个 Flux 中可能存在多个 Stores&lt;/li>
&lt;li>View:层次化组合的 React 组件&lt;/li>
&lt;li>Actions:用户输入之后触发 View 发出的事件&lt;/li>
&lt;li>Dispatcher:负责分发 Actions&lt;/li>
&lt;/ul>
&lt;p>根据上述流程，我们可知 Flux 模式的特性为：&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Dispatcher: Event Bus 中设置有一个单例的 Dispatcher，很多 Flux 的变种都移除了 Dispatcher 依赖。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>只有 View 使用可组合的组件: 在 Flux 中只有 React 的组件可以进行层次化组合，而 Stores 与 Actions 都不可以进行层次化组合。React 组件与 Flux 一般是松耦合的，因此 Flux 并不是 Fractal，Dispatcher 与 Stores 可以被看做 Orchestrator。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>用户事件响应在渲染时声明: 在 React 的 &lt;code>render()&lt;/code> 函数中，即负责响应用户交互，也负责注册用户事件的处理器&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>下面我们来看一个具体的代码对比，首先是以经典的 Cocoa 风格编写一个简单的计数器按钮:&lt;/p>
&lt;pre tabindex="0">&lt;code class="language-ojc" data-lang="ojc">class ModelCounter
constructor: (@value=1) -&amp;gt;
increaseValue: (delta) =&amp;gt;
@value += delta
class ControllerCounter
constructor: (opts) -&amp;gt;
@model_counter = opts.model_counter
@observers = []
getValue: =&amp;gt; @model_counter.value
increaseValue: (delta) =&amp;gt;
@model_counter.increaseValue(delta)
@notifyObservers()
notifyObservers: =&amp;gt;
obj.notify(this) for obj in @observers
registerObserver: (observer) =&amp;gt;
@observers.push(observer)
class ViewCounterButton
constructor: (opts) -&amp;gt;
@controller_counter = opts.controller_counter
@button_class = opts.button_class or &amp;#39;button_counter&amp;#39;
@controller_counter.registerObserver(this)
render: =&amp;gt;
elm = $(&amp;#34;&amp;lt;button class=\&amp;#34;#{@button_class}\&amp;#34;&amp;gt;
#{@controller_counter.getValue()}&amp;lt;/button&amp;gt;&amp;#34;)
elm.click =&amp;gt;
@controller_counter.increaseValue(1)
return elm
notify: =&amp;gt;
$(&amp;#34;button.#{@button_class}&amp;#34;).replaceWith(=&amp;gt; @render())
&lt;/code>&lt;/pre>&lt;p>上述代码逻辑用上文提及的 MVC 模式图演示就是:&lt;/p>
&lt;p>而如果用 Flux 模式实现，会是下面这个样子:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Store&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">class CounterStore extends EventEmitter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> constructor: -&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @count &lt;span class="o">=&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @dispatchToken &lt;span class="o">=&lt;/span> @registerToDispatcher&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> increaseValue: &lt;span class="o">(&lt;/span>delta&lt;span class="o">)&lt;/span> -&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @count +&lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> getCount: -&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> @count
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> registerToDispatcher: -&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CounterDispatcher.register&lt;span class="o">((&lt;/span>payload&lt;span class="o">)&lt;/span> &lt;span class="o">=&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switch payload.type
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> when ActionTypes.INCREASE_COUNT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @increaseValue&lt;span class="o">(&lt;/span>payload.delta&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Action&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">class CounterActions
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @increaseCount: &lt;span class="o">(&lt;/span>delta&lt;span class="o">)&lt;/span> -&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CounterDispatcher.handleViewAction&lt;span class="o">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;type&amp;#39;&lt;/span>: ActionTypes.INCREASE_COUNT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;delta&amp;#39;&lt;/span>: delta
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># View&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">CounterButton&lt;/span> &lt;span class="o">=&lt;/span> React.createClass&lt;span class="o">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> getInitialState: -&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="o">{&lt;/span>&lt;span class="s1">&amp;#39;count&amp;#39;&lt;/span>: 0&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> _onChange: -&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @setState&lt;span class="o">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> count: CounterStore.getCount&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> componentDidMount: -&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CounterStore.addListener&lt;span class="o">(&lt;/span>&lt;span class="s1">&amp;#39;CHANGE&amp;#39;&lt;/span>, @_onChange&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> componentWillUnmount: -&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CounterStore.removeListener&lt;span class="o">(&lt;/span>&lt;span class="s1">&amp;#39;CHANGE&amp;#39;&lt;/span>, @_onChange&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> render: -&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> React.DOM.button&lt;span class="o">({&lt;/span>&lt;span class="s1">&amp;#39;className&amp;#39;&lt;/span>: @prop.class&lt;span class="o">}&lt;/span>, @state.value&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>其数据流图为:&lt;/p>
&lt;h2 id="redux-集中式的状态管理">Redux: 集中式的状态管理&lt;/h2>
&lt;p>Redux 是 Flux 的所有变种中最为出色的一个，并且也是当前 Web 领域主流的状态管理工具，其独创的理念与功能深刻影响了 GUI 应用程序架构中的状态管理的思想。Redux 将 Flux 中单例的 Dispatcher 替换为了单例的 Store，即也是其最大的特性，集中式的状态管理。并且 Store 的定义也不是从零开始单独定义，而是基于多个 Reducer 的组合，可以把 Reducer 看做 Store Factory。Redux 的重要组成部分包括:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Singleton Store:管理应用中的状态，并且提供了一个&lt;code>dispatch(action)&lt;/code>函数。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Provider:用于监听 Store 的变化并且连接像 React、Angular 这样的 UI 框架&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Actions:基于用户输入创建的分发给 Reducer 的事件&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Reducers:用于响应 Actions 并且更新全局状态树的纯函数&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>根据上述流程，我们可知 Redux 模式的特性为：&lt;/p>
&lt;ul>
&lt;li>
&lt;p>以工厂模式组装 Stores: Redux 允许我以&lt;code>createStore()&lt;/code>函数加上一系列组合好的 Reducer 函数来创建 Store 实例，还有另一个&lt;code>applyMiddleware()&lt;/code>函数可以允许在&lt;code>dispatch()&lt;/code>函数执行前后链式调用一系列中间件。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Providers: Redux 并不特定地需要何种 UI 框架，可以与 Angular、React 等等很多 UI 框架协同工作。Redux 并不是 Fractal，一般来说 Store 被视作 Orchestrator。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>User Event 处理器即可以选择在渲染函数中声明，也可以在其他地方进行声明。&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="model-view-update">Model-View-Update&lt;/h2>
&lt;p>又被称作&lt;a href="https://github.com/evancz/elm-architecture-tutorial/" target="_blank" rel="noopener">Elm Architecture&lt;/a>，上面所讲的 Redux 就是受到 Elm 的启发演化而来，因此 MVU 与 Redux 之间有很多的相通之处。MVU 使用函数式编程语言 Elm 作为其底层开发语言，因此该架构可以被看做更纯粹的函数式架构。MVU 中的基本组成部分有:&lt;/p>
&lt;ul>
&lt;li>Model:定义状态数据结构的类型&lt;/li>
&lt;li>View:纯函数，将状态渲染为界面&lt;/li>
&lt;li>Actions:以 Mailbox 的方式传递用户事件的载体&lt;/li>
&lt;li>Update:用于更新状态的纯函数&lt;/li>
&lt;/ul>
&lt;p>根据上述流程，我们可知 Elm 模式的特性为：&lt;/p>
&lt;ul>
&lt;li>到处可见的层次化组合:Redux 只是在 View 层允许将组件进行层次化组合，而 MVU 中在 Model 与 Update 函数中也允许进行层次化组合，甚至 Actions 都可以包含内嵌的子 Action&lt;/li>
&lt;li>Elm 属于 Fractal 架构:因为 Elm 中所有的模块组件都支持层次化组合，即都可以被单独地导出使用&lt;/li>
&lt;/ul>
&lt;h2 id="model-view-intent">Model-View-Intent&lt;/h2>
&lt;p>MVI 是一个基于&lt;a href="https://github.com/Reactive-Extensions/RxJS" target="_blank" rel="noopener">RxJS&lt;/a>的响应式单向数据流架构。MVI 也是&lt;a href="http://cycle.js.org/" target="_blank" rel="noopener">Cycle.js&lt;/a>的首选架构，主要由 Observable 事件流对象与处理函数组成。其主要的组成部分包括:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Intent:Observable 提供的将用户事件转化为 Action 的函数&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Model:Observable 提供的将 Action 转化为可观测的 State 的函数&lt;/p>
&lt;/li>
&lt;li>
&lt;p>View:将状态渲染为用户界面的函数&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Custom Element:类似于 React Component 那样的界面组件&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>
&lt;figure >
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="http://staltz.com/img/mvi-unidir-ui-arch.jpg" alt="" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;/figure>&lt;/p>
&lt;p>根据上述流程，我们可知 MVI 模式的特性为：&lt;/p>
&lt;ul>
&lt;li>
&lt;p>重度依赖于 Observables:架构中的每个部分都会被转化为 Observable 事件流&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Intent:不同于 Flux 或者 Redux，MVI 中的 Actions 并没有直接传送给 Dispatcher 或者 Store，而是交于正在监听的 Model&lt;/p>
&lt;/li>
&lt;li>
&lt;p>彻底的响应式，并且只要所有的组件都遵循 MVI 模式就能保证整体架构的 fractal 特性&lt;/p>
&lt;/li>
&lt;/ul></description></item></channel></rss>