<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>zlib | Next-gen Tech Edu</title><link>https://ng-tech.icu/books/algorithm-series/2.%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%8E%8B%E7%BC%A9/zlib/</link><atom:link href="https://ng-tech.icu/books/algorithm-series/2.%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%8E%8B%E7%BC%A9/zlib/index.xml" rel="self" type="application/rss+xml"/><description>zlib</description><generator>Wowchemy (https://wowchemy.com)</generator><language>zh</language><image><url>https://ng-tech.icu/media/sharing.png</url><title>zlib</title><link>https://ng-tech.icu/books/algorithm-series/2.%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%8E%8B%E7%BC%A9/zlib/</link></image><item><title>Deflate 算法</title><link>https://ng-tech.icu/books/algorithm-series/2.%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%8E%8B%E7%BC%A9/zlib/deflate-%E7%AE%97%E6%B3%95/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://ng-tech.icu/books/algorithm-series/2.%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%8E%8B%E7%BC%A9/zlib/deflate-%E7%AE%97%E6%B3%95/</guid><description>&lt;h1 id="deflate-算法">Deflate 算法&lt;/h1>
&lt;p>Deflate 算法主要基于前人的两个算法，LZ77 压缩算法和 Huffman coding。总结下整个 Deflate encoding 的过程如下图所示：&lt;/p>
&lt;p>
&lt;figure >
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="https://pic.imgdb.cn/item/63a2bd9ab1fccdcd3690e820.jpg" alt="Deflate encoding 过程" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;/figure>&lt;/p>
&lt;p>总结下 Deflate 中两个非常值得学习的点：&lt;/p>
&lt;ul>
&lt;li>将 alphabet 的取值空间划分成大小不等的段，对段进行 huffman coding&lt;/li>
&lt;li>为了最小化 huffman 码表的数据量，用 code lengths 唯一表示一颗 huffman 树&lt;/li>
&lt;/ul>
&lt;h1 id="lz77">LZ77&lt;/h1>
&lt;p>这里先简单介绍下 LZ77 算法，基本思想是数据中存在很多重复出现的字符串（也可以是字节流），重复的越多，可压缩的空间越大。对于这些重复出现的字符串，可以用 &lt;code>&amp;lt;length, distance&amp;gt; pair&lt;/code> 来表示，distance 是到上一次这个字符串出现位置的距离，length 是这个重复串的长度。&lt;/p>
&lt;p>这里面有几个细节：&lt;/p>
&lt;ul>
&lt;li>重复串搜索只会在往前的一定长度范围内由近到远搜素，LZ77 称之为滑动窗口(Search Buffer)，一般这个窗口大小是 32K，滑动窗口大小决定了 distance 的取值范围。&lt;/li>
&lt;li>除了前向用于搜索重复串的 Search buffer 外，还有个后向的 Look-ahead buffer，作为当前待编码的字符串区，因此寻找重复串的过程就是在 search buffer 里查找和当前 look-ahead buffer 最长的匹配字符串（常见的动态规划问题）。look-ahead buffer 大小决定了 length 的取值范围。&lt;/li>
&lt;li>deflate 里认为只有重复串长度超过 3 个字节，才采用这种表示方法，同时最多允许匹配 258 个字符，因此 length 的取值范围是 3-258（256 个不同的值），这个限制是在压缩率和算法计算复杂度间做权衡。&lt;/li>
&lt;/ul>
&lt;p>encoding 的伪代码如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-s" data-lang="s">&lt;span class="line">&lt;span class="cl">&lt;span class="n">while&lt;/span> &lt;span class="n">look&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ahead&lt;/span> &lt;span class="n">buffer&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">not&lt;/span> &lt;span class="n">empty&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">go&lt;/span> &lt;span class="n">backwards&lt;/span> &lt;span class="n">in&lt;/span> &lt;span class="n">search&lt;/span> &lt;span class="n">buffer&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">find&lt;/span> &lt;span class="n">longest&lt;/span> &lt;span class="n">match&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">look&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ahead&lt;/span> &lt;span class="n">buffer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">if&lt;/span> &lt;span class="n">match&lt;/span> &lt;span class="n">found&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">print&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">offset&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">window&lt;/span> &lt;span class="n">boundary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">length&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">match&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">shift&lt;/span> &lt;span class="n">window&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="n">length&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">print&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">first&lt;/span> &lt;span class="n">symbol&lt;/span> &lt;span class="n">in&lt;/span> &lt;span class="n">look&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ahead&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">shift&lt;/span> &lt;span class="n">window&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">end&lt;/span> &lt;span class="n">while&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>可以看出 encoding 过程需要做个最长匹配字符串的查找，也可以选择合适的数据结构来表示 search buffer/look-ahead buffer 来加速查找。encoding 的输出是个 token stream，token 可以是 &lt;code>&amp;lt;length, distance&amp;gt;&lt;/code> 也可以是 symbol 本身。
decoding 的伪代码：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-s" data-lang="s">&lt;span class="line">&lt;span class="cl">&lt;span class="n">for&lt;/span> &lt;span class="n">each&lt;/span> &lt;span class="nf">token &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">length&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">distance&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">or&lt;/span> &lt;span class="n">symbol&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">if&lt;/span> &lt;span class="n">token&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">symbol&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">then&lt;/span> &lt;span class="n">print&lt;/span> &lt;span class="n">symbol&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">go&lt;/span> &lt;span class="n">reverse&lt;/span> &lt;span class="n">in&lt;/span> &lt;span class="n">previous&lt;/span> &lt;span class="n">output&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="n">offset&lt;/span> &lt;span class="n">characters&lt;/span> &lt;span class="n">and&lt;/span> &lt;span class="n">copy&lt;/span> &lt;span class="n">character&lt;/span> &lt;span class="n">wise&lt;/span> &lt;span class="n">for&lt;/span> &lt;span class="n">length&lt;/span> &lt;span class="n">symbols&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">print&lt;/span> &lt;span class="n">symbol&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">next&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="huffman-coding">Huffman coding&lt;/h1>
&lt;p>哈夫曼编码应该不需要多做介绍了，每个学过数据结构的都具备这个知识。recap 下 Huffman coding 是一种前缀编码，根据统计每个字符在整个待编码数据中出现的次数，从小到大排序，由底向上动态构建一颗二叉树，二叉树的叶子节点就是每个字符，出现次数越小的字符处于二叉树的底部，对应的码字的长度也越长。这样构建的二叉树就是 huffman 树，整个字符集以及其对应的码字构成整个码表。由于码表是根据要编码的数据动态生成的，想要解码必须要有这个码表，因此码表需要和数据一起传输。&lt;/p>
&lt;p>需要说明的是同一个数据集在经典的 huffman 算法下，可以有多棵 huffman 树存在，因为节点位于二叉树的左边还是右边对最终的编码长度来说没有影响，有影响的只是节点位于树的哪层（也就是字符在被编码后的 bit 长度，也被称为 code length）。可以这么说：对于如果两个码表中码字的 code length 一致的话，那么这两个码表最终的编码效果也是一致的。因此，在 deflate 算法中，为了最大化减少传输码表所占用的数据量，在构建 huffman 树时对树的形状做了两个限制，使得同一个数据集唯一生成一颗 huffman 树，与此同时，在传输码表的时候只需要传输字符和其对应的 code length 就要可以了。 这两个限制也很简单：&lt;/p>
&lt;ul>
&lt;li>当叶子节点和一个中间节点构建二叉树时将叶子节点放在左边，中间节点放右边。&lt;/li>
&lt;li>当两个叶子节点构建二叉树时，将先出现的字符的节点放左边，后出现的放右边。&lt;/li>
&lt;/ul>
&lt;p>这样构建出的二叉树越靠左边树越浅，越靠右边树越深，极为不平衡，特殊且唯一。&lt;/p>
&lt;h1 id="deflate-中-lz77-和-huffman-coding-怎么结合起来">Deflate 中 LZ77 和 huffman coding 怎么结合起来&lt;/h1>
&lt;p>总的来说，Deflate 先应用 LZ77 压缩策略对原始数据进行压缩，得到(&amp;lt;length, distance&amp;gt; or literal) 流，然后应用 huffman coding 对 distance、length、literal 分别进行编码得到最终的压缩数据流。应用 LZ77 的过程没啥好说的了，比较 trick 的是应用 huffman coding 的过程。&lt;/p>
&lt;h2 id="对-distance-的-huffman-coding">对 distance 的 huffman coding&lt;/h2>
&lt;p>前面我们知道 distance 的取值范围取决于 search buffer 的大小，32K 的 search buffer 对于 distance 的取值范围为 1-32768，也就是说 distance 码表中最多可能有 32768 个码表，我们知道 huffman 树的高度在最坏情况下渐近于码表大小。要知道 Deflate 诞生于上世纪 90 年代，那个以 KB 计算内存的时代内存是非常宝贵的，直接应用经典 huffman 算法构建 huffman 树时对内存的消耗、计算量的要求很容易就超出当时的硬件条件。因此 Deflate 算法做了个很牛逼的优化——将 distance 的 value space 划分为 30 个变长的段，然后对这 30 个段进行 huffman coding，段内根据段区间大小进行等长编码。具体如下：&lt;/p>
&lt;p>
&lt;figure >
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="https://pic.imgdb.cn/item/63a2bccab1fccdcd368f850d.jpg" alt="哈夫曼编码" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;/figure>&lt;/p>
&lt;p>其中 code 是段的编号，bits 表示该段的区间长度。可以看出，distance 1,2,3,4 这四个特殊的 distance 没有划分，一个 distance 值占用一个段，distance 值越大，段划分的越稀疏，这样做的理由是考虑到重复串出现的空间局部性。举个具体的例子，假设 17-24 这个 distance 段的 huffman coding 是二进制的 110，那么 distance 17-24 最终的 coding 为：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-s" data-lang="s">&lt;span class="line">&lt;span class="cl">&lt;span class="m">17&lt;/span>&lt;span class="o">--&amp;gt;&lt;/span>&lt;span class="m">110&lt;/span> &lt;span class="m">000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">18&lt;/span>&lt;span class="o">--&amp;gt;&lt;/span>&lt;span class="m">110&lt;/span> &lt;span class="m">001&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">19&lt;/span>&lt;span class="o">--&amp;gt;&lt;/span>&lt;span class="m">110&lt;/span> &lt;span class="m">010&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">20&lt;/span>&lt;span class="o">--&amp;gt;&lt;/span>&lt;span class="m">110&lt;/span> &lt;span class="m">011&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">21&lt;/span>&lt;span class="o">--&amp;gt;&lt;/span>&lt;span class="m">110&lt;/span> &lt;span class="m">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">22&lt;/span>&lt;span class="o">--&amp;gt;&lt;/span>&lt;span class="m">110&lt;/span> &lt;span class="m">101&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">23&lt;/span>&lt;span class="o">--&amp;gt;&lt;/span>&lt;span class="m">110&lt;/span> &lt;span class="m">110&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">24&lt;/span>&lt;span class="o">--&amp;gt;&lt;/span>&lt;span class="m">110&lt;/span> &lt;span class="m">111&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Deflate 通过这样的方式在码表长度和算法的计算复杂度之间做了 trade off。&lt;/p>
&lt;h2 id="对-literallength-的-huffman-coding">对 literal/length 的 huffman coding&lt;/h2>
&lt;p>literal 就是原始数据中的一个个字符（字节），所以一个 literal 的取值范围是 0-255（256 种不同的取值）。length 前面说了，取值范围是 3-258（也是 256 个不同的取值）。Deflate 在这里比较 trick 地将 literal 值、length 值、以及数据块结束标识全部统一到一个 alphabet 中进行编码，得到也是同一个码表。这样做的好处是不需要在最终的编码中用一个标识位来标识当前编码的类型（是 literal 还是 length 或者是块结束标识）。当然也有代价，代价就是 huffman 树变大了。Deflate 对 literal 取值分布没有做任何假设，但对 length 的取值做了和 distance 类似的假设，即 length 越大意味这字符串匹配的长度越长，出现的概率越小，因此 Deflate 对 length 的 value space 做了类似 distance 的分段处理，将 256 种取值划分为 29 个区间段。如下表所示：&lt;/p>
&lt;p>
&lt;figure >
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="https://pic.imgdb.cn/item/63a2bccab1fccdcd368f850d.jpg" alt="" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;/figure>&lt;/p>
&lt;p>细心的读者会发现，285 这个 length 的 bits 是 0，意味着 285 作为一个独立的段参与 huffman coding 中，为什么？我猜测是由于 285 作为 Deflate 规定的最大匹配串长度，也就说所有超过 285 的匹配字符串长度都被截断到 285 了，因此其出现的概率会相对高些。OK，这里暂停总结下目前为止 Defate 算法的编码过程： 首先应用 LZ77 算法对原始数据进行压缩，生成(&amp;lt;length, distance&amp;gt; or literal)数据流，然后对数据流应用 huffman coding 算法进行统计分析，生成了两个 huffman 码表，一个是 literal/length 构成的 alphabet 所生成的码表（简称为码表 1)，一个是 distance 值构成的 alphabet 所生成的码表（简称为码表 2），再由这两个码表对(&amp;lt;length, distance&amp;gt; or literal)数据流进行编码得到最终的数据码流。&lt;/p>
&lt;p>解码过程就是上面的逆过程，假设已经重建好码表 1 和码表 2，首先应用码表 1 对数据流进行解码，如果发现是 literal 则直接输出，如果是 length，继续用码表 2 对 length 后面的 distance 进行解码，得到&amp;lt;length, distance&amp;gt; pair，最终将生成的(&amp;lt;length, distance&amp;gt; or literal) 数据流交给 LZ77 解码得到原始数据。进度条到这里已经过半了，但是故事还没有结束，前面说过码表本身需要和压缩的数据流一起来传输/存储，下面继续 Deflate 算法对码表本身的处理。&lt;/p>
&lt;h2 id="对-huffman-码表本身的-encoding">对 huffman 码表本身的 encoding&lt;/h2>
&lt;p>前面提到，Deflate 选择构建一颗最特殊的 huffman 树（最左倾的树）来进行 huffman 编码，这样码表可以用字符以及其对应的 code length 来唯一表示，大大缩小了码表的数据量。以 literal/length 码表为例，整个 alphabet 大小是 286（256 个 literal + 1 个块结束标识 + 29 个 length 段），因此整个码表可以用长度为 286 个 code length 序列来表示，每个 code length 唯一对应一个 alphabet 中的字符。Distance 码表也一样，可以用一个长度为 30 的 code length 序列唯一表示。通常来说这两个 code length 序列越往后 code length 值为 0 的可能性就越大，0 意味着 alphabet 中没有对应的元素（字符）。所以在这里 Deflate 用了一个小的 trick，它将这两个 code length 序列 trim 一下，把 trailing 的那些 0 都去掉，然后把他们合并称一个 code length 序列。由于事先知道这两个序列的原始长度，根据经过 trim 再合并得到的这个 code length 完全能还原出原始的两个 code length 序列。&lt;/p>
&lt;p>可以看出这个序列中依旧会出现很多连续的 0，或者 1 等等 code length 的存在。Deflate 意识到这点，所以会先对这个 code length 序列做一次 run length encoding，也就是游程编码。在构建 huffman 树的时候，Deflate 其实还对生成树的高度加了限制，使得 huffman 树的高度不超过 15，因此这个 code length 序列的取值范围是 0-15。在经过游程编码后序列会进一步压缩成，姑且称这个经过游程编码后的序列为 MCL，MCL 的长度肯定小于(286 + 30)，MCL 序列中元素的取值范围是 0-18(游程编码会引入 16、17、18) 几个特殊字符。&lt;/p>
&lt;p>Deflate 对 MCL 再进行一次 huffman coding，同时限制生成的 huffman 树高度最多为 7，得到一个编码后 MCL 数据流，以及一个 MCL huffman 码表，对于这个 MCL huffman 码表，采用和前面一致的 code length 表示法，由于这个码表的 alphabet 大小只有 19 个，Deflate 认为差不多就得了，用固定长度编码对 RSQ 码表的 code lengths 进行编码。值得说明的是，针对这个 alphabet Deflate 按照如下的顺序记录他们的 code length：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-s" data-lang="s">&lt;span class="line">&lt;span class="cl">&lt;span class="m">16&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">17&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">18&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">8&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">7&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">9&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">11&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">12&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">13&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">14&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">15&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>采用这个特殊顺序记录 code length 的原因是为了能让 0 尽可能出现在 code length 序列的尾部（16,17,18 是游程编码进入的特殊字符，所以出现的频率可能会高些，所以放前面）。这样以来可以对 code length 进行 trim 操作，去掉 trailing 的 0，然后记录下原来 code length 序列长度（alphabet 大小）解码的时候就能够正确恢复。&lt;/p></description></item><item><title>gzip</title><link>https://ng-tech.icu/books/algorithm-series/2.%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%8E%8B%E7%BC%A9/zlib/gzip/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://ng-tech.icu/books/algorithm-series/2.%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%8E%8B%E7%BC%A9/zlib/gzip/</guid><description/></item><item><title>zlib、gzip、zip 等对比</title><link>https://ng-tech.icu/books/algorithm-series/2.%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%8E%8B%E7%BC%A9/zlib/zlibgzipzip-%E7%AD%89%E5%AF%B9%E6%AF%94/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://ng-tech.icu/books/algorithm-series/2.%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%8E%8B%E7%BC%A9/zlib/zlibgzipzip-%E7%AD%89%E5%AF%B9%E6%AF%94/</guid><description>&lt;h1 id="zlibgzipzip-等对比">zlib、gzip、zip 等对比&lt;/h1>
&lt;p>先来看一下 zlib，它的官方网站是www.zlib.net，目前的最新版本是1.2.11.官方介绍它是一个免费的数据压缩库（A Massively Spiffy Yet Delicately Unobtrusive Compression Library），zlib 由两位主要人员开发，Jean-loup Gailly 负责压缩功能，Mark Adler 负责解压功能。由于代码是开源的，我们不妨把源码下载下来，编译一下,编译之后我们在 zlib 的安装目录看到了下列文件:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-s" data-lang="s">&lt;span class="line">&lt;span class="cl">&lt;span class="n">[root&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">iZrj9hu97fjb3e1xlfktg8Z&lt;/span> &lt;span class="n">zlib]&lt;/span>&lt;span class="c1"># tree&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">&lt;/span>├── &lt;span class="n">include&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── &lt;span class="n">zconf.h&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── &lt;span class="n">zlib.h&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── &lt;span class="n">lib&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── &lt;span class="n">libz.a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── &lt;span class="n">libz.so&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">libz.so.1.2.11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── &lt;span class="n">libz.so.1&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">libz.so.1.2.11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── &lt;span class="n">libz.so.1.2.11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── &lt;span class="n">pkgconfig&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── &lt;span class="n">zlib.pc&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── &lt;span class="n">share&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── &lt;span class="n">man&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── &lt;span class="n">man3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── &lt;span class="n">zlib.3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">6&lt;/span> &lt;span class="n">directories&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">8&lt;/span> &lt;span class="n">files&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>仔细观察的话，发现 zlib 并没有像其它的程序一样，编译出二进制可指定代码，只有头文件，库文件和文档，也就是说 zlib 并不提供对文件的直接操作。再来会过来头看 zlib 源代码的 zlib.3.pdf 文件，它是这样说的：“zlib 库是一个通用的数据压缩库，它提供在内存当中的压缩和解压算法，目前只支持 deflation 一种算法，将来可能会添加其它压缩算法”，也就是说整个 zlib 实际上只有一种算法，那就是 deflation 算法。zlib 提供了几个比较简单的函数来压缩和解压数据:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="n">ZEXPORT&lt;/span> &lt;span class="nf">compress2&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">dest&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">destLen&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">source&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sourceLen&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Bytef&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">dest&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">uLongf&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">destLen&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">const&lt;/span> &lt;span class="n">Bytef&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">source&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">uLong&lt;/span> &lt;span class="n">sourceLen&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">z_stream&lt;/span> &lt;span class="n">stream&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">int&lt;/span> &lt;span class="n">err&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">const&lt;/span> &lt;span class="n">uInt&lt;/span> &lt;span class="n">max&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">uInt&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">uLong&lt;/span> &lt;span class="n">left&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">left&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">destLen&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span>&lt;span class="n">destLen&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stream&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">zalloc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">alloc_func&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stream&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">zfree&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">free_func&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stream&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">opaque&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">voidpf&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">err&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">deflateInit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">stream&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">Z_OK&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">err&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stream&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next_out&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">dest&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stream&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">avail_out&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stream&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">next_in&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">z_const&lt;/span> &lt;span class="n">Bytef&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">source&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stream&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">avail_in&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">do&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">stream&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">avail_out&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stream&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">avail_out&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">left&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">uLong&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">max&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="nl">max&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">uInt&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">left&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">left&lt;/span> &lt;span class="o">-=&lt;/span> &lt;span class="n">stream&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">avail_out&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">stream&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">avail_in&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stream&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">avail_in&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">sourceLen&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">uLong&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">max&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="nl">max&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">uInt&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">sourceLen&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sourceLen&lt;/span> &lt;span class="o">-=&lt;/span> &lt;span class="n">stream&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">avail_in&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">err&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">deflate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">stream&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sourceLen&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="nl">Z_NO_FLUSH&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">Z_FINISH&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">while&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">err&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">Z_OK&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span>&lt;span class="n">destLen&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">stream&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">total_out&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">deflateEnd&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">stream&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">err&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">Z_STREAM_END&lt;/span> &lt;span class="o">?&lt;/span> &lt;span class="nl">Z_OK&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">err&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="n">ZEXPORT&lt;/span> &lt;span class="nf">compress&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">dest&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">destLen&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">source&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sourceLen&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Bytef&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">dest&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">uLongf&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">destLen&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">const&lt;/span> &lt;span class="n">Bytef&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">source&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">uLong&lt;/span> &lt;span class="n">sourceLen&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nf">compress2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dest&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">destLen&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">source&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sourceLen&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Z_DEFAULT_COMPRESSION&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>通过参数，我们可以看到 zlib 的压缩确实像上面说的，没有涉及到文件操作，不读取硬盘上的数据文件进行压缩，只操作内存数据。那么我们来测试一下用 compress 函数压缩数据:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;string.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;zlib.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="nf">my_write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">char&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">fname&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="kt">char&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span> &lt;span class="n">argc&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="kt">char&lt;/span>&lt;span class="o">**&lt;/span> &lt;span class="n">argv&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">argc&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Please Input A String You want to Compress&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">char&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">str&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">argv&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;The String You Want to Compress is: %s&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">str&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//计算需要压缩的字符的长度
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">uLong&lt;/span> &lt;span class="n">sLen&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">strlen&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">str&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//压缩之后字符的长度
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">uLong&lt;/span> &lt;span class="n">tLen&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//通过zlib API计算tlen的长度，以便接下来给压缩之后的数据分配空间
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">tLen&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">compressBound&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sLen&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//分配压缩数据空间
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">char&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">cspace&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cspace&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">malloc&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tLen&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//是否分配成功
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cspace&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nb">NULL&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Not enough memory!&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//开始压缩
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">result&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">compress&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cspace&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">tLen&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">str&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">sLen&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">Z_OK&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Compress Sucess!&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//保存压缩内容到硬盘
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">j&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">my_write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;compressdata.bin&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">cspace&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">j&lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">-Sucess to write into disk!&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s">-Failure to write into disk!&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//开始解压
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">uncompress&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">str&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">sLen&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">cspace&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">tLen&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">Z_OK&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Original String is: %s&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">str&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">printf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;uncompress failure!&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s">&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">free&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cspace&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">my_write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">char&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">fname&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="kt">char&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">size_t&lt;/span> &lt;span class="n">writesize&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">FILE&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">pFile&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pFile&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">fopen&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fname&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s">&amp;#34;wb&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//fwrite返回区块数量
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">writesize&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">fwrite&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">buffer&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nf">strlen&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">buffer&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">pFile&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">fclose&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pFile&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">strlen&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">buffer&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">writesize&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>编译运行:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">iZrj9hu97fjb3e1xlfktg8Z&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="err">#&lt;/span> &lt;span class="n">gcc&lt;/span> &lt;span class="n">zcompress&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">c&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">I&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">tmp&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">zlib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">include&lt;/span>&lt;span class="o">/&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">lz&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">L&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">tmp&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">zlib&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">lib&lt;/span>&lt;span class="o">/&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">o&lt;/span> &lt;span class="n">z&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">iZrj9hu97fjb3e1xlfktg8Z&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="err">#&lt;/span> &lt;span class="p">.&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">z&lt;/span> &lt;span class="s">&amp;#34;This is the string&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">The&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="n">You&lt;/span> &lt;span class="n">Want&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">Compress&lt;/span> &lt;span class="nl">is&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">This&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Compress&lt;/span> &lt;span class="n">Sucess&lt;/span>&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span>&lt;span class="n">Sucess&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">write&lt;/span> &lt;span class="n">into&lt;/span> &lt;span class="n">disk&lt;/span>&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Original&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="nl">is&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">This&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">string&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>到这里一切正常，那是不是 zlib 提供就是 deflation 算法呢？实则不然，zlib 还提供了一种 zlib 数据格式，在原有压缩数据的基础上，添加头部和尾部信息，在 HTTP/1.1 协议中，content-encoding 类型中的 deflate，实际上不是 deflation 算法处理的原始数据，而是添加了头部和尾部信息的 ZLIB 格式。ZLIB 的头部和尾部数据信息可以查看 rfc1950。&lt;/p>
&lt;p>那么 gzip 和 zlib 又有什么区别呢，在 gzip 的说明文档中，看到了这样的文字:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-s" data-lang="s">&lt;span class="line">&lt;span class="cl">&lt;span class="n">The&lt;/span> &lt;span class="n">deflation&lt;/span> &lt;span class="n">algorithm&lt;/span> &lt;span class="n">used&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="n">zip&lt;/span> &lt;span class="n">and&lt;/span> &lt;span class="n">gzip&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">variation&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="nf">LZ77
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Lempel&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Ziv&lt;/span> &lt;span class="m">1977&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">see&lt;/span> &lt;span class="n">reference&lt;/span> &lt;span class="n">below&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">. It&lt;/span> &lt;span class="n">finds&lt;/span> &lt;span class="n">duplicated&lt;/span> &lt;span class="n">strings&lt;/span> &lt;span class="n">in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">the&lt;/span> &lt;span class="n">input&lt;/span> &lt;span class="n">data.&lt;/span> &lt;span class="n">The&lt;/span> &lt;span class="n">second&lt;/span> &lt;span class="n">occurrence&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">string&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">replaced&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="n">a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pointer&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">previous&lt;/span> &lt;span class="n">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">in&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">form&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="nf">pair &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">distance&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">length&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">. Distances&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">limited&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="m">32&lt;/span>&lt;span class="n">K&lt;/span> &lt;span class="n">bytes&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">and&lt;/span> &lt;span class="n">lengths&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">limited&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">to&lt;/span> &lt;span class="m">258&lt;/span> &lt;span class="n">bytes.&lt;/span> &lt;span class="n">When&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">string&lt;/span> &lt;span class="n">does&lt;/span> &lt;span class="n">not&lt;/span> &lt;span class="n">occur&lt;/span> &lt;span class="n">anywhere&lt;/span> &lt;span class="n">in&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">previous&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">32&lt;/span>&lt;span class="n">K&lt;/span> &lt;span class="n">bytes&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">it&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">emitted&lt;/span> &lt;span class="n">as&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">sequence&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">literal&lt;/span> &lt;span class="nf">bytes. &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">In&lt;/span> &lt;span class="n">this&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">description&lt;/span>&lt;span class="p">,&lt;/span> ‘&lt;span class="n">string&lt;/span>’ &lt;span class="n">must&lt;/span> &lt;span class="n">be&lt;/span> &lt;span class="n">taken&lt;/span> &lt;span class="n">as&lt;/span> &lt;span class="n">an&lt;/span> &lt;span class="n">arbitrary&lt;/span> &lt;span class="n">sequence&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">bytes&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">and&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">not&lt;/span> &lt;span class="n">restricted&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">printable&lt;/span> &lt;span class="n">characters.&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">… &lt;span class="m">2&lt;/span>&lt;span class="n">. gzip&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="n">format&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">The&lt;/span> &lt;span class="n">pkzip&lt;/span> &lt;span class="n">format&lt;/span> &lt;span class="n">imposes&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">lot&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">overhead&lt;/span> &lt;span class="n">in&lt;/span> &lt;span class="n">various&lt;/span> &lt;span class="n">headers&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">which&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">are&lt;/span> &lt;span class="n">useful&lt;/span> &lt;span class="n">for&lt;/span> &lt;span class="n">an&lt;/span> &lt;span class="n">archiver&lt;/span> &lt;span class="n">but&lt;/span> &lt;span class="n">not&lt;/span> &lt;span class="n">necessary&lt;/span> &lt;span class="n">when&lt;/span> &lt;span class="n">only&lt;/span> &lt;span class="n">one&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="n">is&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">compressed.&lt;/span> &lt;span class="n">gzip&lt;/span> &lt;span class="n">uses&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">much&lt;/span> &lt;span class="n">simpler&lt;/span> &lt;span class="n">structure.&lt;/span> &lt;span class="n">Numbers&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">in&lt;/span> &lt;span class="n">little&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">endian&lt;/span> &lt;span class="n">format&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">and&lt;/span> &lt;span class="n">bit&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">least&lt;/span> &lt;span class="n">significant&lt;/span> &lt;span class="n">bit.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">A&lt;/span> &lt;span class="n">gzip&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">sequence&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">compressed&lt;/span> &lt;span class="n">members.&lt;/span> &lt;span class="n">Each&lt;/span> &lt;span class="n">member&lt;/span> &lt;span class="n">has&lt;/span> &lt;span class="n">the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">following&lt;/span> &lt;span class="n">structure&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">2&lt;/span> &lt;span class="n">bytes&lt;/span> &lt;span class="n">magic&lt;/span> &lt;span class="n">header&lt;/span> &lt;span class="mh">0x1f&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mh">0x8b&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">\037&lt;/span> &lt;span class="n">\213&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">1&lt;/span> &lt;span class="n">byte&lt;/span> &lt;span class="n">compression&lt;/span> &lt;span class="nf">method &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="kc">..7&lt;/span> &lt;span class="n">reserved&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">8&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">deflate&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">1&lt;/span> &lt;span class="n">byte&lt;/span> &lt;span class="n">flags&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bit&lt;/span> &lt;span class="m">0&lt;/span> &lt;span class="n">set&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="n">probably&lt;/span> &lt;span class="n">ascii&lt;/span> &lt;span class="n">text&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bit&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="n">set&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">continuation&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">multi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">part&lt;/span> &lt;span class="n">gzip&lt;/span> &lt;span class="n">file&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bit&lt;/span> &lt;span class="m">2&lt;/span> &lt;span class="n">set&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">extra&lt;/span> &lt;span class="n">field&lt;/span> &lt;span class="n">present&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bit&lt;/span> &lt;span class="m">3&lt;/span> &lt;span class="n">set&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">original&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">present&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bit&lt;/span> &lt;span class="m">4&lt;/span> &lt;span class="n">set&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="n">comment&lt;/span> &lt;span class="n">present&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bit&lt;/span> &lt;span class="m">5&lt;/span> &lt;span class="n">set&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">encrypted&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bit&lt;/span> &lt;span class="m">6&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="m">7&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">reserved&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">4&lt;/span> &lt;span class="n">bytes&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="n">modification&lt;/span> &lt;span class="n">time&lt;/span> &lt;span class="n">in&lt;/span> &lt;span class="n">Unix&lt;/span> &lt;span class="n">format&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">1&lt;/span> &lt;span class="n">byte&lt;/span> &lt;span class="n">extra&lt;/span> &lt;span class="nf">flags &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">depend&lt;/span> &lt;span class="n">on&lt;/span> &lt;span class="n">compression&lt;/span> &lt;span class="n">method&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">1&lt;/span> &lt;span class="n">byte&lt;/span> &lt;span class="n">operating&lt;/span> &lt;span class="n">system&lt;/span> &lt;span class="n">on&lt;/span> &lt;span class="n">which&lt;/span> &lt;span class="n">compression&lt;/span> &lt;span class="n">took&lt;/span> &lt;span class="n">place&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">2&lt;/span> &lt;span class="n">bytes&lt;/span> &lt;span class="n">optional&lt;/span> &lt;span class="n">part&lt;/span> &lt;span class="nf">number &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">second&lt;/span> &lt;span class="n">part&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">2&lt;/span> &lt;span class="n">bytes&lt;/span> &lt;span class="n">optional&lt;/span> &lt;span class="n">extra&lt;/span> &lt;span class="n">field&lt;/span> &lt;span class="n">length&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">?&lt;/span> &lt;span class="n">bytes&lt;/span> &lt;span class="n">optional&lt;/span> &lt;span class="n">extra&lt;/span> &lt;span class="n">field&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">?&lt;/span> &lt;span class="n">bytes&lt;/span> &lt;span class="n">optional&lt;/span> &lt;span class="n">original&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">zero&lt;/span> &lt;span class="n">terminated&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">?&lt;/span> &lt;span class="n">bytes&lt;/span> &lt;span class="n">optional&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="n">comment&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">zero&lt;/span> &lt;span class="n">terminated&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">12&lt;/span> &lt;span class="n">bytes&lt;/span> &lt;span class="n">optional&lt;/span> &lt;span class="n">encryption&lt;/span> &lt;span class="n">header&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">?&lt;/span> &lt;span class="n">bytes&lt;/span> &lt;span class="n">compressed&lt;/span> &lt;span class="n">data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">4&lt;/span> &lt;span class="n">bytes&lt;/span> &lt;span class="n">crc32&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">4&lt;/span> &lt;span class="n">bytes&lt;/span> &lt;span class="n">uncompressed&lt;/span> &lt;span class="n">input&lt;/span> &lt;span class="n">size&lt;/span> &lt;span class="n">modulo&lt;/span> &lt;span class="m">2&lt;/span>&lt;span class="n">^32&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>也就是说 gzip 也是使用 deflation 算法进行数据的压缩，只是存储格式和不一样，另外 gzip 只能处理当个文件，然 zip 格式则可以处理目录。综上：&lt;/p>
&lt;p>1，zlib 提供一系列函数库，可以采用 deflation 算法对数据进行压缩，还提供 ZLIB DATA FORMAT 的跨平台的数据格式。
2，gzip 是一个采用 deflation 算法处理文件的工具，提供比较小的头部和尾部信息，只支持处理单个文件。
3，zip 的压缩算法也是采用 deflation，它能够处理多个文件或者目录。
4，HTTP 协议中的传输编码 deflate，传输的数据不是经过 deflation 压缩的数据，而是 zlib 格式的数据，即在压缩的基础上，增加 zlib 头和尾数据。&lt;/p></description></item></channel></rss>