<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="布隆过滤器 布隆过滤器 (Bloom Filter)是由 Burton Howard Bloom 于 1970 年提出，它是一种 space efficient 的概率型数据结构，它利用位数组很简洁地表示一个集合，用于判断一个元素是否在集合中。在垃圾邮件过滤的黑白名单方法、爬虫(Crawle"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/algorithm-series/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%93%88%E5%B8%8C%E8%A1%A8/%E8%BF%87%E6%BB%A4%E5%99%A8/bloomfilter/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/algorithm-series/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%93%88%E5%B8%8C%E8%A1%A8/%E8%BF%87%E6%BB%A4%E5%99%A8/bloomfilter/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/algorithm-series/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%93%88%E5%B8%8C%E8%A1%A8/%E8%BF%87%E6%BB%A4%E5%99%A8/bloomfilter/"><meta property="og:title" content="BloomFilter | Next-gen Tech Edu"><meta property="og:description" content="布隆过滤器 布隆过滤器 (Bloom Filter)是由 Burton Howard Bloom 于 1970 年提出，它是一种 space efficient 的概率型数据结构，它利用位数组很简洁地表示一个集合，用于判断一个元素是否在集合中。在垃圾邮件过滤的黑白名单方法、爬虫(Crawle"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>BloomFilter | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=a752a22828cb60f61bf9b0c849695693><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">过滤器</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id6f32b7d0d610da724f0b01f4b36c4478")' href=#id6f32b7d0d610da724f0b01f4b36c4478 aria-expanded=false aria-controls=id6f32b7d0d610da724f0b01f4b36c4478 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/algorithm-series/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%93%88%E5%B8%8C%E8%A1%A8/>哈希表</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id6f32b7d0d610da724f0b01f4b36c4478 aria-expanded=false aria-controls=id6f32b7d0d610da724f0b01f4b36c4478><i class="fa-solid fa-angle-down" id=caret-id6f32b7d0d610da724f0b01f4b36c4478></i></a></div><ul class="nav docs-sidenav collapse show" id=id6f32b7d0d610da724f0b01f4b36c4478><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idb757052a237654d9a4b680ff1122f5f2")' href=#idb757052a237654d9a4b680ff1122f5f2 aria-expanded=false aria-controls=idb757052a237654d9a4b680ff1122f5f2 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/algorithm-series/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%93%88%E5%B8%8C%E8%A1%A8/%E8%BF%87%E6%BB%A4%E5%99%A8/>过滤器</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idb757052a237654d9a4b680ff1122f5f2 aria-expanded=false aria-controls=idb757052a237654d9a4b680ff1122f5f2><i class="fa-solid fa-angle-down" id=caret-idb757052a237654d9a4b680ff1122f5f2></i></a></div><ul class="nav docs-sidenav collapse show" id=idb757052a237654d9a4b680ff1122f5f2><li class="child level active"><a href=/books/algorithm-series/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%93%88%E5%B8%8C%E8%A1%A8/%E8%BF%87%E6%BB%A4%E5%99%A8/bloomfilter/>BloomFilter</a></li><li class="child level"><a href=/books/algorithm-series/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%93%88%E5%B8%8C%E8%A1%A8/%E8%BF%87%E6%BB%A4%E5%99%A8/cuckoofilter/>CuckooFilter</a></li><li class="child level"><a href=/books/algorithm-series/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%93%88%E5%B8%8C%E8%A1%A8/%E8%BF%87%E6%BB%A4%E5%99%A8/surf/>SuRF</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id8a8bb8fed31a05599036e885223e1ad0")' href=#id8a8bb8fed31a05599036e885223e1ad0 aria-expanded=false aria-controls=id8a8bb8fed31a05599036e885223e1ad0 aria-hidden=false data-toggle=collapse></div></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idffa24c462e86194332785818990aceec")' href=#idffa24c462e86194332785818990aceec aria-expanded=false aria-controls=idffa24c462e86194332785818990aceec aria-hidden=false data-toggle=collapse></div></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><ul><li><a href=#时间与空间优势>时间与空间优势</a></li><li><a href=#误判概率的证明与计算>误判概率的证明与计算</a></li><li><a href=#布隆过滤器的设计>布隆过滤器的设计</a></li></ul></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>BloomFilter</h1><div class=article-style><h1 id=布隆过滤器>布隆过滤器</h1><p>布隆过滤器 (Bloom Filter)是由 Burton Howard Bloom 于 1970 年提出，它是一种 space efficient 的概率型数据结构，它利用位数组很简洁地表示一个集合，用于判断一个元素是否在集合中。在垃圾邮件过滤的黑白名单方法、爬虫(Crawler)的网址判重模块中等等经常被用到。哈希表也能用于判断元素是否在集合中，但是布隆过滤器只需要哈希表的 1/8 或 1/4 的空间复杂度就能完成同样的问题。布隆过滤器可以插入元素，但不可以删除已有元素。其中的元素越多，false positive rate(误报率)越大，但是 false negative (漏报)是不可能的。</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://tva1.sinaimg.cn/large/007DFXDhgy1g4bde2br10j30ge06uweq.jpg alt loading=lazy data-zoomable></div></div></figure></p><h1 id=算法描述>算法描述</h1><p>一个 empty bloom filter 是一个有 m bits 的 bit array，每一个 bit 位都初始化为 0。并且定义有 k 个不同的 hash function，每个都以 uniform random distribution 将元素 hash 到 m 个不同位置中的一个。在下面的介绍中 n 为元素数，m 为布隆过滤器或哈希表的 slot 数，k 为布隆过滤器重 hash function 数。</p><p>为了 add 一个元素，用 k 个 hash function 将它 hash 得到 bloom filter 中 k 个 bit 位，将这 k 个 bit 位置 1。</p><p>为了 query 一个元素，即判断它是否在集合中，用 k 个 hash function 将它 hash 得到 k 个 bit 位。若这 k bits 全为 1，则此元素在集合中；若其中任一位不为 1，则此元素比不在集合中(因为如果在，则在 add 时已经把对应的 k 个 bits 位置为 1)。</p><p>不允许 remove 元素，因为那样的话会把相应的 k 个 bits 位置为 0，而其中很有可能有其他元素对应的位。因此 remove 会引入 false negative，这是绝对不被允许的。</p><p>当 k 很大时，设计 k 个独立的 hash function 是不现实并且困难的。对于一个输出范围很大的 hash function(例如 MD5 产生的 128 bits 数)，如果不同 bit 位的相关性很小，则可把此输出分割为 k 份。或者可将 k 个不同的初始值(例如 0,1,2, … ,k-1)结合元素，feed 给一个 hash function 从而产生 k 个不同的数。</p><p>当 add 的元素过多时，即 n/m 过大时(n 是元素数，m 是 bloom filter 的 bits 数)，会导致 false positive 过高，此时就需要重新组建 filter，但这种情况相对少见。</p><h3 id=时间与空间优势>时间与空间优势</h3><p>当可以承受一些误报时，布隆过滤器比其它表示集合的数据结构有着很大的空间优势。例如 self-balance BST, tries, hash table 或者 array, chain，它们中大多数至少都要存储元素本身，对于小整数需要少量的 bits，对于字符串则需要任意多的 bits(tries 是个例外，因为对于有相同 prefixes 的元素可以共享存储空间)；而 chain 结构还需要为存储指针付出额外的代价。对于一个有 1%误报率和一个最优 k 值的布隆过滤器来说，无论元素的类型及大小，每个元素只需要 9.6 bits 来存储。这个优点一部分继承自 array 的紧凑性，一部分来源于它的概率性。如果你认为 1%的误报率太高，那么对每个元素每增加 4.8 bits，我们就可将误报率降低为原来的 1/10。add 和 query 的时间复杂度都为 O(k)，与集合中元素的多少无关，这是其他数据结构都不能完成的。</p><p>如果可能元素范围不是很大，并且大多数都在集合中，则使用确定性的 bit array 远远胜过使用布隆过滤器。因为 bit array 对于每个可能的元素空间上只需要 1 bit，add 和 query 的时间复杂度只有 O(1)。注意到这样一个哈希表(bit array)只有在忽略 collision 并且只存储元素是否在其中的二进制信息时，才会获得空间和时间上的优势，而在此情况下，它就有效地称为了 k=1 的布隆过滤器。</p><p>而当考虑到 collision 时，对于有 m 个 slot 的 bit array 或者其他哈希表(即 k=1 的布隆过滤器)，如果想要保证 1%的误判率，则这个 bit array 只能存储 m/100 个元素，因而有大量的空间被浪费，同时也会使得空间复杂度急剧上升，这显然不是 space efficient 的。解决的方法很简单，使用 k>1 的布隆过滤器，即 k 个 hash function 将每个元素改为对应于 k 个 bits，因为误判度会降低很多，并且如果参数 k 和 m 选取得好，一半的 m 可被置为为 1，这充分说明了布隆过滤器的 space efficient 性。</p><p>以垃圾邮件过滤中黑白名单为例：现有 1 亿个 email 的黑名单，每个都拥有 8 bytes 的指纹信息，则可能的元素范围为 <a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162318572980.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162318584027.png alt=clip_image00 loading=lazy data-zoomable></div></div></figure></a>，对于 bit array 来说是根本不可能的范围，而且元素的数量(即 email 列表)为 <a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162318586502.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162318585390.png alt=clip_image002[] loading=lazy data-zoomable></div></div></figure></a>，相比于元素范围过于稀疏，而且还没有考虑到哈希表中的 collision 问题。</p><p>若采用哈希表，由于大多数采用 open addressing 来解决 collision，而此时的 search 时间复杂度为：</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162318587865.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162318595880.png alt=clip_image002[] loading=lazy data-zoomable></div></div></figure></a></p><p>即若哈希表半满(n/m = 1/2)，则每次 search 需要 probe 2 次，因此在保证效率的情况下哈希表的存储效率最好不超过 50%。此时每个元素占 8 bytes，总空间为：</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162318595847.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162318599402.png alt=clip_image002[1] loading=lazy data-zoomable></div></div></figure></a></p><p>若采用 Perfect hashing(这里可以采用 Perfect hashing 是因为主要操作是 search/query，而并不是 add 和 remove)，虽然保证 worst-case 也只有一次 probe，但是空间利用率更低，一般情况下为 50%，worst-case 时有不到一半的概率为 25%。</p><p>若采用布隆过滤器，取 k=8。因为 n 为 1 亿，所以总共需要 <a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162318598289.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/20110216231900208.png alt=clip_image002[1] loading=lazy data-zoomable></div></div></figure></a>被置位为 1，又因为在保证误判率低且 k 和 m 选取合适时，空间利用率为 50%(后面会解释)，所以总空间为：</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319009303.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319003174.png alt=clip_image002[1] loading=lazy data-zoomable></div></div></figure></a></p><p>所需空间比上述哈希结构小得多，并且误判率在万分之一以下。</p><h3 id=误判概率的证明与计算>误判概率的证明与计算</h3><p>假设布隆过滤器中的 hash function 满足 simple uniform hashing 假设：每个元素都等概率地 hash 到 m 个 slot 中的任何一个，与其它元素被 hash 到哪个 slot 无关。若 m 为 bit 数，则对某一特定 bit 位在一个元素由某特定 hash function 插入时没有被置位为 1 的概率为：</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319012061.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319014536.png alt=clip_image002[1] loading=lazy data-zoomable></div></div></figure></a></p><p>则 k 个 hash function 中没有一个对其置位的概率为：</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319017011.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319024470.png alt=clip_image002[1] loading=lazy data-zoomable></div></div></figure></a></p><p>如果插入了 n 个元素，但都未将其置位的概率为：</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319026945.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319021057.png alt=clip_image002[2] loading=lazy data-zoomable></div></div></figure></a></p><p>则此位被置位的概率为：</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319023532.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319026007.png alt=clip_image002[2] loading=lazy data-zoomable></div></div></figure></a></p><p>现在考虑 query 阶段，若对应某个待 query 元素的 k bits 全部置位为 1，则可判定其在集合中。因此将某元素误判的概率为：</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319038482.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319039321.png alt=clip_image002[2] loading=lazy data-zoomable></div></div></figure></a></p><p>由于 <a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319031797.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319043367.png alt=clip_image002[2] loading=lazy data-zoomable></div></div></figure></a>，并且<a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319041698.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319045809.png alt=clip_image002[2] loading=lazy data-zoomable></div></div></figure></a>当 m 很大时趋近于 0，所以</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319059680.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319058775.png alt=clip_image002[3] loading=lazy data-zoomable></div></div></figure></a></p><p>从上式中可以看出，当 m 增大或 n 减小时，都会使得误判率减小，这也符合直觉。</p><p>现在计算对于给定的 m 和 n，k 为何值时可以使得误判率最低。设误判率为 k 的函数为：</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319059614.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319062089.png alt=clip_image002[3] loading=lazy data-zoomable></div></div></figure></a></p><p>设 <a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319068991.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319061466.png alt=clip_image002[3] loading=lazy data-zoomable></div></div></figure></a>，则简化为</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319073942.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319075.png alt=clip_image002[3] loading=lazy data-zoomable></div></div></figure></a>，两边取对数</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319072480.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319071367.png alt=clip_image002[3] loading=lazy data-zoomable></div></div></figure></a>, 两边对 k 求导</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319082414.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319087921.png alt=clip_image002[4] loading=lazy data-zoomable></div></div></figure></a></p><p>下面求最值</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319083428.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319093395.png alt=clip_image002[4] loading=lazy data-zoomable></div></div></figure></a></p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319092282.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319091169.png alt=clip_image002[4] loading=lazy data-zoomable></div></div></figure></a><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319097233.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319103296.png alt=clip_image00 loading=lazy data-zoomable></div></div></figure></a></p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319102183.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319101070.png alt=clip_image002[4] loading=lazy data-zoomable></div></div></figure></a><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319109085.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319111004.png alt=clip_image00 loading=lazy data-zoomable></div></div></figure></a></p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319115116.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319117591.png alt=clip_image002[4] loading=lazy data-zoomable></div></div></figure></a><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/2011021623191166.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319122541.png alt=clip_image00 loading=lazy data-zoomable></div></div></figure></a></p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319121429.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319127492.png alt=clip_image002[4] loading=lazy data-zoomable></div></div></figure></a><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319128331.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319134918.png alt=clip_image01 loading=lazy data-zoomable></div></div></figure></a></p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319133805.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319136280.png alt=clip_image002[4] loading=lazy data-zoomable></div></div></figure></a><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319132343.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319143182.png alt=clip_image01 loading=lazy data-zoomable></div></div></figure></a></p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319144785.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319143673.png alt=clip_image002[4] loading=lazy data-zoomable></div></div></figure></a><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319151688.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319158067.png alt=clip_image01 loading=lazy data-zoomable></div></div></figure></a></p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319158034.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319159637.png alt=clip_image002[4] loading=lazy data-zoomable></div></div></figure></a><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/20110216231916476.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319164554.png alt=clip_image002[5] loading=lazy data-zoomable></div></div></figure></a></p><p>因此，即当 <a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319177553.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319171980.png alt=clip_image002[5] loading=lazy data-zoomable></div></div></figure></a>时误判率最低，此时误判率为：</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319179439.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319184946.png alt=clip_image002[5] loading=lazy data-zoomable></div></div></figure></a></p><p>可以看出若要使得误判率 ≤1/2，则：</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319187421.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319181848.png alt=clip_image002[5] loading=lazy data-zoomable></div></div></figure></a></p><p>这说明了若想保持某固定误判率不变，布隆过滤器的 bit 数 m 与被 add 的元素数 n 应该是线性同步增加的。</p><h3 id=布隆过滤器的设计>布隆过滤器的设计</h3><p>应用时首先要先由用户决定要 add 的元素数 n 和希望的误差率 P。这也是一个设计完整的布隆过滤器需要用户输入的仅有的两个参数，之后的所有参数将由系统计算，并由此建立布隆过滤器。</p><p>系统首先要计算需要的内存大小 m bits:</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319183767.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319199274.png alt=clip_image002[6] loading=lazy data-zoomable></div></div></figure></a></p><p>再由 m，n 得到 hash function 的个数：</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319197289.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319207779.png alt=clip_image002[5] loading=lazy data-zoomable></div></div></figure></a></p><p>至此系统所需的参数已经备齐，接下来 add n 个元素至布隆过滤器中，再进行 query。</p><p>根据公式，当 k 最优时：</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319209142.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319219076.png alt=clip_image002[6] loading=lazy data-zoomable></div></div></figure></a></p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319219566.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319227515.png alt=clip_image004[] loading=lazy data-zoomable></div></div></figure></a></p><p>因此可验证当 P=1%时，存储每个元素需要 9.6 bits：</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319231320.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319233238.png alt=clip_image002[7] loading=lazy data-zoomable></div></div></figure></a></p><p>而每当想将误判率降低为原来的 1/10，则存储每个元素需要增加 4.8 bits：</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319248745.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319248156.png alt=clip_image002[7] loading=lazy data-zoomable></div></div></figure></a></p><p>这里需要特别注意的是，9.6 bits/element 不仅包含了被置为 1 的 k 位，还把包含了没有被置为 1 的一些位数。此时的</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319257251.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319257533.png alt=clip_image002[7] loading=lazy data-zoomable></div></div></figure></a></p><p>才是每个元素对应的为 1 的 bit 位数。</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319253597.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319256072.png alt=clip_image002[7] loading=lazy data-zoomable></div></div></figure></a>从而使得 P(error)最小时，我们注意到：</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/20110216231926499.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319266562.png alt=clip_image002[7] loading=lazy data-zoomable></div></div></figure></a>中的 <a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319269038.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319269877.png alt=clip_image002[8] loading=lazy data-zoomable></div></div></figure></a>，即</p><p><a href=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319275940.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/allensun/201102/201102162319272003.png alt=clip_image002[8] loading=lazy data-zoomable></div></div></figure></a></p><p>此概率为某 bit 位在插入 n 个元素后未被置位的概率。因此，想保持错误率低，布隆过滤器的空间使用率需为 50%。</p></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>下一页</div><a href=/books/algorithm-series/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/%E5%93%88%E5%B8%8C%E8%A1%A8/%E8%BF%87%E6%BB%A4%E5%99%A8/cuckoofilter/ rel=prev>CuckooFilter</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>