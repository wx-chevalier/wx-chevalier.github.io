<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="View（视图） 视图的示例如下： 从而我们不难发现，使用视图将会得到如下好处: 视图隐藏了底层的表结构，简化了数据访问操作。 因为隐藏了底层的表结构，所以大大加强了安全性，用户只能看到视图提供的数据。 使用视"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/%E8%A7%86%E5%9B%BE/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/%E8%A7%86%E5%9B%BE/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/%E8%A7%86%E5%9B%BE/"><meta property="og:title" content="视图 | Next-gen Tech Edu"><meta property="og:description" content="View（视图） 视图的示例如下： 从而我们不难发现，使用视图将会得到如下好处: 视图隐藏了底层的表结构，简化了数据访问操作。 因为隐藏了底层的表结构，所以大大加强了安全性，用户只能看到视图提供的数据。 使用视"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>视图 | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=f05c4b0bae4a4988e106fb6bfad06ed9><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">数据查询</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id7a6c9187d27b08400d47fd756a0e53af")' href=#id7a6c9187d27b08400d47fd756a0e53af aria-expanded=false aria-controls=id7a6c9187d27b08400d47fd756a0e53af aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/mysql-series/1.sql/>1.SQL</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id7a6c9187d27b08400d47fd756a0e53af aria-expanded=false aria-controls=id7a6c9187d27b08400d47fd756a0e53af><i class="fa-solid fa-angle-down" id=caret-id7a6c9187d27b08400d47fd756a0e53af></i></a></div><ul class="nav docs-sidenav collapse show" id=id7a6c9187d27b08400d47fd756a0e53af><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id3c6cc803c0280773078ea68605728370")' href=#id3c6cc803c0280773078ea68605728370 aria-expanded=false aria-controls=id3c6cc803c0280773078ea68605728370 aria-hidden=false data-toggle=collapse></div></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id4662c7c281378b3eb61c4f694fb7b293")' href=#id4662c7c281378b3eb61c4f694fb7b293 aria-expanded=false aria-controls=id4662c7c281378b3eb61c4f694fb7b293 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/>数据操作</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id4662c7c281378b3eb61c4f694fb7b293 aria-expanded=false aria-controls=id4662c7c281378b3eb61c4f694fb7b293><i class="fa-solid fa-angle-right" id=caret-id4662c7c281378b3eb61c4f694fb7b293></i></a></div><ul class="nav docs-sidenav collapse" id=id4662c7c281378b3eb61c4f694fb7b293><li class="child level"><a href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/odps/>ODPS</a></li><li class="child level"><a href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5/>数据插入</a></li><li class="child level"><a href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0/>数据更新</a></li><li class="child level"><a href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%96%E9%94%AE/>数据库外键</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id23334d575d77901d2f638408df58bd53")' href=#id23334d575d77901d2f638408df58bd53 aria-expanded=false aria-controls=id23334d575d77901d2f638408df58bd53 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/>数据查询</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id23334d575d77901d2f638408df58bd53 aria-expanded=false aria-controls=id23334d575d77901d2f638408df58bd53><i class="fa-solid fa-angle-down" id=caret-id23334d575d77901d2f638408df58bd53></i></a></div><ul class="nav docs-sidenav collapse show" id=id23334d575d77901d2f638408df58bd53><li class="child level"><a href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2/>分页查询</a></li><li class="child level"><a href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/%E8%81%94%E6%8E%A5%E6%9F%A5%E8%AF%A2/>联接查询</a></li><li class="child level active"><a href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/%E8%A7%86%E5%9B%BE/>视图</a></li><li class="child level"><a href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2/>条件查询</a></li><li class="child level"><a href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/%E7%BB%9F%E8%AE%A1%E4%B8%8E%E8%81%9A%E5%90%88/>统计与聚合</a></li><li class="child level"><a href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/%E5%AD%90%E6%9F%A5%E8%AF%A2/>子查询</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id698643a520d05813143e88aa9a28d60c")' href=#id698643a520d05813143e88aa9a28d60c aria-expanded=false aria-controls=id698643a520d05813143e88aa9a28d60c aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/>数据库设计</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id698643a520d05813143e88aa9a28d60c aria-expanded=false aria-controls=id698643a520d05813143e88aa9a28d60c><i class="fa-solid fa-angle-right" id=caret-id698643a520d05813143e88aa9a28d60c></i></a></div><ul class="nav docs-sidenav collapse" id=id698643a520d05813143e88aa9a28d60c><li class="child level"><a href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/%E8%AE%BE%E8%AE%A1%E8%A7%84%E7%BA%A6/>设计规约</a></li><li class="child level"><a href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1/>数据建模</a></li><li class="child level"><a href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%8C%83%E5%BC%8F/>数据库范式</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idfa67dcb8b44dc2b0e4499875c59c6d44")' href=#idfa67dcb8b44dc2b0e4499875c59c6d44 aria-expanded=false aria-controls=idfa67dcb8b44dc2b0e4499875c59c6d44 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/>数据类型</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idfa67dcb8b44dc2b0e4499875c59c6d44 aria-expanded=false aria-controls=idfa67dcb8b44dc2b0e4499875c59c6d44><i class="fa-solid fa-angle-right" id=caret-idfa67dcb8b44dc2b0e4499875c59c6d44></i></a></div><ul class="nav docs-sidenav collapse" id=idfa67dcb8b44dc2b0e4499875c59c6d44><li class="child level"><a href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/%E6%97%B6%E9%97%B4%E4%B8%8E%E6%97%A5%E6%9C%9F/>时间与日期</a></li><li class="child level"><a href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/%E6%95%B0%E5%80%BC%E7%B1%BB%E5%9E%8B/>数值类型</a></li><li class="child level"><a href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/%E5%AD%97%E7%AC%A6%E4%B8%B2/>字符串</a></li></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#视图view中的几个小技巧>视图(View)中的几个小技巧</a></li><li><a href=#视图view的最佳实践>视图(View)的最佳实践</a></li></ul><ul><li><a href=#sql-create-view-实例>SQL CREATE VIEW 实例</a></li><li><a href=#sql-更新视图>SQL 更新视图</a></li><li><a href=#sql-撤销视图>SQL 撤销视图</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>视图</h1><div class=article-style><h1 id=view视图>View（视图）</h1><p>视图的示例如下：</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/CareySon/201112/20111207143310700.png alt loading=lazy data-zoomable></div></div></figure></p><p>从而我们不难发现，使用视图将会得到如下好处:</p><ul><li>视图隐藏了底层的表结构，简化了数据访问操作。</li><li>因为隐藏了底层的表结构，所以大大加强了安全性，用户只能看到视图提供的数据。</li><li>使用视图，方便了权限管理，让用户对视图有权限而不是对底层表有权限进一步加强了安全性。</li><li>视图提供了一个用户访问的接口，当底层表改变后，改变视图的语句来进行适应，使已经建立在这个视图上客户端程序不受影响。</li></ul><h1 id=普通视图rugular-view>普通视图(Rugular View)</h1><p>普通视图由一个 Select 语句所定义，视图仅仅包含其定义和被引用表的 metadata.并不实际存储数据。MSDN 中创建视图的模版如下:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>VIEW</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=k>schema_name</span><span class=w> </span><span class=p>.</span><span class=w> </span><span class=p>]</span><span class=w> </span><span class=n>view_name</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=p>(</span><span class=k>column</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=p>,...</span><span class=n>n</span><span class=w> </span><span class=p>]</span><span class=w> </span><span class=p>)</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>[</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=o>&lt;</span><span class=n>view_attribute</span><span class=o>&gt;</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=p>,...</span><span class=n>n</span><span class=w> </span><span class=p>]</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AS</span><span class=w> </span><span class=n>select_statement</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>[</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=k>CHECK</span><span class=w> </span><span class=k>OPTION</span><span class=w> </span><span class=p>]</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=p>;</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&lt;</span><span class=n>view_attribute</span><span class=o>&gt;</span><span class=w> </span><span class=p>::</span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=w> </span><span class=n>ENCRYPTION</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=w> </span><span class=n>SCHEMABINDING</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>[</span><span class=w> </span><span class=n>VIEW_METADATA</span><span class=w> </span><span class=p>]</span><span class=w>     </span><span class=err>}</span><span class=w>
</span></span></span></code></pre></div><p>参数还是比较少的，现在解释一下上面的参数：</p><ul><li><p>ENCRYPTION：视图是加密的，如果选上这个选项，则无法修改.创建视图的时候需要将脚本保存，否则再也不能修改了</p></li><li><p>SCHEMABINDING：和底层引用到的表进行定义绑定。这个选项选上的话，则视图所引用到的表不能随便更改构架(比如列的数据类型)，如果需要更改底层表构架，则先 drop 或者 alter 在底层表之上绑定的视图.</p></li><li><p>VIEW_METADATA：这个是个很有意思的选项.正如这个选项的名称所指示，如果不选择，返回给客户端的 metadata 是 View 所引用表的 metadata,如果选择了这个选项，则返回 View 的 metadata.再通俗点解释，VIEW_METADATA 可以让视图看起来貌似表一样。View 的每一个列的定义等直接告诉客户端，而不是所引用底层表列的定义。</p></li><li><p>WITH Check Option：这个选项用于更新数据做限制，下面会在通过视图更新数据一节解释.</p></li></ul><p>当然了，创建视图除了需要符合上面的语法规则之外，还有一些规则需要遵守：</p><ul><li>在 View 中，除非有 TOP 关键字，否则不能用 Order By 子句(如果你一意孤行要用 Order by,这里有个 hack 是使用 Top 100 percent…..)</li><li>View 在每个 Schema 中命名必须独一无二</li><li>View 嵌套不能超过 32 层(其实实际工作中谁嵌套超过两层就要被打 PP 了-.-)</li><li>Compute,compute by,INTO 关键字不允许出现在 View 中</li><li>View 不能建立在临时表上</li><li>View 不能对全文索引进行查询</li></ul><p>建立 View 一个简单的例子:</p><pre tabindex=0><code>CREATE VIEW v_Test_View1
AS
SELECT TOP 100 * FROM HumanResources.Employee
</code></pre><p>视图建立完成后，就可以像访问表一样访问视图了:</p><pre tabindex=0><code>SELECT * FROM v_Test_View1
</code></pre><p>在 Management studio 中，我创建视图的时候更喜欢用这样一种方法,将会便捷很多:</p><p><a href=http://images.cnblogs.com/cnblogs_com/CareySon/201112/201112071433395166.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/CareySon/201112/201112071507444808.png alt loading=lazy data-zoomable></div></div></figure></a></p><p><a href=http://images.cnblogs.com/cnblogs_com/CareySon/201112/201112071613149005.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/CareySon/201112/201112071614165892.png alt loading=lazy data-zoomable></div></div></figure></a></p><h1 id=索引视图indexed-view>索引视图(Indexed View)</h1><p>在谈到索引视图之前，我突然想起以前看过的一个漫画.话说咱们高端产品买不起，但是省吃俭用攒点钱买个 IPhone 装装高端总还是可以的吧:</p><p><a href=http://images.cnblogs.com/cnblogs_com/CareySon/201112/201112071614213912.jpg target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/CareySon/201112/201112071614349933.jpg alt loading=lazy data-zoomable></div></div></figure></a></p><p>其实索引视图也很类似，在普通的视图的基础上，为视图建立唯一聚集索引，这时这个视图就变成了索引视图.套用上面漫画的公式:视图+聚集索引=索引视图</p><p>索引视图可以看作是一个和表(Table)等效的对象！</p><p>SQL Server 中的索引视图和 Oracle 中的 Materialized View 是一个概念.想要理解索引视图，必须先理解聚集索引。聚集索引简单来说理解成主键，数据库中中的数据按照主键的顺序物理存储在表中，就像新华字典，默认是按照 ABCD….这样的方式进行内容设置。ABCD….就相当于主键.这样就避免了整表扫描从而提高了性能.因此一个表中只能有一个聚集索引。</p><p>对于索引视图也是，为一个视图加上了聚集索引后。视图就不仅仅再是 select 语句和表的 metadata 了，索引视图会将数据物理存在数据库中，索引视图所存的数据和索引视图中所涉及的底层表保持同步。</p><p>理解了索引视图的原理之后，我们可以看出，索引视图对于 OLAP 这种大量数据分析和查询来说，性能将会得到大幅提升。尤其是索引视图中有聚合函数，涉及大量高成本的 JOIN,因为聚合函数计算的结果物理存入索引视图，所以当面对大量数据使用到了索引视图之后，并不必要每次都进行聚合运算，这无疑会大大提升性能.</p><p>而同时，每次索引视图所涉及的表进行 Update,Insert,Delete 操作之后，SQL Server 都需要标识出改变的行，让索引视图进行数据同步.所以 OLTP 这类增删改很多的业务，数据库需要做大量的同步操作，这会降低性能。</p><p>谈完了索引视图的基本原理和好处与坏处之后，来看看在 SQL Server 中的实现:</p><p>在 SQL Server 中实现索引视图是一件非常，简单的事，只需要在现有的视图上加上唯一聚集索引.但 SQL Server 对于索引视图的限制却使很多 DBA 对其并不青睐:</p><p>比如:</p><ul><li>索引视图涉及的基本表必须 ANSI_NULLS 设置为 ON</li><li>索引视图必须设置 ANSI_NULLS 和 QUOTED_INDETIFIER 为 ON</li><li>索引视图只能引用基本表</li><li>SCHEMABINDING 必须设置</li><li>定义索引视图时必须使用 Schema.ViewName 这样的全名</li><li>索引视图中不能有子查询</li><li>avg,max,min,stdev,stdevp,var,varp 这些聚合函数不能用</li></ul><h1 id=分割视图partitioned-view>分割视图(Partitioned View)</h1><p>分割视图其实从微观实现方式来说，整个视图所返回的数据由几个平行表(既是几个表有相同的表结构，也就是列和数据类型，但存储的行集合不同)进行 UNION 连接所获得的数据集.</p><p>分割视图总体上可以分为两种:</p><p>1.本地分割视图(Local Partitioned View)</p><p>2.分布式分割视图(Distributed Partitioned View)</p><p>因为本地分割视图仅仅是为了和 SQL Server 2005 之前的版本的一种向后兼容，所以这里仅仅对分布式分割视图进行说明.</p><p>分布式分割视图其实是将由几个由不同数据源或是相同数据源获得的平行数据集进行连接所获得的，一个简单的概念图如下:</p><p><a href=http://images.cnblogs.com/cnblogs_com/CareySon/201112/201112071618318550.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/CareySon/201112/201112071630206021.png alt loading=lazy data-zoomable></div></div></figure></a></p><p>上面的视图所获得的数据分别来自三个不同数据源的表，每一个表中只包含四行数据，最终组成了这个分割视图.</p><p>使用分布式分割视图最大的好处就是提升性能.比如上面的例子中，我仅仅想取得 ContactID 为 8 这位员工的信息，如果通过分布式视图获取的话，SQL Server 可以非常智能的仅仅扫描包含 ContactID 为 8 的表 2，从而避免了整表扫描。这大大减少了 IO 操作，从而提升了性能.</p><p>这里要注意的是，分布式分割视图所涉及的表之间的主键不能重复，比如上面的表 A ContactID 是 1-4,则表 B 的 ContactID 不能是 2-8 这个样子.</p><p>还有一点要注意的是，一定要为分布式分割索引的主键加 Check 约束，从而让 SQL Server 的查询分析器知道该去扫描哪个表,下面来看个例子.</p><p>在微软示例数据库 AdventureWorks 数据库，我通过 ContactID 从前 100 行和 100-200 行的数据分别存入两个表，Employee100 和 Employee200,代码如下:</p><pre tabindex=0><code>--create Employee100
SELECT TOP 100 * INTO Employee100
FROM HumanResources.Employee
ORDER BY EmployeeID
--create Employee200
SELECT *  INTO Employee200
FROM
(SELECT TOP 100 *
FROM HumanResources.Employee
WHERE EmployeeID NOT IN (SELECT TOP 100 EmployeeID FROM HumanResources.Employee ORDER BY EmployeeID)
ORDER BY HumanResources.Employee.EmployeeID)AS e
</code></pre><p>这时来建立分布式分割视图:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>VIEW</span><span class=w> </span><span class=n>v_part_view_test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>Employee100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>UNION</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>Employee200</span><span class=w>
</span></span></span></code></pre></div><p>这时我们对这个索引进行查询操作:</p><pre tabindex=0><code>SELECT * FROM v_part_view_test
WHERE EmployeeID=105
</code></pre><p>下面是执行计划:</p><p><a href=http://images.cnblogs.com/cnblogs_com/CareySon/201112/201112071630362372.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/CareySon/201112/201112071630446578.png alt loading=lazy data-zoomable></div></div></figure></a></p><p>通过上图可以看出，通过这种分割的方式，执行计划仅仅是扫描 Employee200,从而避免了扫描所有数据，这无疑提升了性能.</p><p>所以，当你将不同的数据表之间放到不同的服务器或是使用 RAID5 磁盘阵列时，分布式分割视图则进一步会提升查询性能.</p><p>使用分布式分割视图能够在所有情况下都提升性能吗？那妥妥的不可能.使用这种方式如果面对的查询包含了聚合函数，尤其是聚合函数中还包含 distinct。或是不加 where 条件进行排序.那绝对是性能的杀手。因为聚合函数需要扫描分布式分割视图中所有的表，然后进行 UNION 操作后再进行运算.</p><h1 id=通过视图view更新数据>通过视图(View)更新数据</h1><p>通过视图更新数据是我所不推荐的.因为视图并不能接受参数.我更推荐使用存储过程来实现.</p><p>使用 View 更新数据和更新 Table 中数据的方式完全一样(前面说过，View 可以看作是一个虚拟表,如果是索引视图则是具体的一张表)</p><p>通过视图来更新数据需要注意以下几点</p><p>1.视图中 From 子句之后至少有一个用户表</p><p>2.View 的查询无论涉及多少张表，一次只能更新其中一个表的数据</p><p>3.对于表达式计算出来的列，常量列，聚合函数算出来的列无法更新</p><p>4.Group By,Having,Distinct 关键字不能影响到的列不能更新</p><p>这里说一下创建 View 有一个 WITH Check Option 选项，如果选择这个选项，则通过 View 所更新的数据必须符合 View 中 where 子句所限定的条件,比如:</p><p>我创建一个 View:</p><p><a href=http://images.cnblogs.com/cnblogs_com/CareySon/201112/201112071630577965.png target=_blank rel=noopener><figure><div class="d-flex justify-content-center"><div class=w-100><img src=http://images.cnblogs.com/cnblogs_com/CareySon/201112/20111207163150547.png alt loading=lazy data-zoomable></div></div></figure></a></p><h2 id=视图view中的几个小技巧>视图(View)中的几个小技巧</h2><p>1.通过视图名称查到视图的定义</p><pre tabindex=0><code>SELECT * FROM sys.sql_modules
WHERE object_id=OBJECT_ID(&#39;视图名称&#39;)
</code></pre><p>2.前面说过，普通视图仅仅存储的是 select 语句和所引用表的 metadata，当底层表数据改变时，有时候视图中表的 metadata 并没有及时同步，可以通过如下代码进行手动同步</p><pre tabindex=0><code>EXEC sp_refreshview 视图名称
</code></pre><h2 id=视图view的最佳实践>视图(View)的最佳实践</h2><p>这是我个人一些经验，欢迎补充</p><ul><li>一定要将 View 中的 Select 语句性能调到最优(貌似是废话，不过真理都是废话…)</li><li>View 最好不要嵌套，如果非要嵌套，最多只嵌套一层</li><li>能用存储过程和自定义函数替代 View 的，尽量不要使用 View，存储过程会缓存执行计划，性能更优，限制更少</li><li>在分割视图上，不要使用聚合函数，尤其是聚合函数还包含了 Distinct</li><li>在视图内，如果 Where 子句能加在视图内，不要加在视图外(因为调用视图会返回所有行，然后再筛选，性能杀手，如果你还加上了 order by…..)</li></ul><h1 id=案例>案例</h1><h2 id=sql-create-view-实例>SQL CREATE VIEW 实例</h2><p>可以从某个查询内部、某个存储过程内部，或者从另一个视图内部来使用视图。通过向视图添加函数、join 等等，我们可以向用户精确地提交我们希望提交的数据。</p><p>样本数据库 Northwind 拥有一些被默认安装的视图。视图 &ldquo;Current Product List&rdquo; 会从 Products 表列出所有正在使用的产品。这个视图使用下列 SQL 创建：</p><pre tabindex=0><code>CREATE VIEW [Current Product List] AS
SELECT ProductID,ProductName
FROM Products
WHERE Discontinued=No
</code></pre><p>我们可以查询上面这个视图：</p><pre tabindex=0><code>SELECT * FROM [Current Product List]
</code></pre><p>Northwind 样本数据库的另一个视图会选取 Products 表中所有单位价格高于平均单位价格的产品：</p><pre tabindex=0><code>CREATE VIEW [Products Above Average Price] AS
SELECT ProductName,UnitPrice
FROM Products
WHERE UnitPrice&gt;(SELECT AVG(UnitPrice) FROM Products)
</code></pre><p>我们可以像这样查询上面这个视图：</p><pre tabindex=0><code>SELECT * FROM [Products Above Average Price]
</code></pre><p>另一个来自 Northwind 数据库的视图实例会计算在 1997 年每个种类的销售总数。请注意，这个视图会从另一个名为 &ldquo;Product Sales for 1997&rdquo; 的视图那里选取数据：</p><pre tabindex=0><code>CREATE VIEW [Category Sales For 1997] AS
SELECT DISTINCT CategoryName,Sum(ProductSales) AS CategorySales
FROM [Product Sales for 1997]
GROUP BY CategoryName
</code></pre><p>我们可以像这样查询上面这个视图：</p><pre tabindex=0><code>SELECT * FROM [Category Sales For 1997]
</code></pre><p>我们也可以向查询添加条件。现在，我们仅仅需要查看 &ldquo;Beverages&rdquo; 类的全部销量：</p><pre tabindex=0><code>SELECT * FROM [Category Sales For 1997]
WHERE CategoryName=&#39;Beverages&#39;
</code></pre><h2 id=sql-更新视图>SQL 更新视图</h2><p>您可以使用下面的语法来更新视图：</p><pre tabindex=0><code>SQL CREATE OR REPLACE VIEW Syntax
CREATE OR REPLACE VIEW view_name AS
SELECT column_name(s)
FROM table_name
WHERE condition
</code></pre><p>现在，我们希望向 &ldquo;Current Product List&rdquo; 视图添加 &ldquo;Category&rdquo; 列。我们将通过下列 SQL 更新视图：</p><pre tabindex=0><code>CREATE VIEW [Current Product List] AS
SELECT ProductID,ProductName,Category
FROM Products
WHERE Discontinued=No
</code></pre><h2 id=sql-撤销视图>SQL 撤销视图</h2><p>您可以通过 DROP VIEW 命令来删除视图。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SQL</span><span class=w> </span><span class=k>DROP</span><span class=w> </span><span class=k>VIEW</span><span class=w> </span><span class=n>Syntax</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DROP</span><span class=w> </span><span class=k>VIEW</span><span class=w> </span><span class=n>view_name</span><span class=w>
</span></span></span></code></pre></div></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>上一页</div><a href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/%E8%81%94%E6%8E%A5%E6%9F%A5%E8%AF%A2/ rel=next>联接查询</a></div><div class="col-6 post-nav-item"><div class=meta-nav>下一页</div><a href=/books/mysql-series/1.sql/%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2/%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2/ rel=prev>条件查询</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>