<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="Introduction: 简介 很多开发者都会推崇 Robert C. Martin 的Clean Code一书中提及的软件工程准则，本文就是对于这些准则在 JavaScript 开发领域中的实践应用总结。本文并不仅仅是样式指南，而是对于如何编写出基于 JavaScript 实现的高可读性、高可用性以"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E7%BC%96%E7%A0%81%E8%A7%84%E7%BA%A6/clean-javascript/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E7%BC%96%E7%A0%81%E8%A7%84%E7%BA%A6/clean-javascript/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E7%BC%96%E7%A0%81%E8%A7%84%E7%BA%A6/clean-javascript/"><meta property="og:title" content="Clean JavaScript | Next-gen Tech Edu"><meta property="og:description" content="Introduction: 简介 很多开发者都会推崇 Robert C. Martin 的Clean Code一书中提及的软件工程准则，本文就是对于这些准则在 JavaScript 开发领域中的实践应用总结。本文并不仅仅是样式指南，而是对于如何编写出基于 JavaScript 实现的高可读性、高可用性以"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>Clean JavaScript | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=20eede9e2de819979428fcfe9e3b6b08><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">编码规约</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idc8f85104b187ed1a926d101eed1157dd")' href=#idc8f85104b187ed1a926d101eed1157dd aria-expanded=false aria-controls=idc8f85104b187ed1a926d101eed1157dd aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/>工程实践</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idc8f85104b187ed1a926d101eed1157dd aria-expanded=false aria-controls=idc8f85104b187ed1a926d101eed1157dd><i class="fa-solid fa-angle-down" id=caret-idc8f85104b187ed1a926d101eed1157dd></i></a></div><ul class="nav docs-sidenav collapse show" id=idc8f85104b187ed1a926d101eed1157dd><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ida775835a9dd2498ff35895ba76ffe4a3")' href=#ida775835a9dd2498ff35895ba76ffe4a3 aria-expanded=false aria-controls=ida775835a9dd2498ff35895ba76ffe4a3 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E7%BC%96%E7%A0%81%E8%A7%84%E7%BA%A6/>编码规约</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ida775835a9dd2498ff35895ba76ffe4a3 aria-expanded=false aria-controls=ida775835a9dd2498ff35895ba76ffe4a3><i class="fa-solid fa-angle-down" id=caret-ida775835a9dd2498ff35895ba76ffe4a3></i></a></div><ul class="nav docs-sidenav collapse show" id=ida775835a9dd2498ff35895ba76ffe4a3><li class="child level active"><a href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E7%BC%96%E7%A0%81%E8%A7%84%E7%BA%A6/clean-javascript/>Clean JavaScript</a></li><li class="child level"><a href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E7%BC%96%E7%A0%81%E8%A7%84%E7%BA%A6/%E6%80%A7%E8%83%BD%E8%A7%84%E7%BA%A6/>性能规约</a></li><li class="child level"><a href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E7%BC%96%E7%A0%81%E8%A7%84%E7%BA%A6/%E6%A0%B7%E5%BC%8F%E6%8C%87%E5%8D%97/>样式指南</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id504d81aec0e687242d4fd5b21578aa5c")' href=#id504d81aec0e687242d4fd5b21578aa5c aria-expanded=false aria-controls=id504d81aec0e687242d4fd5b21578aa5c aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E6%8F%92%E4%BB%B6%E7%B3%BB%E7%BB%9F/>插件系统</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id504d81aec0e687242d4fd5b21578aa5c aria-expanded=false aria-controls=id504d81aec0e687242d4fd5b21578aa5c><i class="fa-solid fa-angle-right" id=caret-id504d81aec0e687242d4fd5b21578aa5c></i></a></div><ul class="nav docs-sidenav collapse" id=id504d81aec0e687242d4fd5b21578aa5c><li class="child level"><a href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E6%8F%92%E4%BB%B6%E7%B3%BB%E7%BB%9F/%E6%8F%92%E4%BB%B6%E8%B0%83%E7%94%A8/>插件调用</a></li><li class="child level"><a href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E6%8F%92%E4%BB%B6%E7%B3%BB%E7%BB%9F/%E6%8F%92%E4%BB%B6%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%88%9D%E5%A7%8B%E5%8C%96/>插件配置与初始化</a></li><li class="child level"><a href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E6%8F%92%E4%BB%B6%E7%B3%BB%E7%BB%9F/%E5%A4%9A%E4%B8%AA%E6%8F%92%E4%BB%B6%E5%8D%8F%E4%BD%9C/>多个插件协作</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id78540beb275344be687b99a917c33e04")' href=#id78540beb275344be687b99a917c33e04 aria-expanded=false aria-controls=id78540beb275344be687b99a917c33e04 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/>动态代码执行</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id78540beb275344be687b99a917c33e04 aria-expanded=false aria-controls=id78540beb275344be687b99a917c33e04><i class="fa-solid fa-angle-right" id=caret-id78540beb275344be687b99a917c33e04></i></a></div><ul class="nav docs-sidenav collapse" id=id78540beb275344be687b99a917c33e04><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idd145c360d75d61beecfdeaa88fa39b9c")' href=#idd145c360d75d61beecfdeaa88fa39b9c aria-expanded=false aria-controls=idd145c360d75d61beecfdeaa88fa39b9c aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/>99.参考资料</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idd145c360d75d61beecfdeaa88fa39b9c aria-expanded=false aria-controls=idd145c360d75d61beecfdeaa88fa39b9c><i class="fa-solid fa-angle-right" id=caret-idd145c360d75d61beecfdeaa88fa39b9c></i></a></div><ul class="nav docs-sidenav collapse" id=idd145c360d75d61beecfdeaa88fa39b9c><li class="child level"><a href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2021-%E8%8B%8D%E7%9F%B3-%E5%9C%A8-javascript-%E4%B8%AD%E5%AE%89%E5%85%A8%E5%9C%B0%E6%89%A7%E8%A1%8C%E5%8A%A8%E6%80%81%E8%84%9A%E6%9C%AC/>2021-苍石-在 Javascript 中安全地执行动态脚本</a></li></ul></div></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idd4a74b5a7dd3e004185541b2e1e6e2af")' href=#idd4a74b5a7dd3e004185541b2e1e6e2af aria-expanded=false aria-controls=idd4a74b5a7dd3e004185541b2e1e6e2af aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/>函数式编程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idd4a74b5a7dd3e004185541b2e1e6e2af aria-expanded=false aria-controls=idd4a74b5a7dd3e004185541b2e1e6e2af><i class="fa-solid fa-angle-right" id=caret-idd4a74b5a7dd3e004185541b2e1e6e2af></i></a></div><ul class="nav docs-sidenav collapse" id=idd4a74b5a7dd3e004185541b2e1e6e2af><li class="child level"><a href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/%E4%B8%8D%E5%8F%AF%E5%8F%98%E5%AF%B9%E8%B1%A1/>不可变对象</a></li><li class="child level"><a href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/%E7%BA%AF%E5%87%BD%E6%95%B0%E4%B8%8E%E5%89%AF%E4%BD%9C%E7%94%A8/>纯函数与副作用</a></li><li class="child level"><a href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/%E5%87%BD%E6%95%B0%E7%BB%84%E5%90%88/>函数组合</a></li><li class="child level"><a href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/%E5%BE%AA%E7%8E%AF%E6%94%B9%E9%80%A0/>循环改造</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ida9befc445579c2e4b929b637e7a1a21a")' href=#ida9befc445579c2e4b929b637e7a1a21a aria-expanded=false aria-controls=ida9befc445579c2e4b929b637e7a1a21a aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/>面向对象编程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ida9befc445579c2e4b929b637e7a1a21a aria-expanded=false aria-controls=ida9befc445579c2e4b929b637e7a1a21a><i class="fa-solid fa-angle-right" id=caret-ida9befc445579c2e4b929b637e7a1a21a></i></a></div><ul class="nav docs-sidenav collapse" id=ida9befc445579c2e4b929b637e7a1a21a><li class="child level"><a href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/%E5%AF%B9%E8%B1%A1%E6%A0%A1%E9%AA%8C/>对象校验</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id403b473101b179c0877e41e74b8ca668")' href=#id403b473101b179c0877e41e74b8ca668 aria-expanded=false aria-controls=id403b473101b179c0877e41e74b8ca668 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E8%AF%AD%E6%B3%95%E7%BC%96%E8%AF%91/>语法编译</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id403b473101b179c0877e41e74b8ca668 aria-expanded=false aria-controls=id403b473101b179c0877e41e74b8ca668><i class="fa-solid fa-angle-right" id=caret-id403b473101b179c0877e41e74b8ca668></i></a></div><ul class="nav docs-sidenav collapse" id=id403b473101b179c0877e41e74b8ca668><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id42828ab35ba05f5574888f2e447a7bde")' href=#id42828ab35ba05f5574888f2e447a7bde aria-expanded=false aria-controls=id42828ab35ba05f5574888f2e447a7bde aria-hidden=false data-toggle=collapse></div></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-iddfd437f1276b395fbf0232ede6682659")' href=#iddfd437f1276b395fbf0232ede6682659 aria-expanded=false aria-controls=iddfd437f1276b395fbf0232ede6682659 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E8%AF%AD%E6%B3%95%E7%BC%96%E8%AF%91/babel/>Babel</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#iddfd437f1276b395fbf0232ede6682659 aria-expanded=false aria-controls=iddfd437f1276b395fbf0232ede6682659><i class="fa-solid fa-angle-right" id=caret-iddfd437f1276b395fbf0232ede6682659></i></a></div><ul class="nav docs-sidenav collapse" id=iddfd437f1276b395fbf0232ede6682659><li class="child level"><a href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E8%AF%AD%E6%B3%95%E7%BC%96%E8%AF%91/babel/%E7%BC%96%E8%AF%91%E9%85%8D%E7%BD%AE/>编译配置</a></li><li class="child level"><a href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E8%AF%AD%E6%B3%95%E7%BC%96%E8%AF%91/babel/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/>插件开发</a></li><li class="child level"><a href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E8%AF%AD%E6%B3%95%E7%BC%96%E8%AF%91/babel/%E8%AF%AD%E6%B3%95%E8%BD%AC%E6%8D%A2/>语法转换</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-iddf576cf69def72d96f4cb222c7a15edb")' href=#iddf576cf69def72d96f4cb222c7a15edb aria-expanded=false aria-controls=iddf576cf69def72d96f4cb222c7a15edb aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E8%AF%AD%E6%B3%95%E7%BC%96%E8%AF%91/%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B/>集合类型</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#iddf576cf69def72d96f4cb222c7a15edb aria-expanded=false aria-controls=iddf576cf69def72d96f4cb222c7a15edb><i class="fa-solid fa-angle-right" id=caret-iddf576cf69def72d96f4cb222c7a15edb></i></a></div><ul class="nav docs-sidenav collapse" id=iddf576cf69def72d96f4cb222c7a15edb><li class="child level"><a href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E8%AF%AD%E6%B3%95%E7%BC%96%E8%AF%91/%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B/map/>Map</a></li><li class="child level"><a href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E8%AF%AD%E6%B3%95%E7%BC%96%E8%AF%91/%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B/object/>Object</a></li><li class="child level"><a href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E8%AF%AD%E6%B3%95%E7%BC%96%E8%AF%91/%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B/%E5%AF%B9%E8%B1%A1%E6%AF%94%E8%BE%83/>对象比较</a></li><li class="child level"><a href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E8%AF%AD%E6%B3%95%E7%BC%96%E8%AF%91/%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B/%E6%95%B0%E7%BB%84%E4%B8%8E%E9%9B%86%E5%90%88/>数组与集合</a></li><li class="child level"><a href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E8%AF%AD%E6%B3%95%E7%BC%96%E8%AF%91/%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B/%E5%BA%8F%E5%88%97%E5%8C%96/>序列化</a></li></ul></div></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#使用有意义的可发音的变量名>使用有意义的可发音的变量名</a></li><li><a href=#对相同类型的变量使用相同的关键字>对相同类型的变量使用相同的关键字</a></li><li><a href=#使用可搜索的命名>使用可搜索的命名</a></li><li><a href=#使用说明性质的临时变量>使用说明性质的临时变量</a></li><li><a href=#避免摸不着头脑的临时变量>避免摸不着头脑的临时变量</a></li><li><a href=#避免添加不需要的内容>避免添加不需要的内容</a></li><li><a href=#short-circuiting-优于条件选择>Short-circuiting 优于条件选择</a></li></ul><ul><li><a href=#函数参数最好不超过两个>函数参数最好不超过两个</a></li><li><a href=#函数应当遵循单一职责原则>函数应当遵循单一职责原则</a></li><li><a href=#函数命名应该反映其功能>函数命名应该反映其功能</a></li><li><a href=#函数应当只是一层抽象>函数应当只是一层抽象</a></li><li><a href=#移除重复代码>移除重复代码</a></li><li><a href=#使用默认参数代替或运算>使用默认参数代替或运算</a></li><li><a href=#使用-objectassign-设置默认值>使用 Object.assign 设置默认值</a></li><li><a href=#避免在参数中使用-flags>避免在参数中使用 Flags</a></li><li><a href=#避免冗余副作用>避免冗余副作用</a></li><li><a href=#避免污染全局函数>避免污染全局函数</a></li><li><a href=#优先选择函数式编程而不是命令式编程>优先选择函数式编程而不是命令式编程</a></li><li><a href=#封装条件选择>封装条件选择</a></li><li><a href=#避免负类条件>避免负类条件</a></li><li><a href=#避免使用条件选择>避免使用条件选择</a></li><li><a href=#避免依赖于类型检测>避免依赖于类型检测</a></li><li><a href=#避免依赖于类型检测-1>避免依赖于类型检测</a></li><li><a href=#避免过度优化>避免过度优化</a></li><li><a href=#移除弃用的代码>移除弃用的代码</a></li></ul><ul><li><a href=#使用-getters-与-setters>使用 getters 与 setters</a></li><li><a href=#为对象添加私有属性>为对象添加私有属性</a></li></ul><ul><li><a href=#单一职责原则>单一职责原则</a></li><li><a href=#开放封闭原则>开放封闭原则</a></li><li><a href=#里氏替换原则>里氏替换原则</a></li><li><a href=#接口隔离原则>接口隔离原则</a></li><li><a href=#依赖反转原则>依赖反转原则</a></li><li><a href=#优先选择-es6-类而不是-es5-的基本函数定义>优先选择 ES6 类而不是 ES5 的基本函数定义</a></li><li><a href=#use-method-chaining>Use method chaining</a></li><li><a href=#prefer-composition-over-inheritance>Prefer composition over inheritance</a></li></ul><ul><li><a href=#每个测试用例单一目标>每个测试用例单一目标</a></li></ul><ul><li><a href=#使用-promise-替代回调>使用 Promise 替代回调</a></li><li><a href=#asyncawait-更为清晰>Async/Await 更为清晰</a></li></ul><ul><li><a href=#相似含义变量的大写一致性>相似含义变量的大写一致性</a></li><li><a href=#函数的定义与调用位置尽量靠近>函数的定义与调用位置尽量靠近</a></li></ul><ul><li><a href=#仅仅对业务逻辑进行注释>仅仅对业务逻辑进行注释</a></li><li><a href=#避免保留被注释的代码>避免保留被注释的代码</a></li><li><a href=#不要使用日记形式的注释>不要使用日记形式的注释</a></li><li><a href=#避免额外的代码标记注释>避免额外的代码标记注释</a></li><li><a href=#避免在源文件中添加法律声明>避免在源文件中添加法律声明</a></li></ul><ul><li><a href=#不要忽略被捕获的错误>不要忽略被捕获的错误</a></li><li><a href=#不要忽略被拒绝的-promises>不要忽略被拒绝的 Promises</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>Clean JavaScript</h1><div class=article-style><h1 id=introduction-简介>Introduction: 简介</h1><p>很多开发者都会推崇 Robert C. Martin 的<a href=https://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882 target=_blank rel=noopener><em>Clean Code</em></a>一书中提及的软件工程准则，本文就是对于这些准则在 JavaScript 开发领域中的实践应用总结。本文并不仅仅是样式指南，而是对于如何编写出基于 JavaScript 实现的高可读性、高可用性以及可重构的软件系统。虽然本文对比的讲了很多好坏的实践，但并不是说本文就建议大家强制遵循所有的指南。实际上对于 Clean Code 的概念不同的团队、不同的开发者都会有不同的见解与看法，本文的很多观点也是充满争议。软件工程已经走过了五十多个年头，而我们也一直在前行，很难说有什么原则是永恒正确的。作者更希望这些指南与考量起到试金石的作用，成为评判团队 JavaScript 代码质量的考量标准之一。</p><p>最后还需要强调的，好的代码、好的架构都是慢慢衍化而来，切不可操之过急。千里之行，始于足下，在前行的道路上势必会走很多的弯路、错误，但是只要不断调整方向总会回到正确的道路上。我们不能畏惧改变，也不能把他人的话完全奉为圭臬，无论多少年的老程序员也是会犯错的、</p><h1 id=variables-变量><strong>Variables</strong>: 变量</h1><h2 id=使用有意义的可发音的变量名>使用有意义的可发音的变量名</h2><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>yyyymmdstr</span> <span class=o>=</span> <span class=nx>moment</span><span class=p>().</span><span class=nx>format</span><span class=p>(</span><span class=s2>&#34;YYYY/MM/DD&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>yearMonthDay</span> <span class=o>=</span> <span class=nx>moment</span><span class=p>().</span><span class=nx>format</span><span class=p>(</span><span class=s2>&#34;YYYY/MM/DD&#34;</span><span class=p>);</span>
</span></span></code></pre></div><h2 id=对相同类型的变量使用相同的关键字>对相同类型的变量使用相同的关键字</h2><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>getUserInfo</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>getClientData</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>getCustomerRecord</span><span class=p>();</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>getUser</span><span class=p>();</span>
</span></span></code></pre></div><h2 id=使用可搜索的命名>使用可搜索的命名</h2><p>在开发过程中，我们阅读代码的时间会远远超过编写代码的时间，因此保证代码的可读性与可搜索会非常重要。切记，没事不要坑自己。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>//525600到底啥意思？
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=mi>525600</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>runCronJob</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// 声明为全局变量
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>MINUTES_IN_A_YEAR</span> <span class=o>=</span> <span class=mi>525600</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>MINUTES_IN_A_YEAR</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>runCronJob</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=使用说明性质的临时变量>使用说明性质的临时变量</h2><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>let</span> <span class=nx>cityStateRegex</span> <span class=o>=</span> <span class=sr>/^(.+)[,\\s]+(.+?)\s*(\d{5})?$/</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>saveCityState</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>cityStateRegex</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span><span class=nx>cityStateRegex</span><span class=p>)[</span><span class=mi>1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=nx>cityStateRegex</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span><span class=nx>cityStateRegex</span><span class=p>)[</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>let</span> <span class=nx>cityStateRegex</span> <span class=o>=</span> <span class=sr>/^(.+)[,\\s]+(.+?)\s*(\d{5})?$/</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>match</span> <span class=o>=</span> <span class=nx>cityStateRegex</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span><span class=nx>cityStateRegex</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>city</span> <span class=o>=</span> <span class=nx>match</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>state</span> <span class=o>=</span> <span class=nx>match</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nx>saveCityState</span><span class=p>(</span><span class=nx>city</span><span class=p>,</span> <span class=nx>state</span><span class=p>);</span>
</span></span></code></pre></div><h2 id=避免摸不着头脑的临时变量>避免摸不着头脑的临时变量</h2><p>在遍历或者 mapping 过程中，需要避免短小无意义的变量命名。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>locations</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;Austin&#39;</span><span class=p>,</span> <span class=s1>&#39;New York&#39;</span><span class=p>,</span> <span class=s1>&#39;San Francisco&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nx>locations</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>l</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>doStuff</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>doSomeOtherStuff</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Wait, what is `l` for again?
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>dispatch</span><span class=p>(</span><span class=nx>l</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>locations</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;Austin&#39;</span><span class=p>,</span> <span class=s1>&#39;New York&#39;</span><span class=p>,</span> <span class=s1>&#39;San Francisco&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nx>locations</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>location</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>doStuff</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>doSomeOtherStuff</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=nx>dispatch</span><span class=p>(</span><span class=nx>location</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><h2 id=避免添加不需要的内容>避免添加不需要的内容</h2><p>如果你的类名 / 实例名已经能够表述某些信息，那么在类 / 实例的属性中就不需要重复命名。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Car</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>carMake</span><span class=o>:</span> <span class=s2>&#34;Honda&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>carModel</span><span class=o>:</span> <span class=s2>&#34;Accord&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>carColor</span><span class=o>:</span> <span class=s2>&#34;Blue&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>paintCar</span><span class=p>(</span><span class=nx>car</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>car</span><span class=p>.</span><span class=nx>carColor</span> <span class=o>=</span> <span class=s2>&#34;Red&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Car</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>make</span><span class=o>:</span> <span class=s2>&#34;Honda&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>model</span><span class=o>:</span> <span class=s2>&#34;Accord&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>color</span><span class=o>:</span> <span class=s2>&#34;Blue&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>paintCar</span><span class=p>(</span><span class=nx>car</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>car</span><span class=p>.</span><span class=nx>color</span> <span class=o>=</span> <span class=s2>&#34;Red&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=short-circuiting-优于条件选择>Short-circuiting 优于条件选择</h2><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>createMicrobrewery</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>breweryName</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>breweryName</span> <span class=o>=</span> <span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>breweryName</span> <span class=o>=</span> <span class=s2>&#34;Hipster Brew Co.&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>createMicrobrewery</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>breweryName</span> <span class=o>=</span> <span class=nx>name</span> <span class=o>||</span> <span class=s2>&#34;Hipster Brew Co.&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h1 id=函数>函数</h1><h2 id=函数参数最好不超过两个>函数参数最好不超过两个</h2><p>限制函数的参数数目还是比较重要的，它能够方便对于函数的测试，避免需要进行不同的 Case 测试时把代码变得一团糟。我们应该尽可能地控制参数数目小于或等于两个，如果你的参数数目多于两个，那么建议使用高阶对象进行适当封装。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>createMenu</span><span class=p>(</span><span class=nx>title</span><span class=p>,</span> <span class=nx>body</span><span class=p>,</span> <span class=nx>buttonText</span><span class=p>,</span> <span class=nx>cancellable</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>menuConfig</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>title</span><span class=o>:</span> <span class=s1>&#39;Foo&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>body</span><span class=o>:</span> <span class=s1>&#39;Bar&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>buttonText</span><span class=o>:</span> <span class=s1>&#39;Baz&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>cancellable</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>createMenu</span><span class=p>(</span><span class=nx>menuConfig</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=函数应当遵循单一职责原则>函数应当遵循单一职责原则</h2><p>这一条算是迄今为止软件工程中最重要的原则之一了。如果我们给单一函数赋予了过多的职责，那么其很难被用于组合、测试等。而如果你保证函数的单一职责性质，那么相对其重构难度、代码可读性也会更好。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>emailClients</span><span class=p>(</span><span class=nx>clients</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>clients</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>client</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>clientRecord</span> <span class=o>=</span> <span class=nx>database</span><span class=p>.</span><span class=nx>lookup</span><span class=p>(</span><span class=nx>client</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>clientRecord</span><span class=p>.</span><span class=nx>isActive</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>email</span><span class=p>(</span><span class=nx>client</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>emailClients</span><span class=p>(</span><span class=nx>clients</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>clients</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>client</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>emailClientIfNeeded</span><span class=p>(</span><span class=nx>client</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>emailClientIfNeeded</span><span class=p>(</span><span class=nx>client</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>isClientActive</span><span class=p>(</span><span class=nx>client</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>email</span><span class=p>(</span><span class=nx>client</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>isClientActive</span><span class=p>(</span><span class=nx>client</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>clientRecord</span> <span class=o>=</span> <span class=nx>database</span><span class=p>.</span><span class=nx>lookup</span><span class=p>(</span><span class=nx>client</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>clientRecord</span><span class=p>.</span><span class=nx>isActive</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=函数命名应该反映其功能>函数命名应该反映其功能</h2><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>dateAdd</span><span class=p>(</span><span class=nx>date</span><span class=p>,</span> <span class=nx>month</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>date</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 很难从函数名中获知该函数到底是谁加上谁
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>dateAdd</span><span class=p>(</span><span class=nx>date</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>dateAddMonth</span><span class=p>(</span><span class=nx>date</span><span class=p>,</span> <span class=nx>month</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>date</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>dateAddMonth</span><span class=p>(</span><span class=nx>date</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span></code></pre></div><h2 id=函数应当只是一层抽象>函数应当只是一层抽象</h2><p>这一条类似于单一职责原则，不过更倾向于关注函数的抽象程度，如果我们在单一函数中添加了过多的抽象层，同样会降低的函数可读性、增加重构难度。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>parseBetterJSAlternative</span><span class=p>(</span><span class=nx>code</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>REGEXES</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>statements</span> <span class=o>=</span> <span class=nx>code</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34; &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>tokens</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>REGEXES</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>REGEX</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>statements</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>statement</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>ast</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>tokens</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>token</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// lex...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>ast</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>node</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// parse...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>tokenize</span><span class=p>(</span><span class=nx>code</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>REGEXES</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>statements</span> <span class=o>=</span> <span class=nx>code</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34; &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>tokens</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>REGEXES</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>REGEX</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>statements</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>statement</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>tokens</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>lexer</span><span class=p>(</span><span class=nx>tokens</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>ast</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>tokens</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>token</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// lex...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>ast</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>parseBetterJSAlternative</span><span class=p>(</span><span class=nx>code</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>tokens</span> <span class=o>=</span> <span class=nx>tokenize</span><span class=p>(</span><span class=nx>code</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>ast</span> <span class=o>=</span> <span class=nx>lexer</span><span class=p>(</span><span class=nx>tokens</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>ast</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>node</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// parse...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=移除重复代码>移除重复代码</h2><p>在任何情况下都不要去容许重复代码的存在。重复代码指那些修改单一逻辑时需要修改多个代码片的代码交集，JavaScript 本身是弱类型语言，相对而言编写泛型函数会更加容易。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>showDeveloperList</span><span class=p>(</span><span class=nx>developers</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>developers</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>developers</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>expectedSalary</span> <span class=o>=</span> <span class=nx>developer</span><span class=p>.</span><span class=nx>calculateExpectedSalary</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>experience</span> <span class=o>=</span> <span class=nx>developer</span><span class=p>.</span><span class=nx>getExperience</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>githubLink</span> <span class=o>=</span> <span class=nx>developer</span><span class=p>.</span><span class=nx>getGithubLink</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>expectedSalary</span><span class=o>:</span> <span class=nx>expectedSalary</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>experience</span><span class=o>:</span> <span class=nx>experience</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>githubLink</span><span class=o>:</span> <span class=nx>githubLink</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>render</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>showManagerList</span><span class=p>(</span><span class=nx>managers</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>managers</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>manager</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>expectedSalary</span> <span class=o>=</span> <span class=nx>manager</span><span class=p>.</span><span class=nx>calculateExpectedSalary</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>experience</span> <span class=o>=</span> <span class=nx>manager</span><span class=p>.</span><span class=nx>getExperience</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>portfolio</span> <span class=o>=</span> <span class=nx>manager</span><span class=p>.</span><span class=nx>getMBAProjects</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>expectedSalary</span><span class=o>:</span> <span class=nx>expectedSalary</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>experience</span><span class=o>:</span> <span class=nx>experience</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>portfolio</span><span class=o>:</span> <span class=nx>portfolio</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>render</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>showList</span><span class=p>(</span><span class=nx>employees</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>employees</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>employee</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>expectedSalary</span> <span class=o>=</span> <span class=nx>employee</span><span class=p>.</span><span class=nx>calculateExpectedSalary</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>experience</span> <span class=o>=</span> <span class=nx>employee</span><span class=p>.</span><span class=nx>getExperience</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>portfolio</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>employee</span><span class=p>.</span><span class=nx>type</span> <span class=o>===</span> <span class=s2>&#34;manager&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>portfolio</span> <span class=o>=</span> <span class=nx>employee</span><span class=p>.</span><span class=nx>getMBAProjects</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>portfolio</span> <span class=o>=</span> <span class=nx>employee</span><span class=p>.</span><span class=nx>getGithubLink</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>expectedSalary</span><span class=o>:</span> <span class=nx>expectedSalary</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>experience</span><span class=o>:</span> <span class=nx>experience</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>portfolio</span><span class=o>:</span> <span class=nx>portfolio</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>render</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=使用默认参数代替或运算>使用默认参数代替或运算</h2><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>writeForumComment</span><span class=p>(</span><span class=nx>subject</span><span class=p>,</span> <span class=nx>body</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>subject</span> <span class=o>=</span> <span class=nx>subject</span> <span class=o>||</span> <span class=s2>&#34;No Subject&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>body</span> <span class=o>=</span> <span class=nx>body</span> <span class=o>||</span> <span class=s2>&#34;No text&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>writeForumComment</span><span class=p>(</span><span class=nx>subject</span> <span class=o>=</span> <span class=s1>&#39;No subject&#39;</span><span class=p>,</span> <span class=nx>body</span> <span class=o>=</span> <span class=s1>&#39;No text&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=使用-objectassign-设置默认值>使用 Object.assign 设置默认值</h2><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>menuConfig</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>title</span><span class=o>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>body</span><span class=o>:</span> <span class=s2>&#34;Bar&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>buttonText</span><span class=o>:</span> <span class=kc>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>cancellable</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>createMenu</span><span class=p>(</span><span class=nx>config</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>config</span><span class=p>.</span><span class=nx>title</span> <span class=o>=</span> <span class=nx>config</span><span class=p>.</span><span class=nx>title</span> <span class=o>||</span> <span class=s2>&#34;Foo&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>config</span><span class=p>.</span><span class=nx>body</span> <span class=o>=</span> <span class=nx>config</span><span class=p>.</span><span class=nx>body</span> <span class=o>||</span> <span class=s2>&#34;Bar&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>config</span><span class=p>.</span><span class=nx>buttonText</span> <span class=o>=</span> <span class=nx>config</span><span class=p>.</span><span class=nx>buttonText</span> <span class=o>||</span> <span class=s2>&#34;Baz&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>config</span><span class=p>.</span><span class=nx>cancellable</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>    <span class=nx>config</span><span class=p>.</span><span class=nx>cancellable</span> <span class=o>===</span> <span class=kc>undefined</span> <span class=o>?</span> <span class=nx>config</span><span class=p>.</span><span class=nx>cancellable</span> <span class=o>:</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>createMenu</span><span class=p>(</span><span class=nx>menuConfig</span><span class=p>);</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>menuConfig</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>title</span><span class=o>:</span> <span class=s2>&#34;Order&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=c1>// User did not include &#39;body&#39; key
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>buttonText</span><span class=o>:</span> <span class=s2>&#34;Send&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>cancellable</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>createMenu</span><span class=p>(</span><span class=nx>config</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>config</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>assign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>title</span><span class=o>:</span> <span class=s2>&#34;Foo&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>body</span><span class=o>:</span> <span class=s2>&#34;Bar&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>buttonText</span><span class=o>:</span> <span class=s2>&#34;Baz&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>cancellable</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>config</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// config now equals: {title: &#34;Foo&#34;, body: &#34;Bar&#34;, buttonText: &#34;Baz&#34;, cancellable: true}
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>createMenu</span><span class=p>(</span><span class=nx>menuConfig</span><span class=p>);</span>
</span></span></code></pre></div><h2 id=避免在参数中使用-flags>避免在参数中使用 Flags</h2><p>有的开发者会使用 Flags 来控制函数执行不同的逻辑流，不过就如我们在上文中提及的单一职责原则，我们应当将函数拆分为不同的部分，然后在外层调用上根据 Flags 调用不同的函数。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>createFile</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>temp</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>temp</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fs</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s2>&#34;./temp/&#34;</span> <span class=o>+</span> <span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fs</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>createTempFile</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>fs</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=s2>&#34;./temp/&#34;</span> <span class=o>+</span> <span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>createFile</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>fs</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=避免冗余副作用>避免冗余副作用</h2><p>如果某个函数除了接收输入值与返回值之外还做了其他事，那么就称其具有副作用。典型的副作用譬如写文件、修改某些全局变量、修改内存参数等等。在编程中我们不可避免的需要产生副作用，譬如上面例子中我们需要写入到某个外部文件。而你应当做的就是将所有的写文件操作由某个服务统一处理，而不应该将写文件的操作分散到数个类或者函数中。这一点最大的优势在于避免了不同对象之间共享状态，共享的可变状态可是万恶之源啊。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// 定义全局变量
</span></span></span><span class=line><span class=cl><span class=c1>// 如果我们有其他的函数引用了该变量，那么我们就无法预测该变量类型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>name</span> <span class=o>=</span> <span class=s2>&#34;Ryan McDermott&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>splitIntoFirstAndLastName</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span> <span class=o>=</span> <span class=nx>name</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34; &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>splitIntoFirstAndLastName</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>name</span><span class=p>);</span> <span class=c1>// [&#39;Ryan&#39;, &#39;McDermott&#39;];
</span></span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>splitIntoFirstAndLastName</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>name</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34; &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>name</span> <span class=o>=</span> <span class=s2>&#34;Ryan McDermott&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>newName</span> <span class=o>=</span> <span class=nx>splitIntoFirstAndLastName</span><span class=p>(</span><span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>name</span><span class=p>);</span> <span class=c1>// &#39;Ryan McDermott&#39;;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>newName</span><span class=p>);</span> <span class=c1>// [&#39;Ryan&#39;, &#39;McDermott&#39;];
</span></span></span></code></pre></div><h2 id=避免污染全局函数>避免污染全局函数</h2><p>JavaScript 中有个不太好的实践就是修改某个全局函数，将其指向其他的库或者自定义函数，不过这个会对某个懵懂的用户造成困恼。如果你想给 JavaScript 原生的 Array 添加一个 diff 函数支持，来展示两个数组的差异。你可以选择将函数挂载到<code>Array.prototype</code>，不过很有可能跟其他打算占用这个位置的库起冲突。我们更建议使用 ES6 的 classes，并且使用继承方式去添加新的功能函数。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nb>Array</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>diff</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>comparisonArray</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>values</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>hash</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>i</span> <span class=k>of</span> <span class=nx>comparisonArray</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>hash</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>i</span> <span class=k>of</span> <span class=k>this</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>hash</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>values</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>values</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p><strong>Good:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>SuperArray</span> <span class=kr>extends</span> <span class=nb>Array</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(...</span><span class=nx>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>super</span><span class=p>(...</span><span class=nx>args</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>diff</span><span class=p>(</span><span class=nx>comparisonArray</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>values</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>hash</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>i</span> <span class=k>of</span> <span class=nx>comparisonArray</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>hash</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>i</span> <span class=k>of</span> <span class=k>this</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>hash</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>values</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>values</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=优先选择函数式编程而不是命令式编程>优先选择函数式编程而不是命令式编程</h2><p>JavaScript 并不像 Haskell 这样纯粹的函数式编程语言，不过其对于实践函数式编程的理念还是很推崇的。函数式编程可读性更好，也更易于测试。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>programmerOutput</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Uncle Bobby&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>linesOfCode</span><span class=o>:</span> <span class=mi>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Suzie Q&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>linesOfCode</span><span class=o>:</span> <span class=mi>1500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Jimmy Gosling&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>linesOfCode</span><span class=o>:</span> <span class=mi>150</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Gracie Hopper&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>linesOfCode</span><span class=o>:</span> <span class=mi>1000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>totalOutput</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>programmerOutput</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>totalOutput</span> <span class=o>+=</span> <span class=nx>programmerOutput</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>linesOfCode</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>programmerOutput</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Uncle Bobby&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>linesOfCode</span><span class=o>:</span> <span class=mi>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Suzie Q&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>linesOfCode</span><span class=o>:</span> <span class=mi>1500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Jimmy Gosling&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>linesOfCode</span><span class=o>:</span> <span class=mi>150</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;Gracie Hopper&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>linesOfCode</span><span class=o>:</span> <span class=mi>1000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>totalOutput</span> <span class=o>=</span> <span class=nx>programmerOutput</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>programmer</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>programmer</span><span class=p>.</span><span class=nx>linesOfCode</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>reduce</span><span class=p>((</span><span class=nx>acc</span><span class=p>,</span> <span class=nx>linesOfCode</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>acc</span> <span class=o>+</span> <span class=nx>linesOfCode</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span></code></pre></div><h2 id=封装条件选择>封装条件选择</h2><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>fsm</span><span class=p>.</span><span class=nx>state</span> <span class=o>===</span> <span class=s2>&#34;fetching&#34;</span> <span class=o>&amp;&amp;</span> <span class=nx>isEmpty</span><span class=p>(</span><span class=nx>listNode</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>/// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>shouldShowSpinner</span><span class=p>(</span><span class=nx>fsm</span><span class=p>,</span> <span class=nx>listNode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>fsm</span><span class=p>.</span><span class=nx>state</span> <span class=o>===</span> <span class=s2>&#34;fetching&#34;</span> <span class=o>&amp;&amp;</span> <span class=nx>isEmpty</span><span class=p>(</span><span class=nx>listNode</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>shouldShowSpinner</span><span class=p>(</span><span class=nx>fsmInstance</span><span class=p>,</span> <span class=nx>listNodeInstance</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h2 id=避免负类条件>避免负类条件</h2><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>isDOMNodeNotPresent</span><span class=p>(</span><span class=nx>node</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>isDOMNodeNotPresent</span><span class=p>(</span><span class=nx>node</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>isDOMNodePresent</span><span class=p>(</span><span class=nx>node</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>isDOMNodePresent</span><span class=p>(</span><span class=nx>node</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h2 id=避免使用条件选择>避免使用条件选择</h2><p>很多人第一次听到这个概念都会觉得不可思议，没有<code>if</code>条件选择语句的话又该如何编程呢？在这里我们推荐使用多态性来达成这一目标，因为如果在函数或类中嵌入过多的<code>if</code>语句，会导致该函数或者类破坏单一职责原则。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Airplane</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>getCruisingAltitude</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s2>&#34;777&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>getMaxAltitude</span><span class=p>()</span> <span class=o>-</span> <span class=nx>getPassengerCount</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s2>&#34;Air Force One&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>getMaxAltitude</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s2>&#34;Cesna&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>getMaxAltitude</span><span class=p>()</span> <span class=o>-</span> <span class=nx>getFuelExpenditure</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Airplane</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Boeing777</span> <span class=kr>extends</span> <span class=nx>Airplane</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>getCruisingAltitude</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>getMaxAltitude</span><span class=p>()</span> <span class=o>-</span> <span class=nx>getPassengerCount</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>AirForceOne</span> <span class=kr>extends</span> <span class=nx>Airplane</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>getCruisingAltitude</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>getMaxAltitude</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Cesna</span> <span class=kr>extends</span> <span class=nx>Airplane</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>getCruisingAltitude</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>getMaxAltitude</span><span class=p>()</span> <span class=o>-</span> <span class=nx>getFuelExpenditure</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=避免依赖于类型检测>避免依赖于类型检测</h2><p>很多时候我们会依赖于 JavaScript 输入的参数类型来进入不同的控制流，不过鉴于 JavaScript 本身是弱类型语言，我们还是应该避免这种实践。第一个方法就是使用较为一致性的接口。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>travelToTexas</span><span class=p>(</span><span class=nx>vehicle</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>vehicle</span> <span class=k>instanceof</span> <span class=nx>Bicycle</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>vehicle</span><span class=p>.</span><span class=nx>peddle</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>currentLocation</span><span class=p>,</span> <span class=k>new</span> <span class=nx>Location</span><span class=p>(</span><span class=s2>&#34;texas&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>vehicle</span> <span class=k>instanceof</span> <span class=nx>Car</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>vehicle</span><span class=p>.</span><span class=nx>drive</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>currentLocation</span><span class=p>,</span> <span class=k>new</span> <span class=nx>Location</span><span class=p>(</span><span class=s2>&#34;texas&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>travelToTexas</span><span class=p>(</span><span class=nx>vehicle</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>vehicle</span><span class=p>.</span><span class=nx>move</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>currentLocation</span><span class=p>,</span> <span class=k>new</span> <span class=nx>Location</span><span class=p>(</span><span class=s2>&#34;texas&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=避免依赖于类型检测-1>避免依赖于类型检测</h2><p>如果你需要操作像字符串、数值、列表这样的基础数据类型，你就无法依赖于多态性来实现类型检测。那么建议是使用 TypeScript，它为普通的 JavaScript 添加了静态类型支持。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>combine</span><span class=p>(</span><span class=nx>val1</span><span class=p>,</span> <span class=nx>val2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>typeof</span> <span class=nx>val1</span> <span class=o>==</span> <span class=s2>&#34;number&#34;</span> <span class=o>&amp;&amp;</span> <span class=k>typeof</span> <span class=nx>val2</span> <span class=o>==</span> <span class=s2>&#34;number&#34;</span><span class=p>)</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>typeof</span> <span class=nx>val1</span> <span class=o>==</span> <span class=s2>&#34;string&#34;</span> <span class=o>&amp;&amp;</span> <span class=k>typeof</span> <span class=nx>val2</span> <span class=o>==</span> <span class=s2>&#34;string&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>val1</span> <span class=o>+</span> <span class=nx>val2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s2>&#34;Must be of type String or Number&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>combine</span><span class=p>(</span><span class=nx>val1</span><span class=p>,</span> <span class=nx>val2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>val1</span> <span class=o>+</span> <span class=nx>val2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=避免过度优化>避免过度优化</h2><p>现代浏览器已经在运行时做了很多的优化，因此很多时候如果我们要遵循那些流传已久的优化策略不过是浪费时间。可以参考<a href=https://github.com/petkaantonov/bluebird/wiki/Optimization-killers target=_blank rel=noopener>这个</a>来获取建议的优化要点。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// On old browsers, each iteration would be costly because `len` would be
</span></span></span><span class=line><span class=cl><span class=c1>// recomputed. In modern browsers, this is optimized.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>len</span> <span class=o>=</span> <span class=nx>list</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>len</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>list</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h2 id=移除弃用的代码>移除弃用的代码</h2><p>弃用的代码就和重复的代码一样，我们没有任何理由保留他们。不过为防万一建议不要彻底从 Git 的历史记录中删除它们。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>oldRequestModule</span><span class=p>(</span><span class=nx>url</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>newRequestModule</span><span class=p>(</span><span class=nx>url</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>req</span> <span class=o>=</span> <span class=nx>newRequestModule</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>inventoryTracker</span><span class=p>(</span><span class=s2>&#34;apples&#34;</span><span class=p>,</span> <span class=nx>req</span><span class=p>,</span> <span class=s2>&#34;www.inventory-awesome.io&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>newRequestModule</span><span class=p>(</span><span class=nx>url</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>req</span> <span class=o>=</span> <span class=nx>newRequestModule</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>inventoryTracker</span><span class=p>(</span><span class=s2>&#34;apples&#34;</span><span class=p>,</span> <span class=nx>req</span><span class=p>,</span> <span class=s2>&#34;www.inventory-awesome.io&#34;</span><span class=p>);</span>
</span></span></code></pre></div><h1 id=对象与数据结构>对象与数据结构</h1><h2 id=使用-getters-与-setters>使用 getters 与 setters</h2><p>在 JavaScript 的对象属性读写中，建议使用 getter 或者 setter，而不是直接读取或者赋值。不过 JavaScript 并没有类似于 public 或者 private 这样的关键字，因此很难通过接口方式进行强限制。不过鉴于以下优势我们还是强烈建议使用 getter 或者 setter: 1. 如果你打算不仅仅是直接获取原始值，使用 getter 能够避免去修改每个取值的地方。2. 使用<code>set</code>能够方便地添加校验。</p><ol><li>封装内部表述。</li><li>便于添加日志与错误处理。</li><li>通过继承能够复写默认功能。</li><li>支持属性懒加载。</li></ol><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>BankAccount</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>=</span> <span class=mi>1000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>bankAccount</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>BankAccount</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Buy shoes...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>bankAccount</span><span class=p>.</span><span class=nx>balance</span> <span class=o>=</span> <span class=nx>bankAccount</span><span class=p>.</span><span class=nx>balance</span> <span class=o>-</span> <span class=mi>100</span><span class=p>;</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>BankAccount</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>=</span> <span class=mi>1000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// It doesn&#39;t have to be prefixed with `get` or `set` to be a getter/setter
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>withdraw</span><span class=p>(</span><span class=nx>amount</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>verifyAmountCanBeDeducted</span><span class=p>(</span><span class=nx>amount</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>balance</span> <span class=o>-=</span> <span class=nx>amount</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>bankAccount</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>BankAccount</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Buy shoes...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>bankAccount</span><span class=p>.</span><span class=nx>withdraw</span><span class=p>(</span><span class=mi>100</span><span class=p>);</span>
</span></span></code></pre></div><h2 id=为对象添加私有属性>为对象添加私有属性</h2><p>可以通过闭包方式添加私有属性：</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Employee</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Employee</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>getName</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>employee</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Employee</span><span class=p>(</span><span class=s2>&#34;John Doe&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Employee name: &#34;</span> <span class=o>+</span> <span class=nx>employee</span><span class=p>.</span><span class=nx>getName</span><span class=p>());</span> <span class=c1>// Employee name: John Doe
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>delete</span> <span class=nx>employee</span><span class=p>.</span><span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Employee name: &#34;</span> <span class=o>+</span> <span class=nx>employee</span><span class=p>.</span><span class=nx>getName</span><span class=p>());</span> <span class=c1>// Employee name: undefined
</span></span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Employee</span> <span class=o>=</span> <span class=p>(</span><span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nx>Employee</span><span class=p>(</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>getName</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>Employee</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>})();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>employee</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Employee</span><span class=p>(</span><span class=s2>&#34;John Doe&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Employee name: &#34;</span> <span class=o>+</span> <span class=nx>employee</span><span class=p>.</span><span class=nx>getName</span><span class=p>());</span> <span class=c1>// Employee name: John Doe
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>delete</span> <span class=nx>employee</span><span class=p>.</span><span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Employee name: &#34;</span> <span class=o>+</span> <span class=nx>employee</span><span class=p>.</span><span class=nx>getName</span><span class=p>());</span> <span class=c1>// Employee name: John Doe
</span></span></span></code></pre></div><h1 id=类>类</h1><h2 id=单一职责原则>单一职责原则</h2><p>便如 Clean Code 中所述，不应该为了多个理由去更改某个类的代码，这样会把某个类塞入过多的功能。最小化你需要去改变某个类的次数对于保证代码的稳定性至关重要，过多的改变代码会影响代码库中依赖于该类的其他模块。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>UserSettings</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>user</span> <span class=o>=</span> <span class=nx>user</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>changeSettings</span><span class=p>(</span><span class=nx>settings</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>verifyCredentials</span><span class=p>(</span><span class=nx>user</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>verifyCredentials</span><span class=p>(</span><span class=nx>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>UserAuth</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>user</span> <span class=o>=</span> <span class=nx>user</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>verifyCredentials</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>UserSettings</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>user</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>user</span> <span class=o>=</span> <span class=nx>user</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>auth</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>UserAuth</span><span class=p>(</span><span class=nx>user</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>changeSettings</span><span class=p>(</span><span class=nx>settings</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>auth</span><span class=p>.</span><span class=nx>verifyCredentials</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=开放封闭原则>开放封闭原则</h2><p>正如 Bertrand Meyer 所述，譬如类、模块、函数这样的实体应该面向扩展开放，而拒绝修改。换言之，我们推荐去继承扩展某个函数或模块，而不是每次都去修改源代码。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>AjaxRequester</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// What if we wanted another HTTP Method, like DELETE? We would have to
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// open this file up and modify this and put it in manually.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>HTTP_METHODS</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;POST&#34;</span><span class=p>,</span> <span class=s2>&#34;PUT&#34;</span><span class=p>,</span> <span class=s2>&#34;GET&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>get</span><span class=p>(</span><span class=nx>url</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>AjaxRequester</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>HTTP_METHODS</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;POST&#34;</span><span class=p>,</span> <span class=s2>&#34;PUT&#34;</span><span class=p>,</span> <span class=s2>&#34;GET&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>get</span><span class=p>(</span><span class=nx>url</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>addHTTPMethod</span><span class=p>(</span><span class=nx>method</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>HTTP_METHODS</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>method</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=里氏替换原则>里氏替换原则</h2><p>这个原则听起来有点拗口，不过概念却很好理解。其形式化描述为如果 S 为 T 的子类型，那么类型 T 的实例可以被类型 S 的实例替换而不需要修改任何的代码。形象而言，我们创建的父类与其子类应当可交换地使用而不会引起异常，譬如下文的 Square-Rectangle 这个例子。Square 也是 Rectangle：</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Rectangle</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>width</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>height</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setColor</span><span class=p>(</span><span class=nx>color</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>render</span><span class=p>(</span><span class=nx>area</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setWidth</span><span class=p>(</span><span class=nx>width</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>width</span> <span class=o>=</span> <span class=nx>width</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setHeight</span><span class=p>(</span><span class=nx>height</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>height</span> <span class=o>=</span> <span class=nx>height</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>getArea</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>width</span> <span class=o>*</span> <span class=k>this</span><span class=p>.</span><span class=nx>height</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Square</span> <span class=kr>extends</span> <span class=nx>Rectangle</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>super</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setWidth</span><span class=p>(</span><span class=nx>width</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>width</span> <span class=o>=</span> <span class=nx>width</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>height</span> <span class=o>=</span> <span class=nx>width</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setHeight</span><span class=p>(</span><span class=nx>height</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>width</span> <span class=o>=</span> <span class=nx>height</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>height</span> <span class=o>=</span> <span class=nx>height</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>renderLargeRectangles</span><span class=p>(</span><span class=nx>rectangles</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>rectangles</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>rectangle</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>rectangle</span><span class=p>.</span><span class=nx>setWidth</span><span class=p>(</span><span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>rectangle</span><span class=p>.</span><span class=nx>setHeight</span><span class=p>(</span><span class=mi>5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>area</span> <span class=o>=</span> <span class=nx>rectangle</span><span class=p>.</span><span class=nx>getArea</span><span class=p>();</span> <span class=c1>// BAD: Will return 25 for Square. Should be 20.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>rectangle</span><span class=p>.</span><span class=nx>render</span><span class=p>(</span><span class=nx>area</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>rectangles</span> <span class=o>=</span> <span class=p>[</span><span class=k>new</span> <span class=nx>Rectangle</span><span class=p>(),</span> <span class=k>new</span> <span class=nx>Rectangle</span><span class=p>(),</span> <span class=k>new</span> <span class=nx>Square</span><span class=p>()];</span>
</span></span><span class=line><span class=cl><span class=nx>renderLargeRectangles</span><span class=p>(</span><span class=nx>rectangles</span><span class=p>);</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Shape</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setColor</span><span class=p>(</span><span class=nx>color</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>render</span><span class=p>(</span><span class=nx>area</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Rectangle</span> <span class=kr>extends</span> <span class=nx>Shape</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>super</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>width</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>height</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setWidth</span><span class=p>(</span><span class=nx>width</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>width</span> <span class=o>=</span> <span class=nx>width</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setHeight</span><span class=p>(</span><span class=nx>height</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>height</span> <span class=o>=</span> <span class=nx>height</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>getArea</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>width</span> <span class=o>*</span> <span class=k>this</span><span class=p>.</span><span class=nx>height</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Square</span> <span class=kr>extends</span> <span class=nx>Shape</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>super</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>length</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setLength</span><span class=p>(</span><span class=nx>length</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>length</span> <span class=o>=</span> <span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>getArea</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>length</span> <span class=o>*</span> <span class=k>this</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>renderLargeShapes</span><span class=p>(</span><span class=nx>shapes</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>shapes</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>shape</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span><span class=nx>shape</span><span class=p>.</span><span class=nx>constructor</span><span class=p>.</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s2>&#34;Square&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>shape</span><span class=p>.</span><span class=nx>setLength</span><span class=p>(</span><span class=mi>5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=s2>&#34;Rectangle&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=nx>shape</span><span class=p>.</span><span class=nx>setWidth</span><span class=p>(</span><span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>shape</span><span class=p>.</span><span class=nx>setHeight</span><span class=p>(</span><span class=mi>5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>area</span> <span class=o>=</span> <span class=nx>shape</span><span class=p>.</span><span class=nx>getArea</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>shape</span><span class=p>.</span><span class=nx>render</span><span class=p>(</span><span class=nx>area</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>shapes</span> <span class=o>=</span> <span class=p>[</span><span class=k>new</span> <span class=nx>Rectangle</span><span class=p>(),</span> <span class=k>new</span> <span class=nx>Rectangle</span><span class=p>(),</span> <span class=k>new</span> <span class=nx>Square</span><span class=p>()];</span>
</span></span><span class=line><span class=cl><span class=nx>renderLargeShapes</span><span class=p>(</span><span class=nx>shapes</span><span class=p>);</span>
</span></span></code></pre></div><h2 id=接口隔离原则>接口隔离原则</h2><p>JavaScript 本身并不包含对于接口语法的支持，因此也无法像其他语言那样达到严格限制的程度。不过鉴于 JavaScript 本身类型系统的缺失，遵循接口隔离原则还是蛮重要的。ISP 的表述为不应该强制客户端去依赖于他们不需要的接口，这一点在 JavaScript 中较为典型的例子就是那些需要大量配置信息的对象。其实使用者并不需要去关心每一个配置项，允许他们动态的设置能够节省大量的时间，代码的可读性也会更好。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>DOMTraverser</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>settings</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>settings</span> <span class=o>=</span> <span class=nx>settings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>setup</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>rootNode</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>settings</span><span class=p>.</span><span class=nx>rootNode</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>animationModule</span><span class=p>.</span><span class=nx>setup</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>traverse</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>$</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>DOMTraverser</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>rootNode</span><span class=o>:</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementsByTagName</span><span class=p>(</span><span class=s2>&#34;body&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>animationModule</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{},</span> <span class=c1>// Most of the time, we won&#39;t need to animate when traversing.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>});</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>DOMTraverser</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>settings</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>settings</span> <span class=o>=</span> <span class=nx>settings</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>options</span> <span class=o>=</span> <span class=nx>settings</span><span class=p>.</span><span class=nx>options</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>setup</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>rootNode</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>settings</span><span class=p>.</span><span class=nx>rootNode</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>setupOptions</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setupOptions</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>animationModule</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>traverse</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>$</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>DOMTraverser</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>rootNode</span><span class=o>:</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementsByTagName</span><span class=p>(</span><span class=s2>&#34;body&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>options</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>animationModule</span><span class=o>:</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><h2 id=依赖反转原则>依赖反转原则</h2><p>This principle states two essential things:</p><ol><li>High-level modules should not depend on low-level modules. Both should depend on abstractions.</li><li>Abstractions should not depend upon details. Details should depend on abstractions.</li></ol><p>This can be hard to understand at first, but if you&rsquo;ve worked with Angular.js, you&rsquo;ve seen an implementation of this principle in the form of Dependency Injection (DI). While they are not identical concepts, DIP keeps high-level modules from knowing the details of its low-level modules and setting them up. It can accomplish this through DI. A huge benefit of this is that it reduces the coupling between modules. Coupling is a very bad development pattern because it makes your code hard to refactor.</p><p>As stated previously, JavaScript doesn&rsquo;t have interfaces so the abstractions that are depended upon are implicit contracts. That is to say, the methods and properties that an object/class exposes to another object/class. In the example below, the implicit contract is that any Request module for an <code>InventoryTracker</code> will have a <code>requestItems</code> method.</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>InventoryTracker</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>items</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>items</span> <span class=o>=</span> <span class=nx>items</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// BAD: We have created a dependency on a specific request implementation.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// We should just have requestItems depend on a request method: `request`
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>this</span><span class=p>.</span><span class=nx>requester</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>InventoryRequester</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>requestItems</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>items</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>item</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>requester</span><span class=p>.</span><span class=nx>requestItem</span><span class=p>(</span><span class=nx>item</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>InventoryRequester</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>REQ_METHODS</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;HTTP&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>requestItem</span><span class=p>(</span><span class=nx>item</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>inventoryTracker</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>InventoryTracker</span><span class=p>([</span><span class=s2>&#34;apples&#34;</span><span class=p>,</span> <span class=s2>&#34;bananas&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nx>inventoryTracker</span><span class=p>.</span><span class=nx>requestItems</span><span class=p>();</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>InventoryTracker</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>items</span><span class=p>,</span> <span class=nx>requester</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>items</span> <span class=o>=</span> <span class=nx>items</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>requester</span> <span class=o>=</span> <span class=nx>requester</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>requestItems</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>items</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>item</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>requester</span><span class=p>.</span><span class=nx>requestItem</span><span class=p>(</span><span class=nx>item</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>InventoryRequesterV1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>REQ_METHODS</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;HTTP&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>requestItem</span><span class=p>(</span><span class=nx>item</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>InventoryRequesterV2</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>REQ_METHODS</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;WS&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>requestItem</span><span class=p>(</span><span class=nx>item</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// By constructing our dependencies externally and injecting them, we can easily
</span></span></span><span class=line><span class=cl><span class=c1>// substitute our request module for a fancy new one that uses WebSockets.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>let</span> <span class=nx>inventoryTracker</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>InventoryTracker</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=s2>&#34;apples&#34;</span><span class=p>,</span> <span class=s2>&#34;bananas&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=k>new</span> <span class=nx>InventoryRequesterV2</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>inventoryTracker</span><span class=p>.</span><span class=nx>requestItems</span><span class=p>();</span>
</span></span></code></pre></div><h2 id=优先选择-es6-类而不是-es5-的基本函数定义>优先选择 ES6 类而不是 ES5 的基本函数定义</h2><p>传统 ES5 的类实现语法对于类的继承、构建以及方法定义的可读性都不是很好。如果你考虑在类中实现继承，那么建议优先考虑 ES6 的类语法糖。如果你只是需要构建简单的对象，那么可以考虑使用 ES5 的基本函数定义来构造类对象。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Animal</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>age</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=k>this</span> <span class=k>instanceof</span> <span class=nx>Animal</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s2>&#34;Instantiate Animal with `new`&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>age</span> <span class=o>=</span> <span class=nx>age</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Animal</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>move</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Mammal</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>age</span><span class=p>,</span> <span class=nx>furColor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=k>this</span> <span class=k>instanceof</span> <span class=nx>Mammal</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s2>&#34;Instantiate Mammal with `new`&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>Animal</span><span class=p>.</span><span class=nx>call</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=nx>age</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>furColor</span> <span class=o>=</span> <span class=nx>furColor</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Mammal</span><span class=p>.</span><span class=nx>prototype</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=nx>Animal</span><span class=p>.</span><span class=nx>prototype</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>Mammal</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>constructor</span> <span class=o>=</span> <span class=nx>Mammal</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>Mammal</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>liveBirth</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Human</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>age</span><span class=p>,</span> <span class=nx>furColor</span><span class=p>,</span> <span class=nx>languageSpoken</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=k>this</span> <span class=k>instanceof</span> <span class=nx>Human</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s2>&#34;Instantiate Human with `new`&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>Mammal</span><span class=p>.</span><span class=nx>call</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=nx>age</span><span class=p>,</span> <span class=nx>furColor</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>languageSpoken</span> <span class=o>=</span> <span class=nx>languageSpoken</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Human</span><span class=p>.</span><span class=nx>prototype</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=nx>Mammal</span><span class=p>.</span><span class=nx>prototype</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>Human</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>constructor</span> <span class=o>=</span> <span class=nx>Human</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>Human</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>speak</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{};</span>
</span></span></code></pre></div><p><strong>Good:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Animal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>age</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>age</span> <span class=o>=</span> <span class=nx>age</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>move</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Mammal</span> <span class=kr>extends</span> <span class=nx>Animal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>age</span><span class=p>,</span> <span class=nx>furColor</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>super</span><span class=p>(</span><span class=nx>age</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>furColor</span> <span class=o>=</span> <span class=nx>furColor</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>liveBirth</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Human</span> <span class=kr>extends</span> <span class=nx>Mammal</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>age</span><span class=p>,</span> <span class=nx>furColor</span><span class=p>,</span> <span class=nx>languageSpoken</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>super</span><span class=p>(</span><span class=nx>age</span><span class=p>,</span> <span class=nx>furColor</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>languageSpoken</span> <span class=o>=</span> <span class=nx>languageSpoken</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>speak</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=use-method-chaining>Use method chaining</h2><p>Against the advice of Clean Code, this is one place where we will have to differ. It has been argued that method chaining is unclean and violates the <a href=https://en.wikipedia.org/wiki/Law_of_Demeter target=_blank rel=noopener>Law of Demeter</a>. Maybe it&rsquo;s true, but this pattern is very useful in JavaScript and you see it in many libraries such as jQuery and Lodash. It allows your code to be expressive, and less verbose. For that reason, I say, use method chaining and take a look at how clean your code will be. In your class functions, simply return <code>this</code> at the end of every function, and you can chain further class methods onto it.</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Car</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>make</span> <span class=o>=</span> <span class=s2>&#34;Honda&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>model</span> <span class=o>=</span> <span class=s2>&#34;Accord&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>color</span> <span class=o>=</span> <span class=s2>&#34;white&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setMake</span><span class=p>(</span><span class=nx>make</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setModel</span><span class=p>(</span><span class=nx>model</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>model</span> <span class=o>=</span> <span class=nx>model</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setColor</span><span class=p>(</span><span class=nx>color</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>color</span> <span class=o>=</span> <span class=nx>color</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>save</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>make</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>model</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>color</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>car</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Car</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>car</span><span class=p>.</span><span class=nx>setColor</span><span class=p>(</span><span class=s2>&#34;pink&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>car</span><span class=p>.</span><span class=nx>setMake</span><span class=p>(</span><span class=s2>&#34;Ford&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>car</span><span class=p>.</span><span class=nx>setModel</span><span class=p>(</span><span class=s2>&#34;F-150&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>car</span><span class=p>.</span><span class=nx>save</span><span class=p>();</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Car</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>make</span> <span class=o>=</span> <span class=s2>&#34;Honda&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>model</span> <span class=o>=</span> <span class=s2>&#34;Accord&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>color</span> <span class=o>=</span> <span class=s2>&#34;white&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setMake</span><span class=p>(</span><span class=nx>make</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// NOTE: Returning this for chaining
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setModel</span><span class=p>(</span><span class=nx>model</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>model</span> <span class=o>=</span> <span class=nx>model</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// NOTE: Returning this for chaining
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setColor</span><span class=p>(</span><span class=nx>color</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>color</span> <span class=o>=</span> <span class=nx>color</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// NOTE: Returning this for chaining
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=k>this</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>save</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>make</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>model</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>color</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>car</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Car</span><span class=p>().</span><span class=nx>setColor</span><span class=p>(</span><span class=s2>&#34;pink&#34;</span><span class=p>).</span><span class=nx>setMake</span><span class=p>(</span><span class=s2>&#34;Ford&#34;</span><span class=p>).</span><span class=nx>setModel</span><span class=p>(</span><span class=s2>&#34;F-150&#34;</span><span class=p>).</span><span class=nx>save</span><span class=p>();</span>
</span></span></code></pre></div><h2 id=prefer-composition-over-inheritance>Prefer composition over inheritance</h2><p>As stated famously in the <a href=https://en.wikipedia.org/wiki/Design_Patterns target=_blank rel=noopener>Gang of Four</a>, you should prefer composition over inheritance where you can. There are lots of good reasons to use inheritance and lots of good reasons to use composition. The main point for this maxim is that if your mind instinctively goes for inheritance, try to think if composition could model your problem better. In some cases it can.</p><p>You might be wondering then, &ldquo;when should I use inheritance?&rdquo; It depends on your problem at hand, but this is a decent list of when inheritance makes more sense than composition:</p><ol><li>Your inheritance represents an &ldquo;is-a&rdquo; relationship and not a &ldquo;has-a&rdquo; relationship (Animal->Human vs. User->UserDetails).</li><li>You can reuse code from the base classes (Humans can move like all animals).</li><li>You want to make global changes to derived classes by changing a base class. (Change the caloric expenditure of all animals when they move).</li></ol><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Employee</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>email</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>email</span> <span class=o>=</span> <span class=nx>email</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Bad because Employees &#34;have&#34; tax data. EmployeeTaxData is not a type of Employee
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>class</span> <span class=nx>EmployeeTaxData</span> <span class=kr>extends</span> <span class=nx>Employee</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>ssn</span><span class=p>,</span> <span class=nx>salary</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>super</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>ssn</span> <span class=o>=</span> <span class=nx>ssn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>salary</span> <span class=o>=</span> <span class=nx>salary</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Employee</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>email</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>email</span> <span class=o>=</span> <span class=nx>email</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setTaxData</span><span class=p>(</span><span class=nx>ssn</span><span class=p>,</span> <span class=nx>salary</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>taxData</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>EmployeeTaxData</span><span class=p>(</span><span class=nx>ssn</span><span class=p>,</span> <span class=nx>salary</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>EmployeeTaxData</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>ssn</span><span class=p>,</span> <span class=nx>salary</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>ssn</span> <span class=o>=</span> <span class=nx>ssn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>salary</span> <span class=o>=</span> <span class=nx>salary</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h1 id=测试>测试</h1><p>测试是代码部署前不可避免的重要步骤，如果你没有添加任何的测试，那么你在每次部署之前你压根不敢确定是否会产生什么意外情况。不同的团队对于测试覆盖率的需求不太一致，不过保持 100% 的覆盖率能够让你的团队对于代码保持较好的掌控与信赖。我们可以使用很多优秀的<a href=http://jstherightway.org/#testing-tools target=_blank rel=noopener>测试工具</a>与<a href=http://gotwarlost.github.io/istanbul/ target=_blank rel=noopener>测试覆盖率检测工具</a>，建议是对于每个新的特征或者模块都添加测试用例。如果更倾向于使用测试驱动开发，一定要注意在你打算添加新的特性或者重构当前代码之前保证测试覆盖率已经达到了预期。</p><h2 id=每个测试用例单一目标>每个测试用例单一目标</h2><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>assert</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;assert&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s2>&#34;MakeMomentJSGreatAgain&#34;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s2>&#34;handles date boundaries&#34;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>date</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>date</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MakeMomentJSGreatAgain</span><span class=p>(</span><span class=s2>&#34;1/1/2015&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>date</span><span class=p>.</span><span class=nx>addDays</span><span class=p>(</span><span class=mi>30</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>date</span><span class=p>.</span><span class=nx>shouldEqual</span><span class=p>(</span><span class=s2>&#34;1/31/2015&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>date</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MakeMomentJSGreatAgain</span><span class=p>(</span><span class=s2>&#34;2/1/2016&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>date</span><span class=p>.</span><span class=nx>addDays</span><span class=p>(</span><span class=mi>28</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>assert</span><span class=p>.</span><span class=nx>equal</span><span class=p>(</span><span class=s2>&#34;02/29/2016&#34;</span><span class=p>,</span> <span class=nx>date</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>date</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MakeMomentJSGreatAgain</span><span class=p>(</span><span class=s2>&#34;2/1/2015&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>date</span><span class=p>.</span><span class=nx>addDays</span><span class=p>(</span><span class=mi>28</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>assert</span><span class=p>.</span><span class=nx>equal</span><span class=p>(</span><span class=s2>&#34;03/01/2015&#34;</span><span class=p>,</span> <span class=nx>date</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>assert</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;assert&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>describe</span><span class=p>(</span><span class=s2>&#34;MakeMomentJSGreatAgain&#34;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s2>&#34;handles 30-day months&#34;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>date</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MakeMomentJSGreatAgain</span><span class=p>(</span><span class=s2>&#34;1/1/2015&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>date</span><span class=p>.</span><span class=nx>addDays</span><span class=p>(</span><span class=mi>30</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>date</span><span class=p>.</span><span class=nx>shouldEqual</span><span class=p>(</span><span class=s2>&#34;1/31/2015&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s2>&#34;handles leap year&#34;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>date</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MakeMomentJSGreatAgain</span><span class=p>(</span><span class=s2>&#34;2/1/2016&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>date</span><span class=p>.</span><span class=nx>addDays</span><span class=p>(</span><span class=mi>28</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>assert</span><span class=p>.</span><span class=nx>equal</span><span class=p>(</span><span class=s2>&#34;02/29/2016&#34;</span><span class=p>,</span> <span class=nx>date</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>it</span><span class=p>(</span><span class=s2>&#34;handles non-leap year&#34;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>date</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MakeMomentJSGreatAgain</span><span class=p>(</span><span class=s2>&#34;2/1/2015&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>date</span><span class=p>.</span><span class=nx>addDays</span><span class=p>(</span><span class=mi>28</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>assert</span><span class=p>.</span><span class=nx>equal</span><span class=p>(</span><span class=s2>&#34;03/01/2015&#34;</span><span class=p>,</span> <span class=nx>date</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><h1 id=并发>并发</h1><h2 id=使用-promise-替代回调>使用 Promise 替代回调</h2><p>回调含义不清晰，还会导致过深的代码嵌套，就是所谓的回调地狱。在 ES6 中，Promises 已经是内置的全局类型。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;request&#34;</span><span class=p>).</span><span class=nx>get</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;https://en.wikipedia.org/wiki/Robert_Cecil_Martin&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;fs&#34;</span><span class=p>).</span><span class=nx>writeFile</span><span class=p>(</span><span class=s2>&#34;article.html&#34;</span><span class=p>,</span> <span class=nx>response</span><span class=p>.</span><span class=nx>body</span><span class=p>,</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;File written&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;request-promise&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;https://en.wikipedia.org/wiki/Robert_Cecil_Martin&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;fs-promise&#34;</span><span class=p>).</span><span class=nx>writeFile</span><span class=p>(</span><span class=s2>&#34;article.html&#34;</span><span class=p>,</span> <span class=nx>response</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;File written&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span></code></pre></div><h2 id=asyncawait-更为清晰>Async/Await 更为清晰</h2><p>Promises 本身已经是对于回调的不错的替代，而 ES7 中的 async 与 await 则是更为清晰的解决方案，可以避免你编写大量的<code>then</code>调用链。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>require</span><span class=p>(</span><span class=s2>&#34;request-promise&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;https://en.wikipedia.org/wiki/Robert_Cecil_Martin&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;fs-promise&#34;</span><span class=p>).</span><span class=nx>writeFile</span><span class=p>(</span><span class=s2>&#34;article.html&#34;</span><span class=p>,</span> <span class=nx>response</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;File written&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>getCleanCodeArticle</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>request</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;request-promise&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>request</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;https://en.wikipedia.org/wiki/Robert_Cecil_Martin&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>fileHandle</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;fs-promise&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>await</span> <span class=nx>fileHandle</span><span class=p>.</span><span class=nx>writeFile</span><span class=p>(</span><span class=s2>&#34;article.html&#34;</span><span class=p>,</span> <span class=nx>response</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;File written&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h1 id=格式化>格式化</h1><p>就像本文的很多建议一样，格式化本身是非常主观的原则。建议是使用<a href=http://standardjs.com/rules.html target=_blank rel=noopener>工具</a> 来自动完成格式化操作，而不是争论具体的格式化的细节。</p><h2 id=相似含义变量的大写一致性>相似含义变量的大写一致性</h2><p>JavaScript 本身是无类型的，因此变量名大写也能传递很多有用的信息。这个规则算是比较主观的，建议团队可以根据自己的内部规范将相同含义变量的大小写保持一致性。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>DAYS_IN_WEEK</span> <span class=o>=</span> <span class=mi>7</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>daysInMonth</span> <span class=o>=</span> <span class=mi>30</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>songs</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;Back In Black&#34;</span><span class=p>,</span> <span class=s2>&#34;Stairway to Heaven&#34;</span><span class=p>,</span> <span class=s2>&#34;Hey Jude&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Artists</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;ACDC&#34;</span><span class=p>,</span> <span class=s2>&#34;Led Zeppelin&#34;</span><span class=p>,</span> <span class=s2>&#34;The Beatles&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>eraseDatabase</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>restore_database</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>animal</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Alpaca</span> <span class=p>{}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>DAYS_IN_WEEK</span> <span class=o>=</span> <span class=mi>7</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>DAYS_IN_MONTH</span> <span class=o>=</span> <span class=mi>30</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>songs</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;Back In Black&#34;</span><span class=p>,</span> <span class=s2>&#34;Stairway to Heaven&#34;</span><span class=p>,</span> <span class=s2>&#34;Hey Jude&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>artists</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;ACDC&#34;</span><span class=p>,</span> <span class=s2>&#34;Led Zeppelin&#34;</span><span class=p>,</span> <span class=s2>&#34;The Beatles&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>eraseDatabase</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>restoreDatabase</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Animal</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Alpaca</span> <span class=p>{}</span>
</span></span></code></pre></div><h2 id=函数的定义与调用位置尽量靠近>函数的定义与调用位置尽量靠近</h2><p>尽量将两个有相互调用关系的函数在源文件的竖直上较为接近的位置，并且将调用者放置于被调用者上方。我们习惯从上至下的阅读代码，这样的布局会提高整个代码的可读性。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>PerformanceReview</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>employee</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>employee</span> <span class=o>=</span> <span class=nx>employee</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>lookupPeers</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>db</span><span class=p>.</span><span class=nx>lookup</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>employee</span><span class=p>,</span> <span class=s2>&#34;peers&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>lookupMananger</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>db</span><span class=p>.</span><span class=nx>lookup</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>employee</span><span class=p>,</span> <span class=s2>&#34;manager&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>getPeerReviews</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>peers</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>lookupPeers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>perfReview</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>getPeerReviews</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>getManagerReview</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>getSelfReview</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>getManagerReview</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>manager</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>lookupManager</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>getSelfReview</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>review</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>PerformanceReview</span><span class=p>(</span><span class=nx>user</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>review</span><span class=p>.</span><span class=nx>perfReview</span><span class=p>();</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>PerformanceReview</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>employee</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>employee</span> <span class=o>=</span> <span class=nx>employee</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>perfReview</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>getPeerReviews</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>getManagerReview</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>getSelfReview</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>getPeerReviews</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>peers</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>lookupPeers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>lookupPeers</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>db</span><span class=p>.</span><span class=nx>lookup</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>employee</span><span class=p>,</span> <span class=s2>&#34;peers&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>getManagerReview</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>manager</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>lookupManager</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>lookupMananger</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>db</span><span class=p>.</span><span class=nx>lookup</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>employee</span><span class=p>,</span> <span class=s2>&#34;manager&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>getSelfReview</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>review</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>PerformanceReview</span><span class=p>(</span><span class=nx>employee</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>review</span><span class=p>.</span><span class=nx>perfReview</span><span class=p>();</span>
</span></span></code></pre></div><h1 id=注释>注释</h1><h2 id=仅仅对业务逻辑进行注释>仅仅对业务逻辑进行注释</h2><p>好的代码应该是见名知义，注释更多的是对于业务逻辑的描述说明。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>hashIt</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// The hash
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>hash</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Length of string
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>length</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Loop through every character in data
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Get character code.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=kr>char</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>charCodeAt</span><span class=p>(</span><span class=nx>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Make the hash
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>hash</span> <span class=o>=</span> <span class=p>(</span><span class=nx>hash</span> <span class=o>&lt;&lt;</span> <span class=mi>5</span><span class=p>)</span> <span class=o>-</span> <span class=nx>hash</span> <span class=o>+</span> <span class=kr>char</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Convert to 32-bit integer
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>hash</span> <span class=o>=</span> <span class=nx>hash</span> <span class=o>&amp;</span> <span class=nx>hash</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>hashIt</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>hash</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>length</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=kr>char</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>charCodeAt</span><span class=p>(</span><span class=nx>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>hash</span> <span class=o>=</span> <span class=p>(</span><span class=nx>hash</span> <span class=o>&lt;&lt;</span> <span class=mi>5</span><span class=p>)</span> <span class=o>-</span> <span class=nx>hash</span> <span class=o>+</span> <span class=kr>char</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Convert to 32-bit integer
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>hash</span> <span class=o>=</span> <span class=nx>hash</span> <span class=o>&amp;</span> <span class=nx>hash</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=避免保留被注释的代码>避免保留被注释的代码</h2><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>doStuff</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>// doOtherStuff();
</span></span></span><span class=line><span class=cl><span class=c1>// doSomeMoreStuff();
</span></span></span><span class=line><span class=cl><span class=c1>// doSoMuchStuff();
</span></span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>doStuff</span><span class=p>();</span>
</span></span></code></pre></div><h2 id=不要使用日记形式的注释>不要使用日记形式的注释</h2><p>千万记住，要使用版本控制工具，而不是在你的代码前面添加日记形式的注释，使用<code>git log</code>查看历史记录。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 2016-12-20: Removed monads, didn&#39;t understand them (RM)
</span></span></span><span class=line><span class=cl><span class=cm> * 2016-10-01: Improved using special monads (JP)
</span></span></span><span class=line><span class=cl><span class=cm> * 2016-02-03: Removed type-checking (LI)
</span></span></span><span class=line><span class=cl><span class=cm> * 2015-03-14: Added combine with type-checking (JR)
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>combine</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>a</span> <span class=o>+</span> <span class=nx>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>combine</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>a</span> <span class=o>+</span> <span class=nx>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=避免额外的代码标记注释>避免额外的代码标记注释</h2><p>建议是让函数与变量名来表述其功能，避免添加过多额外的注释。</p><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>////////////////////////////////////////////////////////////////////////////////
</span></span></span><span class=line><span class=cl><span class=c1>// Scope Model Instantiation
</span></span></span><span class=line><span class=cl><span class=c1>////////////////////////////////////////////////////////////////////////////////
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>let</span> <span class=nx>$scope</span><span class=p>.</span><span class=nx>model</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>menu</span><span class=o>:</span> <span class=s1>&#39;foo&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>nav</span><span class=o>:</span> <span class=s1>&#39;bar&#39;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>////////////////////////////////////////////////////////////////////////////////
</span></span></span><span class=line><span class=cl><span class=c1>// Action setup
</span></span></span><span class=line><span class=cl><span class=c1>////////////////////////////////////////////////////////////////////////////////
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>let</span> <span class=nx>actions</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>let</span> <span class=nx>$scope</span><span class=p>.</span><span class=nx>model</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>menu</span><span class=o>:</span> <span class=s1>&#39;foo&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>nav</span><span class=o>:</span> <span class=s1>&#39;bar&#39;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>actions</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h2 id=避免在源文件中添加法律声明>避免在源文件中添加法律声明</h2><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>The MIT License (MIT)
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>Copyright (c) 2016 Ryan McDermott
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>Permission is hereby granted, free of charge, to any person obtaining a copy
</span></span></span><span class=line><span class=cl><span class=cm>of this software and associated documentation files (the &#34;Software&#34;), to deal
</span></span></span><span class=line><span class=cl><span class=cm>in the Software without restriction, including without limitation the rights
</span></span></span><span class=line><span class=cl><span class=cm>to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
</span></span></span><span class=line><span class=cl><span class=cm>copies of the Software, and to permit persons to whom the Software is
</span></span></span><span class=line><span class=cl><span class=cm>furnished to do so, subject to the following conditions:
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>The above copyright notice and this permission notice shall be included in all
</span></span></span><span class=line><span class=cl><span class=cm>copies or substantial portions of the Software.
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>THE SOFTWARE IS PROVIDED &#34;AS IS&#34;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
</span></span></span><span class=line><span class=cl><span class=cm>IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
</span></span></span><span class=line><span class=cl><span class=cm>FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
</span></span></span><span class=line><span class=cl><span class=cm>AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
</span></span></span><span class=line><span class=cl><span class=cm>LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
</span></span></span><span class=line><span class=cl><span class=cm>OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
</span></span></span><span class=line><span class=cl><span class=cm>SOFTWARE
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>calculateBill</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p><strong>Good</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>calculateBill</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h1 id=错误处理>错误处理</h1><p>在 JavaScript 中抛出错误是个不错的实践，不仅可以帮助开发者即时感知程序中出现的错误，还能立刻终止程序执行并且打印出其调用栈。</p><h2 id=不要忽略被捕获的错误>不要忽略被捕获的错误</h2><p>如果我们只是简单地捕获错误而没有将其反馈给相对应的开发人员或者将该错误记录下来，那么我们进行错误处理就没有什么意义。</p><p><strong>Bad:</strong></p><pre tabindex=0><code>try {
  functionThatMightThrow();
} catch (error) {
  console.log(error);
}
</code></pre><p><strong>Good:</strong></p><pre tabindex=0><code>try {
  functionThatMightThrow();
} catch (error) {
  // One option (more noisy than console.log):
  console.error(error);
  // Another option:
  notifyUserOfError(error);
  // Another option:
  reportErrorToService(error);
  // OR do all three!
}
</code></pre><h2 id=不要忽略被拒绝的-promises>不要忽略被拒绝的 Promises</h2><p><strong>Bad:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>getdata</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>data</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>functionThatMightThrow</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=k>catch</span><span class=p>((</span><span class=nx>error</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span></code></pre></div><p><strong>Good:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>getdata</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>data</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>functionThatMightThrow</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=k>catch</span><span class=p>((</span><span class=nx>error</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// One option (more noisy than console.log):
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Another option:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>notifyUserOfError</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Another option:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>reportErrorToService</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// OR do all three!
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>});</span>
</span></span></code></pre></div><blockquote><p>延伸阅读</p><p><a href=https://zhuanlan.zhihu.com/wx-chevalier target=_blank rel=noopener>知乎专栏：某熊的全栈之路</a> ><a href=https://zhuanlan.zhihu.com/c_67532981 target=_blank rel=noopener>知乎专栏：前端当自强</a> ><a href=https://zhuanlan.zhihu.com/lotuc target=_blank rel=noopener>知乎专栏：lotuc 的编程之路</a> ><a href="https://zhuanlan.zhihu.com/p/24476917?refer=wx-chevalier" target=_blank rel=noopener>2016- 我的技术之路 : 编程知识体系结构</a> ><a href="https://zhuanlan.zhihu.com/p/24575395?refer=wx-chevalier" target=_blank rel=noopener>2016- 我的前端之路 : 工具化与工程化</a> ><a href="https://zhuanlan.zhihu.com/p/24516669?refer=wx-chevalier" target=_blank rel=noopener>某熊周刊系列 : 一周推荐外文技术资料 (12.1)</a></p></blockquote></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>下一页</div><a href=/books/javascript-notes/%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/%E7%BC%96%E7%A0%81%E8%A7%84%E7%BA%A6/%E6%80%A7%E8%83%BD%E8%A7%84%E7%BA%A6/ rel=prev>性能规约</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div><script type=text/javascript id=clstr_globe async src="//clustrmaps.com/globe.js?d=kgpJG5sWZQpKujBmD-uW1B54-WBPol-DuDtrB2KFjKs"></script></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>