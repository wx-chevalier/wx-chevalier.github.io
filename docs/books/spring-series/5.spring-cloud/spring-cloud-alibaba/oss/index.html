<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="Next-gen Tech Edu"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/spring-series/5.spring-cloud/spring-cloud-alibaba/oss/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=alternate href=/books/spring-series/5.spring-cloud/spring-cloud-alibaba/oss/index.xml type=application/rss+xml title="Next-gen Tech Edu"><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/spring-series/5.spring-cloud/spring-cloud-alibaba/oss/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/spring-series/5.spring-cloud/spring-cloud-alibaba/oss/"><meta property="og:title" content="OSS | Next-gen Tech Edu"><meta property="og:description" content="Next-gen Tech Edu"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>OSS | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=97fce70bb270ab87dd57fb5c696caf21><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">Spring Cloud Alibaba</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id025af9bc655a72a9cdbb8528f295dea3")' href=#id025af9bc655a72a9cdbb8528f295dea3 aria-expanded=false aria-controls=id025af9bc655a72a9cdbb8528f295dea3 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/5.spring-cloud/>5.Spring Cloud</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id025af9bc655a72a9cdbb8528f295dea3 aria-expanded=false aria-controls=id025af9bc655a72a9cdbb8528f295dea3><i class="fa-solid fa-angle-down" id=caret-id025af9bc655a72a9cdbb8528f295dea3></i></a></div><ul class="nav docs-sidenav collapse show" id=id025af9bc655a72a9cdbb8528f295dea3><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ideffb5259273c31074c2532e0b04f17c7")' href=#ideffb5259273c31074c2532e0b04f17c7 aria-expanded=false aria-controls=ideffb5259273c31074c2532e0b04f17c7 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/5.spring-cloud/spring-cloud-alibaba/>Spring Cloud Alibaba</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ideffb5259273c31074c2532e0b04f17c7 aria-expanded=false aria-controls=ideffb5259273c31074c2532e0b04f17c7><i class="fa-solid fa-angle-down" id=caret-ideffb5259273c31074c2532e0b04f17c7></i></a></div><ul class="nav docs-sidenav collapse show" id=ideffb5259273c31074c2532e0b04f17c7><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id0a81aa72c9283321520ecc2938d8bc99")' href=#id0a81aa72c9283321520ecc2938d8bc99 aria-expanded=false aria-controls=id0a81aa72c9283321520ecc2938d8bc99 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/5.spring-cloud/spring-cloud-alibaba/nacos/>Nacos</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id0a81aa72c9283321520ecc2938d8bc99 aria-expanded=false aria-controls=id0a81aa72c9283321520ecc2938d8bc99><i class="fa-solid fa-angle-right" id=caret-id0a81aa72c9283321520ecc2938d8bc99></i></a></div><ul class="nav docs-sidenav collapse" id=id0a81aa72c9283321520ecc2938d8bc99><li class="child level"><a href=/books/spring-series/5.spring-cloud/spring-cloud-alibaba/nacos/%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E5%8F%91%E7%8E%B0/>服务注册与发现</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id04dfbb3b2b91f7cc74e75e5abb76b66d")' href=#id04dfbb3b2b91f7cc74e75e5abb76b66d aria-expanded=false aria-controls=id04dfbb3b2b91f7cc74e75e5abb76b66d aria-hidden=false data-toggle=collapse></div></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idc4cf26813efd85fcb1b0dfe946033d06")' href=#idc4cf26813efd85fcb1b0dfe946033d06 aria-expanded=false aria-controls=idc4cf26813efd85fcb1b0dfe946033d06 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/5.spring-cloud/spring-cloud-alibaba/sentinel/>Sentinel</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idc4cf26813efd85fcb1b0dfe946033d06 aria-expanded=false aria-controls=idc4cf26813efd85fcb1b0dfe946033d06><i class="fa-solid fa-angle-right" id=caret-idc4cf26813efd85fcb1b0dfe946033d06></i></a></div><ul class="nav docs-sidenav collapse" id=idc4cf26813efd85fcb1b0dfe946033d06><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idb7fd1f1a1236e27537738a44433e98a3")' href=#idb7fd1f1a1236e27537738a44433e98a3 aria-expanded=false aria-controls=idb7fd1f1a1236e27537738a44433e98a3 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/5.spring-cloud/spring-cloud-alibaba/sentinel/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/>999.参考资料</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idb7fd1f1a1236e27537738a44433e98a3 aria-expanded=false aria-controls=idb7fd1f1a1236e27537738a44433e98a3><i class="fa-solid fa-angle-right" id=caret-idb7fd1f1a1236e27537738a44433e98a3></i></a></div><ul class="nav docs-sidenav collapse" id=idb7fd1f1a1236e27537738a44433e98a3><li class="child level"><a href=/books/spring-series/5.spring-cloud/spring-cloud-alibaba/sentinel/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2019-sentinel-%E5%AE%9E%E7%8E%B0%E7%86%94%E6%96%AD%E4%B8%8E%E9%99%90%E6%B5%81/>2019-Sentinel 实现熔断与限流</a></li></ul></div></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idd3c54a047dcb760d9d5127c45c2db6a9")' href=#idd3c54a047dcb760d9d5127c45c2db6a9 aria-expanded=false aria-controls=idd3c54a047dcb760d9d5127c45c2db6a9 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/5.spring-cloud/spring-cloud-alibaba/sofa/>Sofa</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idd3c54a047dcb760d9d5127c45c2db6a9 aria-expanded=false aria-controls=idd3c54a047dcb760d9d5127c45c2db6a9><i class="fa-solid fa-angle-right" id=caret-idd3c54a047dcb760d9d5127c45c2db6a9></i></a></div><ul class="nav docs-sidenav collapse" id=idd3c54a047dcb760d9d5127c45c2db6a9><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idc98502aa767d69da015b1c3f0433f75f")' href=#idc98502aa767d69da015b1c3f0433f75f aria-expanded=false aria-controls=idc98502aa767d69da015b1c3f0433f75f aria-hidden=false data-toggle=collapse></div></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idaac0202b2df5b8be59e4336331494027")' href=#idaac0202b2df5b8be59e4336331494027 aria-expanded=false aria-controls=idaac0202b2df5b8be59e4336331494027 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/5.spring-cloud/spring-cloud-alibaba/sofa/sofaboot/>SOFABoot</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idaac0202b2df5b8be59e4336331494027 aria-expanded=false aria-controls=idaac0202b2df5b8be59e4336331494027><i class="fa-solid fa-angle-right" id=caret-idaac0202b2df5b8be59e4336331494027></i></a></div><ul class="nav docs-sidenav collapse" id=idaac0202b2df5b8be59e4336331494027><li class="child level"><a href=/books/spring-series/5.spring-cloud/spring-cloud-alibaba/sofa/sofaboot/%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/>快速开始</a></li><li class="child level"><a href=/books/spring-series/5.spring-cloud/spring-cloud-alibaba/sofa/sofaboot/%E6%A8%A1%E5%9D%97%E9%9A%94%E7%A6%BB/>模块隔离</a></li></ul></div></ul></div></ul></div><li class="child level"><a href=/books/spring-series/5.spring-cloud/spring-cloud-config/>Spring Cloud Config</a></li><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id755e1ddd2dc8b990a328be4b97d301b9")' href=#id755e1ddd2dc8b990a328be4b97d301b9 aria-expanded=false aria-controls=id755e1ddd2dc8b990a328be4b97d301b9 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/5.spring-cloud/spring-cloud-netflix/>Spring Cloud Netflix</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id755e1ddd2dc8b990a328be4b97d301b9 aria-expanded=false aria-controls=id755e1ddd2dc8b990a328be4b97d301b9><i class="fa-solid fa-angle-right" id=caret-id755e1ddd2dc8b990a328be4b97d301b9></i></a></div><ul class="nav docs-sidenav collapse" id=id755e1ddd2dc8b990a328be4b97d301b9><li class="child level"><a href=/books/spring-series/5.spring-cloud/spring-cloud-netflix/spring-cloud-config/>Spring Cloud Config</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id019a3e0d67d6227576868740ca07927a")' href=#id019a3e0d67d6227576868740ca07927a aria-expanded=false aria-controls=id019a3e0d67d6227576868740ca07927a aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/5.spring-cloud/spring-cloud-openfeign/>Spring Cloud OpenFeign</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id019a3e0d67d6227576868740ca07927a aria-expanded=false aria-controls=id019a3e0d67d6227576868740ca07927a><i class="fa-solid fa-angle-right" id=caret-id019a3e0d67d6227576868740ca07927a></i></a></div><ul class="nav docs-sidenav collapse" id=id019a3e0d67d6227576868740ca07927a><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idfd976f72f7b2b70d8ddf4d9fb4a59041")' href=#idfd976f72f7b2b70d8ddf4d9fb4a59041 aria-expanded=false aria-controls=idfd976f72f7b2b70d8ddf4d9fb4a59041 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/5.spring-cloud/spring-cloud-openfeign/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/>999.参考资料</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idfd976f72f7b2b70d8ddf4d9fb4a59041 aria-expanded=false aria-controls=idfd976f72f7b2b70d8ddf4d9fb4a59041><i class="fa-solid fa-angle-right" id=caret-idfd976f72f7b2b70d8ddf4d9fb4a59041></i></a></div><ul class="nav docs-sidenav collapse" id=idfd976f72f7b2b70d8ddf4d9fb4a59041><li class="child level"><a href=/books/spring-series/5.spring-cloud/spring-cloud-openfeign/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2021-springcloud-openfeign-%E6%95%99%E7%A8%8B/>2021-SpringCloud OpenFeign 教程</a></li></ul></div></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id528c2b50e898b96cf7878a2322218fe5")' href=#id528c2b50e898b96cf7878a2322218fe5 aria-expanded=false aria-controls=id528c2b50e898b96cf7878a2322218fe5 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/5.spring-cloud/spring-cloud-square/>Spring Cloud Square</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id528c2b50e898b96cf7878a2322218fe5 aria-expanded=false aria-controls=id528c2b50e898b96cf7878a2322218fe5><i class="fa-solid fa-angle-right" id=caret-id528c2b50e898b96cf7878a2322218fe5></i></a></div><ul class="nav docs-sidenav collapse" id=id528c2b50e898b96cf7878a2322218fe5><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id380a9f67253b866621326d70f6cd9009")' href=#id380a9f67253b866621326d70f6cd9009 aria-expanded=false aria-controls=id380a9f67253b866621326d70f6cd9009 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/5.spring-cloud/spring-cloud-square/retrofit/>Retrofit</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id380a9f67253b866621326d70f6cd9009 aria-expanded=false aria-controls=id380a9f67253b866621326d70f6cd9009><i class="fa-solid fa-angle-right" id=caret-id380a9f67253b866621326d70f6cd9009></i></a></div><ul class="nav docs-sidenav collapse" id=id380a9f67253b866621326d70f6cd9009><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idcd64c61c4e839ad275a3bdbfdeea531a")' href=#idcd64c61c4e839ad275a3bdbfdeea531a aria-expanded=false aria-controls=idcd64c61c4e839ad275a3bdbfdeea531a aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/5.spring-cloud/spring-cloud-square/retrofit/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/>999.参考资料</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idcd64c61c4e839ad275a3bdbfdeea531a aria-expanded=false aria-controls=idcd64c61c4e839ad275a3bdbfdeea531a><i class="fa-solid fa-angle-right" id=caret-idcd64c61c4e839ad275a3bdbfdeea531a></i></a></div><ul class="nav docs-sidenav collapse" id=idcd64c61c4e839ad275a3bdbfdeea531a><li class="child level"><a href=/books/spring-series/5.spring-cloud/spring-cloud-square/retrofit/999.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2022-%E8%BF%98%E5%9C%A8%E7%94%A8-feign%E6%8E%A8%E8%8D%90%E4%B8%80%E6%AC%BE%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%97%B4%E8%B0%83%E7%94%A8%E7%A5%9E%E5%99%A8%E8%B7%9F-springcloud-%E7%BB%9D%E9%85%8D/>2022-还在用 Feign？推荐一款微服务间调用神器，跟 SpringCloud 绝配！</a></li></ul></div></ul></div></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#客户端直传>客户端直传</a></li><li><a href=#服务端签名后直传>服务端签名后直传</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>OSS</h1><div class=article-style><h1 id=oss>OSS</h1><h1 id=客户端文件上传>客户端文件上传</h1><h2 id=客户端直传>客户端直传</h2><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://s2.ax1x.com/2019/09/05/nu1JJA.md.png alt loading=lazy data-zoomable></div></div></figure></p><p>首先从服务端获取 OSS 令牌，用的 browser 版本 sdk 的 ali-oss，根据 OSS 相关信息创建 ossClient，然后使用类似 <code>ossClient.put(path, file)</code> 的方法上传，并更新 Upload 里的 fileList。首先构建 ossClientCreator：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>OSS</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;ali-oss&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>interface</span> <span class=nx>IOssConfig</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>accessKeyId</span><span class=o>:</span> <span class=nx>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>accessKeySecret</span><span class=o>:</span> <span class=nx>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>securityToken</span><span class=o>:</span> <span class=nx>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>region</span><span class=o>:</span> <span class=nx>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>bucket</span><span class=o>:</span> <span class=nx>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>endpoint</span><span class=o>:</span> <span class=nx>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nx>propName</span><span class=o>:</span> <span class=nx>string</span><span class=p>]</span><span class=o>:</span> <span class=nx>any</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>(</span><span class=nx>ossConfig</span><span class=o>:</span> <span class=nx>IOssConfig</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>new</span> <span class=nx>OSS</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>accessKeyId</span><span class=o>:</span> <span class=nx>ossConfig</span><span class=p>.</span><span class=nx>accessKeyId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>accessKeySecret</span><span class=o>:</span> <span class=nx>ossConfig</span><span class=p>.</span><span class=nx>accessKeySecret</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>stsToken</span><span class=o>:</span> <span class=nx>ossConfig</span><span class=p>.</span><span class=nx>securityToken</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>region</span><span class=o>:</span> <span class=nx>ossConfig</span><span class=p>.</span><span class=nx>region</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>bucket</span><span class=o>:</span> <span class=nx>ossConfig</span><span class=p>.</span><span class=nx>bucket</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=nx>http</span> <span class=nx>from</span> <span class=s1>&#39;../httpService&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>IOssConfig</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;src/utils/ossClientCreator&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>async</span> <span class=kd>function</span> <span class=nx>getOssConfig</span><span class=p>()</span><span class=o>:</span> <span class=nb>Promise</span><span class=o>&lt;</span><span class=nx>IOssConfig</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>res</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>http</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/api/services/app/Util/OssToken&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>async</span> <span class=kd>function</span> <span class=nx>multipartUpload</span><span class=p>(</span><span class=nx>ossClient</span><span class=o>:</span> <span class=nx>any</span><span class=p>,</span> <span class=nx>path</span><span class=o>:</span> <span class=nx>string</span><span class=p>,</span> <span class=nx>file</span><span class=o>:</span> <span class=nx>File</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>ossRes</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>ossClient</span><span class=p>.</span><span class=nx>multipartUpload</span><span class=p>(</span><span class=nx>path</span><span class=p>,</span> <span class=nx>file</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>url</span><span class=o>:</span> <span class=nx>string</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>ossRes</span> <span class=o>&amp;&amp;</span> <span class=nx>ossRes</span><span class=p>.</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>url</span> <span class=o>=</span> <span class=sb>`http://</span><span class=si>${</span><span class=nx>ossClient</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>bucket</span><span class=si>}</span><span class=sb>.</span><span class=si>${</span><span class=nx>ossClient</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>endpoint</span><span class=p>.</span><span class=nx>host</span><span class=si>}</span><span class=sb>/</span><span class=si>${</span><span class=nx>ossRes</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;上传失败&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>ossClient</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>url</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>async</span> <span class=kd>function</span> <span class=nx>put</span><span class=p>(</span><span class=nx>ossClient</span><span class=o>:</span> <span class=nx>any</span><span class=p>,</span> <span class=nx>path</span><span class=o>:</span> <span class=nx>string</span><span class=p>,</span> <span class=nx>file</span><span class=o>:</span> <span class=nx>File</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>ossRes</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>ossClient</span><span class=p>.</span><span class=nx>put</span><span class=p>(</span><span class=nx>path</span><span class=p>,</span> <span class=nx>file</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>url</span><span class=o>:</span> <span class=nx>string</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>ossRes</span> <span class=o>&amp;&amp;</span> <span class=nx>ossRes</span><span class=p>.</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>url</span> <span class=o>=</span> <span class=sb>`http://</span><span class=si>${</span><span class=nx>ossClient</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>bucket</span><span class=si>}</span><span class=sb>.</span><span class=si>${</span><span class=nx>ossClient</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>endpoint</span><span class=p>.</span><span class=nx>host</span><span class=si>}</span><span class=sb>/</span><span class=si>${</span><span class=nx>ossRes</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;上传失败&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>ossClient</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>url</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>async</span> <span class=kd>function</span> <span class=nx>upload</span><span class=p>(</span><span class=nx>ossClient</span><span class=o>:</span> <span class=nx>any</span><span class=p>,</span> <span class=nx>path</span><span class=o>:</span> <span class=nx>string</span><span class=p>,</span> <span class=nx>file</span><span class=o>:</span> <span class=nx>File</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>size</span> <span class=o>=</span> <span class=nx>file</span><span class=p>.</span><span class=nx>size</span> <span class=o>/</span> <span class=mi>1024</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>size</span> <span class=o>&gt;</span> <span class=mi>100</span> <span class=o>*</span> <span class=mi>1024</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span> <span class=s1>&#39;附件大小不能超过100M&#39;</span><span class=p>)</span><span class=err>；</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>size</span> <span class=o>&gt;</span> <span class=mi>50</span> <span class=o>*</span> <span class=mi>1024</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kr>await</span> <span class=nx>multipartUpload</span><span class=p>(</span><span class=nx>ossClient</span><span class=p>,</span> <span class=nx>path</span><span class=p>,</span> <span class=nx>file</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>ossClient</span><span class=p>.</span><span class=nx>put</span><span class=p>(</span><span class=nx>path</span><span class=p>,</span> <span class=nx>file</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// console.log(result, &#39;上传成功&#39;);
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>let</span> <span class=nx>url</span><span class=o>:</span> <span class=nx>string</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>result</span> <span class=o>&amp;&amp;</span> <span class=nx>result</span><span class=p>.</span><span class=nx>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>url</span> <span class=o>=</span> <span class=sb>`http://</span><span class=si>${</span><span class=nx>ossClient</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>bucket</span><span class=si>}</span><span class=sb>.</span><span class=si>${</span><span class=nx>ossClient</span><span class=p>.</span><span class=nx>options</span><span class=p>.</span><span class=nx>endpoint</span><span class=p>.</span><span class=nx>host</span><span class=si>}</span><span class=sb>/</span><span class=si>${</span><span class=nx>result</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s1>&#39;上传失败&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>ossClient</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>url</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>getOssConfig</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>multipartUpload</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>put</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>upload</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>在上传组件的加载完毕的事件中，加载 OSS 配置：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>async</span> <span class=nx>componentDidMount</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>config</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>ossService</span><span class=p>.</span><span class=nx>getOssConfig</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>client</span> <span class=o>=</span> <span class=nx>ossClientCreator</span><span class=p>(</span><span class=nx>config</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></div><p>然后如下封装 Antd 的 Upload 组件：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>&lt;</span><span class=nx>Upload</span>
</span></span><span class=line><span class=cl>  <span class=nx>customRequest</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=o>:</span> <span class=nx>any</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>client</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>ossService</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>put</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>client</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;upload/&#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>          <span class=nx>e</span><span class=p>.</span><span class=nx>file</span><span class=p>.</span><span class=nx>uid</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/-/g</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;.&#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>          <span class=nx>e</span><span class=p>.</span><span class=nx>file</span><span class=p>.</span><span class=nx>type</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span><span class=sr>/image\/(\w*)/</span><span class=p>)[</span><span class=mi>1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=nx>e</span><span class=p>.</span><span class=nx>file</span>
</span></span><span class=line><span class=cl>      <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>url</span><span class=o>:</span> <span class=nx>any</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>index</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>fileList</span><span class=p>.</span><span class=nx>findIndex</span><span class=p>(</span>
</span></span><span class=line><span class=cl>          <span class=p>(</span><span class=nx>n</span><span class=o>:</span> <span class=nx>UploadFile</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>n</span><span class=p>.</span><span class=nx>uid</span> <span class=o>===</span> <span class=nx>e</span><span class=p>.</span><span class=nx>file</span><span class=p>.</span><span class=nx>uid</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>index</span> <span class=o>&gt;</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>fileList</span><span class=p>[</span><span class=nx>index</span><span class=p>].</span><span class=nx>url</span> <span class=o>=</span> <span class=nx>url</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>fileList</span><span class=p>[</span><span class=nx>index</span><span class=p>].</span><span class=nx>status</span> <span class=o>=</span> <span class=s2>&#34;done&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>fileList</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=p>...</span><span class=nx>e</span><span class=p>.</span><span class=nx>file</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>status</span><span class=o>:</span> <span class=s2>&#34;done&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>url</span><span class=o>:</span> <span class=nx>url</span>
</span></span><span class=line><span class=cl>          <span class=p>});</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=p>{</span> <span class=nx>onUpdate</span> <span class=p>}</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>onUpdate</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>onUpdate</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>fileList</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=p>.</span><span class=nx>setState</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>fileList</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>state</span><span class=p>.</span><span class=nx>fileList</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}}</span>
</span></span><span class=line><span class=cl>  <span class=nx>listType</span><span class=o>=</span><span class=s2>&#34;picture-card&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nx>fileList</span><span class=o>=</span><span class=p>{</span><span class=nx>fileList</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>onPreview</span><span class=o>=</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>handlePreview</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>onChange</span><span class=o>=</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>handleChange</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>onRemove</span><span class=o>=</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>handleRemove</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>multiple</span><span class=o>=</span><span class=p>{</span><span class=kc>true</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=nx>uploadButton</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=err>/Upload&gt;</span>
</span></span></code></pre></div><h2 id=服务端签名后直传>服务端签名后直传</h2><p>采用 JavaScript 客户端直接签名时，AccessKeyID 和 AcessKeySecret 会暴露在前端页面，因此存在严重的安全隐患。因此，OSS 提供了服务端签名后直传的方案。</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://s2.ax1x.com/2019/09/16/nfFKpD.png alt=非直传架构 loading=lazy data-zoomable></div></div></figure></p><p>服务端签名后直传的原理如下：用户发送上传 Policy 请求到应用服务器、应用服务器返回上传 Policy 和签名给用户、用户直接上传数据到 OSS。</p><ul><li>签名直传服务</li></ul><p>签名直传服务响应客户端发送给应用服务器的 GET 消息。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>protected</span> <span class=kt>void</span> <span class=nf>doGet</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>request</span><span class=o>,</span> <span class=n>HttpServletResponse</span> <span class=n>response</span><span class=o>)</span>
</span></span><span class=line><span class=cl>			<span class=kd>throws</span> <span class=n>ServletException</span><span class=o>,</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>accessId</span> <span class=o>=</span> <span class=s>&#34;&lt;yourAccessKeyId&gt;&#34;</span><span class=o>;</span> <span class=c1>// 请填写您的AccessKeyId。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>String</span> <span class=n>accessKey</span> <span class=o>=</span> <span class=s>&#34;&lt;yourAccessKeySecret&gt;&#34;</span><span class=o>;</span> <span class=c1>// 请填写您的AccessKeySecret。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>String</span> <span class=n>endpoint</span> <span class=o>=</span> <span class=s>&#34;oss-cn-hangzhou.aliyuncs.com&#34;</span><span class=o>;</span> <span class=c1>// 请填写您的 endpoint。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>String</span> <span class=n>bucket</span> <span class=o>=</span> <span class=s>&#34;bucket-name&#34;</span><span class=o>;</span> <span class=c1>// 请填写您的 bucketname。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>String</span> <span class=n>host</span> <span class=o>=</span> <span class=s>&#34;https://&#34;</span> <span class=o>+</span> <span class=n>bucket</span> <span class=o>+</span> <span class=s>&#34;.&#34;</span> <span class=o>+</span> <span class=n>endpoint</span><span class=o>;</span> <span class=c1>// host的格式为 bucketname.endpoint
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// callbackUrl为 上传回调服务器的URL，请将下面的IP和Port配置为您自己的真实信息。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>String</span> <span class=n>callbackUrl</span> <span class=o>=</span> <span class=s>&#34;http://88.88.88.88:8888&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>dir</span> <span class=o>=</span> <span class=s>&#34;user-dir-prefix/&#34;</span><span class=o>;</span> <span class=c1>// 用户上传文件时指定的前缀。
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=n>OSSClient</span> <span class=n>client</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OSSClient</span><span class=o>(</span><span class=n>endpoint</span><span class=o>,</span> <span class=n>accessId</span><span class=o>,</span> <span class=n>accessKey</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>long</span> <span class=n>expireTime</span> <span class=o>=</span> <span class=mi>30</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>long</span> <span class=n>expireEndTime</span> <span class=o>=</span> <span class=n>System</span><span class=o>.</span><span class=na>currentTimeMillis</span><span class=o>()</span> <span class=o>+</span> <span class=n>expireTime</span> <span class=o>*</span> <span class=mi>1000</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Date</span> <span class=n>expiration</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Date</span><span class=o>(</span><span class=n>expireEndTime</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>PolicyConditions</span> <span class=n>policyConds</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PolicyConditions</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>policyConds</span><span class=o>.</span><span class=na>addConditionItem</span><span class=o>(</span><span class=n>PolicyConditions</span><span class=o>.</span><span class=na>COND_CONTENT_LENGTH_RANGE</span><span class=o>,</span> <span class=mi>0</span><span class=o>,</span> <span class=mi>1048576000</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>policyConds</span><span class=o>.</span><span class=na>addConditionItem</span><span class=o>(</span><span class=n>MatchMode</span><span class=o>.</span><span class=na>StartWith</span><span class=o>,</span> <span class=n>PolicyConditions</span><span class=o>.</span><span class=na>COND_KEY</span><span class=o>,</span> <span class=n>dir</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>postPolicy</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=na>generatePostPolicy</span><span class=o>(</span><span class=n>expiration</span><span class=o>,</span> <span class=n>policyConds</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>byte</span><span class=o>[]</span> <span class=n>binaryData</span> <span class=o>=</span> <span class=n>postPolicy</span><span class=o>.</span><span class=na>getBytes</span><span class=o>(</span><span class=s>&#34;utf-8&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>encodedPolicy</span> <span class=o>=</span> <span class=n>BinaryUtil</span><span class=o>.</span><span class=na>toBase64String</span><span class=o>(</span><span class=n>binaryData</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>postSignature</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=na>calculatePostSignature</span><span class=o>(</span><span class=n>postPolicy</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>respMap</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LinkedHashMap</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>String</span><span class=o>&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=n>respMap</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;accessid&#34;</span><span class=o>,</span> <span class=n>accessId</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>respMap</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;policy&#34;</span><span class=o>,</span> <span class=n>encodedPolicy</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>respMap</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;signature&#34;</span><span class=o>,</span> <span class=n>postSignature</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>respMap</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;dir&#34;</span><span class=o>,</span> <span class=n>dir</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>respMap</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;host&#34;</span><span class=o>,</span> <span class=n>host</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>respMap</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;expire&#34;</span><span class=o>,</span> <span class=n>String</span><span class=o>.</span><span class=na>valueOf</span><span class=o>(</span><span class=n>expireEndTime</span> <span class=o>/</span> <span class=mi>1000</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=c1>// respMap.put(&#34;expire&#34;, formatISO8601Date(expiration));
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=n>JSONObject</span> <span class=n>jasonCallback</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JSONObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>jasonCallback</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;callbackUrl&#34;</span><span class=o>,</span> <span class=n>callbackUrl</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>jasonCallback</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;callbackBody&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=s>&#34;filename=${object}&amp;size=${size}&amp;mimeType=${mimeType}&amp;height=${imageInfo.height}&amp;width=${imageInfo.width}&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>jasonCallback</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;callbackBodyType&#34;</span><span class=o>,</span> <span class=s>&#34;application/x-www-form-urlencoded&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>base64CallbackBody</span> <span class=o>=</span> <span class=n>BinaryUtil</span><span class=o>.</span><span class=na>toBase64String</span><span class=o>(</span><span class=n>jasonCallback</span><span class=o>.</span><span class=na>toString</span><span class=o>().</span><span class=na>getBytes</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>respMap</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;callback&#34;</span><span class=o>,</span> <span class=n>base64CallbackBody</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>JSONObject</span> <span class=n>ja1</span> <span class=o>=</span> <span class=n>JSONObject</span><span class=o>.</span><span class=na>fromObject</span><span class=o>(</span><span class=n>respMap</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// System.out.println(ja1.toString());
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>response</span><span class=o>.</span><span class=na>setHeader</span><span class=o>(</span><span class=s>&#34;Access-Control-Allow-Origin&#34;</span><span class=o>,</span> <span class=s>&#34;*&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span><span class=o>.</span><span class=na>setHeader</span><span class=o>(</span><span class=s>&#34;Access-Control-Allow-Methods&#34;</span><span class=o>,</span> <span class=s>&#34;GET, POST&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span><span class=o>(</span><span class=n>request</span><span class=o>,</span> <span class=n>response</span><span class=o>,</span> <span class=n>ja1</span><span class=o>.</span><span class=na>toString</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Assert.fail(e.getMessage());
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>e</span><span class=o>.</span><span class=na>getMessage</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>在前端使用中，即将返回的前面参数拼接到请求服务中：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;key&#39;</span> <span class=o>:</span> <span class=nx>g_object_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;policy&#39;</span><span class=o>:</span> <span class=nx>policyBase64</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;OSSAccessKeyId&#39;</span><span class=o>:</span> <span class=nx>accessid</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;success_action_status&#39;</span> <span class=o>:</span> <span class=s1>&#39;200&#39;</span><span class=p>,</span> <span class=c1>//让服务端返回200,不然，默认会返回204
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=s1>&#39;callback&#39;</span> <span class=o>:</span> <span class=nx>callbackbody</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;signature&#39;</span><span class=o>:</span> <span class=nx>signature</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li>上传回调服务</li></ul><p>上传回调服务响应 OSS 发送给应用服务器的 POST 消息。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>protected</span> <span class=kt>boolean</span> <span class=nf>VerifyOSSCallbackRequest</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>request</span><span class=o>,</span> <span class=n>String</span> <span class=n>ossCallbackBody</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=kd>throws</span> <span class=n>NumberFormatException</span><span class=o>,</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>boolean</span> <span class=n>ret</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>autorizationInput</span> <span class=o>=</span> <span class=k>new</span> <span class=n>String</span><span class=o>(</span><span class=n>request</span><span class=o>.</span><span class=na>getHeader</span><span class=o>(</span><span class=s>&#34;Authorization&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>pubKeyInput</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=na>getHeader</span><span class=o>(</span><span class=s>&#34;x-oss-pub-key-url&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>byte</span><span class=o>[]</span> <span class=n>authorization</span> <span class=o>=</span> <span class=n>BinaryUtil</span><span class=o>.</span><span class=na>fromBase64String</span><span class=o>(</span><span class=n>autorizationInput</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>byte</span><span class=o>[]</span> <span class=n>pubKey</span> <span class=o>=</span> <span class=n>BinaryUtil</span><span class=o>.</span><span class=na>fromBase64String</span><span class=o>(</span><span class=n>pubKeyInput</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>pubKeyAddr</span> <span class=o>=</span> <span class=k>new</span> <span class=n>String</span><span class=o>(</span><span class=n>pubKey</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(!</span><span class=n>pubKeyAddr</span><span class=o>.</span><span class=na>startsWith</span><span class=o>(</span><span class=s>&#34;https://gosspublic.alicdn.com/&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>pubKeyAddr</span><span class=o>.</span><span class=na>startsWith</span><span class=o>(</span><span class=s>&#34;https://gosspublic.alicdn.com/&#34;</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;pub key addr must be oss addrss&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>retString</span> <span class=o>=</span> <span class=n>executeGet</span><span class=o>(</span><span class=n>pubKeyAddr</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>retString</span> <span class=o>=</span> <span class=n>retString</span><span class=o>.</span><span class=na>replace</span><span class=o>(</span><span class=s>&#34;-----BEGIN PUBLIC KEY-----&#34;</span><span class=o>,</span> <span class=s>&#34;&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>retString</span> <span class=o>=</span> <span class=n>retString</span><span class=o>.</span><span class=na>replace</span><span class=o>(</span><span class=s>&#34;-----END PUBLIC KEY-----&#34;</span><span class=o>,</span> <span class=s>&#34;&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>queryString</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=na>getQueryString</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>uri</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=na>getRequestURI</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>decodeUri</span> <span class=o>=</span> <span class=n>java</span><span class=o>.</span><span class=na>net</span><span class=o>.</span><span class=na>URLDecoder</span><span class=o>.</span><span class=na>decode</span><span class=o>(</span><span class=n>uri</span><span class=o>,</span> <span class=s>&#34;UTF-8&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>authStr</span> <span class=o>=</span> <span class=n>decodeUri</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>queryString</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>queryString</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=s>&#34;&#34;</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>authStr</span> <span class=o>+=</span> <span class=s>&#34;?&#34;</span> <span class=o>+</span> <span class=n>queryString</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=n>authStr</span> <span class=o>+=</span> <span class=s>&#34;\n&#34;</span> <span class=o>+</span> <span class=n>ossCallbackBody</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>ret</span> <span class=o>=</span> <span class=n>doCheck</span><span class=o>(</span><span class=n>authStr</span><span class=o>,</span> <span class=n>authorization</span><span class=o>,</span> <span class=n>retString</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ret</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>protected</span> <span class=kt>void</span> <span class=nf>doPost</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>request</span><span class=o>,</span> <span class=n>HttpServletResponse</span> <span class=n>response</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=kd>throws</span> <span class=n>ServletException</span><span class=o>,</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>ossCallbackBody</span> <span class=o>=</span> <span class=n>GetPostBody</span><span class=o>(</span><span class=n>request</span><span class=o>.</span><span class=na>getInputStream</span><span class=o>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>Integer</span><span class=o>.</span><span class=na>parseInt</span><span class=o>(</span><span class=n>request</span><span class=o>.</span><span class=na>getHeader</span><span class=o>(</span><span class=s>&#34;content-length&#34;</span><span class=o>)));</span>
</span></span><span class=line><span class=cl>    <span class=kt>boolean</span> <span class=n>ret</span> <span class=o>=</span> <span class=n>VerifyOSSCallbackRequest</span><span class=o>(</span><span class=n>request</span><span class=o>,</span> <span class=n>ossCallbackBody</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;verify result : &#34;</span> <span class=o>+</span> <span class=n>ret</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// System.out.println(&#34;OSS Callback Body:&#34; + ossCallbackBody);
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=o>(</span><span class=n>ret</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span><span class=o>(</span><span class=n>request</span><span class=o>,</span> <span class=n>response</span><span class=o>,</span> <span class=s>&#34;{\&#34;Status\&#34;:\&#34;OK\&#34;}&#34;</span><span class=o>,</span> <span class=n>HttpServletResponse</span><span class=o>.</span><span class=na>SC_OK</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span><span class=o>(</span><span class=n>request</span><span class=o>,</span> <span class=n>response</span><span class=o>,</span> <span class=s>&#34;{\&#34;Status\&#34;:\&#34;verdify not ok\&#34;}&#34;</span><span class=o>,</span> <span class=n>HttpServletResponse</span><span class=o>.</span><span class=na>SC_BAD_REQUEST</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></div><div class=article-widget><div class="container-xl row post-nav"></div></div><div class=body-footer><p>最近更新于 2023-04-05</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>