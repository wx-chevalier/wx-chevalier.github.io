<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="Bean 生命周期 接口 BeanFactoryPostProcessor 接口 通过 BeanFactoryPostProcessor 提供的 beanFactory 进行 Bean 的注册，常规的自定义 Bean 可以完全由此加载 @Configuration public class SelfBeanFactoryLoader implements BeanFactoryPostProcessor { @Override public void postProcessBeanFactory( ConfigurableListableBeanFactory beanFactory ) throws BeansException { beanFactory.registerSingleton(&#34;windowQpsControl&#34;, new WindowQpsControl()); } } BeanDefinitionRegistryPostProcessor 接口 这个接口是继承自 BeanFactoryPostProcessor Bean 注册相关的可以参考上文： @Configuration public class SelfBeanLoader implements BeanDefinitionRegistryPostProcessor { @Override public void postProcessBeanFactory( ConfigurableListableBeanFactory beanFactory )"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/spring-series/1.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/bean/bean-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/spring-series/1.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/bean/bean-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/spring-series/1.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/bean/bean-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"><meta property="og:title" content="Bean 生命周期 | Next-gen Tech Edu"><meta property="og:description" content="Bean 生命周期 接口 BeanFactoryPostProcessor 接口 通过 BeanFactoryPostProcessor 提供的 beanFactory 进行 Bean 的注册，常规的自定义 Bean 可以完全由此加载 @Configuration public class SelfBeanFactoryLoader implements BeanFactoryPostProcessor { @Override public void postProcessBeanFactory( ConfigurableListableBeanFactory beanFactory ) throws BeansException { beanFactory.registerSingleton(&#34;windowQpsControl&#34;, new WindowQpsControl()); } } BeanDefinitionRegistryPostProcessor 接口 这个接口是继承自 BeanFactoryPostProcessor Bean 注册相关的可以参考上文： @Configuration public class SelfBeanLoader implements BeanDefinitionRegistryPostProcessor { @Override public void postProcessBeanFactory( ConfigurableListableBeanFactory beanFactory )"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>Bean 生命周期 | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=f2d8b56163e6e05979edfa473f6134e0><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">Bean</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id45e945db63105c7142d5cb458796d62c")' href=#id45e945db63105c7142d5cb458796d62c aria-expanded=false aria-controls=id45e945db63105c7142d5cb458796d62c aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/1.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/>3.依赖注入</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id45e945db63105c7142d5cb458796d62c aria-expanded=false aria-controls=id45e945db63105c7142d5cb458796d62c><i class="fa-solid fa-angle-down" id=caret-id45e945db63105c7142d5cb458796d62c></i></a></div><ul class="nav docs-sidenav collapse show" id=id45e945db63105c7142d5cb458796d62c><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ide238d20fd2359d369e77411e011aab9a")' href=#ide238d20fd2359d369e77411e011aab9a aria-expanded=false aria-controls=ide238d20fd2359d369e77411e011aab9a aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/1.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/bean/>Bean</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ide238d20fd2359d369e77411e011aab9a aria-expanded=false aria-controls=ide238d20fd2359d369e77411e011aab9a><i class="fa-solid fa-angle-down" id=caret-ide238d20fd2359d369e77411e011aab9a></i></a></div><ul class="nav docs-sidenav collapse show" id=ide238d20fd2359d369e77411e011aab9a><li class="child level active"><a href=/books/spring-series/1.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/bean/bean-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/>Bean 生命周期</a></li><li class="child level"><a href=/books/spring-series/1.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/bean/bean-%E5%A3%B0%E6%98%8E/>Bean 声明</a></li><li class="child level"><a href=/books/spring-series/1.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/bean/bean-%E6%B3%A8%E5%85%A5/>Bean 注入</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idd41ce9481c794fbd6b1c9f9f9b0203b0")' href=#idd41ce9481c794fbd6b1c9f9f9b0203b0 aria-expanded=false aria-controls=idd41ce9481c794fbd6b1c9f9f9b0203b0 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/1.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE/>参数配置</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idd41ce9481c794fbd6b1c9f9f9b0203b0 aria-expanded=false aria-controls=idd41ce9481c794fbd6b1c9f9f9b0203b0><i class="fa-solid fa-angle-right" id=caret-idd41ce9481c794fbd6b1c9f9f9b0203b0></i></a></div><ul class="nav docs-sidenav collapse" id=idd41ce9481c794fbd6b1c9f9f9b0203b0><li class="child level"><a href=/books/spring-series/1.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE/%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/>多环境配置</a></li><li class="child level"><a href=/books/spring-series/1.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/>配置文件</a></li><li class="child level"><a href=/books/spring-series/1.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE/%E9%85%8D%E7%BD%AE%E5%BC%95%E7%94%A8/>配置引用</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idbf60549c85e98c9321388897ac9560ee")' href=#idbf60549c85e98c9321388897ac9560ee aria-expanded=false aria-controls=idbf60549c85e98c9321388897ac9560ee aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/1.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/%E4%BE%9D%E8%B5%96%E6%9C%BA%E5%88%B6/>依赖机制</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idbf60549c85e98c9321388897ac9560ee aria-expanded=false aria-controls=idbf60549c85e98c9321388897ac9560ee><i class="fa-solid fa-angle-right" id=caret-idbf60549c85e98c9321388897ac9560ee></i></a></div><ul class="nav docs-sidenav collapse" id=idbf60549c85e98c9321388897ac9560ee><li class="child level"><a href=/books/spring-series/1.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/%E4%BE%9D%E8%B5%96%E6%9C%BA%E5%88%B6/jar-%E5%8A%A0%E8%BD%BD/>Jar 加载</a></li><li class="child level"><a href=/books/spring-series/1.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/%E4%BE%9D%E8%B5%96%E6%9C%BA%E5%88%B6/scopedproxymode/>ScopedProxyMode</a></li><li class="child level"><a href=/books/spring-series/1.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/%E4%BE%9D%E8%B5%96%E6%9C%BA%E5%88%B6/%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/>启动流程</a></li><li class="child level"><a href=/books/spring-series/1.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/%E4%BE%9D%E8%B5%96%E6%9C%BA%E5%88%B6/%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96/>循环依赖</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id47041fef90a8c61df0a375668c348fef")' href=#id47041fef90a8c61df0a375668c348fef aria-expanded=false aria-controls=id47041fef90a8c61df0a375668c348fef aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/1.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/%E5%BA%94%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87/>应用上下文</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id47041fef90a8c61df0a375668c348fef aria-expanded=false aria-controls=id47041fef90a8c61df0a375668c348fef><i class="fa-solid fa-angle-right" id=caret-id47041fef90a8c61df0a375668c348fef></i></a></div><ul class="nav docs-sidenav collapse" id=id47041fef90a8c61df0a375668c348fef><li class="child level"><a href=/books/spring-series/1.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/%E5%BA%94%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87/spring-runner/>Spring Runner</a></li><li class="child level"><a href=/books/spring-series/1.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/%E5%BA%94%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87/%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE/>自动配置</a></li></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#beanfactorypostprocessor-接口>BeanFactoryPostProcessor 接口</a></li><li><a href=#beandefinitionregistrypostprocessor-接口>BeanDefinitionRegistryPostProcessor 接口</a></li><li><a href=#applicationcontextaware>ApplicationContextAware</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>Bean 生命周期</h1><div class=article-style><h1 id=bean-生命周期>Bean 生命周期</h1><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://s3.ax1x.com/2021/02/28/6Cmfu4.png alt="Bean 生命周期示意" loading=lazy data-zoomable></div></div></figure></p><h1 id=接口>接口</h1><h2 id=beanfactorypostprocessor-接口>BeanFactoryPostProcessor 接口</h2><p>通过 BeanFactoryPostProcessor 提供的 beanFactory 进行 Bean 的注册，常规的自定义 Bean 可以完全由此加载</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SelfBeanFactoryLoader</span> <span class=kd>implements</span> <span class=n>BeanFactoryPostProcessor</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>postProcessBeanFactory</span><span class=o>(</span>
</span></span><span class=line><span class=cl>    <span class=n>ConfigurableListableBeanFactory</span> <span class=n>beanFactory</span>
</span></span><span class=line><span class=cl>  <span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>throws</span> <span class=n>BeansException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>beanFactory</span><span class=o>.</span><span class=na>registerSingleton</span><span class=o>(</span><span class=s>&#34;windowQpsControl&#34;</span><span class=o>,</span> <span class=k>new</span> <span class=n>WindowQpsControl</span><span class=o>());</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=beandefinitionregistrypostprocessor-接口>BeanDefinitionRegistryPostProcessor 接口</h2><p>这个接口是继承自 BeanFactoryPostProcessor Bean 注册相关的可以参考上文：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SelfBeanLoader</span> <span class=kd>implements</span> <span class=n>BeanDefinitionRegistryPostProcessor</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>postProcessBeanFactory</span><span class=o>(</span>
</span></span><span class=line><span class=cl>    <span class=n>ConfigurableListableBeanFactory</span> <span class=n>beanFactory</span>
</span></span><span class=line><span class=cl>  <span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>throws</span> <span class=n>BeansException</span> <span class=o>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>postProcessBeanDefinitionRegistry</span><span class=o>(</span>
</span></span><span class=line><span class=cl>    <span class=n>BeanDefinitionRegistry</span> <span class=n>registry</span>
</span></span><span class=line><span class=cl>  <span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>throws</span> <span class=n>BeansException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>AnnotatedGenericBeanDefinition</span> <span class=n>cacheHelper</span> <span class=o>=</span> <span class=k>new</span> <span class=n>AnnotatedGenericBeanDefinition</span><span class=o>(</span>
</span></span><span class=line><span class=cl>      <span class=n>CacheHelper</span><span class=o>.</span><span class=na>class</span>
</span></span><span class=line><span class=cl>    <span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>registry</span><span class=o>.</span><span class=na>registerBeanDefinition</span><span class=o>(</span><span class=s>&#34;cacheHelper&#34;</span><span class=o>,</span> <span class=n>cacheHelper</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=applicationcontextaware>ApplicationContextAware</h2><p>这个接口比较靠后也是大家使用比较多的，在前两者 Bean 的基础上，增加 xml 注入，而且这里给出了另外一个参数 environment，便于用户在此注入特殊的 profile。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SelfContextLoader</span> <span class=kd>implements</span> <span class=n>ApplicationContextAware</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=n>ApplicationContext</span> <span class=n>context</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setApplicationContext</span><span class=o>(</span><span class=n>ApplicationContext</span> <span class=n>applicationContext</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>throws</span> <span class=n>BeansException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=o>.</span><span class=na>context</span> <span class=o>=</span> <span class=n>applicationContext</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>addBeans</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>void</span> <span class=nf>addBeans</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=k>this</span><span class=o>.</span><span class=na>context</span> <span class=k>instanceof</span> <span class=n>ConfigurableApplicationContext</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>ConfigurableListableBeanFactory</span> <span class=n>factory</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=o>((</span><span class=n>ConfigurableApplicationContext</span><span class=o>)</span> <span class=k>this</span><span class=o>.</span><span class=na>context</span><span class=o>).</span><span class=na>getBeanFactory</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=n>Environment</span> <span class=n>environment</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=na>getEnvironment</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;......environment :&#34;</span> <span class=o>+</span> <span class=n>environment</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>factory</span><span class=o>.</span><span class=na>registerSingleton</span><span class=o>(</span><span class=s>&#34;client&#34;</span><span class=o>,</span> <span class=k>new</span> <span class=n>Client</span><span class=o>());</span>
</span></span><span class=line><span class=cl>      <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>factory</span> <span class=k>instanceof</span> <span class=n>BeanDefinitionRegistry</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// 加载XML
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=n>ResourcePatternResolver</span> <span class=n>rp</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PathMatchingResourcePatternResolver</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=n>Resource</span><span class=o>[]</span> <span class=n>resources</span> <span class=o>=</span> <span class=n>rp</span><span class=o>.</span><span class=na>getResources</span><span class=o>(</span><span class=s>&#34;classpath*:inner.xml&#34;</span><span class=o>);</span> <span class=c1>// 加载A
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=k>new</span> <span class=n>XmlBeanDefinitionReader</span><span class=o>((</span><span class=n>DefaultListableBeanFactory</span><span class=o>)</span> <span class=n>factory</span><span class=o>)</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>loadBeanDefinitions</span><span class=o>(</span><span class=n>resources</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>      <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=o>(</span><span class=s>&#34; the environment is wrong !!!&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h1 id=案例结合策略模式>案例：结合策略模式</h1><p>策略模式相信大家都应该比较熟悉，它定义了一系列的算法，并将每一个算法封装起来，使每个算法可以相互替代，使算法本身和使用算法的客户端分割开来，相互独立。其适用的场景是这样的：一个大功能，它有许多不同类型的实现（策略类），具体根据客户端来决定采用哪一个策略类。比如下单优惠策略、物流对接策略等，应用场景还是非常多的。</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=https://s3.ax1x.com/2021/02/28/6CmhDJ.png alt=策略模式 loading=lazy data-zoomable></div></div></figure></p><p>举一个简单的例子，业务背景是这样的：平台需要根据不同的业务进行鉴权，每个业务的鉴权逻辑不一样，都有自己的一套独立的判断逻辑，因此需要根据传入的 bizType 进行鉴权操作，首先我们定义一个权限校验处理器接口如下。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 业务权限校验处理器
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=n>publicinterface</span> <span class=n>PermissionCheckHandler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 判断是否是自己能够处理的权限校验类型
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=kt>boolean</span> <span class=nf>isMatched</span><span class=o>(</span><span class=n>BizType</span> <span class=n>bizType</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * 权限校验逻辑
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>    <span class=n>PermissionCheckResultDTO</span> <span class=nf>permissionCheck</span><span class=o>(</span><span class=n>Long</span> <span class=n>userId</span><span class=o>,</span> <span class=n>String</span> <span class=n>bizCode</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 业务1的鉴权逻辑我们假设是这样的：
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 冷启动权限校验处理器
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nd>@Component</span>
</span></span><span class=line><span class=cl><span class=n>publicclass</span> <span class=n>ColdStartPermissionCheckHandlerImpl</span> <span class=kd>implements</span> <span class=n>PermissionCheckHandler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>isMatched</span><span class=o>(</span><span class=n>BizType</span> <span class=n>bizType</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>BizType</span><span class=o>.</span><span class=na>COLD_START</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>bizType</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>PermissionCheckResultDTO</span> <span class=nf>permissionCheck</span><span class=o>(</span><span class=n>Long</span> <span class=n>userId</span><span class=o>,</span> <span class=n>String</span> <span class=n>bizCode</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//业务特有鉴权逻辑
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 业务2的鉴权逻辑我们假设是这样的：
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 趋势业务权限校验处理器
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nd>@Component</span>
</span></span><span class=line><span class=cl><span class=n>publicclass</span> <span class=n>TrendPermissionCheckHandlerImpl</span> <span class=kd>implements</span> <span class=n>PermissionCheckHandler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>isMatched</span><span class=o>(</span><span class=n>BizType</span> <span class=n>bizType</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>BizType</span><span class=o>.</span><span class=na>TREND</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>bizType</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>PermissionCheckResultDTO</span> <span class=nf>permissionCheck</span><span class=o>(</span><span class=n>Long</span> <span class=n>userId</span><span class=o>,</span> <span class=n>String</span> <span class=n>bizCode</span><span class=o>){</span>
</span></span><span class=line><span class=cl>        <span class=c1>//业务特有鉴权逻辑
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>Spring 主要为我们提供了三类扩展点，分别对应不同 Bean 生命周期阶段：</p><ul><li>Aware 接口</li><li>BeanPostProcessor</li><li>InitializingBean 和 init-method</li></ul><p>我们这里用到的主要是 Aware 接口和 InitializingBean 两个扩展点，其主要用法如下代码所示，关键点就在于实现 ApplicationContextAware 接口的 setApplicationContext 方法和 InitializingBean 接口的 afterPropertiesSet 方法。实现 ApplicationContextAware 接口的目的就是要拿到 Spring 容器的资源，从而方便的使用它提供的 getBeansOfType 方法(该方法返回的是 map 类型，key 对应 beanName, value 对应 bean)；而实现 InitializingBean 接口的目的则是方便为 Service 类的 handlers 属性执行定制初始化逻辑。</p><p>可以很明显的看出，如果以后还有一些其他的业务需要制定相应的鉴权逻辑，我们只需要编写对应的策略类就好了，无需再破坏当前 Service 类的逻辑，很好的保证了开闭原则。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 权限校验服务类
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nd>@Slf4j</span>
</span></span><span class=line><span class=cl><span class=nd>@Service</span>
</span></span><span class=line><span class=cl><span class=n>publicclass</span> <span class=n>PermissionServiceImpl</span>
</span></span><span class=line><span class=cl>    <span class=kd>implements</span> <span class=n>PermissionService</span><span class=o>,</span> <span class=n>ApplicationContextAware</span><span class=o>,</span> <span class=n>InitializingBean</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>ApplicationContext</span> <span class=n>applicationContext</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>//注：这里可以使用Map，偷个懒
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>PermissionCheckHandler</span><span class=o>&gt;</span> <span class=n>handlers</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>PermissionCheckResultDTO</span> <span class=nf>permissionCheck</span><span class=o>(</span><span class=n>ArtemisSellerBizType</span> <span class=n>artemisSellerBizType</span><span class=o>,</span> <span class=n>Long</span> <span class=n>userId</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                                                    <span class=n>String</span> <span class=n>bizCode</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//省略一些前置逻辑
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>PermissionCheckHandler</span> <span class=n>handler</span> <span class=o>=</span> <span class=n>getHandler</span><span class=o>(</span><span class=n>artemisSellerBizType</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>handler</span><span class=o>.</span><span class=na>permissionCheck</span><span class=o>(</span><span class=n>userId</span><span class=o>,</span> <span class=n>bizCode</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>PermissionCheckHandler</span> <span class=nf>getHandler</span><span class=o>(</span><span class=n>ArtemisSellerBizType</span> <span class=n>artemisSellerBizType</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=n>PermissionCheckHandler</span> <span class=n>handler</span> <span class=o>:</span> <span class=n>handlers</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>handler</span><span class=o>.</span><span class=na>isMatched</span><span class=o>(</span><span class=n>artemisSellerBizType</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>handler</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>afterPropertiesSet</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=n>PermissionCheckHandler</span> <span class=n>handler</span> <span class=o>:</span> <span class=n>applicationContext</span><span class=o>.</span><span class=na>getBeansOfType</span><span class=o>(</span><span class=n>PermissionCheckHandler</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>values</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>handlers</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>handler</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>log</span><span class=o>.</span><span class=na>warn</span><span class=o>(</span><span class=s>&#34;load permission check handler [{}]&#34;</span><span class=o>,</span> <span class=n>handler</span><span class=o>.</span><span class=na>getClass</span><span class=o>().</span><span class=na>getName</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setApplicationContext</span><span class=o>(</span><span class=n>ApplicationContext</span> <span class=n>applicationContext</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>BeansException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>applicationContext</span> <span class=o>=</span> <span class=n>applicationContext</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>下一页</div><a href=/books/spring-series/1.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/bean/bean-%E5%A3%B0%E6%98%8E/ rel=prev>Bean 声明</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>