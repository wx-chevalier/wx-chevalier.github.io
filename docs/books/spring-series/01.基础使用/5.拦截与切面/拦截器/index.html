<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="拦截器 拦截器的原理很简单，是 AOP 的一种实现，专门拦截对动态资源的后台请求，即拦截对控制层的请求。使用场景比较多的是判断用户是否有权限请求后台，更拔高一层的使用场景也有，比如拦截器可以结合 websocket 一起使用，用来"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/5.%E6%8B%A6%E6%88%AA%E4%B8%8E%E5%88%87%E9%9D%A2/%E6%8B%A6%E6%88%AA%E5%99%A8/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/5.%E6%8B%A6%E6%88%AA%E4%B8%8E%E5%88%87%E9%9D%A2/%E6%8B%A6%E6%88%AA%E5%99%A8/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/5.%E6%8B%A6%E6%88%AA%E4%B8%8E%E5%88%87%E9%9D%A2/%E6%8B%A6%E6%88%AA%E5%99%A8/"><meta property="og:title" content="拦截器 | Next-gen Tech Edu"><meta property="og:description" content="拦截器 拦截器的原理很简单，是 AOP 的一种实现，专门拦截对动态资源的后台请求，即拦截对控制层的请求。使用场景比较多的是判断用户是否有权限请求后台，更拔高一层的使用场景也有，比如拦截器可以结合 websocket 一起使用，用来"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>拦截器 | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=d7b30c7315809b633010ebcdfa5d2dc7><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">5.拦截与切面</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id5ecd0cf5567aa8856d62290287e54dfe")' href=#id5ecd0cf5567aa8856d62290287e54dfe aria-expanded=false aria-controls=id5ecd0cf5567aa8856d62290287e54dfe aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/>01.基础使用</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id5ecd0cf5567aa8856d62290287e54dfe aria-expanded=false aria-controls=id5ecd0cf5567aa8856d62290287e54dfe><i class="fa-solid fa-angle-down" id=caret-id5ecd0cf5567aa8856d62290287e54dfe></i></a></div><ul class="nav docs-sidenav collapse show" id=id5ecd0cf5567aa8856d62290287e54dfe><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id99eac1262116235aab7d98e6de3b3cf0")' href=#id99eac1262116235aab7d98e6de3b3cf0 aria-expanded=false aria-controls=id99eac1262116235aab7d98e6de3b3cf0 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/2.%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/>2.快速开始</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id99eac1262116235aab7d98e6de3b3cf0 aria-expanded=false aria-controls=id99eac1262116235aab7d98e6de3b3cf0><i class="fa-solid fa-angle-right" id=caret-id99eac1262116235aab7d98e6de3b3cf0></i></a></div><ul class="nav docs-sidenav collapse" id=id99eac1262116235aab7d98e6de3b3cf0><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/2.%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/devtools/>DevTools</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/2.%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3/>常用注解</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/2.%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/%E7%AE%80%E5%8D%95%E5%85%A8%E9%93%BE%E8%B7%AF%E5%BA%94%E7%94%A8/>简单全链路应用</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/2.%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/%E5%AE%9E%E9%99%85%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84/>实际项目架构</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idc641f6e710352bc7d94df84c26a620ef")' href=#idc641f6e710352bc7d94df84c26a620ef aria-expanded=false aria-controls=idc641f6e710352bc7d94df84c26a620ef aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/>3.依赖注入</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idc641f6e710352bc7d94df84c26a620ef aria-expanded=false aria-controls=idc641f6e710352bc7d94df84c26a620ef><i class="fa-solid fa-angle-right" id=caret-idc641f6e710352bc7d94df84c26a620ef></i></a></div><ul class="nav docs-sidenav collapse" id=idc641f6e710352bc7d94df84c26a620ef><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idf6166c09b3a5d9fb493b2cd3014be674")' href=#idf6166c09b3a5d9fb493b2cd3014be674 aria-expanded=false aria-controls=idf6166c09b3a5d9fb493b2cd3014be674 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/bean/>Bean</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idf6166c09b3a5d9fb493b2cd3014be674 aria-expanded=false aria-controls=idf6166c09b3a5d9fb493b2cd3014be674><i class="fa-solid fa-angle-right" id=caret-idf6166c09b3a5d9fb493b2cd3014be674></i></a></div><ul class="nav docs-sidenav collapse" id=idf6166c09b3a5d9fb493b2cd3014be674><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/bean/bean-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/>Bean 生命周期</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/bean/bean-%E5%A3%B0%E6%98%8E/>Bean 声明</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/bean/bean-%E6%B3%A8%E5%85%A5/>Bean 注入</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id3545303bce35abbf7598b68fc0283fe6")' href=#id3545303bce35abbf7598b68fc0283fe6 aria-expanded=false aria-controls=id3545303bce35abbf7598b68fc0283fe6 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE/>参数配置</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id3545303bce35abbf7598b68fc0283fe6 aria-expanded=false aria-controls=id3545303bce35abbf7598b68fc0283fe6><i class="fa-solid fa-angle-right" id=caret-id3545303bce35abbf7598b68fc0283fe6></i></a></div><ul class="nav docs-sidenav collapse" id=id3545303bce35abbf7598b68fc0283fe6><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE/%E5%A4%9A%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/>多环境配置</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/>配置文件</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE/%E9%85%8D%E7%BD%AE%E5%BC%95%E7%94%A8/>配置引用</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id80afbd8694304d94cdbe2cce9b884d22")' href=#id80afbd8694304d94cdbe2cce9b884d22 aria-expanded=false aria-controls=id80afbd8694304d94cdbe2cce9b884d22 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/%E5%BA%94%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87/>应用上下文</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id80afbd8694304d94cdbe2cce9b884d22 aria-expanded=false aria-controls=id80afbd8694304d94cdbe2cce9b884d22><i class="fa-solid fa-angle-right" id=caret-id80afbd8694304d94cdbe2cce9b884d22></i></a></div><ul class="nav docs-sidenav collapse" id=id80afbd8694304d94cdbe2cce9b884d22><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/%E5%BA%94%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87/spring-runner/>Spring Runner</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/3.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/%E5%BA%94%E7%94%A8%E4%B8%8A%E4%B8%8B%E6%96%87/%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE/>自动配置</a></li></ul></div></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id3ff999759d34ffce3ca5f40b191c077a")' href=#id3ff999759d34ffce3ca5f40b191c077a aria-expanded=false aria-controls=id3ff999759d34ffce3ca5f40b191c077a aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/>4.请求与响应</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id3ff999759d34ffce3ca5f40b191c077a aria-expanded=false aria-controls=id3ff999759d34ffce3ca5f40b191c077a><i class="fa-solid fa-angle-right" id=caret-id3ff999759d34ffce3ca5f40b191c077a></i></a></div><ul class="nav docs-sidenav collapse" id=id3ff999759d34ffce3ca5f40b191c077a><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id016c71092f9143db5daaa4613467c218")' href=#id016c71092f9143db5daaa4613467c218 aria-expanded=false aria-controls=id016c71092f9143db5daaa4613467c218 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/>接口文档</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id016c71092f9143db5daaa4613467c218 aria-expanded=false aria-controls=id016c71092f9143db5daaa4613467c218><i class="fa-solid fa-angle-right" id=caret-id016c71092f9143db5daaa4613467c218></i></a></div><ul class="nav docs-sidenav collapse" id=id016c71092f9143db5daaa4613467c218><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/springfox/>Springfox</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/swagger/>Swagger</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id94061b9cda0a000fd47f4c9f2ef42466")' href=#id94061b9cda0a000fd47f4c9f2ef42466 aria-expanded=false aria-controls=id94061b9cda0a000fd47f4c9f2ef42466 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E8%B7%AF%E7%94%B1%E4%B8%8E%E5%8F%82%E6%95%B0/>路由与参数</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id94061b9cda0a000fd47f4c9f2ef42466 aria-expanded=false aria-controls=id94061b9cda0a000fd47f4c9f2ef42466><i class="fa-solid fa-angle-right" id=caret-id94061b9cda0a000fd47f4c9f2ef42466></i></a></div><ul class="nav docs-sidenav collapse" id=id94061b9cda0a000fd47f4c9f2ef42466><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E8%B7%AF%E7%94%B1%E4%B8%8E%E5%8F%82%E6%95%B0/%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C/>参数校验</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E8%B7%AF%E7%94%B1%E4%B8%8E%E5%8F%82%E6%95%B0/%E5%8F%82%E6%95%B0%E6%B3%A8%E5%85%A5/>参数注入</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E8%B7%AF%E7%94%B1%E4%B8%8E%E5%8F%82%E6%95%B0/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/>文件上传</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idbb80636f2921d67fc1346a2a08edfdc7")' href=#idbb80636f2921d67fc1346a2a08edfdc7 aria-expanded=false aria-controls=idbb80636f2921d67fc1346a2a08edfdc7 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86/>日志处理</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idbb80636f2921d67fc1346a2a08edfdc7 aria-expanded=false aria-controls=idbb80636f2921d67fc1346a2a08edfdc7><i class="fa-solid fa-angle-right" id=caret-idbb80636f2921d67fc1346a2a08edfdc7></i></a></div><ul class="nav docs-sidenav collapse" id=idbb80636f2921d67fc1346a2a08edfdc7><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86/log4j2/>Log4j2</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86/logback/>Logback</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86/mdc/>MDC</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86/slf4j/>Slf4j</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id91563a8fde3f1260f7f1ebc8545e1007")' href=#id91563a8fde3f1260f7f1ebc8545e1007 aria-expanded=false aria-controls=id91563a8fde3f1260f7f1ebc8545e1007 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E5%93%8D%E5%BA%94%E8%BF%94%E5%9B%9E/>响应返回</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id91563a8fde3f1260f7f1ebc8545e1007 aria-expanded=false aria-controls=id91563a8fde3f1260f7f1ebc8545e1007><i class="fa-solid fa-angle-right" id=caret-id91563a8fde3f1260f7f1ebc8545e1007></i></a></div><ul class="nav docs-sidenav collapse" id=id91563a8fde3f1260f7f1ebc8545e1007><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E5%93%8D%E5%BA%94%E8%BF%94%E5%9B%9E/json-%E6%95%B0%E6%8D%AE%E5%B0%81%E8%A3%85/>Json 数据封装</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idadcedcbd903741772ae31d8638a24e52")' href=#idadcedcbd903741772ae31d8638a24e52 aria-expanded=false aria-controls=idadcedcbd903741772ae31d8638a24e52 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86/>异步处理</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idadcedcbd903741772ae31d8638a24e52 aria-expanded=false aria-controls=idadcedcbd903741772ae31d8638a24e52><i class="fa-solid fa-angle-right" id=caret-idadcedcbd903741772ae31d8638a24e52></i></a></div><ul class="nav docs-sidenav collapse" id=idadcedcbd903741772ae31d8638a24e52><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id081948853c6a9a46e98ad68a4711a513")' href=#id081948853c6a9a46e98ad68a4711a513 aria-expanded=false aria-controls=id081948853c6a9a46e98ad68a4711a513 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86/async/>Async</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id081948853c6a9a46e98ad68a4711a513 aria-expanded=false aria-controls=id081948853c6a9a46e98ad68a4711a513><i class="fa-solid fa-angle-right" id=caret-id081948853c6a9a46e98ad68a4711a513></i></a></div><ul class="nav docs-sidenav collapse" id=id081948853c6a9a46e98ad68a4711a513><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86/async/async/>Async</a></li></ul></div><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86/callable-%E4%B8%8E-webasynctask/>Callable 与 WebAsyncTask</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86/deferredresult/>DeferredResult</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id6816af98fda7ce283cef6159d0a5ecc1")' href=#id6816af98fda7ce283cef6159d0a5ecc1 aria-expanded=false aria-controls=id6816af98fda7ce283cef6159d0a5ecc1 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/>异常处理</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id6816af98fda7ce283cef6159d0a5ecc1 aria-expanded=false aria-controls=id6816af98fda7ce283cef6159d0a5ecc1><i class="fa-solid fa-angle-right" id=caret-id6816af98fda7ce283cef6159d0a5ecc1></i></a></div><ul class="nav docs-sidenav collapse" id=id6816af98fda7ce283cef6159d0a5ecc1><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/>全局异常处理</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/4.%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/%E9%87%8D%E8%AF%95%E6%9C%BA%E5%88%B6/>重试机制</a></li></ul></div></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id8d48559185e826b09e388d5fcd6589c5")' href=#id8d48559185e826b09e388d5fcd6589c5 aria-expanded=false aria-controls=id8d48559185e826b09e388d5fcd6589c5 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/5.%E6%8B%A6%E6%88%AA%E4%B8%8E%E5%88%87%E9%9D%A2/>5.拦截与切面</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id8d48559185e826b09e388d5fcd6589c5 aria-expanded=false aria-controls=id8d48559185e826b09e388d5fcd6589c5><i class="fa-solid fa-angle-down" id=caret-id8d48559185e826b09e388d5fcd6589c5></i></a></div><ul class="nav docs-sidenav collapse show" id=id8d48559185e826b09e388d5fcd6589c5><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/5.%E6%8B%A6%E6%88%AA%E4%B8%8E%E5%88%87%E9%9D%A2/%E8%BF%87%E6%BB%A4%E5%99%A8/>过滤器</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/5.%E6%8B%A6%E6%88%AA%E4%B8%8E%E5%88%87%E9%9D%A2/%E7%9B%91%E5%90%AC%E5%99%A8/>监听器</a></li><li class="child level active"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/5.%E6%8B%A6%E6%88%AA%E4%B8%8E%E5%88%87%E9%9D%A2/%E6%8B%A6%E6%88%AA%E5%99%A8/>拦截器</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/5.%E6%8B%A6%E6%88%AA%E4%B8%8E%E5%88%87%E9%9D%A2/%E5%88%87%E9%9D%A2%E6%B3%A8%E8%A7%A3/>切面注解</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/5.%E6%8B%A6%E6%88%AA%E4%B8%8E%E5%88%87%E9%9D%A2/%E5%BC%82%E6%AD%A5%E6%8B%A6%E6%88%AA%E5%99%A8/>异步拦截器</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idd2e05bd0d4ed929d69f647a8a115bd20")' href=#idd2e05bd0d4ed929d69f647a8a115bd20 aria-expanded=false aria-controls=idd2e05bd0d4ed929d69f647a8a115bd20 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/6.%E8%A7%86%E5%9B%BE%E4%B8%8E%E6%A8%A1%E6%9D%BF/>6.视图与模板</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idd2e05bd0d4ed929d69f647a8a115bd20 aria-expanded=false aria-controls=idd2e05bd0d4ed929d69f647a8a115bd20><i class="fa-solid fa-angle-right" id=caret-idd2e05bd0d4ed929d69f647a8a115bd20></i></a></div><ul class="nav docs-sidenav collapse" id=idd2e05bd0d4ed929d69f647a8a115bd20><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/6.%E8%A7%86%E5%9B%BE%E4%B8%8E%E6%A8%A1%E6%9D%BF/thymeleaf/>Thymeleaf</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/6.%E8%A7%86%E5%9B%BE%E4%B8%8E%E6%A8%A1%E6%9D%BF/%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90/>静态资源</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/6.%E8%A7%86%E5%9B%BE%E4%B8%8E%E6%A8%A1%E6%9D%BF/%E6%A8%A1%E6%9D%BF%E6%B8%B2%E6%9F%93/>模板渲染</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id1ba5964b48fcc6823fcff551f21b09b0")' href=#id1ba5964b48fcc6823fcff551f21b09b0 aria-expanded=false aria-controls=id1ba5964b48fcc6823fcff551f21b09b0 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/7.spring-%E5%B7%A5%E5%85%B7%E5%BA%93/>7.Spring 工具库</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id1ba5964b48fcc6823fcff551f21b09b0 aria-expanded=false aria-controls=id1ba5964b48fcc6823fcff551f21b09b0><i class="fa-solid fa-angle-right" id=caret-id1ba5964b48fcc6823fcff551f21b09b0></i></a></div><ul class="nav docs-sidenav collapse" id=id1ba5964b48fcc6823fcff551f21b09b0><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/7.spring-%E5%B7%A5%E5%85%B7%E5%BA%93/beanutils/>BeanUtils</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/7.spring-%E5%B7%A5%E5%85%B7%E5%BA%93/copyproperties/>copyProperties</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idf37c3cf2b96fbc6f5c1ae18765f434ab")' href=#idf37c3cf2b96fbc6f5c1ae18765f434ab aria-expanded=false aria-controls=idf37c3cf2b96fbc6f5c1ae18765f434ab aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/8.%E6%89%93%E5%8C%85%E4%B8%8E%E9%83%A8%E7%BD%B2/>8.打包与部署</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idf37c3cf2b96fbc6f5c1ae18765f434ab aria-expanded=false aria-controls=idf37c3cf2b96fbc6f5c1ae18765f434ab><i class="fa-solid fa-angle-right" id=caret-idf37c3cf2b96fbc6f5c1ae18765f434ab></i></a></div><ul class="nav docs-sidenav collapse" id=idf37c3cf2b96fbc6f5c1ae18765f434ab><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/8.%E6%89%93%E5%8C%85%E4%B8%8E%E9%83%A8%E7%BD%B2/docker-%E4%B8%8E-k8s/>Docker 与 K8s</a></li><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id1d2cbe83622536038beb3aaed24574da")' href=#id1d2cbe83622536038beb3aaed24574da aria-expanded=false aria-controls=id1d2cbe83622536038beb3aaed24574da aria-hidden=false data-toggle=collapse></div></div></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idb6f7b1c53cbc945784cc5d9b4fe1d0f6")' href=#idb6f7b1c53cbc945784cc5d9b4fe1d0f6 aria-expanded=false aria-controls=idb6f7b1c53cbc945784cc5d9b4fe1d0f6 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/9.%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/>9.定时任务</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idb6f7b1c53cbc945784cc5d9b4fe1d0f6 aria-expanded=false aria-controls=idb6f7b1c53cbc945784cc5d9b4fe1d0f6><i class="fa-solid fa-angle-right" id=caret-idb6f7b1c53cbc945784cc5d9b4fe1d0f6></i></a></div><ul class="nav docs-sidenav collapse" id=idb6f7b1c53cbc945784cc5d9b4fe1d0f6><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/9.%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/taskscheduler/>TaskScheduler</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/9.%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/%E5%AE%9A%E6%97%B6%E5%99%A8/>定时器</a></li><li class="child level"><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/9.%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/%E5%BB%B6%E6%97%B6%E4%BB%BB%E5%8A%A1/>延时任务</a></li></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#定义拦截器>定义拦截器</a></li><li><a href=#配置拦截器>配置拦截器</a></li><li><a href=#解决静态资源被拦截问题>解决静态资源被拦截问题</a></li></ul><ul><li><a href=#判断用户有没有登录>判断用户有没有登录</a><ul><li><a href=#取消拦截操作>取消拦截操作</a></li></ul></li><li><a href=#接口防刷>接口防刷</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>拦截器</h1><div class=article-style><h1 id=拦截器>拦截器</h1><p>拦截器的原理很简单，是 AOP 的一种实现，专门拦截对动态资源的后台请求，即拦截对控制层的请求。使用场景比较多的是判断用户是否有权限请求后台，更拔高一层的使用场景也有，比如拦截器可以结合 websocket 一起使用，用来拦截 websocket 请求，然后做相应的处理等等。拦截器不会拦截静态资源，Spring Boot 的默认静态目录为 resources/static，该目录下的静态页面、js、css、图片等等，不会被拦截。</p><h1 id=拦截器的快速使用>拦截器的快速使用</h1><h2 id=定义拦截器>定义拦截器</h2><p>定义拦截器，只需要实现 HandlerInterceptor 接口，HandlerInterceptor 接口是所有自定义拦截器或者 Spring Boot 提供的拦截器的鼻祖，所以，首先来了解下该接口。该接口中有三个方法：preHandle(……)、postHandle(……) 和 afterCompletion(……) 。</p><ul><li><p>preHandle(……) 方法：该方法的执行时机是，当某个 url 已经匹配到对应的 Controller 中的某个方法，且在这个方法执行之前。所以 preHandle(……) 方法可以决定是否将请求放行，这是通过返回值来决定的，返回 true 则放行，返回 false 则不会向后执行。</p></li><li><p>postHandle(……) 方法：该方法的执行时机是，当某个 url 已经匹配到对应的 Controller 中的某个方法，且在执行完了该方法，但是在 DispatcherServlet 视图渲染之前。所以在这个方法中有个 ModelAndView 参数，可以在此做一些修改动作。</p></li><li><p>afterCompletion(……) 方法：顾名思义，该方法是在整个请求处理完成后（包括视图渲染）执行，这时做一些资源的清理工作，这个方法只有在 preHandle(……) 被成功执行后并且返回 true 才会被执行。</p></li></ul><p>了解了该接口，接下来自定义一个拦截器。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MyInterceptor</span> <span class=kd>implements</span> <span class=n>HandlerInterceptor</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>Logger</span> <span class=n>logger</span> <span class=o>=</span> <span class=n>LoggerFactory</span><span class=o>.</span><span class=na>getLogger</span><span class=o>(</span><span class=n>MyInterceptor</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>preHandle</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>request</span><span class=o>,</span> <span class=n>HttpServletResponse</span> <span class=n>response</span><span class=o>,</span> <span class=n>Object</span> <span class=n>handler</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>HandlerMethod</span> <span class=n>handlerMethod</span> <span class=o>=</span> <span class=o>(</span><span class=n>HandlerMethod</span><span class=o>)</span> <span class=n>handler</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Method</span> <span class=n>method</span> <span class=o>=</span> <span class=n>handlerMethod</span><span class=o>.</span><span class=na>getMethod</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>methodName</span> <span class=o>=</span> <span class=n>method</span><span class=o>.</span><span class=na>getName</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;====拦截到了方法：{}，在该方法执行之前执行====&#34;</span><span class=o>,</span> <span class=n>methodName</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 返回true才会继续执行，返回false则取消当前请求
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>postHandle</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>request</span><span class=o>,</span> <span class=n>HttpServletResponse</span> <span class=n>response</span><span class=o>,</span> <span class=n>Object</span> <span class=n>handler</span><span class=o>,</span> <span class=n>ModelAndView</span> <span class=n>modelAndView</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;执行完方法之后进执行(Controller方法调用之后)，但是此时还没进行视图渲染&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>afterCompletion</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>request</span><span class=o>,</span> <span class=n>HttpServletResponse</span> <span class=n>response</span><span class=o>,</span> <span class=n>Object</span> <span class=n>handler</span><span class=o>,</span> <span class=n>Exception</span> <span class=n>ex</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;整个请求都处理完咯，DispatcherServlet也渲染了对应的视图咯，此时我可以做一些清理的工作了&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=配置拦截器>配置拦截器</h2><p>在 Spring Boot 2.0 之前，我们都是直接继承 WebMvcConfigurerAdapter 类，然后重写 addInterceptors 方法来实现拦截器的配置。但是在 Spring Boot 2.0 之后，该方法已经被废弃了（当然，也可以继续用），取而代之的是 WebMvcConfigurationSupport 方法，如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MyInterceptorConfig</span> <span class=kd>extends</span> <span class=n>WebMvcConfigurationSupport</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>addInterceptors</span><span class=o>(</span><span class=n>InterceptorRegistry</span> <span class=n>registry</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>registry</span><span class=o>.</span><span class=na>addInterceptor</span><span class=o>(</span><span class=k>new</span> <span class=n>MyInterceptor</span><span class=o>()).</span><span class=na>addPathPatterns</span><span class=o>(</span><span class=s>&#34;/**&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>.</span><span class=na>addInterceptors</span><span class=o>(</span><span class=n>registry</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>在该配置中重写 addInterceptors 方法，将我们上面自定义的拦截器添加进去，addPathPatterns 方法是添加要拦截的请求，这里我们拦截所有的请求。这样就配置好拦截器了，接下来写一个 Controller 测试一下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Controller</span>
</span></span><span class=line><span class=cl><span class=nd>@RequestMapping</span><span class=o>(</span><span class=s>&#34;/interceptor&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>InterceptorController</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@RequestMapping</span><span class=o>(</span><span class=s>&#34;/test&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>test</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;hello&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>让其跳转到 hello.html 页面，直接在 hello.html 中输出 hello interceptor 即可。启动项目，在浏览器中输入 localhost:8080/interceptor/test 看一下控制台的日志：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=o>====</span>拦截到了方法：test，在该方法执行之前执行<span class=o>====</span>
</span></span><span class=line><span class=cl>执行完方法之后进执行<span class=o>(</span>Controller方法调用之后<span class=o>)</span>，但是此时还没进行视图渲染
</span></span><span class=line><span class=cl>整个请求都处理完咯，DispatcherServlet也渲染了对应的视图咯，此时我可以做一些清理的工作了
</span></span></code></pre></div><p>可以看出拦截器已经生效，并能看出其执行顺序。</p><h2 id=解决静态资源被拦截问题>解决静态资源被拦截问题</h2><p>上文中已经介绍了拦截器的定义和配置，但是这样是否就没问题了呢？其实不然，如果使用上面这种配置的话，我们会发现一个缺陷，那就是静态资源被拦截了。可以在 resources/static/ 目录下放置一个图片资源或者 html 文件，然后启动项目直接访问，即可看到无法访问的现象。也就是说，虽然 Spring Boot 2.0 废弃了 WebMvcConfigurerAdapter，但是 WebMvcConfigurationSupport 又会导致默认的静态资源被拦截，这就需要我们手动将静态资源放开。</p><p>如何放开呢？除了在 MyInterceptorConfig 配置类中重写 addInterceptors 方法外，还需要再重写一个方法：addResourceHandlers，将静态资源放开：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 用来指定静态资源不被拦截，否则继承WebMvcConfigurationSupport这种方式会导致静态资源无法直接访问
</span></span></span><span class=line><span class=cl><span class=cm> * @param registry
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nd>@Override</span>
</span></span><span class=line><span class=cl><span class=kd>protected</span> <span class=kt>void</span> <span class=nf>addResourceHandlers</span><span class=o>(</span><span class=n>ResourceHandlerRegistry</span> <span class=n>registry</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>registry</span><span class=o>.</span><span class=na>addResourceHandler</span><span class=o>(</span><span class=s>&#34;/**&#34;</span><span class=o>).</span><span class=na>addResourceLocations</span><span class=o>(</span><span class=s>&#34;classpath:/static/&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>super</span><span class=o>.</span><span class=na>addResourceHandlers</span><span class=o>(</span><span class=n>registry</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>这样配置好之后，重启项目，静态资源也可以正常访问了。如果你是个善于学习或者研究的人，那肯定不会止步于此，没错，上面这种方式的确能解决静态资源无法访问的问题，但是，还有更方便的方式来配置。我们不继承 WebMvcConfigurationSupport 类，直接实现 WebMvcConfigurer 接口，然后重写 addInterceptors 方法，将自定义的拦截器添加进去即可，如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MyInterceptorConfig</span> <span class=kd>implements</span> <span class=n>WebMvcConfigurer</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addInterceptors</span><span class=o>(</span><span class=n>InterceptorRegistry</span> <span class=n>registry</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 实现WebMvcConfigurer不会导致静态资源被拦截
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>registry</span><span class=o>.</span><span class=na>addInterceptor</span><span class=o>(</span><span class=k>new</span> <span class=n>MyInterceptor</span><span class=o>()).</span><span class=na>addPathPatterns</span><span class=o>(</span><span class=s>&#34;/**&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>这两种方式都可以，具体他们之间的细节，感兴趣的读者可以做进一步的研究，由于这两种方式的不同，继承 WebMvcConfigurationSupport 类的方式可以用在前后端分离的项目中，后台不需要访问静态资源（就不需要放开静态资源了）；实现 WebMvcConfigure 接口的方式可以用在非前后端分离的项目中，因为需要读取一些图片、css、js 文件等等。</p><h1 id=拦截器使用实例>拦截器使用实例</h1><h2 id=判断用户有没有登录>判断用户有没有登录</h2><p>一般用户登录功能我们可以这么做，要么往 session 中写一个 user，要么针对每个 user 生成一个 token，第二种要更好一点，那么针对第二种方式，如果用户登录成功了，每次请求的时候都会带上该用户的 token，如果未登录，则没有该 token，服务端可以检测这个 token 参数的有无来判断用户有没有登录，从而实现拦截功能。我们改造一下 preHandle 方法，如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Override</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>preHandle</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>request</span><span class=o>,</span> <span class=n>HttpServletResponse</span> <span class=n>response</span><span class=o>,</span> <span class=n>Object</span> <span class=n>handler</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>HandlerMethod</span> <span class=n>handlerMethod</span> <span class=o>=</span> <span class=o>(</span><span class=n>HandlerMethod</span><span class=o>)</span> <span class=n>handler</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Method</span> <span class=n>method</span> <span class=o>=</span> <span class=n>handlerMethod</span><span class=o>.</span><span class=na>getMethod</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>methodName</span> <span class=o>=</span> <span class=n>method</span><span class=o>.</span><span class=na>getName</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;====拦截到了方法：{}，在该方法执行之前执行====&#34;</span><span class=o>,</span> <span class=n>methodName</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 判断用户有没有登陆，一般登陆之后的用户都有一个对应的token
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>String</span> <span class=n>token</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=na>getParameter</span><span class=o>(</span><span class=s>&#34;token&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=kc>null</span> <span class=o>==</span> <span class=n>token</span> <span class=o>||</span> <span class=s>&#34;&#34;</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>token</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;用户未登录，没有权限执行……请登录&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 返回true才会继续执行，返回false则取消当前请求
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>重启项目，在浏览器中输入 localhost:8080/interceptor/test 后查看控制台日志，发现被拦截，如果在浏览器中输入 localhost:8080/interceptor/test?token=123 即可正常往下走。</p><h3 id=取消拦截操作>取消拦截操作</h3><p>根据上文，如果我要拦截所有 /admin 开头的 url 请求的话，需要在拦截器配置中添加这个前缀，但是在实际项目中，可能会有这种场景出现：某个请求也是 /admin 开头的，但是不能拦截，比如 /admin/login 等等，这样的话又需要去配置。那么，可不可以做成一个类似于开关的东西，哪里不需要拦截，我就在哪里弄个开关上去，做成这种灵活的可插拔的效果呢？</p><p>是可以的，我们可以定义一个注解，该注解专门用来取消拦截操作，如果某个 Controller 中的方法我们不需要拦截掉，即可在该方法上加上我们自定义的注解即可，下面先定义一个注解：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 该注解用来指定某个方法不用拦截
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nd>@Target</span><span class=o>(</span><span class=n>ElementType</span><span class=o>.</span><span class=na>METHOD</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nd>@Retention</span><span class=o>(</span><span class=n>RetentionPolicy</span><span class=o>.</span><span class=na>RUNTIME</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=nd>@interface</span> <span class=n>UnInterception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>然后在 Controller 中的某个方法上添加该注解，在拦截器处理方法中添加该注解取消拦截的逻辑，如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Override</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>preHandle</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>request</span><span class=o>,</span> <span class=n>HttpServletResponse</span> <span class=n>response</span><span class=o>,</span> <span class=n>Object</span> <span class=n>handler</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>HandlerMethod</span> <span class=n>handlerMethod</span> <span class=o>=</span> <span class=o>(</span><span class=n>HandlerMethod</span><span class=o>)</span> <span class=n>handler</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Method</span> <span class=n>method</span> <span class=o>=</span> <span class=n>handlerMethod</span><span class=o>.</span><span class=na>getMethod</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>methodName</span> <span class=o>=</span> <span class=n>method</span><span class=o>.</span><span class=na>getName</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>logger</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;====拦截到了方法：{}，在该方法执行之前执行====&#34;</span><span class=o>,</span> <span class=n>methodName</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 通过方法，可以获取该方法上的自定义注解，然后通过注解来判断该方法是否要被拦截
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// @UnInterception 是我们自定义的注解
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>UnInterception</span> <span class=n>unInterception</span> <span class=o>=</span> <span class=n>method</span><span class=o>.</span><span class=na>getAnnotation</span><span class=o>(</span><span class=n>UnInterception</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=kc>null</span> <span class=o>!=</span> <span class=n>unInterception</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 返回true才会继续执行，返回false则取消当前请求
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>Controller 中的方法代码可以参见源码，重启项目在浏览器中输入 http://localhost:8080/interceptor/test2?token=123 测试一下，可以看出，加了该注解的方法不会被拦截。</p><h2 id=接口防刷>接口防刷</h2><p>首先是写一个注解类：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.lang.annotation.Retention</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.lang.annotation.Target</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import static</span> <span class=nn>java.lang.annotation.ElementType.METHOD</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import static</span> <span class=nn>java.lang.annotation.RetentionPolicy.RUNTIME</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Retention</span><span class=o>(</span><span class=n>RUNTIME</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nd>@Target</span><span class=o>(</span><span class=n>METHOD</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=nd>@interface</span> <span class=n>AccessLimit</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=nf>seconds</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=nf>maxCount</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=kt>boolean</span> <span class=nf>needLogin</span><span class=o>()</span><span class=k>default</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>接着就是在 Interceptor 拦截器中实现：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Component</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>FangshuaInterceptor</span> <span class=kd>extends</span> <span class=n>HandlerInterceptorAdapter</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>RedisService</span> <span class=n>redisService</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>preHandle</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>request</span><span class=o>,</span> <span class=n>HttpServletResponse</span> <span class=n>response</span><span class=o>,</span> <span class=n>Object</span> <span class=n>handler</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>//判断请求是否属于方法的请求
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span><span class=o>(</span><span class=n>handler</span> <span class=k>instanceof</span> <span class=n>HandlerMethod</span><span class=o>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>HandlerMethod</span> <span class=n>hm</span> <span class=o>=</span> <span class=o>(</span><span class=n>HandlerMethod</span><span class=o>)</span> <span class=n>handler</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1>//获取方法中的注解,看是否有该注解
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>AccessLimit</span> <span class=n>accessLimit</span> <span class=o>=</span> <span class=n>hm</span><span class=o>.</span><span class=na>getMethodAnnotation</span><span class=o>(</span><span class=n>AccessLimit</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=o>(</span><span class=n>accessLimit</span> <span class=o>==</span> <span class=kc>null</span><span class=o>){</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>seconds</span> <span class=o>=</span> <span class=n>accessLimit</span><span class=o>.</span><span class=na>seconds</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>maxCount</span> <span class=o>=</span> <span class=n>accessLimit</span><span class=o>.</span><span class=na>maxCount</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=kt>boolean</span> <span class=n>login</span> <span class=o>=</span> <span class=n>accessLimit</span><span class=o>.</span><span class=na>needLogin</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>String</span> <span class=n>key</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=na>getRequestURI</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1>// 如果需要登录
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>if</span><span class=o>(</span><span class=n>login</span><span class=o>){</span>
</span></span><span class=line><span class=cl>                <span class=c1>// 获取登录的session进行判断
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=c1>//.....
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>key</span><span class=o>+=</span><span class=s>&#34;&#34;</span><span class=o>+</span><span class=s>&#34;1&#34;</span><span class=o>;</span>  <span class=c1>//这 里假设用户是1,项目中是动态获取的userId
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1>// 从redis中获取用户访问的次数
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>AccessKey</span> <span class=n>ak</span> <span class=o>=</span> <span class=n>AccessKey</span><span class=o>.</span><span class=na>withExpire</span><span class=o>(</span><span class=n>seconds</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>Integer</span> <span class=n>count</span> <span class=o>=</span> <span class=n>redisService</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>ak</span><span class=o>,</span><span class=n>key</span><span class=o>,</span><span class=n>Integer</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=o>(</span><span class=n>count</span> <span class=o>==</span> <span class=kc>null</span><span class=o>){</span>
</span></span><span class=line><span class=cl>                <span class=c1>// 第一次访问
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>redisService</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=n>ak</span><span class=o>,</span><span class=n>key</span><span class=o>,</span><span class=mi>1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span><span class=k>else</span> <span class=k>if</span><span class=o>(</span><span class=n>count</span> <span class=o>&lt;</span> <span class=n>maxCount</span><span class=o>){</span>
</span></span><span class=line><span class=cl>                <span class=c1>// 加1
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>redisService</span><span class=o>.</span><span class=na>incr</span><span class=o>(</span><span class=n>ak</span><span class=o>,</span><span class=n>key</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span><span class=k>else</span><span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// 超出访问次数
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>render</span><span class=o>(</span><span class=n>response</span><span class=o>,</span><span class=n>CodeMsg</span><span class=o>.</span><span class=na>ACCESS_LIMIT_REACHED</span><span class=o>);</span> <span class=c1>// 这里的 CodeMsg 是一个返回参数
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>render</span><span class=o>(</span><span class=n>HttpServletResponse</span> <span class=n>response</span><span class=o>,</span> <span class=n>CodeMsg</span> <span class=n>cm</span><span class=o>)</span><span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span><span class=o>.</span><span class=na>setContentType</span><span class=o>(</span><span class=s>&#34;application/json;charset=UTF-8&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>OutputStream</span> <span class=n>out</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=na>getOutputStream</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>str</span>  <span class=o>=</span> <span class=n>JSON</span><span class=o>.</span><span class=na>toJSONString</span><span class=o>(</span><span class=n>Result</span><span class=o>.</span><span class=na>error</span><span class=o>(</span><span class=n>cm</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>out</span><span class=o>.</span><span class=na>write</span><span class=o>(</span><span class=n>str</span><span class=o>.</span><span class=na>getBytes</span><span class=o>(</span><span class=s>&#34;UTF-8&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>out</span><span class=o>.</span><span class=na>flush</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>out</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>再把 Interceptor 注册到 SpringBoot 中：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>WebConfig</span> <span class=kd>extends</span> <span class=n>WebMvcConfigurerAdapter</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>FangshuaInterceptor</span> <span class=n>interceptor</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addInterceptors</span><span class=o>(</span><span class=n>InterceptorRegistry</span> <span class=n>registry</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>registry</span><span class=o>.</span><span class=na>addInterceptor</span><span class=o>(</span><span class=n>interceptor</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>接着在 Controller 中加入注解：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Controller</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>FangshuaController</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@AccessLimit</span><span class=o>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>5</span><span class=o>,</span> <span class=n>maxCount</span><span class=o>=</span><span class=mi>5</span><span class=o>,</span> <span class=n>needLogin</span><span class=o>=</span><span class=kc>true</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=nd>@RequestMapping</span><span class=o>(</span><span class=s>&#34;/fangshua&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=nd>@ResponseBody</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Result</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>fangshua</span><span class=o>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Result</span><span class=o>.</span><span class=na>success</span><span class=o>(</span><span class=s>&#34;请求成功&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>上一页</div><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/5.%E6%8B%A6%E6%88%AA%E4%B8%8E%E5%88%87%E9%9D%A2/%E7%9B%91%E5%90%AC%E5%99%A8/ rel=next>监听器</a></div><div class="col-6 post-nav-item"><div class=meta-nav>下一页</div><a href=/books/spring-series/01.%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/5.%E6%8B%A6%E6%88%AA%E4%B8%8E%E5%88%87%E9%9D%A2/%E5%88%87%E9%9D%A2%E6%B3%A8%E8%A7%A3/ rel=prev>切面注解</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>