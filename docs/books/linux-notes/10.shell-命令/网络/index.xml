<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>网络 | Next-gen Tech Edu</title><link>https://ng-tech.icu/books/linux-notes/10.shell-%E5%91%BD%E4%BB%A4/%E7%BD%91%E7%BB%9C/</link><atom:link href="https://ng-tech.icu/books/linux-notes/10.shell-%E5%91%BD%E4%BB%A4/%E7%BD%91%E7%BB%9C/index.xml" rel="self" type="application/rss+xml"/><description>网络</description><generator>Wowchemy (https://wowchemy.com)</generator><language>zh</language><image><url>https://ng-tech.icu/media/sharing.png</url><title>网络</title><link>https://ng-tech.icu/books/linux-notes/10.shell-%E5%91%BD%E4%BB%A4/%E7%BD%91%E7%BB%9C/</link></image><item><title>netstat</title><link>https://ng-tech.icu/books/linux-notes/10.shell-%E5%91%BD%E4%BB%A4/%E7%BD%91%E7%BB%9C/netstat/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://ng-tech.icu/books/linux-notes/10.shell-%E5%91%BD%E4%BB%A4/%E7%BD%91%E7%BB%9C/netstat/</guid><description/></item><item><title>SSH</title><link>https://ng-tech.icu/books/linux-notes/10.shell-%E5%91%BD%E4%BB%A4/%E7%BD%91%E7%BB%9C/ssh/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://ng-tech.icu/books/linux-notes/10.shell-%E5%91%BD%E4%BB%A4/%E7%BD%91%E7%BB%9C/ssh/</guid><description>&lt;h1 id="ssh">SSH&lt;/h1>
&lt;h1 id="links">Links&lt;/h1>
&lt;ul>
&lt;li>&lt;a href="https://iximiuz.com/en/posts/ssh-tunnels/" target="_blank" rel="noopener">https://iximiuz.com/en/posts/ssh-tunnels/&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>路由与映射</title><link>https://ng-tech.icu/books/linux-notes/10.shell-%E5%91%BD%E4%BB%A4/%E7%BD%91%E7%BB%9C/%E8%B7%AF%E7%94%B1%E4%B8%8E%E6%98%A0%E5%B0%84/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://ng-tech.icu/books/linux-notes/10.shell-%E5%91%BD%E4%BB%A4/%E7%BD%91%E7%BB%9C/%E8%B7%AF%E7%94%B1%E4%B8%8E%E6%98%A0%E5%B0%84/</guid><description>&lt;h1 id="iptables">iptables&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">iptables -P INPUT ACCEPT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -P OUTPUT ACCEPT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -P FORWARD ACCEPT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iptables -F
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="端口映射">端口映射&lt;/h2>
&lt;p>需要将外网访问本地 IP(192.168.75.5)的 80 端口转换为访问 192.168.75.3 的 8000 端口，这就需要用到 iptables 的端口映射，首先需要开启 Linux 的数据转发功能:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># vi /etc/sysctl.conf，将net.ipv4.ip_forward=0更改为net.ipv4.ip_forward=1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># sysctl -p //使数据转发功能生效&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>然后更改 iptables，使之实现 nat 映射功能：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 将外网访问 192.168.75.5 的 80 端口转发到 192.168.75.3:8000 端口。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ iptables -t nat -A PREROUTING -d 192.168.75.5 -p tcp --dport &lt;span class="m">80&lt;/span> -j DNAT --to-destination 192.168.75.3:8000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 将 192.168.75.3 8000 端口将数据返回给客户端时，将源 ip 改为 192.168.75.5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ iptables -t nat -A POSTROUTING -d 192.168.75.3 -p tcp --dport &lt;span class="m">8000&lt;/span> -j SNAT 192.168.75.5
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查看 nat，可以使用命令：&lt;code>iptables -t nat –lis&lt;/code>t 检查 nat 列表信息，结果如下图所示&lt;/p>
&lt;p>&lt;a href="http://static.coolnull.com/wp-content/uploads/2014/09/iptables.jpg" target="_blank" rel="noopener">
&lt;figure >
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="http://static.coolnull.com/wp-content/uploads/2014/09/iptables.jpg" alt="iptables" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;/figure>&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 将外网访问 80 端口的数据转发到 8080 端口&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ iptables -t nat -A PREROUTING -p tcp --dport &lt;span class="m">80&lt;/span> -j REDIRECT --to-ports &lt;span class="m">8080&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 将本机访问 80 端口的转发到本机 8080&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ iptables -t nat -A OUTPUT -p tcp -d 127.0.0.1 --dport &lt;span class="m">80&lt;/span> -j DNAT --to 127.0.0.1:8080
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ iptables -t nat -A OUTPUT -p tcp -d 192.168.4.177 --dport &lt;span class="m">80&lt;/span> -j DNAT --to 127.0.0.1:8080
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>本地连接指的是在本机上，用 127.0.0.1 或者本机 IP 来访问本机的端口。本地连接的数据包不会通过网卡，而是由内核处理后直接发给本地进程。这种数据包在 iptables 中只经过 OUTPUT 链，而不会经过 PREROUTING 链。所以需要在 OUTPUT 链中进行 DNAT。除了对 127.0.0.1 之外，对本机 IP (即 192.168.4.177) 的访问也属于本地连接。&lt;/p></description></item><item><title>网卡配置</title><link>https://ng-tech.icu/books/linux-notes/10.shell-%E5%91%BD%E4%BB%A4/%E7%BD%91%E7%BB%9C/%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://ng-tech.icu/books/linux-notes/10.shell-%E5%91%BD%E4%BB%A4/%E7%BD%91%E7%BB%9C/%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE/</guid><description>&lt;h1 id="网卡配置">网卡配置&lt;/h1>
&lt;h1 id="ubuntu">Ubuntu&lt;/h1>
&lt;p>在 Ubuntu 中我们可以通过配置 &lt;code>/etc/netplan&lt;/code> 来设置当前的网卡信息：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">network&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ethernets&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">eno1&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addresses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="m">192.168.1.13&lt;/span>&lt;span class="l">/24]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">gateway4&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">192.168.1.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">dhcp4&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">optional&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">nameservers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">addresses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="m">8.8.8.8&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8.8.4.4&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">2&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>然后直接应用该配置：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ netplan apply
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>网络工具</title><link>https://ng-tech.icu/books/linux-notes/10.shell-%E5%91%BD%E4%BB%A4/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E5%B7%A5%E5%85%B7/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://ng-tech.icu/books/linux-notes/10.shell-%E5%91%BD%E4%BB%A4/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E5%B7%A5%E5%85%B7/</guid><description/></item><item><title>网络请求</title><link>https://ng-tech.icu/books/linux-notes/10.shell-%E5%91%BD%E4%BB%A4/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://ng-tech.icu/books/linux-notes/10.shell-%E5%91%BD%E4%BB%A4/%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/</guid><description>&lt;h1 id="dns">DNS&lt;/h1>
&lt;p>DNS 解析检索与查询：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">$ dig ns alicdn.com
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="nc">nc&lt;/h1>
&lt;p>想要连接到某处: &lt;code>nc [-options] hostname port[s][ports] …&lt;/code>，绑定端口等待连接: &lt;code>nc -l -p port [-options][hostname] [port]&lt;/code>：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">-g gateway source-routing hop point&lt;span class="o">[&lt;/span>s&lt;span class="o">]&lt;/span>, up to &lt;span class="m">8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-G num source-routing pointer: 4, 8, 12, …
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-h 帮助信息
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-i secs 延时的间隔
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-l 监听模式，用于入站连接
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-n 指定数字的 IP 地址，不能用 hostname
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-o file 记录 &lt;span class="m">16&lt;/span> 进制的传输
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p port 本地端口号
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-r 任意指定本地及远程端口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-s addr 本地源地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-u UDP 模式
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-v 详细输出——用两个
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-v 可得到更详细的内容
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-w secs timeout 的时间
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-z 将输入输出关掉——用于扫描时，其中端口号可以指定一个或者用 lo-hi 式的指定范围。
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>常见用法：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 端口扫描&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ nc -v -w &lt;span class="m">2&lt;/span> 192.168.2.34 -z 21-24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 监听&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ nc -l &lt;span class="m">1234&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ nc 192.168.2.34 &lt;span class="m">1234&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 文件拷贝，从 192.168.2.33 拷贝文件到 192.168.2.34&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ nc -l &lt;span class="m">1234&lt;/span> &amp;gt; test.txt &lt;span class="c1"># 192.168.2.34&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ nc 192.168.2.34 &amp;lt; test.txt &lt;span class="c1"># 192.168.2.33&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 发送端&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ cat a.txt &lt;span class="p">|&lt;/span> nc -l &lt;span class="m">3333&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 接收端&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ nc 192.168.0.3 &lt;span class="m">3333&lt;/span> &amp;gt; a.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>