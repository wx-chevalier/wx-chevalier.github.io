<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="weight: 89 title: Kubernetes 中的用户与身份认证授权 date: &ldquo;2022-05-21T00:00:00+08:00&rdquo; type: book 在安装集群的时候我们在 master 节点上生成了一堆证书、token，还在 kubelet 的配置中用到了 bootstrap token，安装各种应用时，为了能够与 API server 通信创建了各种 service account，在 Dashboard 中使"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/13.%E9%9B%86%E7%BE%A4%E5%AE%89%E5%85%A8%E6%80%A7%E7%AE%A1%E7%90%86/authentication/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.fab3cd1900ae35687457073b2d518207.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/13.%E9%9B%86%E7%BE%A4%E5%AE%89%E5%85%A8%E6%80%A7%E7%AE%A1%E7%90%86/authentication/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/13.%E9%9B%86%E7%BE%A4%E5%AE%89%E5%85%A8%E6%80%A7%E7%AE%A1%E7%90%86/authentication/"><meta property="og:title" content="authentication | Next-gen Tech Edu"><meta property="og:description" content="weight: 89 title: Kubernetes 中的用户与身份认证授权 date: &ldquo;2022-05-21T00:00:00+08:00&rdquo; type: book 在安装集群的时候我们在 master 节点上生成了一堆证书、token，还在 kubelet 的配置中用到了 bootstrap token，安装各种应用时，为了能够与 API server 通信创建了各种 service account，在 Dashboard 中使"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>authentication | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=b0ba08c2ad53dc690806706f9f8a5716><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">_index</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idfeb2a47527259ef304df22cf4fd82382")' href=#idfeb2a47527259ef304df22cf4fd82382 aria-expanded=false aria-controls=idfeb2a47527259ef304df22cf4fd82382 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/>_index</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idfeb2a47527259ef304df22cf4fd82382 aria-expanded=false aria-controls=idfeb2a47527259ef304df22cf4fd82382><i class="fa-solid fa-angle-down" id=caret-idfeb2a47527259ef304df22cf4fd82382></i></a></div><ul class="nav docs-sidenav collapse show" id=idfeb2a47527259ef304df22cf4fd82382><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id74d39329e37c239b9d6d4b2c4a260a33")' href=#id74d39329e37c239b9d6d4b2c4a260a33 aria-expanded=false aria-controls=id74d39329e37c239b9d6d4b2c4a260a33 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/02.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/>_index</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id74d39329e37c239b9d6d4b2c4a260a33 aria-expanded=false aria-controls=id74d39329e37c239b9d6d4b2c4a260a33><i class="fa-solid fa-angle-right" id=caret-id74d39329e37c239b9d6d4b2c4a260a33></i></a></div><ul class="nav docs-sidenav collapse" id=id74d39329e37c239b9d6d4b2c4a260a33><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/02.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/14.init-%E5%AE%B9%E5%99%A8/>14.Init 容器</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/02.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/pause-container/>pause-container</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/02.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/pod/>pod</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/02.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/pod-disruption-budget/>pod-disruption-budget</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/02.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/pod-hook/>pod-hook</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/02.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/pod-lifecycle/>pod-lifecycle</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/02.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/pod-overview/>pod-overview</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/02.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/pod-preset/>pod-preset</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/02.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1/pod-security-policy/>pod-security-policy</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id00d0eb1f5206fd2532bbc45c4bdd8926")' href=#id00d0eb1f5206fd2532bbc45c4bdd8926 aria-expanded=false aria-controls=id00d0eb1f5206fd2532bbc45c4bdd8926 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/05.%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E4%B8%8E%E8%B7%AF%E7%94%B1/>_index</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id00d0eb1f5206fd2532bbc45c4bdd8926 aria-expanded=false aria-controls=id00d0eb1f5206fd2532bbc45c4bdd8926><i class="fa-solid fa-angle-right" id=caret-id00d0eb1f5206fd2532bbc45c4bdd8926></i></a></div><ul class="nav docs-sidenav collapse" id=id00d0eb1f5206fd2532bbc45c4bdd8926><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/05.%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E4%B8%8E%E8%B7%AF%E7%94%B1/39.service/>39.Service</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/05.%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E4%B8%8E%E8%B7%AF%E7%94%B1/40.%E6%8B%93%E6%89%91%E6%84%9F%E7%9F%A5%E8%B7%AF%E7%94%B1/>40.拓扑感知路由</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/05.%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E4%B8%8E%E8%B7%AF%E7%94%B1/41.ingress/>41.Ingress</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/05.%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0%E4%B8%8E%E8%B7%AF%E7%94%B1/42.gateway-api/>42.Gateway API</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id32c88b3f1c86b390a9c6f65823b94d5e")' href=#id32c88b3f1c86b390a9c6f65823b94d5e aria-expanded=false aria-controls=id32c88b3f1c86b390a9c6f65823b94d5e aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/07.%E7%BD%91%E7%BB%9C/>_index</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id32c88b3f1c86b390a9c6f65823b94d5e aria-expanded=false aria-controls=id32c88b3f1c86b390a9c6f65823b94d5e><i class="fa-solid fa-angle-right" id=caret-id32c88b3f1c86b390a9c6f65823b94d5e></i></a></div><ul class="nav docs-sidenav collapse" id=id32c88b3f1c86b390a9c6f65823b94d5e><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/07.%E7%BD%91%E7%BB%9C/calico/>calico</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/07.%E7%BD%91%E7%BB%9C/cilium/>cilium</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/07.%E7%BD%91%E7%BB%9C/flannel/>flannel</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id1288ced20a7fea2f35c56e0b90712237")' href=#id1288ced20a7fea2f35c56e0b90712237 aria-expanded=false aria-controls=id1288ced20a7fea2f35c56e0b90712237 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/09.%E6%89%A9%E5%B1%95%E9%9B%86%E7%BE%A4/>_index</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id1288ced20a7fea2f35c56e0b90712237 aria-expanded=false aria-controls=id1288ced20a7fea2f35c56e0b90712237><i class="fa-solid fa-angle-right" id=caret-id1288ced20a7fea2f35c56e0b90712237></i></a></div><ul class="nav docs-sidenav collapse" id=id1288ced20a7fea2f35c56e0b90712237><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/09.%E6%89%A9%E5%B1%95%E9%9B%86%E7%BE%A4/aggregated-api-server/>aggregated-api-server</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/09.%E6%89%A9%E5%B1%95%E9%9B%86%E7%BE%A4/apiservice/>apiservice</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/09.%E6%89%A9%E5%B1%95%E9%9B%86%E7%BE%A4/crd/>crd</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/09.%E6%89%A9%E5%B1%95%E9%9B%86%E7%BE%A4/custom-resource/>custom-resource</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/09.%E6%89%A9%E5%B1%95%E9%9B%86%E7%BE%A4/service-catalog/>service-catalog</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idd7760aeea62bb053c481ba072639774f")' href=#idd7760aeea62bb053c481ba072639774f aria-expanded=false aria-controls=idd7760aeea62bb053c481ba072639774f aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/10.%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86/>_index</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idd7760aeea62bb053c481ba072639774f aria-expanded=false aria-controls=idd7760aeea62bb053c481ba072639774f><i class="fa-solid fa-angle-right" id=caret-idd7760aeea62bb053c481ba072639774f></i></a></div><ul class="nav docs-sidenav collapse" id=idd7760aeea62bb053c481ba072639774f><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/10.%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86/federation/>federation</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/10.%E5%A4%9A%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86/multi-cluster-services-api/>multi-cluster-services-api</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id8fea313385df6cf9c2a4a8befa22b099")' href=#id8fea313385df6cf9c2a4a8befa22b099 aria-expanded=false aria-controls=id8fea313385df6cf9c2a4a8befa22b099 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/11.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1%E9%85%8D%E7%BD%AE/>_index</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id8fea313385df6cf9c2a4a8befa22b099 aria-expanded=false aria-controls=id8fea313385df6cf9c2a4a8befa22b099><i class="fa-solid fa-angle-right" id=caret-id8fea313385df6cf9c2a4a8befa22b099></i></a></div><ul class="nav docs-sidenav collapse" id=id8fea313385df6cf9c2a4a8befa22b099><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/11.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1%E9%85%8D%E7%BD%AE/74.%E9%85%8D%E7%BD%AE-pod-%E7%9A%84-liveness-%E5%92%8C-readiness-%E6%8E%A2%E9%92%88/>74.配置 Pod 的 liveness 和 readiness 探针</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/11.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1%E9%85%8D%E7%BD%AE/quota/>quota</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/11.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1%E9%85%8D%E7%BD%AE/secret/>secret</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/11.%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1%E9%85%8D%E7%BD%AE/service-account/>service-account</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id168c4a45c67989cc65f77496e86d8aa8")' href=#id168c4a45c67989cc65f77496e86d8aa8 aria-expanded=false aria-controls=id168c4a45c67989cc65f77496e86d8aa8 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/12.%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/>_index</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id168c4a45c67989cc65f77496e86d8aa8 aria-expanded=false aria-controls=id168c4a45c67989cc65f77496e86d8aa8><i class="fa-solid fa-angle-right" id=caret-id168c4a45c67989cc65f77496e86d8aa8></i></a></div><ul class="nav docs-sidenav collapse" id=id168c4a45c67989cc65f77496e86d8aa8><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/12.%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/docker-cli-to-kubectl/>docker-cli-to-kubectl</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/12.%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/etcdctl/>etcdctl</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/12.%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/kubectl-cheatsheet/>kubectl-cheatsheet</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/12.%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8/using-kubectl/>using-kubectl</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id01a01dcaf73a226d20a86d2a0e6589cf")' href=#id01a01dcaf73a226d20a86d2a0e6589cf aria-expanded=false aria-controls=id01a01dcaf73a226d20a86d2a0e6589cf aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/13.%E9%9B%86%E7%BE%A4%E5%AE%89%E5%85%A8%E6%80%A7%E7%AE%A1%E7%90%86/>_index</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id01a01dcaf73a226d20a86d2a0e6589cf aria-expanded=false aria-controls=id01a01dcaf73a226d20a86d2a0e6589cf><i class="fa-solid fa-angle-down" id=caret-id01a01dcaf73a226d20a86d2a0e6589cf></i></a></div><ul class="nav docs-sidenav collapse show" id=id01a01dcaf73a226d20a86d2a0e6589cf><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/13.%E9%9B%86%E7%BE%A4%E5%AE%89%E5%85%A8%E6%80%A7%E7%AE%A1%E7%90%86/auth-with-kubeconfig-or-token/>auth-with-kubeconfig-or-token</a></li><li class="child level active"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/13.%E9%9B%86%E7%BE%A4%E5%AE%89%E5%85%A8%E6%80%A7%E7%AE%A1%E7%90%86/authentication/>authentication</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/13.%E9%9B%86%E7%BE%A4%E5%AE%89%E5%85%A8%E6%80%A7%E7%AE%A1%E7%90%86/ip-masq-agent/>ip-masq-agent</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/13.%E9%9B%86%E7%BE%A4%E5%AE%89%E5%85%A8%E6%80%A7%E7%AE%A1%E7%90%86/kubectl-user-authentication-authorization/>kubectl-user-authentication-authorization</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/13.%E9%9B%86%E7%BE%A4%E5%AE%89%E5%85%A8%E6%80%A7%E7%AE%A1%E7%90%86/kubelet-authentication-authorization/>kubelet-authentication-authorization</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/13.%E9%9B%86%E7%BE%A4%E5%AE%89%E5%85%A8%E6%80%A7%E7%AE%A1%E7%90%86/kubernetes-security-best-practice/>kubernetes-security-best-practice</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/13.%E9%9B%86%E7%BE%A4%E5%AE%89%E5%85%A8%E6%80%A7%E7%AE%A1%E7%90%86/managing-tls-in-a-cluster/>managing-tls-in-a-cluster</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/13.%E9%9B%86%E7%BE%A4%E5%AE%89%E5%85%A8%E6%80%A7%E7%AE%A1%E7%90%86/tls-bootstrapping/>tls-bootstrapping</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id39fdbb30c1067eb27eb3da47e08b99b4")' href=#id39fdbb30c1067eb27eb3da47e08b99b4 aria-expanded=false aria-controls=id39fdbb30c1067eb27eb3da47e08b99b4 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/14.%E8%AE%BF%E9%97%AE%E9%9B%86%E7%BE%A4/>_index</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id39fdbb30c1067eb27eb3da47e08b99b4 aria-expanded=false aria-controls=id39fdbb30c1067eb27eb3da47e08b99b4><i class="fa-solid fa-angle-right" id=caret-id39fdbb30c1067eb27eb3da47e08b99b4></i></a></div><ul class="nav docs-sidenav collapse" id=id39fdbb30c1067eb27eb3da47e08b99b4><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/14.%E8%AE%BF%E9%97%AE%E9%9B%86%E7%BE%A4/accessing-kubernetes-pods-from-outside-of-the-cluster/>accessing-kubernetes-pods-from-outside-of-the-cluster</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/14.%E8%AE%BF%E9%97%AE%E9%9B%86%E7%BE%A4/authenticate-across-clusters-kubeconfig/>authenticate-across-clusters-kubeconfig</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/14.%E8%AE%BF%E9%97%AE%E9%9B%86%E7%BE%A4/connecting-to-applications-port-forward/>connecting-to-applications-port-forward</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/14.%E8%AE%BF%E9%97%AE%E9%9B%86%E7%BE%A4/kubernator-kubernetes-ui/>kubernator-kubernetes-ui</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/14.%E8%AE%BF%E9%97%AE%E9%9B%86%E7%BE%A4/lens/>lens</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/14.%E8%AE%BF%E9%97%AE%E9%9B%86%E7%BE%A4/methods/>methods</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/14.%E8%AE%BF%E9%97%AE%E9%9B%86%E7%BE%A4/service-access-application-cluster/>service-access-application-cluster</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idf4cf6ce46a88a0c077dfca9b9e734c24")' href=#idf4cf6ce46a88a0c077dfca9b9e734c24 aria-expanded=false aria-controls=idf4cf6ce46a88a0c077dfca9b9e734c24 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/15.%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8/>_index</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idf4cf6ce46a88a0c077dfca9b9e734c24 aria-expanded=false aria-controls=idf4cf6ce46a88a0c077dfca9b9e734c24><i class="fa-solid fa-angle-right" id=caret-idf4cf6ce46a88a0c077dfca9b9e734c24></i></a></div><ul class="nav docs-sidenav collapse" id=idf4cf6ce46a88a0c077dfca9b9e734c24><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/15.%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8/deploy-applications-in-kubernetes/>deploy-applications-in-kubernetes</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/15.%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8/migrating-hadoop-yarn-to-kubernetes/>migrating-hadoop-yarn-to-kubernetes</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/15.%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8/using-statefulset/>using-statefulset</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-iddc4a814b092bd6f1cf42d650fe7e06ef")' href=#iddc4a814b092bd6f1cf42d650fe7e06ef aria-expanded=false aria-controls=iddc4a814b092bd6f1cf42d650fe7e06ef aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/17.%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/>_index</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#iddc4a814b092bd6f1cf42d650fe7e06ef aria-expanded=false aria-controls=iddc4a814b092bd6f1cf42d650fe7e06ef><i class="fa-solid fa-angle-right" id=caret-iddc4a814b092bd6f1cf42d650fe7e06ef></i></a></div><ul class="nav docs-sidenav collapse" id=iddc4a814b092bd6f1cf42d650fe7e06ef><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/17.%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/advance-developer/>advance-developer</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/17.%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/client-go-sample/>client-go-sample</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/17.%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/contribute/>contribute</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/17.%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/developing-environment/>developing-environment</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/17.%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/kubebuilder/>kubebuilder</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/17.%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/minikube/>minikube</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/17.%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/operator/>operator</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/17.%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/operator-sdk/>operator-sdk</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/17.%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/sigs-and-working-group/>sigs-and-working-group</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/17.%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/testing/>testing</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idc379548d194af53b89f5e96849eabfca")' href=#idc379548d194af53b89f5e96849eabfca aria-expanded=false aria-controls=idc379548d194af53b89f5e96849eabfca aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/01.kubernetes-%E6%9E%B6%E6%9E%84/>01.Kubernetes 架构</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idc379548d194af53b89f5e96849eabfca aria-expanded=false aria-controls=idc379548d194af53b89f5e96849eabfca><i class="fa-solid fa-angle-right" id=caret-idc379548d194af53b89f5e96849eabfca></i></a></div><ul class="nav docs-sidenav collapse" id=idc379548d194af53b89f5e96849eabfca><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/01.kubernetes-%E6%9E%B6%E6%9E%84/11.pod-%E7%8A%B6%E6%80%81%E4%B8%8E%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AE%A1%E7%90%86/>11.Pod 状态与生命周期管理</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/01.kubernetes-%E6%9E%B6%E6%9E%84/4.kubernetes-%E7%9A%84%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5/>4.Kubernetes 的设计理念</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/01.kubernetes-%E6%9E%B6%E6%9E%84/5.etcd-%E8%A7%A3%E6%9E%90/>5.Etcd 解析</a></li><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id368e72318dd32dbcd50de93ab64365e7")' href=#id368e72318dd32dbcd50de93ab64365e7 aria-expanded=false aria-controls=id368e72318dd32dbcd50de93ab64365e7 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/01.kubernetes-%E6%9E%B6%E6%9E%84/6.%E5%BC%80%E6%94%BE%E6%8E%A5%E5%8F%A3/>6.开放接口</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id368e72318dd32dbcd50de93ab64365e7 aria-expanded=false aria-controls=id368e72318dd32dbcd50de93ab64365e7><i class="fa-solid fa-angle-right" id=caret-id368e72318dd32dbcd50de93ab64365e7></i></a></div><ul class="nav docs-sidenav collapse" id=id368e72318dd32dbcd50de93ab64365e7><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/01.kubernetes-%E6%9E%B6%E6%9E%84/6.%E5%BC%80%E6%94%BE%E6%8E%A5%E5%8F%A3/7.%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E6%97%B6%E6%8E%A5%E5%8F%A3cri/>7.容器运行时接口（CRI）</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/01.kubernetes-%E6%9E%B6%E6%9E%84/6.%E5%BC%80%E6%94%BE%E6%8E%A5%E5%8F%A3/8.%E5%AE%B9%E5%99%A8%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3cni/>8.容器网络接口（CNI）</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/01.kubernetes-%E6%9E%B6%E6%9E%84/6.%E5%BC%80%E6%94%BE%E6%8E%A5%E5%8F%A3/9.%E5%AE%B9%E5%99%A8%E5%AD%98%E5%82%A8%E6%8E%A5%E5%8F%A3csi/>9.容器存储接口（CSI）</a></li></ul></div></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id1d05cd42f9cfbd4840e4fd53bae4dd56")' href=#id1d05cd42f9cfbd4840e4fd53bae4dd56 aria-expanded=false aria-controls=id1d05cd42f9cfbd4840e4fd53bae4dd56 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/03.%E9%9B%86%E7%BE%A4%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/>03.集群资源管理</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id1d05cd42f9cfbd4840e4fd53bae4dd56 aria-expanded=false aria-controls=id1d05cd42f9cfbd4840e4fd53bae4dd56><i class="fa-solid fa-angle-right" id=caret-id1d05cd42f9cfbd4840e4fd53bae4dd56></i></a></div><ul class="nav docs-sidenav collapse" id=id1d05cd42f9cfbd4840e4fd53bae4dd56><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/03.%E9%9B%86%E7%BE%A4%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/22.node/>22.Node</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/03.%E9%9B%86%E7%BE%A4%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/23.namespace/>23.Namespace</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/03.%E9%9B%86%E7%BE%A4%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/24.label/>24.Label</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/03.%E9%9B%86%E7%BE%A4%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/25.annotation/>25.Annotation</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/03.%E9%9B%86%E7%BE%A4%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/26.taint-%E5%92%8C-toleration%E6%B1%A1%E7%82%B9%E5%92%8C%E5%AE%B9%E5%BF%8D/>26.Taint 和 Toleration（污点和容忍）</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/03.%E9%9B%86%E7%BE%A4%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/27.%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/>27.垃圾收集</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/03.%E9%9B%86%E7%BE%A4%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/71.%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6/>71.资源调度</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/03.%E9%9B%86%E7%BE%A4%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/72.%E6%9C%8D%E5%8A%A1%E8%B4%A8%E9%87%8F%E7%AD%89%E7%BA%A7qos/>72.服务质量等级（QoS）</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id73fa50fc0f0e8300fcb24a99c4fe7e56")' href=#id73fa50fc0f0e8300fcb24a99c4fe7e56 aria-expanded=false aria-controls=id73fa50fc0f0e8300fcb24a99c4fe7e56 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/04.%E6%8E%A7%E5%88%B6%E5%99%A8/>04.控制器</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id73fa50fc0f0e8300fcb24a99c4fe7e56 aria-expanded=false aria-controls=id73fa50fc0f0e8300fcb24a99c4fe7e56><i class="fa-solid fa-angle-right" id=caret-id73fa50fc0f0e8300fcb24a99c4fe7e56></i></a></div><ul class="nav docs-sidenav collapse" id=id73fa50fc0f0e8300fcb24a99c4fe7e56><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/04.%E6%8E%A7%E5%88%B6%E5%99%A8/29.deployment/>29.Deployment</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/04.%E6%8E%A7%E5%88%B6%E5%99%A8/30.statefulset/>30.StatefulSet</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/04.%E6%8E%A7%E5%88%B6%E5%99%A8/31.daemonset/>31.DaemonSet</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/04.%E6%8E%A7%E5%88%B6%E5%99%A8/32.replicationcontroller-%E5%92%8C-replicaset/>32.ReplicationController 和 ReplicaSet</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/04.%E6%8E%A7%E5%88%B6%E5%99%A8/33.job/>33.Job</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/04.%E6%8E%A7%E5%88%B6%E5%99%A8/34.cronjob/>34.CronJob</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/04.%E6%8E%A7%E5%88%B6%E5%99%A8/34.ingress-%E6%8E%A7%E5%88%B6%E5%99%A8/>34.Ingress 控制器</a></li><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id8843184acab98f9c1f592c03cde5d6c8")' href=#id8843184acab98f9c1f592c03cde5d6c8 aria-expanded=false aria-controls=id8843184acab98f9c1f592c03cde5d6c8 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/04.%E6%8E%A7%E5%88%B6%E5%99%A8/35.horizontal-pod-autoscaling/>35.Horizontal Pod Autoscaling</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id8843184acab98f9c1f592c03cde5d6c8 aria-expanded=false aria-controls=id8843184acab98f9c1f592c03cde5d6c8><i class="fa-solid fa-angle-right" id=caret-id8843184acab98f9c1f592c03cde5d6c8></i></a></div><ul class="nav docs-sidenav collapse" id=id8843184acab98f9c1f592c03cde5d6c8><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/04.%E6%8E%A7%E5%88%B6%E5%99%A8/35.horizontal-pod-autoscaling/36.%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E6%A0%87-hpa/>36.自定义指标 HPA</a></li></ul></div><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/04.%E6%8E%A7%E5%88%B6%E5%99%A8/37.%E5%87%86%E5%85%A5%E6%8E%A7%E5%88%B6%E5%99%A8admission-controller/>37.准入控制器（Admission Controller）</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id8d90075d981248eb8af28ee2dbf60243")' href=#id8d90075d981248eb8af28ee2dbf60243 aria-expanded=false aria-controls=id8d90075d981248eb8af28ee2dbf60243 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/06.%E8%BA%AB%E4%BB%BD%E4%B8%8E%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81/>06.身份与权限认证</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id8d90075d981248eb8af28ee2dbf60243 aria-expanded=false aria-controls=id8d90075d981248eb8af28ee2dbf60243><i class="fa-solid fa-angle-right" id=caret-id8d90075d981248eb8af28ee2dbf60243></i></a></div><ul class="nav docs-sidenav collapse" id=id8d90075d981248eb8af28ee2dbf60243><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/06.%E8%BA%AB%E4%BB%BD%E4%B8%8E%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81/network-policy/>network-policy</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/06.%E8%BA%AB%E4%BB%BD%E4%B8%8E%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81/rbac/>rbac</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/06.%E8%BA%AB%E4%BB%BD%E4%B8%8E%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81/serviceaccount/>serviceaccount</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/06.%E8%BA%AB%E4%BB%BD%E4%B8%8E%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81/spiffe/>spiffe</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/06.%E8%BA%AB%E4%BB%BD%E4%B8%8E%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81/spire/>spire</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/06.%E8%BA%AB%E4%BB%BD%E4%B8%8E%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81/spire-k8s-workload-registar/>spire-k8s-workload-registar</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/06.%E8%BA%AB%E4%BB%BD%E4%B8%8E%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81/svid/>svid</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idf759f23d388589b25d9dd92d16f640a5")' href=#idf759f23d388589b25d9dd92d16f640a5 aria-expanded=false aria-controls=idf759f23d388589b25d9dd92d16f640a5 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/08.%E5%AD%98%E5%82%A8/>08.存储</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idf759f23d388589b25d9dd92d16f640a5 aria-expanded=false aria-controls=idf759f23d388589b25d9dd92d16f640a5><i class="fa-solid fa-angle-right" id=caret-idf759f23d388589b25d9dd92d16f640a5></i></a></div><ul class="nav docs-sidenav collapse" id=idf759f23d388589b25d9dd92d16f640a5><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/08.%E5%AD%98%E5%82%A8/55.secret/>55.Secret</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/08.%E5%AD%98%E5%82%A8/56.configmap/>56.ConfigMap</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/08.%E5%AD%98%E5%82%A8/57.configmap-%E7%9A%84%E7%83%AD%E6%9B%B4%E6%96%B0/>57.ConfigMap 的热更新</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/08.%E5%AD%98%E5%82%A8/58.volume/>58.Volume</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/08.%E5%AD%98%E5%82%A8/59.%E6%8C%81%E4%B9%85%E5%8C%96%E5%8D%B7persistent-volume/>59.持久化卷（Persistent Volume）</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/08.%E5%AD%98%E5%82%A8/60.storage-class/>60.Storage Class</a></li><li class="child level"><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/08.%E5%AD%98%E5%82%A8/61.%E6%9C%AC%E5%9C%B0%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8/>61.本地持久化存储</a></li></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#type-book>weight: 89
title: Kubernetes 中的用户与身份认证授权
date: &ldquo;2022-05-21T00:00:00+08:00&rdquo;
type: book</a></li><li><a href=#认识-kubernetes-中的用户>认识 Kubernetes 中的用户</a></li><li><a href=#认证策略>认证策略</a><ul><li><a href=#x509-客户端证书>X509 客户端证书</a></li><li><a href=#静态-token-文件>静态 Token 文件</a></li><li><a href=#bootstrap-token>Bootstrap Token</a></li><li><a href=#静态密码文件>静态密码文件</a></li><li><a href=#service-account-token>Service Account Token</a></li><li><a href=#openid-connect-token>OpenID Connect Token</a></li><li><a href=#webhook-token-认证>Webhook Token 认证</a></li><li><a href=#认证代理>认证代理</a></li><li><a href=#keystone-密码>Keystone 密码</a></li></ul></li><li><a href=#匿名请求>匿名请求</a></li><li><a href=#用户模拟>用户模拟</a></li><li><a href=#附录>附录</a><ul><li><a href=#创建证书>创建证书</a></li></ul></li><li><a href=#参考>参考</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>authentication</h1><div class=article-style><hr><h2 id=type-book>weight: 89
title: Kubernetes 中的用户与身份认证授权
date: &ldquo;2022-05-21T00:00:00+08:00&rdquo;
type: book</h2><p>在安装集群的时候我们在 master 节点上生成了一堆证书、token，还在 kubelet 的配置中用到了 bootstrap token，安装各种应用时，为了能够与 API server 通信创建了各种 service account，在 Dashboard 中使用了 kubeconfig 或 token 登陆，那么这些都属于什么认证方式？如何区分用户的？我特地翻译了下这篇官方文档，想你看了之后你将找到答案。</p><p>重点查看 bearer token 和 HTTP 认证中的 token 使用，我们已经有所应用，如 <a href=auth-with-kubeconfig-or-token.md>使用 kubeconfig 或 token 进行用户身份认证</a>。</p><h2 id=认识-kubernetes-中的用户>认识 Kubernetes 中的用户</h2><p>Kubernetes 集群中包含两类用户：一类是由 Kubernetes 管理的 service account，另一类是普通用户。</p><p>普通用户被假定为由外部独立服务管理。管理员分发私钥，用户存储（如 Keystone 或 Google 帐户），甚至包含用户名和密码列表的文件。在这方面，<em>Kubernetes 没有代表普通用户帐户的对象</em>。无法通过 API 调用的方式向集群中添加普通用户。</p><p>相对的，service account 是由 Kubernetes API 管理的帐户。它们都绑定到了特定的 namespace，并由 API server 自动创建，或者通过 API 调用手动创建。Service account 关联了一套凭证，存储在 <code>Secret</code>，这些凭证同时被挂载到 pod 中，从而允许 pod 与 kubernetes API 之间的调用。</p><p>API 请求被绑定到普通用户或 serivce account 上，或者作为匿名请求对待。这意味着集群内部或外部的每个进程，无论从在工作站上输入 <code>kubectl</code> 的人类用户到节点上的 <code>kubelet</code>，到控制平面的成员，都必须在向 API Server 发出请求时进行身份验证，或者被视为匿名用户。</p><h2 id=认证策略>认证策略</h2><p>Kubernetes 使用客户端证书、bearer token、身份验证代理或者 HTTP 基本身份验证等身份认证插件来对 API 请求进行身份验证。当有 HTTP 请求发送到 API server 时，插件会尝试将以下属性关联到请求上：</p><ul><li>用户名：标识最终用户的字符串。常用值可能是 <code>kube-admin</code> 或 <code>jane@example.com</code>。</li><li>UID：标识最终用户的字符串，比用户名更加一致且唯一。</li><li>组：一组将用户和常规用户组相关联的字符串。</li><li>额外字段：包含其他有用认证信息的字符串列表的映射。</li></ul><p>所有的值对于认证系统都是不透明的，只有 <a href=https://kubernetes.io/docs/admin/authorization/ target=_blank rel=noopener>授权人</a> 才能解释这些值的重要含义。</p><p>您可以一次性启用多种身份验证方式。通常使用至少以下两种认证方式：</p><ul><li>服务帐户的 service account token</li><li>至少一种其他的用户认证的方式</li></ul><p>当启用了多个认证模块时，第一个认证模块成功认证后将短路请求，不会进行第二个模块的认证。API server 不会保证认证的顺序。</p><p><code>system:authenticated</code> 组包含在所有已验证用户的组列表中。</p><p>与其他身份验证协议（LDAP、SAML、Kerberos、x509 方案等）的集成可以使用身份验证代理或身份验证 webhook 来实现。</p><h3 id=x509-客户端证书>X509 客户端证书</h3><p>通过将 <code>--client-ca-file=SOMEFILE</code> 选项传递给 API server 来启用客户端证书认证。引用的文件必须包含一个或多个证书颁发机构，用于验证提交给 API server 的客户端证书。如果客户端证书已提交并验证，则使用 subject 的 Common Name（CN）作为请求的用户名。从 Kubernetes 1.4 开始，客户端证书还可以使用证书的 organization 字段来指示用户的组成员身份。要为用户包含多个组成员身份，请在证书中包含多个 organization 字段。</p><p>例如，使用 <code>openssl</code> 命令工具生成用于签名认证请求的证书：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>openssl req -new -key jbeda.pem -out jbeda-csr.pem -subj <span class=s2>&#34;/CN=jbeda/O=app1/O=app2&#34;</span>
</span></span></code></pre></div><p>这将为一个用户名为 ”jbeda“ 的 CSR，属于两个组“app1”和“app2”。</p><h3 id=静态-token-文件>静态 Token 文件</h3><p>当在命令行上指定 <code>--token-auth-file=SOMEFILE</code> 选项时，API server 从文件读取 bearer token。目前，token 会无限期地持续下去，并且不重新启动 API server 的话就无法更改令牌列表。</p><p>token 文件是一个 csv 文件，每行至少包含三列：token、用户名、用户 uid，其次是可选的组名。请注意，如果您有多个组，则该列必须使用双引号。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=na>token,user,uid,&#34;group1,group2,group3&#34;</span>
</span></span></code></pre></div><h4 id=在请求中放置-bearer-token>在请求中放置 Bearer Token</h4><p>当使用来自 http 客户端的 bearer token 时，API server 期望 <code>Authorization</code> header 中包含 <code>Bearer token</code> 的值。Bearer token 必须是一个字符串序列，只需使用 HTTP 的编码和引用功能就可以将其放入到 HTTP header 中。例如：如果 bearer token 是 <code>31ada4fd-adec-460c-809a-9e56ceb75269</code>，那么它将出现在 HTTP header 中，如下所示：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>Authorization: Bearer 31ada4fd-adec-460c-809a-9e56ceb75269
</span></span></span></code></pre></div><h3 id=bootstrap-token>Bootstrap Token</h3><p>该功能仍处于 <strong>alpha</strong> 版本。</p><p>为了简化新集群的初始化引导过程，Kubernetes 中包含了一个名为 <em>Bootstrap Token</em> 的动态管理的 bearer token。这些 token 使用 Secret 存储在 <code>kube-system</code> namespace 中，在那里它们可以被动态管理和创建。Controller Manager 中包含了一个 TokenCleaner 控制器，用于在 bootstrap token 过期时删除将其删除。</p><p>这些 token 的形式是 <code>[a-z0-9]{6}.[a-z0-9]{16}</code>。第一部分是 Token ID，第二部分是 Token Secret。您在 HTTP header 中指定的 token 如下所示：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>Authorization: Bearer 781292.db7bc3a58fc5f07e
</span></span></span></code></pre></div><p>在 API server 的启动参数中加上 <code>--experimental-bootstrap-token-auth</code> 标志以启用 Bootstrap Token Authenticator。您必须通过 Controller Manager 上的 <code>--controllers</code> 标志启用 TokenCleaner 控制器，如 <code>--controllers=*,tokencleaner</code>。如果您使用它来引导集群， <code>kubeadm</code> 会为您完成。</p><p>认证者认证为 <code>system:bootstrap:&lt;Token ID></code> 。被包含在 <code>system:bootstrappers</code> 组中。命名和组是有意限制用户使用过去的 bootstap token。可以使用用户名和组（<code>kubeadm</code> 使用）来制定适当的授权策略以支持引导集群。</p><p>有关 Bootstrap Token 身份验证器和控制器的更深入的文档，以及如何使用 <code>kubeadm</code> 管理这些令牌，请参阅 <a href=https://kubernetes.io/docs/admin/bootstrap-tokens/ target=_blank rel=noopener>Bootstrap Token</a>。</p><h3 id=静态密码文件>静态密码文件</h3><p>通过将 <code>--basic-auth-file=SOMEFILE</code> 选项传递给 API server 来启用基本身份验证。目前，基本身份验证凭证将无限期地保留，并且密码在不重新启动 API 服务器的情况下无法更改。请注意，为了方便起见，目前支持基本身份验证，而上述模式更安全更容易使用。</p><p>基本身份认证是一个 csv 文件，至少包含 3 列：密码、用户名和用户 ID。在 Kubernetes 1.6 和更高版本中，可以指定包含以逗号分隔的组名称的可选第四列。如果您有多个组，则必须将第四列值用双引号（“）括起来，请参阅以下示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=na>password,user,uid,&#34;group1,group2,group3&#34;</span>
</span></span></code></pre></div><p>当使用来自 HTTP 客户端的基本身份验证时，API server 需要<code> Authorization</code> header 中包含 <code>Basic BASE64ENCODED(USER:PASSWORD)</code> 的值。</p><h3 id=service-account-token>Service Account Token</h3><p>Service account 是一个自动启用的验证器，它使用签名的 bearer token 来验证请求。该插件包括两个可选的标志：</p><ul><li><code>--service-account-key-file</code> 一个包含签名 bearer token 的 PEM 编码文件。如果未指定，将使用 API server 的 TLS 私钥。</li><li><code>--service-account-lookup</code> 如果启用，从 API 中删除掉的 token 将被撤销。</li></ul><p>Service account 通常 API server 自动创建，并通过 <code>ServiceAccount</code> <a href=https://kubernetes.io/docs/admin/admission-controllers/ target=_blank rel=noopener>注入控制器</a> 关联到集群中运行的 Pod 上。Bearer token 挂载到 pod 中众所周知的位置，并允许集群进程与 API server 通信。帐户可以使用 <code>PodSpec</code> 的 <code>serviceAccountName</code> 字段显式地与 Pod 关联。</p><p>注意： <code>serviceAccountName</code> 通常被省略，因为这会自动生成。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1beta2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx-deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.7.9</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>serviceAccountName</span><span class=p>:</span><span class=w> </span><span class=l>bob-the-bot</span><span class=w>
</span></span></span></code></pre></div><p>Service account bearer token 在集群外使用也是完全有效的，并且可以用于为希望与 Kubernetes 通信的长期运行作业创建身份。要手动创建 service account，只需要使用 <code>kubectl create serviceaccount (NAME)</code> 命令。这将在当前的 namespace 和相关连的 secret 中创建一个 service account。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl create serviceaccount jenkins
</span></span><span class=line><span class=cl>serviceaccount <span class=s2>&#34;jenkins&#34;</span> created
</span></span><span class=line><span class=cl>$ kubectl get serviceaccounts jenkins -o yaml
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>kind: ServiceAccount
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  <span class=c1># ...</span>
</span></span><span class=line><span class=cl>secrets:
</span></span><span class=line><span class=cl>- name: jenkins-token-1yvwg
</span></span></code></pre></div><p>创建出的 secret 中拥有 API server 的公共 CA 和前面的 JSON Web Token（JWT）。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get secret jenkins-token-1yvwg -o yaml
</span></span><span class=line><span class=cl>apiVersion: v1
</span></span><span class=line><span class=cl>data:
</span></span><span class=line><span class=cl>  ca.crt: <span class=o>(</span>APISERVER<span class=err>&#39;</span>S CA BASE64 ENCODED<span class=o>)</span>
</span></span><span class=line><span class=cl>  namespace: <span class=nv>ZGVmYXVsdA</span><span class=o>==</span>
</span></span><span class=line><span class=cl>  token: <span class=o>(</span>BEARER TOKEN BASE64 ENCODED<span class=o>)</span>
</span></span><span class=line><span class=cl>kind: Secret
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  <span class=c1># ...</span>
</span></span><span class=line><span class=cl>type: kubernetes.io/service-account-token
</span></span></code></pre></div><p>注意：所有值是基于 base64 编码的，因为 secret 总是基于 base64 编码。</p><p>经过签名的 JWT 可以用作 bearer token 与给定的 service account 进行身份验证。请参阅上面关于如何在请求中放置 bearer token。通常情况下，这些 secret 被挂载到 pod 中，以便对集群内的 API server 进行访问，但也可以从集群外访问。</p><p>Service account 验证时用户名 <code>system:serviceaccount:(NAMESPACE):(SERVICEACCOUNT)</code>，被指定到组 <code>system:serviceaccounts</code> 和 <code>system:serviceaccounts:(NAMESPACE)</code>。</p><p>注意：由于 service account 的 token 存储在 secret 中，所以具有对这些 secret 的读取权限的任何用户都可以作为 service account 进行身份验证。授予 service account 权限和读取 secret 功能时要谨慎。</p><h3 id=openid-connect-token>OpenID Connect Token</h3><p><a href=https://openid.net/connect/ target=_blank rel=noopener>OpenID Connect</a> 是由 OAuth2 供应商提供的 OAuth2，特别是 Azure Active Directory、Salesforce 和 Google。对 OAuth2 协议的主要扩展是返回一个称作 <a href=https://openid.net/specs/openid-connect-core-1_0.html#IDToken target=_blank rel=noopener>ID Token</a> 的格外字段。该 token 是一个 JSON Web Token (JWT) ，有服务器签名，具有众所周知的字段，如用户的电子邮件。</p><p>为了识别用户，认证者使用 OAuth2 <a href=https://openid.net/specs/openid-connect-core-1_0.html#TokenResponse target=_blank rel=noopener>token 响应</a> 中的 <code>id_token</code>（而不是 <code>access_token</code>）作为 bearer token。请参阅上面的关于将 token 置于请求中。</p><p><figure id=figure-kubernetes-openid-connect-flow><div class="d-flex justify-content-center"><div class=w-100><img src=https://assets.ng-tech.icu/book/kubernetes-handbook/kubernetes-oidc-login.jpg alt="Kubernetes OpenID Connect Flow" loading=lazy data-zoomable></div></div><figcaption>Kubernetes OpenID Connect Flow</figcaption></figure></p><ol><li>登陆到您的身份提供商</li><li>您的身份提供商将为您提供一个 <code>access_token</code>，一个 <code>id_token</code> 和一个 <code>refresh_token</code></li><li>当使用 <code>kubectl</code> 时，使用 <code>--token</code> 标志和 <code>id_token</code> ，或者直接加入到您的 <code>kubeconfig</code> 文件中</li><li><code>kubectl</code> 在调用 API server 时将 <code>id_token</code> 置于 HTTP header 中</li><li>API server 将通过检查配置中指定的证书来确保 JWT 签名有效</li><li>检查以确保 <code>id_token</code> 没有过期</li><li>确保用户已授权</li><li>授权 API server 后向 <code>kubectl</code></li><li><code>kubectl</code> 向用户提供反馈</li></ol><p>由于所有需要验证您身份的数据都在 <code>id_token</code> 中，Kubernetes 不需要向身份提供商 “phone home”。在每个请求都是无状态的模型中，这为认证提供了非常可扩展的解决方案。它确实提供了一些挑战：</p><ol><li>Kubernetes 没有 ”web 接口“ 来出发验证进程。没有浏览器或界面来收集凭据，这就是为什么您需要首先认证您的身份提供商。</li><li><code>id_token</code> 无法撤销，就像一个证书，所以它应该是短暂的（只有几分钟），所以每隔几分钟就得到一个新的令牌是非常烦人的。</li><li>没有使用 <code>kubectl proxy</code> 命令或注入 <code>id_token</code> 的反向代理，无法简单地对 Kubernetes dashboard 进行身份验证。</li></ol><h4 id=配置-api-server>配置 API Server</h4><p>要启用该插件，需要在 API server 中配置如下标志：</p><table><thead><tr><th>参数</th><th>描述</th><th>示例</th><th>是否必需</th></tr></thead><tbody><tr><td><code>--oidc-issuer-url</code></td><td>允许 API server 发现公共签名密钥的提供者的 URL。只接受使用 <code>https://</code> 的方案。通常是提供商的 URL 地址，不包含路径，例如“<a href=https://accounts.google.com target=_blank rel=noopener>https://accounts.google.com</a>” 或者 “<a href=https://login.salesforce.com target=_blank rel=noopener>https://login.salesforce.com</a>”。这个 URL 应该指向下面的 .well-known/openid-configuration</td><td>如果发现 URL 是 <code>https://accounts.google.com/.well-known/openid-configuration</code>，值应该是<code>https://accounts.google.com</code></td><td>是</td></tr><tr><td><code>--oidc-client-id</code></td><td>所有的 token 必须为其颁发的客户端 ID</td><td>kubernetes</td><td>是</td></tr><tr><td><code>--oidc-username-claim</code></td><td>JWT 声明使用的用户名。默认情况下，<code>sub</code> 是最终用户的唯一标识符。管理员可以选择其他声明，如<code> email</code> 或 <code>name</code>，具体取决于他们的提供者。不过，<code>email</code> 以外的其他声明将以发行者的 URL 作为前缀，以防止与其他插件命名冲突。</td><td>sub</td><td>否</td></tr><tr><td><code>--oidc-groups-claim</code></td><td>JWT 声明使用的用户组。如果生命存在，它必须是一个字符串数组。</td><td>groups</td><td>否</td></tr><tr><td><code>--oidc-ca-file</code></td><td>用来签名您的身份提供商的网络 CA 证书的路径。默认为主机的跟 CA。</td><td><code>/etc/kubernetes/ssl/kc-ca.pem</code></td><td>否</td></tr></tbody></table><p>如果为 <code>--oidc-username-claim</code> 选择了除 <code>email</code> 以外的其他声明，则该值将以 <code>--oidc-issuer-url</code> 作为前缀，以防止与现有 Kubernetes 名称（例如 <code>system:users</code>）冲突。例如，如果提供商网址是 <a href=https://accounts.google.com target=_blank rel=noopener>https://accounts.google.com</a>，而用户名声明映射到 <code>jane</code>，则插件会将用户身份验证为：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>https://accounts.google.com#jane
</span></span></span></code></pre></div><p>重要的是，API server 不是 OAuth2 客户端，而只能配置为信任单个发行者。这允许使用 Google 等公共提供者，而不必信任第三方发行的凭据。希望利用多个 OAuth 客户端的管理员应该探索支持 <code>azp</code>（授权方）声明的提供者，这是允许一个客户端代表另一个客户端发放令牌的机制。</p><p>Kubernetes 不提供 OpenID Connect 身份提供商。您可以使用现有的公共 OpenID Connect 标识提供程序（例如 Google 或 <a href=http://connect2id.com/products/nimbus-oauth-openid-connect-sdk/openid-connect-providers target=_blank rel=noopener>其他</a>）。或者，您可以运行自己的身份提供程序，例如 CoreOS <a href=https://github.com/coreos/dex target=_blank rel=noopener>dex</a>、<a href=https://github.com/keycloak/keycloak target=_blank rel=noopener>Keycloak</a>、CloudFoundry <a href=https://github.com/cloudfoundry/uaa target=_blank rel=noopener>UAA</a> 或 Tremolo Security 的 <a href=https://github.com/tremolosecurity/openunison target=_blank rel=noopener>OpenUnison</a>。</p><p>对于身份提供商能够适用于 Kubernetes，必须满足如下条件：Kubernetes it must:</p><ol><li>支持 <a href=https://openid.net/specs/openid-connect-discovery-1_0.html target=_blank rel=noopener>OpenID connect 发现</a>；不必是全部。</li><li>使用非过时密码在 TLS 中运行</li><li>拥有 CA 签名证书（即使 CA 不是商业 CA 或自签名）</li></ol><p>有关上述要求 3 的说明，需要 CA 签名证书。如果您部署自己的身份提供商（而不是像 Google 或 Microsoft 之类的云提供商），则必须让您的身份提供商的 Web 服务器证书由 CA 标志设置为 TRUE 的证书签名，即使是自签名的。这是由于 GoLang 的 TLS 客户端实现对证书验证的标准非常严格。如果您没有 <code>CA</code>，可以使用 <code>CoreOS</code> 团队的 <a href=https://github.com/coreos/dex/blob/1ee5920c54f5926d6468d2607c728b71cfe98092/examples/k8s/gencert.sh target=_blank rel=noopener>这个脚本</a> 创建一个简单的 CA 和一个签名的证书和密钥对。</p><p>针对特定系统的安装说明：</p><ul><li><a href=https://apigee.com/about/blog/engineering/kubernetes-authentication-enterprise target=_blank rel=noopener>UAA</a></li><li><a href=https://speakerdeck.com/ericchiang/kubernetes-access-control-with-dex target=_blank rel=noopener>Dex</a></li><li><a href=https://github.com/TremoloSecurity/openunison-qs-kubernetes target=_blank rel=noopener>OpenUnison</a></li></ul><h4 id=使用-kubectl>使用 kubectl</h4><h5 id=选项-1---oidc-身份验证器>选项 1 - OIDC 身份验证器</h5><p>第一个选项是使用 <code>oidc</code> 身份验证器。此身份验证程序将您的 <code>id_token</code>、<code>refresh_token</code> 和您的 OIDC <code>client_secret</code> 自动刷新您的 token。一旦您对身份提供者进行了身份验证：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl config set-credentials USER_NAME <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>   --auth-provider<span class=o>=</span>oidc <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>   --auth-provider-arg<span class=o>=</span>idp-issuer-url<span class=o>=(</span> issuer url <span class=o>)</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>   --auth-provider-arg<span class=o>=</span>client-id<span class=o>=(</span> your client id <span class=o>)</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>   --auth-provider-arg<span class=o>=</span>client-secret<span class=o>=(</span> your client secret <span class=o>)</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>   --auth-provider-arg<span class=o>=</span>refresh-token<span class=o>=(</span> your refresh token <span class=o>)</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>   --auth-provider-arg<span class=o>=</span>idp-certificate-authority<span class=o>=(</span> path to your ca certificate <span class=o>)</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>   --auth-provider-arg<span class=o>=</span>id-token<span class=o>=(</span> your id_token <span class=o>)</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>   --auth-provider-arg<span class=o>=</span>extra-scopes<span class=o>=(</span> comma separated list of scopes to add to <span class=s2>&#34;openid email profile&#34;</span>, optional <span class=o>)</span>
</span></span></code></pre></div><p>例如，在向身份提供者进行身份验证之后运行以下命令：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl config set-credentials mmosley  <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        --auth-provider<span class=o>=</span>oidc  <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        --auth-provider-arg<span class=o>=</span>idp-issuer-url<span class=o>=</span>https://oidcidp.tremolo.lan:8443/auth/idp/OidcIdP  <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        --auth-provider-arg<span class=o>=</span>client-id<span class=o>=</span>kubernetes  <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        --auth-provider-arg<span class=o>=</span>client-secret<span class=o>=</span>1db158f6-177d-4d9c-8a8b-d36869918ec5  <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        --auth-provider-arg<span class=o>=</span>refresh-token<span class=o>=</span>q1bKLFOyUiosTfawzA93TzZIDzH2TNa2SMm0zEiPKTUwME6BkEo6Sql5yUWVBSWpKUGphaWpxSVAfekBOZbBhaEW+VlFUeVRGcluyVF5JT4+haZmPsluFoFu5XkpXk5BXqHega4GAXlF+ma+vmYpFcHe5eZR+slBFpZKtQA<span class=o>=</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        --auth-provider-arg<span class=o>=</span>idp-certificate-authority<span class=o>=</span>/root/ca.pem <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        --auth-provider-arg<span class=o>=</span>extra-scopes<span class=o>=</span>groups <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        --auth-provider-arg<span class=o>=</span>id-token<span class=o>=</span>eyJraWQiOiJDTj1vaWRjaWRwLnRyZW1vbG8ubGFuLCBPVT1EZW1vLCBPPVRybWVvbG8gU2VjdXJpdHksIEw9QXJsaW5ndG9uLCBTVD1WaXJnaW5pYSwgQz1VUy1DTj1rdWJlLWNhLTEyMDIxNDc5MjEwMzYwNzMyMTUyIiwiYWxnIjoiUlMyNTYifQ.eyJpc3MiOiJodHRwczovL29pZGNpZHAudHJlbW9sby5sYW46ODQ0My9hdXRoL2lkcC9PaWRjSWRQIiwiYXVkIjoia3ViZXJuZXRlcyIsImV4cCI6MTQ4MzU0OTUxMSwianRpIjoiMm96US15TXdFcHV4WDlHZUhQdy1hZyIsImlhdCI6MTQ4MzU0OTQ1MSwibmJmIjoxNDgzNTQ5MzMxLCJzdWIiOiI0YWViMzdiYS1iNjQ1LTQ4ZmQtYWIzMC0xYTAxZWU0MWUyMTgifQ.w6p4J_6qQ1HzTG9nrEOrubxIMb9K5hzcMPxc9IxPx2K4xO9l-oFiUw93daH3m5pluP6K7eOE6txBuRVfEcpJSwlelsOsW8gb8VJcnzMS9EnZpeA0tW_p-mnkFc3VcfyXuhe5R3G7aa5d8uHv70yJ9Y3-UhjiN9EhpMdfPAoEB9fYKKkJRzF7utTTIPGrSaSU6d2pcpfYKaxIwePzEkT4DfcQthoZdy9ucNvvLoi1DIC-UocFD8HLs8LYKEqSxQvOcvnThbObJ9af71EwmuE21fO5KzMW20KtAeget1gnldOosPtz1G5EwvaQ401-RPQzPGMVBld0_zMCAwZttJ4knw
</span></span></code></pre></div><p>将产生下面的配置：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>users</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mmosley</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>user</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>auth-provider</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>config</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>client-id</span><span class=p>:</span><span class=w> </span><span class=l>kubernetes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>client-secret</span><span class=p>:</span><span class=w> </span><span class=l>1db158f6-177d-4d9c-8a8b-d36869918ec5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>extra-scopes</span><span class=p>:</span><span class=w> </span><span class=l>groups</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>id-token</span><span class=p>:</span><span class=w> </span><span class=l>eyJraWQiOiJDTj1vaWRjaWRwLnRyZW1vbG8ubGFuLCBPVT1EZW1vLCBPPVRybWVvbG8gU2VjdXJpdHksIEw9QXJsaW5ndG9uLCBTVD1WaXJnaW5pYSwgQz1VUy1DTj1rdWJlLWNhLTEyMDIxNDc5MjEwMzYwNzMyMTUyIiwiYWxnIjoiUlMyNTYifQ.eyJpc3MiOiJodHRwczovL29pZGNpZHAudHJlbW9sby5sYW46ODQ0My9hdXRoL2lkcC9PaWRjSWRQIiwiYXVkIjoia3ViZXJuZXRlcyIsImV4cCI6MTQ4MzU0OTUxMSwianRpIjoiMm96US15TXdFcHV4WDlHZUhQdy1hZyIsImlhdCI6MTQ4MzU0OTQ1MSwibmJmIjoxNDgzNTQ5MzMxLCJzdWIiOiI0YWViMzdiYS1iNjQ1LTQ4ZmQtYWIzMC0xYTAxZWU0MWUyMTgifQ.w6p4J_6qQ1HzTG9nrEOrubxIMb9K5hzcMPxc9IxPx2K4xO9l-oFiUw93daH3m5pluP6K7eOE6txBuRVfEcpJSwlelsOsW8gb8VJcnzMS9EnZpeA0tW_p-mnkFc3VcfyXuhe5R3G7aa5d8uHv70yJ9Y3-UhjiN9EhpMdfPAoEB9fYKKkJRzF7utTTIPGrSaSU6d2pcpfYKaxIwePzEkT4DfcQthoZdy9ucNvvLoi1DIC-UocFD8HLs8LYKEqSxQvOcvnThbObJ9af71EwmuE21fO5KzMW20KtAeget1gnldOosPtz1G5EwvaQ401-RPQzPGMVBld0_zMCAwZttJ4knw</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>idp-certificate-authority</span><span class=p>:</span><span class=w> </span><span class=l>/root/ca.pem</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>idp-issuer-url</span><span class=p>:</span><span class=w> </span><span class=l>https://oidcidp.tremolo.lan:8443/auth/idp/OidcIdP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>refresh-token</span><span class=p>:</span><span class=w> </span><span class=l>q1bKLFOyUiosTfawzA93TzZIDzH2TNa2SMm0zEiPKTUwME6BkEo6Sql5yUWVBSWpKUGphaWpxSVAfekBOZbBhaEW+VlFUeVRGcluyVF5JT4+haZmPsluFoFu5XkpXk5BXq</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>oidc</span><span class=w>
</span></span></span></code></pre></div><p>一旦您的 <code>id_token</code> 过期，<code>kubectl</code> 将使用 <code>refresh_token</code> 刷新 <code>id_token</code>，然后在 <code>kube/.config</code> 文件的<code>client_secret</code> 中存储 <code>id_token</code> 的值和<code>refresh_token</code> 的新值。</p><h5 id=选项-2---使用---token-选项>选项 2 - 使用 <code>--token</code> 选项</h5><p>可以在 <code>kubectl</code> 命令的 <code>--token</code> 选项中传入 token。简单的拷贝和复制 <code>id_token</code> 到该选项中：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl --token<span class=o>=</span>eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJodHRwczovL21sYi50cmVtb2xvLmxhbjo4MDQzL2F1dGgvaWRwL29pZGMiLCJhdWQiOiJrdWJlcm5ldGVzIiwiZXhwIjoxNDc0NTk2NjY5LCJqdGkiOiI2RDUzNXoxUEpFNjJOR3QxaWVyYm9RIiwiaWF0IjoxNDc0NTk2MzY5LCJuYmYiOjE0NzQ1OTYyNDksInN1YiI6Im13aW5kdSIsInVzZXJfcm9sZSI6WyJ1c2VycyIsIm5ldy1uYW1lc3BhY2Utdmlld2VyIl0sImVtYWlsIjoibXdpbmR1QG5vbW9yZWplZGkuY29tIn0.f2As579n9VNoaKzoF-dOQGmXkFKf1FMyNV0-va_B63jn-_n9LGSCca_6IVMP8pO-Zb4KvRqGyTP0r3HkHxYy5c81AnIh8ijarruczl-TK_yF5akjSTHFZD-0gRzlevBDiH8Q79NAr-ky0P4iIXS8lY9Vnjch5MF74Zx0c3alKJHJUnnpjIACByfF2SCaYzbWFMUNat-K1PaUk5-ujMBG7yYnr95xD-63n8CO8teGUAAEMx6zRjzfhnhbzX-ajwZLGwGUBT4WqjMs70-6a7_8gZmLZb2az1cZynkFRj2BaCkVT3A2RrjeEwZEtGXlMqKJ1_I2ulrOVsYx01_yD35-rw get nodes
</span></span></code></pre></div><h3 id=webhook-token-认证>Webhook Token 认证</h3><p>Webhook 认证是用来认证 bearer token 的 hook。</p><ul><li><code>--authentication-token-webhook-config-file</code> 是一个用来描述如何访问远程 webhook 服务的 kubeconfig 文件。</li><li><code>--authentication-token-webhook-cache-ttl</code> 缓存身份验证策略的时间。默认为两分钟。</li></ul><p>配置文件使用 <a href=https://kubernetes.io/docs/concepts/cluster-administration/authenticate-across-clusters-kubeconfig/ target=_blank rel=noopener>kubeconfig</a> 文件格式。文件中的 ”user“ 指的是 API server 的 webhook，”clusters“ 是指远程服务。见下面的例子：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># clusters refers to the remote service.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>clusters</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>name-of-remote-authn-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cluster</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>certificate-authority</span><span class=p>:</span><span class=w> </span><span class=l>/path/to/ca.pem</span><span class=w> </span><span class=c># CA for verifying the remote service.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class=l>https://authn.example.com/authenticate</span><span class=w> </span><span class=c># URL of remote service to query. Must use &#39;https&#39;.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># users refers to the API server&#39;s webhook configuration.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>users</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>name-of-api-server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>user</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>client-certificate</span><span class=p>:</span><span class=w> </span><span class=l>/path/to/cert.pem</span><span class=w> </span><span class=c># cert for the webhook plugin to use</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>client-key</span><span class=p>:</span><span class=w> </span><span class=l>/path/to/key.pem</span><span class=w> </span><span class=c># key matching the cert</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># kubeconfig files require a context. Provide one for the API server.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>current-context</span><span class=p>:</span><span class=w> </span><span class=l>webhook</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>contexts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>context</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=l>name-of-remote-authn-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>user</span><span class=p>:</span><span class=w> </span><span class=l>name-of-api-sever</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>webhook</span><span class=w>
</span></span></span></code></pre></div><p>当客户端尝试使用 bearer token 与 API server 进行认证是，如上论述，认证 webhook 用饱含该 token 的对象查询远程服务。Kubernetes 不会挑战缺少该 header 的请求。</p><p>请注意，webhook API 对象与其他 Kubernetes API 对象具有相同的 <a href=https://kubernetes.io/docs/concepts/overview/kubernetes-api/ target=_blank rel=noopener>版本控制兼容性规则</a>。实现者应该意识到 Beta 对象的宽松兼容性承诺，并检查请求的 “apiVersion” 字段以确保正确的反序列化。此外，API server 必须启用 <code>authentication.k8s.io/v1beta1</code> API 扩展组（<code>--runtime config =authentication.k8s.io/v1beta1=true</code>）。</p><p>The request body will be of the following format:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;apiVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;authentication.k8s.io/v1beta1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=s2>&#34;TokenReview&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;spec&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;token&#34;</span><span class=p>:</span> <span class=s2>&#34;(BEARERTOKEN)&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>预计远程服务将填写请求的 <code>status</code> 字段以指示登录成功。响应主体的 <code>spec</code> 字段被忽略，可以省略。成功验证后的 bearer token 将返回：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;apiVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;authentication.k8s.io/v1beta1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=s2>&#34;TokenReview&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;authenticated&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;user&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;username&#34;</span><span class=p>:</span> <span class=s2>&#34;janedoe@example.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;uid&#34;</span><span class=p>:</span> <span class=s2>&#34;42&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;groups&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;developers&#34;</span><span class=p>,</span> <span class=s2>&#34;qa&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;extra&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;extrafield1&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;extravalue1&#34;</span><span class=p>,</span> <span class=s2>&#34;extravalue2&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>未成功的请求将返回：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;apiVersion&#34;</span><span class=p>:</span> <span class=s2>&#34;authentication.k8s.io/v1beta1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;kind&#34;</span><span class=p>:</span> <span class=s2>&#34;TokenReview&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;authenticated&#34;</span><span class=p>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>HTTP 状态代码可以用来提供额外的错误上下文。</p><h3 id=认证代理>认证代理</h3><p>可以配置 API server 从请求 header 的值中识别用户，例如 <code>X-Remote-User</code>。这样的设计是用来与请求 header 值的验证代理结合使用。</p><ul><li><code>--requestheader-username-headers</code> 必需，大小写敏感。按 header 名称和顺序检查用户标识。包含值的第一个 header 将被作为用户名。</li><li><code>--requestheader-group-headers</code> 1.6 以上版本。可选。大小写敏感。建议为 “X-Remote-Group”。按 header 名称和顺序检查用户组。所有指定的 header 中的所有值都将作为组名。</li><li><code>--requestheader-extra-headers-prefix</code> 1.6 以上版本。可选，大小写敏感。建议为 “X-Remote-Extra-”。标题前缀可用于查找有关用户的额外信息（通常由配置的授权插件使用）。以任何指定的前缀开头的 header 都会删除前缀，header 名称的其余部分将成为额外的键值，而 header 值则是额外的值。</li></ul><p>例如下面的配置：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>--requestheader-username-headers<span class=o>=</span>X-Remote-User
</span></span><span class=line><span class=cl>--requestheader-group-headers<span class=o>=</span>X-Remote-Group
</span></span><span class=line><span class=cl>--requestheader-extra-headers-prefix<span class=o>=</span>X-Remote-Extra-
</span></span></code></pre></div><p>该请求：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>GET</span> <span class=nn>/</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>X-Remote-User</span><span class=o>:</span> <span class=l>fido</span>
</span></span><span class=line><span class=cl><span class=n>X-Remote-Group</span><span class=o>:</span> <span class=l>dogs</span>
</span></span><span class=line><span class=cl><span class=n>X-Remote-Group</span><span class=o>:</span> <span class=l>dachshunds</span>
</span></span><span class=line><span class=cl><span class=n>X-Remote-Extra-Scopes</span><span class=o>:</span> <span class=l>openid</span>
</span></span><span class=line><span class=cl><span class=n>X-Remote-Extra-Scopes</span><span class=o>:</span> <span class=l>profile</span>
</span></span></code></pre></div><p>将产生如下的用户信息：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>fido</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>groups</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>dogs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>dachshunds</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extra</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>scopes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>openid</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>profile</span><span class=w>
</span></span></span></code></pre></div><p>为了防止 header 欺骗，验证代理需要在验证请求 header 之前向 API server 提供有效的客户端证书，以对照指定的 CA 进行验证。</p><ul><li><code>--requestheader-client-ca-file</code> 必需。PEM 编码的证书包。在检查用户名的请求 header 之前，必须针对指定文件中的证书颁发机构提交并验证有效的客户端证书。</li><li><code>--requestheader-allowed-names</code> 可选。Common Name （cn）列表。如果设置了，则在检查用户名的请求 header 之前， 必须提供指定列表中 Common Name（cn）的有效客户端证书。如果为空，则允许使用任何 Common Name。</li></ul><h3 id=keystone-密码>Keystone 密码</h3><p>通过在启动过程中将 <code>--experimental-keystone-url=&lt;AuthURL></code> 选项传递给 API server 来启用 Keystone 认证。该插件在 <code>plugin/pkg/auth/authenticator/password/keystone/keystone.go</code> 中实现，目前使用基本身份验证通过用户名和密码验证用户。</p><p>如果您为 Keystone 服务器配置了自签名证书，则在启动 Kubernetes API server 时可能需要设置 <code>--experimental-keystone-ca-file=SOMEFILE</code> 选项。如果您设置了该选项，Keystone 服务器的证书将由<code>experimental-keystone-ca-file</code> 中的某个权威机构验证。否则，证书由主机的根证书颁发机构验证。</p><p>有关如何使用 keystone 来管理项目和用户的详细信息，请参阅 <a href=http://docs.openstack.org/developer/keystone/ target=_blank rel=noopener>Keystone 文档</a>。请注意，这个插件仍处于试验阶段，正在积极开发之中，并可能在后续版本中进行更改。</p><p>请参考 <a href=https://github.com/kubernetes/kubernetes/pull/11798#issuecomment-129655212 target=_blank rel=noopener>讨论</a>、<a href=https://github.com/kubernetes/kubernetes/issues/11626 target=_blank rel=noopener>蓝图</a> 和 <a href=https://github.com/kubernetes/kubernetes/pull/25536 target=_blank rel=noopener>提出的改变</a> 获取更多信息。</p><h2 id=匿名请求>匿名请求</h2><p>启用时，未被其他已配置身份验证方法拒绝的请求将被视为匿名请求，并给予 <code>system:anonymous</code> 的用户名和<code> system:unuthenticated</code> 的组名。</p><p>例如，在配置了令牌认证和启用了匿名访问的服务器上，提供无效的 bearer token 的请求将收到 <code>401 Unauthorized</code> 错误。提供 bearer token 的请求将被视为匿名请求。</p><p>在 1.5.1 - 1.5.x 版本中，默认情况下命名访问是被禁用的，可以通过传递 <code>--anonymous-auth=false</code> 选项给 API server 来启用。</p><p>在 1.6+ 版本中，如果使用 <code>AlwaysAllow</code> 以外的授权模式，则默认启用匿名访问，并且可以通过将 <code>--anonymous-auth=false</code>选项传递给 API 服务器来禁用。从 1.6 开始，ABAC 和 RBAC 授权人需要明确授权 <code>system:annoymous</code> 或 <code>system:unauthenticated</code> 组，因此授予对 <code>*</code> 用户或 <code>*</code> 组访问权的传统策略规则不包括匿名用户。</p><h2 id=用户模拟>用户模拟</h2><p>用户可以通过模拟 header 充当另一个用户。该请求会覆盖请求认证的用户信息。例如，管理员可以使用此功能通过暂时模拟其他用户并查看请求是否被拒绝来调试授权策略。</p><p>模拟请求首先认证为请求用户，然后切换到模拟的用户信息。</p><ul><li>用户使用他们的凭证<em>和</em>模拟 header 进行 API 调用。</li><li>API server 认证用户</li><li>API server 确保经过身份验证的用户具有模拟权限。</li><li>请求用户的信息被替换为模拟值</li><li>请求被评估，授权作用于模拟的用户信息。</li></ul><p>以下 HTTP header 可用户执行模拟请求：</p><ul><li><code>Impersonate-User</code>：充当的用户名</li><li><code>Impersonate-Group</code>：作为组名。可以多次使用来设置多个组。可选的，需要 “Impersonate-User”</li><li><code>Impersonate-Extra-( extra name )</code>：用于将额外字段与用户关联的动态 header。可选。需要 “Impersonate-User”</li></ul><p>一组示例 header：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>Impersonate-User: jane.doe@example.com
</span></span></span><span class=line><span class=cl><span class=err>Impersonate-Group: developers
</span></span></span><span class=line><span class=cl><span class=err>Impersonate-Group: admins
</span></span></span><span class=line><span class=cl><span class=err>Impersonate-Extra-dn: cn=jane,ou=engineers,dc=example,dc=com
</span></span></span><span class=line><span class=cl><span class=err>Impersonate-Extra-scopes: view
</span></span></span><span class=line><span class=cl><span class=err>Impersonate-Extra-scopes: development
</span></span></span></code></pre></div><p>当使用 <code>kubectl</code> 的 <code>--as</code> 标志来配置 <code>Impersonate-User</code> header 时，可以使用 <code>--as-group</code> 标志来配置 <code>Impersonate-Group</code> header。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl drain mynode
</span></span><span class=line><span class=cl>Error from server <span class=o>(</span>Forbidden<span class=o>)</span>: User <span class=s2>&#34;clark&#34;</span> cannot get nodes at the cluster scope. <span class=o>(</span>get nodes mynode<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ kubectl drain mynode --as<span class=o>=</span>superman --as-group<span class=o>=</span>system:masters
</span></span><span class=line><span class=cl>node <span class=s2>&#34;mynode&#34;</span> cordoned
</span></span><span class=line><span class=cl>node <span class=s2>&#34;mynode&#34;</span> draine
</span></span></code></pre></div><p>为模仿用户、组或设置额外字段，模拟用户必须能够对正在模拟的属性的种类（“用户”，“组”等）执行“模拟”动词。对于启用了 RBAC 授权插件的集群，以下 ClusterRole 包含设置用户和组模拟 header 所需的规则：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRole</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>impersonator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;users&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;groups&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;serviceaccounts&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;impersonate&#34;</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></div><p>额外的字段被评估为资源 “userextras” 的子资源。为了允许用户使用额外字段 “scope” 的模拟 header，应授予用户以下角色：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRole</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>scopes-impersonator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Can set &#34;Impersonate-Extra-scopes&#34; header.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;authentication.k8s.io&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;userextras/scopes&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;impersonate&#34;</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></div><p>模拟 header 的可用值可以通过设置 <code>resourceNames</code> 可以使用的资源来限制。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRole</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>limited-impersonator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Can impersonate the user &#34;jane.doe@example.com&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;users&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;impersonate&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resourceNames</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;jane.doe@example.com&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Can impersonate the groups &#34;developers&#34; and &#34;admins&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;groups&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;impersonate&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resourceNames</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;developers&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;admins&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Can impersonate the extras field &#34;scopes&#34; with the values &#34;view&#34; and &#34;development&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;authentication.k8s.io&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;userextras/scopes&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;impersonate&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>resourceNames</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;view&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;development&#34;</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></div><h2 id=附录>附录</h2><h3 id=创建证书>创建证书</h3><p>使用客户端证书进行身份验证时，可以使用现有的部署脚本或通过 <code>easyrsa</code> 或 <code>openssl</code> 手动生成证书。</p><h4 id=使用已有的部署脚本>使用已有的部署脚本</h4><p><strong>已有的部署脚本</strong> 在 <code>cluster/saltbase/salt/generate-cert/make-ca-cert.sh</code>。</p><p>执行该脚本时需要传递两个参数。第一个参数是 API server 的 IP 地址。第二个参数是 IP 形式的主题备用名称列表： <code>IP:&lt;ip-address></code> 或 <code>DNS:&lt;dns-name></code>。</p><p>该脚本将生成三个文件： <code>ca.crt</code>、<code>server.crt</code> 和 <code>server.key</code>。</p><p>最后，将一下参数添加到 API server 的启动参数中：</p><ul><li><code>--client-ca-file=/srv/kubernetes/ca.crt</code></li><li><code>--tls-cert-file=/srv/kubernetes/server.crt</code></li><li><code>--tls-private-key-file=/srv/kubernetes/server.key</code></li></ul><h4 id=easyrsa>easyrsa</h4><p><strong>easyrsa</strong> 可以用来手动为集群生成证书。</p><ol><li><p>下载，解压，并初始化修补版本的 easyrsa3。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -L -O https://storage.googleapis.com/kubernetes-release/easy-rsa/easy-rsa.tar.gz
</span></span><span class=line><span class=cl>tar xzf easy-rsa.tar.gz
</span></span><span class=line><span class=cl><span class=nb>cd</span> easy-rsa-master/easyrsa3
</span></span><span class=line><span class=cl>./easyrsa init-pki
</span></span></code></pre></div></li><li><p>生成 CA（使用 <code>--batch</code> 设置为自动模式。使用 <code>--req-cn</code> 设置默认的 CN）</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./easyrsa --batch <span class=s2>&#34;--req-cn=</span><span class=si>${</span><span class=nv>MASTER_IP</span><span class=si>}</span><span class=s2>@`date +%s`&#34;</span> build-ca nopass
</span></span></code></pre></div></li><li><p>生成服务器证书和密钥。（build-server-full [文件名]：生成一个键值对，在本地为客户端和服务器签名。）</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./easyrsa --subject-alt-name<span class=o>=</span><span class=s2>&#34;IP:</span><span class=si>${</span><span class=nv>MASTER_IP</span><span class=si>}</span><span class=s2>&#34;</span> build-server-full server nopass
</span></span></code></pre></div></li><li><p>复制 <code>pki/ca.crt</code>, <code>pki/issued/server.crt</code> 和 <code>pki/private/server.key</code> 到您的目录下。</p></li><li><p>将以下参数添加到 API server 的启动参数中：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>--client-ca-file<span class=o>=</span>/yourdirectory/ca.crt
</span></span><span class=line><span class=cl>--tls-cert-file<span class=o>=</span>/yourdirectory/server.crt
</span></span><span class=line><span class=cl>--tls-private-key-file<span class=o>=</span>/yourdirectory/server.key
</span></span></code></pre></div></li></ol><h4 id=openssl>openssl</h4><p><strong>openssl</strong> 可以用来手动为集群生成证书。</p><ol><li><p>生成一个 2048 bit 的 ca.key：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>openssl genrsa -out ca.key <span class=m>2048</span>
</span></span></code></pre></div></li><li><p>根据 ca.key 生成一个 ca.crt（使用 -days 设置证书的有效时间）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>openssl req -x509 -new -nodes -key ca.key -subj <span class=s2>&#34;/CN=</span><span class=si>${</span><span class=nv>MASTER_IP</span><span class=si>}</span><span class=s2>&#34;</span> -days <span class=m>10000</span> -out ca.crt
</span></span></code></pre></div></li><li><p>生成一个 2048 bit 的 server.key：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>openssl genrsa -out server.key <span class=m>2048</span>
</span></span></code></pre></div></li><li><p>根据 server.key 生成一个 server.csr：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>openssl req -new -key server.key -subj <span class=s2>&#34;/CN=</span><span class=si>${</span><span class=nv>MASTER_IP</span><span class=si>}</span><span class=s2>&#34;</span> -out server.csr
</span></span></code></pre></div></li><li><p>根据 ca.key、ca.crt 和 server.csr 生成 server.crt：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>openssl x509 -req -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt -days <span class=m>10000</span>
</span></span></code></pre></div></li><li><p>查看证书：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>openssl x509  -noout -text -in ./server.crt
</span></span></code></pre></div></li></ol><p>最后，不要忘了向 API server 的启动参数中增加配置。</p><h4 id=认证-api>认证 API</h4><p>您可以使用 <code>certificates.k8s.io</code> API 将 x509 证书配置为用于身份验证，如 <a href=https://kubernetes.io/docs/tasks/tls/managing-tls-in-a-cluster target=_blank rel=noopener>此处</a> 所述。</p><h2 id=参考>参考</h2><ul><li><a href=https://kubernetes.io/docs/reference/access-authn-authz/authentication/ target=_blank rel=noopener>Authenticating - kubernetes.io</a></li></ul></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>上一页</div><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/13.%E9%9B%86%E7%BE%A4%E5%AE%89%E5%85%A8%E6%80%A7%E7%AE%A1%E7%90%86/auth-with-kubeconfig-or-token/ rel=next>auth-with-kubeconfig-or-token</a></div><div class="col-6 post-nav-item"><div class=meta-nav>下一页</div><a href=/books/k8s-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/2020-jimmysong-kubernetes-%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/13.%E9%9B%86%E7%BE%A4%E5%AE%89%E5%85%A8%E6%80%A7%E7%AE%A1%E7%90%86/ip-masq-agent/ rel=prev>ip-masq-agent</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div><script type=text/javascript id=clstr_globe async src="//clustrmaps.com/globe.js?d=kgpJG5sWZQpKujBmD-uW1B54-WBPol-DuDtrB2KFjKs"></script></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>