<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="附录:理解 equals 和 hashCode 方法 假设有一个容器使用 hash 函数，当你创建一个放到这个容器时，你必须定义 hashCode() 函数和 equals() 函数。这两个函数一起被用于 hash 容器中的查询操作。 equals 规范 当你创建一个类的时候，它自动继承自 Objcet 类。如果你不覆写 equals()"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-understanding-equals-and-hashcode/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.63df6ae9fc2b4cc71b83f1774d780209.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-understanding-equals-and-hashcode/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-understanding-equals-and-hashcode/"><meta property="og:title" content="Appendix-Understanding-equals-and-hashCode | Next-gen Tech Edu"><meta property="og:description" content="附录:理解 equals 和 hashCode 方法 假设有一个容器使用 hash 函数，当你创建一个放到这个容器时，你必须定义 hashCode() 函数和 equals() 函数。这两个函数一起被用于 hash 容器中的查询操作。 equals 规范 当你创建一个类的时候，它自动继承自 Objcet 类。如果你不覆写 equals()"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>Appendix-Understanding-equals-and-hashCode | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=1e0d2d2a80d723602baebd2f7483add6><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">On Java 8</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idb9e60239e3d748bf31eb7c5de38f5561")' href=#idb9e60239e3d748bf31eb7c5de38f5561 aria-expanded=false aria-controls=idb9e60239e3d748bf31eb7c5de38f5561 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/>99.参考资料</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idb9e60239e3d748bf31eb7c5de38f5561 aria-expanded=false aria-controls=idb9e60239e3d748bf31eb7c5de38f5561><i class="fa-solid fa-angle-down" id=caret-idb9e60239e3d748bf31eb7c5de38f5561></i></a></div><ul class="nav docs-sidenav collapse show" id=idb9e60239e3d748bf31eb7c5de38f5561><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idd95d813603af3028b9bceaec8ff661e1")' href=#idd95d813603af3028b9bceaec8ff661e1 aria-expanded=false aria-controls=idd95d813603af3028b9bceaec8ff661e1 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/>On Java 8</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idd95d813603af3028b9bceaec8ff661e1 aria-expanded=false aria-controls=idd95d813603af3028b9bceaec8ff661e1><i class="fa-solid fa-angle-down" id=caret-idd95d813603af3028b9bceaec8ff661e1></i></a></div><ul class="nav docs-sidenav collapse show" id=idd95d813603af3028b9bceaec8ff661e1><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/00-introduction/>00-Introduction</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/01-what-is-an-object/>01-What-is-an-Object</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/02-installing-java-and-the-book-examples/>02-Installing-Java-and-the-Book-Examples</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/03-objects-everywhere/>03-Objects-Everywhere</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/04-operators/>04-Operators</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/05-control-flow/>05-Control-Flow</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/06-housekeeping/>06-Housekeeping</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/07-implementation-hiding/>07-Implementation-Hiding</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/08-reuse/>08-Reuse</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/09-polymorphism/>09-Polymorphism</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/10-interfaces/>10-Interfaces</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/11-inner-classes/>11-Inner-Classes</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/12-collections/>12-Collections</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/13-functional-programming/>13-Functional-Programming</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/14-streams/>14-Streams</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/15-exceptions/>15-Exceptions</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/16-validating-your-code/>16-Validating-Your-Code</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/17-files/>17-Files</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/18-strings/>18-Strings</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/19-type-information/>19-Type-Information</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/20-generics/>20-Generics</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/21-arrays/>21-Arrays</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/22-enumerations/>22-Enumerations</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/23-annotations/>23-Annotations</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/24-concurrent-programming/>24-Concurrent-Programming</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/25-patterns/>25-Patterns</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-becoming-a-programmer/>Appendix-Becoming-a-Programmer</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-benefits-and-costs-of-static-type-checking/>Appendix-Benefits-and-Costs-of-Static-Type-Checking</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-collection-topics/>Appendix-Collection-Topics</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-data-compression/>Appendix-Data-Compression</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-io-streams/>Appendix-IO-Streams</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-javadoc/>Appendix-Javadoc</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-low-level-concurrency/>Appendix-Low-Level-Concurrency</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-new-io/>Appendix-New-IO</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-object-serialization/>Appendix-Object-Serialization</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-passing-and-returning-objects/>Appendix-Passing-and-Returning-Objects</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-programming-guidelines/>Appendix-Programming-Guidelines</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-standard-io/>Appendix-Standard-IO</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-supplements/>Appendix-Supplements</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-the-positive-legacy-of-c-plus-plus-and-java/>Appendix-The-Positive-Legacy-of-C-plus-plus-and-Java</a></li><li class="child level active"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-understanding-equals-and-hashcode/>Appendix-Understanding-equals-and-hashCode</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/glossary/>GLOSSARY</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id775c4a5ac3467743f5bb8deee7e9fdbf")' href=#id775c4a5ac3467743f5bb8deee7e9fdbf aria-expanded=false aria-controls=id775c4a5ac3467743f5bb8deee7e9fdbf aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/>Think in Java</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id775c4a5ac3467743f5bb8deee7e9fdbf aria-expanded=false aria-controls=id775c4a5ac3467743f5bb8deee7e9fdbf><i class="fa-solid fa-angle-right" id=caret-id775c4a5ac3467743f5bb8deee7e9fdbf></i></a></div><ul class="nav docs-sidenav collapse" id=id775c4a5ac3467743f5bb8deee7e9fdbf><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id2b44115f2aa79bbc0f20c93f548e1b6a")' href=#id2b44115f2aa79bbc0f20c93f548e1b6a aria-expanded=false aria-controls=id2b44115f2aa79bbc0f20c93f548e1b6a aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/>1.对象入门</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id2b44115f2aa79bbc0f20c93f548e1b6a aria-expanded=false aria-controls=id2b44115f2aa79bbc0f20c93f548e1b6a><i class="fa-solid fa-angle-right" id=caret-id2b44115f2aa79bbc0f20c93f548e1b6a></i></a></div><ul class="nav docs-sidenav collapse" id=id2b44115f2aa79bbc0f20c93f548e1b6a><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.1-%E6%8A%BD%E8%B1%A1%E7%9A%84%E8%BF%9B%E6%AD%A5/>1.1 抽象的进步</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.10-%E6%B0%B8%E4%B9%85%E6%80%A7/>1.10 永久性</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.11-java%E5%92%8C%E5%9B%A0%E7%89%B9%E7%BD%91/>1.11 Java和因特网</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.12-%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1/>1.12 分析和设计</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.13-java%E8%BF%98%E6%98%AFc++/>1.13 Java还是C++</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.2-%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%8E%A5%E5%8F%A3/>1.2 对象的接口</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.3-%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88%E7%9A%84%E9%9A%90%E8%97%8F/>1.3 实现方案的隐藏</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.4-%E6%96%B9%E6%A1%88%E7%9A%84%E9%87%8D%E5%A4%8D%E4%BD%BF%E7%94%A8/>1.4 方案的重复使用</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.5-%E7%BB%A7%E6%89%BF%E9%87%8D%E6%96%B0%E4%BD%BF%E7%94%A8%E6%8E%A5%E5%8F%A3/>1.5 继承：重新使用接口</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.6-%E5%A4%9A%E6%80%81%E5%AF%B9%E8%B1%A1%E7%9A%84%E4%BA%92%E6%8D%A2%E4%BD%BF%E7%94%A8/>1.6 多态对象的互换使用</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.7-%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E5%AD%98%E5%9C%A8%E6%97%B6%E9%97%B4/>1.7 对象的创建和存在时间</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/1.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.9-%E5%A4%9A%E7%BA%BF%E7%A8%8B/>1.9 多线程</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idcac6e18458602ce17bd9b0b2c3e18daa")' href=#idcac6e18458602ce17bd9b0b2c3e18daa aria-expanded=false aria-controls=idcac6e18458602ce17bd9b0b2c3e18daa aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/>10.Java IO 系统</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idcac6e18458602ce17bd9b0b2c3e18daa aria-expanded=false aria-controls=idcac6e18458602ce17bd9b0b2c3e18daa><i class="fa-solid fa-angle-right" id=caret-idcac6e18458602ce17bd9b0b2c3e18daa></i></a></div><ul class="nav docs-sidenav collapse" id=idcac6e18458602ce17bd9b0b2c3e18daa><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.1-%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA/>10.1 输入和输出</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.10-%E6%80%BB%E7%BB%93/>10.10 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.11-%E7%BB%83%E4%B9%A0/>10.11 练习</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.2-%E5%A2%9E%E6%B7%BB%E5%B1%9E%E6%80%A7%E5%92%8C%E6%9C%89%E7%94%A8%E7%9A%84%E6%8E%A5%E5%8F%A3/>10.2 增添属性和有用的接口</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.3-%E6%9C%AC%E8%BA%AB%E7%9A%84%E7%BC%BA%E9%99%B7randomaccessfile/>10.3 本身的缺陷：RandomAccessFile</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.4-file%E7%B1%BB/>10.4 File类</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.5-io%E6%B5%81%E7%9A%84%E5%85%B8%E5%9E%8B%E5%BA%94%E7%94%A8/>10.5 IO流的典型应用</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.6-streamtokenizer/>10.6 StreamTokenizer</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.7-java-1.1%E7%9A%84io%E6%B5%81/>10.7 Java 1.1的IO流</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.8-%E5%8E%8B%E7%BC%A9/>10.8 压缩</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.9-%E5%AF%B9%E8%B1%A1%E5%BA%8F%E5%88%97%E5%8C%96/>10.9 对象序列化</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idfe15c0b7d69e1eea4a39a92683a168d4")' href=#idfe15c0b7d69e1eea4a39a92683a168d4 aria-expanded=false aria-controls=idfe15c0b7d69e1eea4a39a92683a168d4 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/>11.运行期类型鉴定</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idfe15c0b7d69e1eea4a39a92683a168d4 aria-expanded=false aria-controls=idfe15c0b7d69e1eea4a39a92683a168d4><i class="fa-solid fa-angle-right" id=caret-idfe15c0b7d69e1eea4a39a92683a168d4></i></a></div><ul class="nav docs-sidenav collapse" id=idfe15c0b7d69e1eea4a39a92683a168d4><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/11.1-%E5%AF%B9rtti%E7%9A%84%E9%9C%80%E8%A6%81/>11.1 对RTTI的需要</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/11.2-rtti-%E8%AF%AD%E6%B3%95/>11.2 RTTI 语法</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/11.3-%E5%8F%8D%E5%B0%84%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E4%BF%A1%E6%81%AF/>11.3 反射：运行期类信息</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/11.4-%E6%80%BB%E7%BB%93/>11.4 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/11.5-%E7%BB%83%E4%B9%A0/>11.5 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-iddf7cc690622f50701352bac88f5de264")' href=#iddf7cc690622f50701352bac88f5de264 aria-expanded=false aria-controls=iddf7cc690622f50701352bac88f5de264 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/>12.传递和返回对象</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#iddf7cc690622f50701352bac88f5de264 aria-expanded=false aria-controls=iddf7cc690622f50701352bac88f5de264><i class="fa-solid fa-angle-right" id=caret-iddf7cc690622f50701352bac88f5de264></i></a></div><ul class="nav docs-sidenav collapse" id=iddf7cc690622f50701352bac88f5de264><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.1-%E4%BC%A0%E9%80%92%E6%8C%87%E9%92%88/>12.1 传递指针</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.2-%E5%88%B6%E4%BD%9C%E6%9C%AC%E5%9C%B0%E5%89%AF%E6%9C%AC/>12.2 制作本地副本</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.3-%E5%85%8B%E9%9A%86%E7%9A%84%E6%8E%A7%E5%88%B6/>12.3 克隆的控制</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.4-%E5%8F%AA%E8%AF%BB%E7%B1%BB/>12.4 只读类</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.5-%E6%80%BB%E7%BB%93/>12.5 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.6-%E7%BB%83%E4%B9%A0/>12.6 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idb1a9edc38a9b424eca8c6736e315c5f2")' href=#idb1a9edc38a9b424eca8c6736e315c5f2 aria-expanded=false aria-controls=idb1a9edc38a9b424eca8c6736e315c5f2 aria-hidden=false data-toggle=collapse></div></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id80c764609525f094184dd5b161c7244d")' href=#id80c764609525f094184dd5b161c7244d aria-expanded=false aria-controls=id80c764609525f094184dd5b161c7244d aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/>14.多线程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id80c764609525f094184dd5b161c7244d aria-expanded=false aria-controls=id80c764609525f094184dd5b161c7244d><i class="fa-solid fa-angle-right" id=caret-id80c764609525f094184dd5b161c7244d></i></a></div><ul class="nav docs-sidenav collapse" id=id80c764609525f094184dd5b161c7244d><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.1-%E5%8F%8D%E5%BA%94%E7%81%B5%E6%95%8F%E7%9A%84%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2/>14.1 反应灵敏的用户界面</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.2-%E5%85%B1%E4%BA%AB%E6%9C%89%E9%99%90%E7%9A%84%E8%B5%84%E6%BA%90/>14.2 共享有限的资源</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.3-%E5%A0%B5%E5%A1%9E/>14.3 堵塞</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.4-%E4%BC%98%E5%85%88%E7%BA%A7/>14.4 优先级</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.5-%E5%9B%9E%E9%A1%BErunnable/>14.5 回顾runnable</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.6-%E6%80%BB%E7%BB%93/>14.6 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.7-%E7%BB%83%E4%B9%A0/>14.7 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id72c1a5699f783ea8a67f0eb1d1d396e1")' href=#id72c1a5699f783ea8a67f0eb1d1d396e1 aria-expanded=false aria-controls=id72c1a5699f783ea8a67f0eb1d1d396e1 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/>15.网络编程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id72c1a5699f783ea8a67f0eb1d1d396e1 aria-expanded=false aria-controls=id72c1a5699f783ea8a67f0eb1d1d396e1><i class="fa-solid fa-angle-right" id=caret-id72c1a5699f783ea8a67f0eb1d1d396e1></i></a></div><ul class="nav docs-sidenav collapse" id=id72c1a5699f783ea8a67f0eb1d1d396e1><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.1-%E6%9C%BA%E5%99%A8%E7%9A%84%E6%A0%87%E8%AF%86/>15.1 机器的标识</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.10-%E7%BB%83%E4%B9%A0/>15.10 练习</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.2-%E5%A5%97%E6%8E%A5%E5%AD%97/>15.2 套接字</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.3-%E6%9C%8D%E5%8A%A1%E5%A4%9A%E4%B8%AA%E5%AE%A2%E6%88%B7/>15.3 服务多个客户</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.4-%E6%95%B0%E6%8D%AE%E6%8A%A5/>15.4 数据报</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.5-%E4%B8%80%E4%B8%AAweb%E5%BA%94%E7%94%A8/>15.5 一个Web应用</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.6-java%E4%B8%8Ecgi%E7%9A%84%E6%B2%9F%E9%80%9A/>15.6 Java与CGI的沟通</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.7-%E7%94%A8jdbc%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93/>15.7 用JDBC连接数据库</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.8-%E8%BF%9C%E7%A8%8B%E6%96%B9%E6%B3%95/>15.8 远程方法</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.9-%E6%80%BB%E7%BB%93/>15.9 总结</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idbee59bdc5aaf46677af95b12ea99ff64")' href=#idbee59bdc5aaf46677af95b12ea99ff64 aria-expanded=false aria-controls=idbee59bdc5aaf46677af95b12ea99ff64 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/>16.设计范式</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idbee59bdc5aaf46677af95b12ea99ff64 aria-expanded=false aria-controls=idbee59bdc5aaf46677af95b12ea99ff64><i class="fa-solid fa-angle-right" id=caret-idbee59bdc5aaf46677af95b12ea99ff64></i></a></div><ul class="nav docs-sidenav collapse" id=idbee59bdc5aaf46677af95b12ea99ff64><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.1-%E8%8C%83%E5%BC%8F%E7%9A%84%E6%A6%82%E5%BF%B5/>16.1 范式的概念</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.10-%E7%BB%83%E4%B9%A0/>16.10 练习</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.2-%E8%A7%82%E5%AF%9F%E5%99%A8%E8%8C%83%E5%BC%8F/>16.2 观察器范式</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.3-%E6%A8%A1%E6%8B%9F%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AB%99/>16.3 模拟垃圾回收站</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.4-%E6%94%B9%E8%BF%9B%E8%AE%BE%E8%AE%A1/>16.4 改进设计</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.5-%E6%8A%BD%E8%B1%A1%E7%9A%84%E5%BA%94%E7%94%A8/>16.5 抽象的应用</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.6-%E5%A4%9A%E9%87%8D%E6%B4%BE%E9%81%A3/>16.6 多重派遣</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.7-%E8%AE%BF%E9%97%AE%E5%99%A8%E8%8C%83%E5%BC%8F/>16.7 访问器范式</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.8-rtti%E7%9C%9F%E7%9A%84%E6%9C%89%E5%AE%B3%E5%90%97/>16.8 RTTI真的有害吗</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.9-%E6%80%BB%E7%BB%93/>16.9 总结</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ida6b4113de6e02470653070d2ebd17b83")' href=#ida6b4113de6e02470653070d2ebd17b83 aria-expanded=false aria-controls=ida6b4113de6e02470653070d2ebd17b83 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/>17.项目</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ida6b4113de6e02470653070d2ebd17b83 aria-expanded=false aria-controls=ida6b4113de6e02470653070d2ebd17b83><i class="fa-solid fa-angle-right" id=caret-ida6b4113de6e02470653070d2ebd17b83></i></a></div><ul class="nav docs-sidenav collapse" id=ida6b4113de6e02470653070d2ebd17b83><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/17.1-%E6%96%87%E5%AD%97%E5%A4%84%E7%90%86/>17.1 文字处理</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/17.2-%E6%96%B9%E6%B3%95%E6%9F%A5%E6%89%BE%E5%B7%A5%E5%85%B7/>17.2 方法查找工具</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/17.3-%E5%A4%8D%E6%9D%82%E6%80%A7%E7%90%86%E8%AE%BA/>17.3 复杂性理论</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/17.4-%E6%80%BB%E7%BB%93/>17.4 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/17.5-%E7%BB%83%E4%B9%A0/>17.5 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id7eddf7632d476449e059010f2022c9e0")' href=#id7eddf7632d476449e059010f2022c9e0 aria-expanded=false aria-controls=id7eddf7632d476449e059010f2022c9e0 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/>2.一切都是对象</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id7eddf7632d476449e059010f2022c9e0 aria-expanded=false aria-controls=id7eddf7632d476449e059010f2022c9e0><i class="fa-solid fa-angle-right" id=caret-id7eddf7632d476449e059010f2022c9e0></i></a></div><ul class="nav docs-sidenav collapse" id=id7eddf7632d476449e059010f2022c9e0><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.1-%E7%94%A8%E6%8C%87%E9%92%88%E6%93%8D%E7%BA%B5%E5%AF%B9%E8%B1%A1/>2.1 用指针操纵对象</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.10-%E6%80%BB%E7%BB%93/>2.10 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.11-%E7%BB%83%E4%B9%A0/>2.11 练习</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.2-%E6%89%80%E6%9C%89%E5%AF%B9%E8%B1%A1%E9%83%BD%E5%BF%85%E9%A1%BB%E5%88%9B%E5%BB%BA/>2.2 所有对象都必须创建</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.3-%E7%BB%9D%E5%AF%B9%E4%B8%8D%E8%A6%81%E6%B8%85%E9%99%A4%E5%AF%B9%E8%B1%A1/>2.3 绝对不要清除对象</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.4-%E6%96%B0%E5%BB%BA%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%B1%BB/>2.4 新建数据类型：类</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.5-%E6%96%B9%E6%B3%95%E8%87%AA%E5%8F%98%E9%87%8F%E5%92%8C%E8%BF%94%E5%9B%9E%E5%80%BC/>2.5 方法、自变量和返回值</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.6-%E6%9E%84%E5%BB%BAjava%E7%A8%8B%E5%BA%8F/>2.6 构建Java程序</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.7-%E6%88%91%E4%BB%AC%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AAjava%E7%A8%8B%E5%BA%8F/>2.7 我们的第一个Java程序</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.8-%E6%B3%A8%E9%87%8A%E5%92%8C%E5%B5%8C%E5%85%A5%E6%96%87%E6%A1%A3/>2.8 注释和嵌入文档</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/2.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.9-%E7%BC%96%E7%A0%81%E6%A0%B7%E5%BC%8F/>2.9 编码样式</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idcdaeeaa8c89d4672f982b270803f52c5")' href=#idcdaeeaa8c89d4672f982b270803f52c5 aria-expanded=false aria-controls=idcdaeeaa8c89d4672f982b270803f52c5 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/3.%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/>3.控制程序流程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idcdaeeaa8c89d4672f982b270803f52c5 aria-expanded=false aria-controls=idcdaeeaa8c89d4672f982b270803f52c5><i class="fa-solid fa-angle-right" id=caret-idcdaeeaa8c89d4672f982b270803f52c5></i></a></div><ul class="nav docs-sidenav collapse" id=idcdaeeaa8c89d4672f982b270803f52c5><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/3.%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/3.1-%E4%BD%BF%E7%94%A8java%E8%BF%90%E7%AE%97%E7%AC%A6/>3.1 使用Java运算符</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/3.%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/3.2-%E6%89%A7%E8%A1%8C%E6%8E%A7%E5%88%B6/>3.2 执行控制</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/3.%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/3.3-%E6%80%BB%E7%BB%93/>3.3 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/3.%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/3.4-%E7%BB%83%E4%B9%A0/>3.4 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id88269c6bb72139bcdc3f10b0e1c5b240")' href=#id88269c6bb72139bcdc3f10b0e1c5b240 aria-expanded=false aria-controls=id88269c6bb72139bcdc3f10b0e1c5b240 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/>4.初始化和清除</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id88269c6bb72139bcdc3f10b0e1c5b240 aria-expanded=false aria-controls=id88269c6bb72139bcdc3f10b0e1c5b240><i class="fa-solid fa-angle-right" id=caret-id88269c6bb72139bcdc3f10b0e1c5b240></i></a></div><ul class="nav docs-sidenav collapse" id=id88269c6bb72139bcdc3f10b0e1c5b240><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.1-%E7%94%A8%E6%9E%84%E9%80%A0%E5%99%A8%E8%87%AA%E5%8A%A8%E5%88%9D%E5%A7%8B%E5%8C%96/>4.1 用构造器自动初始化</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.2-%E6%96%B9%E6%B3%95%E9%87%8D%E8%BD%BD/>4.2 方法重载</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.3-%E6%B8%85%E9%99%A4%E6%94%B6%E5%B0%BE%E5%92%8C%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/>4.3 清除：收尾和垃圾收集</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.4-%E6%88%90%E5%91%98%E5%88%9D%E5%A7%8B%E5%8C%96/>4.4 成员初始化</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.5-%E6%95%B0%E7%BB%84%E5%88%9D%E5%A7%8B%E5%8C%96/>4.5 数组初始化</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.6-%E6%80%BB%E7%BB%93/>4.6 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/4.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.7-%E7%BB%83%E4%B9%A0/>4.7 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id5374d7d4da5f7fa0f2bd293ebab854c7")' href=#id5374d7d4da5f7fa0f2bd293ebab854c7 aria-expanded=false aria-controls=id5374d7d4da5f7fa0f2bd293ebab854c7 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/5.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/>5.隐藏实施过程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id5374d7d4da5f7fa0f2bd293ebab854c7 aria-expanded=false aria-controls=id5374d7d4da5f7fa0f2bd293ebab854c7><i class="fa-solid fa-angle-right" id=caret-id5374d7d4da5f7fa0f2bd293ebab854c7></i></a></div><ul class="nav docs-sidenav collapse" id=id5374d7d4da5f7fa0f2bd293ebab854c7><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/5.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.1-%E5%8C%85%E5%BA%93%E5%8D%95%E5%85%83/>5.1 包：库单元</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/5.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.2-java%E8%AE%BF%E9%97%AE%E6%8C%87%E7%A4%BA%E7%AC%A6/>5.2 Java访问指示符</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/5.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.3-%E6%8E%A5%E5%8F%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/>5.3 接口与实现</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/5.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.4-%E7%B1%BB%E8%AE%BF%E9%97%AE/>5.4 类访问</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/5.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.5-%E6%80%BB%E7%BB%93/>5.5 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/5.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.6-%E7%BB%83%E4%B9%A0/>5.6 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idcb8ede52c0ccd6a66f6b59e5d738fd67")' href=#idcb8ede52c0ccd6a66f6b59e5d738fd67 aria-expanded=false aria-controls=idcb8ede52c0ccd6a66f6b59e5d738fd67 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/>6.类再生</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idcb8ede52c0ccd6a66f6b59e5d738fd67 aria-expanded=false aria-controls=idcb8ede52c0ccd6a66f6b59e5d738fd67><i class="fa-solid fa-angle-right" id=caret-idcb8ede52c0ccd6a66f6b59e5d738fd67></i></a></div><ul class="nav docs-sidenav collapse" id=idcb8ede52c0ccd6a66f6b59e5d738fd67><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.1-%E5%90%88%E6%88%90%E7%9A%84%E8%AF%AD%E6%B3%95/>6.1 合成的语法</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.10-%E6%80%BB%E7%BB%93/>6.10 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.11-%E7%BB%83%E4%B9%A0/>6.11 练习</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.2-%E7%BB%A7%E6%89%BF%E7%9A%84%E8%AF%AD%E6%B3%95/>6.2 继承的语法</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.3-%E5%90%88%E6%88%90%E4%B8%8E%E7%BB%A7%E6%89%BF%E7%9A%84%E7%BB%93%E5%90%88/>6.3 合成与继承的结合</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.4-%E5%88%B0%E5%BA%95%E9%80%89%E6%8B%A9%E5%90%88%E6%88%90%E8%BF%98%E6%98%AF%E7%BB%A7%E6%89%BF/>6.4 到底选择合成还是继承</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.5-protected/>6.5 protected</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.6-%E7%B4%AF%E7%A7%AF%E5%BC%80%E5%8F%91/>6.6 累积开发</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.7-%E4%B8%8A%E6%BA%AF%E9%80%A0%E5%9E%8B/>6.7 上溯造型</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.8-final%E5%85%B3%E9%94%AE%E5%AD%97/>6.8 final关键字</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/6.%E7%B1%BB%E5%86%8D%E7%94%9F/6.9-%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E7%B1%BB%E8%A3%85%E8%BD%BD/>6.9 初始化和类装载</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id3192b557c504c5032f3213a000631925")' href=#id3192b557c504c5032f3213a000631925 aria-expanded=false aria-controls=id3192b557c504c5032f3213a000631925 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/>7.多态性</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id3192b557c504c5032f3213a000631925 aria-expanded=false aria-controls=id3192b557c504c5032f3213a000631925><i class="fa-solid fa-angle-right" id=caret-id3192b557c504c5032f3213a000631925></i></a></div><ul class="nav docs-sidenav collapse" id=id3192b557c504c5032f3213a000631925><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.1-%E4%B8%8A%E6%BA%AF%E9%80%A0%E5%9E%8B/>7.1 上溯造型</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.10-%E7%BB%83%E4%B9%A0/>7.10 练习</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.2-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/>7.2 深入理解</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.3-%E8%A6%86%E7%9B%96%E4%B8%8E%E9%87%8D%E8%BD%BD/>7.3 覆盖与重载</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.4-%E6%8A%BD%E8%B1%A1%E7%B1%BB%E5%92%8C%E6%96%B9%E6%B3%95/>7.4 抽象类和方法</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.5-%E6%8E%A5%E5%8F%A3/>7.5 接口</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.6-%E5%86%85%E9%83%A8%E7%B1%BB/>7.6 内部类</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.7-%E6%9E%84%E9%80%A0%E5%99%A8%E5%92%8C%E5%A4%9A%E6%80%81%E6%80%A7/>7.7 构造器和多态性</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.8-%E9%80%9A%E8%BF%87%E7%BB%A7%E6%89%BF%E8%BF%9B%E8%A1%8C%E8%AE%BE%E8%AE%A1/>7.8 通过继承进行设计</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/7.%E5%A4%9A%E6%80%81%E6%80%A7/7.9-%E6%80%BB%E7%BB%93/>7.9 总结</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idf8aaefd2efcbd5783cd72d9b10e4475c")' href=#idf8aaefd2efcbd5783cd72d9b10e4475c aria-expanded=false aria-controls=idf8aaefd2efcbd5783cd72d9b10e4475c aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/>8.对象的容纳</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idf8aaefd2efcbd5783cd72d9b10e4475c aria-expanded=false aria-controls=idf8aaefd2efcbd5783cd72d9b10e4475c><i class="fa-solid fa-angle-right" id=caret-idf8aaefd2efcbd5783cd72d9b10e4475c></i></a></div><ul class="nav docs-sidenav collapse" id=idf8aaefd2efcbd5783cd72d9b10e4475c><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.1-%E6%95%B0%E7%BB%84/>8.1 数组</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.2-%E9%9B%86%E5%90%88/>8.2 集合</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.3-%E8%BF%AD%E4%BB%A3%E5%99%A8/>8.3 迭代器</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.4-%E9%9B%86%E5%90%88%E7%9A%84%E7%B1%BB%E5%9E%8B/>8.4 集合的类型</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.5-%E6%8E%92%E5%BA%8F/>8.5 排序</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.6-%E9%80%9A%E7%94%A8%E9%9B%86%E5%90%88%E5%BA%93/>8.6 通用集合库</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.7-%E6%96%B0%E9%9B%86%E5%90%88/>8.7 新集合</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.8-%E6%80%BB%E7%BB%93/>8.8 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/8.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.9-%E7%BB%83%E4%B9%A0/>8.9 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idc52b950da3d5ac1014840c5acb4de098")' href=#idc52b950da3d5ac1014840c5acb4de098 aria-expanded=false aria-controls=idc52b950da3d5ac1014840c5acb4de098 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/9.%E5%BC%82%E5%B8%B8%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6/>9.异常差错控制</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idc52b950da3d5ac1014840c5acb4de098 aria-expanded=false aria-controls=idc52b950da3d5ac1014840c5acb4de098><i class="fa-solid fa-angle-right" id=caret-idc52b950da3d5ac1014840c5acb4de098></i></a></div><ul class="nav docs-sidenav collapse" id=idc52b950da3d5ac1014840c5acb4de098><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/9.%E5%BC%82%E5%B8%B8%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6/9.10-%E7%BB%83%E4%B9%A0/>9.10 练习</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/9.%E5%BC%82%E5%B8%B8%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6/9.6-%E7%94%A8finally%E6%B8%85%E9%99%A4/>9.6 用finally清除</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/9.%E5%BC%82%E5%B8%B8%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6/9.7-%E6%9E%84%E9%80%A0%E5%99%A8/>9.7 构造器</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/9.%E5%BC%82%E5%B8%B8%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6/9.9-%E6%80%BB%E7%BB%93/>9.9 总结</a></li></ul></div><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95a-%E4%BD%BF%E7%94%A8%E9%9D%9Ejava%E4%BB%A3%E7%A0%81/>附录A 使用非JAVA代码</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95b-%E5%AF%B9%E6%AF%94c++%E5%92%8Cjava/>附录B 对比C++和Java</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95c-java%E7%BC%96%E7%A8%8B%E8%A7%84%E5%88%99/>附录C Java编程规则</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95d-%E6%80%A7%E8%83%BD/>附录D 性能</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95e-%E5%85%B3%E4%BA%8E%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%9A%84%E4%B8%80%E4%BA%9B%E8%AF%9D/>附录E 关于垃圾收集的一些话</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95f-%E6%8E%A8%E8%8D%90%E8%AF%BB%E7%89%A9/>附录F 推荐读物</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2%E7%9A%84%E8%AF%9D/>写在前面的话</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E5%BC%95%E8%A8%80/>引言</a></li></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents><ul><li><a href=#equals-规范>equals 规范</a><ul><li><a href=#不同子类的相等性>不同子类的相等性</a></li></ul></li><li><a href=#哈希和哈希码>哈希和哈希码</a><ul><li><a href=#理解-hashcode>理解 hashCode</a></li><li><a href=#为了速度而散列>为了速度而散列</a></li><li><a href=#重写-hashcode>重写 hashCode()</a></li></ul></li><li><a href=#调优-hashmap>调优 HashMap</a></li></ul></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>Appendix-Understanding-equals-and-hashCode</h1><div class=article-style><h1 id=附录理解-equals-和-hashcode-方法>附录:理解 equals 和 hashCode 方法</h1><p>假设有一个容器使用 hash 函数，当你创建一个放到这个容器时，你必须定义 <strong>hashCode()</strong> 函数和 <strong>equals()</strong> 函数。这两个函数一起被用于 hash 容器中的查询操作。</p><h2 id=equals-规范>equals 规范</h2><p>当你创建一个类的时候，它自动继承自 <strong>Objcet</strong> 类。如果你不覆写 <strong>equals()</strong> ，你将会获得 <strong>Objcet</strong> 对象的 <strong>equals()</strong> 函数。默认情况下，这个函数会比较对象的地址。所以只有你在比较同一个对象的时候，你才会获得<strong>true</strong>。默认的情况是"区分度最高的"。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// equalshashcode/DefaultComparison.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>class</span> <span class=nc>DefaultComparison</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>i</span><span class=o>,</span> <span class=n>j</span><span class=o>,</span> <span class=n>k</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>DefaultComparison</span><span class=o>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>,</span> <span class=kt>int</span> <span class=n>j</span><span class=o>,</span> <span class=kt>int</span> <span class=n>k</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>i</span> <span class=o>=</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>j</span> <span class=o>=</span> <span class=n>j</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>k</span> <span class=o>=</span> <span class=n>k</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>DefaultComparison</span>
</span></span><span class=line><span class=cl>        <span class=n>a</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DefaultComparison</span><span class=o>(</span><span class=mi>1</span><span class=o>,</span> <span class=mi>2</span><span class=o>,</span> <span class=mi>3</span><span class=o>),</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DefaultComparison</span><span class=o>(</span><span class=mi>1</span><span class=o>,</span> <span class=mi>2</span><span class=o>,</span> <span class=mi>3</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>a</span> <span class=o>==</span> <span class=n>a</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>a</span> <span class=o>==</span> <span class=n>b</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>Output:
</span></span></span><span class=line><span class=cl><span class=cm>true
</span></span></span><span class=line><span class=cl><span class=cm>false
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p>通常你会希望放宽这个限制。一般来说如果两个对象有相同的类型和相同的字段，你会认为这两个对象相等，但也会有一些你不想加入 <strong>equals()</strong> 函数中来比较的字段。这是类型设计的一部分。</p><p>一个合适的 **equals()**函数必须满足以下五点条件：</p><ol><li>反身性：对于任何 <strong>x</strong>， <strong>x.equals(x)</strong> 应该返回 <strong>true</strong>。</li><li>对称性：对于任何 <strong>x</strong> 和 <strong>y</strong>， <strong>x.equals(y)</strong> 应该返回 <strong>true</strong>当且仅当 <strong>y.equals(x)</strong> 返回 <strong>true</strong> 。</li><li>传递性：对于任何<strong>x</strong>,<strong>y</strong>,还有<strong>z</strong>，如果 <strong>x.equals(y)</strong> 返回 <strong>true</strong> 并且 <strong>y.equals(z)</strong> 返回 <strong>true</strong>，那么 <strong>x.equals(z)</strong> 应该返回 <strong>true</strong>。</li><li>一致性：对于任何 <strong>x</strong>和<strong>y</strong>，在对象没有被改变的情况下，多次调用 <strong>x.equals(y)</strong> 应该总是返回 <strong>true</strong> 或者<strong>false</strong>。</li><li>对于任何非<strong>null</strong>的<strong>x</strong>，<strong>x.equals(null)<strong>应该返回</strong>false</strong>。</li></ol><p>下面是满足这些条件的测试，并且判断对象是否和自己相等（我们这里称呼其为<strong>右值</strong>）：</p><ol><li>如果<strong>右值</strong>是<strong>null</strong>，那么不相等。</li><li>如果<strong>右值</strong>是<strong>this</strong>，那么两个对象相等。</li><li>如果<strong>右值</strong>不是同一个类型或者子类，那么两个对象不相等。</li><li>如果所有上面的检查通过了，那么你必须决定 <strong>右值</strong> 中的哪些字段是重要的，然后比较这些字段。
Java 7 引入了 <strong>Objects</strong> 类型来帮助这个流程，这样我们能够写出更好的 <strong>equals()</strong> 函数。</li></ol><p>下面的例子比较了不同类型的 <strong>Equality</strong>类。为了避免重复的代码，我们使用<em>工厂函数设计模</em>式来实现样例。 <strong>EqualityFactory</strong>接口提供<strong>make()<strong>函数来生成一个</strong>Equaity</strong>对象，这样不同的<strong>EqualityFactory</strong>能够生成<strong>Equality</strong>不同的子类。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// equalshashcode/EqualityFactory.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>interface</span> <span class=nc>EqualityFactory</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Equality</span> <span class=nf>make</span><span class=o>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>,</span> <span class=n>String</span> <span class=n>s</span><span class=o>,</span> <span class=kt>double</span> <span class=n>d</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>现在我们来定义 <strong>Equality</strong>，它包含三个字段（所有的字段我们认为在比较中都很重要）和一个 <strong>equals()</strong> 函数用来满足上述的四种检查。构造函数展示了它的类名来保证我们在执行我们想要的测试：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// equalshashcode/Equality.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Equality</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>int</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=n>String</span> <span class=n>s</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>double</span> <span class=n>d</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Equality</span><span class=o>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>,</span> <span class=n>String</span> <span class=n>s</span><span class=o>,</span> <span class=kt>double</span> <span class=n>d</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>i</span> <span class=o>=</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>s</span> <span class=o>=</span> <span class=n>s</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>d</span> <span class=o>=</span> <span class=n>d</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;made &#39;Equality&#39;&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=o>(</span><span class=n>Object</span> <span class=n>rval</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=o>(</span><span class=n>rval</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=o>(</span><span class=n>rval</span> <span class=o>==</span> <span class=k>this</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=o>(!(</span><span class=n>rval</span> <span class=k>instanceof</span> <span class=n>Equality</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Equality</span> <span class=n>other</span> <span class=o>=</span> <span class=o>(</span><span class=n>Equality</span><span class=o>)</span><span class=n>rval</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=o>(!</span><span class=n>Objects</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>i</span><span class=o>,</span> <span class=n>other</span><span class=o>.</span><span class=na>i</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=o>(!</span><span class=n>Objects</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>s</span><span class=o>,</span> <span class=n>other</span><span class=o>.</span><span class=na>s</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=o>(!</span><span class=n>Objects</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>d</span><span class=o>,</span> <span class=n>other</span><span class=o>.</span><span class=na>d</span><span class=o>))</span><span class=k>return</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test</span><span class=o>(</span><span class=n>String</span> <span class=n>descr</span><span class=o>,</span> <span class=n>String</span> <span class=n>expected</span><span class=o>,</span> <span class=n>Object</span> <span class=n>rval</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;-- Testing %s --%n&#34;</span> <span class=o>+</span> <span class=s>&#34;%s instanceof Equality: %s%n&#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>        <span class=s>&#34;Expected %s, got %s%n&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=n>descr</span><span class=o>,</span> <span class=n>descr</span><span class=o>,</span> <span class=n>rval</span> <span class=k>instanceof</span> <span class=n>Equality</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=n>expected</span><span class=o>,</span> <span class=n>equals</span><span class=o>(</span><span class=n>rval</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>testAll</span><span class=o>(</span><span class=n>EqualityFactory</span> <span class=n>eqf</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Equality</span>
</span></span><span class=line><span class=cl>        <span class=n>e</span> <span class=o>=</span> <span class=n>eqf</span><span class=o>.</span><span class=na>make</span><span class=o>(</span><span class=mi>1</span><span class=o>,</span> <span class=s>&#34;Monty&#34;</span><span class=o>,</span> <span class=mf>3.14</span><span class=o>),</span>
</span></span><span class=line><span class=cl>        <span class=n>eq</span> <span class=o>=</span> <span class=n>eqf</span><span class=o>.</span><span class=na>make</span><span class=o>(</span><span class=mi>1</span><span class=o>,</span> <span class=s>&#34;Monty&#34;</span><span class=o>,</span> <span class=mf>3.14</span><span class=o>),</span>
</span></span><span class=line><span class=cl>        <span class=n>neq</span> <span class=o>=</span> <span class=n>eqf</span><span class=o>.</span><span class=na>make</span><span class=o>(</span><span class=mi>99</span><span class=o>,</span> <span class=s>&#34;Bob&#34;</span><span class=o>,</span> <span class=mf>1.618</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>e</span><span class=o>.</span><span class=na>test</span><span class=o>(</span><span class=s>&#34;null&#34;</span><span class=o>,</span> <span class=s>&#34;false&#34;</span><span class=o>,</span> <span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>e</span><span class=o>.</span><span class=na>test</span><span class=o>(</span><span class=s>&#34;same object&#34;</span><span class=o>,</span> <span class=s>&#34;true&#34;</span><span class=o>,</span> <span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>e</span><span class=o>.</span><span class=na>test</span><span class=o>(</span><span class=s>&#34;different type&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=s>&#34;false&#34;</span><span class=o>,</span> <span class=n>Integer</span><span class=o>.</span><span class=na>valueOf</span><span class=o>(</span><span class=mi>99</span><span class=o>));</span><span class=n>e</span><span class=o>.</span><span class=na>test</span><span class=o>(</span><span class=s>&#34;same values&#34;</span><span class=o>,</span> <span class=s>&#34;true&#34;</span><span class=o>,</span> <span class=n>eq</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>e</span><span class=o>.</span><span class=na>test</span><span class=o>(</span><span class=s>&#34;different values&#34;</span><span class=o>,</span> <span class=s>&#34;false&#34;</span><span class=o>,</span> <span class=n>neq</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>testAll</span><span class=o>(</span> <span class=o>(</span><span class=n>i</span><span class=o>,</span> <span class=n>s</span><span class=o>,</span> <span class=n>d</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=k>new</span> <span class=n>Equality</span><span class=o>(</span><span class=n>i</span><span class=o>,</span> <span class=n>s</span><span class=o>,</span> <span class=n>d</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>Output:
</span></span></span><span class=line><span class=cl><span class=cm>made &#39;Equality&#39;
</span></span></span><span class=line><span class=cl><span class=cm>made &#39;Equality&#39;
</span></span></span><span class=line><span class=cl><span class=cm>made &#39;Equality&#39;
</span></span></span><span class=line><span class=cl><span class=cm>-- Testing null --
</span></span></span><span class=line><span class=cl><span class=cm>null instanceof Equality: false
</span></span></span><span class=line><span class=cl><span class=cm>Expected false, got false
</span></span></span><span class=line><span class=cl><span class=cm>-- Testing same object --
</span></span></span><span class=line><span class=cl><span class=cm>same object instanceof Equality: true
</span></span></span><span class=line><span class=cl><span class=cm>Expected true, got true
</span></span></span><span class=line><span class=cl><span class=cm>-- Testing different type --
</span></span></span><span class=line><span class=cl><span class=cm>different type instanceof Equality: false
</span></span></span><span class=line><span class=cl><span class=cm>Expected false, got false-- Testing same values --
</span></span></span><span class=line><span class=cl><span class=cm>same values instanceof Equality: true
</span></span></span><span class=line><span class=cl><span class=cm>Expected true, got true
</span></span></span><span class=line><span class=cl><span class=cm>-- Testing different values --
</span></span></span><span class=line><span class=cl><span class=cm>different values instanceof Equality: true
</span></span></span><span class=line><span class=cl><span class=cm>Expected false, got false
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p><strong>testAll()</strong> 执行了我们期望的所有不同类型对象的比较。它使用工厂创建了<strong>Equality</strong>对象。</p><p>在 <strong>main()</strong> 里，请注意对 <strong>testAll()</strong> 的调用很简单。因为<strong>EqualityFactory</strong>有着单一的函数，它能够和 lambda 表达式一起使用来表示 <strong>make()</strong> 函数。</p><p>上述的 <strong>equals()</strong> 函数非常繁琐，并且我们能够将其简化成规范的形式，请注意：</p><ol><li><strong>instanceof</strong>检查减少了<strong>null</strong>检查的需要。</li><li>和<strong>this</strong>的比较是多余的。一个正确书写的 <strong>equals()</strong> 函数能正确地和自己比较。</li></ol><p>因为 <strong>&&</strong> 是一个短路比较，它会在第一次遇到失败的时候退出并返回<strong>false</strong>。所以，通过使用 <strong>&&</strong> 将检查链接起来，我们可以写出更精简的 <strong>equals()</strong> 函数：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// equalshashcode/SuccinctEquality.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SuccinctEquality</span> <span class=kd>extends</span> <span class=n>Equality</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>SuccinctEquality</span><span class=o>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>,</span> <span class=n>String</span> <span class=n>s</span><span class=o>,</span> <span class=kt>double</span> <span class=n>d</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>i</span><span class=o>,</span> <span class=n>s</span><span class=o>,</span> <span class=n>d</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;made &#39;SuccinctEquality&#39;&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=o>(</span><span class=n>Object</span> <span class=n>rval</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>rval</span> <span class=k>instanceof</span> <span class=n>SuccinctEquality</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>        <span class=n>Objects</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>i</span><span class=o>,</span> <span class=o>((</span><span class=n>SuccinctEquality</span><span class=o>)</span><span class=n>rval</span><span class=o>).</span><span class=na>i</span><span class=o>)</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>        <span class=n>Objects</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>s</span><span class=o>,</span> <span class=o>((</span><span class=n>SuccinctEquality</span><span class=o>)</span><span class=n>rval</span><span class=o>).</span><span class=na>s</span><span class=o>)</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>        <span class=n>Objects</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>d</span><span class=o>,</span> <span class=o>((</span><span class=n>SuccinctEquality</span><span class=o>)</span><span class=n>rval</span><span class=o>).</span><span class=na>d</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Equality</span><span class=o>.</span><span class=na>testAll</span><span class=o>(</span> <span class=o>(</span><span class=n>i</span><span class=o>,</span> <span class=n>s</span><span class=o>,</span> <span class=n>d</span><span class=o>)</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>SuccinctEquality</span><span class=o>(</span><span class=n>i</span><span class=o>,</span> <span class=n>s</span><span class=o>,</span> <span class=n>d</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=cm>/* Output:
</span></span></span><span class=line><span class=cl><span class=cm>made &#39;Equality&#39;
</span></span></span><span class=line><span class=cl><span class=cm>made &#39;SuccinctEquality&#39;
</span></span></span><span class=line><span class=cl><span class=cm>made &#39;Equality&#39;
</span></span></span><span class=line><span class=cl><span class=cm>made &#39;SuccinctEquality&#39;
</span></span></span><span class=line><span class=cl><span class=cm>made &#39;Equality&#39;
</span></span></span><span class=line><span class=cl><span class=cm>made &#39;SuccinctEquality&#39;
</span></span></span><span class=line><span class=cl><span class=cm>-- Testing null --
</span></span></span><span class=line><span class=cl><span class=cm>null instanceof Equality: false
</span></span></span><span class=line><span class=cl><span class=cm>Expected false, got false
</span></span></span><span class=line><span class=cl><span class=cm>-- Testing same object --
</span></span></span><span class=line><span class=cl><span class=cm>same object instanceof Equality: true
</span></span></span><span class=line><span class=cl><span class=cm>Expected true, got true
</span></span></span><span class=line><span class=cl><span class=cm>-- Testing different type --
</span></span></span><span class=line><span class=cl><span class=cm>different type instanceof Equality: false
</span></span></span><span class=line><span class=cl><span class=cm>Expected false, got false
</span></span></span><span class=line><span class=cl><span class=cm>-- Testing same values --
</span></span></span><span class=line><span class=cl><span class=cm>same values instanceof Equality: true
</span></span></span><span class=line><span class=cl><span class=cm>Expected true, got true
</span></span></span><span class=line><span class=cl><span class=cm>-- Testing different values --different values instanceof Equality: true
</span></span></span><span class=line><span class=cl><span class=cm>Expected false, got false
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p>对于每个 <strong>SuccinctEquality</strong>，基类构造函数在派生类构造函数前被调用，输出显示我们依然获得了正确的结果，你可以发现短路返回已经发生了，不然的话，<strong>null</strong>测试和“不同类型”的测试会在 <strong>equals()</strong> 函数下面的比较中强制转化的时候抛出异常。
<strong>Objects.equals()</strong> 会在你组合其他类型的时候发挥很大的作用。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// equalshashcode/ComposedEquality.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Part</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>ss</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>double</span> <span class=n>dd</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Part</span><span class=o>(</span><span class=n>String</span> <span class=n>ss</span><span class=o>,</span> <span class=kt>double</span> <span class=n>dd</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>ss</span> <span class=o>=</span> <span class=n>ss</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>dd</span> <span class=o>=</span> <span class=n>dd</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=o>(</span><span class=n>Object</span> <span class=n>rval</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>rval</span> <span class=k>instanceof</span> <span class=n>Part</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>        <span class=n>Objects</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>ss</span><span class=o>,</span> <span class=o>((</span><span class=n>Part</span><span class=o>)</span><span class=n>rval</span><span class=o>).</span><span class=na>ss</span><span class=o>)</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>        <span class=n>Objects</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>dd</span><span class=o>,</span> <span class=o>((</span><span class=n>Part</span><span class=o>)</span><span class=n>rval</span><span class=o>).</span><span class=na>dd</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ComposedEquality</span> <span class=kd>extends</span> <span class=n>SuccinctEquality</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Part</span> <span class=n>part</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>ComposedEquality</span><span class=o>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>,</span> <span class=n>String</span> <span class=n>s</span><span class=o>,</span> <span class=kt>double</span> <span class=n>d</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>i</span><span class=o>,</span> <span class=n>s</span><span class=o>,</span> <span class=n>d</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>part</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Part</span><span class=o>(</span><span class=n>s</span><span class=o>,</span> <span class=n>d</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;made &#39;ComposedEquality&#39;&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=o>(</span><span class=n>Object</span> <span class=n>rval</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>rval</span> <span class=k>instanceof</span> <span class=n>ComposedEquality</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>rval</span><span class=o>)</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>        <span class=n>Objects</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>part</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=o>((</span><span class=n>ComposedEquality</span><span class=o>)</span><span class=n>rval</span><span class=o>).</span><span class=na>part</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Equality</span><span class=o>.</span><span class=na>testAll</span><span class=o>(</span> <span class=o>(</span><span class=n>i</span><span class=o>,</span> <span class=n>s</span><span class=o>,</span> <span class=n>d</span><span class=o>)</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ComposedEquality</span><span class=o>(</span><span class=n>i</span><span class=o>,</span> <span class=n>s</span><span class=o>,</span> <span class=n>d</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>Output:
</span></span></span><span class=line><span class=cl><span class=cm>made &#39;Equality&#39;
</span></span></span><span class=line><span class=cl><span class=cm>made &#39;SuccinctEquality&#39;
</span></span></span><span class=line><span class=cl><span class=cm>made &#39;ComposedEquality&#39;
</span></span></span><span class=line><span class=cl><span class=cm>made &#39;Equality&#39;
</span></span></span><span class=line><span class=cl><span class=cm>made &#39;SuccinctEquality&#39;
</span></span></span><span class=line><span class=cl><span class=cm>made &#39;ComposedEquality&#39;
</span></span></span><span class=line><span class=cl><span class=cm>made &#39;Equality&#39;
</span></span></span><span class=line><span class=cl><span class=cm>made &#39;SuccinctEquality&#39;
</span></span></span><span class=line><span class=cl><span class=cm>made &#39;ComposedEquality&#39;
</span></span></span><span class=line><span class=cl><span class=cm>-- Testing null --null instanceof Equality: false
</span></span></span><span class=line><span class=cl><span class=cm>Expected false, got false
</span></span></span><span class=line><span class=cl><span class=cm>-- Testing same object --
</span></span></span><span class=line><span class=cl><span class=cm>same object instanceof Equality: true
</span></span></span><span class=line><span class=cl><span class=cm>Expected true, got true
</span></span></span><span class=line><span class=cl><span class=cm>-- Testing different type --
</span></span></span><span class=line><span class=cl><span class=cm>different type instanceof Equality: false
</span></span></span><span class=line><span class=cl><span class=cm>Expected false, got false
</span></span></span><span class=line><span class=cl><span class=cm>-- Testing same values --
</span></span></span><span class=line><span class=cl><span class=cm>same values instanceof Equality: true
</span></span></span><span class=line><span class=cl><span class=cm>Expected true, got true
</span></span></span><span class=line><span class=cl><span class=cm>-- Testing different values --
</span></span></span><span class=line><span class=cl><span class=cm>different values instanceof Equality: true
</span></span></span><span class=line><span class=cl><span class=cm>Expected false, got false
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p>注意 super.equals()这个调用，没有必要重新发明它（因为你不总是有权限访问基类所有的必要字段）</p><h3 id=不同子类的相等性>不同子类的相等性</h3><p>继承意味着两个不同子类的对象当其向上转型的时候可以是相等的。假设你有一个 Animal 对象的集合。这个集合天然接受<strong>Animal</strong>的子类。在这个例子中是<strong>Dog</strong>和<strong>Pig</strong>。每个<strong>Animal</strong>有一个<strong>name</strong>和<strong>size</strong>，还有唯一的内部<strong>id</strong>数字。</p><p>我们通过<strong>Objects</strong>类，以规范的形式定义 <strong>equals()<strong>函数和</strong>hashCode()</strong>。但是我们只能在基类<strong>Animal</strong>中定义他们。并且我们在这两个函数中没有包含<strong>id</strong>字段。从<strong>equals()<strong>函数的角度看待，这意味着我们只关心它是否是</strong>Animal</strong>，而不关心是否是<strong>Animal</strong>的某个子类。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// equalshashcode/SubtypeEquality.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>enum</span> <span class=n>Size</span> <span class=o>{</span> <span class=n>SMALL</span><span class=o>,</span> <span class=n>MEDIUM</span><span class=o>,</span> <span class=n>LARGE</span> <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Animal</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>int</span> <span class=n>counter</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>id</span> <span class=o>=</span> <span class=n>counter</span><span class=o>++;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=n>Size</span> <span class=n>size</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Animal</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=n>Size</span> <span class=n>size</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>size</span> <span class=o>=</span> <span class=n>size</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=o>(</span><span class=n>Object</span> <span class=n>rval</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>rval</span> <span class=k>instanceof</span> <span class=n>Animal</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Objects.equals(id, ((Animal)rval).id) &amp;&amp; // [1]
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>Objects</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>name</span><span class=o>,</span> <span class=o>((</span><span class=n>Animal</span><span class=o>)</span><span class=n>rval</span><span class=o>).</span><span class=na>name</span><span class=o>)</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>        <span class=n>Objects</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>size</span><span class=o>,</span> <span class=o>((</span><span class=n>Animal</span><span class=o>)</span><span class=n>rval</span><span class=o>).</span><span class=na>size</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>hashCode</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Objects</span><span class=o>.</span><span class=na>hash</span><span class=o>(</span><span class=n>name</span><span class=o>,</span> <span class=n>size</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// return Objects.hash(name, size, id); // [2]
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;%s[%d]: %s %s %x&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=n>getClass</span><span class=o>().</span><span class=na>getSimpleName</span><span class=o>(),</span> <span class=n>id</span><span class=o>,</span>
</span></span><span class=line><span class=cl>        <span class=n>name</span><span class=o>,</span> <span class=n>size</span><span class=o>,</span> <span class=n>hashCode</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Dog</span> <span class=kd>extends</span> <span class=n>Animal</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Dog</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=n>Size</span> <span class=n>size</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>super</span><span class=o>(</span><span class=n>name</span><span class=o>,</span> <span class=n>size</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Pig</span> <span class=kd>extends</span> <span class=n>Animal</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Pig</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=n>Size</span> <span class=n>size</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>super</span><span class=o>(</span><span class=n>name</span><span class=o>,</span> <span class=n>size</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SubtypeEquality</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Set</span><span class=o>&lt;</span><span class=n>Animal</span><span class=o>&gt;</span> <span class=n>pets</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=n>pets</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>Dog</span><span class=o>(</span><span class=s>&#34;Ralph&#34;</span><span class=o>,</span> <span class=n>Size</span><span class=o>.</span><span class=na>MEDIUM</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>pets</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>Pig</span><span class=o>(</span><span class=s>&#34;Ralph&#34;</span><span class=o>,</span> <span class=n>Size</span><span class=o>.</span><span class=na>MEDIUM</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>pets</span><span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>Output:
</span></span></span><span class=line><span class=cl><span class=cm>Dog[0]: Ralph MEDIUM a752aeee
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p>如果我们只考虑类型的话，某些情况下它的确说得通——只从基类的角度看待问题，这是李氏替换原则的基石。这个代码完美符合替换理论因为派生类没有添加任何额外不再基类中的额外函数。派生类只是在表现上不同，而不是在接口上。（当然这不是常态）</p><p>但是当我们提供了两个有着相同数据的不同的对象类型，然后将他们放置在 <strong>HashSet<animal></strong> 中。只有他们中的一个能存活。这强调了 <strong>equals()</strong> 不是完美的数学理论，而只是机械般的理论。
<strong>hashCode()</strong> 和 <strong>equals()</strong> 必须能够允许类型在 hash 数据结构中正常工作。例子中 <strong>Dog</strong> 和 <strong>Pig</strong> 会被映射到同 <strong>HashSet</strong> 的同一个桶中。这个时候，<strong>HashSet</strong> 回退到 <strong>equals()</strong> 来区分对象，但是 <strong>equals()</strong> 也认为两个对象是相同的。<strong>HashSet</strong>因为已经有一个相同的对象了，所以没有添加 <strong>Pig</strong>。
我们依然能够通过使得其他字段对象不同来让例子能够正常工作。在这里每个 <strong>Animal</strong> 已经有了一个独一无二的 <strong>id</strong> ，所以你能够取消 <strong>equals()</strong> 函数中的 <strong>[1]</strong> 行注释，或者取消 <strong>hashCode()</strong> 函数中的 <strong>[2]</strong> 行注释。按照规范，你应该同时完成这两个操作，如此能够将所有“不变的”字段包含在两个操作中（“不变”所以 <strong>equals()</strong> 和 <strong>hashCode()</strong> 在哈希数据结构中的排序和取值时，不会生成不同的值。我将“不变的”放在引号中因为你必须计算出是否已经发生变化）。</p><blockquote><p><strong>旁注</strong>： 在<strong>hashCode()<strong>中，如果你只能够使用一个字段，使用</strong>Objcets.hashCode()</strong>。如果你使用多个字段，那么使用 <strong>Objects.hash()</strong>。</p></blockquote><p>我们也可以通过标准方式，将 <strong>equals()</strong> 定义在子类中（不包含 <strong>id</strong> ）解决这个问题：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// equalshashcode/SubtypeEquality2.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Dog2</span> <span class=kd>extends</span> <span class=n>Animal</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Dog2</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=n>Size</span> <span class=n>size</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>name</span><span class=o>,</span> <span class=n>size</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=o>(</span><span class=n>Object</span> <span class=n>rval</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>rval</span> <span class=k>instanceof</span> <span class=n>Dog2</span> <span class=o>&amp;&amp;</span><span class=kd>super</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>rval</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Pig2</span> <span class=kd>extends</span> <span class=n>Animal</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Pig2</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=n>Size</span> <span class=n>size</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>super</span><span class=o>(</span><span class=n>name</span><span class=o>,</span> <span class=n>size</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=o>(</span><span class=n>Object</span> <span class=n>rval</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>rval</span> <span class=k>instanceof</span> <span class=n>Pig2</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>rval</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SubtypeEquality2</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Set</span><span class=o>&lt;</span><span class=n>Animal</span><span class=o>&gt;</span> <span class=n>pets</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=n>pets</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>Dog2</span><span class=o>(</span><span class=s>&#34;Ralph&#34;</span><span class=o>,</span> <span class=n>Size</span><span class=o>.</span><span class=na>MEDIUM</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>pets</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>Pig2</span><span class=o>(</span><span class=s>&#34;Ralph&#34;</span><span class=o>,</span> <span class=n>Size</span><span class=o>.</span><span class=na>MEDIUM</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>pets</span><span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>Output:
</span></span></span><span class=line><span class=cl><span class=cm>Dog2[0]: Ralph MEDIUM a752aeee
</span></span></span><span class=line><span class=cl><span class=cm>Pig2[1]: Ralph MEDIUM a752aeee
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p>注意 <strong>hashCode()</strong> 是独一无二的，但是因为对象不再 <strong>equals()</strong> ，所以两个函数都出现在<strong>HashSet</strong>中。另外，<strong>super.equals()</strong> 意味着我们不需要访问基类的<strong>private</strong>字段。</p><p>一种说法是 Java 从<strong>equals()</strong> 和<strong>hashCode()</strong> 的定义中分离了可替代性。我们仍然能够将<strong>Dog</strong>和<strong>Pig</strong>放置在 <strong>Set&lt;Animal></strong> 中，无论 <strong>equals()</strong> 和 <strong>hashCode()</strong> 是如何定义的，但是对象不会在哈希数据结构中正常工作，除非这些函数能够被合理定义。不幸的是，<strong>equals()</strong> 不总是和 <strong>hashCode()</strong> 一起使用，这在你尝试为了某个特殊类型避免定义它的时候会让问题复杂化。并且这也是为什么遵循规范是有价值的。然而这会变得更加复杂，因为你不总是需要定义其中一个函数。</p><h2 id=哈希和哈希码>哈希和哈希码</h2><p>在 <a href>集合</a> 章节中，我们使用预先定义的类作为 HashMap 的键。这些示例之所以有用，是因为预定义的类具有所有必需的连线，以使它们正确地充当键。</p><p>当创建自己的类作为 HashMap 的键时，会发生一个常见的陷阱，从而忘记进行必要的接线。例如，考虑一个将 Earthhog 对象与 Prediction 对象匹配的天气预报系统。这似乎很简单：使用 Groundhog 作为键，使用 Prediction 作为值：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// equalshashcode/Groundhog.java
</span></span></span><span class=line><span class=cl><span class=c1>// Looks plausible, but doesn&#39;t work as a HashMap key
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Groundhog</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>int</span> <span class=n>number</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Groundhog</span><span class=o>(</span><span class=kt>int</span> <span class=n>n</span><span class=o>)</span> <span class=o>{</span> <span class=n>number</span> <span class=o>=</span> <span class=n>n</span><span class=o>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;Groundhog #&#34;</span> <span class=o>+</span> <span class=n>number</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// equalshashcode/Prediction.java
</span></span></span><span class=line><span class=cl><span class=c1>// Predicting the weather
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Prediction</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>(</span><span class=mi>47</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>rand</span><span class=o>.</span><span class=na>nextBoolean</span><span class=o>()</span> <span class=o>?</span>
</span></span><span class=line><span class=cl>                <span class=s>&#34;Six more weeks of Winter!&#34;</span> <span class=o>:</span> <span class=s>&#34;Early Spring!&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// equalshashcode/SpringDetector.java
</span></span></span><span class=line><span class=cl><span class=c1>// What will the weather be?
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.lang.reflect.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SpringDetector</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=o>&lt;</span><span class=n>T</span> <span class=kd>extends</span> <span class=n>Groundhog</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>detectSpring</span><span class=o>(</span><span class=n>Class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>type</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>Constructor</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>ghog</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>                    <span class=n>type</span><span class=o>.</span><span class=na>getConstructor</span><span class=o>(</span><span class=kt>int</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>Map</span><span class=o>&lt;</span><span class=n>Groundhog</span><span class=o>,</span> <span class=n>Prediction</span><span class=o>&gt;</span> <span class=n>map</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>                    <span class=n>IntStream</span><span class=o>.</span><span class=na>range</span><span class=o>(</span><span class=mi>0</span><span class=o>,</span> <span class=mi>10</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                            <span class=o>.</span><span class=na>mapToObj</span><span class=o>(</span><span class=n>i</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                                <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                                    <span class=k>return</span> <span class=n>ghog</span><span class=o>.</span><span class=na>newInstance</span><span class=o>(</span><span class=n>i</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                <span class=o>}</span> <span class=k>catch</span><span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                                    <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=o>(</span><span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>                                <span class=o>}</span>
</span></span><span class=line><span class=cl>                            <span class=o>})</span>
</span></span><span class=line><span class=cl>                            <span class=o>.</span><span class=na>collect</span><span class=o>(</span><span class=n>Collectors</span><span class=o>.</span><span class=na>toMap</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                                    <span class=n>Function</span><span class=o>.</span><span class=na>identity</span><span class=o>(),</span>
</span></span><span class=line><span class=cl>                                    <span class=n>gh</span> <span class=o>-&gt;</span> <span class=k>new</span> <span class=n>Prediction</span><span class=o>()));</span>
</span></span><span class=line><span class=cl>            <span class=n>map</span><span class=o>.</span><span class=na>forEach</span><span class=o>((</span><span class=n>k</span><span class=o>,</span> <span class=n>v</span><span class=o>)</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>                    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>k</span> <span class=o>+</span> <span class=s>&#34;: &#34;</span> <span class=o>+</span> <span class=n>v</span><span class=o>));</span>
</span></span><span class=line><span class=cl>            <span class=n>Groundhog</span> <span class=n>gh</span> <span class=o>=</span> <span class=n>ghog</span><span class=o>.</span><span class=na>newInstance</span><span class=o>(</span><span class=mi>3</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                    <span class=s>&#34;Looking up prediction for &#34;</span> <span class=o>+</span> <span class=n>gh</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=o>(</span><span class=n>map</span><span class=o>.</span><span class=na>containsKey</span><span class=o>(</span><span class=n>gh</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>map</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>gh</span><span class=o>));</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span>
</span></span><span class=line><span class=cl>                <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Key not found: &#34;</span> <span class=o>+</span> <span class=n>gh</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>catch</span><span class=o>(</span><span class=n>NoSuchMethodException</span> <span class=o>|</span>
</span></span><span class=line><span class=cl>                <span class=n>IllegalAccessException</span> <span class=o>|</span>
</span></span><span class=line><span class=cl>                <span class=n>InvocationTargetException</span> <span class=o>|</span>
</span></span><span class=line><span class=cl>                <span class=n>InstantiationException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=o>(</span><span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>detectSpring</span><span class=o>(</span><span class=n>Groundhog</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=cm>/* Output:
</span></span></span><span class=line><span class=cl><span class=cm>Groundhog #3: Six more weeks of Winter!
</span></span></span><span class=line><span class=cl><span class=cm>Groundhog #0: Early Spring!
</span></span></span><span class=line><span class=cl><span class=cm>Groundhog #8: Six more weeks of Winter!
</span></span></span><span class=line><span class=cl><span class=cm>Groundhog #6: Early Spring!
</span></span></span><span class=line><span class=cl><span class=cm>Groundhog #4: Early Spring!
</span></span></span><span class=line><span class=cl><span class=cm>Groundhog #2: Six more weeks of Winter!
</span></span></span><span class=line><span class=cl><span class=cm>Groundhog #1: Early Spring!
</span></span></span><span class=line><span class=cl><span class=cm>Groundhog #9: Early Spring!
</span></span></span><span class=line><span class=cl><span class=cm>Groundhog #5: Six more weeks of Winter!
</span></span></span><span class=line><span class=cl><span class=cm>Groundhog #7: Six more weeks of Winter!
</span></span></span><span class=line><span class=cl><span class=cm>Looking up prediction for Groundhog #3
</span></span></span><span class=line><span class=cl><span class=cm>Key not found: Groundhog #3
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p>每个 Groundhog 都被赋予了一个常数，因此你可以通过如下的方式在 HashMap 中寻找对应的 Prediction。“给我一个和 Groundhog#3 相关联的 Prediction”。而 Prediction 通过一个随机生成的 boolean 来选择天气。<code>detectSpring()</code> 方法通过反射来实例化 Groundhog 类，或者它的子类。稍后，当我们继承一种新型的“Groundhog ”以解决此处演示的问题时，这将派上用场。</p><p>这里的 HashMap 被 Groundhog 和其相关联的 Prediction 充满。并且上面展示了 HashMap 里面填充的内容。接下来我们使用填充了常数 3 的 Groundhog 作为 key 用于寻找对应的 Prediction 。（这个键值对肯定在 Map 中）。</p><p>这看起来十分简单，但是这样做并没有奏效 —— 它无法找到数字 3 这个键。问题出在 Groundhog 自动地继承自基类 Object，所以这里使用 Object 的 hashCode0 方法生成散列码，而它默认是使用对象的地址计算散列码。因此，由 Groundhog(3)生成的第一个实例的散列码与由 Groundhog(3)生成的第二个实例的散列码是不同的，而我们正是使用后者进行查找的。</p><p>我们需要恰当的重写 hashCode()方法。但是它仍然无法正常运行，除非你同时重写 equals()方法，它也是 Object 的一部分。HashMap 使用 equals()判断当前的键是否与表中存在的键相同。</p><p>这是因为默认的 Object.equals()只是比较对象的地址，所以一个 Groundhog(3)并不等于另一个 Groundhog(3)，因此，如果要使用自己的类作为 HashMap 的键，必须同时重载 hashCode()和 equals()，如下所示：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// equalshashcode/Groundhog2.java
</span></span></span><span class=line><span class=cl><span class=c1>// A class that&#39;s used as a key in a HashMap
</span></span></span><span class=line><span class=cl><span class=c1>// must override hashCode() and equals()
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Groundhog2</span> <span class=kd>extends</span> <span class=n>Groundhog</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Groundhog2</span><span class=o>(</span><span class=kt>int</span> <span class=n>n</span><span class=o>)</span> <span class=o>{</span> <span class=kd>super</span><span class=o>(</span><span class=n>n</span><span class=o>);</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>hashCode</span><span class=o>()</span> <span class=o>{</span> <span class=k>return</span> <span class=n>number</span><span class=o>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=o>(</span><span class=n>Object</span> <span class=n>o</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>o</span> <span class=k>instanceof</span> <span class=n>Groundhog2</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>                <span class=n>Objects</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                        <span class=n>number</span><span class=o>,</span> <span class=o>((</span><span class=n>Groundhog2</span><span class=o>)</span><span class=n>o</span><span class=o>).</span><span class=na>number</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// equalshashcode/SpringDetector2.java
</span></span></span><span class=line><span class=cl><span class=c1>// A working key
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SpringDetector2</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SpringDetector</span><span class=o>.</span><span class=na>detectSpring</span><span class=o>(</span><span class=n>Groundhog2</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=cm>/* Output:
</span></span></span><span class=line><span class=cl><span class=cm>Groundhog #0: Six more weeks of Winter!
</span></span></span><span class=line><span class=cl><span class=cm>Groundhog #1: Early Spring!
</span></span></span><span class=line><span class=cl><span class=cm>Groundhog #2: Six more weeks of Winter!
</span></span></span><span class=line><span class=cl><span class=cm>Groundhog #3: Early Spring!
</span></span></span><span class=line><span class=cl><span class=cm>Groundhog #4: Early Spring!
</span></span></span><span class=line><span class=cl><span class=cm>Groundhog #5: Six more weeks of Winter!
</span></span></span><span class=line><span class=cl><span class=cm>Groundhog #6: Early Spring!
</span></span></span><span class=line><span class=cl><span class=cm>Groundhog #7: Early Spring!
</span></span></span><span class=line><span class=cl><span class=cm>Groundhog #8: Six more weeks of Winter!
</span></span></span><span class=line><span class=cl><span class=cm>Groundhog #9: Six more weeks of Winter!
</span></span></span><span class=line><span class=cl><span class=cm>Looking up prediction for Groundhog #3
</span></span></span><span class=line><span class=cl><span class=cm>Early Spring!
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p>Groundhog2.hashCode0 返回 Groundhog 的标识数字（编号）作为散列码。在此例中，程序员负责确保不同的 Groundhog 具有不同的编号。hashCode()并不需要总是能够返回唯一的标识码（稍后你会理解其原因），但是 equals() 方法必须严格地判断两个对象是否相同。此处的 equals()是判断 Groundhog 的号码，所以作为 HashMap 中的键，如果两个 Groundhog2 对象具有相同的 Groundhog 编号，程序就出错了。</p><p>如何定义 equals() 方法在上一节 <a href>equals 规范</a>中提到了。输出表明我们现在的输出是正确的。</p><h3 id=理解-hashcode>理解 hashCode</h3><p>前面的例子只是正确解决问题的第一步。它只说明，如果不为你的键覆盖 hashCode() 和 equals() ，那么使用散列的数据结构（HashSet，HashMap，LinkedHashst 或 LinkedHashMap）就无法正确处理你的键。然而，要很好地解决此问题，你必须了解这些数据结构的内部构造。</p><p>首先，使用散列的目的在于：想要使用一个对象来查找另一个对象。不过使用 TreeMap 或者你自己实现的 Map 也可以达到此目的。与散列实现相反，下面的示例用一对 ArrayLists 实现了一个 Map，与 AssociativeArray.java 不同，这其中包含了 Map 接口的完整实现，因此提供了 entrySet()方法：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// equalshashcode/SlowMap.java
</span></span></span><span class=line><span class=cl><span class=c1>// A Map implemented with ArrayLists
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>onjava.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SlowMap</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=kd>extends</span> <span class=n>AbstractMap</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;</span> <span class=n>keys</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>values</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>V</span> <span class=nf>put</span><span class=o>(</span><span class=n>K</span> <span class=n>key</span><span class=o>,</span> <span class=n>V</span> <span class=n>value</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>V</span> <span class=n>oldValue</span> <span class=o>=</span> <span class=n>get</span><span class=o>(</span><span class=n>key</span><span class=o>);</span> <span class=c1>// The old value or null
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span><span class=o>(!</span><span class=n>keys</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=n>key</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>keys</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>key</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>values</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span> <span class=k>else</span>
</span></span><span class=line><span class=cl>            <span class=n>values</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=n>keys</span><span class=o>.</span><span class=na>indexOf</span><span class=o>(</span><span class=n>key</span><span class=o>),</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>oldValue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>V</span> <span class=nf>get</span><span class=o>(</span><span class=n>Object</span> <span class=n>key</span><span class=o>)</span> <span class=o>{</span> <span class=c1>// key: type Object, not K
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span><span class=o>(!</span><span class=n>keys</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=n>key</span><span class=o>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>values</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>keys</span><span class=o>.</span><span class=na>indexOf</span><span class=o>(</span><span class=n>key</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>Map</span><span class=o>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;&gt;</span> <span class=nf>entrySet</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Set</span><span class=o>&lt;</span><span class=n>Map</span><span class=o>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;&gt;</span> <span class=n>set</span><span class=o>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=n>Iterator</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;</span> <span class=n>ki</span> <span class=o>=</span> <span class=n>keys</span><span class=o>.</span><span class=na>iterator</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>Iterator</span><span class=o>&lt;</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>vi</span> <span class=o>=</span> <span class=n>values</span><span class=o>.</span><span class=na>iterator</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span><span class=o>(</span><span class=n>ki</span><span class=o>.</span><span class=na>hasNext</span><span class=o>())</span>
</span></span><span class=line><span class=cl>            <span class=n>set</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>MapEntry</span><span class=o>&lt;&gt;(</span><span class=n>ki</span><span class=o>.</span><span class=na>next</span><span class=o>(),</span> <span class=n>vi</span><span class=o>.</span><span class=na>next</span><span class=o>()));</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>set</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SlowMap</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>m</span><span class=o>=</span> <span class=k>new</span> <span class=n>SlowMap</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span><span class=o>.</span><span class=na>putAll</span><span class=o>(</span><span class=n>Countries</span><span class=o>.</span><span class=na>capitals</span><span class=o>(</span><span class=mi>8</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span><span class=o>.</span><span class=na>forEach</span><span class=o>((</span><span class=n>k</span><span class=o>,</span> <span class=n>v</span><span class=o>)</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>k</span> <span class=o>+</span> <span class=s>&#34;=&#34;</span> <span class=o>+</span> <span class=n>v</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>m</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=s>&#34;BENIN&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span><span class=o>.</span><span class=na>entrySet</span><span class=o>().</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=cm>/* Output:
</span></span></span><span class=line><span class=cl><span class=cm>CAMEROON=Yaounde
</span></span></span><span class=line><span class=cl><span class=cm>ANGOLA=Luanda
</span></span></span><span class=line><span class=cl><span class=cm>BURKINA FASO=Ouagadougou
</span></span></span><span class=line><span class=cl><span class=cm>BURUNDI=Bujumbura
</span></span></span><span class=line><span class=cl><span class=cm>ALGERIA=Algiers
</span></span></span><span class=line><span class=cl><span class=cm>BENIN=Porto-Novo
</span></span></span><span class=line><span class=cl><span class=cm>CAPE VERDE=Praia
</span></span></span><span class=line><span class=cl><span class=cm>BOTSWANA=Gaberone
</span></span></span><span class=line><span class=cl><span class=cm>Porto-Novo
</span></span></span><span class=line><span class=cl><span class=cm>CAMEROON=Yaounde
</span></span></span><span class=line><span class=cl><span class=cm>ANGOLA=Luanda
</span></span></span><span class=line><span class=cl><span class=cm>BURKINA FASO=Ouagadougou
</span></span></span><span class=line><span class=cl><span class=cm>BURUNDI=Bujumbura
</span></span></span><span class=line><span class=cl><span class=cm>ALGERIA=Algiers
</span></span></span><span class=line><span class=cl><span class=cm>BENIN=Porto-Novo
</span></span></span><span class=line><span class=cl><span class=cm>CAPE VERDE=Praia
</span></span></span><span class=line><span class=cl><span class=cm>BOTSWANA=Gaberone
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p>put()方法只是将键与值放入相应的 ArrayList。为了与 Map 接口保持一致，它必须返回旧的键，或者在没有任何旧键的情况下返回 null。</p><p>同样遵循了 Map 规范，get()会在键不在 SlowMap 中的时候产生 null。如果键存在，它将被用来查找表示它在 keys 列表中的位置的数值型索引，并且这个数字被用作索引来产生与 values 列表相关联的值。注意，在 get()中 key 的类型是 Object，而不是你所期望的参数化类型 K（并且是在 AssociativeArrayjava 中真正使用的类型），这是将泛型注入到 Java 语言中的时刻如此之晚所导致的结果-如果泛型是 Java 语言最初就具备的属性，那么 get()就可以执行其参数的类型。</p><p>Map.entrySet() 方法必须产生一个 Map.Entry 对象集。但是，Map.Entry 是一个接口，用来描述依赖于实现的结构，因此如果你想要创建自己的 Map 类型，就必须同时定义 Map.Entry 的实现：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// equalshashcode/MapEntry.java
</span></span></span><span class=line><span class=cl><span class=c1>// A simple Map.Entry for sample Map implementations
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=kd>implements</span> <span class=n>Map</span><span class=o>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>K</span> <span class=n>key</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>V</span> <span class=n>value</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>MapEntry</span><span class=o>(</span><span class=n>K</span> <span class=n>key</span><span class=o>,</span> <span class=n>V</span> <span class=n>value</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>key</span> <span class=o>=</span> <span class=n>key</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>value</span> <span class=o>=</span> <span class=n>value</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>K</span> <span class=nf>getKey</span><span class=o>()</span> <span class=o>{</span> <span class=k>return</span> <span class=n>key</span><span class=o>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>V</span> <span class=nf>getValue</span><span class=o>()</span> <span class=o>{</span> <span class=k>return</span> <span class=n>value</span><span class=o>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>V</span> <span class=nf>setValue</span><span class=o>(</span><span class=n>V</span> <span class=n>v</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>V</span> <span class=n>result</span> <span class=o>=</span> <span class=n>value</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>value</span> <span class=o>=</span> <span class=n>v</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>hashCode</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Objects</span><span class=o>.</span><span class=na>hash</span><span class=o>(</span><span class=n>key</span><span class=o>,</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@SuppressWarnings</span><span class=o>(</span><span class=s>&#34;unchecked&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=o>(</span><span class=n>Object</span> <span class=n>rval</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>rval</span> <span class=k>instanceof</span> <span class=n>MapEntry</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>                <span class=n>Objects</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>key</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                        <span class=o>((</span><span class=n>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;)</span><span class=n>rval</span><span class=o>).</span><span class=na>getKey</span><span class=o>())</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>                <span class=n>Objects</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>value</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                        <span class=o>((</span><span class=n>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;)</span><span class=n>rval</span><span class=o>).</span><span class=na>getValue</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>key</span> <span class=o>+</span> <span class=s>&#34;=&#34;</span> <span class=o>+</span> <span class=n>value</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>这里 equals 方法的实现遵循了<a href>equals 规范</a>。在 Objects 类中有一个非常熟悉的方法可以帮助创建 hashCode() 方法： Objects.hash()。当你定义含有超过一个属性的对象的 <code>hashCode()</code> 时，你可以使用这个方法。如果你的对象只有一个属性，可以直接使用 <code>Objects.hashCode()</code>。</p><p>尽管这个解决方案非常简单，并且看起来在 SlowMap.main() 的琐碎测试中可以正常工作，但是这并不是一个恰当的实现，因为它创建了键和值的副本。entrySet() 的恰当实现应该在 Map 中提供视图，而不是副本，并且这个视图允许对原始映射表进行修改（副本就不行）。</p><h3 id=为了速度而散列>为了速度而散列</h3><p>SlowMap.java 说明了创建一种新的 Map 并不困难。但是正如它的名称 SlowMap 所示，它不会很快，所以如果有更好的选择，就应该放弃它。它的问题在于对键的查询，键没有按照任何特定顺序保存，所以只能使用简单的线性查询，而线性查询是最慢的查询方式。</p><p>散列的价值在于速度：散列使得查询得以快速进行。由于瓶颈位于键的查询速度，因此解决方案之一就是保持键的排序状态，然后使用 Collections.binarySearch()进行查询。</p><p>散列则更进一步，它将键保存在某处，以便能够很快找到。存储一组元素最快的数据结构是数组，所以使用它来表示键的信息（请小心留意，我是说键的信息，而不是键本身）。但是因为数组不能调整容量，因此就有一个问题：我们希望在 Map 中保存数量不确定的值，但是如果键的数量被数组的容量限制了，该怎么办呢？</p><p>答案就是：数组并不保存键本身。而是通过键对象生成一个数字，将其作为数组的下标。这个数字就是散列码，由定义在 Object 中的、且可能由你的类覆盖的 hashCode()方法（在计算机科学的术语中称为散列函数）生成。</p><p>于是查询一个值的过程首先就是计算散列码，然后使用散列码查询数组。如果能够保证没有冲突（如果值的数量是固定的，那么就有可能），那可就有了一个完美的散列函数，但是这种情况只是特例。<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>。通常，冲突由外部链接处理：数组并不直接保存值，而是保存值的 list。然后对 list 中的值使用 equals()方法进行线性的查询。这部分的查询自然会比较慢，但是，如果散列函数好的话，数组的每个位置就只有较少的值。因此，不是查询整个 list，而是快速地跳到数组的某个位置，只对很少的元素进行比较。这便是 HashMap 会如此快的原因。</p><p>理解了散列的原理，我们就能够实现一个简单的散列 Map 了：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// equalshashcode/SimpleHashMap.java
</span></span></span><span class=line><span class=cl><span class=c1>// A demonstration hashed Map
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>onjava.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>SimpleHashMap</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=kd>extends</span> <span class=n>AbstractMap</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Choose a prime number for the hash table
</span></span></span><span class=line><span class=cl><span class=c1>// size, to achieve a uniform distribution:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>SIZE</span> <span class=o>=</span> <span class=mi>997</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// You can&#39;t have a physical array of generics,
</span></span></span><span class=line><span class=cl><span class=c1>// but you can upcast to one:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nd>@SuppressWarnings</span><span class=o>(</span><span class=s>&#34;unchecked&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=n>LinkedList</span><span class=o>&lt;</span><span class=n>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;&gt;[]</span> <span class=n>buckets</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>            <span class=k>new</span> <span class=n>LinkedList</span><span class=o>[</span><span class=n>SIZE</span><span class=o>];</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>V</span> <span class=nf>put</span><span class=o>(</span><span class=n>K</span> <span class=n>key</span><span class=o>,</span> <span class=n>V</span> <span class=n>value</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>V</span> <span class=n>oldValue</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>index</span> <span class=o>=</span> <span class=n>Math</span><span class=o>.</span><span class=na>abs</span><span class=o>(</span><span class=n>key</span><span class=o>.</span><span class=na>hashCode</span><span class=o>())</span> <span class=o>%</span> <span class=n>SIZE</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=o>(</span><span class=n>buckets</span><span class=o>[</span><span class=n>index</span><span class=o>]</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=n>buckets</span><span class=o>[</span><span class=n>index</span><span class=o>]</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LinkedList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=n>LinkedList</span><span class=o>&lt;</span><span class=n>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;&gt;</span> <span class=n>bucket</span> <span class=o>=</span> <span class=n>buckets</span><span class=o>[</span><span class=n>index</span><span class=o>];</span>
</span></span><span class=line><span class=cl>        <span class=n>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=n>pair</span> <span class=o>=</span> <span class=k>new</span> <span class=n>MapEntry</span><span class=o>&lt;&gt;(</span><span class=n>key</span><span class=o>,</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>boolean</span> <span class=n>found</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>ListIterator</span><span class=o>&lt;</span><span class=n>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;&gt;</span> <span class=n>it</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>                <span class=n>bucket</span><span class=o>.</span><span class=na>listIterator</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span><span class=o>(</span><span class=n>it</span><span class=o>.</span><span class=na>hasNext</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=n>iPair</span> <span class=o>=</span> <span class=n>it</span><span class=o>.</span><span class=na>next</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=o>(</span><span class=n>iPair</span><span class=o>.</span><span class=na>getKey</span><span class=o>().</span><span class=na>equals</span><span class=o>(</span><span class=n>key</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>oldValue</span> <span class=o>=</span> <span class=n>iPair</span><span class=o>.</span><span class=na>getValue</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                <span class=n>it</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=n>pair</span><span class=o>);</span> <span class=c1>// Replace old with new
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>found</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=o>(!</span><span class=n>found</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=n>buckets</span><span class=o>[</span><span class=n>index</span><span class=o>].</span><span class=na>add</span><span class=o>(</span><span class=n>pair</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>oldValue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>V</span> <span class=nf>get</span><span class=o>(</span><span class=n>Object</span> <span class=n>key</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>index</span> <span class=o>=</span> <span class=n>Math</span><span class=o>.</span><span class=na>abs</span><span class=o>(</span><span class=n>key</span><span class=o>.</span><span class=na>hashCode</span><span class=o>())</span> <span class=o>%</span> <span class=n>SIZE</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=o>(</span><span class=n>buckets</span><span class=o>[</span><span class=n>index</span><span class=o>]</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=o>(</span><span class=n>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=n>iPair</span> <span class=o>:</span> <span class=n>buckets</span><span class=o>[</span><span class=n>index</span><span class=o>])</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=o>(</span><span class=n>iPair</span><span class=o>.</span><span class=na>getKey</span><span class=o>().</span><span class=na>equals</span><span class=o>(</span><span class=n>key</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>iPair</span><span class=o>.</span><span class=na>getValue</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>Map</span><span class=o>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;&gt;</span> <span class=nf>entrySet</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Set</span><span class=o>&lt;</span><span class=n>Map</span><span class=o>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;&gt;</span> <span class=n>set</span><span class=o>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=o>(</span><span class=n>LinkedList</span><span class=o>&lt;</span><span class=n>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;&gt;</span> <span class=n>bucket</span> <span class=o>:</span> <span class=n>buckets</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=o>(</span><span class=n>bucket</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=k>continue</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span><span class=o>(</span><span class=n>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=o>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=n>mpair</span> <span class=o>:</span> <span class=n>bucket</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=n>set</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>mpair</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>set</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>SimpleHashMap</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>m</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>                <span class=k>new</span> <span class=n>SimpleHashMap</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span><span class=o>.</span><span class=na>putAll</span><span class=o>(</span><span class=n>Countries</span><span class=o>.</span><span class=na>capitals</span><span class=o>(</span><span class=mi>8</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span><span class=o>.</span><span class=na>forEach</span><span class=o>((</span><span class=n>k</span><span class=o>,</span> <span class=n>v</span><span class=o>)</span> <span class=o>-&gt;</span>
</span></span><span class=line><span class=cl>                <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>k</span> <span class=o>+</span> <span class=s>&#34;=&#34;</span> <span class=o>+</span> <span class=n>v</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>m</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=s>&#34;BENIN&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span><span class=o>.</span><span class=na>entrySet</span><span class=o>().</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=cm>/* Output:
</span></span></span><span class=line><span class=cl><span class=cm>CAMEROON=Yaounde
</span></span></span><span class=line><span class=cl><span class=cm>ANGOLA=Luanda
</span></span></span><span class=line><span class=cl><span class=cm>BURKINA FASO=Ouagadougou
</span></span></span><span class=line><span class=cl><span class=cm>BURUNDI=Bujumbura
</span></span></span><span class=line><span class=cl><span class=cm>ALGERIA=Algiers
</span></span></span><span class=line><span class=cl><span class=cm>BENIN=Porto-Novo
</span></span></span><span class=line><span class=cl><span class=cm>CAPE VERDE=Praia
</span></span></span><span class=line><span class=cl><span class=cm>BOTSWANA=Gaberone
</span></span></span><span class=line><span class=cl><span class=cm>Porto-Novo
</span></span></span><span class=line><span class=cl><span class=cm>CAMEROON=Yaounde
</span></span></span><span class=line><span class=cl><span class=cm>ANGOLA=Luanda
</span></span></span><span class=line><span class=cl><span class=cm>BURKINA FASO=Ouagadougou
</span></span></span><span class=line><span class=cl><span class=cm>BURUNDI=Bujumbura
</span></span></span><span class=line><span class=cl><span class=cm>ALGERIA=Algiers
</span></span></span><span class=line><span class=cl><span class=cm>BENIN=Porto-Novo
</span></span></span><span class=line><span class=cl><span class=cm>CAPE VERDE=Praia
</span></span></span><span class=line><span class=cl><span class=cm>BOTSWANA=Gaberone
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p>由于散列表中的“槽位”（slot）通常称为桶位（bucket），因此我们将表示实际散列表的数组命名为 bucket，为使散列分布均匀，桶的数量通常使用质数<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>。注意，为了能够自动处理冲突，使用了一个 LinkedList 的数组；每一个新的元素只是直接添加到 list 尾的某个特定桶位中。即使 Java 不允许你创建泛型数组，那你也可以创建指向这种数组的引用。这里，向上转型为这种数组是很方便的，这样可以防止在后面的代码中进行额外的转型。</p><p>对于 put() 方法，hashCode() 将针对键而被调用，并且其结果被强制转换为正数。为了使产生的数字适合 bucket 数组的大小，取模操作符将按照该数组的尺寸取模。如果数组的某个位置是 null，这表示还没有元素被散列至此，所以，为了保存刚散列到该定位的对象，需要创建一个新的 LinkedList。一般的过程是，查看当前位置的 ist 中是否有相同的元素，如果有，则将旧的值赋给 oldValue，然后用新的值取代旧的值。标记 found 用来跟踪是否找到（相同的）旧的键值对，如果没有，则将新的对添加到 list 的末尾。</p><p>get()方法按照与 put()方法相同的方式计算在 buckets 数组中的索引（这很重要，因为这样可以保证两个方法可以计算出相同的位置）如果此位置有 LinkedList 存在，就对其进行查询。</p><p>注意，这个实现并不意味着对性能进行了调优，它只是想要展示散列映射表执行的各种操作。如果你浏览一下 java.util.HashMap 的源代码，你就会看到一个调过优的实现。同样，为了简单，SimpleHashMap 使用了与 SlowMap 相同的方式来实现 entrySet()，这个方法有些过于简单，不能用于通用的 Map。</p><h3 id=重写-hashcode>重写 hashCode()</h3><p>在明白了如何散列之后，编写自己的 hashCode()就更有意义了。</p><p>首先，你无法控制 bucket 数组的下标值的产生。这个值依赖于具体的 HashMap 对象的容量，而容量的改变与容器的充满程度和负载因子（本章稍后会介绍这个术语）有关。hashCode()生成的结果，经过处理后成为桶位的下标（在 SimpleHashMap 中，只是对其取模，模数为 bucket 数组的大小）。</p><p>设计 hashCode()时最重要的因素就是：无论何时，对同一个对象调用 hashCode()都应该生成同样的值。如果在将一个对象用 put()添加进 HashMap 时产生一个 hashCode()值，而用 get()取出时却产生了另一个 hashCode()值，那么就无法重新取得该对象了。所以，如果你的 hashCode()方法依赖于对象中易变的数据，用户就要当心了，因为此数据发生变化时，hashCode()就会生成一个不同的散列码，相当于产生了一个不同的键。</p><p>此外，也不应该使 hashCode()依赖于具有唯一性的对象信息，尤其是使用 this 值，这只能产生很糟糕的 hashCode()，因为这样做无法生成一个新的键，使之与 put()中原始的键值对中的键相同。这正是 SpringDetector.java 的问题所在，因为它默认的 hashCode0 使用的是对象的地址。所以，应该使用对象内有意义的识别信息。</p><p>下面以 String 类为例。String 有个特点：如果程序中有多个 String 对象，都包含相同的字符串序列，那么这些 String 对象都映射到同一块内存区域。所以 new String(&ldquo;hello&rdquo;)生成的两个实例，虽然是相互独立的，但是对它们使用 hashCode()应该生成同样的结果。通过下面的程序可以看到这种情况：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// equalshashcode/StringHashCode.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>StringHashCode</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span><span class=o>[]</span> <span class=n>hellos</span> <span class=o>=</span> <span class=s>&#34;Hello Hello&#34;</span><span class=o>.</span><span class=na>split</span><span class=o>(</span><span class=s>&#34; &#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>hellos</span><span class=o>[</span><span class=mi>0</span><span class=o>].</span><span class=na>hashCode</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>hellos</span><span class=o>[</span><span class=mi>1</span><span class=o>].</span><span class=na>hashCode</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=cm>/* Output:
</span></span></span><span class=line><span class=cl><span class=cm>69609650
</span></span></span><span class=line><span class=cl><span class=cm>69609650
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p>对于 String 而言，hashCode() 明显是基于 String 的内容的。</p><p>因此，要想使 hashCode() 实用，它必须速度快，并且必须有意义。也就是说，它必须基于对象的内容生成散列码。记得吗，散列码不必是独一无二的（应该更关注生成速度，而不是唯一性），但是通过 hashCode() 和 equals() ，必须能够完全确定对象的身份。</p><p>因为在生成桶的下标前，hashCode()还需要做进一步的处理，所以散列码的生成范围并不重要，只要是 int 即可。</p><p>还有另一个影响因素：好的 hashCode() 应该产生分布均匀的散列码。如果散列码都集中在一块，那么 HashMap 或者 HashSet 在某些区域的负载会很重，这样就不如分布均匀的散列函数快。</p><p>在 Effective Java Programming Language Guide（Addison-Wesley 2001）这本书中，Joshua Bloch 为怎样写出一份像样的 hashCode()给出了基本的指导：</p><ol><li>给 int 变量 result 赋予某个非零值常量，例如 17。</li><li>为对象内每个有意义的字段（即每个可以做 equals）操作的字段计算出一个 int 散列码 c：</li></ol><table><thead><tr><th>字段类型</th><th>计算公式</th></tr></thead><tbody><tr><td>boolean</td><td>c = (f ? 0 : 1)</td></tr><tr><td>byte , char , short , or int</td><td>c = (int)f</td></tr><tr><td>long</td><td>c = (int)(f ^ (f&#187;>32))</td></tr><tr><td>float</td><td>c = Float.floatToIntBits(f);</td></tr><tr><td>double</td><td>long l =Double.doubleToLongBits(f);<br>c = (int)(l ^ (l &#187;> 32))</td></tr><tr><td>Object , where equals() calls equals() for this field</td><td>c = f.hashCode()</td></tr><tr><td>Array</td><td>应用以上规则到每一个元素中</td></tr></tbody></table><ol start=3><li>合并计算得到的散列码： <strong>result = 37 * result + c;​</strong></li><li>返回 result。</li><li>检查 hashCode()最后生成的结果，确保相同的对象有相同的散列码。</li></ol><p>下面便是遵循这些指导的一个例子。提示，你没有必要书写像如下的代码 —— 相反，使用 <code>Objects.hash()</code> 去用于散列多字段的对象（如同在本例中的那样），然后使用 <code>Objects.hashCode()</code> 如散列单字段的对象。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// equalshashcode/CountedString.java
</span></span></span><span class=line><span class=cl><span class=c1>// Creating a good hashCode()
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CountedString</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>created</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>            <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>s</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>id</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>CountedString</span><span class=o>(</span><span class=n>String</span> <span class=n>str</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>=</span> <span class=n>str</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>created</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>s</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=c1>// id is the total number of instances
</span></span></span><span class=line><span class=cl><span class=c1>// of this String used by CountedString:
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>for</span><span class=o>(</span><span class=n>String</span> <span class=n>s2</span> <span class=o>:</span> <span class=n>created</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=o>(</span><span class=n>s2</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>s</span><span class=o>))</span>
</span></span><span class=line><span class=cl>                <span class=n>id</span><span class=o>++;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s>&#34;String: &#34;</span> <span class=o>+</span> <span class=n>s</span> <span class=o>+</span> <span class=s>&#34; id: &#34;</span> <span class=o>+</span> <span class=n>id</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>                <span class=s>&#34; hashCode(): &#34;</span> <span class=o>+</span> <span class=n>hashCode</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>hashCode</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=c1>// The very simple approach:
</span></span></span><span class=line><span class=cl><span class=c1>// return s.hashCode() * id;
</span></span></span><span class=line><span class=cl><span class=c1>// Using Joshua Bloch&#39;s recipe:
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kt>int</span> <span class=n>result</span> <span class=o>=</span> <span class=mi>17</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=mi>37</span> <span class=o>*</span> <span class=n>result</span> <span class=o>+</span> <span class=n>s</span><span class=o>.</span><span class=na>hashCode</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=mi>37</span> <span class=o>*</span> <span class=n>result</span> <span class=o>+</span> <span class=n>id</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=o>(</span><span class=n>Object</span> <span class=n>o</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>o</span> <span class=k>instanceof</span> <span class=n>CountedString</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>                <span class=n>Objects</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>s</span><span class=o>,</span> <span class=o>((</span><span class=n>CountedString</span><span class=o>)</span><span class=n>o</span><span class=o>).</span><span class=na>s</span><span class=o>)</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>                <span class=n>Objects</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>id</span><span class=o>,</span> <span class=o>((</span><span class=n>CountedString</span><span class=o>)</span><span class=n>o</span><span class=o>).</span><span class=na>id</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Map</span><span class=o>&lt;</span><span class=n>CountedString</span><span class=o>,</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>map</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=n>CountedString</span><span class=o>[]</span> <span class=n>cs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CountedString</span><span class=o>[</span><span class=mi>5</span><span class=o>];</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>cs</span><span class=o>.</span><span class=na>length</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>cs</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CountedString</span><span class=o>(</span><span class=s>&#34;hi&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>map</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>cs</span><span class=o>[</span><span class=n>i</span><span class=o>],</span> <span class=n>i</span><span class=o>);</span> <span class=c1>// Autobox int to Integer
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>map</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=o>(</span><span class=n>CountedString</span> <span class=n>cstring</span> <span class=o>:</span> <span class=n>cs</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Looking up &#34;</span> <span class=o>+</span> <span class=n>cstring</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>map</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>cstring</span><span class=o>));</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=cm>/* Output:
</span></span></span><span class=line><span class=cl><span class=cm>{String: hi id: 4 hashCode(): 146450=3, String: hi id:
</span></span></span><span class=line><span class=cl><span class=cm>5 hashCode(): 146451=4, String: hi id: 2 hashCode():
</span></span></span><span class=line><span class=cl><span class=cm>146448=1, String: hi id: 3 hashCode(): 146449=2,
</span></span></span><span class=line><span class=cl><span class=cm>String: hi id: 1 hashCode(): 146447=0}
</span></span></span><span class=line><span class=cl><span class=cm>Looking up String: hi id: 1 hashCode(): 146447
</span></span></span><span class=line><span class=cl><span class=cm>0
</span></span></span><span class=line><span class=cl><span class=cm>Looking up String: hi id: 2 hashCode(): 146448
</span></span></span><span class=line><span class=cl><span class=cm>1
</span></span></span><span class=line><span class=cl><span class=cm>Looking up String: hi id: 3 hashCode(): 146449
</span></span></span><span class=line><span class=cl><span class=cm>2
</span></span></span><span class=line><span class=cl><span class=cm>Looking up String: hi id: 4 hashCode(): 146450
</span></span></span><span class=line><span class=cl><span class=cm>3
</span></span></span><span class=line><span class=cl><span class=cm>Looking up String: hi id: 5 hashCode(): 146451
</span></span></span><span class=line><span class=cl><span class=cm>4
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p>CountedString 由一个 String 和一个 id 组成，此 id 代表包含相同 String 的 CountedString 对象的编号。所有的 String 都被存储在 static ArrayList 中，在构造器中通过选代遍历此 ArrayList 完成对 id 的计算。</p><p>hashCode()和 equals() 都基于 CountedString 的这两个字段来生成结果；如果它们只基于 String 或者只基于 id，不同的对象就可能产生相同的值。</p><p>在 main）中，使用相同的 String 创建了多个 CountedString 对象。这说明，虽然 String 相同，但是由于 id 不同，所以使得它们的散列码并不相同。在程序中，HashMap 被打印了出来，因此可以看到它内部是如何存储元素的（以无法辨别的次序），然后单独查询每一个键，以此证明查询机制工作正常。</p><p>作为第二个示例，请考虑 Individual 类，它被用作<a href>类型信息</a>中所定义的 typeinfo.pet 类库的基类。Individual 类在那一章中就用到了，而它的定义则放到了本章，因此你可以正确地理解其实现。</p><p>在这里替换了手工去计算 <code>hashCode()</code>，我们使用了更合适的方式 <code>Objects.hash()</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// typeinfo/pets/Individual.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nn>typeinfo.pets</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span>
</span></span><span class=line><span class=cl><span class=nc>Individual</span> <span class=kd>implements</span> <span class=n>Comparable</span><span class=o>&lt;</span><span class=n>Individual</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>long</span> <span class=n>counter</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>long</span> <span class=n>id</span> <span class=o>=</span> <span class=n>counter</span><span class=o>++;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>Individual</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span> <span class=k>this</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// &#39;name&#39; is optional:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>public</span> <span class=nf>Individual</span><span class=o>()</span> <span class=o>{}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>getClass</span><span class=o>().</span><span class=na>getSimpleName</span><span class=o>()</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>                <span class=o>(</span><span class=n>name</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>?</span> <span class=s>&#34;&#34;</span> <span class=o>:</span> <span class=s>&#34; &#34;</span> <span class=o>+</span> <span class=n>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>long</span> <span class=nf>id</span><span class=o>()</span> <span class=o>{</span> <span class=k>return</span> <span class=n>id</span><span class=o>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=o>(</span><span class=n>Object</span> <span class=n>o</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>o</span> <span class=k>instanceof</span> <span class=n>Individual</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>                <span class=n>Objects</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>id</span><span class=o>,</span> <span class=o>((</span><span class=n>Individual</span><span class=o>)</span><span class=n>o</span><span class=o>).</span><span class=na>id</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>hashCode</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Objects</span><span class=o>.</span><span class=na>hash</span><span class=o>(</span><span class=n>name</span><span class=o>,</span> <span class=n>id</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>compareTo</span><span class=o>(</span><span class=n>Individual</span> <span class=n>arg</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Compare by class name first:
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>String</span> <span class=n>first</span> <span class=o>=</span> <span class=n>getClass</span><span class=o>().</span><span class=na>getSimpleName</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>argFirst</span> <span class=o>=</span> <span class=n>arg</span><span class=o>.</span><span class=na>getClass</span><span class=o>().</span><span class=na>getSimpleName</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>firstCompare</span> <span class=o>=</span> <span class=n>first</span><span class=o>.</span><span class=na>compareTo</span><span class=o>(</span><span class=n>argFirst</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=o>(</span><span class=n>firstCompare</span> <span class=o>!=</span> <span class=mi>0</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>firstCompare</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=o>(</span><span class=n>name</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>arg</span><span class=o>.</span><span class=na>name</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>secondCompare</span> <span class=o>=</span> <span class=n>name</span><span class=o>.</span><span class=na>compareTo</span><span class=o>(</span><span class=n>arg</span><span class=o>.</span><span class=na>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=o>(</span><span class=n>secondCompare</span> <span class=o>!=</span> <span class=mi>0</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>secondCompare</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>(</span><span class=n>arg</span><span class=o>.</span><span class=na>id</span> <span class=o>&lt;</span> <span class=n>id</span> <span class=o>?</span> <span class=o>-</span><span class=mi>1</span> <span class=o>:</span> <span class=o>(</span><span class=n>arg</span><span class=o>.</span><span class=na>id</span> <span class=o>==</span> <span class=n>id</span> <span class=o>?</span> <span class=mi>0</span> <span class=o>:</span> <span class=mi>1</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>compareTo() 方法有一个比较结构，因此它会产生一个排序序列，排序的规则首先按照实际类型排序，然后如果有名字的话，按照 name 排序，最后按照创建的顺序排序。下面的示例说明了它是如何工作的：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// equalshashcode/IndividualTest.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>collections.MapOfList</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>typeinfo.pets.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>IndividualTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Set</span><span class=o>&lt;</span><span class=n>Individual</span><span class=o>&gt;</span> <span class=n>pets</span> <span class=o>=</span> <span class=k>new</span> <span class=n>TreeSet</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;?</span> <span class=kd>extends</span> <span class=n>Pet</span><span class=o>&gt;</span> <span class=n>lp</span> <span class=o>:</span>
</span></span><span class=line><span class=cl>                <span class=n>MapOfList</span><span class=o>.</span><span class=na>petPeople</span><span class=o>.</span><span class=na>values</span><span class=o>())</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span><span class=o>(</span><span class=n>Pet</span> <span class=n>p</span> <span class=o>:</span> <span class=n>lp</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=n>pets</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>p</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>pets</span><span class=o>.</span><span class=na>forEach</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>::</span><span class=n>println</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=cm>/* Output:
</span></span></span><span class=line><span class=cl><span class=cm>Cat Elsie May
</span></span></span><span class=line><span class=cl><span class=cm>Cat Pinkola
</span></span></span><span class=line><span class=cl><span class=cm>Cat Shackleton
</span></span></span><span class=line><span class=cl><span class=cm>Cat Stanford
</span></span></span><span class=line><span class=cl><span class=cm>Cymric Molly
</span></span></span><span class=line><span class=cl><span class=cm>Dog Margrett
</span></span></span><span class=line><span class=cl><span class=cm>Mutt Spot
</span></span></span><span class=line><span class=cl><span class=cm>Pug Louie aka Louis Snorkelstein Dupree
</span></span></span><span class=line><span class=cl><span class=cm>Rat Fizzy
</span></span></span><span class=line><span class=cl><span class=cm>Rat Freckly
</span></span></span><span class=line><span class=cl><span class=cm>Rat Fuzzy
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span></code></pre></div><p>由于所有的宠物都有名字，因此它们首先按照类型排序，然后在同类型中按照名字排序。</p><h2 id=调优-hashmap>调优 HashMap</h2><p>我们有可能手动调优 HashMap 以提高其在特定应用程序中的性能。为了理解调整 HashMap 时的性能问题，一些术语是必要的：</p><ul><li>容量（Capacity）：表中存储的桶数量。</li><li>初始容量（Initial Capacity）：当表被创建时，桶的初始个数。 HashMap 和 HashSet 有可以让你指定初始容量的构造器。</li><li>个数（Size）：目前存储在表中的键值对的个数。</li><li>负载因子（Load factor）：通常表现为 $\frac{size}{capacity}$。当负载因子大小为 0 的时候表示为一个空表。当负载因子大小为 0.5 表示为一个半满表（half-full table），以此类推。轻负载的表几乎没有冲突，因此是插入和查找的最佳选择（但会减慢使用迭代器进行遍历的过程）。 HashMap 和 HashSet 有可以让你指定负载因子的构造器。当表内容量达到了负载因子，集合就会自动扩充为原始容量（桶的数量）的两倍，并且会将原始的对象存储在新的桶集合中（也被称为 rehashing）</li></ul><p>HashMap 中负载因子的大小为 0.75（当表内容量大小不足四分之三的时候，不会发生 rehashing 现象）。这看起来是一个非常好的同时考虑到时间和空间消耗的平衡策略。更高的负载因子会减少空间的消耗，但是会增加查询的耗时。重要的是，查询操作是你使用的最频繁的一个操作（包括 <code>get()</code> 和 <code>put()</code> 方法）。</p><p>如果你知道存储在 HashMap 中确切的条目个数，直接创建一个足够容量大小的 HashMap，以避免自动发生的 rehashing 操作。</p><div style=page-break-after:always></div><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></li><li id=fn:2><p>事实证明，质数实际上并不是散列桶的理想容量。近来，（经过广泛的测试）Java 的散列函数都使用 2 的整数次方。对现代的处理器来说，除法与求余数是最慢的操作。使用 2 的整数次方长度的散列表，可用掩码代替除法。&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>上一页</div><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/appendix-the-positive-legacy-of-c-plus-plus-and-java/ rel=next>Appendix-The-Positive-Legacy-of-C-plus-plus-and-Java</a></div><div class="col-6 post-nav-item"><div class=meta-nav>下一页</div><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/on-java-8/glossary/ rel=prev>GLOSSARY</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div><script type=text/javascript id=clstr_globe async src="//clustrmaps.com/globe.js?d=kgpJG5sWZQpKujBmD-uW1B54-WBPol-DuDtrB2KFjKs"></script></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>