<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.5.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><meta name=google-site-verification content="google69a5cccb61297807"><meta name=baidu-site-verification content="cqmZHEleVh"><meta name=description content="10.9 对象序列化 Java 1.1 增添了一种有趣的特性，名为“对象序列化”（Object Serialization）。它面向那些实现了 Serializable 接口的对象，可将它们转换成一系列字节，并可在以后完全恢复回原来的样子。这一过程亦可"><link rel=alternate hreflang=zh href=https://ng-tech.icu/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.9-%E5%AF%B9%E8%B1%A1%E5%BA%8F%E5%88%97%E5%8C%96/><meta name=theme-color content="#0a55a7"><link rel=stylesheet href=/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css crossorigin=anonymous title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/dracula.min.css crossorigin=anonymous title=hl-dark media=print onload='this.media="all"' disabled><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/instantsearch.css@7.4.5/themes/satellite-min.css integrity="sha256-TehzF/2QvNKhGQrrNpoOb2Ck4iGZ1J/DI4pkd2oUsBc=" crossorigin=anonymous><link rel=stylesheet href=/css/wowchemy.fab3cd1900ae35687457073b2d518207.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-40NYXJ8823"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-40NYXJ8823")</script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?56df1177bce405601b0ecdd7208f75c6",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu0f7d075e895d6f5f1f5fdbc1e33dc138_10087_180x180_fill_lanczos_center_3.png><link rel=canonical href=https://ng-tech.icu/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.9-%E5%AF%B9%E8%B1%A1%E5%BA%8F%E5%88%97%E5%8C%96/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@wx-chevalier"><meta property="twitter:creator" content="@wx-chevalier"><meta property="og:site_name" content="Next-gen Tech Edu"><meta property="og:url" content="https://ng-tech.icu/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.9-%E5%AF%B9%E8%B1%A1%E5%BA%8F%E5%88%97%E5%8C%96/"><meta property="og:title" content="10.9 对象序列化 | Next-gen Tech Edu"><meta property="og:description" content="10.9 对象序列化 Java 1.1 增添了一种有趣的特性，名为“对象序列化”（Object Serialization）。它面向那些实现了 Serializable 接口的对象，可将它们转换成一系列字节，并可在以后完全恢复回原来的样子。这一过程亦可"><meta property="og:image" content="https://ng-tech.icu/media/sharing.png"><meta property="twitter:image" content="https://ng-tech.icu/media/sharing.png"><meta property="og:locale" content="zh"><title>10.9 对象序列化 | Next-gen Tech Edu</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=e070ec2b4bbcceded542cde4f6ce5649><button onclick=topFunction() id=backTopBtn title="Go to top"><i class="fa-solid fa-circle-up" aria-hidden=true></i></button>
<script src=/js/wowchemy-init.min.14a0ed61c6dbd594b9c75193b25be179.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class="col-6 search-title"><p>搜索</p></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=关闭><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box></div></section><section class=section-search-results><div id=search-hits></div><div id=search-common-queries></div></section></div></aside><div class=page-header><header class=header--fixed><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label=切换导航>
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Next-gen Tech Edu</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/books-gallery><span>笔记（万篇）</span></a></li><li class=nav-item><a class=nav-link href=/#knowledge-map><span>知识图谱</span></a></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>实验室</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=/galaxy-home/gh-craft><span>Craft 方块世界</span></a>
<a class=dropdown-item href=/galaxy-home/glossary-cards><span>3D 知识卡牌</span></a></div></li><style>.dropdown-item{display:inline-flex}</style><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>其他阅读渠道</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230218234451.png></img><span>知乎</span></a>
<a class=dropdown-item href=https://segmentfault.com/blog/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113556.png></img><span>SegmentFault</span></a>
<a class=dropdown-item href=https://zhuanlan.zhihu.com/wxyyxc1992><img style=width:16px;height:16px;display:inline-block;margin-right:8px src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230219113519.png></img><span>掘金</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=搜索><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class=nav-link href=https://github.com/wx-chevalier aria-label=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a></li><div></div><style>@media only screen and (max-width:600px){.jimmysong-template{display:none!important}}</style><li class=jimmysong-template style=color:#fff;font-size:12px><a href=https://jimmysong.io style=color:#fff>By Jimmy Song's Template</a></li></ul></div></nav></header></div><div class=page-body><link rel=stylesheet href=//unpkg.com/heti/umd/heti.min.css><div class="container-xl docs"><div class="row flex-xl-nowrap"><div class=docs-sidebar><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">10.Java IO 系统</span>
<span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>搜索...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li style=display:inline-flex><a style=cursor:pointer onclick=window.history.back()><i class="fas fa-arrow-left pr-1"></i>
Back</a>
<span>|</span>
<a href=/books/><i class="fa-solid fa-house" style=margin-right:4px></i>
Books</a></li></ul><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id775c4a5ac3467743f5bb8deee7e9fdbf")' href=#id775c4a5ac3467743f5bb8deee7e9fdbf aria-expanded=false aria-controls=id775c4a5ac3467743f5bb8deee7e9fdbf aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/>Think in Java</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id775c4a5ac3467743f5bb8deee7e9fdbf aria-expanded=false aria-controls=id775c4a5ac3467743f5bb8deee7e9fdbf><i class="fa-solid fa-angle-down" id=caret-id775c4a5ac3467743f5bb8deee7e9fdbf></i></a></div><ul class="nav docs-sidenav collapse show" id=id775c4a5ac3467743f5bb8deee7e9fdbf><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id525871933f7d0cc39b215ee01317566e")' href=#id525871933f7d0cc39b215ee01317566e aria-expanded=false aria-controls=id525871933f7d0cc39b215ee01317566e aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/01.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/>01.对象入门</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id525871933f7d0cc39b215ee01317566e aria-expanded=false aria-controls=id525871933f7d0cc39b215ee01317566e><i class="fa-solid fa-angle-right" id=caret-id525871933f7d0cc39b215ee01317566e></i></a></div><ul class="nav docs-sidenav collapse" id=id525871933f7d0cc39b215ee01317566e><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/01.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.1-%E6%8A%BD%E8%B1%A1%E7%9A%84%E8%BF%9B%E6%AD%A5/>1.1 抽象的进步</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/01.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.10-%E6%B0%B8%E4%B9%85%E6%80%A7/>1.10 永久性</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/01.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.11-java%E5%92%8C%E5%9B%A0%E7%89%B9%E7%BD%91/>1.11 Java和因特网</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/01.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.12-%E5%88%86%E6%9E%90%E5%92%8C%E8%AE%BE%E8%AE%A1/>1.12 分析和设计</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/01.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.13-java%E8%BF%98%E6%98%AFc++/>1.13 Java还是C++</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/01.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.2-%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%8E%A5%E5%8F%A3/>1.2 对象的接口</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/01.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.3-%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88%E7%9A%84%E9%9A%90%E8%97%8F/>1.3 实现方案的隐藏</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/01.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.4-%E6%96%B9%E6%A1%88%E7%9A%84%E9%87%8D%E5%A4%8D%E4%BD%BF%E7%94%A8/>1.4 方案的重复使用</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/01.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.5-%E7%BB%A7%E6%89%BF%E9%87%8D%E6%96%B0%E4%BD%BF%E7%94%A8%E6%8E%A5%E5%8F%A3/>1.5 继承：重新使用接口</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/01.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.6-%E5%A4%9A%E6%80%81%E5%AF%B9%E8%B1%A1%E7%9A%84%E4%BA%92%E6%8D%A2%E4%BD%BF%E7%94%A8/>1.6 多态对象的互换使用</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/01.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.7-%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E5%AD%98%E5%9C%A8%E6%97%B6%E9%97%B4/>1.7 对象的创建和存在时间</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/01.%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8/1.9-%E5%A4%9A%E7%BA%BF%E7%A8%8B/>1.9 多线程</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id6e74b2031f353ee0d7c0be1f38b16030")' href=#id6e74b2031f353ee0d7c0be1f38b16030 aria-expanded=false aria-controls=id6e74b2031f353ee0d7c0be1f38b16030 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/02.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/>02.一切都是对象</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id6e74b2031f353ee0d7c0be1f38b16030 aria-expanded=false aria-controls=id6e74b2031f353ee0d7c0be1f38b16030><i class="fa-solid fa-angle-right" id=caret-id6e74b2031f353ee0d7c0be1f38b16030></i></a></div><ul class="nav docs-sidenav collapse" id=id6e74b2031f353ee0d7c0be1f38b16030><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/02.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.1-%E7%94%A8%E6%8C%87%E9%92%88%E6%93%8D%E7%BA%B5%E5%AF%B9%E8%B1%A1/>2.1 用指针操纵对象</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/02.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.10-%E6%80%BB%E7%BB%93/>2.10 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/02.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.11-%E7%BB%83%E4%B9%A0/>2.11 练习</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/02.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.2-%E6%89%80%E6%9C%89%E5%AF%B9%E8%B1%A1%E9%83%BD%E5%BF%85%E9%A1%BB%E5%88%9B%E5%BB%BA/>2.2 所有对象都必须创建</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/02.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.3-%E7%BB%9D%E5%AF%B9%E4%B8%8D%E8%A6%81%E6%B8%85%E9%99%A4%E5%AF%B9%E8%B1%A1/>2.3 绝对不要清除对象</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/02.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.4-%E6%96%B0%E5%BB%BA%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%B1%BB/>2.4 新建数据类型：类</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/02.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.5-%E6%96%B9%E6%B3%95%E8%87%AA%E5%8F%98%E9%87%8F%E5%92%8C%E8%BF%94%E5%9B%9E%E5%80%BC/>2.5 方法、自变量和返回值</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/02.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.6-%E6%9E%84%E5%BB%BAjava%E7%A8%8B%E5%BA%8F/>2.6 构建Java程序</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/02.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.7-%E6%88%91%E4%BB%AC%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AAjava%E7%A8%8B%E5%BA%8F/>2.7 我们的第一个Java程序</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/02.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.8-%E6%B3%A8%E9%87%8A%E5%92%8C%E5%B5%8C%E5%85%A5%E6%96%87%E6%A1%A3/>2.8 注释和嵌入文档</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/02.%E4%B8%80%E5%88%87%E9%83%BD%E6%98%AF%E5%AF%B9%E8%B1%A1/2.9-%E7%BC%96%E7%A0%81%E6%A0%B7%E5%BC%8F/>2.9 编码样式</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id0b455eccb2d5251702c12cae8b51f71f")' href=#id0b455eccb2d5251702c12cae8b51f71f aria-expanded=false aria-controls=id0b455eccb2d5251702c12cae8b51f71f aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/03.%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/>03.控制程序流程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id0b455eccb2d5251702c12cae8b51f71f aria-expanded=false aria-controls=id0b455eccb2d5251702c12cae8b51f71f><i class="fa-solid fa-angle-right" id=caret-id0b455eccb2d5251702c12cae8b51f71f></i></a></div><ul class="nav docs-sidenav collapse" id=id0b455eccb2d5251702c12cae8b51f71f><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/03.%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/3.1-%E4%BD%BF%E7%94%A8java%E8%BF%90%E7%AE%97%E7%AC%A6/>3.1 使用Java运算符</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/03.%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/3.2-%E6%89%A7%E8%A1%8C%E6%8E%A7%E5%88%B6/>3.2 执行控制</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/03.%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/3.3-%E6%80%BB%E7%BB%93/>3.3 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/03.%E6%8E%A7%E5%88%B6%E7%A8%8B%E5%BA%8F%E6%B5%81%E7%A8%8B/3.4-%E7%BB%83%E4%B9%A0/>3.4 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idc03315e84905a55e301cb35219ba082d")' href=#idc03315e84905a55e301cb35219ba082d aria-expanded=false aria-controls=idc03315e84905a55e301cb35219ba082d aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/04.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/>04.初始化和清除</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idc03315e84905a55e301cb35219ba082d aria-expanded=false aria-controls=idc03315e84905a55e301cb35219ba082d><i class="fa-solid fa-angle-right" id=caret-idc03315e84905a55e301cb35219ba082d></i></a></div><ul class="nav docs-sidenav collapse" id=idc03315e84905a55e301cb35219ba082d><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/04.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.1-%E7%94%A8%E6%9E%84%E9%80%A0%E5%99%A8%E8%87%AA%E5%8A%A8%E5%88%9D%E5%A7%8B%E5%8C%96/>4.1 用构造器自动初始化</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/04.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.2-%E6%96%B9%E6%B3%95%E9%87%8D%E8%BD%BD/>4.2 方法重载</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/04.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.3-%E6%B8%85%E9%99%A4%E6%94%B6%E5%B0%BE%E5%92%8C%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86/>4.3 清除：收尾和垃圾收集</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/04.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.4-%E6%88%90%E5%91%98%E5%88%9D%E5%A7%8B%E5%8C%96/>4.4 成员初始化</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/04.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.5-%E6%95%B0%E7%BB%84%E5%88%9D%E5%A7%8B%E5%8C%96/>4.5 数组初始化</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/04.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.6-%E6%80%BB%E7%BB%93/>4.6 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/04.%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E6%B8%85%E9%99%A4/4.7-%E7%BB%83%E4%B9%A0/>4.7 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id6fef31548d834cfab9ca7921ca0ffbc7")' href=#id6fef31548d834cfab9ca7921ca0ffbc7 aria-expanded=false aria-controls=id6fef31548d834cfab9ca7921ca0ffbc7 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/05.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/>05.隐藏实施过程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id6fef31548d834cfab9ca7921ca0ffbc7 aria-expanded=false aria-controls=id6fef31548d834cfab9ca7921ca0ffbc7><i class="fa-solid fa-angle-right" id=caret-id6fef31548d834cfab9ca7921ca0ffbc7></i></a></div><ul class="nav docs-sidenav collapse" id=id6fef31548d834cfab9ca7921ca0ffbc7><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/05.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.1-%E5%8C%85%E5%BA%93%E5%8D%95%E5%85%83/>5.1 包：库单元</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/05.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.2-java%E8%AE%BF%E9%97%AE%E6%8C%87%E7%A4%BA%E7%AC%A6/>5.2 Java访问指示符</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/05.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.3-%E6%8E%A5%E5%8F%A3%E4%B8%8E%E5%AE%9E%E7%8E%B0/>5.3 接口与实现</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/05.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.4-%E7%B1%BB%E8%AE%BF%E9%97%AE/>5.4 类访问</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/05.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.5-%E6%80%BB%E7%BB%93/>5.5 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/05.%E9%9A%90%E8%97%8F%E5%AE%9E%E6%96%BD%E8%BF%87%E7%A8%8B/5.6-%E7%BB%83%E4%B9%A0/>5.6 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id1e5c8731a846b682af97a54cf15b18cd")' href=#id1e5c8731a846b682af97a54cf15b18cd aria-expanded=false aria-controls=id1e5c8731a846b682af97a54cf15b18cd aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/06.%E7%B1%BB%E5%86%8D%E7%94%9F/>06.类再生</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id1e5c8731a846b682af97a54cf15b18cd aria-expanded=false aria-controls=id1e5c8731a846b682af97a54cf15b18cd><i class="fa-solid fa-angle-right" id=caret-id1e5c8731a846b682af97a54cf15b18cd></i></a></div><ul class="nav docs-sidenav collapse" id=id1e5c8731a846b682af97a54cf15b18cd><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/06.%E7%B1%BB%E5%86%8D%E7%94%9F/6.1-%E5%90%88%E6%88%90%E7%9A%84%E8%AF%AD%E6%B3%95/>6.1 合成的语法</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/06.%E7%B1%BB%E5%86%8D%E7%94%9F/6.10-%E6%80%BB%E7%BB%93/>6.10 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/06.%E7%B1%BB%E5%86%8D%E7%94%9F/6.11-%E7%BB%83%E4%B9%A0/>6.11 练习</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/06.%E7%B1%BB%E5%86%8D%E7%94%9F/6.2-%E7%BB%A7%E6%89%BF%E7%9A%84%E8%AF%AD%E6%B3%95/>6.2 继承的语法</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/06.%E7%B1%BB%E5%86%8D%E7%94%9F/6.3-%E5%90%88%E6%88%90%E4%B8%8E%E7%BB%A7%E6%89%BF%E7%9A%84%E7%BB%93%E5%90%88/>6.3 合成与继承的结合</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/06.%E7%B1%BB%E5%86%8D%E7%94%9F/6.4-%E5%88%B0%E5%BA%95%E9%80%89%E6%8B%A9%E5%90%88%E6%88%90%E8%BF%98%E6%98%AF%E7%BB%A7%E6%89%BF/>6.4 到底选择合成还是继承</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/06.%E7%B1%BB%E5%86%8D%E7%94%9F/6.5-protected/>6.5 protected</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/06.%E7%B1%BB%E5%86%8D%E7%94%9F/6.6-%E7%B4%AF%E7%A7%AF%E5%BC%80%E5%8F%91/>6.6 累积开发</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/06.%E7%B1%BB%E5%86%8D%E7%94%9F/6.7-%E4%B8%8A%E6%BA%AF%E9%80%A0%E5%9E%8B/>6.7 上溯造型</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/06.%E7%B1%BB%E5%86%8D%E7%94%9F/6.8-final%E5%85%B3%E9%94%AE%E5%AD%97/>6.8 final关键字</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/06.%E7%B1%BB%E5%86%8D%E7%94%9F/6.9-%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E7%B1%BB%E8%A3%85%E8%BD%BD/>6.9 初始化和类装载</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id45922a3318a25b4e4144ca245e79e889")' href=#id45922a3318a25b4e4144ca245e79e889 aria-expanded=false aria-controls=id45922a3318a25b4e4144ca245e79e889 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/07.%E5%A4%9A%E6%80%81%E6%80%A7/>07.多态性</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id45922a3318a25b4e4144ca245e79e889 aria-expanded=false aria-controls=id45922a3318a25b4e4144ca245e79e889><i class="fa-solid fa-angle-right" id=caret-id45922a3318a25b4e4144ca245e79e889></i></a></div><ul class="nav docs-sidenav collapse" id=id45922a3318a25b4e4144ca245e79e889><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/07.%E5%A4%9A%E6%80%81%E6%80%A7/7.1-%E4%B8%8A%E6%BA%AF%E9%80%A0%E5%9E%8B/>7.1 上溯造型</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/07.%E5%A4%9A%E6%80%81%E6%80%A7/7.10-%E7%BB%83%E4%B9%A0/>7.10 练习</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/07.%E5%A4%9A%E6%80%81%E6%80%A7/7.2-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/>7.2 深入理解</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/07.%E5%A4%9A%E6%80%81%E6%80%A7/7.3-%E8%A6%86%E7%9B%96%E4%B8%8E%E9%87%8D%E8%BD%BD/>7.3 覆盖与重载</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/07.%E5%A4%9A%E6%80%81%E6%80%A7/7.4-%E6%8A%BD%E8%B1%A1%E7%B1%BB%E5%92%8C%E6%96%B9%E6%B3%95/>7.4 抽象类和方法</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/07.%E5%A4%9A%E6%80%81%E6%80%A7/7.5-%E6%8E%A5%E5%8F%A3/>7.5 接口</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/07.%E5%A4%9A%E6%80%81%E6%80%A7/7.6-%E5%86%85%E9%83%A8%E7%B1%BB/>7.6 内部类</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/07.%E5%A4%9A%E6%80%81%E6%80%A7/7.7-%E6%9E%84%E9%80%A0%E5%99%A8%E5%92%8C%E5%A4%9A%E6%80%81%E6%80%A7/>7.7 构造器和多态性</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/07.%E5%A4%9A%E6%80%81%E6%80%A7/7.8-%E9%80%9A%E8%BF%87%E7%BB%A7%E6%89%BF%E8%BF%9B%E8%A1%8C%E8%AE%BE%E8%AE%A1/>7.8 通过继承进行设计</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/07.%E5%A4%9A%E6%80%81%E6%80%A7/7.9-%E6%80%BB%E7%BB%93/>7.9 总结</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id27abd1286c9d000b592443d2141c9a55")' href=#id27abd1286c9d000b592443d2141c9a55 aria-expanded=false aria-controls=id27abd1286c9d000b592443d2141c9a55 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/08.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/>08.对象的容纳</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id27abd1286c9d000b592443d2141c9a55 aria-expanded=false aria-controls=id27abd1286c9d000b592443d2141c9a55><i class="fa-solid fa-angle-right" id=caret-id27abd1286c9d000b592443d2141c9a55></i></a></div><ul class="nav docs-sidenav collapse" id=id27abd1286c9d000b592443d2141c9a55><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/08.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.1-%E6%95%B0%E7%BB%84/>8.1 数组</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/08.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.2-%E9%9B%86%E5%90%88/>8.2 集合</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/08.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.3-%E8%BF%AD%E4%BB%A3%E5%99%A8/>8.3 迭代器</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/08.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.4-%E9%9B%86%E5%90%88%E7%9A%84%E7%B1%BB%E5%9E%8B/>8.4 集合的类型</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/08.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.5-%E6%8E%92%E5%BA%8F/>8.5 排序</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/08.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.6-%E9%80%9A%E7%94%A8%E9%9B%86%E5%90%88%E5%BA%93/>8.6 通用集合库</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/08.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.7-%E6%96%B0%E9%9B%86%E5%90%88/>8.7 新集合</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/08.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.8-%E6%80%BB%E7%BB%93/>8.8 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/08.%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AE%B9%E7%BA%B3/8.9-%E7%BB%83%E4%B9%A0/>8.9 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id223a02026171e117fd7610f7a814d5db")' href=#id223a02026171e117fd7610f7a814d5db aria-expanded=false aria-controls=id223a02026171e117fd7610f7a814d5db aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/09.%E5%BC%82%E5%B8%B8%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6/>09.异常差错控制</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id223a02026171e117fd7610f7a814d5db aria-expanded=false aria-controls=id223a02026171e117fd7610f7a814d5db><i class="fa-solid fa-angle-right" id=caret-id223a02026171e117fd7610f7a814d5db></i></a></div><ul class="nav docs-sidenav collapse" id=id223a02026171e117fd7610f7a814d5db><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/09.%E5%BC%82%E5%B8%B8%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6/9.10-%E7%BB%83%E4%B9%A0/>9.10 练习</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/09.%E5%BC%82%E5%B8%B8%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6/9.6-%E7%94%A8finally%E6%B8%85%E9%99%A4/>9.6 用finally清除</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/09.%E5%BC%82%E5%B8%B8%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6/9.7-%E6%9E%84%E9%80%A0%E5%99%A8/>9.7 构造器</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/09.%E5%BC%82%E5%B8%B8%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6/9.9-%E6%80%BB%E7%BB%93/>9.9 总结</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idcac6e18458602ce17bd9b0b2c3e18daa")' href=#idcac6e18458602ce17bd9b0b2c3e18daa aria-expanded=false aria-controls=idcac6e18458602ce17bd9b0b2c3e18daa aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/>10.Java IO 系统</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idcac6e18458602ce17bd9b0b2c3e18daa aria-expanded=false aria-controls=idcac6e18458602ce17bd9b0b2c3e18daa><i class="fa-solid fa-angle-down" id=caret-idcac6e18458602ce17bd9b0b2c3e18daa></i></a></div><ul class="nav docs-sidenav collapse show" id=idcac6e18458602ce17bd9b0b2c3e18daa><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.1-%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA/>10.1 输入和输出</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.10-%E6%80%BB%E7%BB%93/>10.10 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.11-%E7%BB%83%E4%B9%A0/>10.11 练习</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.2-%E5%A2%9E%E6%B7%BB%E5%B1%9E%E6%80%A7%E5%92%8C%E6%9C%89%E7%94%A8%E7%9A%84%E6%8E%A5%E5%8F%A3/>10.2 增添属性和有用的接口</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.3-%E6%9C%AC%E8%BA%AB%E7%9A%84%E7%BC%BA%E9%99%B7randomaccessfile/>10.3 本身的缺陷：RandomAccessFile</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.4-file%E7%B1%BB/>10.4 File类</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.5-io%E6%B5%81%E7%9A%84%E5%85%B8%E5%9E%8B%E5%BA%94%E7%94%A8/>10.5 IO流的典型应用</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.6-streamtokenizer/>10.6 StreamTokenizer</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.7-java-1.1%E7%9A%84io%E6%B5%81/>10.7 Java 1.1的IO流</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.8-%E5%8E%8B%E7%BC%A9/>10.8 压缩</a></li><li class="child level active"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.9-%E5%AF%B9%E8%B1%A1%E5%BA%8F%E5%88%97%E5%8C%96/>10.9 对象序列化</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idfe15c0b7d69e1eea4a39a92683a168d4")' href=#idfe15c0b7d69e1eea4a39a92683a168d4 aria-expanded=false aria-controls=idfe15c0b7d69e1eea4a39a92683a168d4 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/>11.运行期类型鉴定</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idfe15c0b7d69e1eea4a39a92683a168d4 aria-expanded=false aria-controls=idfe15c0b7d69e1eea4a39a92683a168d4><i class="fa-solid fa-angle-right" id=caret-idfe15c0b7d69e1eea4a39a92683a168d4></i></a></div><ul class="nav docs-sidenav collapse" id=idfe15c0b7d69e1eea4a39a92683a168d4><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/11.1-%E5%AF%B9rtti%E7%9A%84%E9%9C%80%E8%A6%81/>11.1 对RTTI的需要</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/11.2-rtti-%E8%AF%AD%E6%B3%95/>11.2 RTTI 语法</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/11.3-%E5%8F%8D%E5%B0%84%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E4%BF%A1%E6%81%AF/>11.3 反射：运行期类信息</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/11.4-%E6%80%BB%E7%BB%93/>11.4 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/11.%E8%BF%90%E8%A1%8C%E6%9C%9F%E7%B1%BB%E5%9E%8B%E9%89%B4%E5%AE%9A/11.5-%E7%BB%83%E4%B9%A0/>11.5 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-iddf7cc690622f50701352bac88f5de264")' href=#iddf7cc690622f50701352bac88f5de264 aria-expanded=false aria-controls=iddf7cc690622f50701352bac88f5de264 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/>12.传递和返回对象</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#iddf7cc690622f50701352bac88f5de264 aria-expanded=false aria-controls=iddf7cc690622f50701352bac88f5de264><i class="fa-solid fa-angle-right" id=caret-iddf7cc690622f50701352bac88f5de264></i></a></div><ul class="nav docs-sidenav collapse" id=iddf7cc690622f50701352bac88f5de264><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.1-%E4%BC%A0%E9%80%92%E6%8C%87%E9%92%88/>12.1 传递指针</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.2-%E5%88%B6%E4%BD%9C%E6%9C%AC%E5%9C%B0%E5%89%AF%E6%9C%AC/>12.2 制作本地副本</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.3-%E5%85%8B%E9%9A%86%E7%9A%84%E6%8E%A7%E5%88%B6/>12.3 克隆的控制</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.4-%E5%8F%AA%E8%AF%BB%E7%B1%BB/>12.4 只读类</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.5-%E6%80%BB%E7%BB%93/>12.5 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/12.%E4%BC%A0%E9%80%92%E5%92%8C%E8%BF%94%E5%9B%9E%E5%AF%B9%E8%B1%A1/12.6-%E7%BB%83%E4%B9%A0/>12.6 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idb1a9edc38a9b424eca8c6736e315c5f2")' href=#idb1a9edc38a9b424eca8c6736e315c5f2 aria-expanded=false aria-controls=idb1a9edc38a9b424eca8c6736e315c5f2 aria-hidden=false data-toggle=collapse></div></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id80c764609525f094184dd5b161c7244d")' href=#id80c764609525f094184dd5b161c7244d aria-expanded=false aria-controls=id80c764609525f094184dd5b161c7244d aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/>14.多线程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id80c764609525f094184dd5b161c7244d aria-expanded=false aria-controls=id80c764609525f094184dd5b161c7244d><i class="fa-solid fa-angle-right" id=caret-id80c764609525f094184dd5b161c7244d></i></a></div><ul class="nav docs-sidenav collapse" id=id80c764609525f094184dd5b161c7244d><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.1-%E5%8F%8D%E5%BA%94%E7%81%B5%E6%95%8F%E7%9A%84%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2/>14.1 反应灵敏的用户界面</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.2-%E5%85%B1%E4%BA%AB%E6%9C%89%E9%99%90%E7%9A%84%E8%B5%84%E6%BA%90/>14.2 共享有限的资源</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.3-%E5%A0%B5%E5%A1%9E/>14.3 堵塞</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.4-%E4%BC%98%E5%85%88%E7%BA%A7/>14.4 优先级</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.5-%E5%9B%9E%E9%A1%BErunnable/>14.5 回顾runnable</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.6-%E6%80%BB%E7%BB%93/>14.6 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/14.%E5%A4%9A%E7%BA%BF%E7%A8%8B/14.7-%E7%BB%83%E4%B9%A0/>14.7 练习</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-id72c1a5699f783ea8a67f0eb1d1d396e1")' href=#id72c1a5699f783ea8a67f0eb1d1d396e1 aria-expanded=false aria-controls=id72c1a5699f783ea8a67f0eb1d1d396e1 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/>15.网络编程</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#id72c1a5699f783ea8a67f0eb1d1d396e1 aria-expanded=false aria-controls=id72c1a5699f783ea8a67f0eb1d1d396e1><i class="fa-solid fa-angle-right" id=caret-id72c1a5699f783ea8a67f0eb1d1d396e1></i></a></div><ul class="nav docs-sidenav collapse" id=id72c1a5699f783ea8a67f0eb1d1d396e1><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.1-%E6%9C%BA%E5%99%A8%E7%9A%84%E6%A0%87%E8%AF%86/>15.1 机器的标识</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.10-%E7%BB%83%E4%B9%A0/>15.10 练习</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.2-%E5%A5%97%E6%8E%A5%E5%AD%97/>15.2 套接字</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.3-%E6%9C%8D%E5%8A%A1%E5%A4%9A%E4%B8%AA%E5%AE%A2%E6%88%B7/>15.3 服务多个客户</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.4-%E6%95%B0%E6%8D%AE%E6%8A%A5/>15.4 数据报</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.5-%E4%B8%80%E4%B8%AAweb%E5%BA%94%E7%94%A8/>15.5 一个Web应用</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.6-java%E4%B8%8Ecgi%E7%9A%84%E6%B2%9F%E9%80%9A/>15.6 Java与CGI的沟通</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.7-%E7%94%A8jdbc%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93/>15.7 用JDBC连接数据库</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.8-%E8%BF%9C%E7%A8%8B%E6%96%B9%E6%B3%95/>15.8 远程方法</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/15.%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/15.9-%E6%80%BB%E7%BB%93/>15.9 总结</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-idbee59bdc5aaf46677af95b12ea99ff64")' href=#idbee59bdc5aaf46677af95b12ea99ff64 aria-expanded=false aria-controls=idbee59bdc5aaf46677af95b12ea99ff64 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/>16.设计范式</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#idbee59bdc5aaf46677af95b12ea99ff64 aria-expanded=false aria-controls=idbee59bdc5aaf46677af95b12ea99ff64><i class="fa-solid fa-angle-right" id=caret-idbee59bdc5aaf46677af95b12ea99ff64></i></a></div><ul class="nav docs-sidenav collapse" id=idbee59bdc5aaf46677af95b12ea99ff64><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.1-%E8%8C%83%E5%BC%8F%E7%9A%84%E6%A6%82%E5%BF%B5/>16.1 范式的概念</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.10-%E7%BB%83%E4%B9%A0/>16.10 练习</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.2-%E8%A7%82%E5%AF%9F%E5%99%A8%E8%8C%83%E5%BC%8F/>16.2 观察器范式</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.3-%E6%A8%A1%E6%8B%9F%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AB%99/>16.3 模拟垃圾回收站</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.4-%E6%94%B9%E8%BF%9B%E8%AE%BE%E8%AE%A1/>16.4 改进设计</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.5-%E6%8A%BD%E8%B1%A1%E7%9A%84%E5%BA%94%E7%94%A8/>16.5 抽象的应用</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.6-%E5%A4%9A%E9%87%8D%E6%B4%BE%E9%81%A3/>16.6 多重派遣</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.7-%E8%AE%BF%E9%97%AE%E5%99%A8%E8%8C%83%E5%BC%8F/>16.7 访问器范式</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.8-rtti%E7%9C%9F%E7%9A%84%E6%9C%89%E5%AE%B3%E5%90%97/>16.8 RTTI真的有害吗</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/16.%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F/16.9-%E6%80%BB%E7%BB%93/>16.9 总结</a></li></ul></div><div class="docs-toc-item has-child"><div class="parent-node d-flex justify-content-between" onclick='Collapse("caret-ida6b4113de6e02470653070d2ebd17b83")' href=#ida6b4113de6e02470653070d2ebd17b83 aria-expanded=false aria-controls=ida6b4113de6e02470653070d2ebd17b83 aria-hidden=false data-toggle=collapse><a class="d-inline docs-toc-link" href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/>17.项目</a>
<a class="nav-toogle d-inline level" aria-hidden=false data-toggle=collapse href=#ida6b4113de6e02470653070d2ebd17b83 aria-expanded=false aria-controls=ida6b4113de6e02470653070d2ebd17b83><i class="fa-solid fa-angle-right" id=caret-ida6b4113de6e02470653070d2ebd17b83></i></a></div><ul class="nav docs-sidenav collapse" id=ida6b4113de6e02470653070d2ebd17b83><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/17.1-%E6%96%87%E5%AD%97%E5%A4%84%E7%90%86/>17.1 文字处理</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/17.2-%E6%96%B9%E6%B3%95%E6%9F%A5%E6%89%BE%E5%B7%A5%E5%85%B7/>17.2 方法查找工具</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/17.3-%E5%A4%8D%E6%9D%82%E6%80%A7%E7%90%86%E8%AE%BA/>17.3 复杂性理论</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/17.4-%E6%80%BB%E7%BB%93/>17.4 总结</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/17.%E9%A1%B9%E7%9B%AE/17.5-%E7%BB%83%E4%B9%A0/>17.5 练习</a></li></ul></div><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95a-%E4%BD%BF%E7%94%A8%E9%9D%9Ejava%E4%BB%A3%E7%A0%81/>附录A 使用非JAVA代码</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95b-%E5%AF%B9%E6%AF%94c++%E5%92%8Cjava/>附录B 对比C++和Java</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95c-java%E7%BC%96%E7%A8%8B%E8%A7%84%E5%88%99/>附录C Java编程规则</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95d-%E6%80%A7%E8%83%BD/>附录D 性能</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95e-%E5%85%B3%E4%BA%8E%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%9A%84%E4%B8%80%E4%BA%9B%E8%AF%9D/>附录E 关于垃圾收集的一些话</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E9%99%84%E5%BD%95f-%E6%8E%A8%E8%8D%90%E8%AF%BB%E7%89%A9/>附录F 推荐读物</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2%E7%9A%84%E8%AF%9D/>写在前面的话</a></li><li class="child level"><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/%E5%BC%95%E8%A8%80/>引言</a></li></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>目录</a></li></ul><nav id=TableOfContents></nav><div class="subscribe-module col-24 mt-1"><img src=https://ngte-superbed.oss-cn-beijing.aliyuncs.com/item/20230220172727.png alt=image title=王下邀月熊的微信公众号></div></div><main class="py-md-3 pl-md-3 docs-content col-xl-8" role=main><article class=article><h1>10.9 对象序列化</h1><div class=article-style><h1 id=109-对象序列化>10.9 对象序列化</h1><p>Java 1.1 增添了一种有趣的特性，名为“对象序列化”（Object Serialization）。它面向那些实现了 Serializable 接口的对象，可将它们转换成一系列字节，并可在以后完全恢复回原来的样子。这一过程亦可通过网络进行。这意味着序列化机制能自动补偿操作系统间的差异。换句话说，可以先在 Windows 机器上创建一个对象，对其序列化，然后通过网络发给一台 Unix 机器，然后在那里准确无误地重新“装配”。不必关心数据在不同机器上如何表示，也不必关心字节的顺序或者其他任何细节。</p><p>就其本身来说，对象的序列化是非常有趣的，因为利用它可以实现“有限持久化”。请记住“持久化”意味着对象的“生存时间”并不取决于程序是否正在执行——它存在或“生存”于程序的每一次调用之间。通过序列化一个对象，将其写入磁盘，以后在程序重新调用时重新恢复那个对象，就能圆满实现一种“持久”效果。之所以称其为“有限”，是因为不能用某种“persistent”（持久）关键字简单地地定义一个对象，并让系统自动照看其他所有细节问题（尽管将来可能成为现实）。相反，必须在自己的程序中明确地序列化和组装对象。</p><p>语言里增加了对象序列化的概念后，可提供对两种主要特性的支持。Java 1.1 的“远程方法调用”（RMI）使本来存在于其他机器的对象可以表现出好象就在本地机器上的行为。将消息发给远程对象时，需要通过对象序列化来传输参数和返回值。RMI 将在第 15 章作具体讨论。</p><p>对象的序列化也是 Java Beans 必需的，后者由 Java 1.1 引入。使用一个 Bean 时，它的状态信息通常在设计期间配置好。程序启动以后，这种状态信息必须保存下来，以便程序启动以后恢复；具体工作由对象序列化完成。</p><p>对象的序列化处理非常简单，只需对象实现了 Serializable 接口即可（该接口仅是一个标记，没有方法）。在 Java 1.1 中，许多标准库类都发生了改变，以便能够序列化——其中包括用于基本数据类型的全部封装器、所有集合类以及其他许多东西。甚至 Class 对象也可以序列化（第 11 章讲述了具体实现过程）。</p><p>为序列化一个对象，首先要创建某些 OutputStream 对象，然后将其封装到 ObjectOutputStream 对象内。此时，只需调用 writeObject()即可完成对象的序列化，并将其发送给 OutputStream。相反的过程是将一个 InputStream 封装到 ObjectInputStream 内，然后调用 readObject()。和往常一样，我们最后获得的是指向一个上溯造型 Object 的指针，所以必须下溯造型，以便能够直接设置。</p><p>对象序列化特别“聪明”的一个地方是它不仅保存了对象的“全景图”，而且能追踪对象内包含的所有指针并保存那些对象；接着又能对每个对象内包含的指针进行追踪；以此类推。我们有时将这种情况称为“对象网”，单个对象可与之建立连接。而且它还包含了对象的指针数组以及成员对象。若必须自行操纵一套对象序列化机制，那么在代码里追踪所有这些链接时可能会显得非常麻烦。在另一方面，由于 Java 对象的序列化似乎找不出什么缺点，所以请尽量不要自己动手，让它用优化的算法自动维护整个对象网。下面这个例子对序列化机制进行了测试。它建立了许多链接对象的一个“Worm”（蠕虫），每个对象都与 Worm 中的下一段链接，同时又与属于不同类（Data）的对象指针数组链接：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//: Worm.java
</span></span></span><span class=line><span class=cl><span class=c1>// Demonstrates object serialization in Java 1.1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.io.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Data</span> <span class=kd>implements</span> <span class=n>Serializable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>int</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=n>Data</span><span class=o>(</span><span class=kt>int</span> <span class=n>x</span><span class=o>)</span> <span class=o>{</span> <span class=n>i</span> <span class=o>=</span> <span class=n>x</span><span class=o>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Integer</span><span class=o>.</span><span class=na>toString</span><span class=o>(</span><span class=n>i</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Worm</span> <span class=kd>implements</span> <span class=n>Serializable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Generate a random int value:
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>private</span> <span class=kd>static</span> <span class=kt>int</span> <span class=nf>r</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>(</span><span class=kt>int</span><span class=o>)(</span><span class=n>Math</span><span class=o>.</span><span class=na>random</span><span class=o>()</span> <span class=o>*</span> <span class=mi>10</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=n>Data</span><span class=o>[]</span> <span class=n>d</span> <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=n>Data</span><span class=o>(</span><span class=n>r</span><span class=o>()),</span> <span class=k>new</span> <span class=n>Data</span><span class=o>(</span><span class=n>r</span><span class=o>()),</span> <span class=k>new</span> <span class=n>Data</span><span class=o>(</span><span class=n>r</span><span class=o>())</span>
</span></span><span class=line><span class=cl>  <span class=o>};</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=n>Worm</span> <span class=n>next</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>char</span> <span class=n>c</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Value of i == number of segments
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>Worm</span><span class=o>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>,</span> <span class=kt>char</span> <span class=n>x</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34; Worm constructor: &#34;</span> <span class=o>+</span> <span class=n>i</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=n>x</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=o>(--</span><span class=n>i</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=n>next</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Worm</span><span class=o>(</span><span class=n>i</span><span class=o>,</span> <span class=o>(</span><span class=kt>char</span><span class=o>)(</span><span class=n>x</span> <span class=o>+</span> <span class=mi>1</span><span class=o>));</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=n>Worm</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Default constructor&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>s</span> <span class=o>=</span> <span class=s>&#34;:&#34;</span> <span class=o>+</span> <span class=n>c</span> <span class=o>+</span> <span class=s>&#34;(&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>d</span><span class=o>.</span><span class=na>length</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span>
</span></span><span class=line><span class=cl>      <span class=n>s</span> <span class=o>+=</span> <span class=n>d</span><span class=o>[</span><span class=n>i</span><span class=o>].</span><span class=na>toString</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>+=</span> <span class=s>&#34;)&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=o>(</span><span class=n>next</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=n>s</span> <span class=o>+=</span> <span class=n>next</span><span class=o>.</span><span class=na>toString</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>s</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Worm</span> <span class=n>w</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Worm</span><span class=o>(</span><span class=mi>6</span><span class=o>,</span> <span class=sc>&#39;a&#39;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;w = &#34;</span> <span class=o>+</span> <span class=n>w</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>ObjectOutputStream</span> <span class=n>out</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ObjectOutputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>          <span class=k>new</span> <span class=n>FileOutputStream</span><span class=o>(</span><span class=s>&#34;worm.out&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>      <span class=n>out</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=s>&#34;Worm storage&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>out</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=n>w</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>out</span><span class=o>.</span><span class=na>close</span><span class=o>();</span> <span class=c1>// Also flushes output
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=n>ObjectInputStream</span> <span class=n>in</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ObjectInputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>          <span class=k>new</span> <span class=n>FileInputStream</span><span class=o>(</span><span class=s>&#34;worm.out&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>      <span class=n>String</span> <span class=n>s</span> <span class=o>=</span> <span class=o>(</span><span class=n>String</span><span class=o>)</span><span class=n>in</span><span class=o>.</span><span class=na>readObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=n>Worm</span> <span class=n>w2</span> <span class=o>=</span> <span class=o>(</span><span class=n>Worm</span><span class=o>)</span><span class=n>in</span><span class=o>.</span><span class=na>readObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>s</span> <span class=o>+</span> <span class=s>&#34;, w2 = &#34;</span> <span class=o>+</span> <span class=n>w2</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span><span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>ByteArrayOutputStream</span> <span class=n>bout</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ByteArrayOutputStream</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=n>ObjectOutputStream</span> <span class=n>out</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ObjectOutputStream</span><span class=o>(</span><span class=n>bout</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>out</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=s>&#34;Worm storage&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>out</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=n>w</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>out</span><span class=o>.</span><span class=na>flush</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=n>ObjectInputStream</span> <span class=n>in</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ObjectInputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>          <span class=k>new</span> <span class=n>ByteArrayInputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>            <span class=n>bout</span><span class=o>.</span><span class=na>toByteArray</span><span class=o>()));</span>
</span></span><span class=line><span class=cl>      <span class=n>String</span> <span class=n>s</span> <span class=o>=</span> <span class=o>(</span><span class=n>String</span><span class=o>)</span><span class=n>in</span><span class=o>.</span><span class=na>readObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=n>Worm</span> <span class=n>w3</span> <span class=o>=</span> <span class=o>(</span><span class=n>Worm</span><span class=o>)</span><span class=n>in</span><span class=o>.</span><span class=na>readObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>s</span> <span class=o>+</span> <span class=s>&#34;, w3 = &#34;</span> <span class=o>+</span> <span class=n>w3</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span><span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=c1>///:~
</span></span></span></code></pre></div><p>更有趣的是，Worm 内的 Data 对象数组是用随机数字初始化的（这样便不用怀疑编译器保留了某种原始信息）。每个 Worm 段都用一个 Char 标记。这个 Char 是在重复生成链接的 Worm 列表时自动产生的。创建一个 Worm 时，需告诉构造器希望它有多长。为产生下一个指针（next），它总是用减去 1 的长度来调用 Worm 构造器。最后一个 next 指针则保持为 null（空），表示已抵达 Worm 的尾部。
上面的所有操作都是为了加深事情的复杂程度，加大对象序列化的难度。然而，真正的序列化过程却是非常简单的。一旦从另外某个流里创建了 ObjectOutputStream，writeObject()就会序列化对象。注意也可以为一个 String 调用 writeObject()。亦可使用与 DataOutputStream 相同的方法写入所有基本数据类型（它们有相同的接口）。</p><p>有两个单独的 try 块看起来是类似的。第一个读写的是文件，而另一个读写的是一个 ByteArray（字节数组）。可利用对任何 DataInputStream 或者 DataOutputStream 的序列化来读写特定的对象；正如在关于连网的那一章会讲到的那样，这些对象甚至包括网络。一次循环后的输出结果如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Worm</span> <span class=n>constructor</span><span class=o>:</span> <span class=mi>6</span>
</span></span><span class=line><span class=cl><span class=n>Worm</span> <span class=n>constructor</span><span class=o>:</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=n>Worm</span> <span class=n>constructor</span><span class=o>:</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=n>Worm</span> <span class=n>constructor</span><span class=o>:</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>Worm</span> <span class=n>constructor</span><span class=o>:</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>Worm</span> <span class=n>constructor</span><span class=o>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>w</span> <span class=o>=</span> <span class=o>:</span><span class=n>a</span><span class=o>(</span><span class=mi>262</span><span class=o>):</span><span class=n>b</span><span class=o>(</span><span class=mi>100</span><span class=o>):</span><span class=n>c</span><span class=o>(</span><span class=mi>396</span><span class=o>):</span><span class=n>d</span><span class=o>(</span><span class=mi>480</span><span class=o>):</span><span class=n>e</span><span class=o>(</span><span class=mi>316</span><span class=o>):</span><span class=n>f</span><span class=o>(</span><span class=mi>398</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=n>Worm</span> <span class=n>storage</span><span class=o>,</span> <span class=n>w2</span> <span class=o>=</span> <span class=o>:</span><span class=n>a</span><span class=o>(</span><span class=mi>262</span><span class=o>):</span><span class=n>b</span><span class=o>(</span><span class=mi>100</span><span class=o>):</span><span class=n>c</span><span class=o>(</span><span class=mi>396</span><span class=o>):</span><span class=n>d</span><span class=o>(</span><span class=mi>480</span><span class=o>):</span><span class=n>e</span><span class=o>(</span><span class=mi>316</span><span class=o>):</span><span class=n>f</span><span class=o>(</span><span class=mi>398</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=n>Worm</span> <span class=n>storage</span><span class=o>,</span> <span class=n>w3</span> <span class=o>=</span> <span class=o>:</span><span class=n>a</span><span class=o>(</span><span class=mi>262</span><span class=o>):</span><span class=n>b</span><span class=o>(</span><span class=mi>100</span><span class=o>):</span><span class=n>c</span><span class=o>(</span><span class=mi>396</span><span class=o>):</span><span class=n>d</span><span class=o>(</span><span class=mi>480</span><span class=o>):</span><span class=n>e</span><span class=o>(</span><span class=mi>316</span><span class=o>):</span><span class=n>f</span><span class=o>(</span><span class=mi>398</span><span class=o>)</span>
</span></span></code></pre></div><p>可以看出，装配回原状的对象确实包含了原来那个对象里包含的所有链接。</p><p>注意在对一个 Serializable（可序列化）对象进行重新装配的过程中，不会调用任何构造器（甚至默认构造器）。整个对象都是通过从 InputStream 中取得数据恢复的。</p><p>作为 Java 1.1 特性的一种，我们注意到对象的序列化并不属于新的 Reader 和 Writer 层次结构的一部分，而是沿用老式的 InputStream 和 OutputStream 结构。所以在一些特殊的场合下，不得不混合使用两种类型的层次结构。</p><p>10.9.1 寻找类</p><p>读者或许会奇怪为什么需要一个对象从它的序列化状态中恢复。举个例子来说，假定我们序列化一个对象，并通过网络将其作为文件传送给另一台机器。此时，位于另一台机器的程序可以只用文件目录来重新构造这个对象吗？
回答这个问题的最好方法就是做一个实验。下面这个文件位于本章的子目录下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//: Alien.java
</span></span></span><span class=line><span class=cl><span class=c1>// A serializable class
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.io.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Alien</span> <span class=kd>implements</span> <span class=n>Serializable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=c1>///:~
</span></span></span></code></pre></div><p>用于创建和序列化一个 Alien 对象的文件位于相同的目录下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//: FreezeAlien.java
</span></span></span><span class=line><span class=cl><span class=c1>// Create a serialized output file
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.io.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>FreezeAlien</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ObjectOutput</span> <span class=n>out</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>      <span class=k>new</span> <span class=n>ObjectOutputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>FileOutputStream</span><span class=o>(</span><span class=s>&#34;file.x&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=n>Alien</span> <span class=n>zorcon</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Alien</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=n>zorcon</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=c1>///:~
</span></span></span></code></pre></div><p>该程序并不是捕获和控制异常，而是将异常简单、直接地传递到 main()外部，这样便能在命令行报告它们。
程序编译并运行后，将结果产生的 file.x 复制到名为 xfiles 的子目录，代码如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//: ThawAlien.java
</span></span></span><span class=line><span class=cl><span class=c1>// Try to recover a serialized file without the
</span></span></span><span class=line><span class=cl><span class=c1>// class of object that&#39;s stored in that file.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>package</span> <span class=nn>c10.xfiles</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.io.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ThawAlien</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ObjectInputStream</span> <span class=n>in</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>      <span class=k>new</span> <span class=n>ObjectInputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>FileInputStream</span><span class=o>(</span><span class=s>&#34;file.x&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=n>Object</span> <span class=n>mystery</span> <span class=o>=</span> <span class=n>in</span><span class=o>.</span><span class=na>readObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span>
</span></span><span class=line><span class=cl>      <span class=n>mystery</span><span class=o>.</span><span class=na>getClass</span><span class=o>().</span><span class=na>toString</span><span class=o>());</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=c1>///:~
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=err>```</span> <span class=n>java</span>
</span></span><span class=line><span class=cl><span class=err>该程序能打开文件，并成功读取</span><span class=n>mystery</span><span class=err>对象中的内容。然而，一旦尝试查找与对象有关的任何资料——这要求</span><span class=n>Alien</span><span class=err>的</span><span class=n>Class</span><span class=err>对象——</span><span class=n>Java</span><span class=err>虚拟机（</span><span class=n>JVM</span><span class=err>）便找不到</span><span class=n>Alien</span><span class=o>.</span><span class=na>class</span><span class=err>（除非它正好在类路径内，而本例理应相反）。这样就会得到一个名叫</span><span class=n>ClassNotFoundException</span><span class=err>的异常（同样地，若非能够校验</span><span class=n>Alien</span><span class=err>存在的证据，否则它等于消失）。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>恢复了一个序列化的对象后，如果想对其做更多的事情，必须保证</span><span class=n>JVM</span><span class=err>能在本地类路径或者因特网的其他什么地方找到相关的</span><span class=o>.</span><span class=na>class</span><span class=err>文件。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>10.9.2</span> <span class=err>序列化的控制</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>正如大家看到的那样，默认的序列化机制并不难操纵。然而，假若有特殊要求又该怎么办呢？我们可能有特殊的安全问题，不希望对象的某一部分序列化；或者某一个子对象完全不必序列化，因为对象恢复以后，那一部分需要重新创建。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>此时，通过实现</span><span class=n>Externalizable</span><span class=err>接口，用它代替</span><span class=n>Serializable</span><span class=err>接口，便可控制序列化的具体过程。这个</span><span class=n>Externalizable</span><span class=err>接口扩展了</span><span class=n>Serializable</span><span class=err>，并增添了两个方法：</span><span class=n>writeExternal</span><span class=o>()</span><span class=err>和</span><span class=n>readExternal</span><span class=o>()</span><span class=err>。在序列化和重新装配的过程中，会自动调用这两个方法，以便我们执行一些特殊操作。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>下面这个例子展示了</span><span class=n>Externalizable</span><span class=err>接口方法的简单应用。注意</span><span class=n>Blip1</span><span class=err>和</span><span class=n>Blip2</span><span class=err>几乎完全一致，除了极微小的差别（自己研究一下代码，看看是否能发现）：</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>```</span> <span class=n>java</span>
</span></span><span class=line><span class=cl><span class=c1>//: Blips.java
</span></span></span><span class=line><span class=cl><span class=c1>// Simple use of Externalizable &amp; a pitfall
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.io.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Blip1</span> <span class=kd>implements</span> <span class=n>Externalizable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=nf>Blip1</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Blip1 Constructor&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>writeExternal</span><span class=o>(</span><span class=n>ObjectOutput</span> <span class=n>out</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Blip1.writeExternal&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>readExternal</span><span class=o>(</span><span class=n>ObjectInput</span> <span class=n>in</span><span class=o>)</span>
</span></span><span class=line><span class=cl>     <span class=kd>throws</span> <span class=n>IOException</span><span class=o>,</span> <span class=n>ClassNotFoundException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Blip1.readExternal&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Blip2</span> <span class=kd>implements</span> <span class=n>Externalizable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Blip2</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Blip2 Constructor&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>writeExternal</span><span class=o>(</span><span class=n>ObjectOutput</span> <span class=n>out</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Blip2.writeExternal&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>readExternal</span><span class=o>(</span><span class=n>ObjectInput</span> <span class=n>in</span><span class=o>)</span>
</span></span><span class=line><span class=cl>     <span class=kd>throws</span> <span class=n>IOException</span><span class=o>,</span> <span class=n>ClassNotFoundException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Blip2.readExternal&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Blips</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Constructing objects:&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Blip1</span> <span class=n>b1</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Blip1</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>Blip2</span> <span class=n>b2</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Blip2</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>ObjectOutputStream</span> <span class=n>o</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ObjectOutputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>          <span class=k>new</span> <span class=n>FileOutputStream</span><span class=o>(</span><span class=s>&#34;Blips.out&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>      <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Saving objects:&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>o</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=n>b1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>o</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=n>b2</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>o</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Now get them back:
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=n>ObjectInputStream</span> <span class=n>in</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ObjectInputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>          <span class=k>new</span> <span class=n>FileInputStream</span><span class=o>(</span><span class=s>&#34;Blips.out&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>      <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Recovering b1:&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>b1</span> <span class=o>=</span> <span class=o>(</span><span class=n>Blip1</span><span class=o>)</span><span class=n>in</span><span class=o>.</span><span class=na>readObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=c1>// OOPS! Throws an exception:
</span></span></span><span class=line><span class=cl><span class=c1>//!   System.out.println(&#34;Recovering b2:&#34;);
</span></span></span><span class=line><span class=cl><span class=c1>//!   b2 = (Blip2)in.readObject();
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span> <span class=k>catch</span><span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=c1>///:~
</span></span></span></code></pre></div><p>该程序输出如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Constructing</span> <span class=n>objects</span><span class=o>:</span>
</span></span><span class=line><span class=cl><span class=n>Blip1</span> <span class=n>Constructor</span>
</span></span><span class=line><span class=cl><span class=n>Blip2</span> <span class=n>Constructor</span>
</span></span><span class=line><span class=cl><span class=n>Saving</span> <span class=n>objects</span><span class=o>:</span>
</span></span><span class=line><span class=cl><span class=n>Blip1</span><span class=o>.</span><span class=na>writeExternal</span>
</span></span><span class=line><span class=cl><span class=n>Blip2</span><span class=o>.</span><span class=na>writeExternal</span>
</span></span><span class=line><span class=cl><span class=n>Recovering</span> <span class=n>b1</span><span class=o>:</span>
</span></span><span class=line><span class=cl><span class=n>Blip1</span> <span class=n>Constructor</span>
</span></span><span class=line><span class=cl><span class=n>Blip1</span><span class=o>.</span><span class=na>readExternal</span>
</span></span></code></pre></div><p>未恢复 Blip2 对象的原因是那样做会导致一个异常。你找出了 Blip1 和 Blip2 之间的区别吗？Blip1 的构造器是“公共的”（public），Blip2 的构造器则不然，这样便会在恢复时造成异常。试试将 Blip2 的构造器属性变成“public”，然后删除//!注释标记，看看是否能得到正确的结果。</p><p>恢复 b1 后，会调用 Blip1 默认构造器。这与恢复一个 Serializable（可序列化）对象不同。在后者的情况下，对象完全以它保存下来的二进制位为基础恢复，不存在构造器调用。而对一个 Externalizable 对象，所有普通的默认构建行为都会发生（包括在字段定义时的初始化），而且会调用 readExternal()。必须注意这一事实——特别注意所有默认的构建行为都会进行——否则很难在自己的 Externalizable 对象中产生正确的行为。</p><p>下面这个例子揭示了保存和恢复一个 Externalizable 对象必须做的全部事情：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//: Blip3.java
</span></span></span><span class=line><span class=cl><span class=c1>// Reconstructing an externalizable object
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.io.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Blip3</span> <span class=kd>implements</span> <span class=n>Externalizable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=n>String</span> <span class=n>s</span><span class=o>;</span> <span class=c1>// No initialization
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>public</span> <span class=nf>Blip3</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Blip3 Constructor&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// s, i not initialized
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=nf>Blip3</span><span class=o>(</span><span class=n>String</span> <span class=n>x</span><span class=o>,</span> <span class=kt>int</span> <span class=n>a</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Blip3(String x, int a)&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=n>x</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span> <span class=o>=</span> <span class=n>a</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// s &amp; i initialized only in non-default
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// constructor.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span> <span class=k>return</span> <span class=n>s</span> <span class=o>+</span> <span class=n>i</span><span class=o>;</span> <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>writeExternal</span><span class=o>(</span><span class=n>ObjectOutput</span> <span class=n>out</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Blip3.writeExternal&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// You must do this:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>out</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=n>s</span><span class=o>);</span> <span class=n>out</span><span class=o>.</span><span class=na>writeInt</span><span class=o>(</span><span class=n>i</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>readExternal</span><span class=o>(</span><span class=n>ObjectInput</span> <span class=n>in</span><span class=o>)</span>
</span></span><span class=line><span class=cl>     <span class=kd>throws</span> <span class=n>IOException</span><span class=o>,</span> <span class=n>ClassNotFoundException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Blip3.readExternal&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// You must do this:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>s</span> <span class=o>=</span> <span class=o>(</span><span class=n>String</span><span class=o>)</span><span class=n>in</span><span class=o>.</span><span class=na>readObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span> <span class=o>=</span><span class=n>in</span><span class=o>.</span><span class=na>readInt</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Constructing objects:&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Blip3</span> <span class=n>b3</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Blip3</span><span class=o>(</span><span class=s>&#34;A String &#34;</span><span class=o>,</span> <span class=mi>47</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>b3</span><span class=o>.</span><span class=na>toString</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>ObjectOutputStream</span> <span class=n>o</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ObjectOutputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>          <span class=k>new</span> <span class=n>FileOutputStream</span><span class=o>(</span><span class=s>&#34;Blip3.out&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>      <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Saving object:&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>o</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=n>b3</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>o</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Now get it back:
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=n>ObjectInputStream</span> <span class=n>in</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ObjectInputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>          <span class=k>new</span> <span class=n>FileInputStream</span><span class=o>(</span><span class=s>&#34;Blip3.out&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>      <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Recovering b3:&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>b3</span> <span class=o>=</span> <span class=o>(</span><span class=n>Blip3</span><span class=o>)</span><span class=n>in</span><span class=o>.</span><span class=na>readObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>b3</span><span class=o>.</span><span class=na>toString</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span><span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=c1>///:~
</span></span></span></code></pre></div><p>其中，字段 s 和 i 只在第二个构造器中初始化，不关默认构造器的事。这意味着假如不在 readExternal 中初始化 s 和 i，它们就会成为 null（因为在对象创建的第一步中已将对象的存储空间清除为 1）。若注释掉跟随于“You must do this”后面的两行代码，并运行程序，就会发现当对象恢复以后，s 是 null，而 i 是零。</p><p>若从一个 Externalizable 对象继承，通常需要调用 writeExternal()和 readExternal()的基础类版本，以便正确地保存和恢复基础类组件。</p><p>所以为了让一切正常运作起来，千万不可仅在 writeExternal()方法执行期间写入对象的重要数据（没有默认的行为可用来为一个 Externalizable 对象写入所有成员对象）的，而是必须在 readExternal()方法中也恢复那些数据。初次操作时可能会有些不习惯，因为 Externalizable 对象的默认构建行为使其看起来似乎正在进行某种存储与恢复操作。但实情并非如此。</p><ol><li>transient（临时）关键字</li></ol><p>控制序列化过程时，可能有一个特定的子对象不愿让 Java 的序列化机制自动保存与恢复。一般地，若那个子对象包含了不想序列化的敏感信息（如密码），就会面临这种情况。即使那种信息在对象中具有“private”（私有）属性，但一旦经序列化处理，人们就可以通过读取一个文件，或者拦截网络传输得到它。</p><p>为防止对象的敏感部分被序列化，一个办法是将自己的类实现为 Externalizable，就象前面展示的那样。这样一来，没有任何东西可以自动序列化，只能在 writeExternal()明确序列化那些需要的部分。</p><p>然而，若操作的是一个 Serializable 对象，所有序列化操作都会自动进行。为解决这个问题，可以用 transient（临时）逐个字段地关闭序列化，它的意思是“不要麻烦你（指自动机制）保存或恢复它了——我会自己处理的”。</p><p>例如，假设一个 Login 对象包含了与一个特定的登录会话有关的信息。校验登录的合法性时，一般都想将数据保存下来，但不包括密码。为做到这一点，最简单的办法是实现 Serializable，并将 password 字段设为 transient。下面是具体的代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//: Logon.java
</span></span></span><span class=line><span class=cl><span class=c1>// Demonstrates the &#34;transient&#34; keyword
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.io.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Logon</span> <span class=kd>implements</span> <span class=n>Serializable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=n>Date</span> <span class=n>date</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Date</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=n>String</span> <span class=n>username</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>transient</span> <span class=n>String</span> <span class=n>password</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=n>Logon</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>,</span> <span class=n>String</span> <span class=n>pwd</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>username</span> <span class=o>=</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>password</span> <span class=o>=</span> <span class=n>pwd</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>pwd</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>      <span class=o>(</span><span class=n>password</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>?</span> <span class=s>&#34;(n/a)&#34;</span> <span class=o>:</span> <span class=n>password</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s>&#34;logon info: \n   &#34;</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>      <span class=s>&#34;username: &#34;</span> <span class=o>+</span> <span class=n>username</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>      <span class=s>&#34;\n   date: &#34;</span> <span class=o>+</span> <span class=n>date</span><span class=o>.</span><span class=na>toString</span><span class=o>()</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>      <span class=s>&#34;\n   password: &#34;</span> <span class=o>+</span> <span class=n>pwd</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Logon</span> <span class=n>a</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Logon</span><span class=o>(</span><span class=s>&#34;Hulk&#34;</span><span class=o>,</span> <span class=s>&#34;myLittlePony&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span> <span class=s>&#34;logon a = &#34;</span> <span class=o>+</span> <span class=n>a</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>ObjectOutputStream</span> <span class=n>o</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ObjectOutputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>          <span class=k>new</span> <span class=n>FileOutputStream</span><span class=o>(</span><span class=s>&#34;Logon.out&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>      <span class=n>o</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=n>a</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>o</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Delay:
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kt>int</span> <span class=n>seconds</span> <span class=o>=</span> <span class=mi>5</span><span class=o>;</span>
</span></span><span class=line><span class=cl>      <span class=kt>long</span> <span class=n>t</span> <span class=o>=</span> <span class=n>System</span><span class=o>.</span><span class=na>currentTimeMillis</span><span class=o>()</span>
</span></span><span class=line><span class=cl>             <span class=o>+</span> <span class=n>seconds</span> <span class=o>*</span> <span class=mi>1000</span><span class=o>;</span>
</span></span><span class=line><span class=cl>      <span class=k>while</span><span class=o>(</span><span class=n>System</span><span class=o>.</span><span class=na>currentTimeMillis</span><span class=o>()</span> <span class=o>&lt;</span> <span class=n>t</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>;</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Now get them back:
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=n>ObjectInputStream</span> <span class=n>in</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ObjectInputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>          <span class=k>new</span> <span class=n>FileInputStream</span><span class=o>(</span><span class=s>&#34;Logon.out&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>      <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span>
</span></span><span class=line><span class=cl>        <span class=s>&#34;Recovering object at &#34;</span> <span class=o>+</span> <span class=k>new</span> <span class=n>Date</span><span class=o>());</span>
</span></span><span class=line><span class=cl>      <span class=n>a</span> <span class=o>=</span> <span class=o>(</span><span class=n>Logon</span><span class=o>)</span><span class=n>in</span><span class=o>.</span><span class=na>readObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span> <span class=s>&#34;logon a = &#34;</span> <span class=o>+</span> <span class=n>a</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span><span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=c1>///:~
</span></span></span></code></pre></div><p>可以看到，其中的 date 和 username 字段保持原始状态（未设成 transient），所以会自动序列化。然而，password 被设为 transient，所以不会自动保存到磁盘；另外，自动序列化机制也不会作恢复它的尝试。输出如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>logon</span> <span class=n>a</span> <span class=o>=</span> <span class=n>logon</span> <span class=n>info</span><span class=o>:</span>
</span></span><span class=line><span class=cl>   <span class=n>username</span><span class=o>:</span> <span class=n>Hulk</span>
</span></span><span class=line><span class=cl>   <span class=n>date</span><span class=o>:</span> <span class=n>Sun</span> <span class=n>Mar</span> <span class=mi>23</span> <span class=mi>18</span><span class=o>:</span><span class=mi>25</span><span class=o>:</span><span class=mi>53</span> <span class=n>PST</span> <span class=mi>1997</span>
</span></span><span class=line><span class=cl>   <span class=n>password</span><span class=o>:</span> <span class=n>myLittlePony</span>
</span></span><span class=line><span class=cl><span class=n>Recovering</span> <span class=n>object</span> <span class=n>at</span> <span class=n>Sun</span> <span class=n>Mar</span> <span class=mi>23</span> <span class=mi>18</span><span class=o>:</span><span class=mi>25</span><span class=o>:</span><span class=mi>59</span> <span class=n>PST</span> <span class=mi>1997</span>
</span></span><span class=line><span class=cl><span class=n>logon</span> <span class=n>a</span> <span class=o>=</span> <span class=n>logon</span> <span class=n>info</span><span class=o>:</span>
</span></span><span class=line><span class=cl>   <span class=n>username</span><span class=o>:</span> <span class=n>Hulk</span>
</span></span><span class=line><span class=cl>   <span class=n>date</span><span class=o>:</span> <span class=n>Sun</span> <span class=n>Mar</span> <span class=mi>23</span> <span class=mi>18</span><span class=o>:</span><span class=mi>25</span><span class=o>:</span><span class=mi>53</span> <span class=n>PST</span> <span class=mi>1997</span>
</span></span><span class=line><span class=cl>   <span class=n>password</span><span class=o>:</span> <span class=o>(</span><span class=n>n</span><span class=o>/</span><span class=n>a</span><span class=o>)</span>
</span></span></code></pre></div><p>一旦对象恢复成原来的样子，password 字段就会变成 null。注意必须用 toString()检查 password 是否为 null，因为若用重载的“+”运算符来装配一个 String 对象，而且那个运算符遇到一个 null 指针，就会造成一个名为 NullPointerException 的异常（新版 Java 可能会提供避免这个问题的代码）。</p><p>我们也发现 date 字段被保存到磁盘，并从磁盘恢复，没有重新生成。</p><p>由于 Externalizable 对象默认时不保存它的任何字段，所以 transient 关键字只能伴随 Serializable 使用。</p><ol start=2><li>Externalizable 的替代方法</li></ol><p>若不是特别在意要实现 Externalizable 接口，还有另一种方法可供选用。我们可以实现 Serializable 接口，并添加（注意是“添加”，而非“覆盖”或者“实现”）名为 writeObject()和 readObject()的方法。一旦对象被序列化或者重新装配，就会分别调用那两个方法。也就是说，只要提供了这两个方法，就会优先使用它们，而不考虑默认的序列化机制。
这些方法必须含有下列准确的签名：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span>
</span></span><span class=line><span class=cl>  <span class=nf>writeObject</span><span class=o>(</span><span class=n>ObjectOutputStream</span> <span class=n>stream</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>throws</span> <span class=n>IOException</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>private</span> <span class=kt>void</span>
</span></span><span class=line><span class=cl>  <span class=nf>readObject</span><span class=o>(</span><span class=n>ObjectInputStream</span> <span class=n>stream</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>throws</span> <span class=n>IOException</span><span class=o>,</span> <span class=n>ClassNotFoundException</span>
</span></span></code></pre></div><p>从设计的角度出发，情况变得有些扑朔迷离。首先，大家可能认为这些方法不属于基础类或者 Serializable 接口的一部分，它们应该在自己的接口中得到定义。但请注意它们被定义成“private”，这意味着它们只能由这个类的其他成员调用。然而，我们实际并不从这个类的其他成员中调用它们，而是由 ObjectOutputStream 和 ObjectInputStream 的 writeObject()及 readObject()方法来调用我们对象的 writeObject()和 readObject()方法（注意我在这里用了很大的抑制力来避免使用相同的方法名——因为怕混淆）。大家可能奇怪 ObjectOutputStream 和 ObjectInputStream 如何有权访问我们的类的 private 方法——只能认为这是序列化机制玩的一个把戏。</p><p>在任何情况下，接口中的定义的任何东西都会自动具有 public 属性，所以假若 writeObject()和 readObject()必须为 private，那么它们不能成为接口（interface）的一部分。但由于我们准确地加上了签名，所以最终的效果实际与实现一个接口是相同的。</p><p>看起来似乎我们调用 ObjectOutputStream.writeObject()的时候，我们传递给它的 Serializable 对象似乎会被检查是否实现了自己的 writeObject()。若答案是肯定的是，便会跳过常规的序列化过程，并调用 writeObject()。readObject()也会遇到同样的情况。</p><p>还存在另一个问题。在我们的 writeObject()内部，可以调用 defaultWriteObject()，从而决定采取默认的 writeObject()行动。类似地，在 readObject()内部，可以调用 defaultReadObject()。下面这个简单的例子演示了如何对一个 Serializable 对象的存储与恢复进行控制：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//: SerialCtl.java
</span></span></span><span class=line><span class=cl><span class=c1>// Controlling serialization by adding your own
</span></span></span><span class=line><span class=cl><span class=c1>// writeObject() and readObject() methods.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.io.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SerialCtl</span> <span class=kd>implements</span> <span class=n>Serializable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>String</span> <span class=n>a</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>transient</span> <span class=n>String</span> <span class=n>b</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=nf>SerialCtl</span><span class=o>(</span><span class=n>String</span> <span class=n>aa</span><span class=o>,</span> <span class=n>String</span> <span class=n>bb</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=s>&#34;Not Transient: &#34;</span> <span class=o>+</span> <span class=n>aa</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=s>&#34;Transient: &#34;</span> <span class=o>+</span> <span class=n>bb</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>a</span> <span class=o>+</span> <span class=s>&#34;\n&#34;</span> <span class=o>+</span> <span class=n>b</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>void</span>
</span></span><span class=line><span class=cl>    <span class=nf>writeObject</span><span class=o>(</span><span class=n>ObjectOutputStream</span> <span class=n>stream</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>stream</span><span class=o>.</span><span class=na>defaultWriteObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>stream</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=n>b</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>void</span>
</span></span><span class=line><span class=cl>    <span class=nf>readObject</span><span class=o>(</span><span class=n>ObjectInputStream</span> <span class=n>stream</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=kd>throws</span> <span class=n>IOException</span><span class=o>,</span> <span class=n>ClassNotFoundException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>stream</span><span class=o>.</span><span class=na>defaultReadObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=o>(</span><span class=n>String</span><span class=o>)</span><span class=n>stream</span><span class=o>.</span><span class=na>readObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>SerialCtl</span> <span class=n>sc</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>      <span class=k>new</span> <span class=n>SerialCtl</span><span class=o>(</span><span class=s>&#34;Test1&#34;</span><span class=o>,</span> <span class=s>&#34;Test2&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Before:\n&#34;</span> <span class=o>+</span> <span class=n>sc</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>ByteArrayOutputStream</span> <span class=n>buf</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>      <span class=k>new</span> <span class=n>ByteArrayOutputStream</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>ObjectOutputStream</span> <span class=n>o</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ObjectOutputStream</span><span class=o>(</span><span class=n>buf</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>o</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=n>sc</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Now get it back:
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=n>ObjectInputStream</span> <span class=n>in</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ObjectInputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>          <span class=k>new</span> <span class=n>ByteArrayInputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>            <span class=n>buf</span><span class=o>.</span><span class=na>toByteArray</span><span class=o>()));</span>
</span></span><span class=line><span class=cl>      <span class=n>SerialCtl</span> <span class=n>sc2</span> <span class=o>=</span> <span class=o>(</span><span class=n>SerialCtl</span><span class=o>)</span><span class=n>in</span><span class=o>.</span><span class=na>readObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;After:\n&#34;</span> <span class=o>+</span> <span class=n>sc2</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span><span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=c1>///:~
</span></span></span></code></pre></div><p>在这个例子中，一个 String 保持原始状态，其他设为 transient（临时），以便证明非临时字段会被 defaultWriteObject()方法自动保存，而 transient 字段必须在程序中明确保存和恢复。字段是在构造器内部初始化的，而不是在定义的时候，这证明了它们不会在重新装配的时候被某些自动化机制初始化。</p><p>若准备通过默认机制写入对象的非 transient 部分，那么必须调用 defaultWriteObject()，令其作为 writeObject()中的第一个操作；并调用 defaultReadObject()，令其作为 readObject()的第一个操作。这些都是不常见的调用方法。举个例子来说，当我们为一个 ObjectOutputStream 调用 defaultWriteObject()的时候，而且没有为其传递参数，就需要采取这种操作，使其知道对象的指针以及如何写入所有非 transient 的部分。这种做法非常不便。</p><p>transient 对象的存储与恢复采用了我们更熟悉的代码。现在考虑一下会发生一些什么事情。在 main()中会创建一个 SerialCtl 对象，随后会序列化到一个 ObjectOutputStream 里（注意这种情况下使用的是一个缓冲区，而非文件——与 ObjectOutputStream 完全一致）。正式的序列化操作是在下面这行代码里发生的：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>o</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=n>sc</span><span class=o>);</span>
</span></span></code></pre></div><p>其中，writeObject()方法必须核查 sc，判断它是否有自己的 writeObject()方法（不是检查它的接口——它根本就没有，也不是检查类的类型，而是利用反射方法实际搜索方法）。若答案是肯定的，就使用那个方法。类似的情况也会在 readObject()上发生。或许这是解决问题唯一实际的方法，但确实显得有些古怪。</p><ol start=3><li>版本问题</li></ol><p>有时候可能想改变一个可序列化的类的版本（比如原始类的对象可能保存在数据库中）。尽管这种做法得到了支持，但一般只应在非常特殊的情况下才用它。此外，它要求操作者对背后的原理有一个比较深的认识，而我们在这里还不想达到这种深度。JDK 1.1 的 HTML 文档对这一主题进行了非常全面的论述（可从 Sun 公司下载，但可能也成了 Java 开发包联机文档的一部分）。</p><p>10.9.3 利用“持久性”</p><p>一个比较诱人的想法是用序列化技术保存程序的一些状态信息，从而将程序方便地恢复到以前的状态。但在具体实现以前，有些问题是必须解决的。如果两个对象都有指向第三个对象的指针，该如何对这两个对象序列化呢？如果从两个对象序列化后的状态恢复它们，第三个对象的指针只会出现在一个对象身上吗？如果将这两个对象序列化成独立的文件，然后在代码的不同部分重新装配它们，又会得到什么结果呢？</p><p>下面这个例子对上述问题进行了很好的说明：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//: MyWorld.java
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.io.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>House</span> <span class=kd>implements</span> <span class=n>Serializable</span> <span class=o>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Animal</span> <span class=kd>implements</span> <span class=n>Serializable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=n>House</span> <span class=n>preferredHouse</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=n>Animal</span><span class=o>(</span><span class=n>String</span> <span class=n>nm</span><span class=o>,</span> <span class=n>House</span> <span class=n>h</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=n>nm</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>preferredHouse</span> <span class=o>=</span> <span class=n>h</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>name</span> <span class=o>+</span> <span class=s>&#34;[&#34;</span> <span class=o>+</span> <span class=kd>super</span><span class=o>.</span><span class=na>toString</span><span class=o>()</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>      <span class=s>&#34;], &#34;</span> <span class=o>+</span> <span class=n>preferredHouse</span> <span class=o>+</span> <span class=s>&#34;\n&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MyWorld</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>House</span> <span class=n>house</span> <span class=o>=</span> <span class=k>new</span> <span class=n>House</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>Vector</span>  <span class=n>animals</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Vector</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>animals</span><span class=o>.</span><span class=na>addElement</span><span class=o>(</span>
</span></span><span class=line><span class=cl>      <span class=k>new</span> <span class=n>Animal</span><span class=o>(</span><span class=s>&#34;Bosco the dog&#34;</span><span class=o>,</span> <span class=n>house</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=n>animals</span><span class=o>.</span><span class=na>addElement</span><span class=o>(</span>
</span></span><span class=line><span class=cl>      <span class=k>new</span> <span class=n>Animal</span><span class=o>(</span><span class=s>&#34;Ralph the hamster&#34;</span><span class=o>,</span> <span class=n>house</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=n>animals</span><span class=o>.</span><span class=na>addElement</span><span class=o>(</span>
</span></span><span class=line><span class=cl>      <span class=k>new</span> <span class=n>Animal</span><span class=o>(</span><span class=s>&#34;Fronk the cat&#34;</span><span class=o>,</span> <span class=n>house</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;animals: &#34;</span> <span class=o>+</span> <span class=n>animals</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>ByteArrayOutputStream</span> <span class=n>buf1</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ByteArrayOutputStream</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=n>ObjectOutputStream</span> <span class=n>o1</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ObjectOutputStream</span><span class=o>(</span><span class=n>buf1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>o1</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=n>animals</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>o1</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=n>animals</span><span class=o>);</span> <span class=c1>// Write a 2nd set
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=c1>// Write to a different stream:
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=n>ByteArrayOutputStream</span> <span class=n>buf2</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ByteArrayOutputStream</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=n>ObjectOutputStream</span> <span class=n>o2</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ObjectOutputStream</span><span class=o>(</span><span class=n>buf2</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>o2</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=n>animals</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Now get them back:
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=n>ObjectInputStream</span> <span class=n>in1</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ObjectInputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>          <span class=k>new</span> <span class=n>ByteArrayInputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>            <span class=n>buf1</span><span class=o>.</span><span class=na>toByteArray</span><span class=o>()));</span>
</span></span><span class=line><span class=cl>      <span class=n>ObjectInputStream</span> <span class=n>in2</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ObjectInputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>          <span class=k>new</span> <span class=n>ByteArrayInputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>            <span class=n>buf2</span><span class=o>.</span><span class=na>toByteArray</span><span class=o>()));</span>
</span></span><span class=line><span class=cl>      <span class=n>Vector</span> <span class=n>animals1</span> <span class=o>=</span> <span class=o>(</span><span class=n>Vector</span><span class=o>)</span><span class=n>in1</span><span class=o>.</span><span class=na>readObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=n>Vector</span> <span class=n>animals2</span> <span class=o>=</span> <span class=o>(</span><span class=n>Vector</span><span class=o>)</span><span class=n>in1</span><span class=o>.</span><span class=na>readObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=n>Vector</span> <span class=n>animals3</span> <span class=o>=</span> <span class=o>(</span><span class=n>Vector</span><span class=o>)</span><span class=n>in2</span><span class=o>.</span><span class=na>readObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;animals1: &#34;</span> <span class=o>+</span> <span class=n>animals1</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;animals2: &#34;</span> <span class=o>+</span> <span class=n>animals2</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;animals3: &#34;</span> <span class=o>+</span> <span class=n>animals3</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span><span class=o>(</span><span class=n>Exception</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>e</span><span class=o>.</span><span class=na>printStackTrace</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=c1>///:~
</span></span></span></code></pre></div><p>这里一件有趣的事情是也许是能针对一个字节数组应用对象的序列化，从而实现对任何 Serializable（可序列化）对象的一个“全面复制”（全面复制意味着复制的是整个对象网，而不仅是基本对象和它的指针）。复制问题将在第 12 章进行全面讲述。</p><p>Animal 对象包含了类型为 House 的字段。在 main()中，会创建这些 Animal 的一个 Vector，并对其序列化两次，分别送入两个不同的数据流内。这些数据重新装配并打印出来后，可看到下面这样的结果（对象在每次运行时都会处在不同的内存位置，所以每次运行的结果有区别）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nl>animals:</span> <span class=o>[</span><span class=n>Bosco</span> <span class=n>the</span> <span class=n>dog</span><span class=o>[</span><span class=n>Animal</span><span class=err>@</span><span class=mi>1</span><span class=n>cc76c</span><span class=o>],</span> <span class=n>House</span><span class=err>@</span><span class=mi>1</span><span class=n>cc769</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=n>Ralph</span> <span class=n>the</span> <span class=n>hamster</span><span class=o>[</span><span class=n>Animal</span><span class=err>@</span><span class=mi>1</span><span class=n>cc76d</span><span class=o>],</span> <span class=n>House</span><span class=err>@</span><span class=mi>1</span><span class=n>cc769</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=n>Fronk</span> <span class=n>the</span> <span class=n>cat</span><span class=o>[</span><span class=n>Animal</span><span class=err>@</span><span class=mi>1</span><span class=n>cc76e</span><span class=o>],</span> <span class=n>House</span><span class=err>@</span><span class=mi>1</span><span class=n>cc769</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nl>animals1:</span> <span class=o>[</span><span class=n>Bosco</span> <span class=n>the</span> <span class=n>dog</span><span class=o>[</span><span class=n>Animal</span><span class=err>@</span><span class=mi>1</span><span class=n>cca0c</span><span class=o>],</span> <span class=n>House</span><span class=err>@</span><span class=mi>1</span><span class=n>cca16</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=n>Ralph</span> <span class=n>the</span> <span class=n>hamster</span><span class=o>[</span><span class=n>Animal</span><span class=err>@</span><span class=mi>1</span><span class=n>cca17</span><span class=o>],</span> <span class=n>House</span><span class=err>@</span><span class=mi>1</span><span class=n>cca16</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=n>Fronk</span> <span class=n>the</span> <span class=n>cat</span><span class=o>[</span><span class=n>Animal</span><span class=err>@</span><span class=mi>1</span><span class=n>cca1b</span><span class=o>],</span> <span class=n>House</span><span class=err>@</span><span class=mi>1</span><span class=n>cca16</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nl>animals2:</span> <span class=o>[</span><span class=n>Bosco</span> <span class=n>the</span> <span class=n>dog</span><span class=o>[</span><span class=n>Animal</span><span class=err>@</span><span class=mi>1</span><span class=n>cca0c</span><span class=o>],</span> <span class=n>House</span><span class=err>@</span><span class=mi>1</span><span class=n>cca16</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=n>Ralph</span> <span class=n>the</span> <span class=n>hamster</span><span class=o>[</span><span class=n>Animal</span><span class=err>@</span><span class=mi>1</span><span class=n>cca17</span><span class=o>],</span> <span class=n>House</span><span class=err>@</span><span class=mi>1</span><span class=n>cca16</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=n>Fronk</span> <span class=n>the</span> <span class=n>cat</span><span class=o>[</span><span class=n>Animal</span><span class=err>@</span><span class=mi>1</span><span class=n>cca1b</span><span class=o>],</span> <span class=n>House</span><span class=err>@</span><span class=mi>1</span><span class=n>cca16</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nl>animals3:</span> <span class=o>[</span><span class=n>Bosco</span> <span class=n>the</span> <span class=n>dog</span><span class=o>[</span><span class=n>Animal</span><span class=err>@</span><span class=mi>1</span><span class=n>cca52</span><span class=o>],</span> <span class=n>House</span><span class=err>@</span><span class=mi>1</span><span class=n>cca5c</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=n>Ralph</span> <span class=n>the</span> <span class=n>hamster</span><span class=o>[</span><span class=n>Animal</span><span class=err>@</span><span class=mi>1</span><span class=n>cca5d</span><span class=o>],</span> <span class=n>House</span><span class=err>@</span><span class=mi>1</span><span class=n>cca5c</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=n>Fronk</span> <span class=n>the</span> <span class=n>cat</span><span class=o>[</span><span class=n>Animal</span><span class=err>@</span><span class=mi>1</span><span class=n>cca61</span><span class=o>],</span> <span class=n>House</span><span class=err>@</span><span class=mi>1</span><span class=n>cca5c</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></div><p>当然，我们希望装配好的对象有与原来不同的地址。但注意在 animals1 和 animals2 中出现了相同的地址，其中包括共享的、对 House 对象的引用。在另一方面，当 animals3 恢复以后，系统没有办法知道另一个流内的对象是第一个流内对象的化身，所以会产生一个完全不同的对象网。</p><p>只要将所有东西都序列化到单独一个数据流里，就能恢复获得与以前写入时完全一样的对象网，不会不慎造成对象的重复。当然，在写第一个和最后一个对象的时间之间，可改变对象的状态，但那必须由我们明确采取操作——序列化时，对象会采用它们当时的任何状态（包括它们与其他对象的连接关系）写入。</p><p>若想保存系统状态，最安全的做法是当作一种“微观”操作序列化。如果序列化了某些东西，再去做其他一些工作，再来序列化更多的东西，以此类推，那么最终将无法安全地保存系统状态。相反，应将构成系统状态的所有对象都置入单个集合内，并在一次操作里完成那个集合的写入。这样一来，同样只需一次方法调用，即可成功恢复之。</p><p>下面这个例子是一套假想的计算机辅助设计（CAD）系统，对这一方法进行了很好的演示。此外，它还为我们引入了 static 字段的问题——如留意联机文档，就会发现 Class 是“Serializable”（可序列化）的，所以只需简单地序列化 Class 对象，就能实现 static 字段的保存。这无论如何都是一种明智的做法。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>//: CADState.java
</span></span></span><span class=line><span class=cl><span class=c1>// Saving and restoring the state of a
</span></span></span><span class=line><span class=cl><span class=c1>// pretend CAD system.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kn>import</span> <span class=nn>java.io.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.*</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>Shape</span> <span class=kd>implements</span> <span class=n>Serializable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>    <span class=n>RED</span> <span class=o>=</span> <span class=mi>1</span><span class=o>,</span> <span class=n>BLUE</span> <span class=o>=</span> <span class=mi>2</span><span class=o>,</span> <span class=n>GREEN</span> <span class=o>=</span> <span class=mi>3</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>int</span> <span class=n>xPos</span><span class=o>,</span> <span class=n>yPos</span><span class=o>,</span> <span class=n>dimension</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>static</span> <span class=n>Random</span> <span class=n>r</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>static</span> <span class=kt>int</span> <span class=n>counter</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>abstract</span> <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setColor</span><span class=o>(</span><span class=kt>int</span> <span class=n>newColor</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>abstract</span> <span class=kd>public</span> <span class=kt>int</span> <span class=nf>getColor</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=nf>Shape</span><span class=o>(</span><span class=kt>int</span> <span class=n>xVal</span><span class=o>,</span> <span class=kt>int</span> <span class=n>yVal</span><span class=o>,</span> <span class=kt>int</span> <span class=n>dim</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>xPos</span> <span class=o>=</span> <span class=n>xVal</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>yPos</span> <span class=o>=</span> <span class=n>yVal</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=n>dimension</span> <span class=o>=</span> <span class=n>dim</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>getClass</span><span class=o>().</span><span class=na>toString</span><span class=o>()</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>      <span class=s>&#34; color[&#34;</span> <span class=o>+</span> <span class=n>getColor</span><span class=o>()</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>      <span class=s>&#34;] xPos[&#34;</span> <span class=o>+</span> <span class=n>xPos</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>      <span class=s>&#34;] yPos[&#34;</span> <span class=o>+</span> <span class=n>yPos</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>      <span class=s>&#34;] dim[&#34;</span> <span class=o>+</span> <span class=n>dimension</span> <span class=o>+</span> <span class=s>&#34;]\n&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=n>Shape</span> <span class=nf>randomFactory</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>xVal</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=na>nextInt</span><span class=o>()</span> <span class=o>%</span> <span class=mi>100</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>yVal</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=na>nextInt</span><span class=o>()</span> <span class=o>%</span> <span class=mi>100</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>dim</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=na>nextInt</span><span class=o>()</span> <span class=o>%</span> <span class=mi>100</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span><span class=o>(</span><span class=n>counter</span><span class=o>++</span> <span class=o>%</span> <span class=mi>3</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>0</span><span class=o>:</span> <span class=k>return</span> <span class=k>new</span> <span class=n>Circle</span><span class=o>(</span><span class=n>xVal</span><span class=o>,</span> <span class=n>yVal</span><span class=o>,</span> <span class=n>dim</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>1</span><span class=o>:</span> <span class=k>return</span> <span class=k>new</span> <span class=n>Square</span><span class=o>(</span><span class=n>xVal</span><span class=o>,</span> <span class=n>yVal</span><span class=o>,</span> <span class=n>dim</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>2</span><span class=o>:</span> <span class=k>return</span> <span class=k>new</span> <span class=n>Line</span><span class=o>(</span><span class=n>xVal</span><span class=o>,</span> <span class=n>yVal</span><span class=o>,</span> <span class=n>dim</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Circle</span> <span class=kd>extends</span> <span class=n>Shape</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>static</span> <span class=kt>int</span> <span class=n>color</span> <span class=o>=</span> <span class=n>RED</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=nf>Circle</span><span class=o>(</span><span class=kt>int</span> <span class=n>xVal</span><span class=o>,</span> <span class=kt>int</span> <span class=n>yVal</span><span class=o>,</span> <span class=kt>int</span> <span class=n>dim</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>super</span><span class=o>(</span><span class=n>xVal</span><span class=o>,</span> <span class=n>yVal</span><span class=o>,</span> <span class=n>dim</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setColor</span><span class=o>(</span><span class=kt>int</span> <span class=n>newColor</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>color</span> <span class=o>=</span> <span class=n>newColor</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>int</span> <span class=nf>getColor</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>color</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Square</span> <span class=kd>extends</span> <span class=n>Shape</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>static</span> <span class=kt>int</span> <span class=n>color</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=nf>Square</span><span class=o>(</span><span class=kt>int</span> <span class=n>xVal</span><span class=o>,</span> <span class=kt>int</span> <span class=n>yVal</span><span class=o>,</span> <span class=kt>int</span> <span class=n>dim</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>super</span><span class=o>(</span><span class=n>xVal</span><span class=o>,</span> <span class=n>yVal</span><span class=o>,</span> <span class=n>dim</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>color</span> <span class=o>=</span> <span class=n>RED</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setColor</span><span class=o>(</span><span class=kt>int</span> <span class=n>newColor</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>color</span> <span class=o>=</span> <span class=n>newColor</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>int</span> <span class=nf>getColor</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>color</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>Line</span> <span class=kd>extends</span> <span class=n>Shape</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>static</span> <span class=kt>int</span> <span class=n>color</span> <span class=o>=</span> <span class=n>RED</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span>
</span></span><span class=line><span class=cl>  <span class=nf>serializeStaticState</span><span class=o>(</span><span class=n>ObjectOutputStream</span> <span class=n>os</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>os</span><span class=o>.</span><span class=na>writeInt</span><span class=o>(</span><span class=n>color</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span>
</span></span><span class=line><span class=cl>  <span class=nf>deserializeStaticState</span><span class=o>(</span><span class=n>ObjectInputStream</span> <span class=n>os</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>color</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=na>readInt</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=nf>Line</span><span class=o>(</span><span class=kt>int</span> <span class=n>xVal</span><span class=o>,</span> <span class=kt>int</span> <span class=n>yVal</span><span class=o>,</span> <span class=kt>int</span> <span class=n>dim</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>super</span><span class=o>(</span><span class=n>xVal</span><span class=o>,</span> <span class=n>yVal</span><span class=o>,</span> <span class=n>dim</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setColor</span><span class=o>(</span><span class=kt>int</span> <span class=n>newColor</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>color</span> <span class=o>=</span> <span class=n>newColor</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>int</span> <span class=nf>getColor</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>color</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CADState</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Vector</span> <span class=n>shapeTypes</span><span class=o>,</span> <span class=n>shapes</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=o>(</span><span class=n>args</span><span class=o>.</span><span class=na>length</span> <span class=o>==</span> <span class=mi>0</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>shapeTypes</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Vector</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=n>shapes</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Vector</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Add handles to the class objects:
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=n>shapeTypes</span><span class=o>.</span><span class=na>addElement</span><span class=o>(</span><span class=n>Circle</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>shapeTypes</span><span class=o>.</span><span class=na>addElement</span><span class=o>(</span><span class=n>Square</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>shapeTypes</span><span class=o>.</span><span class=na>addElement</span><span class=o>(</span><span class=n>Line</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Make some shapes:
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>for</span><span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span>
</span></span><span class=line><span class=cl>        <span class=n>shapes</span><span class=o>.</span><span class=na>addElement</span><span class=o>(</span><span class=n>Shape</span><span class=o>.</span><span class=na>randomFactory</span><span class=o>());</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Set all the static colors to GREEN:
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>for</span><span class=o>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=o>;</span> <span class=n>i</span><span class=o>++)</span>
</span></span><span class=line><span class=cl>        <span class=o>((</span><span class=n>Shape</span><span class=o>)</span><span class=n>shapes</span><span class=o>.</span><span class=na>elementAt</span><span class=o>(</span><span class=n>i</span><span class=o>))</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>setColor</span><span class=o>(</span><span class=n>Shape</span><span class=o>.</span><span class=na>GREEN</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Save the state vector:
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=n>ObjectOutputStream</span> <span class=n>out</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ObjectOutputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>          <span class=k>new</span> <span class=n>FileOutputStream</span><span class=o>(</span><span class=s>&#34;CADState.out&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>      <span class=n>out</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=n>shapeTypes</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>Line</span><span class=o>.</span><span class=na>serializeStaticState</span><span class=o>(</span><span class=n>out</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>out</span><span class=o>.</span><span class=na>writeObject</span><span class=o>(</span><span class=n>shapes</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>else</span> <span class=o>{</span> <span class=c1>// There&#39;s a command-line argument
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=n>ObjectInputStream</span> <span class=n>in</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>ObjectInputStream</span><span class=o>(</span>
</span></span><span class=line><span class=cl>          <span class=k>new</span> <span class=n>FileInputStream</span><span class=o>(</span><span class=n>args</span><span class=o>[</span><span class=mi>0</span><span class=o>]));</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Read in the same order they were written:
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=n>shapeTypes</span> <span class=o>=</span> <span class=o>(</span><span class=n>Vector</span><span class=o>)</span><span class=n>in</span><span class=o>.</span><span class=na>readObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=n>Line</span><span class=o>.</span><span class=na>deserializeStaticState</span><span class=o>(</span><span class=n>in</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>shapes</span> <span class=o>=</span> <span class=o>(</span><span class=n>Vector</span><span class=o>)</span><span class=n>in</span><span class=o>.</span><span class=na>readObject</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Display the shapes:
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>shapes</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span> <span class=c1>///:~
</span></span></span></code></pre></div><p>Shape（几何形状）类“实现了可序列化”（implements Serializable），所以从 Shape 继承的任何东西也都会自动“可序列化”。每个 Shape 都包含了数据，而且每个衍生的 Shape 类都包含了一个特殊的 static 字段，用于决定所有那些类型的 Shape 的颜色（如将一个 static 字段置入基础类，结果只会产生一个字段，因为 static 字段未在衍生类中复制）。可对基础类中的方法进行覆盖处理，以便为不同的类型设置颜色（static 方法不会动态绑定，所以这些都是普通的方法）。每次调用 randomFactory()方法时，它都会创建一个不同的 Shape（Shape 值采用随机值）。</p><p>Circle（圆）和 Square（矩形）属于对 Shape 的直接扩展；唯一的差别是 Circle 在定义时会初始化颜色，而 Square 在构造器中初始化。Line（直线）的问题将留到以后讨论。</p><p>在 main()中，一个 Vector 用于容纳 Class 对象，而另一个用于容纳形状。若不提供相应的命令行参数，就会创建 shapeTypes Vector，并添加 Class 对象。然后创建 shapes Vector，并添加 Shape 对象。接下来，所有 static color 值都会设成 GREEN，而且所有东西都会序列化到文件 CADState.out。</p><p>若提供了一个命令行参数（假设 CADState.out），便会打开那个文件，并用它恢复程序的状态。无论在哪种情况下，结果产生的 Shape 的 Vector 都会打印出来。下面列出它某一次运行的结果：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>&gt;</span><span class=n>java</span> <span class=n>CADState</span>
</span></span><span class=line><span class=cl><span class=o>[</span><span class=kd>class</span> <span class=nc>Circle</span> <span class=n>color</span><span class=o>[</span><span class=mi>3</span><span class=o>]</span> <span class=n>xPos</span><span class=o>[-</span><span class=mi>51</span><span class=o>]</span> <span class=n>yPos</span><span class=o>[-</span><span class=mi>99</span><span class=o>]</span> <span class=n>dim</span><span class=o>[</span><span class=mi>38</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=kd>class</span> <span class=nc>Square</span> <span class=n>color</span><span class=o>[</span><span class=mi>3</span><span class=o>]</span> <span class=n>xPos</span><span class=o>[</span><span class=mi>2</span><span class=o>]</span> <span class=n>yPos</span><span class=o>[</span><span class=mi>61</span><span class=o>]</span> <span class=n>dim</span><span class=o>[-</span><span class=mi>46</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=kd>class</span> <span class=nc>Line</span> <span class=n>color</span><span class=o>[</span><span class=mi>3</span><span class=o>]</span> <span class=n>xPos</span><span class=o>[</span><span class=mi>51</span><span class=o>]</span> <span class=n>yPos</span><span class=o>[</span><span class=mi>73</span><span class=o>]</span> <span class=n>dim</span><span class=o>[</span><span class=mi>64</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=kd>class</span> <span class=nc>Circle</span> <span class=n>color</span><span class=o>[</span><span class=mi>3</span><span class=o>]</span> <span class=n>xPos</span><span class=o>[-</span><span class=mi>70</span><span class=o>]</span> <span class=n>yPos</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span> <span class=n>dim</span><span class=o>[</span><span class=mi>16</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=kd>class</span> <span class=nc>Square</span> <span class=n>color</span><span class=o>[</span><span class=mi>3</span><span class=o>]</span> <span class=n>xPos</span><span class=o>[</span><span class=mi>3</span><span class=o>]</span> <span class=n>yPos</span><span class=o>[</span><span class=mi>94</span><span class=o>]</span> <span class=n>dim</span><span class=o>[-</span><span class=mi>36</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=kd>class</span> <span class=nc>Line</span> <span class=n>color</span><span class=o>[</span><span class=mi>3</span><span class=o>]</span> <span class=n>xPos</span><span class=o>[-</span><span class=mi>84</span><span class=o>]</span> <span class=n>yPos</span><span class=o>[-</span><span class=mi>21</span><span class=o>]</span> <span class=n>dim</span><span class=o>[-</span><span class=mi>35</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=kd>class</span> <span class=nc>Circle</span> <span class=n>color</span><span class=o>[</span><span class=mi>3</span><span class=o>]</span> <span class=n>xPos</span><span class=o>[-</span><span class=mi>75</span><span class=o>]</span> <span class=n>yPos</span><span class=o>[-</span><span class=mi>43</span><span class=o>]</span> <span class=n>dim</span><span class=o>[</span><span class=mi>22</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=kd>class</span> <span class=nc>Square</span> <span class=n>color</span><span class=o>[</span><span class=mi>3</span><span class=o>]</span> <span class=n>xPos</span><span class=o>[</span><span class=mi>81</span><span class=o>]</span> <span class=n>yPos</span><span class=o>[</span><span class=mi>30</span><span class=o>]</span> <span class=n>dim</span><span class=o>[-</span><span class=mi>45</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=kd>class</span> <span class=nc>Line</span> <span class=n>color</span><span class=o>[</span><span class=mi>3</span><span class=o>]</span> <span class=n>xPos</span><span class=o>[-</span><span class=mi>29</span><span class=o>]</span> <span class=n>yPos</span><span class=o>[</span><span class=mi>92</span><span class=o>]</span> <span class=n>dim</span><span class=o>[</span><span class=mi>17</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=kd>class</span> <span class=nc>Circle</span> <span class=n>color</span><span class=o>[</span><span class=mi>3</span><span class=o>]</span> <span class=n>xPos</span><span class=o>[</span><span class=mi>17</span><span class=o>]</span> <span class=n>yPos</span><span class=o>[</span><span class=mi>90</span><span class=o>]</span> <span class=n>dim</span><span class=o>[-</span><span class=mi>76</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&gt;</span><span class=n>java</span> <span class=n>CADState</span> <span class=n>CADState</span><span class=o>.</span><span class=na>out</span>
</span></span><span class=line><span class=cl><span class=o>[</span><span class=kd>class</span> <span class=nc>Circle</span> <span class=n>color</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span> <span class=n>xPos</span><span class=o>[-</span><span class=mi>51</span><span class=o>]</span> <span class=n>yPos</span><span class=o>[-</span><span class=mi>99</span><span class=o>]</span> <span class=n>dim</span><span class=o>[</span><span class=mi>38</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=kd>class</span> <span class=nc>Square</span> <span class=n>color</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span> <span class=n>xPos</span><span class=o>[</span><span class=mi>2</span><span class=o>]</span> <span class=n>yPos</span><span class=o>[</span><span class=mi>61</span><span class=o>]</span> <span class=n>dim</span><span class=o>[-</span><span class=mi>46</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=kd>class</span> <span class=nc>Line</span> <span class=n>color</span><span class=o>[</span><span class=mi>3</span><span class=o>]</span> <span class=n>xPos</span><span class=o>[</span><span class=mi>51</span><span class=o>]</span> <span class=n>yPos</span><span class=o>[</span><span class=mi>73</span><span class=o>]</span> <span class=n>dim</span><span class=o>[</span><span class=mi>64</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=kd>class</span> <span class=nc>Circle</span> <span class=n>color</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span> <span class=n>xPos</span><span class=o>[-</span><span class=mi>70</span><span class=o>]</span> <span class=n>yPos</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span> <span class=n>dim</span><span class=o>[</span><span class=mi>16</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=kd>class</span> <span class=nc>Square</span> <span class=n>color</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span> <span class=n>xPos</span><span class=o>[</span><span class=mi>3</span><span class=o>]</span> <span class=n>yPos</span><span class=o>[</span><span class=mi>94</span><span class=o>]</span> <span class=n>dim</span><span class=o>[-</span><span class=mi>36</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=kd>class</span> <span class=nc>Line</span> <span class=n>color</span><span class=o>[</span><span class=mi>3</span><span class=o>]</span> <span class=n>xPos</span><span class=o>[-</span><span class=mi>84</span><span class=o>]</span> <span class=n>yPos</span><span class=o>[-</span><span class=mi>21</span><span class=o>]</span> <span class=n>dim</span><span class=o>[-</span><span class=mi>35</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=kd>class</span> <span class=nc>Circle</span> <span class=n>color</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span> <span class=n>xPos</span><span class=o>[-</span><span class=mi>75</span><span class=o>]</span> <span class=n>yPos</span><span class=o>[-</span><span class=mi>43</span><span class=o>]</span> <span class=n>dim</span><span class=o>[</span><span class=mi>22</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=kd>class</span> <span class=nc>Square</span> <span class=n>color</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span> <span class=n>xPos</span><span class=o>[</span><span class=mi>81</span><span class=o>]</span> <span class=n>yPos</span><span class=o>[</span><span class=mi>30</span><span class=o>]</span> <span class=n>dim</span><span class=o>[-</span><span class=mi>45</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=kd>class</span> <span class=nc>Line</span> <span class=n>color</span><span class=o>[</span><span class=mi>3</span><span class=o>]</span> <span class=n>xPos</span><span class=o>[-</span><span class=mi>29</span><span class=o>]</span> <span class=n>yPos</span><span class=o>[</span><span class=mi>92</span><span class=o>]</span> <span class=n>dim</span><span class=o>[</span><span class=mi>17</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>,</span> <span class=kd>class</span> <span class=nc>Circle</span> <span class=n>color</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span> <span class=n>xPos</span><span class=o>[</span><span class=mi>17</span><span class=o>]</span> <span class=n>yPos</span><span class=o>[</span><span class=mi>90</span><span class=o>]</span> <span class=n>dim</span><span class=o>[-</span><span class=mi>76</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>```</span> <span class=n>java</span>
</span></span><span class=line><span class=cl><span class=err>从中可以看出，</span><span class=n>xPos</span><span class=err>，</span><span class=n>yPos</span><span class=err>以及</span><span class=n>dim</span><span class=err>的值都已成功保存和恢复出来。但在获取</span><span class=n>static</span><span class=err>信息时却出现了问题。所有“</span><span class=mi>3</span><span class=err>”都已进入，但没有正常地出来。</span><span class=n>Circle</span><span class=err>有一个</span><span class=mi>1</span><span class=err>值（定义为</span><span class=n>RED</span><span class=err>），而</span><span class=n>Square</span><span class=err>有一个</span><span class=mi>0</span><span class=err>值（记住，它们是在构造器里初始化的）。看上去似乎</span><span class=n>static</span><span class=err>根本没有得到初始化！实情正是如此——尽管类</span><span class=n>Class</span><span class=err>是“可以序列化的”，但却不能按我们希望的工作。所以假如想序列化</span><span class=n>static</span><span class=err>值，必须亲自动手。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>这正是</span><span class=n>Line</span><span class=err>中的</span><span class=n>serializeStaticState</span><span class=o>()</span><span class=err>和</span><span class=n>deserializeStaticState</span><span class=o>()</span><span class=err>两个</span><span class=n>static</span><span class=err>方法的用途。可以看到，这两个方法都是作为存储和恢复进程的一部分明确调用的（注意写入序列化文件和从中读回的顺序不能改变）。所以为了使</span><span class=n>CADState</span><span class=o>.</span><span class=na>java</span><span class=err>正确运行起来，必须采用下述三种方法之一：</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span><span class=mi>1</span><span class=o>)</span> <span class=err>为几何形状添加一个</span><span class=n>serializeStaticState</span><span class=o>()</span><span class=err>和</span><span class=n>deserializeStaticState</span><span class=o>()</span><span class=err>。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span><span class=mi>2</span><span class=o>)</span> <span class=err>删除</span><span class=n>Vector</span> <span class=n>shapeTypes</span><span class=err>以及与之有关的所有代码</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span><span class=mi>3</span><span class=o>)</span> <span class=err>在几何形状内添加对新序列化和撤消序列化静态方法的调用</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>要注意的另一个问题是安全，因为序列化处理也会将</span><span class=n>private</span><span class=err>数据保存下来。若有需要保密的字段，应将其标记成</span><span class=kd>transient</span><span class=err>。但在这之后，必须设计一种安全的信息保存方法。这样一来，一旦需要恢复，就可以重设那些</span><span class=n>private</span><span class=err>变量。</span>
</span></span></code></pre></div></div><div class=article-widget><div class="container-xl row post-nav"><div class="col-6 post-nav-item"><div class=meta-nav>上一页</div><a href=/books/java-notes/99.%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/think-in-java/10.java-io-%E7%B3%BB%E7%BB%9F/10.8-%E5%8E%8B%E7%BC%A9/ rel=next>10.8 压缩</a></div></div></div><div class=body-footer><p>最近更新于 0001-01-01</p><section id=comments class="mb-3 pt-0"><div id=disqus_thread></div><script>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="https://ngte.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></article><footer class=site-footer><div class="copyright py-4 bg-footer"><div class="row justify-content-center"><div class="text-center footer-color"><p class=mb-0>© 2017-2022 NGTE all rights reserved</p></div></div></div><script type=text/javascript id=clstr_globe async src="//clustrmaps.com/globe.js?d=kgpJG5sWZQpKujBmD-uW1B54-WBPol-DuDtrB2KFjKs"></script></footer></main></div></div><script src=//unpkg.com/heti/umd/heti-addon.min.js></script>
<script>const heti=new Heti(".article");heti.autoSpacing()</script><script type=text/javascript>window.$crisp=[],window.CRISP_WEBSITE_ID="12adcc35-9621-4313-8262-62dc654b29d8",function(){setTimeout(function(){d=document,s=d.createElement("script"),s.src="https://client.crisp.chat/l.js",s.async=1,d.getElementsByTagName("head")[0].appendChild(s)},2500)}()</script></div><div class=page-footer></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin=anonymous></script>
<script id=search-hit-algolia-template type=text/html><div class=search-hit><div class=search-hit-content><div class=search-hit-name><a href={{relpermalink}}>{{#helpers.highlight}}{ "attribute": "title" }{{/helpers.highlight}}</a></div><div class="article-metadata search-hit-type">{{type}}</div><p class=search-hit-description>{{#helpers.highlight}}{ "attribute": "summary" }{{/helpers.highlight}}</p></div></div></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js crossorigin=anonymous></script>
<script id=dsq-count-scr src=https://ngte.disqus.com/count.js async></script>
<script src=/zh/js/algolia-search-built.min.4387d694ca1258194aaf562b8cd1c400.js type=module></script>
<script id=page-data type=application/json>{"use_headroom":false}</script><script src=/zh/js/wowchemy.min.d1673c7a11d1238516cbe12a1e84257f.js></script>
<script>var mybutton=document.getElementById("backTopBtn");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><script src=https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script><script>(function(){"use strict";if(!document.queryCommandSupported("copy"))return;function e(e,t){e.className="highlight-copy-btn",e.textContent=t,setTimeout(function(){e.textContent="",e.className="highlight-copy-btn fa fa-copy"},1e3)}function t(e){var t=window.getSelection(),n=document.createRange();return n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n),t}function n(n){var o,s=document.createElement("button");s.className="highlight-copy-btn fa fa-copy",s.textContent="",o=n.firstElementChild,s.addEventListener("click",function(){try{var n=t(o);document.execCommand("copy"),n.removeAllRanges(),e(s,"已复制")}catch(t){console&&console.log(t),e(s,"Failed :'(")}}),n.appendChild(s)}var s=document.getElementsByClassName("highlight");Array.prototype.forEach.call(s,n)})()</script></body></html>