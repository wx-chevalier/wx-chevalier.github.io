
---
title: MQTT
linktitle: MQTT
type: book
commentable: true
---

# MQTT

MQTT 的全称为 Message Queue Telemetry Transport（消息队列遥测传输协议），是在 1999 年，由 IBM 的 Andy Stanford-Clark 和 Arcom 的 Arlen Nipper 为了一个通过卫星网络连接输油管道的项目开发的。为了满足低电量消耗和低网络带宽的需求，MQTT 协议在设计之初就包含了以下一些特点：

- 实现简单
- 提供数据传输的 QoS
- 轻量、占用带宽低
- 可传输任意类型的数据
- 可保持的会话（session）

之后 IBM 一直将 MQTT 作为一个内部协议在其产品中使用，直到 2010 年，IBM 公开发布了 MQTT 3.1 版本。在 2014 年，MQTT 协议正式成为了 OASIS（结构化信息标准促进组织）的标准协议。MQTT 最大优点在于，可以以极少的代码和有限的带宽，为连接远程设备提供实时可靠的消息服务。作为一种低开销、低带宽占用的即时通讯协议，使其在物联网、小型设备、移动应用等方面有较广泛的应用，譬如受限的环境中，通过卫星链路通信传感器、偶尔拨号的医疗设备、智能家居等等。

![MQTT Broker 示意](https://assets.ng-tech.icu/item/20221225150737.png)

MQTT 协议提供一对多的消息发布，可以解除应用程序耦合，信息冗余小。该协议需要客户端和服务端，而协议中主要有三种身份：发布者（Publisher）、代理（Broker，服务器）、订阅者（Subscriber）。其中，消息的发布者和订阅者都是客户端，消息代理是服务器，而消息发布者可以同时是订阅者，实现了生产者与消费者的脱耦。

# 背景分析

## 设计原则

MQTT 协议主要是根据以下情况设计的：

- M2M（Machine to Machine），机器或设备间端到端通信，比如传感器之间的数据通讯。
- 设备（Machine）中，例如传感器，硬件能力很弱，协议要考虑尽量小的资源消耗，比如计算能力和存储等。

由于物联网的环境是非常特别的，所以 MQTT 遵循以下设计原则：

- 精简，不添加可有可无的功能；
- 发布/订阅（Pub/Sub）模式，方便消息在传感器之间传递；
- 允许用户动态创建主题，零运维成本；
- 把传输量降到最低以提高传输效率；
- 把低带宽、高延迟、不稳定的网络等因素考虑在内；
- 支持连续的会话控制；
- 理解客户端计算能力可能很低；
- 提供服务质量管理；
- 假设数据不可知，不强求传输数据的类型与格式，保持灵活性。

## 消息特性

MQTT 提供三种不同质量的消息服务：

- 至多一次：消息发布完全依赖底层 TCP/IP 网络。会发生消息丢失或重复。这一级别可用于如下情况，环境传感器数据，丢失一次读记录无所谓，因为不久后还会有第二次发送。
- 至少一次：确保消息到达，但消息重复可能会发生。
- 只有一次：确保消息到达一次。这一级别可用于如下情况，在计费系统中，消息重复或丢失会导致不正确的结果。

# Links

- https://www.runoob.com/w3cnote/mqtt-intro.html

    